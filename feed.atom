<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>PlanÃ¨te PostgreSQL</title>
  <id>https://planete.postgresql.fr/</id>
  <updated>2025-03-27T04:39:08Z</updated>
  <subtitle>L&#39;actualitÃ© de PostgreSQL de franÃ§ais</subtitle>
  <link href="https://planete.postgresql.fr/"></link>
  <author>
    <name>PostgreSQL.fr</name>
    <email>contact@postgresql.fr</email>
  </author>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #5 - CRITICAL - Plus de place !</title>
    <updated>2025-03-24T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-03-24://2025/03/24/cnpg-5.html</id>
    <link href="https://blog.dalibo.com//2025/03/24/cnpg-5.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 24 mars 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;CloudNativePG&lt;/strong&gt; ou comment embarquer un Ã©lÃ©phant sur un porte-conteneurs !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Beaucoup de choses vous ont Ã©tÃ© prÃ©sentÃ©es dans les derniers articles de cette&#xA;sÃ©rie. Bien quâ€™assez techniques et pratiques, ils ne prÃ©sentaient pas vraiment&#xA;de cas concrets, pouvant Ãªtre rencontrÃ©s dans la vraie vie comme on dit. Câ€™est&#xA;chose faite avec le prÃ©sent article qui sâ€™attarde sur un problÃ¨me bien connu des&#xA;administrateurs PostgreSQL : la saturation de lâ€™espace disque ğŸ’¥ !&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;cluster-kubernetes&#34;&gt;Cluster Kubernetes&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette fois-ci, nous passons dans la cour des grands en utilisant un vrai cluster&#xA;Kubernetes chez un fournisseur de cloud. Bon â€¦ presque la cour des grands, comme on se&#xA;contentera dâ€™utiliser un cluster managÃ©, mais câ€™est dÃ©jÃ  Ã§a. Une fois dÃ©ployÃ©,&#xA;nous installons lâ€™opÃ©rateur et crÃ©ons un cluster PostgreSQL avec un primaire et un&#xA;secondaire Ã  partir de ce fichier.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;walStorage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;4Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;affinity&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;enablePodAntiAffinity&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt; &#xA;    &lt;span class=&#34;na&#34;&gt;topologyKey&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;kubernetes.io/hostname&lt;/span&gt; &#xA;    &lt;span class=&#34;na&#34;&gt;podAntiAffinityType&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;preferred&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Une bonne pratique dans PostgreSQL souvent recommandÃ©e mais peu appliquÃ©e est&#xA;dâ€™avoir au moins deux espaces de stockage bien distincts :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Un pour les donnÃ©es ;&lt;/li&gt;&#xA;  &lt;li&gt;Un pour les journaux de transactions (WAL).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;CloudNativePG respecte cette bonne pratique avec la spÃ©cification&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.walStorage&lt;/code&gt;. Lorsque le cluster est crÃ©Ã©, deux &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistant Volumes&lt;/code&gt;&#xA;distincts seront crÃ©Ã©s automatiquement. Nous ne rentrerons pas dans les dÃ©tails,&#xA;mais sachez quâ€™il est possible de les configurer plus finement, avec&#xA;par exemple le choix dâ€™une &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Storage Class&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;Au passage, la version 17.0 de PostgreSQL date de quelques mois et il existe&#xA;mÃªme la version 17.4 depuis quelques semaines ğŸ’¡. Un article sur la montÃ©e de&#xA;version mineure arrive, câ€™est pour cela que la version 17.0 est toujours&#xA;utilisÃ©e.&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;CrÃ©ons ce cluster. Attendons quelques minutes et voilÃ  nos instances prÃªtes avec&#xA;pour chacune dâ€™elles deux &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistent Volumes&lt;/code&gt;. Les noms des &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLAIMS&lt;/code&gt; permettent&#xA;de savoir Ã  quoi ils correspondent.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get persistentvolume &lt;span class=&#34;nt&#34;&gt;-o&lt;/span&gt; custom-columns&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;NAME:.metadata.name,CAPACITY:.spec.capacity.storage,CLAIM:.spec.claimRef.name&#xA;&lt;span class=&#34;go&#34;&gt;NAME                                       CAPACITY   CLAIM&#xA;pvc-09fe198a-ba85-440c-94b4-8de3d32af7dc   10Gi       postgresql-1-wal&#xA;pvc-22e4f5c6-f9b0-4bf9-b375-49e7be2e528b   20Gi       postgresql-1&#xA;pvc-9e8d0c70-c6b7-4941-86d1-7cc53fd67fbd   20Gi       postgresql-2&#xA;pvc-d878ce9c-f85e-4e1b-85a6-f40296a4a318   10Gi       postgresql-2-wal&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h3 id=&#34;saturation-de-lespace-de-stockage&#34;&gt;Saturation de lâ€™espace de stockage&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Utilisons lâ€™outil &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_bench&lt;/code&gt; pour crÃ©er suffisamment de donnÃ©es et saturer&#xA;lâ€™espace de stockage. Le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--scale 2000&lt;/code&gt; permet de gÃ©nÃ©rer une&#xA;trentaine de Go de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg pgbench postgresql &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--initialize&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--scale&lt;/span&gt; 2000&#xA;&lt;span class=&#34;go&#34;&gt;job/postgresql-pgbench-876082 created&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;En regardant les traces du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt; (le primaire), nous voyons le&#xA;dÃ©clenchement de nombreux &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CHECKPOINT&lt;/code&gt;. Un peu trop dâ€™ailleurs, PostgreSQL nous&#xA;donne mÃªme une astuce :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;checkpoints are occurring too frequently (15 seconds apart)&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;hint&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Consider increasing the configuration parameter &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;max_wal_size&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;Si vous souhaitez en savoir un peu plus, allez jeter un Å“il Ã  notre article de&#xA;blog sur les &lt;a href=&#34;https://blog.dalibo.com/2024/01/05/cambouis.html&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CHECKPOINTS&lt;/code&gt;&lt;/a&gt; ğŸ“°.&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Revenons Ã  nos traces PostgreSQL. Un peu plus loin, nous trouvons le message de&#xA;mauvais augure &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;No space left on device&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;error_severity&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;PANIC&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;could not write to file &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;pg_wal/xlogtemp.537&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;: No space left on device&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;context&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;writing block 2081579 of relation base/16385/16403&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;COPY pgbench_accounts, line 127099000&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Câ€™est Ã  ce moment lÃ  que votre outil de surveillance vous remonte lâ€™alerte&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CRITICAL - Plus de place !&lt;/code&gt; !&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;plongeons-dans-les-traces&#34;&gt;Plongeons dans les traces&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ne paniquons pas, regardons ce que nous disent les traces et essayons de&#xA;comprendre ce quâ€™il se passe.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La copie de donnÃ©es par &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; ne peut plus se faire comme lâ€™espace disque&#xA;est saturÃ©. Le backend associÃ© est arrÃªtÃ© :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;server process (PID 537) was terminated by signal 6: Aborted&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;detail&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Failed process was running: copy pgbench_accounts from stdin with (freeze on)&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;backend_type&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postmaster&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ã€ la suite de quoi, lâ€™instance est arrÃªtÃ©e :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;shutting down because &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;restart_after_crash&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; is off&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;backend_type&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postmaster&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;restart_after_crash&lt;/code&gt; Ã©tant Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;off&lt;/code&gt;, lâ€™instance PostgreSQL ne va pas&#xA;redÃ©marrer automatiquement. Cela laisse la possibilitÃ© Ã  lâ€™opÃ©rateur de gÃ©rer&#xA;convenablement lâ€™instance. Ce paramÃ¨tre est fixÃ© par lâ€™opÃ©rateur, il nâ€™est pas&#xA;possible de le changer. Il fait partie des &lt;a href=&#34;https://cloudnative-pg.io/documentation/current/postgresql_conf/#fixed-parameters&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Fixed Parameters&lt;/code&gt;&lt;/a&gt;&#xA;imposÃ©s par CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;instance-manager&lt;/code&gt; donne Ã©galement quelques indications :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.138680326Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Checking for free disk space for WALs after PostgreSQL finished&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.157419701Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Detected low-disk space condition&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™opÃ©rateur va tenter de redÃ©marrer lui-mÃªme lâ€™instance. Avant de faire cela, il&#xA;vÃ©rifie sâ€™il reste de lâ€™espace disque pour les journaux de transactions.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.202130923Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Checking for free disk space for WALs before starting PostgreSQL&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Comme ce nâ€™est pas le cas, lâ€™instance ne sera pas redÃ©marrÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.222583176Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Detected low-disk space condition, avoid starting the instance&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous nous retrouvons donc avec une instance primaire arrÃªtÃ©e car son espace&#xA;disque dÃ©diÃ© aux journaux de transactions est saturÃ© ğŸ˜¨. Lâ€™instance secondaire&#xA;attend quant Ã  elle toujours un journal de transactions &#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;&#34;message&#34;: &#34;waiting for WAL to become available at 2/5283F7F3&#34;&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Notez donc quâ€™en cas de saturation du volume de stockage, lâ€™opÃ©rateur ne&#xA;dÃ©clenche pas de bascule sur le secondaire. Avant toute chose, il faut&#xA;rÃ©soudre ce problÃ¨me dâ€™espace disque.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;agrandissement-du-volume&#34;&gt;Agrandissement du volume&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour revenir Ã  une situation normale, nous devons faire deux choses. La&#xA;premiÃ¨re est dâ€™agrandir lâ€™espace dÃ©fini dans le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PVC&lt;/code&gt; associÃ© au volume des&#xA;journaux de transactions de lâ€™instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt;. La seconde est de faire&#xA;correspondre le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.walStorage.size&lt;/code&gt; de la dÃ©finition du cluster&#xA;PostgreSQL Ã  cette nouvelle taille.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Modifier la taille dâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PVC&lt;/code&gt; Ã  chaud nâ€™est pas forcÃ©ment possible ! Il est&#xA;nÃ©cessaire que la &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Storage Class&lt;/code&gt; utilisÃ©e le permette via la fonctionnalitÃ©&#xA;de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Volume Expansion&lt;/code&gt;. Par dÃ©faut, la &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Storage Class&lt;/code&gt; utilisÃ©e est&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sbs-default&lt;/code&gt;. Câ€™est une classe de stockage fournie par le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CSI&lt;/code&gt; du fournisseur cloud. En&#xA;regardant ses informations, nous voyons quâ€™elle implÃ©mente bien cette capacitÃ© :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl describe sc sbs-default | &lt;span class=&#34;nb&#34;&gt;grep &lt;/span&gt;AllowVolumeExpansion&#xA;&lt;span class=&#34;go&#34;&gt;AllowVolumeExpansion:  True&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Comprenez donc quâ€™il sâ€™agit dâ€™un critÃ¨re essentiel Ã  prendre en compte lors du&#xA;choix du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CSI&lt;/code&gt; âš ï¸.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La modification du paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.resources.requests.storage&lt;/code&gt; du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PVC&lt;/code&gt;&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1-wal&lt;/code&gt; est donc possible Ã  chaud. 1 Go de plus devrait suffire.&#xA;Il ne reste plus quâ€™Ã  modifier la valeur de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.walStorage.size&lt;/code&gt; Ã  5 Go et de&#xA;rÃ©appliquer la dÃ©finition de notre cluster.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt; va redÃ©marrer et, contrairement Ã  tout Ã  lâ€™heure, la&#xA;vÃ©rification de lâ€™espace disque ne bloquera plus. Lâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;instance-manager&lt;/code&gt; va Ãªtre&#xA;dÃ©marrÃ© suivi par tout le processus de redÃ©marrage de lâ€™instance PostgreSQL&#xA;jusquâ€™au fameux message de trace &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;&#34;database system is ready to accept connection&#34;&lt;/code&gt;.&#xA;Durant tout le procÃ©dÃ©, lâ€™instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt; a gardÃ© son rÃ´le de primaire,&#xA;et lâ€™instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-2&lt;/code&gt; son rÃ´le de secondaire. Nous nous retrouvons alors&#xA;dans la situation initiale.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Si vous recevez une alerte &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CRITICAL&lt;/code&gt; sur un volume dÃ©diÃ© aux WALs, vous savez&#xA;maintenant de quoi il en retourne. Vous serez trÃ¨s probablement confrontÃ©s Ã  la&#xA;saturation de lâ€™un ou lâ€™autre de vos &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistant Volumes&lt;/code&gt;. PrÃ©parez-vous Ã  cela&#xA;et ayez en tÃªte les diffÃ©rentes Ã©tapes Ã  suivre pour rÃ©soudre ce problÃ¨me.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avant de dÃ©ployer des instances dans Kubernetes, prenez le temps de bien&#xA;choisir le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CSI&lt;/code&gt; que vous utiliserez notamment sur les fonctionnalitÃ©s quâ€™il&#xA;possÃ¨de. La fonctionnalitÃ© de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Volume Expansion&lt;/code&gt; est un &lt;em&gt;must have&lt;/em&gt; !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[Commentaire-Blog] CloudNativePG&#34;&gt;Ã‰crivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 18 - Suppression de jointures inutiles</title>
    <updated>2025-03-07T06:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-03-07://2025/03/07/postgresql-18-self_join_elimination.html</id>
    <link href="https://blog.dalibo.com//2025/03/07/postgresql-18-self_join_elimination.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Reviers, le 7 mars 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fonctionnalitÃ© mâ€™avait beaucoup impressionnÃ© en version 9.0, bien quâ€™elle&#xA;ait Ã©tÃ© Ã©clipsÃ©e par la grande nouveautÃ©, la rÃ©plication en natif. Cette&#xA;fonctionnalitÃ© avait pour but de supprimer les jointures inutiles. En fait, seul&#xA;un cas de jointure inutile dans un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;LEFT JOIN&lt;/code&gt; Ã©tait traitÃ©. Depuis, beaucoup de&#xA;patchs ont circulÃ© pour dÃ©tecter dâ€™autres cas, mais aucun nâ€™a passÃ© la sÃ©lection&#xA;jusquâ€™Ã  la semaine derniÃ¨re. La nouveautÃ© concerne les jointures dâ€™une table sur&#xA;elle-mÃªme. Câ€™est ce que je vais dÃ©tailler dans cet article.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/portrait_guillaume.png&#34; alt=&#34;Guillaume Lelarge&#34; style=&#34;float: right; padding:10px; width:120px;&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Prenons cette requÃªte de jointure dâ€™une table avec elle-mÃªme :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1bis&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1bis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Sans contrainte particuliÃ¨re sur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;c1&lt;/code&gt;, cette jointure ne peut Ãªtre Ã©ludÃ©e. Cependant, si les&#xA;valeurs de la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;c1&lt;/code&gt; sont uniques, le moteur nâ€™a pas besoin de rÃ©aliser la jointure&#xA;pour obtenir le rÃ©sultat.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous allons prendre ce jeu de testÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_000_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;VACUUM&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Voici le plan dâ€™exÃ©cution de la premiÃ¨re requÃªte en version 17Â :&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-file&#34;&gt;Hash Join  (cost=30832.00..59603.01 rows=1000000 width=8)&#xA;  Hash Cond: (t1.c1 = t1bis.c1)&#xA;  -&amp;gt;  Seq Scan on t1  (cost=0.00..14425.00 rows=1000000 width=4)&#xA;  -&amp;gt;  Hash  (cost=14425.00..14425.00 rows=1000000 width=4)&#xA;        -&amp;gt;  Seq Scan on t1 t1bis  (cost=0.00..14425.00 rows=1000000 width=4)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;La jointure est bien rÃ©alisÃ©e. Et voici maintenant le plan dâ€™exÃ©cution en version 18Â :&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-file&#34;&gt;Seq Scan on t1 t1bis  (cost=0.00..14425.00 rows=1000000 width=8)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Il nâ€™y a plus trace de la jointure. Le coÃ»t est de ce fait infÃ©rieur et la durÃ©e dâ€™exÃ©cution lâ€™est aussiÂ : 530Â ms en&#xA;version 17, contre 185Â ms en version 18. De plus, la durÃ©e&#xA;dâ€™optimisation/planification de la requÃªte est elle aussi infÃ©rieure avec cette&#xA;optimisation : 0,20Â ms contre 0,06Â ms.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans le cas oÃ¹ la contrainte nâ€™est plus une clÃ© primaire, mais une simple&#xA;contrainte dâ€™unicitÃ©, le plan en sera un peu impactÃ©Â :&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-file&#34;&gt;Seq Scan on t1 t1bis  (cost=0.00..14425.00 rows=1000000 width=8)&#xA;  Filter: (c1 IS NOT NULL)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;En effet, le filtre est nÃ©cessaire pour respecter la requÃªte dâ€™origine. Ce&#xA;filtre supplÃ©mentaire a un petit impact sur la durÃ©e dâ€™exÃ©cution de la requÃªte,&#xA;Ã©tant donnÃ© quâ€™elle passe Ã  220Â ms.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est Ã  noter que cette optimisation fonctionne aussi avec dâ€™autres formes de&#xA;cette requÃªte, par exempleÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;EXISTS&lt;/span&gt;&#xA;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1bis&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1bis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&#xA;  &lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Enfin, il faut savoir que cette optimisation est dÃ©brayable en configurant le&#xA;paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;enable_self_join_elimination&lt;/code&gt; Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;off&lt;/code&gt; en sachant quâ€™il est Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;on&lt;/code&gt; par&#xA;dÃ©faut.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour terminer, il est Ã©vident quâ€™il est prÃ©fÃ©rable de bien Ã©crire les requÃªtes&#xA;mais quand lâ€™application qui exÃ©cute la requÃªte est propriÃ©taire, il nâ€™est pas&#xA;possible de modifier les requÃªtes exÃ©cutÃ©es. Quand un dÃ©veloppeur utilise un&#xA;ORM, il nâ€™a pas toujours la possibilitÃ© de changer la requÃªte exÃ©cutÃ©e par&#xA;lâ€™ORM. Et enfin, ce genre de requÃªte peut aussi provenir de plusieurs vues&#xA;imbriquÃ©es qui finissent par en arriver Ã  ce genre dâ€™aberration.&#xA;Cette optimisation qui semble si Ã©vidente nâ€™est pas du tout triviale : le&#xA;&lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=fc069a3a6319b5bf40d2f0f1efceae1c9b7a68a8&#34;&gt;commit&lt;/a&gt;&#xA;a vingt-trois contributeurs, dont les plus aguerris des dÃ©veloppeurs de PostgreSQL,&#xA;et &lt;a href=&#34;https://www.postgresql.org/message-id/flat/64486b0b-0404-e39e-322d-0801154901f3%40postgrespro.ru&#34;&gt;la discussion avait dÃ©marrÃ© en 2018&lt;/a&gt; !&#xA;&lt;!--&#xA;   vim: spelllang=fr spell&#xA;--&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Linux Pratique - Maintenance dâ€™une instance PostgreSQL</title>
    <updated>2025-03-03T06:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-03-03://2025/03/03/lp6.html</id>
    <link href="https://blog.dalibo.com//2025/03/03/lp6.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Reviers, 3 mars 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois un &lt;a href=&#34;https://blog.dalibo.com/2024/06/07/lp1.html&#34;&gt;serveur PostgreSQL&#xA;installÃ©&lt;/a&gt;, plusieurs thÃ©matiques&#xA;sont Ã  prendre en considÃ©ration : la&#xA;&lt;a href=&#34;https://blog.dalibo.com/2024/09/09/lp3.html&#34;&gt;sauvegarde&lt;/a&gt;, la&#xA;&lt;a href=&#34;https://blog.dalibo.com/2024/11/18/lp4.html&#34;&gt;supervision&lt;/a&gt; et la maintenance.&#xA;Câ€™est ce dernier point que nous allons voir dans cet article.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/lp144.jpg&#34; alt=&#34;Linux Pratique 144&#34; style=&#34;float: right; padding: 10px; width: 300px;&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il existe principalement deux types de maintenance Ã  rÃ©aliser sur un serveur&#xA;PostgreSQL. Ils visent uniquement Ã  prÃ©server de bonnes performances du systÃ¨me&#xA;de bases de donnÃ©es. Il est question de lutter contre une fragmentation trop&#xA;importante des tables et des index (pour Ã©viter une surconsommation des accÃ¨s&#xA;disques et mÃ©moires), et il est question de sâ€™assurer dâ€™avoir de bonnes&#xA;statistiques sur les donnÃ©es (pour avoir de bons plans dâ€™exÃ©cution, et ainsi de&#xA;bonnes performances des requÃªtes). Cet article commence par expliquer ces types&#xA;de maintenance, puis aborde la question de sa mise en place et de son&#xA;automatisation.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;mise-Ã -jour-des-statistiques-sur-les-donnÃ©es&#34;&gt;Mise Ã  jour des statistiques sur les donnÃ©es&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Câ€™est certainement le point le moins problÃ©matique et le plus comprÃ©hensible.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour crÃ©er un plan dâ€™exÃ©cution, lâ€™optimiseur de requÃªtes de PostgreSQL se base&#xA;notamment sur des statistiques sur les donnÃ©es. Par exemple, pour choisir entre&#xA;un parcours de table et un parcours dâ€™index, le ratio de valeurs filtrÃ©es est&#xA;une information importante. Plus ce ratio sera faible (c.-Ã -d. grand nombre de&#xA;lignes filtrÃ©es, peu de lignes renvoyÃ©es), plus un index sera intÃ©ressant pour&#xA;les performances. Mais pour avoir cette information du ratio, il faut avoir une&#xA;idÃ©e ou un rÃ©sumÃ© des donnÃ©es contenues dans chaque colonne. Pour cela,&#xA;PostgreSQL peut calculer, enregistrer et utiliser des statistiques sur ces&#xA;donnÃ©es. La commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt; a pour responsabilitÃ© de gÃ©nÃ©rer ces&#xA;statistiques.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour le calcul des statistiques, un Ã©chantillon des lignes de la table est pris&#xA;en compte. Cet Ã©chantillon (en nombre de lignes) correspond au rÃ©sultat de la&#xA;multiplication de la valeur du paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;default_statistics_target&lt;/code&gt; avec une&#xA;valeur en dur (300). Ce paramÃ¨tre vaut 100 par dÃ©faut, lâ€™Ã©chantillon par dÃ©faut&#xA;est donc de 30000 lignes. Ces lignes sont prises au hasard, chacune dans un&#xA;bloc diffÃ©rent. Donc &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt; lit par dÃ©faut 30000 blocs pour chaque table&#xA;(tout du moins pour les tables qui ont au moins 30000 blocs).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour chacune de ces lignes, la commande calcule les statistiques de chaque&#xA;colonne de la table, et les enregistre dans le catalogue systÃ¨me&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_statistic&lt;/code&gt;. Depuis la version 10, il peut aussi calculer des statistiques&#xA;sur le contenu de plusieurs colonnes. Nous parlons alors de statistiques&#xA;Ã©tendues, enregistrÃ©es dans les catalogues systÃ¨mes &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_statistic_ext&lt;/code&gt; et&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_statistic_ext_data&lt;/code&gt;. Il est possible de regarder le contenu de ces&#xA;catalogues, mais câ€™est difficilement comprÃ©hensible pour un humain. Il est&#xA;prÃ©fÃ©rable de passer par les vues &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stats&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stats_ext&lt;/code&gt;, qui ont Ã©tÃ©&#xA;spÃ©cialement crÃ©Ã©es pour Ãªtre plus facilement apprÃ©hendables.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Revenons Ã  lâ€™Ã©chantillon. Plus il est grand, plus les statistiques seront&#xA;prÃ©cises. Cependant, plus il est grand, plus lâ€™opÃ©ration dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt; sera&#xA;longue. Et cela peut paraÃ®tre contre-intuitif, mais avoir plus de statistiques&#xA;va demander plus de travail Ã  lâ€™optimiseur qui mettra donc plus de temps Ã &#xA;proposer un plan dâ€™exÃ©cution. Donc un Ã©chantillon plus grand nâ€™est pas&#xA;automatiquement une bonne chose. Il faut faire la balance entre les gains sur&#xA;les plans gÃ©nÃ©rÃ©s et les pertes dues au calcul et Ã  lâ€™optimisation plus longue.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;MÃªme si la configuration basique est globale sur toutes les tables,&#xA;lâ€™Ã©chantillon nâ€™a en fait aucun intÃ©rÃªt dâ€™Ãªtre le mÃªme pour toutes les tables.&#xA;Chaque colonne de chaque table peut avoir une distribution spÃ©cifique des&#xA;donnÃ©es, et il pourrait donc Ãªtre prÃ©fÃ©rable de spÃ©cifier cette configuration&#xA;par colonne, voire par table. MÃªme sâ€™il nâ€™est actuellement pas possible de la&#xA;spÃ©cifier par table, il est possible de le faire par colonne avec la commande&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ALTER TABLE&lt;/code&gt;. Par exemple :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;ALTER TABLE t1 ALTER COLUMN c1 SET STATISTICS 200;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Les statistiques sont calculÃ©es Ã  lâ€™exÃ©cution de la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;. Au fur&#xA;et Ã  mesure des Ã©critures dans la base, les statistiques vont devenir obsolÃ¨tes&#xA;et il sera nÃ©cessaire de les calculer Ã  nouveau. Autrement dit, il est&#xA;essentiel dâ€™exÃ©cuter pÃ©riodiquement cette commande. La frÃ©quence de son&#xA;exÃ©cution dÃ©pend principalement de la frÃ©quence des requÃªtes dâ€™Ã©criture de&#xA;donnÃ©es (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;COPY&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DELETE&lt;/code&gt;) ou plus exactement du nombre de&#xA;lignes impactÃ©es par ces requÃªtes.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;lutte-contre-la-fragmentation&#34;&gt;Lutte contre la fragmentation&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Au fil de lâ€™utilisation dâ€™une base de donnÃ©es de PostgreSQL, les tables&#xA;deviennent de plus en plus volumineuses si aucune opÃ©ration de maintenance&#xA;nâ€™est rÃ©alisÃ©e. En effet, lors dâ€™opÃ©rations de mise Ã  jour ou de suppression de&#xA;lignes dans une table, les lignes concernÃ©es ne sont pas supprimÃ©es directement&#xA;du fichier correspondant Ã  cette table. Cela ralentirait beaucoup les Ã©critures&#xA;si la suppression physique Ã©tait immÃ©diate. De plus, les lignes sont conservÃ©es&#xA;pour la session qui les a supprimÃ©es au cas oÃ¹ celle-ci devrait annuler la&#xA;suppression. Elles sont aussi conservÃ©es pour le cas oÃ¹ dâ€™autres sessions&#xA;exÃ©cuteraient des lectures de la mÃªme table tant que la session qui supprime&#xA;ces lignes nâ€™a pas validÃ© sa transaction. MÃªme si cette transaction est&#xA;validÃ©e, les lignes sont conservÃ©es au cas oÃ¹ les autres sessions utilisent un&#xA;niveau transactionnel qui leur permet toujours de voir ces anciennes lignes.&#xA;Bref, il existe plein de cas oÃ¹ ces lignes mises Ã  jour ou supprimÃ©es doivent&#xA;rester accessibles Ã  certaines sessions.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Entrons un peu plus dans le dÃ©tail des diffÃ©rentes opÃ©rations dâ€™Ã©criture. En&#xA;cas dâ€™insertion (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt; ou &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;COPY&lt;/code&gt;), soit il existe un emplacement de libre&#xA;dans un bloc de fichier, auquel cas la nouvelle ligne est enregistrÃ©e Ã  cet&#xA;emplacement, soit il nâ€™en existe pas de libre, ce qui cause lâ€™ajout dâ€™un&#xA;nouveau bloc, et lâ€™enregistrement de la nouvelle ligne dans ce nouveau bloc.&#xA;Lâ€™index est modifiÃ© pour rÃ©fÃ©rencer la nouvelle ligne.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En cas de suppression (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DELETE&lt;/code&gt;), la ligne ciblÃ©e est indiquÃ©e comme supprimÃ©e&#xA;dans le fichier de la table. Lâ€™index nâ€™est pas touchÃ© et rÃ©fÃ©rence donc&#xA;toujours lâ€™ancienne ligne.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En cas de mise Ã  jour (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt;), PostgreSQL ne met pas Ã  jour la ligne ciblÃ©e.&#xA;Il fait lâ€™Ã©quivalent dâ€™un Copy-On-Write, autrement dit une copie de la ligne&#xA;est effectuÃ©e dans le fichier de la table, la copie contient la nouvelle&#xA;(version de cette) ligne avec les donnÃ©es modifiÃ©es, lâ€™ancienne (version de&#xA;cette) ligne est toujours prÃ©sente avec les anciennes donnÃ©es. Comme indiquÃ©&#xA;entre parenthÃ¨ses, nous parlons plutÃ´t de version de ligne, lâ€™ancienne Ã©tant la&#xA;version originale, la nouvelle Ã©tant la version modifiÃ©e. Cette nouvelle&#xA;version est enregistrÃ©e comme toute nouvelle ligne. Donc, avec PostgreSQL, un&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt; est lâ€™exact Ã©quivalent dâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DELETE&lt;/code&gt; de la ligne actuelle, suivi dâ€™un&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt; de la ligne avec les donnÃ©es modifiÃ©es. De ce fait, lâ€™index se voit&#xA;ajouter (gÃ©nÃ©ralement) une nouvelle rÃ©fÃ©rence Ã  cette ligne, mais avec un&#xA;pointeur indiquant lâ€™emplacement de la nouvelle ligne, tout en conservant le&#xA;pointeur vers lâ€™ancienne ligne.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Jâ€™ai indiquÃ© Â«Â lâ€™indexÂ Â». Câ€™est Ã©videmment Ã  condition quâ€™il y ait un index sur cette table, et sâ€™il y en a plusieurs, tous sont pris en compte, Ã  quelques subtilitÃ©s prÃ¨s (index partiel, mise Ã  jour HOT).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous nous retrouvons donc avec des lignes dÃ©clarÃ©es comme supprimÃ©es dans le&#xA;fichier, mais bien physiquement prÃ©sentes dans le fichier. Pendant un moment,&#xA;elles restent visibles par certaines transactions. Cependant, au bout dâ€™un&#xA;moment, toutes les transactions qui voyaient encore ces lignes se terminent. Ã€&#xA;ce moment-lÃ , aucune transaction ne peut voir ces lignes supprimÃ©es. Elles sont&#xA;pourtant toujours prÃ©sentes dans le fichier de la table et il existe toujours&#xA;des rÃ©fÃ©rences dans lâ€™index qui pointent vers ces lignes. Pour ne pas perdre du&#xA;temps Ã  chaque opÃ©ration dâ€™Ã©criture dans la table, les dÃ©veloppeurs de&#xA;PostgreSQL ont dÃ©cidÃ© quâ€™il faudrait exÃ©cuter une opÃ©ration spÃ©cifique pour&#xA;trouver les lignes supprimÃ©es visibles par aucune session et les marquer dâ€™une&#xA;faÃ§on particuliÃ¨re indiquant quâ€™il est possible de rÃ©utiliser lâ€™espace quâ€™elles&#xA;occupent. Cette opÃ©ration sâ€™exÃ©cute en utilisant lâ€™instruction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette opÃ©ration rÃ©alise trois Ã©tapes :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;rÃ©cupÃ©ration de la liste des lignes actuellement invisibles par toutes les&#xA;transactions en cours ;&lt;/li&gt;&#xA;  &lt;li&gt;suppression des rÃ©fÃ©rences de ces lignes dans les index de la table ;&lt;/li&gt;&#xA;  &lt;li&gt;mise Ã  jour du fichier FSM indiquant les espaces libres rÃ©utilisables.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Ces trois Ã©tapes peuvent Ãªtre exÃ©cutÃ©es plusieurs fois sâ€™il nâ€™est pas possible&#xA;de conserver en mÃ©moire lâ€™ensemble des lignes invisibles. La mÃ©moire utilisÃ©e&#xA;pour cela dÃ©pend de la valeur du paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;maintenance_work_mem&lt;/code&gt;, sachant que&#xA;lâ€™opÃ©ration &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt; ne pourra pas utiliser plus de 1 Go (ce qui reprÃ©sente&#xA;quand mÃªme 178 millions de lignes mortes).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois cette opÃ©ration effectuÃ©e, un fichier FSM est prÃ©sent sur disque. Tout&#xA;nouvel ajout de ligne (suite Ã  un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;COPY&lt;/code&gt; ou &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt;) lira ce fichier&#xA;pour trouver oÃ¹ placer la nouvelle ligne. Ceci permet dâ€™utiliser les espaces&#xA;rendus disponibles et Ã©vite de faire grossir le fichier de la table.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans la majoritÃ© des cas, le nettoyage de la table et des index ne permet pas&#xA;aux fichiers de ces objets de perdre en volumÃ©trie. Il permet principalement de&#xA;renseigner la structure FSM pour savoir oÃ¹ Ã©crire sans faire grossir le&#xA;fichier. Cependant, si un ou plusieurs blocs en toute fin de fichier sont&#xA;complÃ¨tement libÃ©rÃ©s de leurs lignes et quâ€™il est possible dâ€™obtenir rapidement&#xA;un verrou exclusif sur la table, lâ€™opÃ©ration &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt; pourra tronquer le&#xA;fichier pour rendre ces blocs au systÃ¨me de fichiers. De mon expÃ©rience, cela&#xA;est suffisamment peu frÃ©quent pour Ãªtre visible.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour ce qui est de lâ€™utilisation de lâ€™instruction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;, celle-ci peut viser&#xA;spÃ©cifiquement une table si son nom est indiquÃ©. Par exemple, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM t1&lt;/code&gt;&#xA;permettra de traiter la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt;. Si aucune table nâ€™est indiquÃ©e, toutes les&#xA;tables de la base seront traitÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™instruction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt; accepte plusieurs options. Vu le nombre (14 !), nous&#xA;nâ€™allons pas les citer toutes ici. La plus frÃ©quemment utilisÃ©e est lâ€™option&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;, qui permet de profiter des lectures de la table pour en plus mettre&#xA;Ã  jour les statistiques sur les donnÃ©es, Ã  lâ€™image de lâ€™instruction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PARALLEL&lt;/code&gt; permet de parallÃ©liser le traitement des index dâ€™une table&#xA;sur plusieurs CPU, avec un CPU par index. Câ€™est particuliÃ¨rement intÃ©ressant&#xA;pour les tables volumineuses dotÃ©es de nombreux index.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Mais lâ€™option la plus frÃ©quemment Ã©voquÃ©e est lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;FULL&lt;/code&gt;. Cette option&#xA;change complÃ¨tement le travail de la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;, et on peut se&#xA;questionner sur le bien-fondÃ© de ne pas avoir crÃ©Ã© une instruction spÃ©cifique&#xA;pour cette opÃ©ration. En utilisant lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;FULL&lt;/code&gt;, nous forÃ§ons la rÃ©Ã©criture&#xA;complÃ¨te de la table et de ses index, ce qui aura pour consÃ©quence une&#xA;diminution sur disque de la volumÃ©trie des fichiers associÃ©s Ã  ces objets.&#xA;Cette opÃ©ration a cependant deux gros inconvÃ©nients : les objets sont&#xA;totalement verrouillÃ©s pendant cette opÃ©ration (donc lâ€™Ã©criture et la lecture&#xA;par dâ€™autres processus sont bloquÃ©s le temps du traitement), et il est&#xA;essentiel dâ€™avoir la place nÃ©cessaire pour les nouveaux fichiers le temps du&#xA;traitement (lâ€™estimation de la place nÃ©cessaire est trÃ¨s basique : comptez&#xA;exactement la mÃªme volumÃ©trie que la table et ses index occupent avant&#xA;lâ€™opÃ©ration).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une autre opÃ©ration fait Ã  peu prÃ¨s la mÃªme chose : &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLUSTER&lt;/code&gt;. La seule&#xA;diffÃ©rence avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM FULL&lt;/code&gt; est que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLUSTER&lt;/code&gt; trie en plus les donnÃ©es avant&#xA;de les stocker dans le nouveau fichier de table. Le tri se fait par rapport au&#xA;tri dâ€™un index. Il faut donc indiquer Ã  lâ€™instruction la table Ã  traiter et&#xA;lâ€™index Ã  suivre.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;VoilÃ  pour ce qui est des tables, mais les index peuvent aussi se fragmenter.&#xA;Ils sont toujours correctement balancÃ©s, mais les blocs du fichier de lâ€™index&#xA;peuvent ne pas Ãªtre remplis. Dans ce cas, il convient de les rÃ©indexer.&#xA;Lâ€™opÃ©ration est aussi lente que leur crÃ©ation, elle est aussi bloquante (pas de&#xA;lecture de lâ€™index, pas dâ€™Ã©criture dans la table associÃ©e). Cette opÃ©ration&#xA;utilise lâ€™instruction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;REINDEX&lt;/code&gt;. Il est possible de rÃ©indexer un seul index&#xA;(&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;REINDEX INDEX i1;&lt;/code&gt;), tous les index dâ€™une table (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;REINDEX TABLE t1;&lt;/code&gt;), tous&#xA;les index dâ€™un schÃ©ma (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;REINDEX SCHEMA s1;&lt;/code&gt;), tous les index dâ€™une base&#xA;(&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;REINDEX;&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette instruction accepte deux options : &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CONCURRENTLY&lt;/code&gt; (pour Ã©viter le verrou&#xA;sur les Ã©critures dans la table, ce qui a pour consÃ©quence une opÃ©ration plus&#xA;longue et le risque dâ€™obtenir au final un index invalide) et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;TABLESPACE&lt;/code&gt; (pour&#xA;placer le nouveau fichier de lâ€™index dans un autre tablespace).&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;comment-savoir-quun-objet-est-fragmentÃ©&#34;&gt;Comment savoir quâ€™un objet est fragmentÃ©&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Il existe deux moyens. Les deux sont Ã  utiliser.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le premier est une estimation. Il permet dâ€™avoir rapidement une idÃ©e de la&#xA;fragmentation. Cette estimation se base notamment sur les statistiques sur les&#xA;donnÃ©es et elle sera dâ€™autant plus fiable que ces statistiques sont rÃ©centes.&#xA;Deux groupes de requÃªtes sont disponibles, le premier pour les tables, le&#xA;second pour les index Btree. Les autres mÃ©thodes dâ€™indexation ne sont donc pas&#xA;couvertes, cependant le Btree est la mÃ©thode par dÃ©faut et la plus couramment&#xA;utilisÃ©e. Ces requÃªtes sont disponibles dans le &lt;a href=&#34;https://github.com/ioguix/pgsql-bloat-estimation/&#34;&gt;dÃ©pÃ´t GitHub&#xA;pgsql-bloat-estimation&lt;/a&gt;.&#xA;GÃ©nÃ©ralement, je place ces requÃªtes dans des vues pour une utilisation&#xA;facilitÃ©e. Cela me donnerait par exemple cette requÃªte pour trouver les 20&#xA;tables les plus fragmentÃ©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;SELECT quote_ident(schemaname)||&#39;.&#39;||quote_ident(tblname) AS table,&#xA;       real_size AS taille,&#xA;       bloat_size AS taille_fragmentation,&#xA;       round(bloat_pct::numeric, 2) AS ratio_fragmentation&#xA;FROM v_table_bloat&#xA;ORDER BY bloat_size DESC&#xA;LIMIT 20;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le second est une extension (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgstattuple&lt;/code&gt;) qui donnera une information exacte.&#xA;Cependant, pour donner une information exacte, les fonctions quâ€™elle propose&#xA;doivent parcourir les objets entiers, ce qui se rÃ©vÃ¨le trÃ¨s lent par rapport&#xA;aux requÃªtes citÃ©es prÃ©cÃ©demment. Lâ€™extension a Ã©tÃ© mise Ã  jour rÃ©cemment pour&#xA;proposer une fonction dâ€™approximation qui se base, elle, sur le contenu de la&#xA;Visibility Map et sur le contenu de la Free Space Map. Voici un exemple de&#xA;requÃªte utilisant la fonction exacte pour rÃ©cupÃ©rer lÃ  aussi les 20 tables les&#xA;plus fragmentÃ©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;SELECT quote_ident(n.nspname)||&#39;.&#39;||quote_ident(c.relname) AS table,&#xA;       s.table_len AS taille,&#xA;       s.dead_tuple_len AS taille_invisibles,&#xA;       s.free_space AS taille_libre&#xA;FROM pg_class c&#xA;  JOIN pg_namespace n ON n.oid=c.relnamespace,&#xA;  LATERAL pgstattuple(c.oid) s&#xA;WHERE c.relkind=&#39;r&#39;&#xA;ORDER BY s.dead_tuple_len DESC&#xA;LIMIT 20;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;et celle utilisant la fonction dâ€™approximation :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;SELECT quote_ident(n.nspname)||&#39;.&#39;||quote_ident(c.relname) AS table,&#xA;       s.table_len AS taille,&#xA;       s.dead_tuple_len AS taille_invisibles,&#xA;       s.approx_free_space AS taille_libre&#xA;FROM pg_class c&#xA;  JOIN pg_namespace n ON n.oid=c.relnamespace,&#xA;  LATERAL pgstattuple_approx(c.oid) s&#xA;WHERE c.relkind=&#39;r&#39;&#xA;ORDER BY s.dead_tuple_len DESC&#xA;LIMIT 20;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette extension dispose aussi de fonctions pour tester les index des mÃ©thodes&#xA;dâ€™accÃ¨s Btree, GIN et Hash.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour revenir au dÃ©but de ce chapitre, je disais quâ€™il fallait utiliser les&#xA;deux, sans expliquer pourquoi. Les fonctions exactes sont trop longues si vous&#xA;voulez les exÃ©cuter frÃ©quemment sur des bases de grosse volumÃ©trie. Une&#xA;stratÃ©gie intÃ©ressante est dâ€™utiliser les vues ou fonctions dâ€™estimation pour&#xA;avoir une idÃ©e des objets les plus fragmentÃ©s et dâ€™utiliser les fonctions&#xA;exactes uniquement sur les tables suffisamment fragmentÃ©es pour valider ou non&#xA;les informations des estimations. Cela permet de connaÃ®tre les tables Ã  traiter&#xA;rÃ©ellement.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En ce qui concerne la supervision, il peut Ãªtre intÃ©ressant de suivre la&#xA;volumÃ©trie de la base et sa fragmentation. Cela peut se faire avec la requÃªte&#xA;suivanteÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;SELECT &#39;volumÃ©trie de la base&#39; AS &#34;Type&#34;, pg_size_pretty(pg_database_size(current_database())) AS &#34;Size&#34;&#xA;UNION&#xA;SELECT &#39;volumÃ©trie de la fragmentation des tables&#39;, pg_size_pretty(sum(bloat_size)::numeric) FROM v_table_bloat&#xA;UNION&#xA;SELECT &#39;volumÃ©trie de la fragmentation des index&#39;, pg_size_pretty(sum(bloat_size)::numeric) FROM v_index_bloat;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ceci nâ€™est quâ€™un exemple, qui sera facile Ã  adapter le cas Ã©chÃ©ant.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;comment-exÃ©cuter-les-opÃ©rations-de-maintenance&#34;&gt;Comment exÃ©cuter les opÃ©rations de maintenance&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une exÃ©cution manuelle est possible, mais ne convient quâ€™en de rares cas.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est prÃ©fÃ©rable dâ€™automatiser ces opÃ©rations. Les dÃ©veloppeurs de PostgreSQL&#xA;en ont automatisÃ© certaines en dÃ©veloppant un sous-processus appelÃ© autovacuum.&#xA;Ce sous-processus va traiter chacune des bases de lâ€™instance et dÃ©clenchera si&#xA;besoin des opÃ©rations &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;. Ce besoin est dÃ©tectÃ© en se basant&#xA;sur le nombre de lignes insÃ©rÃ©es, modifiÃ©es et supprimÃ©es pour lâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt; et&#xA;sur le nombre de lignes mortes pour le VACUUM. Ces informations font partie des&#xA;statistiques dâ€™activitÃ© rÃ©cupÃ©rÃ©es en temps rÃ©el par PostgreSQL. Une&#xA;configuration permet dâ€™indiquer Ã  partir de quel ratio de lignes nous&#xA;souhaitons voir ces opÃ©rations dÃ©clenchÃ©es. Ces ratios sont par dÃ©faut trÃ¨s&#xA;haut, ce qui fait que peu dâ€™opÃ©rations sont dÃ©clenchÃ©es, mais il est possible&#xA;de les diminuer globalement ou table par table si vos bases subissent beaucoup&#xA;dâ€™Ã©criture.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les paramÃ¨tres les plus importants de ce sous-processus sontÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum_analyze_scale_factor&lt;/code&gt;, ratio de lignes Ã©crites avant de lancer&#xA;un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum_analyze_threshold&lt;/code&gt;, nombre minimum de lignes Ã©crites avant de&#xA;lancer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum_vacuum_scale_factor&lt;/code&gt;, ratio de lignes mortes avant de lancer un&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum_vacuum_threshold&lt;/code&gt;, nombre minimum de lignes mortes avant de&#xA;lancer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum_vacuum_insert_scale_factor&lt;/code&gt;, ratio de lignes insÃ©rÃ©es avant de&#xA;lancer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum_vacuum_insert_threshold&lt;/code&gt;, ratio de lignes insÃ©rÃ©es avant de&#xA;lancer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Le sous-processus autovacuum calcule donc la valeur cible en additionnant le&#xA;nombre minimum et le ratio multipliÃ© par le nombre de lignes, et compare cette&#xA;valeur cible au nombre de lignes mortes pour le cas dâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;. Si le nombre&#xA;de lignes mortes dÃ©passe la valeur cible, lâ€™autovacuum lance un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt; sur la&#xA;table concernÃ©e. Par dÃ©faut, le ratio est de 20Â %. Sur une petite table, ce&#xA;nâ€™est pas Ã©norme. Sur une table volumineuse par contre, le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt; ne sera&#xA;lancÃ© que trÃ¨s peu frÃ©quemment.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour le dire autrement, pour une table de 100 Go, il faudra attendre 20 Go de&#xA;fragmentation pour exÃ©cuter un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;. Ce nâ€™est pas bon, il aurait fallu le&#xA;lancer bien avant. Câ€™est pour cela quâ€™il est gÃ©nÃ©ralement conseillÃ© de&#xA;descendre ce ratio et de le faire table par table pour prendre en compte leur&#xA;utilisation, leur fragmentation actuelle. Il est mÃªme parfois intÃ©ressant de&#xA;placer Ã  zÃ©ro le ratio et de ne prendre en compte que le nombre minimum de&#xA;lignes, pour se baser sur un volume fixe de fragmentation.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cependant, une configuration aussi dÃ©taillÃ©e demande du temps et des&#xA;connaissances. Le plus simple, dans un premier temps, est certainement de&#xA;diminuer les valeurs par dÃ©faut de maniÃ¨re globale. Il est frÃ©quemment&#xA;conseillÃ© de diviser les ratios pour 10.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est Ã  noter que lâ€™autovacuum ne fait ni &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM FULL&lt;/code&gt;, ni &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;REINDEX&lt;/code&gt;. La&#xA;raison en est que ces opÃ©rations nÃ©cessitent un verrou exclusif qui est&#xA;bloquant pour les autres sessions en cours dâ€™exÃ©cution. Cela va donc gÃ©nÃ©rer de&#xA;fortes contentions Ã  des moments gÃ©nÃ©ralement trÃ¨s actifs. Ces deux opÃ©rations&#xA;sont plutÃ´t Ã  lancer manuellement, quand le besoin sâ€™en fait sentir ou quand il&#xA;est prÃ©vu une fenÃªtre de maintenance oÃ¹ il nâ€™y aura pas dâ€™autres accÃ¨s Ã  la&#xA;base.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans les autres paramÃ¨tres intÃ©ressants, notons &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum_work_mem&lt;/code&gt;. Ce&#xA;dernier a le mÃªme but que le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;maintenance_work_mem&lt;/code&gt;, mais ne concerne&#xA;que le processus autovacuum. Ainsi, il est possible dâ€™avoir une configuration&#xA;pour ce sous-processus et une configuration pour les &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt; manuels.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;en-conclusion&#34;&gt;En conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;autovacuum est votre (meilleur) ami. Certains le dÃ©sactivent parce quâ€™il&#xA;consommerait beaucoup de ressources. Sans nier quâ€™il consomme effectivement des&#xA;ressources, il permet surtout dâ€™en sauver grÃ¢ce Ã  des statistiques Ã  jour et en&#xA;luttant contre le grossissement sans fin des tables. Dans la trÃ¨s grande&#xA;majoritÃ© des cas, le dÃ©sactiver est une erreur.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si vous prÃ©fÃ©rez passer par une exÃ©cution via cron, pourquoi pas, mais il faut&#xA;bien comprendre ce que lâ€™on fait et pourquoi.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans tous les cas, comme lâ€™a dit Robert Haas, un des principaux dÃ©veloppeurs de&#xA;PostgreSQL, lors dâ€™une confÃ©rence Ã  Prague au PGConf.EU 2024Â : â€œVacuuming is&#xA;like exercising. If it hurts, youâ€™re not doing it enough!â€ (Â«Â Le VACUUM, câ€™est&#xA;comme faire du sport. Si cela fait mal, câ€™est que vous nâ€™en faites pas&#xA;assezÂ !Â Â»).&lt;/p&gt;&#xA;&#xA;&lt;hr /&gt;&#xA;&#xA;&lt;p&gt;Depuis quelques annÃ©es, Guillaume Lelarge publie des articles dans le magazine&#xA;Â« Linux Pratique Â» Ã©ditÃ© par les Ã‰ditions Diamond. Avec leur accord, il reprend&#xA;ici une sÃ©rie destinÃ©e Ã  guider lâ€™installation, la maintenance et lâ€™utilisation&#xA;de PostgreSQL.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>La PGSession 17 en replay</title>
    <updated>2025-02-28T06:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-02-28://2025/02/28/replay_pgsession17.html</id>
    <link href="https://blog.dalibo.com//2025/02/28/replay_pgsession17.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Saint-Ã‰tienne, le 28 fÃ©vrier 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La journÃ©e ConfÃ©rences de la &lt;strong&gt;PGSession 17&lt;/strong&gt; sâ€™est tenue le 15 janvier Ã  Paris. Voici les liens vers les supports de prÃ©sentation et les vidÃ©os en replay !&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&lt;p&gt;&lt;img src=&#34;/img/pgsession17_speakers.png&#34; alt=&#34;Les confÃ©renciers de la PGSession 17&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Un grand merci aux confÃ©renciers pour leurs contributions : Matt, Julien, Pierre G., ClÃ©ment, Guillaume A., Guillaume L., LoÃ¯c, CÃ©dric, Pierre T. et Yann&lt;/strong&gt; (absent sur la photo).&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;les-confÃ©rences-en-replay&#34;&gt;Les confÃ©rences en replay&lt;/h3&gt;&#xA;&#xA;&lt;ol&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_pg17&#34;&gt;Les nouveautÃ©s de PostgreSQL 17&lt;/a&gt;&lt;/strong&gt;, par CÃ©dric Martin et Guillaume ArmÃ¨de  (Dalibo)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_powa&#34;&gt;PoWA v.5 : quoi de neuf ?&lt;/a&gt;&lt;/strong&gt;, par Julien Rouhaud (Nile) et Pierre Giraud (Dalibo)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_rex-maif&#34;&gt;Retour dâ€™expÃ©rience Client : le Socle Dalibo&lt;/a&gt;&lt;/strong&gt;, par ClÃ©ment Paillier (MAIF)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_i3g&#34;&gt;2014-2024 : les 10 ans de lâ€™Infrastructure Interne dâ€™Information GÃ©ographique&lt;/a&gt;&lt;/strong&gt;, par Yann Convers (DRÃ‰AL AuRA)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_azimutt&#34;&gt;Explorer, documenter et faire Ã©voluer ses bases de donnÃ©es avec Azimutt&lt;/a&gt;&lt;/strong&gt;, par LoÃ¯c Knuchel (Azimutt)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_usual-suspects&#34;&gt;Usual Suspects : mais qui a mis la production dans cet Ã©tat ?&lt;/a&gt;&lt;/strong&gt;, par Pierre Top (Octo Technology)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_dev-pg&#34;&gt;DÃ©veloppement dâ€™une fonctionnalitÃ© pour PostgreSQL, du besoin au commitâ€¦&lt;/a&gt;&lt;/strong&gt;, par Guillaume Lelarge (Dalibo)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://dali.bo/pgsession17_conf_recherche-hybride&#34;&gt;Observer les oiseaux autrement : la recherche hybride au service de nos amis ailÃ©s&lt;/a&gt;&lt;/strong&gt;, par Matt Cornillon (Google Cloud)&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&lt;figure style=&#34;float: right;padding: 10px;width: 250px;&#34;&gt;&#xA;  &lt;img style=&#34;padding: 0;&#34; src=&#34;/img/2023_chapeau_rouge.png&#34; alt=&#34;Chapeau rouge&#34; /&gt;&#xA;&lt;/figure&gt;&#xA;&lt;p&gt;Les autres liens utiles :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://dali.bo/pgsession17_playlist&#34;&gt;la playlist PGSession 17&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://dali.bo/pgsessions_archives&#34;&gt;les supports de prÃ©sentation&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Enfin, nous remercions chaleureusement notre prestataire &lt;strong&gt;Chapeau rouge&lt;/strong&gt; pour son accompagnement vidÃ©o, toujours efficace et sympathique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bon visionnage !&lt;/p&gt;&#xA;&#xA;&lt;hr /&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires, des suggestions ?&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã‰crivez-nous Ã  &lt;a href=&#34;mailto:contact@pgsessions.com&#34;&gt;contact@pgsessions.com&lt;/a&gt;&lt;/strong&gt;.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #4 - Les sauvegardes !</title>
    <updated>2025-02-27T06:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-02-27://2025/02/27/cnpg-3.html</id>
    <link href="https://blog.dalibo.com//2025/02/27/cnpg-3.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 27 fÃ©vrier 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;CloudNativePG&lt;/strong&gt; ou comment embarquer un Ã©lÃ©phant sur un porte-conteneurs !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les deux premiers articles Ã©taient lâ€™occasion de dÃ©couvrir lâ€™opÃ©rateur et comment&#xA;il nous aide Ã  embarquer notre Ã©lÃ©phant favori sur un porte-conteneurs ğŸ˜.&#xA;Embarquer un Ã©lÃ©phant est une chose, le repÃªcher sâ€™il tombe Ã  lâ€™eau en est une&#xA;autreâ€¦ Attaquons-nous Ã  un sujet trÃ¨s important, les sauvegardes des instances&#xA;PostgreSQL ğŸ›Ÿ !&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;un-peu-de-donnÃ©es&#34;&gt;Un peu de donnÃ©es&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour le moment nos instances ne contiennent pas grand-chose. Il est temps&#xA;dâ€™insÃ©rer quelques donnÃ©es, notamment avec lâ€™outil &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt;. Câ€™est lâ€™occasion&#xA;pour moi de prÃ©senter lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; du plugin &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;cnpg&lt;/code&gt;. &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; est un&#xA;outil trÃ¨s connu dans le monde PostgreSQL. Il permet notamment de gÃ©nÃ©rer des&#xA;jeux de tests et dâ€™effectuer des tests de charge (Ã  ce sujet, avez-vous lu notre&#xA;&lt;a href=&#34;https://blog.dalibo.com/2025/02/13/cnpg-3.html&#34;&gt;dernier article&lt;/a&gt; de blog ?).&#xA;Les mainteneurs CloudNativePG ont intÃ©grÃ© cet outil du projet cÅ“ur PostgreSQL,&#xA;dans leurs images, nous permettant ainsi de lâ€™utiliser.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg pgbench postgresql &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--initialize&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--scale&lt;/span&gt; 10 &#xA;&lt;span class=&#34;go&#34;&gt;job/postgresql-pgbench-446336 created&#xA;&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl logs job/postgresql-pgbench-446336&#xA;&lt;span class=&#34;go&#34;&gt;dropping old tables...&#xA;creating tables...&#xA;generating data (client-side)...&#xA;100000 of 1000000 tuples (10%) of pgbench_accounts done (elapsed 0.02 s, remaining 0.21 s)&#xA;200000 of 1000000 tuples (20%) of pgbench_accounts done (elapsed 0.08 s, remaining 0.30 s)&#xA;300000 of 1000000 tuples (30%) of pgbench_accounts done (elapsed 0.14 s, remaining 0.33 s)&#xA;400000 of 1000000 tuples (40%) of pgbench_accounts done (elapsed 0.20 s, remaining 0.30 s)&#xA;500000 of 1000000 tuples (50%) of pgbench_accounts done (elapsed 0.25 s, remaining 0.25 s)&#xA;600000 of 1000000 tuples (60%) of pgbench_accounts done (elapsed 0.30 s, remaining 0.20 s)&#xA;700000 of 1000000 tuples (70%) of pgbench_accounts done (elapsed 0.36 s, remaining 0.15 s)&#xA;800000 of 1000000 tuples (80%) of pgbench_accounts done (elapsed 0.44 s, remaining 0.11 s)&#xA;900000 of 1000000 tuples (90%) of pgbench_accounts done (elapsed 0.52 s, remaining 0.06 s)&#xA;1000000 of 1000000 tuples (100%) of pgbench_accounts done (elapsed 0.57 s, remaining 0.00 s)&#xA;vacuuming...&#xA;creating primary keys...&#xA;done in 0.96 s (drop tables 0.09 s, create tables 0.00 s, client-side generate 0.61 s, vacuum 0.11 s, primary keys 0.15 s).&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La commande a gÃ©nÃ©rÃ© 157 Mo de donnÃ©es dans la base &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;app&lt;/code&gt;Â (qui pour rappel, est&#xA;crÃ©Ã©e automatiquement par lâ€™opÃ©rateur)â€¦ Oui je sais ! Câ€™est une toute petite&#xA;base, mais câ€™est pour de la dÃ©mo ! Les sujets liÃ©s Ã  de la volumÃ©trie importante&#xA;arriveront plus tard ğŸ˜‡.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sauvegarde-logique&#34;&gt;Sauvegarde logique&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ã€ lâ€™heure actuelle lâ€™opÃ©rateur ne permet pas de dÃ©clencher une sauvegarde&#xA;logique de maniÃ¨re dÃ©clarative. Pour autant, dÃ¨s lors que lâ€™instance est&#xA;accessible, il est tout Ã  fait possible de crÃ©er une sauvegarde avec lâ€™outil&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_dump&lt;/code&gt; (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ou pg_dumpall&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple, si je rends mon instance accessible avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl port-forward&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;kubectl port-forward --address 0.0.0.0 postgresql-2 5432:5432&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;Forwarding from 0.0.0.0:5432 -&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;5432&#xA;&lt;span class=&#34;go&#34;&gt;Handling connection for 5432&#xA;[...]&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Je peux appeler la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_dump&lt;/code&gt;, renseigner le mot de passe et obtenir mon&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dump&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;pg_dump &lt;span class=&#34;nt&#34;&gt;-h&lt;/span&gt; localhost &lt;span class=&#34;nt&#34;&gt;-U&lt;/span&gt; app &lt;span class=&#34;nt&#34;&gt;-Fc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; sauvegarde.dump&#xA;&lt;span class=&#34;go&#34;&gt;Password:&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ls&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-lh&lt;/span&gt; sauvegarde.dump&#xA;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 pierrick pierrick 2,7M janv. 22 17:36 sauvegarde.dump&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™exposition du port 5432 de lâ€™instance est grandement facilitÃ©e par la commande&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl port-forward&lt;/code&gt;. Dans un environnement de production, la mise en Å“uvre&#xA;demandera un peu plus de travail ğŸ™ƒ.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En bref, il vous sera toujours possible dâ€™effectuer des sauvegardes logiques&#xA;dâ€™une instance dÃ©ployÃ©e par CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sauvegarde-par-volume-snapshot&#34;&gt;Sauvegarde par &lt;em&gt;Volume Snapshot&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Lâ€™opÃ©rateur supporte aussi la mÃ©thode de sauvegarde par &lt;em&gt;Volume Snapshot&lt;/em&gt;. Câ€™est&#xA;une fonctionnalitÃ© Kubernetes que ne supporte pas encore tous les&#xA;&lt;em&gt;Containers Storage Interface&lt;/em&gt; (CSI). Ce ne sera pas lâ€™objet de lâ€™article&#xA;aujourdâ€™hui, mais jetez tout de mÃªme un Å“il Ã  cette fonctionnalitÃ©&#xA;(&lt;a href=&#34;https://cloudnative-pg.io/documentation/current/backup_volumesnapshot/&#34;&gt;Backup on Volume Snapshot&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sauvegarde-physique-pitr&#34;&gt;Sauvegarde physique &lt;em&gt;PITR&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ã€ lâ€™inverse dâ€™une sauvegarde logique, qui se limite Ã  une base de donnÃ©es&#xA;spÃ©cifique, une sauvegarde physique permet de sauvegarder lâ€™instance dans sa&#xA;globalitÃ©. Le principe est de sauvegarder toute lâ€™arborescence PostgreSQL, que&#xA;ce soit les fichiers de donnÃ©es, le contenu des index, les fichiers de configuration ou les Ã©lÃ©ments&#xA;propres au fonctionnement de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si en plus de cette sauvegarde, vous archivez rÃ©guliÃ¨rement les journaux de&#xA;transactions (&lt;em&gt;WAL&lt;/em&gt;) alors vous avez mis en place une sauvegarde &lt;em&gt;PITR&lt;/em&gt; (&lt;em&gt;Point In&#xA;Time Recovery&lt;/em&gt;) qui vous permettra, en rejouant ces fichiers lÃ , de restaurer&#xA;votre instance soit complÃ¨tement, soit jusquâ€™Ã  un certain point dans le passÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;Notre formation&#xA;&lt;a href=&#34;https://public.dalibo.com/exports/formation/manuels/formations/dba3/dba3.handout.html#sauvegarde-physique-%C3%A0-chaud-et-pitr&#34;&gt;DBA3&lt;/a&gt;&#xA;traite de ce sujet de maniÃ¨re plus dÃ©taillÃ©e&lt;/em&gt; ğŸ˜.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ce petit rappel Ã©tant fait, passons au vif du sujet !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Stockage objets&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™opÃ©rateur CloudNativePG repose sur lâ€™outil &lt;a href=&#34;https://docs.pgbarman.org/release/3.13.0/user_guide/barman_cloud.html&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Barman&#xA;Cloud&lt;/code&gt;&lt;/a&gt;&#xA;pour les sauvegardes physiques et lâ€™archivage continu. Il est embarquÃ© dans&#xA;lâ€™image qui est utilisÃ©e lors de la crÃ©ation dâ€™une instance. Le stockage des&#xA;journaux et des sauvegardes se fera obligatoirement sur un systÃ¨me de stockage&#xA;objets. Cette &lt;a href=&#34;https://cloudnative-pg.io/documentation/current/appendixes/object_stores/&#34;&gt;page de&#xA;documentation&lt;/a&gt;&#xA;indique les principales solutions supportÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour cette sÃ©rie dâ€™articles, je vais utiliser la solution &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Object Storage&lt;/code&gt; de&#xA;Scaleway, compatible &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;S3&lt;/code&gt;. Les informations qui me seront nÃ©cessaires sont :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Le nom du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Bucket&lt;/code&gt; Ã  utiliser : ce sera &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;backup-postgresql&lt;/code&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;Une clÃ© dâ€™accÃ¨s API : &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;jenevaispasvousladonner&lt;/code&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;Le secret liÃ© Ã  cette clÃ© &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;encoremoinslesecret&lt;/code&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;La rÃ©gion de stockage : &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fr-par&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Ces informations lÃ  sont Ã  ajouter dans un objet &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Secret&lt;/code&gt; qui sera par la&#xA;suite renseignÃ© dans la configuration de notre instance. Les informations&#xA;doivent Ãªtre encodÃ©es en &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;BASE64&lt;/code&gt; dans le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;YAML&lt;/code&gt;. Voici un exemple de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Secret&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Secret&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3-scaleway&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Opaque&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;amVuZXZhaXNwYXN2b3VzbGFkb25uZXLCoA==&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;ACCESS_REGION&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ZnItcGFy&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;ACCESS_SECRET_KEY&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ZW5jb3JlbW9pbnNsZXNlY3JldMKg&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nâ€™oubliez pas de crÃ©er cet objet avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl apply&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Configuration&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Maintenant que nous avons un espace de stockage, voyons la configuration de&#xA;notre instance pour la mise en place de cette sauvegarde &lt;em&gt;PITR&lt;/em&gt;. Elle se fait&#xA;dans la section &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;backup.barmanObjectStore&lt;/code&gt; de notre objet &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;.&#xA;VoilÃ  Ã  quoi ressemblerait notre dÃ©finition :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;backup&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;barmanObjectStore&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;destinationPath&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;s3://backup-postgresql/&#34;&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;endpointURL&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;https://s3.fr-par.scw.cloud&#34;&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;s3Credentials&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;accessKeyId&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3-scaleway&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ACCESS_KEY_ID&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;secretAccessKey&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3-scaleway&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ACCESS_SECRET_KEY&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;region&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3-scaleway&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ACCESS_REGION&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;destinationPath&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;endpointURL&lt;/code&gt; sont propres Ã  la solution de stockage&#xA;choisie. Des exemples existent pour vous aider Ã  configurer cela&#xA;(voir la page &lt;a href=&#34;https://cloudnative-pg.io/documentation/current/samples/&#34;&gt;Samples&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lors de la crÃ©ation du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; PostgreSQL, les informations du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Secret&lt;/code&gt;&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;s3-scaleway&lt;/code&gt; sont rÃ©cupÃ©rÃ©es et lâ€™archivage des journaux se fait&#xA;automatiquement sur le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Bucket&lt;/code&gt; S3.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Archivage des journaux&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans les traces de notre instance, nous voyons dÃ©sormais que les journaux sont&#xA;bien archivÃ©s. Voici lâ€™exemple dâ€™une trace &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;JSON&lt;/code&gt; mise en forme avec lâ€™outil&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;jq&lt;/code&gt; oÃ¹ nous pouvons voir, dans le champ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;msg&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;endTime&lt;/code&gt; par exemple, que le&#xA;journal a bien Ã©tÃ© archivÃ©.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-01-23T09:57:03.786672436Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;wal-archive&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Archived WAL file&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;walName&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;/var/lib/postgresql/data/pgdata/pg_wal/000000010000000000000005&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;startTime&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-01-23T09:57:00.327727678Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;endTime&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-01-23T09:57:03.786579567Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;elapsedWalTime&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;3.458851895&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;CÃ´tÃ© Scaleway, toute une arborescence a Ã©tÃ© crÃ©Ã©e dans le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Bucket&lt;/code&gt;&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;backup-postgresql&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;backup-postgresql&#xA;â””â”€â”€ postgresql&#xA;    â””â”€â”€ wals&#xA;        â””â”€â”€ 0000000100000000&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql&lt;/code&gt;, qui correspond au &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;name&lt;/code&gt; de notre cluster PostgreSQL ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;wals&lt;/code&gt;, qui contient les dossiers correspondant aux diffÃ©rentes &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;timelines&lt;/code&gt; de&#xA;lâ€™instance ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;0000000100000000&lt;/code&gt;, qui contient les journaux.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Sauvegarde&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™opÃ©rateur CloudNativePG Ã©tend lâ€™API Kubernetes avec une nouvelle ressource&#xA;appelÃ©e &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Backup&lt;/code&gt;. En crÃ©ant une ressource de ce type, une sauvegarde physique&#xA;sera dÃ©clenchÃ©e et stockÃ©e dans le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Bucket&lt;/code&gt; associÃ© Ã  notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;. Le nom du&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; doit Ã©videmment Ãªtre mentionnÃ© dans la ressource pour que les&#xA;informations du stockage S3 soient rÃ©cupÃ©rÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;CrÃ©ons le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sauvegarde.yaml&lt;/code&gt; avec le contenu suivant :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Backup&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;premiere-sauvegarde&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Et crÃ©ons cette ressource avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl apply -f sauvegarde.yaml&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl apply &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; sauvegarde.yaml&#xA;&lt;span class=&#34;go&#34;&gt;backup.postgresql.cnpg.io/premiere-sauvegarde created&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Bucket&lt;/code&gt; contient dÃ©sormais le dossier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;base&lt;/code&gt; qui contiendra les diffÃ©rentes&#xA;sauvegardes effectuÃ©es. Celle qui vient dâ€™Ãªtre faite est bien prÃ©sente dans le&#xA;dossier.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;backup-postgresql&#xA;â””â”€â”€ postgresql&#xA;    â”œâ”€â”€ base&#xA;    â”‚   â””â”€â”€ 20250123T105602&#xA;    â”‚      â”œâ”€â”€ backup.info&#xA;    â”‚      â””â”€â”€ data.tar&#xA;    â””â”€â”€ wals&#xA;        â””â”€â”€ 0000000100000000&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour information, lâ€™opÃ©rateur CloudNativePG est configurÃ© pour effectuer la&#xA;sauvegarde Ã  partir dâ€™un secondaire pour ne pas charger lâ€™instance&#xA;primaire. Câ€™est ce que lâ€™on peut voir dans les traces de lâ€™opÃ©rateur. Le champ&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pod&lt;/code&gt; indique bien que câ€™est le secondaire qui a Ã©tÃ© choisi.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-01-23T10:56:02.112865913Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Starting backup&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;controller&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;backup&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;controllerGroup&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql.cnpg.io&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;controllerKind&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Backup&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;Backup&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;    &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;name&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;premiere-sauvegarde&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;    &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;namespace&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;default&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;namespace&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;default&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;name&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;premiere-sauvegarde&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;reconcileID&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;a91635aa-0c72-4c88-98c8-f7de4c2da83a&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;cluster&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-2&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette configuration par dÃ©faut peut Ãªtre surchargÃ©e avec lâ€™option&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;target: &#34;primary&#34;&lt;/code&gt; de la ressource &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Backup&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;rÃ©utiliser-cette-sauvegarde&#34;&gt;RÃ©utiliser cette sauvegarde&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Jâ€™aurais pu titrer cette partie &lt;em&gt;Restauration de lâ€™instance&lt;/em&gt;, mais je ne lâ€™ai&#xA;volontairement pas fait pour proposer un autre angle pour aborder ce sujet.&#xA;Ã‰videmment, dÃ¨s lors quâ€™une sauvegarde existe, vous pouvez lâ€™utiliser pour&#xA;restaurer une instance en panne. Ce sera trÃ¨s probablement un article de blog&#xA;(Ã§a y est la liste dâ€™articles sâ€™allongeâ€¦ğŸ˜).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les Ã©quipes de dÃ©veloppement ont souvent besoin de donnÃ©es de production Ã  jour&#xA;pour tester leur nouvelle version (je fais simple et ne pas rentrer dans&#xA;les problÃ©matiques dâ€™&lt;a href=&#34;https://blog.dalibo.com/2024/11/15/postgresql_anonymizer_exports_anonymises.html&#34;&gt;anonymisation&lt;/a&gt; des donnÃ©es par exemple). Lâ€™idÃ©e ici est de&#xA;dÃ©ployer une nouvelle instance sur un nouveau cluster Kubernetes Ã  partir de&#xA;cette sauvegarde lÃ .&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Sur un autre cluster Kubernetes, appelÃ© &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;k8s-demo&lt;/code&gt;, jâ€™installe lâ€™opÃ©rateur &#xA;CloudNativePG et crÃ©e le cluster &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-dev&lt;/code&gt; dÃ©fini de cette maniÃ¨re :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql-dev&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;recovery&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;externalClusters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;barmanObjectStore&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;destinationPath&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;s3://backup-postgresql/&#34;&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;endpointURL&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;https://s3.fr-par.scw.cloud&#34;&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;s3Credentials&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;accessKeyId&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3-scaleway&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ACCESS_KEY_ID&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;secretAccessKey&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3-scaleway&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ACCESS_SECRET_KEY&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;region&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3-scaleway&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ACCESS_REGION&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Les deux instructions intÃ©ressantes ici sont &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;bootstrap&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;externalClusters&lt;/code&gt;.&#xA;Elles permettent dâ€™indiquer que la crÃ©ation de notre instance PostgreSQL, doit se&#xA;faire Ã  partir de la sauvegarde qui se trouve sur le stockage S3 indiquÃ©.&#xA;Si vous faites le test, nâ€™oubliez pas de crÃ©er le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Secret&lt;/code&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;s3-scaleway&lt;/code&gt; dans le&#xA;cluster &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;k8s-dev&lt;/code&gt;. Il contient les informations de connexion au S3.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; spÃ©cifique va Ãªtre dÃ©ployÃ©. Son nom est plutÃ´t parlant :&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-dev-1-full-recovery-xxxxx&lt;/code&gt;. Une restauration de type &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;full&lt;/code&gt; est en&#xA;train de se faire Ã  partir de la sauvegarde S3. Lorsque celle-ci est terminÃ©e,&#xA;le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; est crÃ©Ã© et votre instance est accessible, les donnÃ©es sont bien prÃ©sentes sur lâ€™instance du pod postgresql-dev.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-it&lt;/span&gt; postgresql-dev-1 &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; app &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\d&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;t&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt;Defaulted container &#34;postgres&#34; out of: postgres, bootstrap-controller (init)&#xA;             List of relations&#xA; Schema |       Name       | Type  | Owner &#xA;--------+------------------+-------+-------&#xA; public | pgbench_accounts | table | app&#xA; public | pgbench_branches | table | app&#xA; public | pgbench_history  | table | app&#xA; public | pgbench_tellers  | table | app&#xA;(4 rows)&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Vous avez donc une nouvelle instance, crÃ©Ã©e Ã  partir dâ€™une sauvegarde de votre&#xA;instance de production.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Petit truc Ã  savoir ğŸ’¡ : lâ€™opÃ©rateur utilise par dÃ©faut la sauvegarde la plus &#xA;rÃ©cente disponible dans le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Bucket&lt;/code&gt;. Ce fonctionnement est ajustable selon votre&#xA;besoin.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nous venons de voir comment sauvegarder notre instance avec CloudNativePG et&#xA;lâ€™outil &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Barman&lt;/code&gt; sur une solution de stockage objets ğŸ›Ÿ. La mise en place est&#xA;plutÃ´t simple. Jâ€™ai volontairement fait une sauvegarde basique, sans rentrer&#xA;dans les dÃ©tails. Sachez quâ€™il existe de nombreuses options, notamment pour ce&#xA;qui est de la compression ou de la rÃ©tention des sauvegardes. Ã€ vous de jouer !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[Commentaire-Blog] CloudNativePG&#34;&gt;Ã‰crivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #3 - Stockage et performance</title>
    <updated>2025-02-13T06:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-02-13://2025/02/13/cnpg-3.html</id>
    <link href="https://blog.dalibo.com//2025/02/13/cnpg-3.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;VallÃ©e de Munster, 13 fÃ©vrier 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;RÃ©cemment, Dalibo a Ã©tÃ© sollicitÃ© par un client pour rÃ©aliser une Ã©tude&#xA;sur lâ€™exploitation de PostgreSQL dans Kubernetes. Ce client avait&#xA;lÃ©gitimement des questions concernant &lt;strong&gt;le stockage pour PostgreSQL&lt;/strong&gt;. Ce&#xA;dernier nous a explicitement demandÃ© notre avis concernant Longhorn, une&#xA;solution de stockage rÃ©pliquÃ© et distribuÃ© pour Kubernetes.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;Bien que nous ayons quelques hypothÃ¨ses Ã  ce sujet, la solution a&#xA;suscitÃ© notre intÃ©rÃªt. Nous avons donc voulu Ã©valuer/explorer cette&#xA;solution de stockage de maniÃ¨re approfondie. Nous vous proposons dans&#xA;cet article une prÃ©sentation de Longhorn, mais aussi dâ€™une partie des&#xA;tests que nous avons rÃ©alisÃ©s pour PostgreSQL sur ce type&#xA;dâ€™architecture. Ce sera lâ€™occasion dâ€™Ã©voquer succinctement lâ€™utilisation&#xA;du plugin &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl&lt;/code&gt; de lâ€™opÃ©rateur &lt;strong&gt;CloudNativePG&lt;/strong&gt;, ce plugin sera utilisÃ©&#xA;pour lancer &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; dans un environnement conteneurisÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;prÃ©sentation-longhorn&#34;&gt;PrÃ©sentation Longhorn&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Longhorn est une solution de stockage (&lt;em&gt;block storage&lt;/em&gt;) persistant dite&#xA;hautement disponible et distribuÃ©e pour les Kubernetes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette solution intÃ¨gre des fonctionnalitÃ©s de synchronisation des&#xA;donnÃ©es, de prise dâ€™instantanÃ© et de sauvegarde incrÃ©mentielle des&#xA;volumes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Longhorn permet entre autreÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;La rÃ©plication du stockage entre plusieurs nÅ“uds Kubernetes ;&lt;/li&gt;&#xA;  &lt;li&gt;La mise en place dâ€™un stockage type â€œhyperconvergÃ©â€, le stockage se&#xA;fait par dessus Kubernetes. Il est par exemple possible de combiner&#xA;des nÅ“uds de calcul et de stockage ;&lt;/li&gt;&#xA;  &lt;li&gt;De facilement exporter les donnÃ©es vers du stockage de type S3 ou&#xA;NFS. Pour par exemple stocker et planifier des sauvegardes ;&lt;/li&gt;&#xA;  &lt;li&gt;Dâ€™effectuer des instantanÃ©s (&lt;em&gt;snapshot&lt;/em&gt;) ;&lt;/li&gt;&#xA;  &lt;li&gt;Dâ€™avoir une interface web de gestion.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h2 id=&#34;installation-de-longhorn&#34;&gt;Installation de Longhorn&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Nous avons rÃ©alisÃ© une installation de base de Longhorn en utilisant la&#xA;procÃ©dure suivante:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Appliquer le &lt;em&gt;manifest&lt;/em&gt; distribuÃ© par le projet :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl apply &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; https://raw.githubusercontent.com/longhorn/longhorn/v1.8.0/deploy/longhorn.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;VÃ©rifier la prÃ©sence des composants pour le fonctionnement de base&#xA;dans lâ€™espace de nom &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;longhorn-system&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get pods &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; longhorn-system&#xA;&lt;span class=&#34;go&#34;&gt;NAME                                                READY   STATUS    RESTARTS      AGE&#xA;csi-attacher-79866cdcf8-bs22m                       1/1     Running   1 (11m ago)   12m&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;longhorn-driver-deployer-64c9779f48-v4t55           1/1     Running   0             19m&#xA;longhorn-manager-xds9c                              2/2     Running   0             19m&#xA;longhorn-ui-5677d74dfd-c97p7                        1/1     Running   0             19m&#xA;longhorn-ui-5677d74dfd-dcckd                        1/1     Running   0             19m&#xA;&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get deployments &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; longhorn-system&#xA;&lt;span class=&#34;go&#34;&gt;NAME                       READY   UP-TO-DATE   AVAILABLE   AGE&#xA;csi-attacher               3/3     3            3           19m&#xA;csi-provisioner            3/3     3            3           19m&#xA;csi-resizer                3/3     3            3           19m&#xA;csi-snapshotter            3/3     3            3           19m&#xA;longhorn-driver-deployer   1/1     1            1           25m&#xA;longhorn-ui                2/2     2            2           25&#xA;&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get services &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; longhorn-system&#xA;&lt;span class=&#34;go&#34;&gt;NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;longhorn-admission-webhook    ClusterIP   10.96.9.151     &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;9502/TCP   31m&#xA;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;longhorn-recovery-backend     ClusterIP   10.96.235.98    &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;9503/TCP   31m&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;VÃ©rifier la prÃ©sence des deux classes de stockage dÃ©finies par le&#xA;&lt;em&gt;manifest&lt;/em&gt; de Longhorn&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get storageclasses.storage.k8s.io&#xA;&lt;span class=&#34;go&#34;&gt;NAME                 PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE&#xA;longhorn (default)   driver.longhorn.io      Delete          Immediate              true                   16m&#xA;longhorn-static      driver.longhorn.io      Delete          Immediate              true                   16m&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Et pour finir, consulter lâ€™interface de gestion (nous utilisons ici,&#xA;une simple redirection de port) :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl port-forward services/longhorn-frontend &lt;span class=&#34;nt&#34;&gt;-n&lt;/span&gt; longhorn-system 8080:80&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;&#xA;    &lt;p&gt;Nous pouvons maintenant ouvrir lâ€™interface de gestion dans notre&#xA;navigateur &lt;a href=&#34;http://127.0.0.1:8080&#34;&gt;http://127.0.0.1:8080&lt;/a&gt;&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Nous avons maintenant un cluster Kubernetes en mesure dâ€™utiliser du&#xA;stockage distribuÃ©. Lâ€™utilisation de Longhorn permet potentiellement de&#xA;rÃ©duire le risque de perdre des donnÃ©es lors de la perte dâ€™un nÅ“ud&#xA;Kubernetes. Lâ€™interface web de gestion donne un bref aperÃ§u des&#xA;nombreuses options offertes par cette solution de stockage. Pour plus&#xA;des informations complÃ©mentaires concernant les fonctionnalitÃ©s, le&#xA;fonctionnement interne de et la rÃ©plication inter nÅ“ud, nous vons&#xA;invitons Ã  consulter la &lt;a href=&#34;https://longhorn.io/docs/1.8.0/concepts/&#34;&gt;documentation officielle du&#xA;projet&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avant de continuer, il nous semble utile de rappeler que notre&#xA;installation (de Longhorn) est uniquement pour des tests. Pour un&#xA;systÃ¨me de production, il est strictement nÃ©cessaire de se questionner&#xA;concernant divers sujets que nous nâ€™aborderons pas ici (par exemple:&#xA;CAP, fencing, sauvegardeâ€¦).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;AprÃ¨s ces quelques vÃ©rifications et un rapide tour de lâ€™interface de&#xA;gestion, nous pouvons dÃ©marrer nos tests.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;tester-avec-du-stockage-rÃ©pliquÃ©&#34;&gt;Tester avec du stockage rÃ©pliquÃ©&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Dans ce paragraphe, nous allons mesurer la charge disque que Longhorn&#xA;est capable dâ€™encaisser avec un volume composÃ© de 3 rÃ©plicas&#xA;(configuration fournie par dÃ©faut). Nous lancerons aussi quelques tests&#xA;avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; sur une instance PostgreSQL. Comme annoncÃ© dans&#xA;lâ€™introduction, nous utiliserons pour cela le &lt;a href=&#34;https://cloudnative-pg.io/documentation/current/kubectl-plugin/#kubectl-plugin&#34;&gt;&lt;em&gt;plugin&#xA;CNPG&lt;/em&gt;&lt;/a&gt;&#xA;pour kubectl. Pour finir, lâ€™opÃ©rateur CNPG sera aussi utilisÃ© pour nous&#xA;faciliter la crÃ©ation de nos instances PostgreSQL de tests.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;lancer-fio&#34;&gt;Lancer &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Avant dâ€™effectuer nos tests avec PostgreSQL, nous allons utiliser &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt;&#xA;pour Ã©valuer les performances brutes de notre stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour cela, nous pouvons lancer la commande suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg fio fio-test-perf &lt;span class=&#34;nt&#34;&gt;-n&lt;/span&gt; default &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt;    --pvcSize 2Gi --storageClass longhorn --dry-run |\&#xA;    sed -e &#39;s/runtime=60/runtime=3600/g&#39;|kubectl apply -f -&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette commande va exÃ©cuter &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt; pendant une heure avec un volume&#xA;dÃ©diÃ© de 2 Gi. En fin dâ€™exÃ©cution, les rÃ©sultats sont rÃ©cupÃ©rables via&#xA;une page web. Il est possible de consulter cette page en exposant le&#xA;service dÃ©diÃ© :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl port-forward &lt;span class=&#34;nt&#34;&gt;-n&lt;/span&gt; fio deployment/fio-test-perf 8000&#xA;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;open http://127.0.0.1:8000&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La page (consultable sur &lt;a href=&#34;http://127.0.0.1:8000&#34;&gt;http://127.0.0.1:8000&lt;/a&gt;) prÃ©sente des&#xA;graphiques et les &lt;em&gt;logs&lt;/em&gt; de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt;. Pour nos tests sur du stockage&#xA;rÃ©pliquÃ© la bande passante moyenne mesurÃ©e est de 2800 IOPs &lt;strong&gt;en&#xA;lecture&lt;/strong&gt; :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/read_iops_noreplica.1-2Dtrend.png&#34; alt=&#34;IOPs sur volume avec rÃ©plication&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour mesurer la capacitÃ© thÃ©orique en Ã©criture, nous pouvons relancer&#xA;notre test en utilisant le scÃ©nario &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;write&lt;/code&gt; de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt;. Pour modifier les&#xA;diffÃ©rents paramÃ¨tres de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt;, nous exportons le &lt;em&gt;manifest&lt;/em&gt; gÃ©nÃ©rÃ© avec&#xA;le plugin CloudNativePG de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl&lt;/code&gt; pour ensuite le modifier :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg fio fio-test-perf-write &lt;span class=&#34;nt&#34;&gt;-n&lt;/span&gt; default &lt;span class=&#34;nt&#34;&gt;--pvcSize&lt;/span&gt; 2Gi &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;&lt;span class=&#34;gp&#34;&gt;    --storageClass longhorn --dry-run &amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;/tmp/scenario.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On modifie la &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ConfigMap&lt;/code&gt; pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt; qui se trouve dans le fichier&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/tmp/scenario.yaml&lt;/code&gt; (on change Ã  minima lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rw&lt;/code&gt; de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;read&lt;/code&gt; a&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;write&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ConfigMap&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;fio-test-perf&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;default&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;job&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;pi&#34;&gt;|-&lt;/span&gt;&#xA;    &lt;span class=&#34;s&#34;&gt;[write]&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;direct=1&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;bs=8k&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;size=1G&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;time_based=1&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;runtime=3600&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;ioengine=libaio&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;iodepth=32&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;end_fsync=1&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;log_avg_msec=1000&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;directory=/data&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;rw=write&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;write_bw_log=read&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;write_lat_log=read&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;write_iops_log=read&lt;/span&gt;&#xA;        &lt;span class=&#34;s&#34;&gt;...&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™exÃ©cution de ce scÃ©nario gÃ©nÃ¨re le graphique suivant :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/write_iops_withreplica.1-2Dtrend.png&#34; alt=&#34;IOPs en Ã©criture sur volume avec rÃ©plication&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous pouvons conclure que Longhorn avec 3 rÃ©plicas sur notre&#xA;infrastructure de test peut encaisser :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;2819 IOPs en lecture&lt;/li&gt;&#xA;  &lt;li&gt;1316 IOPs en Ã©criture&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h3 id=&#34;tester-avec-une-instance-postgresql&#34;&gt;Tester avec une instance PostgreSQL&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nous allons maintenant utiliser &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; sur un cluster PostgreSQL. Ce&#xA;cluster sera composÃ© dâ€™une seule instance PostgreSQL. Les donnÃ©es de&#xA;notre instance se trouveront sur du stockage rÃ©pliquÃ© sur 3 nÅ“uds&#xA;Kubernetes (configuration de base de la classe de stockage &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;longhorn&lt;/code&gt;).&#xA;Nous commenÃ§ons par dÃ©clarer une instance avec la classe de stockage&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;longhorn&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl apply &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; - &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;sh&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;apiVersion: postgresql.cnpg.io/v1&#xA;kind: Cluster&#xA;metadata:&#xA;  name: cluster-longhorn&#xA;spec:&#xA;  instances: 1&#xA;  storage:&#xA;    storageClass: longhorn&#xA;    size: 10Gi&#xA;  resources:&#xA;    requests:&#xA;      memory: 1Gi&#xA;      cpu: &#39;1&#39;&#xA;    limits:&#xA;      memory: 2Gi&#xA;      cpu: &#39;2&#39;&#xA;  postgresql:&#xA;    parameters:&#xA;      shared_buffers: 256MB&#xA;      effective_io_concurrency: &#39;300&#39;&#xA;      random_page_cost: &#39;1.1&#39;&#xA;EOF&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette instance (aprÃ¨s initialisation) est utilisable et testable en&#xA;suivant les Ã©tapes suivantes :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Garnir la base &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;app&lt;/code&gt; de notre instance avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt;. Pour cette&#xA;opÃ©ration, nous utilisons le plugin &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl&lt;/code&gt; de CloudNativePG pour&#xA;dÃ©ployer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Job&lt;/code&gt; (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;job-instance-longhorn&lt;/code&gt; ici) dÃ©diÃ© Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt;.&#xA;Les options &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--initialize&lt;/code&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--scale 250&lt;/code&gt; sont placÃ©es aprÃ¨s un&#xA;double tiret. En fonction de nos besoins, il est possible dâ€™ajouter&#xA;des options complÃ©mentaires pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg pgbench &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt;    --job-name job-instance-longhorn cluster-longhorn \&#xA;    -- --initialize --scale 250&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Surveiller le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; correspondant Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt;&#xA;(&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;job-instance-longhorn-djgwb&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get pods&#xA;&lt;span class=&#34;go&#34;&gt;NAME                              READY   STATUS      RESTARTS   AGE&#xA;cluster-longhorn-1                1/1     Running     0          8m34s&#xA;cluster-longhorn-1-initdb-6bgsb   0/1     Completed   0          9m&#xA;job-instance-longhorn-djgwb       1/1     Running     0          3m33s&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;RÃ©cupÃ©rer les rÃ©sultats de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; en affichant les journaux du&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Job&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl logs &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; default job/job-instance-longhorn-client1&#xA;&lt;span class=&#34;go&#34;&gt;dropping old tables...&#xA;NOTICE:  table &#34;pgbench_accounts&#34; does not exist, skipping&#xA;NOTICE:  table &#34;pgbench_branches&#34; does not exist, skipping&#xA;NOTICE:  table &#34;pgbench_history&#34; does not exist, skipping&#xA;NOTICE:  table &#34;pgbench_tellers&#34; does not exist, skipping&#xA;creating tables...&#xA;generating data (client-side)...&#xA;100000 of 25000000 tuples (0%) of pgbench_accounts done (elapsed 0.08 s, remaining 20.13 s) &#xA;200000 of 25000000 tuples (0%) of pgbench_accounts done (elapsed 0.14 s, remaining 17.49 s)&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;24900000 of 25000000 tuples (99%) of pgbench_accounts done (elapsed 200.00 s, remaining 0.80 s)&#xA;25000000 of 25000000 tuples (100%) of pgbench_accounts done (elapsed 201.36 s, remaining 0.00 s)&#xA;vacuuming...&#xA;creating primary keys...&#xA;done in 336.58 s (drop tables 0.01 s, create tables 0.14 s, client-side generate 203.41 s, vacuum 13.16 s, primary keys 119.86 s).&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Les informations utiles se trouvent Ã  la fin :&lt;/p&gt;&#xA;&#xA;    &lt;ul&gt;&#xA;      &lt;li&gt;durÃ©e : 336.58 s&lt;/li&gt;&#xA;      &lt;li&gt;temps crÃ©ation des clÃ©s primaires : 119.86 s&lt;/li&gt;&#xA;      &lt;li&gt;client-side generate - principalement temps pour garnir les&#xA;tables : 203.41 s&lt;/li&gt;&#xA;    &lt;/ul&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Si nÃ©cessaire, nous pouvons aussi rÃ©cupÃ©rer la taille (3746 MB) de&#xA;la base en utilisant cette commande :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;default &lt;span class=&#34;nt&#34;&gt;--stdin&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--tty&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt;    -ti cluster-longhorn-1  \&#xA;    -- psql -c &#34;SELECT pg_size_pretty(pg_database_size(&#39;app&#39;))&#34;&#xA;Defaulted container &#34;postgres&#34; out of: postgres, bootstrap-controller (init)&#xA; pg_size_pretty&#xA;----------------&#xA; 3746 MB&#xA;(1 row)&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Maintenant que notre base de test est en place, nous lanÃ§ons&#xA;successivement des tÃ¢ches (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Job&lt;/code&gt;) pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; en augmentant&#xA;progressivement la valeur de lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--client&lt;/code&gt; (et ce afin&#xA;dâ€™Ã©tablir le tableau visible plus bas) :&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg pgbench &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt;    --job-name job-instance-longhorn-client1 cluster-longhorn \&#xA;    -- --time 300 --client 1 --jobs 1&#xA;job/job-instance-longhorn-client1 create&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl logs &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; job/job-instance-longhorn-client1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;&#xA;    &lt;p&gt;Cette derniÃ¨re Ã©tape permet dâ€™Ã©tablir ce tableau (variation de&#xA;lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--client&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;    &lt;table&gt;&#xA;      &lt;thead&gt;&#xA;        &lt;tr&gt;&#xA;          &lt;th style=&#34;text-align: center&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--client&lt;/code&gt;&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: center&#34;&gt;TPS&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: center&#34;&gt;Latence moyenne&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: center&#34;&gt;initial connection time&lt;/th&gt;&#xA;        &lt;/tr&gt;&#xA;      &lt;/thead&gt;&#xA;      &lt;tbody&gt;&#xA;        &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;1&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;52&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;18.906&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;28.819&lt;/td&gt;&#xA;        &lt;/tr&gt;&#xA;        &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;2&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;109&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;18.260&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;22.341&lt;/td&gt;&#xA;        &lt;/tr&gt;&#xA;        &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;4&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;201&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;19.850&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;24.132&lt;/td&gt;&#xA;        &lt;/tr&gt;&#xA;        &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;8&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;313&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;24.256&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;108.819&lt;/td&gt;&#xA;        &lt;/tr&gt;&#xA;        &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;16&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;409&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;39.026&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;57.023&lt;/td&gt;&#xA;        &lt;/tr&gt;&#xA;      &lt;/tbody&gt;&#xA;    &lt;/table&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h2 id=&#34;tester-avec-du-stockage-non-rÃ©pliquÃ©&#34;&gt;Tester avec du stockage non rÃ©pliquÃ©&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Dans cette section, nous allons rÃ©aliser notre batterie de tests (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Job&lt;/code&gt;&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt; et plusieurs exÃ©cutions de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt;) en utilisant du stockage non&#xA;rÃ©pliquÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;On commence par ajouter une classe de stockage utilisant Longhorn en&#xA;positionnant le nombre de rÃ©plica Ã  1 (la partie importante est la ligne&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;numberOfReplicas: &#34;1&#34;&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl apply &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; - &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;sh&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;---&#xA;allowVolumeExpansion: true&#xA;apiVersion: storage.k8s.io/v1&#xA;kind: StorageClass&#xA;metadata:&#xA;  name: longhorn-noreplica&#xA;parameters:&#xA;  dataEngine: v1&#xA;  dataLocality: disabled&#xA;  disableRevisionCounter: &#34;true&#34;&#xA;  fromBackup: &#34;&#34;&#xA;  fsType: ext4&#xA;  numberOfReplicas: &#34;1&#34;&#xA;  staleReplicaTimeout: &#34;30&#34;&#xA;  unmapMarkSnapChainRemoved: ignored&#xA;provisioner: driver.longhorn.io&#xA;reclaimPolicy: Delete&#xA;volumeBindingMode: Immediate&#xA;EOF&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous pouvons vÃ©rifier la prÃ©sence de cette nouvelle classe et reprendre&#xA;nos tests en adaptant la classe de stockage :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get storageclasses.storage.k8s.io longhorn-noreplica&#xA;&lt;span class=&#34;go&#34;&gt;NAME                 PROVISIONER          RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE&#xA;longhorn-noreplica   driver.longhorn.io   Delete          Immediate           true                   4d&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h3 id=&#34;lancer-fio-1&#34;&gt;Lancer fio&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;On lance un nouveau &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Job&lt;/code&gt; pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt; en spÃ©cifiant notre nouvelle classe&#xA;de stockage :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg fio fio-test-perf-noreplica &lt;span class=&#34;nt&#34;&gt;-n&lt;/span&gt; default &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt;    --pvcSize 2Gi --storageClass longhorn-noreplica --dry-run |\&#xA;    sed -e &#39;s/runtime=60/runtime=3600/g&#39; | kubectl apply -f -&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour ensuite consulter les rÃ©sultats, on expose le port 80 de notre&#xA;dÃ©ploiement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl port-forward deployment/fio-test-perf-noreplica 8000&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/read_iops_noreplica.1-2Dtrend.png&#34; alt=&#34;IOPs en lecture sur volume sans rÃ©plication&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Et exÃ©cuter le test en Ã©criture et consulter les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/write_iops_noreplica.1-2Dtrend.png&#34; alt=&#34;IOPs en Ã©criture sur volume sans rÃ©plication&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous constatons que notre solution de stockage configurÃ©e sans&#xA;rÃ©plication est en mesure dâ€™encaisser en moyenne :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;2493 IOPs en lecture&lt;/li&gt;&#xA;  &lt;li&gt;2289 IOPs en Ã©criture&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Par rapport Ã  une instance utilisant du stockage rÃ©pliquÃ©, on remarque&#xA;une diffÃ©rence importante pour les Ã©critures (presque 1000 IOPS en&#xA;plus).&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;tester-avec-une-instance-postgresql-1&#34;&gt;Tester avec une instance PostgreSQL&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;AprÃ¨s avoir testÃ© avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fio&lt;/code&gt;, nous allons rÃ©aliser la mÃªme batterie de&#xA;tests avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; que pour notre premiÃ¨re instance.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;On commence par dÃ©clarer une nouvelle instance PostgreSQL en utilisant&#xA;notre nouvelle classe de stockage, pour ensuite :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Garnir cette seconde instance avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; et les options&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--initialize&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--scale 250&lt;/code&gt;&lt;/li&gt;&#xA;  &lt;li&gt;Lancer plusieurs tÃ¢ches pour simuler progressivement 1, 2, 4, 8 et&#xA;16 clients PostgreSQL.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Ce qui va nous permettre de comparer les deux configurations avec et&#xA;sans rÃ©plication synchrone au niveau stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat du garnissage dâ€™une base indique ceci :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl logs &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;jobs&lt;/span&gt;/job-instance-longhorn-noreplica&#xA;&lt;span class=&#34;go&#34;&gt;dropping old tables...&#xA;NOTICE:  table &#34;pgbench_accounts&#34; does not exist, skipping&#xA;NOTICE:  table &#34;pgbench_branches&#34; does not exist, skipping&#xA;NOTICE:  table &#34;pgbench_history&#34; does not exist, skipping&#xA;NOTICE:  table &#34;pgbench_tellers&#34; does not exist, skipping&#xA;creating tables...&#xA;generating data (client-side)...&#xA;100000 of 25000000 tuples (0%) of pgbench_accounts done (elapsed 0.06 s, remaining 15.69 s)&#xA;200000 of 25000000 tuples (0%) of pgbench_accounts done (elapsed 0.31 s, remaining 37.95 s)&#xA;300000 of 25000000 tuples (1%) of pgbench_accounts done (elapsed 0.39 s, remaining 31.78 s)&#xA;24900000 of 25000000 tuples (99%) of pgbench_accounts done (elapsed 100.51 s, remaining 0.48 s)&#xA;25000000 of 25000000 tuples (100%) of pgbench_accounts done (elapsed 100.58 s, remaining 0.00 s)&#xA;vacuuming...&#xA;creating primary keys...&#xA;done in 203.71 s (drop tables 0.01 s, create tables 0.09 s, client-side generate 102.00 s, vacuum 11.99 s, primary keys 89.62 s).&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces informations nous montrent que sans rÃ©plication le garnissage de&#xA;notre base prend approximativement 1/3 de temps en moins :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;durÃ©e : 203.71 s (336.58 s lors de notre premiÃ¨re exÃ©cution)&lt;/li&gt;&#xA;  &lt;li&gt;temps crÃ©ation des clÃ©s primaires : 89.62 s, (cela reprÃ©sente 30 s&#xA;de moins que pour une instance avec du stockage rÃ©pliquÃ©)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;em&gt;client-side generate&lt;/em&gt; - (principalement du temps pour garnir les&#xA;tables) : 102.00 secondes, ce qui correspond Ã  101 secondes de moins&#xA;que notre premiÃ¨re instance avec du stockage rÃ©pliquÃ©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Et les rÃ©sultats des diffÃ©rents jobs avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt;, nous permettent&#xA;dâ€™Ã©tablir le tableau suivant :&lt;/p&gt;&#xA;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;    &lt;tr&gt;&#xA;      &lt;th style=&#34;text-align: center&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--client&lt;/code&gt;&lt;/th&gt;&#xA;      &lt;th style=&#34;text-align: center&#34;&gt;TPS&lt;/th&gt;&#xA;      &lt;th style=&#34;text-align: center&#34;&gt;Latence moyenne&lt;/th&gt;&#xA;      &lt;th style=&#34;text-align: center&#34;&gt;initial connection time&lt;/th&gt;&#xA;    &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;    &lt;tr&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;1&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;63&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;13.953&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;19.090&lt;/td&gt;&#xA;    &lt;/tr&gt;&#xA;    &lt;tr&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;2&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;144&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;13.864&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;43.447&lt;/td&gt;&#xA;    &lt;/tr&gt;&#xA;    &lt;tr&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;4&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;242&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;19.433&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;25.395&lt;/td&gt;&#xA;    &lt;/tr&gt;&#xA;    &lt;tr&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;8&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;329&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;24.300&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;138.927&lt;/td&gt;&#xA;    &lt;/tr&gt;&#xA;    &lt;tr&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;16&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;412&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;38.839&lt;/td&gt;&#xA;      &lt;td style=&#34;text-align: center&#34;&gt;157.923&lt;/td&gt;&#xA;    &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&#xA;&lt;p&gt;Les lectures restent sensiblement identiques. Il pourrait Ãªtre utile de&#xA;vÃ©rifier le comportement du cache ou des caches (PostgreSQL, systÃ¨meâ€¦)&#xA;pour en savoir plus concernant les lectures.&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;conclusion---stockage-distribuÃ©-avec-postgresql&#34;&gt;Conclusion - Stockage distribuÃ© avec PostgreSQL&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Intuitivement, sur la base de notre connaissance dâ€™autres solutions de&#xA;stockage et du fonctionnement de PostgreSQL, on aurait tendance Ã &#xA;conseiller de dÃ©sactiver la rÃ©plication au niveau du stockage pour&#xA;laisser PostgreSQL sâ€™occuper de la rÃ©plication.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les rÃ©sultats de nos tests (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; lors des phases dâ€™initialisations)&#xA;dÃ©montrent un impact (&lt;em&gt;Write amplification&lt;/em&gt;) notable sur les Ã©critures.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dâ€™ailleurs, on retrouve dans la documentation de CloudNativePG un&#xA;paragraphe spÃ©cifique concernant ce type de solution.&lt;/p&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;Most block storage solutions in Kubernetes, such as Longhorn and Ceph,&#xA;recommend having multiple replicas of a volume to enhance resiliency.&#xA;This approach works well for workloads that lack built-in resiliency.&lt;/p&gt;&#xA;&#xA;  &lt;p&gt;However, CloudNativePG integrates this resiliency directly into the&#xA;Postgres Cluster through the number of instances and the persistent&#xA;volumes attached to them, as explained in â€œSynchronizing the stateâ€.&lt;/p&gt;&#xA;&#xA;  &lt;p&gt;As a result, defining additional replicas at the storage level can&#xA;lead to write amplification, unnecessarily increasing disk I/O and&#xA;space usage.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;https://cloudnative-pg.io/documentation/1.25/storage/&#34;&gt;https://cloudnative-pg.io/documentation/1.25/storage/&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nos tests et la documentation valident donc nos intuitions. Lors de&#xA;lâ€™utilisation de PostgreSQL sur des technologies de stockage avancÃ©es,&#xA;il est souvent souhaitable de sâ€™appuyer sur les mÃ©canismes natifs (de&#xA;PostgreSQL) pour gÃ©rer la rÃ©plication. Dit plus simplement Longhorn,&#xA;dans sa configuration de base, ne nous semble pas adaptÃ© pour notre SGBD&#xA;favori et pourrait mÃªme avoir des effets indÃ©sirables.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Concernant les lectures disque, on constate que Longhorn, de par son&#xA;architecture, nâ€™apporte pas grand-chose pour PostgreSQL. Lors de nos&#xA;tests, câ€™est surtout le cache systÃ¨me et de PostgreSQL qui semblent Ãªtre&#xA;bÃ©nÃ©fiques. On aurait dâ€™ailleurs pu prÃ©senter des tests spÃ©cifiques pour&#xA;dÃ©montrer cela (pourquoi pas dans un prochain article ?!).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cet article, nous a permis de prÃ©senter quelques fonctionnalitÃ©s&#xA;fournies avec le plugin &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl&lt;/code&gt; de CloudNativePG. Nous avons aussi un&#xA;bref aperÃ§u du fonctionnement de Longhorn. Dans le cadre de nos&#xA;recherches et tests, nous avons traitÃ© plus en profondeur cette&#xA;technologie. Nous avons retenu ici, la partie la plus pertinente pour&#xA;PostgreSQL. Dâ€™autres articles concernant PostgreSQL et Kubernetes&#xA;arriveront prochainement sur notre blog.&lt;/p&gt;&#xA;&#xA;&lt;!--&#xA;    vim: spelllang=fr spell&#xA;  --&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Extension Day 2025</title>
    <updated>2025-03-17T08:30:00Z</updated>
    <id>tag:www.loxodata.com,2025-03-17:/post/pgext-day-2025/</id>
    <link href="http://www.loxodata.com/post/pgext-day-2025/" rel="alternate"></link>
    <summary type="html">&lt;h2 id=&#34;postgresql-extension-day-2025&#34;&gt;PostgreSQL Extension Day 2025&lt;/h2&gt;&#xA;&lt;p&gt;Le 12 mai 2025 se tiendra l&amp;rsquo;Ã©vÃ©nement gratuit &lt;a href=&#34;https://pgext.day/&#34;&gt;PostgreSQL Extension Day&lt;/a&gt; Ã  MontrÃ©al, soit la veille de la confÃ©rence PostgreSQL &lt;a href=&#34;https://2025.pgconf.dev/&#34;&gt;PGConf.dev&lt;/a&gt; qui se tiendra pour sa part du 13 au 15 mai. Cette confÃ©rence n&amp;rsquo;est toutefois pas affiliÃ©e Ã  la &lt;a href=&#34;https://2025.pgconf.dev/&#34;&gt;PGConf.dev&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Ce rassemblement a pour but de rÃ©unir tous les acteurs qui contribuent et utilisent les extensions de PostgreSQL constituant un Ã©cosystÃ¨me de plusieurs centaines de projets : prÃ¨s de 400 actuellement. Le &lt;a href=&#34;https://pgext.day/&#34;&gt;PostgreSQL Extension Day&lt;/a&gt; est organisÃ© par le groupe &lt;a href=&#34;https://github.com/pgedc&#34;&gt;Postgres Extension Developers Coalition&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://sessionize.com/pgextday2025mtl&#34;&gt;CFP&lt;/a&gt; est ouvert jusqu&amp;rsquo;au 1er avril 2025, et les inscriptions sont ouvertes par &lt;a href=&#34;https://pgextday2025mtl.eventbrite.ca/&#34;&gt;ici&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>L&#39;extension pg_trgm</title>
    <updated>2025-03-07T08:20:00Z</updated>
    <id>tag:www.loxodata.com,2025-03-07:/post/pg_trgm/</id>
    <link href="http://www.loxodata.com/post/pg_trgm/" rel="alternate"></link>
    <summary type="html">&lt;h1 id=&#34;lextension-pg_trgm&#34;&gt;L&amp;rsquo;extension pg_trgm&lt;/h1&gt;&#xA;&lt;h2 id=&#34;prÃ©sentation&#34;&gt;PrÃ©sentation&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;extension &lt;code&gt;pg_trgm&lt;/code&gt; (trigrammes) est fournie dans la distribution standard de PostgreSQL. Elle est prÃ©sente dans &lt;code&gt;/contrib&lt;/code&gt; et s&amp;rsquo;installe simplement dans une base de donnÃ©es :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# CREATE EXTENSION IF NOT EXISTS pg_trgm;&#xA;CREATE EXTENSION&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cette extension permet de dÃ©composer une chaÃ®ne de caractÃ¨res en succession de sous-chaÃ®nes de 3 caractÃ¨res (trigrammes), afin de permettre des recherches sur une sous-chaÃ®ne, ou bien des recherches de similaritÃ© entre chaÃ®nes de caractÃ¨res.&lt;/p&gt;&#xA;&lt;h2 id=&#34;fonctionnement&#34;&gt;Fonctionnement&lt;/h2&gt;&#xA;&lt;h3 id=&#34;jeu-dessai&#34;&gt;Jeu d&amp;rsquo;essai&lt;/h3&gt;&#xA;&lt;p&gt;Dans le cadre de cette prÃ©sentation, je me suis constituÃ© une table d&amp;rsquo;un million de lignes, laquelle contient un champ &lt;code&gt;family&lt;/code&gt; contenant un nom de famille parmi les 1000 plus frÃ©quent en France, et dont la frÃ©quence dans la table est semblable Ã  celle de la population franÃ§aise :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# \dS my_datas&#xA;                              Table &amp;#34;public.my_datas&amp;#34;&#xA;   Column    |  Type  | Collation | Nullable |               Default&#xA;-------------+--------+-----------+----------+--------------------------------------&#xA; id          | bigint |           | not null | nextval(&amp;#39;my_datas_id_seq&amp;#39;::regclass)&#xA; random_text | text   |           |          |&#xA; family      | text   |           |          |&#xA;Indexes:&#xA;    &amp;#34;idx_test_id&amp;#34; btree (id)&#xA;&#xA;loxodata_text=# SELECT count(1) FROM my_datas;&#xA;  count&#xA;---------&#xA; 1000204&#xA;(1 row)&#xA;&#xA;loxodata_text=# SELECT * FROM my_datas LIMIT 5;&#xA;   id   |             random_text              | family&#xA;--------+--------------------------------------+---------&#xA; 211685 | 94376bb6-3655-4a65-b61a-8dbec927c5e5 | GRANGER&#xA; 211686 | 7f9f8a34-13f2-4459-bd2c-e4b90a7eca9b | LE ROUX&#xA; 211687 | 526549b3-13fe-4aae-87c1-4a5480cf6898 | FUCHS&#xA; 211688 | 1acbdde8-b4cd-4bf8-957c-84adf1c6cf1c | BRUNET&#xA; 211689 | 77cd8645-bfe8-471c-a118-3dbe507d8e8f | LAMBERT&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;dÃ©composition&#34;&gt;DÃ©composition&lt;/h3&gt;&#xA;&lt;p&gt;On peut visualiser la dÃ©composition en trigrammes avec la fonction &lt;code&gt;show_trgm()&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# SELECT show_trgm(&amp;#39;GRANGER&amp;#39;);&#xA;                show_trgm&#xA;-----------------------------------------&#xA; {&amp;#34;  g&amp;#34;,&amp;#34; gr&amp;#34;,ang,&amp;#34;er &amp;#34;,ger,gra,nge,ran}&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;similaritÃ©&#34;&gt;SimilaritÃ©&lt;/h3&gt;&#xA;&lt;p&gt;La fonction &lt;code&gt;similarity()&lt;/code&gt; permet de tester la similaritÃ© entre deux chaÃ®nes de caractÃ¨res. Le rÃ©sultat est un score entre 0 et 1. ZÃ©ro indique qu&amp;rsquo;il n&amp;rsquo;y a aucun trigramme en commun entre les deux chaÃ®nes, tandis que 1 indique que les deux chaÃ®nes sont identiques. On peut ainsi tester la similaritÃ© entre deux noms de famille :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# select similarity(&amp;#39;GRANGER&amp;#39;,&amp;#39;BRUNET&amp;#39;);&#xA; similarity&#xA;------------&#xA;          0&#xA;(1 row)&#xA;&#xA;loxodata_text=# select similarity(&amp;#39;GRANGER&amp;#39;,&amp;#39;GRANGE&amp;#39;);&#xA; similarity&#xA;------------&#xA;  0.6666667&#xA;(1 row)&#xA;&#xA;loxodata_text=# select similarity(&amp;#39;GRANGER&amp;#39;,&amp;#39;GRANIER&amp;#39;);&#xA; similarity&#xA;------------&#xA; 0.45454547&#xA;(1 row)&#xA;&#xA;loxodata_text=# select similarity(&amp;#39;GRANGER&amp;#39;,&amp;#39;LEGRAND&amp;#39;);&#xA; similarity&#xA;------------&#xA; 0.14285715&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;opÃ©rateur boolÃ©en de similaritÃ© entre deux chaÃ®nes est &lt;code&gt;%&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# select &amp;#39;GRANGER&amp;#39; % &amp;#39;GRANIER&amp;#39;;&#xA; ?column?&#xA;----------&#xA; t&#xA;(1 row)&#xA;&#xA;loxodata_text=# select &amp;#39;GRANGER&amp;#39; % &amp;#39;LEGRAND&amp;#39;;&#xA; ?column?&#xA;----------&#xA; f&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;opÃ©rateur boolÃ©en retourne &lt;code&gt;True&lt;/code&gt; si le score de similaritÃ© excÃ¨de une limite fixÃ©e par dÃ©faut Ã  &lt;code&gt;0.3&lt;/code&gt;. La limite courante peut Ãªtre consultÃ©e avec la fonction &lt;code&gt;show_limit()&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# select show_limit();&#xA; show_limit&#xA;------------&#xA;        0.3&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Et cette limite peut Ãªtre modifiÃ©e au niveau de la session avec la fonction &lt;code&gt;set_limit()&lt;/code&gt;. Ainsi, si on passe le seuil Ã  &lt;code&gt;0.1&lt;/code&gt;, &amp;lsquo;GRANGER&amp;rsquo; et &amp;lsquo;LEGRAND&amp;rsquo; sont dÃ©sormais considÃ©rÃ©s comme similaires :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# select set_limit(0.1);&#xA; set_limit&#xA;-----------&#xA;       0.1&#xA;(1 row)&#xA;&#xA;loxodata_text=# select &amp;#39;GRANGER&amp;#39; % &amp;#39;LEGRAND&amp;#39;;&#xA; ?column?&#xA;----------&#xA; t&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cette limite peut Ãªtre configurÃ©e au niveau du cluster avec le paramÃ¨tre &lt;code&gt;pg_trgm.similarity_threshold&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;indexation-et-performances&#34;&gt;Indexation et performances&lt;/h2&gt;&#xA;&lt;h3 id=&#34;lindexation-btree-classique&#34;&gt;L&amp;rsquo;indexation BTREE classique&lt;/h3&gt;&#xA;&lt;p&gt;Les champs TEXT peuvent Ãªtre indexÃ©s classiquement avec un index BTREE :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# CREATE INDEX idx_test ON my_datas(family text_pattern_ops);&#xA;CREATE INDEX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cela permet de trouver rapidement des chaÃ®nes de caractÃ¨res ou des dÃ©buts de chaÃ®nes de caractÃ¨res :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family = &amp;#39;GRANGER&amp;#39;;&#xA;                                                     QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=10.09..2289.04 rows=731 width=8) (actual time=0.101..0.584 rows=658 loops=1)&#xA;   Recheck Cond: (family = &amp;#39;GRANGER&amp;#39;::text)&#xA;   Heap Blocks: exact=637&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test  (cost=0.00..9.91 rows=731 width=0) (actual time=0.047..0.047 rows=658 loops=1)&#xA;         Index Cond: (family = &amp;#39;GRANGER&amp;#39;::text)&#xA; Planning Time: 0.120 ms&#xA; Execution Time: 0.612 ms&#xA;(7 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family like  &amp;#39;GRAN%&amp;#39;;&#xA;                                                      QUERY PLAN&#xA;-----------------------------------------------------------------------------------------------------------------------&#xA; Index Scan using idx_test on my_datas  (cost=0.42..8.45 rows=66 width=8) (actual time=0.024..2.121 rows=3692 loops=1)&#xA;   Index Cond: ((family ~&amp;gt;=~ &amp;#39;GRAN&amp;#39;::text) AND (family ~&amp;lt;~ &amp;#39;GRAO&amp;#39;::text))&#xA;   Filter: (family ~~ &amp;#39;GRAN%&amp;#39;::text)&#xA; Planning Time: 0.137 ms&#xA; Execution Time: 2.234 ms&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cependant un tel index se rÃ©vÃ¨le inutile lorsqu&amp;rsquo;on ne connaÃ®t pas le dÃ©but de la chaÃ®ne recherchÃ©e. Dans ce cas on bascule sur un Seq Scan malgrÃ© la prÃ©sence de l&amp;rsquo;index :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family like  &amp;#39;%ANGER&amp;#39;;&#xA;                                                        QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------------&#xA; Gather  (cost=1000.00..17185.70 rows=6643 width=8) (actual time=0.196..36.796 rows=2585 loops=1)&#xA;   Workers Planned: 2&#xA;   Workers Launched: 2&#xA;   -&amp;gt;  Parallel Seq Scan on my_datas  (cost=0.00..15521.40 rows=2768 width=8) (actual time=0.027..33.117 rows=862 loops=3)&#xA;         Filter: (family ~~ &amp;#39;%ANGER&amp;#39;::text)&#xA;         Rows Removed by Filter: 332540&#xA; Planning Time: 0.071 ms&#xA; Execution Time: 36.894 ms&#xA;(8 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;indexation-des-trigrammes&#34;&gt;Indexation des trigrammes&lt;/h3&gt;&#xA;&lt;p&gt;Il est possible d&amp;rsquo;indexer les vecteurs de trigrammes avec un index GIN :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# CREATE INDEX idx_test_trgm ON my_datas USING GIN(family gin_trgm_ops);&#xA;CREATE INDEX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;La recherche sur la fin de chaÃ®ne de caractÃ¨res se fait maintenant en utilisant l&amp;rsquo;index nouvellement crÃ©Ã© :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family like  &amp;#39;%ANGER&amp;#39;;&#xA;                                                         QUERY PLAN&#xA;-----------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=94.35..9754.04 rows=6643 width=8) (actual time=1.422..3.197 rows=2585 loops=1)&#xA;   Recheck Cond: (family ~~ &amp;#39;%ANGER&amp;#39;::text)&#xA;   Heap Blocks: exact=2292&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..92.69 rows=6643 width=0) (actual time=1.193..1.194 rows=2585 loops=1)&#xA;         Index Cond: (family ~~ &amp;#39;%ANGER&amp;#39;::text)&#xA; Planning Time: 0.085 ms&#xA; Execution Time: 3.282 ms&#xA;(7 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Nous pouvons maintenant effectuer une recherche de similaritÃ© :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT DISTINCT family FROM my_datas WHERE family %  &amp;#39;GRANGER&amp;#39;;&#xA;                                                               QUERY PLAN&#xA;----------------------------------------------------------------------------------------------------------------------------------------&#xA; Unique  (cost=370.28..370.61 rows=64 width=7) (actual time=19.476..19.867 rows=6 loops=1)&#xA;   -&amp;gt;  Sort  (cost=370.28..370.45 rows=66 width=7) (actual time=19.474..19.632 rows=4284 loops=1)&#xA;         Sort Key: family&#xA;         Sort Method: quicksort  Memory: 264kB&#xA;         -&amp;gt;  Bitmap Heap Scan on my_datas  (cost=119.31..368.29 rows=66 width=7) (actual time=7.737..18.771 rows=4284 loops=1)&#xA;               Recheck Cond: (family % &amp;#39;GRANGER&amp;#39;::text)&#xA;               Rows Removed by Index Recheck: 3468&#xA;               Heap Blocks: exact=5458&#xA;               -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..119.29 rows=66 width=0) (actual time=7.173..7.173 rows=7752 loops=1)&#xA;                     Index Cond: (family % &amp;#39;GRANGER&amp;#39;::text)&#xA; Planning Time: 0.297 ms&#xA; Execution Time: 19.887 ms&#xA;(12 rows)&#xA;&#xA;loxodata_text=# SELECT DISTINCT family FROM my_datas WHERE family %  &amp;#39;GRANGER&amp;#39;;&#xA;  family&#xA;----------&#xA; GRAND&#xA; GRANGE&#xA; GRANGER&#xA; GRANIER&#xA; GRAS&#xA; LAGRANGE&#xA;(6 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cette recherche par similaritÃ© peut Ãªtre utile, votre serviteur en sait quelque chose avec son patronyme qui comporte un &amp;lsquo;B&amp;rsquo; muet et qui entraÃ®ne souvent moultes confusions lorsque je dois Ã©peler mon nom, et qui est donc Ã©crit souvent approximativement :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# SELECT DISTINCT family FROM my_datas WHERE family % &amp;#39;LEFEBVRE&amp;#39;;&#xA;  family&#xA;----------&#xA; LEFEBVRE&#xA; LEFEVRE&#xA; LEFEUVRE&#xA;(3 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;performances&#34;&gt;Performances&lt;/h3&gt;&#xA;&lt;p&gt;On peut voir que sur une recherche d&amp;rsquo;Ã©galitÃ©, ou bien sur une recherche de dÃ©but de chaÃ®ne, c&amp;rsquo;est l&amp;rsquo;index B-Tree qui est prÃ©fÃ©rÃ© par le planner :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family =  &amp;#39;LEFEBVRE&amp;#39;;&#xA;                                                           QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------------------&#xA; Index Only Scan using idx_test on my_datas  (cost=0.42..1370.94 rows=3801 width=7) (actual time=0.018..0.488 rows=4312 loops=1)&#xA;   Index Cond: (family = &amp;#39;LEFEBVRE&amp;#39;::text)&#xA;   Heap Fetches: 399&#xA; Planning Time: 0.340 ms&#xA; Execution Time: 0.615 ms&#xA;(5 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &amp;#39;LEFEBVRE%&amp;#39;;&#xA;                                                           QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------------------&#xA; Index Only Scan using idx_test on my_datas  (cost=0.42..1389.95 rows=3867 width=7) (actual time=0.010..0.729 rows=4312 loops=1)&#xA;   Index Cond: ((family ~&amp;gt;=~ &amp;#39;LEFEBVRE&amp;#39;::text) AND (family ~&amp;lt;~ &amp;#39;LEFEBVRF&amp;#39;::text))&#xA;   Filter: (family ~~ &amp;#39;LEFEBVRE%&amp;#39;::text)&#xA;   Heap Fetches: 399&#xA; Planning Time: 0.165 ms&#xA; Execution Time: 0.877 ms&#xA;(6 rows)&#xA;&#xA;loxodata_text=# drop index idx_test;&#xA;DROP INDEX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Il est cependant important de noter que si l&amp;rsquo;index B-Tree est prÃ©fÃ©rÃ© sur la recherche en dÃ©but de chaÃ®ne ( &lt;code&gt;LIKE &#39;xxxx%&#39;&lt;/code&gt; ) c&amp;rsquo;est parce que la classe d&amp;rsquo;opÃ©rateurs &lt;code&gt;text_pattern_ops&lt;/code&gt; a Ã©tÃ© utilisÃ©e lors de la crÃ©ation de l&amp;rsquo;index. Si nous crÃ©ons un index B-Tree sans cette classe d&amp;rsquo;opÃ©rateurs, il sera prÃ©fÃ©rÃ© pour une recherche d&amp;rsquo;Ã©galitÃ©, mais pas pour une recherche de dÃ©but de chaÃ®ne du fait des problÃ¨mes complexes liÃ©s aux &lt;code&gt;LOCALES&lt;/code&gt; des diffÃ©rentes langues :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# CREATE INDEX idx_test ON my_datas(family);&#xA;CREATE INDEX&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &amp;#39;LEFEBVRE%&amp;#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=139.26..7724.28 rows=3867 width=7) (actual time=2.370..5.048 rows=4312 loops=1)&#xA;   Recheck Cond: (family ~~ &amp;#39;LEFEBVRE%&amp;#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..138.29 rows=3867 width=0) (actual time=2.000..2.000 rows=4312 loops=1)&#xA;         Index Cond: (family ~~ &amp;#39;LEFEBVRE%&amp;#39;::text)&#xA; Planning Time: 0.162 ms&#xA; Execution Time: 5.179 ms&#xA;(7 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Si nous supprimons dÃ©finitivement l&amp;rsquo;index B-Tree, on voit que l&amp;rsquo;index sur les trigrammes est utilisÃ© efficacement pour une recherche d&amp;rsquo;Ã©galitÃ© (seulement aprÃ¨s PG v13) mais pas aussi efficacement qu&amp;rsquo;avec l&amp;rsquo;index B-Tree (coÃ»t estimÃ© 7666 vs 1370). Cependant ce coÃ»t est remarquablement constant que la recherche se fasse sur une Ã©galitÃ©, un dÃ©but de chaÃ®ne (&lt;code&gt;LIKE &#39;xxx%&#39;&lt;/code&gt;) ou une recherche sur une sous-chaÃ®ne (&lt;code&gt;LIKE &#39;%xxx%&#39;&lt;/code&gt;).&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family =  &amp;#39;LEFEBVRE&amp;#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=151.72..7666.35 rows=3801 width=7) (actual time=3.331..6.085 rows=4312 loops=1)&#xA;   Recheck Cond: (family = &amp;#39;LEFEBVRE&amp;#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..150.77 rows=3801 width=0) (actual time=2.961..2.962 rows=4312 loops=1)&#xA;         Index Cond: (family = &amp;#39;LEFEBVRE&amp;#39;::text)&#xA; Planning Time: 0.095 ms&#xA; Execution Time: 6.298 ms&#xA;(7 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &amp;#39;LEFEBVRE%&amp;#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=139.26..7724.28 rows=3867 width=7) (actual time=2.632..5.366 rows=4312 loops=1)&#xA;   Recheck Cond: (family ~~ &amp;#39;LEFEBVRE%&amp;#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..138.29 rows=3867 width=0) (actual time=2.263..2.263 rows=4312 loops=1)&#xA;         Index Cond: (family ~~ &amp;#39;LEFEBVRE%&amp;#39;::text)&#xA; Planning Time: 0.075 ms&#xA; Execution Time: 5.584 ms&#xA;(7 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &amp;#39;%LEFEBVRE%&amp;#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=109.52..7694.54 rows=3867 width=7) (actual time=1.628..4.402 rows=4312 loops=1)&#xA;   Recheck Cond: (family ~~ &amp;#39;%LEFEBVRE%&amp;#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..108.55 rows=3867 width=0) (actual time=1.260..1.260 rows=4312 loops=1)&#xA;         Index Cond: (family ~~ &amp;#39;%LEFEBVRE%&amp;#39;::text)&#xA; Planning Time: 0.078 ms&#xA; Execution Time: 4.603 ms&#xA;(7 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Si un champ texte fait l&amp;rsquo;objet d&amp;rsquo;une recherche d&amp;rsquo;Ã©galitÃ© dans une clause &lt;code&gt;WHERE&lt;/code&gt;, un index B-Tree est parfaitement adÃ©quat.&lt;/li&gt;&#xA;&lt;li&gt;Si un champ texte fait l&amp;rsquo;objet d&amp;rsquo;une recherche sur un dÃ©but de chaÃ®ne de type &lt;code&gt;WHERE champ LIKE &#39;ABC%&#39;&lt;/code&gt; , un index B-Tree est lÃ  encore adÃ©quat, Ã  condition de lui spÃ©cifier la classe d&amp;rsquo;opÃ©rateurs &lt;code&gt;text_pattern_ops&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Si un champ texte fait l&amp;rsquo;objet d&amp;rsquo;une recherche sur une sous-chaÃ®ne de type &lt;code&gt;WHERE champ LIKE &#39;%ABC%&#39;&lt;/code&gt; , seul un index GIN ou GiST sur les trigrammes sera utile.&lt;/li&gt;&#xA;&lt;li&gt;Lorsqu&amp;rsquo;un index sur les trigrammes a Ã©tÃ© crÃ©Ã©, dans la plupart des cas l&amp;rsquo;index B-Tree peut Ãªtre supprimÃ©. Cependant, du fait de la meilleure efficacitÃ© du B-Tree, il peut Ãªtre pertinent dans de rares occasions de conserver Ã©galement l&amp;rsquo;index B-Tree.&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Retour sur la PG Conf Europe 2024</title>
    <updated>2025-02-24T14:10:00Z</updated>
    <id>tag:www.loxodata.com,2025-02-24:/post/pgconf-eu-2024-report/</id>
    <link href="http://www.loxodata.com/post/pgconf-eu-2024-report/" rel="alternate"></link>
    <summary type="html">&lt;h2 id=&#34;retour-sur-la-pg-conf-europe-2024&#34;&gt;Retour sur la PG Conf Europe 2024&lt;/h2&gt;&#xA;&lt;p&gt;Cette annÃ©e, la PostgreSQL Conference Europe 2024 s&amp;rsquo;est dÃ©roulÃ©e Ã &#xA;AthÃ¨nes, en GrÃ¨ce, Ã  quelques hectomÃ¨tres de l&amp;rsquo;acropole. Ã€ nouveau, un&#xA;record d&amp;rsquo;affluence est battu cette annÃ©e avec 779 participants, ce qui&#xA;en fait l&amp;rsquo;Ã©vÃ¨nement PostgreSQL le plus important au monde.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;http://www.loxodata.com/images/post/pgconf-eu-2024/athena-noctua.jpg&#34; alt=&#34;La chouette d&amp;rsquo;AthÃ©na&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;La liste des confÃ©rences est disponible sur le site de&#xA;l&amp;rsquo;Ã©vÃ¨nementÂ : &lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/&#34;&gt;https://2024.pgconf.eu/&lt;/a&gt;.&#xA;Les supports de prÃ©sentations, ainsi que les enregistrements vidÃ©os sont&#xA;Ã©galement mis Ã  disposition.&lt;/p&gt;&#xA;&lt;p&gt;La &lt;a href=&#34;https://buff.ly/4b483Ff&#34;&gt;confÃ©rence d&amp;rsquo;ouverture&lt;/a&gt; est donnÃ©e par Stacey Haysler. Le sujet&#xA;abordÃ© est celui du coÃ»t de la licence PostgreSQL. Cette derniÃ¨re&#xA;Ã©tant gratuite, elle demande une implication des diffÃ©rents acteurs&#xA;pour que le projet puisse fonctionner et demeurer robuste et pÃ©renne.&lt;/p&gt;&#xA;&lt;p&gt;Les confÃ©rences sont ensuite rÃ©parties dans diffÃ©rentes salles, avec 4&#xA;confÃ©rences simultanÃ©es, dont une rÃ©servÃ©e aux sponsors. Nous rÃ©sumons&#xA;ici nos notes Ã  propos des prÃ©sentations auxquelles nous avons&#xA;assistÃ©.&lt;/p&gt;&#xA;&lt;h2 id=&#34;performance&#34;&gt;Performance&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://anarazel.de/talks/2024-10-23-pgconf-eu-numa-vs-postgresql/numa-vs-postgresql.pdf&#34;&gt;NUMA vs PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Andres Freund nous explique les particularitÃ©s de NUMA, qui est une&#xA;architecture d&amp;rsquo;accÃ¨s Ã  la mÃ©moire, ce qui a des consÃ©quences pour les&#xA;processeurs, et donc les logiciels qui s&amp;rsquo;en servent. Quels sont les&#xA;problÃ¨mes rencontrÃ©s dans le contexte de l&amp;rsquo;utilisation de PostgreSQL ?&#xA;Cette prÃ©sentation est complexe, mais dÃ©taillÃ©e et permet Ã  l&amp;rsquo;auditoire&#xA;de mieux comprendre le comportement global des systÃ¨mes, tout en&#xA;ouvrant vers des optimisations possibles de PostgreSQL.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5720/slides/608/Streaming%20I_O.pdf&#34;&gt;Streaming I/O and vectored I/O&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Les orateurs Thomas Munro &amp;amp; Nazir Bilal Yavuz dÃ©taillent un point&#xA;important concernant les performances des lectures et Ã©critures de&#xA;donnÃ©es (I/O) : aprÃ¨s un historique des solutions, ils expliquent ce&#xA;que sont les solutions modernes telles que les Streaming I/O et que peut&#xA;apporter le patch AIO qui est en cours de dÃ©veloppement.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/session/5689-debugging-active-queries-with-mid-flight-instrumented-explain-plans/&#34;&gt;Debugging active queries with mid-flight instrumented explain plans&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Rafael Thofehrn Castro nous prÃ©sente des extensions et patchs pour&#xA;suivre les plans d&amp;rsquo;exÃ©cutions Ã  la volÃ©e dans une instance&#xA;PostgreSQL. C&amp;rsquo;est bluffant, malheureusement rien n&amp;rsquo;est disponible&#xA;publiquement.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5747/slides/559/postgres_statistics_presentation.pdf&#34;&gt;A Deep Dive into Postgres Statistics&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Louise Leinweber dÃ©taille de faÃ§on claire et prÃ©cise ce que sont les&#xA;statistiques sur les donnÃ©es dans PostgreSQL, comment elles sont&#xA;utilisÃ©es dans PostgreSQL et quels leviers nous avons pour agir.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/session/6035-porting-on-prem-performance-troubleshooting-skills-to-the-cloud/&#34;&gt;Porting on-prem performance troubleshooting skills to the cloud&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Denzil Ribeiro Ã©voque l&amp;rsquo;outillage nÃ©cessaire Ã  la supervision d&amp;rsquo;une&#xA;instance PostgreSQL dans le cloud, en particulier tout ce qui est&#xA;spÃ©cifique aux environnements clouds, trÃ¨s utile lorsqu&amp;rsquo;on vient&#xA;d&amp;rsquo;environnements dits &amp;ldquo;on-premise&amp;rdquo;.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5870/slides/572/PostgreSQL%20Observed%E2%80%94%20and%20Explained.pdf&#34;&gt;PostgreSQL Observedâ€”and Explained&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Stacey Haysler et Karen Jex utilisent quelques points emblÃ©matiques&#xA;des problÃ¨mes souvent rencontrÃ©s par les utilisateurs de PostgreSQL&#xA;pour Ã©voquer les bonnes ou mauvaises pratiques et certains&#xA;anti-patterns connus.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/session/5812-vacuuming-large-tables-how-recent-postgres-changes-further-enable-mission-critical-workloads/&#34;&gt;Vacuuming Large Tables: How Recent Postgres Changes Further Enable Mission Critical Workloads&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Robert Treat Ã©voque avec humour ses mÃ©saventures avec les vacuums et&#xA;les ID de transactions, et les amÃ©liorations apportÃ©es depuis dans&#xA;PostgreSQL 17.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5768/slides/619/Postgres%20Partitioning%20-%20Slicing%20and%20Dicing.pdf&#34;&gt;Mastering PostgreSQL Partitioning: Supercharge Performance and Simplify Maintenance&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Ryan Booz Ã©voque un outil trÃ¨s utile en ce qui concerne la gestion de&#xA;la performanceÂ : le partitionnement des tables, ses diffÃ©rentes&#xA;possibilitÃ©s et cas d&amp;rsquo;usage, jusqu&amp;rsquo;aux extensions que sont TimescaleDB&#xA;et Citus.&lt;/p&gt;&#xA;&lt;h2 id=&#34;high-availibility&#34;&gt;High availibility&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5916/slides/578/bmejias_Sparta_Dual_Kings_PG_Active_Active.pdf&#34;&gt;Sparta&amp;rsquo;s Dual Kingship and PostgreSQL Active-Active&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Boriss MejÃ­as dÃ©taille le fonctionnement d&amp;rsquo;une rÃ©plication&#xA;active-active, avec toutes les notions, plus ou moins complexes, qui&#xA;permettent de bien comprendre les contraintes qu&amp;rsquo;imposent ce type de&#xA;rÃ©plication.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5892/slides/544/patroni-deployment-patterns.pdf&#34;&gt;Patroni Deployment Patterns&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Michael Banck expose de faÃ§on pratique et claire le fonctionnement de&#xA;Patroni, avec quelques Ã©lÃ©ments pertinents Ã  retenir, correspondant Ã  son&#xA;expÃ©rience.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5846/slides/547/comparing_poolers.pdf&#34;&gt;Comparing Connection Poolers for PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Julian Markwort compare les diffÃ©rents gestionnaires de connexions&#xA;entre eux. Quelles sont les diffÃ©rentes questions qui se posent pour&#xA;adopter un tel outil, et pourquoi faut-il choisir pgBouncer ?&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5853/slides/567/Speeding%20up%20logical%20replication%20setup.pdf&#34;&gt;Speeding up logical replication setup&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Euler Taveira prÃ©sente le dÃ©veloppement qu&amp;rsquo;il a menÃ© dans PostgreSQL&#xA;pour intÃ©grÃ© l&amp;rsquo;outil &lt;code&gt;pg_createsubscriber&lt;/code&gt; qui permet de convertir une&#xA;rÃ©plication physique en rÃ©plication logique, accÃ©lÃ©rant ainsi la&#xA;crÃ©ation d&amp;rsquo;un rÃ©plica logique.&lt;/p&gt;&#xA;&lt;h3 id=&#34;kubernetes&#34;&gt;Kubernetes&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/6038/slides/552/CPK%20Your%20Virtual%20DBA.pdf&#34;&gt;Crunchy Postgres for Kubernetes: Your virtual DBA&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Karen Jex explique le fonctionnement de Kubernetes et l&amp;rsquo;utilisation de&#xA;l&amp;rsquo;opÃ©rateur Crunchy Postgres, et comment son fonctionnement s&amp;rsquo;articule&#xA;avec le rÃ´le et les responsabilitÃ©s d&amp;rsquo;un administrateur de bases de&#xA;donnÃ©es.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5584/slides/576/PGConf.EU%20-%20Demystifying%20Kubernetes%20for%20Postgres%20DBAs.pdf&#34;&gt;Demystifying Kubernetes for Postgres DBAs: A Guide to Operators&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Adam Wright Ã©voque le lien entre Kubernetes et PostgreSQLÂ : les&#xA;opÃ©rateursÂ ! DiffÃ©rents opÃ©rateurs pour PostgreSQL existent et ne sont&#xA;pas strictement Ã©quivalents, ce qui nÃ©cessite une comprÃ©hension de&#xA;chacun d&amp;rsquo;entre eux de la part de l&amp;rsquo;administrateur de bases de donnÃ©es&#xA;pour les adopterÂ : sÃ©curitÃ©, rÃ©seau, sauvegarde, stockage, extension.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5829/slides/554/202410-pgconf-From%20VMs%20to%20Cloud-Native%20PostgreSQL%20in%20Kubernetes.pdf&#34;&gt;From VMs to Cloud-Native PostgreSQL in Kubernetes: A Case Study of Migrating a Medium-Sized Application&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;David Pech fait le retour d&amp;rsquo;expÃ©rience d&amp;rsquo;une migration d&amp;rsquo;instance&#xA;PostgreSQL depuis des machines virtuelles vers un cluster&#xA;Kubernetes. Le choix de l&amp;rsquo;opÃ©rateur Kubernetes est un point important&#xA;de la dÃ©marche. AprÃ¨s avoir fait tomber quelques mythes autour de&#xA;Kubernetes, l&amp;rsquo;orateur dÃ©taille de plan de travail pour adopter la&#xA;solution.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/session/5654-fun-with-postgres-high-availability-poker/&#34;&gt;Fun with Postgres High Availability Poker&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Dave Pitts et Derk Van Veen introduisent les concepts de haute&#xA;disponibilitÃ© de PostgreSQL par le jeu, ce qui est toujours une bonne&#xA;maniÃ¨re d&amp;rsquo;apprendre.&lt;/p&gt;&#xA;&lt;h2 id=&#34;intelligence-artificielle&#34;&gt;Intelligence artificielle&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5830/slides/609/pgconfeu-2024-vectors-internal.pdf&#34;&gt;Dissimilarity search: implementing in-memory vector search algorithms to PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Jonathan Katz parle de l&amp;rsquo;extension pgvector, qui est une possibilitÃ©&#xA;offerte aux utilisateurs de PostgreSQL de vectoriser des donnÃ©es et de&#xA;faire des recherches par approximation.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5579/slides/575/AIfortheDBA_pgconfeu.pdf&#34;&gt;Leveraging AI as a PostgreSQL DBA, Grant Fritchey&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Grant Fritchey se demande si les prompts d&amp;rsquo;IA sont de bons outils pour&#xA;les DBAÂ ? Quelles sont les diffÃ©rentes tÃ¢ches du DBA qui pourraient&#xA;bÃ©nÃ©ficier de l&amp;rsquo;aide d&amp;rsquo;un assistant conversationnelÂ ?&lt;/p&gt;&#xA;&lt;h2 id=&#34;sÃ©curitÃ©&#34;&gt;SÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://l_avrot.gitlab.io/slides/permissions_20241023.html#/&#34;&gt;Untangling the Web of PostgreSQL Permissions&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;LÃ¦titia Avrot Ã©voque l&amp;rsquo;ensemble des fonctionnalitÃ©s liÃ©es aux&#xA;permissions dans PostgreSQLÂ : rÃ´le, groupe, privilÃ¨ges, Row Level&#xA;Security, privilÃ¨ges par dÃ©faut.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5554/slides/555/PostgreSQL_Security_PgConf2024_Export.pdf&#34;&gt;PostgreSQL security: defending against external Attacks&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Taras Kloba dÃ©taille un sujet trÃ¨s important, quoique parfois trop&#xA;nÃ©gligÃ©Â : comment protÃ©ger PostgreSQL contre les attaques. Des mises Ã &#xA;jour de sÃ©curitÃ© Ã  la gestion de l&amp;rsquo;authentification en passant par la&#xA;protection des donnÃ©es, cette prÃ©sentation fait la liste des points Ã &#xA;retenir en termes de sÃ©curitÃ©.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/session/5645-column-encryption-solutions-and-ideas/&#34;&gt;Column encryption (solutions and ideas)&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Peter Eisentraut fait le tour des besoins et solutions de chiffrement&#xA;de donnÃ©es disponibles avec PostgreSQL.&lt;/p&gt;&#xA;&lt;h2 id=&#34;autres&#34;&gt;Autres&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5710/slides/549/csn-snapshots.pdf&#34;&gt;High-concurrency distributed snapshots, Ants Aasma&lt;/a&gt; :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Le modÃ¨le actuel de snapshot, qui autorise la visibilitÃ© des&#xA;enregistrements, est maintenant vieux de plus de vingt ansÂ : quel&#xA;modÃ¨le peut-il le remplacer, en prenant en compte la croissance de la&#xA;concurrence d&amp;rsquo;accÃ¨s. L&amp;rsquo;orateur Ã©voque alors les notions de Commit&#xA;Sequence Number ou d&amp;rsquo;un modÃ¨le hybride.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5630/slides/562/undelete_from_table.pdf&#34;&gt;UNDELETE data FROM table;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Christoph Berg explique en dÃ©tail le fonctionnement de PostgreSQL&#xA;lorsqu&amp;rsquo;on lui demande de supprimer un enregistrement, et ce qu&amp;rsquo;il est&#xA;possible de faire pour retrouver cet enregistrement avec l&amp;rsquo;extension&#xA;&lt;code&gt;pg_dirtyread&lt;/code&gt; ou la commande &lt;code&gt;pg_waldump&lt;/code&gt;. Dans tous les cas, faites&#xA;des sauvegardesÂ !&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/sessions/session/5748/slides/588/PGConf.EU.2024_pg_ivm.pdf&#34;&gt;pg_ivm : extension for rapid incremental view&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Yugo Nagata prÃ©sente l&amp;rsquo;extension &lt;code&gt;pg_ivm&lt;/code&gt; qui permet de crÃ©er des vues&#xA;matÃ©rialisÃ©es incrÃ©mentales, qui sont donc mises Ã  jour rapidement,&#xA;contrairement aux vues matÃ©rialisÃ©es existantes dans PostgreSQL qui&#xA;nÃ©cessitent une rÃ©gÃ©nÃ©ration entiÃ¨re.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17.4 et autres correctifs</title>
    <updated>2025-02-20T14:30:00Z</updated>
    <id>tag:www.loxodata.com,2025-02-20:/post/postgresql-17-4/</id>
    <link href="http://www.loxodata.com/post/postgresql-17-4/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le PGDG (PostgreSQL Global Development Group) a publiÃ© une mise Ã  jour&#xA;de toutes les versions supportÃ©es de PostgreSQL, incluant 17.4, 16.8, 15.12,&#xA;14.17 et 13.20.&lt;/p&gt;&#xA;&lt;p&gt;Pour la liste complÃ¨te des changements, se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;note de publication de versions&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;corrections-de-bogues-et-amÃ©liorations&#34;&gt;Corrections de bogues et amÃ©liorations&lt;/h2&gt;&#xA;&lt;p&gt;Les problÃ¨mes ci-dessous concernent PostgreSQL 17. Certains de ces problÃ¨mes&#xA;peuvent aussi concerner d&amp;rsquo;autres versions de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Les correctifs sontÂ :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AmÃ©lioration du comportement des fonctions d&amp;rsquo;Ã©chappement de la bibliothÃ¨que &lt;a href=&#34;https://www.postgresql.org/docs/current/libpq.html&#34;&gt;&lt;code&gt;libpq&lt;/code&gt;&lt;/a&gt;.&#xA;Le correctif de la vulnÃ©rabilitÃ© &lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-1094/&#34;&gt;CVE-2025-1094&lt;/a&gt;&#xA;a introduit une rÃ©gression amenant les fonctions d&amp;rsquo;Ã©chappement Ã  ne pas respecter&#xA;les tailles des chaÃ®nes de caractÃ¨res fournies en paramÃ¨tres, entraÃ®nant dans&#xA;certains cas des plantages. Ce problÃ¨me peut impacter une bibliothÃ¨que cliente de&#xA;PostgreSQL en fonction de son intÃ©gration Ã  la bibliothÃ¨que &lt;code&gt;libpq&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;Correction de fuites mÃ©moire dans la commande &lt;a href=&#34;https://www.postgresql.org/docs/current/app-pgcreatesubscriber.html&#34;&gt;pg_createsubscriber&lt;/a&gt; ;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;mise-Ã -jour&#34;&gt;Mise Ã  jour&lt;/h2&gt;&#xA;&lt;p&gt;Toutes les publications de mises Ã  jour de PostgreSQL sont&#xA;cumulatives. Comme pour les autres mises Ã  jour mineures, il n&amp;rsquo;est pas&#xA;nÃ©cessaire d&amp;rsquo;extraire et de recharger les bases de donnÃ©es ni&#xA;d&amp;rsquo;utiliser &lt;code&gt;pg_upgrade&lt;/code&gt; pour appliquer cette mise Ã  jourÂ ;&#xA;il suffit simplement d&amp;rsquo;arrÃªter PostgreSQL et de mettre Ã  jour les binaires.&lt;/p&gt;&#xA;&lt;p&gt;Les utilisateurs ayant sautÃ© une ou plusieurs mises Ã  jour peuvent&#xA;avoir besoin d&amp;rsquo;Ã©tapes additionnelles aprÃ¨s la mise Ã  jour.&#xA;Les notes de publication des versions prÃ©cÃ©dentes fournissent les dÃ©tails.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus de dÃ©tails, se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;note de publication de versions&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;liens&#34;&gt;Liens&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargements&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;Notes de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/&#34;&gt;Page sur la sÃ©curitÃ©&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;Politique de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Si vous avez des corrections ou suggestions sur cette annonce de publication, merci de les envoyer Ã  la mailing liste publique &lt;a href=&#34;https://www.postgresql.org/list/&#34;&gt;&lt;em&gt;pgsql-www@lists.postgresql.org&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17.3 et autres correctifs</title>
    <updated>2025-02-14T15:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-02-14:/post/postgresql-17-3/</id>
    <link href="http://www.loxodata.com/post/postgresql-17-3/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le PGDG (PostgreSQL Global Development Group) a publiÃ© une mise Ã  jour&#xA;de toutes les versions supportÃ©es de PostgreSQL, incluant 17.3, 16.7,&#xA;15.11, 14.16, 13.19.&lt;/p&gt;&#xA;&lt;p&gt;Cette publication corrige Ã©galement une vulnÃ©rabilitÃ© de sÃ©curitÃ© et plus de 70 bogues&#xA;reportÃ©s dans les mois prÃ©cÃ©dents.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, le PGDG a annoncÃ© mettre Ã  disposition le &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-4-ooc-release/&#34;&gt;20 fÃ©vrier&lt;/a&gt;&#xA;prochain un correctif suite Ã  l&amp;rsquo;introduction d&amp;rsquo;une rÃ©gression sur cette mise Ã  jour.&#xA;Il est recommandÃ© de ne pas procÃ©der Ã  cette mise Ã  jour, mais d&amp;rsquo;attendre la&#xA;version 17.4.&lt;/p&gt;&#xA;&lt;h2 id=&#34;problÃ¨mes-de-sÃ©curitÃ©&#34;&gt;ProblÃ¨mes de sÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-1094/&#34;&gt;CVE-2025-1094&lt;/a&gt; :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;CVSS v3.1 Base Score: &lt;a href=&#34;https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?version=3.1&amp;amp;vector=AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H&#34;&gt;8.1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;Supported, Vulnerable Versions: 13 - 17.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Une neutralisation inadÃ©quate d&amp;rsquo;une syntaxe avec guillemets dans les fonctions de &lt;a href=&#34;https://www.postgresql.org/docs/current/libpq.html&#34;&gt;&lt;code&gt;libpq&lt;/code&gt;&lt;/a&gt; &lt;code&gt;PQescapeLiteral()&lt;/code&gt;, &lt;code&gt;PQescapeIdentifier()&lt;/code&gt;, &lt;code&gt;PQescapeString()&lt;/code&gt; et &lt;code&gt;PQescapeStringConn()&lt;/code&gt; permet de faire de l&amp;rsquo;injection SQL dans certains cas d&amp;rsquo;usage. SpÃ©cifiquement, l&amp;rsquo;injection SQL requiert Ã  l&amp;rsquo;application d&amp;rsquo;utiliser le rÃ©sultat de fonction pour construite l&amp;rsquo;entrÃ©e de &lt;code&gt;psql&lt;/code&gt;,&#xA;le terminal interactif de PostgreSQL. De mÃªme, une neutralisation inadÃ©quate d&amp;rsquo;une syntaxe avec guillemets dans les programmes utilitaires de PostgreSQL en ligne de commande permet Ã  une source d&amp;rsquo;arguments Ã  ces commandes en ligne d&amp;rsquo;effectuer de l&amp;rsquo;injection SQL lorsque le paramÃ¨tre &lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-client.html#GUC-CLIENT-ENCODING&#34;&gt;&lt;code&gt;client_encoding&lt;/code&gt;&lt;/a&gt; est &lt;code&gt;BIG5&lt;/code&gt; et &lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-preset.html#GUC-SERVER-ENCODING&#34;&gt;&lt;code&gt;server_encoding&lt;/code&gt;&lt;/a&gt; est soit &lt;code&gt;EUC_TW&lt;/code&gt; soit &lt;code&gt;MULE_INTERNAL&lt;/code&gt;. Les versions antÃ©rieures Ã  PostgreSQL 17.3, 16.7, 15.11, 14.16 et 13.19 sont affectÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Le projet PostgreSQL remercie Stephen Fewer, Principal Security Researcher, Rapid7 pour avoir signalÃ© ce problÃ¨me.&lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;h2 id=&#34;corrections-de-bogues-et-amÃ©liorations&#34;&gt;Corrections de bogues et amÃ©liorations&lt;/h2&gt;&#xA;&lt;p&gt;Cette mise Ã  jour corrige plus de 70 bogues ayant Ã©tÃ© reportÃ©s durant les mois prÃ©cÃ©dents. Les problÃ¨mes ci-dessous concernent PostgreSQL 17. Certains de ces problÃ¨mes peuvent aussi concerner d&amp;rsquo;autres versions de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Les correctifs sont :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;restauration du comportement d&amp;rsquo;avant la version 17 concernant la troncature des noms&#xA;de bases de donnÃ©es de plus de 63 octets et les noms d&amp;rsquo;utilisateurs dans les&#xA;requÃªtes de connexion ;&lt;/li&gt;&#xA;&lt;li&gt;ne pas vÃ©rifier des privilÃ¨ges de connexions et limites sur les processus&#xA;parallÃ¨les, mais les hÃ©riter du processus principal ;&lt;/li&gt;&#xA;&lt;li&gt;suppression du suffixe &lt;code&gt;Lock&lt;/code&gt; des noms d&amp;rsquo;Ã©vÃ¨nements d&amp;rsquo;attente &lt;code&gt;LWLock&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;correction de la rÃ©utilisation de rÃ©sultats obsolÃ¨tes dans les agrÃ©gats de&#xA;fenÃªtrage qui peuvent conduire Ã  des rÃ©sultats incorrects ;&lt;/li&gt;&#xA;&lt;li&gt;correction de plusieurs conditions de concurrence pour &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-vacuum.html&#34;&gt;&lt;code&gt;vacuum&lt;/code&gt;&lt;/a&gt;&#xA;qui dans le pire des cas peut conduire Ã  une corruption du catalogue systÃ¨me ;&lt;/li&gt;&#xA;&lt;li&gt;corrections sur la &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-truncate.html&#34;&gt;&lt;code&gt;TRUNCATE&lt;/code&gt;&lt;/a&gt;&#xA;de tables et d&amp;rsquo;index pour prÃ©venir une Ã©ventuelle corruption ;&lt;/li&gt;&#xA;&lt;li&gt;correction sur le dÃ©tachement d&amp;rsquo;une partition lorsque sa propre contrainte de&#xA;clÃ© Ã©trangÃ¨re fait rÃ©fÃ©rence Ã  une table partitionnÃ©e ;&lt;/li&gt;&#xA;&lt;li&gt;correction pour les codes de format &lt;code&gt;FFn&lt;/code&gt; (par exemple &lt;code&gt;FF1&lt;/code&gt;) pour &lt;code&gt;to_timestamp&lt;/code&gt;,&#xA;oÃ¹ un code de format entier avant le &lt;code&gt;FFn&lt;/code&gt; consommait tous les chiffres disponibles ;&lt;/li&gt;&#xA;&lt;li&gt;corrections pour &lt;code&gt;SQL/JSON&lt;/code&gt; et &lt;code&gt;XMLTABLE()&lt;/code&gt; pour mettre des entrÃ©es spÃ©cifiques&#xA;entre guillemets lorsque cela est nÃ©cessaire ;&lt;/li&gt;&#xA;&lt;li&gt;inclusion de l&amp;rsquo;option &lt;code&gt;ldapscheme&lt;/code&gt; dans la vue &lt;a href=&#34;https://www.postgresql.org/docs/current/view-pg-hba-file-rules.html&#34;&gt;&lt;code&gt;pg_hba_file_rules()&lt;/code&gt;&lt;/a&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;corrections pour &lt;a href=&#34;https://www.postgresql.org/docs/current/queries-union.html&#34;&gt;&lt;code&gt;UNION&lt;/code&gt;&lt;/a&gt;,&#xA;y compris le fait de ne pas fusionner des colonnes avec des collations non&#xA;compatibles ;&lt;/li&gt;&#xA;&lt;li&gt;corrections pouvant avoir un impact sur la disponibilitÃ© ou la vitesse de dÃ©marrage&#xA;d&amp;rsquo;une connexion Ã  PostgreSQL ;&lt;/li&gt;&#xA;&lt;li&gt;correction de plusieurs fuites mÃ©moire dans la sortie du dÃ©codage logique ;&lt;/li&gt;&#xA;&lt;li&gt;correction de plusieurs fuites mÃ©moire avec le langage &lt;a href=&#34;https://www.postgresql.org/docs/current/plpython.html&#34;&gt;&lt;code&gt;PL/Python&lt;/code&gt;&lt;/a&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;ajout de l&amp;rsquo;autocomplÃ©tion pour la commande &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-copy.html&#34;&gt;&lt;code&gt;COPY&lt;/code&gt; (&lt;code&gt;MERGE INTO&lt;/code&gt;)&lt;/a&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;rendre &lt;a href=&#34;https://www.postgresql.org/docs/current/app-pgcontroldata.html&#34;&gt;&lt;code&gt;pg_controldata&lt;/code&gt;&lt;/a&gt;&#xA;plus rÃ©silient lors de l&amp;rsquo;affichage d&amp;rsquo;informations provenant de fichiers &lt;a href=&#34;https://www.postgresql.org/docs/current/wal-internals.html&#34;&gt;&lt;code&gt;pg_control&lt;/code&gt;&lt;/a&gt;&#xA;corrompus ;&lt;/li&gt;&#xA;&lt;li&gt;correction d&amp;rsquo;une fuite mÃ©moire sur la commande &lt;a href=&#34;https://www.postgresql.org/docs/current/app-pgrestore.html&#34;&gt;&lt;code&gt;pg_restore&lt;/code&gt;&lt;/a&gt;&#xA;avec des donnÃ©es compressÃ©es via &lt;code&gt;zstd&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;correction de &lt;a href=&#34;https://www.postgresql.org/docs/current/app-pgbasebackup.html&#34;&gt;&lt;code&gt;pg_basebackup&lt;/code&gt;&lt;/a&gt;&#xA;pour gÃ©rer correctement les fichiers &lt;code&gt;pg_wal.tar&lt;/code&gt; de plus de 2GB sur Windows ;&lt;/li&gt;&#xA;&lt;li&gt;modification sur le module &lt;a href=&#34;https://www.postgresql.org/docs/current/earthdistance.html&#34;&gt;&lt;code&gt;earthdistance&lt;/code&gt;&lt;/a&gt;&#xA;pour utiliser le canevas des fonctions standards SQL pour corriger des problÃ¨mes&#xA;sur des mises Ã  jour majeures vers la version 17 quand l&amp;rsquo;extension &lt;a href=&#34;https://www.postgresql.org/docs/current/earthdistance.html&#34;&gt;&lt;code&gt;earthdistance&lt;/code&gt;&lt;/a&gt;&#xA;est utilisÃ©e ;&lt;/li&gt;&#xA;&lt;li&gt;corrige des erreurs avec &lt;a href=&#34;https://www.postgresql.org/docs/current/pageinspect.html&#34;&gt;&lt;code&gt;pageinspect&lt;/code&gt;&lt;/a&gt;&#xA;dans des instances oÃ¹ la dÃ©finition de la fonction &lt;code&gt;brin_page_items()&lt;/code&gt; n&amp;rsquo;est pas&#xA;Ã  jour de la derniÃ¨re version ;&lt;/li&gt;&#xA;&lt;li&gt;corrige des conditions de concurrence lors de tentative d&amp;rsquo;annulation d&amp;rsquo;une&#xA;requÃªte distante avec &lt;a href=&#34;https://www.postgresql.org/docs/current/postgres-fdw.html&#34;&gt;&lt;code&gt;postgres_fdw&lt;/code&gt;&lt;/a&gt; ;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cette publication met aussi Ã  jour les fichiers de fuseaux horaires avec la&#xA;publication de &lt;code&gt;tzdata&lt;/code&gt; 2025a pour les changements de lois DST au Paraguay, plus&#xA;des corrections historiques pour les Philippines.&lt;/p&gt;&#xA;&lt;h2 id=&#34;mise-Ã -jour&#34;&gt;Mise Ã  jour&lt;/h2&gt;&#xA;&lt;p&gt;Toutes les publications de mises Ã  jour de PostgreSQL sont&#xA;cumulatives. Comme pour les autres mises Ã  jour mineures, il n&amp;rsquo;est pas&#xA;nÃ©cessaire d&amp;rsquo;extraire et de recharger les bases de donnÃ©es ni&#xA;d&amp;rsquo;utiliser &lt;code&gt;pg_upgrade&lt;/code&gt; pour appliquer cette mise Ã  jourÂ ;&#xA;il suffit simplement d&amp;rsquo;arrÃªter PostgreSQL et de mettre Ã  jour les binaires.&lt;/p&gt;&#xA;&lt;p&gt;Les utilisateurs ayant sautÃ© une ou plusieurs mises Ã  jour peuvent&#xA;avoir besoin d&amp;rsquo;Ã©tapes additionnelles aprÃ¨s la mise Ã  jour.&#xA;Les notes de publication des versions prÃ©cÃ©dentes fournissent les dÃ©tails.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus de dÃ©tails, se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;note de publication de versions&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;liens&#34;&gt;Liens&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargements&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;Notes de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/&#34;&gt;Page sur la sÃ©curitÃ©&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;Politique de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Si vous avez des corrections ou suggestions sur cette annonce de publication, merci de les envoyer Ã  la mailing liste publique &lt;a href=&#34;https://www.postgresql.org/list/&#34;&gt;&lt;em&gt;pgsql-www@lists.postgresql.org&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Correctif hors cycle pour PostgreSQL</title>
    <updated>2025-02-14T08:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-02-14:/post/postgresql-17-4-ooc-release/</id>
    <link href="http://www.loxodata.com/post/postgresql-17-4-ooc-release/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le &lt;a href=&#34;https://www.postgresql.org/&#34;&gt;PGDG&lt;/a&gt; prÃ©voit une livraison hors cycle pour le 20 fÃ©vrier 2025 afin de corriger une rÃ©gression introduite sur la &lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-173-167-1511-1416-and-1319-released-3015/&#34;&gt;mise Ã  jour du 13 fÃ©vrier 2025&lt;/a&gt; portant sur les versions mineures : 17.3, 16.7, 15.11, 14.16 et 13.19.&#xA;Dans cette mise Ã  jour, vous retrouverez des correctifs pour les versions supportÃ©es (17.4, 16.8, 15.12, 14.17, 13.20). Bien que ces correctifs puissent ne pas impacter tous les utilisateurs de PostgreSQL, le PGDG&#xA;a prÃ©fÃ©rÃ© adresser le problÃ¨me au plus tÃ´t et ne pas attendre la prochaine Ã©chÃ©ance prÃ©vue le &lt;a href=&#34;https://www.postgresql.org/developer/roadmap/&#34;&gt;8 mai 2025&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le correctif de sÃ©curitÃ© &lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-1094/&#34;&gt;CVE-2025-1094&lt;/a&gt;, traitant d&amp;rsquo;une vulnÃ©rabilitÃ© dans la librairie &lt;a href=&#34;https://www.postgresql.org/docs/current/libpq.html&#34;&gt;&lt;code&gt;libpq&lt;/code&gt;&lt;/a&gt; de PostgreSQL, a introduit une rÃ©gression portant sur la gestion des chaÃ®nes de caractÃ¨res (&amp;ldquo;C string&amp;rdquo;) terminÃ©e par un&#xA;caractÃ¨re non nul. L&amp;rsquo;erreur pourrait Ãªtre visible en fonction de comment un client PostgreSQL a implÃ©mentÃ© ce comportement, et peut ne pas impacter tous les drivers PostgreSQL. Par prÃ©caution, le PGDG a avancÃ© le cycle de mise Ã  jour.&lt;/p&gt;&#xA;&lt;p&gt;Si vous Ãªtes impactÃ© par ce problÃ¨me, il est recommandÃ© d&amp;rsquo;attendre la sortie des versions 17.4, 16.8, 15.12, 14.17 et 13.29 avant de mettre Ã  jour PostgreSQL.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !</title>
    <updated>2025-02-26T11:00:21Z</updated>
    <id>tag:blog.capdata.fr,2025-02-26:/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10677&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;200&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-768x513.png 768w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum.png 800w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Hello&lt;/p&gt;&#xA;&lt;p&gt;pour commencer cette annÃ©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous prÃ©sente comment optimiser les opÃ©rations de maintenance que sont les VACUUM et les ANALYZE.&lt;/p&gt;&#xA;&lt;p&gt;Ces 2 opÃ©rations sont essentielles pour conserver des performances optimales pour notre instance et garantir au planner de construire des plans d&amp;#8217;exÃ©cutions optimisÃ©s.&lt;/p&gt;&#xA;&lt;p&gt;les opÃ©rations VACUUM et/ou ANALYZE peuvent Ãªtre longues et sources de nombreuses Ã©critures dans les WALs sur des tables volumineuses.&lt;br /&gt;&#xA;C&amp;#8217;est pourquoi, et ce depuis la version &lt;strong&gt;PostgreSQL 16&lt;/strong&gt;, il est possible de modifier le comportement de ces opÃ©rations en affectant une taille de buffer. Il s&amp;#8217;agit du &amp;#8220;&lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-VACUUM-BUFFER-USAGE-LIMIT&#34;&gt;buffer_usage_limit&lt;/a&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Principe de fonctionnement.&lt;/h2&gt;&#xA;&lt;p&gt;Ce procÃ©dÃ© s&amp;#8217;appuie sur le principe de &amp;#8220;ring buffer&amp;#8221; configurÃ© pour PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Attention, Ã  ne pas confondre, Ã©videment, avec les &amp;#8220;rings buffer&amp;#8221; de SQL Server !!&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, PostgreSQL utilise cette stratÃ©gie de &amp;#8220;ring buffer&amp;#8221; afin de dÃ©dier un espace mÃ©moire pour les opÃ©rations lourdes , telles, la lecture sÃ©quentielle sur une table volumineuse, un CREATE TABLE AS SELECT, un COPY&amp;#8230;. mais aussi un VACUUM !&lt;/p&gt;&#xA;&lt;p&gt;En fait, cet espace est utilisÃ© pour Ã©viter de &amp;#8220;flusher&amp;#8221; sur disque de maniÃ¨re trop brutale les pages en mÃ©moire montÃ©es dans le &amp;#8220;&lt;strong&gt;shared buffer&lt;/strong&gt;&amp;#8220;. Cela pÃ©naliserait en grande partie toute opÃ©ration concurrente Ã  notre traitement actif puisqu&amp;#8217;elle n&amp;#8217;aurait plus d&amp;#8217;espace pour mettre ses propres pages en mÃ©moire.&lt;/p&gt;&#xA;&lt;p&gt;Jusqu&amp;#8217;Ã  la version PostgreSQL 16, cet espace mÃ©moire Ã©tait dÃ©fini Ã &lt;strong&gt;Â 256Ko&lt;/strong&gt;. Ainsi, au cours d&amp;#8217;une lecture sÃ©quentielle, chaque pageÂ  de &lt;strong&gt;8Ko&lt;/strong&gt; par dÃ©faut, est montÃ©e en mÃ©moire dans cet espace si le nombre de pages totales Ã  traiter pour la table, dÃ©passe 1/4 du paramÃ¨tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Il en est de mÃªme pour une opÃ©ration VACUUM ou ANALYZE qui utilise Ã©galement ce ring buffer et permet d&amp;#8217;optimiser cette opÃ©ration.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;NouveautÃ©s PostgreSQL 16 et PostgreSQL 17&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la version PostgreSQL 16, il est possible de configurer la taille du buffer de faÃ§on unitaire. Par exemple, lors d&amp;#8217;un VACUUM, il est tout Ã  fait possible de choisir une valeur pour &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Depuis le version PostgreSQL 17, la valeur par dÃ©faut affectÃ©e Ã  &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; est de &lt;strong&gt;2Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il vous est possible de paramÃ©trer la valeur de &lt;strong&gt;128Ko&lt;/strong&gt; jusqu&amp;#8217;Ã  &lt;strong&gt;16Go&lt;/strong&gt;. Attention, cependant, cette valeur ne peux excÃ©der &lt;strong&gt;1/8&lt;/strong&gt; du paramÃ¨tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Si vous faites le calcul, pour un serveur comportant &lt;strong&gt;32Go de RAM&lt;/strong&gt;, vous ne pourrez obtenir, au plus, &lt;strong&gt;1Go&lt;/strong&gt; pour votre ring buffer.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un VACUUM&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur une instance PostgreSQL 13, nous lanÃ§ons un VACUUM simple sur une table de 2,5Go. Nous utilisons une base exemple crÃ©Ã©e via &amp;#8220;pgbench&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Nous avons utilisÃ© les options &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221; pour analyser, dans un premier temps, tous les blocs de notre table et ne pas sur baser sur les informations de la visibility_map.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:797&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 20000000 nonremovable row versions in 327869 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196215&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 1.34 s, system: 0.67 s, elapsed: 18.90 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18920.292 ms (00:18.920)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le temps passÃ© pour cette opÃ©ration est d&amp;#8217;un peu plus de 18 secondes en temps CPU pour analyser les 327869 blocs de notre table. Soit une taille de 2.5Go.&lt;/p&gt;&#xA;&lt;p&gt;Nous effectuons la mÃªme opÃ©ration sur cette mÃªme table, mais sur un moteur &lt;strong&gt;PostgreSQL 17&lt;/strong&gt;. Nous positionnons le paramÃ¨tre &lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;Â  Ã  &lt;strong&gt;8Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:475&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 327869 scanned (100.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;new relfrozenxid: 208163, which is 5 XIDs ahead of previous value&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 134.208 MB/s, avg write rate: 0.034 MB/s&#xD;&#xA;buffer usage: 330350 hits, 325508 misses, 83 dirtied&#xD;&#xA;WAL usage: 84 records, 83 full page images, 684232 bytes&#xD;&#xA;system usage: CPU: user: 1.41 s, system: 0.64 s, elapsed: 18.94 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18955.006 ms (00:18.955)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;estÂ  Ã  peu de chose prÃ¨s, dans le mÃªme temps d&amp;#8217;exÃ©cution. soir 18 secondes.&lt;/p&gt;&#xA;&lt;p&gt;La suite consiste Ã  redÃ©marrer l&amp;#8217;instance PostgreSQL 17 et constater les temps d&amp;#8217;exÃ©cution pour chaque occurrence de lancement.&lt;br /&gt;&#xA;Nous exÃ©cutons donc, les mÃªmes ordres VACUUM, mais sans l&amp;#8217;option &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 13, nous voyons qu&amp;#8217;Ã  la premiÃ¨re exÃ©cution, juste aprÃ¨s redÃ©marrage, nous sommes Ã  32 millisecondes. Et Ã  chaque exÃ©cution suivante, nous ne descendons pas en dessous de 15 millisecondes&amp;#8230;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 32.149 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.001 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.295 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;En version PostgreSQL 17, nous faisons Ã©galement un &amp;#8220;flush&amp;#8221; des pages dans le buffer cache Ã  chaque exÃ©cution, tout en modifiant la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18.098 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 6.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;16MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 4.333 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le constat est simple, plus nous augmentons le &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, et plus le temps d&amp;#8217;exÃ©cution du VACUUM diminue.&lt;/p&gt;&#xA;&lt;p&gt;Nous comprendrons donc que sur une table de plus de 100Go, le gain peut Ãªtre assez important.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un ANALYZE&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour l&amp;#8217;instance PostgreSQL 13, nous exÃ©cutons le calcul de statistiques sur cette mÃªme table&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (analyze,verbose) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:802&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 52 nonremovable row versions in 1 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196278&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:336&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1190&#xD;&#xA;VACUUM&#xD;&#xA;Time: 29526.404 ms (00:29.526)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous sommes autour de 29 secondes pour analyser 30000 pages sur les 32769 que composent cette table.&lt;br /&gt;&#xA;Le sample est choisi en fonction de la valeur de &amp;#8220;&lt;strong&gt;default_statistics_target&lt;/strong&gt;&amp;#8220;, par dÃ©faut Ã  100, avec 30000 lignes analysÃ©es par dÃ©faut.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 17, les rÃ©sultats sont les suivants&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,verbose,BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:480&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 1 scanned (0.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 46.211 MB/s, avg write rate: 0.000 MB/s&#xD;&#xA;buffer usage: 37 hits, 100 misses, 0 dirtied&#xD;&#xA;WAL usage: 0 records, 0 full page images, 0 bytes&#xD;&#xA;system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.01 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:321&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1301&#xD;&#xA;VACUUM&#xD;&#xA;Time: 8151.201 ms (00:08.151)&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 7282.546 ms (00:07.283)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Les diffÃ©rences de gains sont moins impressionnantes que sur un simple VACUUM Ã  chaque changement de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, mais on voit qu&amp;#8217;en version PostgreSQL 17, nous sommes tout de mÃªme 4 fois plus rapide qu&amp;#8217;en version PostgreSQL 13.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;Remarques&lt;/h4&gt;&#xA;&lt;p&gt;Gardez Ã  l&amp;#8217;esprit que la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&amp;#8221;&lt;/strong&gt; est plafonnÃ©e Ã  &lt;strong&gt;1/8 &lt;/strong&gt;de&lt;strong&gt; &amp;#8220;shared_buffer&amp;#8221;&lt;/strong&gt;. Inutile donc de mettre Ã  1024Mo, si vous ne possÃ©dez que 8Go de RAM.&lt;/p&gt;&#xA;&lt;p&gt;Attention si vous mettez une valeur trop grande, les transactions concurrentes effectuant des lectures sÃ©quentielles seront pÃ©nalisÃ©es par les opÃ©rations VACUUM. D&amp;#8217;ailleurs, il est possible de mettre &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; Ã  0, mais ceci n&amp;#8217;est pas conseillÃ© lors d&amp;#8217;une activitÃ© transactionnelle en cours.&lt;/p&gt;&#xA;&lt;p&gt;Pour aller plus loin dans l&amp;#8217;optimisation d&amp;#8217;une opÃ©ration de vacuum, vous pouvez Ã©galement passer le paramÃ¨tre &amp;#8220;&lt;strong&gt;INDEX_CLEANUP&lt;/strong&gt;&amp;#8221; Ã  &lt;strong&gt;off&lt;/strong&gt;. Ceci aura pour effet de ne pas s&amp;#8217;occuper de traiter les entrÃ©es des index qui pointent sur les lignes mortes de la table.&lt;br /&gt;&#xA;Un &amp;#8220;&lt;strong&gt;REINDEX&lt;/strong&gt;&amp;#8221; sera alors nÃ©cessaire Ã  la fin du VACUUM sur les index de la table.&lt;/p&gt;&#xA;&lt;p&gt;De plus, il est possible de positionner l&amp;#8217;option &amp;#8220;&lt;strong&gt;SKIP_DATABASE_STATS&lt;/strong&gt;&amp;#8221; afin d&amp;#8217;indiquer Ã  l&amp;#8217;ordre VACUUM de ne pas rechercher l&amp;#8217;ID de transaction le plus ancien pour l&amp;#8217;ensemble des tables de la base et de geler celui-ci (datfrozenid).&lt;/p&gt;&#xA;&lt;p&gt;Les opÃ©rations VACUUM sur les grosses tables seront bien entendu optimisÃ©es mais attention aux plages de maintenance choisies !!&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonne journÃ©e Ã  vous.&lt;/p&gt;&#xA;&lt;p&gt;Emmanuel Rami&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 dÃ©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien Ã©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/requetes-consommatrices-sous-postgresql-episode-1/&#34; rel=&#34;bookmark&#34; title=&#34;24 mai 2016&#34;&gt;RequÃªtes consommatrices sous PostgreSQL (Ã©pisode 1)&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-mysql-8-0-les-histogrammes/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;NouveautÃ©s MySQL 8.0 : Les Histogrammes&lt;/a&gt; (Capdata team) [MySQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/replication-logique-avec-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;23 janvier 2020&#34;&gt;RÃ©plication logique avec PostgreSQL&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.028 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Hello pour commencer cette annÃ©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous prÃ©sente comment optimiser les opÃ©rations de maintenance que sont les VACUUM et les ANALYZE. Ces 2 opÃ©rations sont essentielles pour conserver des performances optimales pour&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>La montÃ©e de version en zero-downtime : merci la rÃ©plication !</title>
    <updated>2024-12-19T10:28:41Z</updated>
    <id>tag:blog.capdata.fr,2024-12-19:/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h1&gt;Introduction :&lt;/h1&gt;&#xA;&lt;p&gt;Dans le monde des bases de donnÃ©es, garantir une disponibilitÃ© continue est une exigence incontournable, surtout pour les systÃ¨mes critiques oÃ¹ chaque minute d&amp;#8217;arrÃªt peut entraÃ®ner des pertes significatives. Lorsquâ€™il sâ€™agit de migrer une base de donnÃ©es vers une nouvelle version, ce dÃ©fi prend une toute autre dimension. Comment mettre Ã  jour votre systÃ¨me sans interrompre les services, tout en prÃ©servant lâ€™intÃ©gritÃ© des donnÃ©es ?&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL offre une solution Ã©lÃ©gante : la rÃ©plication logique. Cet outil permet de transfÃ©rer des donnÃ©es de maniÃ¨re fluide entre diffÃ©rentes versions de PostgreSQL, tout en maintenant la base de donnÃ©es source opÃ©rationnelle. Dans cet article, nous allons explorer Ã©tape par Ã©tape comment utiliser cette fonctionnalitÃ© pour rÃ©aliser une montÃ©e de version sans temps d&amp;#8217;arrÃªt, du dÃ©ploiement initial Ã  la bascule finale vers la nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Que vous soyez en train de planifier une migration ou simplement curieux de dÃ©couvrir les possibilitÃ©s offertes par PostgreSQL, suivez ce guide pratique qui vous permettra de transformer un dÃ©fi complexe en une opÃ©ration maÃ®trisÃ©e et efficace.&lt;/p&gt;&#xA;&lt;h1&gt;Le test :&lt;/h1&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h3&gt;PrÃ©paration&lt;/h3&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pour tester cette nouvelle mÃ©thode, nous aurons besoin de deux instances PostgreSQL. Pour cet article j&amp;#8217;ai choisit de dÃ©montrer la technique en migrant d&amp;#8217;une version 14 Ã  une version 17 de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Je commence donc par installer les versions sur deux machines diffÃ©rentes pouvant communiquer entre elles (c&amp;#8217;est important) :&lt;/p&gt;&#xA;&lt;p&gt;Sur les deux machines nous pouvons exÃ©cuter les commandes suivantes :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt update sudo apt upgrade -y&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y install gnupg2 wget vim&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo sh -c &#39;echo &amp;quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&amp;quot; &amp;amp;gt; /etc/apt/sources.list.d/pgdg.list&#39;&#xD;&#xA;root@ip-192-1-1-246:~# curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc|sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y update&#xD;&#xA;Get:1 file:/etc/apt/mirrors/debian.list Mirrorlist [38 B]&#xD;&#xA;Get:2 file:/etc/apt/mirrors/debian-security.list Mirrorlist [47 B]&#xD;&#xA;Hit:3 https://cdn-aws.deb.debian.org/debian bookworm InRelease&#xD;&#xA;Hit:4 https://cdn-aws.deb.debian.org/debian bookworm-updates InRelease&#xD;&#xA;Hit:5 https://cdn-aws.deb.debian.org/debian bookworm-backports InRelease&#xD;&#xA;Hit:6 https://cdn-aws.deb.debian.org/debian-security bookworm-security InRelease&#xD;&#xA;Get:7 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg InRelease [129 kB]&#xD;&#xA;Get:8 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg/main amd64 Packages [359 kB]&#xD;&#xA;Fetched 489 kB in 1s (348 kB/s)&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;All packages are up to date.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur notre premiÃ¨re machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt install postgresql-14&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-14 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl status postgresql@14-main.service&#xD;&#xA;â— postgresql@14-main.service - PostgreSQL Cluster 14-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime;&amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:43:55 UTC; 2min 55s ago&#xD;&#xA;Process: 15248 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect &amp;amp;gt;&#xD;&#xA;Main PID: 15253 (postgres)&#xD;&#xA;Tasks: 7 (limit: 4633)&#xD;&#xA;Memory: 17.3M&#xD;&#xA;CPU: 239ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@14-main.service&#xD;&#xA;â”œâ”€15253 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresq&amp;amp;gt;&#xD;&#xA;â”œâ”€15255 &amp;quot;postgres: 14/main: checkpointer &amp;quot;&#xD;&#xA;â”œâ”€15256 &amp;quot;postgres: 14/main: background writer &amp;quot;&#xD;&#xA;â”œâ”€15257 &amp;quot;postgres: 14/main: walwriter &amp;quot;&#xD;&#xA;â”œâ”€15258 &amp;quot;postgres: 14/main: autovacuum launcher &amp;quot;&#xD;&#xA;â”œâ”€15259 &amp;quot;postgres: 14/main: stats collector &amp;quot;&#xD;&#xA;â””â”€15260 &amp;quot;postgres: 14/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:43:53 ip-192-1-1-246 systemd[1]: Starting postgresql@14-main.service&amp;amp;gt;&#xD;&#xA;Dec 04 09:43:55 ip-192-1-1-246 systemd[1]: Started postgresql@14-main.service &amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur la deuxiÃ¨me machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;admin@ip-192-1-1-89:~$ sudo apt install postgresql-17&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-17 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;admin@ip-192-1-1-89:~$ systemctl status postgresql@17-main.service&#xD;&#xA;â— postgresql@17-main.service - PostgreSQL Cluster 17-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime; &amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:52:33 UTC; 2min 13s ago&#xD;&#xA;Process: 15235 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect 1&amp;amp;gt;&#xD;&#xA;Main PID: 15240 (postgres)&#xD;&#xA;Tasks: 6 (limit: 4633)&#xD;&#xA;Memory: 20.5M&#xD;&#xA;CPU: 332ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@17-main.service&#xD;&#xA;â”œâ”€15240 /usr/lib/postgresql/17/bin/postgres -D /var/lib/postgresql&amp;amp;gt;&#xD;&#xA;â”œâ”€15241 &amp;quot;postgres: 17/main: checkpointer &amp;quot;&#xD;&#xA;â”œâ”€15242 &amp;quot;postgres: 17/main: background writer &amp;quot;&#xD;&#xA;â”œâ”€15244 &amp;quot;postgres: 17/main: walwriter &amp;quot;&#xD;&#xA;â”œâ”€15245 &amp;quot;postgres: 17/main: autovacuum launcher &amp;quot;&#xD;&#xA;â””â”€15246 &amp;quot;postgres: 17/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:52:31 ip-192-1-1-89 systemd[1]: Starting postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;Dec 04 09:52:33 ip-192-1-1-89 systemd[1]: Started postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos deux instances sont maintenant installÃ©es. Sur notre premiÃ¨re base de donnÃ©es, nous allons crÃ©er une base, avec deux tables, et quelques lignes.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE TABLE customers (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;name TEXT NOT NULL,&#xD;&#xA;email TEXT UNIQUE,&#xD;&#xA;created_at TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# CREATE TABLE orders (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;customer_id INT REFERENCES customers(id),&#xD;&#xA;amount NUMERIC(10,2) NOT NULL,&#xD;&#xA;order_date TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES&#xD;&#xA;(&#39;Alice&#39;, &#39;alice@example.com&#39;),&#xD;&#xA;(&#39;Bob&#39;, &#39;bob@example.com&#39;),&#xD;&#xA;(&#39;Charlie&#39;, &#39;charlie@example.com&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;mydb=# INSERT INTO orders (customer_id, amount) VALUES&#xD;&#xA;(1, 50.75),&#xD;&#xA;(2, 20.00),&#xD;&#xA;(1, 75.00);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;2. Configurer la base de donnÃ©es source&lt;/h3&gt;&#xA;&lt;p&gt;Sur notre premiÃ¨re machine, nous allons modifier les paramÃ¨tres du fichier de configuration de PostgreSQL pour permettre de pouvoir crÃ©er la rÃ©plication :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-246:~$ cd /etc/postgresql/14/main&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il s&amp;#8217;agit de modifier les paramÃ¨tres suivants :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Nous modifierons ensuite le pg_hba pour rajouter l&amp;#8217;autorisation de connexion entre les deux machines :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il suffira de rajouter une ligne :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Il ne faut pas oublier de redÃ©marrer le serveur PostgreSQL une fois ces modifications effectuÃ©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;3. Configurer la base de donnÃ©e de destination&lt;/h3&gt;&#xA;&lt;p&gt;AprÃ¨s avoir configurÃ© notre base de donnÃ©e depuis laquelle nous allons faire notre migration, il nous faut a prÃ©sent configurer celle qui va recevoir la nouvelle base de donnÃ©e migrÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela, nous allons rÃ©pÃ©ter les Ã©tapes de configuration de la base de donnÃ©e source, en les adaptant sur notre base de donnÃ©e de destination : modifier le postgresql.conf, puis le pg_hba.conf, redÃ©marrer ensuite la base de donnÃ©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ cd /etc/postgresql/17/main/&#xD;&#xA;postgres@ip-192-1-1-89:/etc/postgresql/17/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il ne faudra pas oublier de crÃ©er la base de donnÃ©e ainsi que toutes les structures de tables et autres objets dans notre base cible pour qu&amp;#8217;elle puisse recevoir les donnÃ©es. Pour avoir les scripts de crÃ©ation de la base de donnÃ©es, vous pouvez faire un pg_dump avec l&amp;#8217;option&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ psql&#xD;&#xA;psql (17.2 (Debian 17.2-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;N&amp;#8217;oubliez pas de donner tout les droits Ã  votre utilisateur de replication pour qu&amp;#8217;il puisse lire, Ã©crire&amp;#8230; Sur votre base de donnÃ©es repliquÃ©e, sur la source, comme sur la destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# GRANT ALL PRIVILEGES ON DATABASE &amp;quot;mydb&amp;quot; to replication;&#xD;&#xA;GRANT&#xD;&#xA;&#xD;&#xA;mydb=# GRANT ALL PRIVILEGES ON all tables in schema public to replication;&#xD;&#xA;GRANT&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;4. Mise en place de la rÃ©plication logique&lt;/h3&gt;&#xA;&lt;p&gt;Maintenant que nos deux environnement sont bien en place, nous sommes prÃªts Ã  mettre en route le processus de rÃ©plication logique pour commencer Ã  transfÃ©rer les donnÃ©es. Les Ã©tapes du dessous ont demandÃ© une premiÃ¨re intervention hors horaire de prod, notamment pour redÃ©marrer le service postgreSQL, mais le but d&amp;#8217;une migration avec rÃ©plication logique, c&amp;#8217;est de pouvoir ensuite n&amp;#8217;avoir rien Ã  toucher jusqu&amp;#8217;au moment de basculer les applicatifs d&amp;#8217;une ip a une autre.&lt;/p&gt;&#xA;&lt;p&gt;Sur notre machine source, on crÃ©Ã© la publication qui va nous servir Ã  transfÃ©rer nos tables :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE PUBLICATION my_pub FOR ALL TABLES;&#xD;&#xA;CREATE PUBLICATION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On va ensuite crÃ©Ã© la souscription sur la base de donnÃ©es cible de notre migration :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# create subscription my_sub connection &#39;host=192.1.1.246 port=5432 dbname=mydb user=replication password=replication&#39;publication my_pub;&#xD;&#xA;NOTICE: created replication slot &amp;quot;my_sub&amp;quot; on publisher&#xD;&#xA;CREATE SUBSCRIPTION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Maintenant que la subscription est en place, on peut vÃ©rifier qu&amp;#8217;elle fonctionne. Pendant ce temps, la vrai production, sur la version 14, peut continuer Ã  fonctionner, elle sera automatiquement repliquÃ©e sur la nouvelle version 17.&lt;/p&gt;&#xA;&lt;p&gt;On peut vÃ©rifier ou en est notre replication avec la commande &lt;span class=&#34;hljs-keyword&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;FROM&lt;/span&gt; pg_stat_subscription;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# SELECT * FROM pg_stat_subscription;&#xD;&#xA;-[ RECORD 1 ]---------+------------------------------&#xD;&#xA;subid | 16422&#xD;&#xA;subname | my_sub&#xD;&#xA;worker_type | apply&#xD;&#xA;pid | 16076&#xD;&#xA;leader_pid |&#xD;&#xA;relid |&#xD;&#xA;received_lsn | 0/1733988&#xD;&#xA;last_msg_send_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;last_msg_receipt_time | 2024-12-04 14:23:59.872357+00&#xD;&#xA;latest_end_lsn | 0/1733988&#xD;&#xA;latest_end_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;5. Test de replication, bascule, et nettoyage&lt;/h3&gt;&#xA;&lt;p&gt;Une fois que la synchronisation de votre replication logique est terminÃ©e, ce qui peut prendre un certain temps si vous avez beaucoup de donnÃ©es, vous pouvez constater de vous mÃªme sur les lignes que vous ajoutez, modifiez ou supprimez sur votre instance source sont repliquÃ©es sur l&amp;#8217;instance de destination.&lt;/p&gt;&#xA;&lt;p&gt;Par exemple, ajoutons un nouveau customer sur notre base source :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES (&#39;Diana&#39;, &#39;diana@example.com&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Si nous allons requÃªter sur notre instance de destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# select * from customers where name=&#39;Diana&#39;;&#xD;&#xA;id | name | email | created_at&#xD;&#xA;----+-------+-------------------+----------------------------&#xD;&#xA;4 | Diana | diana@example.com | 2024-12-04 14:31:05.708031&#xD;&#xA;(1 row)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Quand vous vous Ãªtes bien assurÃ© que tout fonctionne, vous pouvez alors rediriger les drivers odbc de vos applications vers le nouveau serveur et non plus l&amp;#8217;ancien.&lt;/p&gt;&#xA;&lt;p&gt;Une fois que cela est fait, vous pouvez alors supprimer le lien de replication, puisque l&amp;#8217;ancienne instance ne sera plus alimentÃ©e, et mÃªme supprimer l&amp;#8217;ancienne version si vous n&amp;#8217;en avez plus l&amp;#8217;utilitÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Sur la destination, notre nouveau serveur de prod :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP SUBSCRIPTION my_sub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Sur la source, ancien serveur qui va Ãªtre supprimÃ© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP PUBLICATION my_pub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h1&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;La rÃ©plication logique se distingue comme lâ€™une des meilleures solutions pour minimiser le temps dâ€™arrÃªt lors dâ€™une migration de version PostgreSQL. En permettant une synchronisation continue des donnÃ©es entre deux instances, elle garantit une transition en douceur sans jamais interrompre les services en cours. Cela en fait un choix idÃ©al pour les environnements critiques oÃ¹ la disponibilitÃ© est primordiale.&lt;/p&gt;&#xA;&lt;h3&gt;Avantages :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;ZÃ©ro downtime :&lt;/strong&gt; la source reste opÃ©rationnelle pendant toute la migration.&lt;br /&gt;&#xA;&lt;strong&gt;FlexibilitÃ© :&lt;/strong&gt; possibilitÃ© de migrer vers une infrastructure diffÃ©rente (nouveau matÃ©riel, cloud, etc.).&lt;br /&gt;&#xA;&lt;strong&gt;GranularitÃ© :&lt;/strong&gt; la rÃ©plication logique peut se limiter Ã  certaines tables si nÃ©cessaire.&lt;/p&gt;&#xA;&lt;h3&gt;InconvÃ©nients :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;ComplexitÃ© initiale :&lt;/strong&gt; la configuration et les tests nÃ©cessitent une bonne maÃ®trise des paramÃ¨tres de PostgreSQL.&lt;br /&gt;&#xA;&lt;strong&gt;Impact sur les performances :&lt;/strong&gt; la charge de rÃ©plication peut lÃ©gÃ¨rement affecter les performances de la base source, surtout avec un grand volume de donnÃ©es.&lt;br /&gt;&#xA;&lt;strong&gt;Non pris en charge pour certains types de donnÃ©es :&lt;/strong&gt; les types spÃ©cifiques ou les extensions non standards ne sont pas toujours compatibles avec la rÃ©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Si la rÃ©plication logique est souvent la mÃ©thode privilÃ©giÃ©e pour des mises Ã  jour critiques, elle nâ€™est pas la seule option. Des alternatives comme les outils de sauvegarde et restauration ou la rÃ©plication physique peuvent rÃ©pondre Ã  dâ€™autres besoins spÃ©cifiques, notamment pour des bases de donnÃ©es trÃ¨s volumineuses ou des scÃ©narios nÃ©cessitant une rÃ©plication complÃ¨te du systÃ¨me.&lt;/p&gt;&#xA;&lt;p&gt;Dans tous les cas, le choix de la mÃ©thode dÃ©pendra de votre contexte, de vos contraintes techniques et de vos objectifs mÃ©tier. Prenez le temps dâ€™Ã©valuer les diffÃ©rentes options pour garantir une migration rÃ©ussie et sans surprise.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/replication-logique-avec-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;23 janvier 2020&#34;&gt;RÃ©plication logique avec PostgreSQL&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migration-postgresql-via-slony-i-ou-comment-reduire-le-temps-de-coupure/&#34; rel=&#34;bookmark&#34; title=&#34;27 janvier 2020&#34;&gt;Migration PostgreSQL via SLONY-I ou comment rÃ©duire le temps de coupure&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migrer-dun-cluster-galera-mariadb-10-3-vers-mariadb-10-5-avec-la-replication-logique/&#34; rel=&#34;bookmark&#34; title=&#34;25 fÃ©vrier 2022&#34;&gt;Migrer d&amp;#8217;un cluster Galera MariaDB 10.3 vers MariaDB 10.5 avec la rÃ©plication logique&lt;/a&gt; (David Baffaleuf) [ContainerMySQLNon classÃ©]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/comparatif-des-gestionnaires-de-vip-dans-un-cluster-patroni-episode-1-keepalived/&#34; rel=&#34;bookmark&#34; title=&#34;6 mars 2022&#34;&gt;Comparatif des gestionnaires de VIP dans un cluster Patroni : Ã©pisode 1 (KEEPALIVED)&lt;/a&gt; (David Baffaleuf) [ContainerPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des schÃ©mas de base de donnÃ©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.131 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La montÃ©e de version en zero-downtime : merci la rÃ©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Introduction : Dans le monde des bases de donnÃ©es, garantir une disponibilitÃ© continue est une exigence incontournable, surtout pour les systÃ¨mes critiques oÃ¹ chaque minute d&amp;#8217;arrÃªt peut entraÃ®ner des pertes significatives. Lorsquâ€™il sâ€™agit de migrer une base de donnÃ©es vers&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La montÃ©e de version en zero-downtime : merci la rÃ©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>pg_vector : lâ€™IA et PostgreSQL</title>
    <updated>2024-12-03T07:22:34Z</updated>
    <id>tag:blog.capdata.fr,2024-12-03:/index.php/pg_vector-lia-et-postgresql/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h2&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le rÃ´le des bases de donnÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle (IA) connaÃ®t une popularitÃ© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies fonctionnent, elles ont besoin de donnÃ©es, souvent en grande quantitÃ©. Câ€™est lÃ  quâ€™interviennent les bases de donnÃ©es : elles stockent, gÃ¨rent et permettent d&amp;#8217;accÃ©der Ã  ces donnÃ©es de maniÃ¨re efficace.&lt;/p&gt;&#xA;&lt;p&gt;Les bases de donnÃ©es, comme PostgreSQL, ont donc un rÃ´le clÃ© dans lâ€™IA. Mais l&amp;#8217;IA ne traite pas toujours des informations simples comme des noms ou des chiffres ; souvent, elle doit manipuler des informations complexes, comme des reprÃ©sentations numÃ©riques d&amp;#8217;images, de sons, ou de textes. Pour gÃ©rer ces donnÃ©es spÃ©cifiques, il faut des outils adaptÃ©s, et c&amp;#8217;est lÃ  que l&amp;#8217;extension pg_vector de PostgreSQL entre en jeu.&lt;/p&gt;&#xA;&lt;h2&gt;2. Les vecteurs en informatique et dans pg_vector&lt;/h2&gt;&#xA;&lt;p&gt;Dans le cadre de lâ€™informatique, un vecteur est simplement une liste de nombres. Ces nombres peuvent reprÃ©senter nâ€™importe quoi : les caractÃ©ristiques dâ€™un produit, les mots dâ€™un texte ou mÃªme une image. Par exemple, pour un document texte, chaque mot peut Ãªtre transformÃ© en une sÃ©rie de nombres qui capture son sens dans un certain contexte.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™extension pg_vector permet Ã  PostgreSQL de stocker et de manipuler ces vecteurs. Elle offre un moyen simple de les utiliser directement dans une base de donnÃ©es. Imaginons que nous avons des centaines de documents et que nous souhaitions rechercher les plus similaires Ã  un texte donnÃ© : en stockant les reprÃ©sentations numÃ©riques (ou embeddings) de ces documents sous forme de vecteurs, nous pouvons facilement comparer leur similaritÃ© grÃ¢ce Ã  pg_vector.&lt;/p&gt;&#xA;&lt;h2&gt;3. Le lien entre l&amp;#8217;IA et les vecteurs&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle repose sur la capacitÃ© Ã  comprendre et traiter des informations complexes. Par exemple, quand une IA doit reconnaÃ®tre une image, elle ne &amp;#8220;voit&amp;#8221; pas comme nous. Au lieu de cela, l&amp;#8217;image est transformÃ©e en une sÃ©rie de nombres, un vecteur, qui reprÃ©sente ses caractÃ©ristiques (couleurs, formes, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Le mÃªme principe sâ€™applique au texte. Les modÃ¨les de traitement du langage, comme ceux utilisÃ©s par les moteurs de recherche ou les chatbots, transforment chaque mot ou phrase en vecteur. Ces vecteurs capturent le sens des mots et permettent Ã  l&amp;#8217;IA de manipuler des informations complexes sans &amp;#8220;comprendre&amp;#8221; le langage humain.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est ici que les embeddings entrent en jeu. Un embedding est un vecteur qui reprÃ©sente des donnÃ©es sous une forme que lâ€™IA peut utiliser. Par exemple, dans un systÃ¨me de recommandation, chaque produit est converti en un embedding, et les produits les plus proches de celui que nous venons de consulter (en termes de vecteur) nous seront recommandÃ©s. GrÃ¢ce Ã  pg_vector, ces embeddings peuvent Ãªtre stockÃ©s et comparÃ©s directement dans une base de donnÃ©es.&lt;/p&gt;&#xA;&lt;h2&gt;4. Pourquoi est-ce utile ?&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector est trÃ¨s utile pour des applications qui nÃ©cessitent la recherche par similaritÃ©. Par exemple, dans un moteur de recherche, si nous voulons trouver les documents les plus proches d&amp;#8217;un texte donnÃ©, pg_vector permet de comparer les vecteurs (ou embeddings) de chaque document pour voir lesquels sont les plus similaires.&lt;/p&gt;&#xA;&lt;p&gt;Autre exemple, dans une plateforme de streaming musical, chaque chanson peut Ãªtre convertie en vecteur qui reprÃ©sente ses caractÃ©ristiques (comme le tempo, la tonalitÃ©, etc.). GrÃ¢ce Ã  pg_vector, on peut facilement recommander des chansons similaires Ã  celles que nous Ã©coutons.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™avantage de pg_vector, câ€™est quâ€™il permet de gÃ©rer ces vecteurs directement dans la base de donnÃ©es, ce qui Ã©vite de passer par des systÃ¨mes externes plus complexes. Cela simplifie le dÃ©veloppement et amÃ©liore la performance, car tout est gÃ©rÃ© au mÃªme endroit.&lt;/p&gt;&#xA;&lt;h2&gt;5. Le test&lt;/h2&gt;&#xA;&lt;p&gt;Pour dÃ©montrer le fonctionnement de l&amp;#8217;extension, rien de tel qu&amp;#8217;un petit test pour Ã©prouver les fonctionnalitÃ©s qu&amp;#8217;elle propose. Le test sera plutÃ´t simple et succinct pour Ãªtre accessible. Le prÃ©requi est d&amp;#8217;avoir une version PostgreSQL 14 ou plus rÃ©cente d&amp;#8217;installÃ©e.&lt;/p&gt;&#xA;&lt;h3&gt;Etape 1 :&lt;/h3&gt;&#xA;&lt;p&gt;On commence par installer l&amp;#8217;extension pg_vector. Pour cela, nous allons avoir besoin d&amp;#8217;un certain nombre d&amp;#8217;outils pour le faire fonctionner. Une partie de ces outils sont disponible dans la distribution dev de PostgreSQL&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# sudo apt install postgresql-server-dev-14&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nous aurons Ã©galement besoin de gcc et make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# apt install make&#xD;&#xA;root@ip-192-1-1-201:~# apt-get install gcc&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On effectue ensuite un git clone du projet :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# git clone https://github.com/pgvector/pgvector.git&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et une fois que c&amp;#8217;est fait, on l&amp;#8217;installe avec make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# cd pgvector&#xD;&#xA;root@ip-192-1-1-201:~# make &amp;amp;amp;&amp;amp;amp; sudo make install&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 2 :&lt;/h3&gt;&#xA;&lt;p&gt;On se connecte Ã  PostgreSQL pour crÃ©er l&amp;#8217;extension. Au passage, on crÃ©Ã© aussi une base de donnÃ©es pour faire nos test.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-201:~$ psql&#xD;&#xA;psql (14.13 (Ubuntu 14.13-0ubuntu0.22.04.1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# create database test_vector;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c test_vector&#xD;&#xA;You are now connected to database &amp;quot;test_vector&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;test_vector=# CREATE EXTENSION vector;&#xD;&#xA;CREATE EXTENSION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et dans la foulÃ©e, on crÃ©e une table qui contient les vecteurs sur lesquels nous allons faire les test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# CREATE TABLE documents (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;title TEXT,&#xD;&#xA;embedding vector(3) -- vecteur de dimension 3 pour cet exemple&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Insertion des donnÃ©es d&amp;#8217;exemple :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# INSERT INTO documents (title, embedding) VALUES&#xD;&#xA;(&#39;Document 1&#39;, &#39;[0.1, 0.2, 0.3]&#39;),&#xD;&#xA;(&#39;Document 2&#39;, &#39;[0.4, 0.5, 0.6]&#39;),&#xD;&#xA;(&#39;Document 3&#39;, &#39;[0.9, 0.8, 0.7]&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 3 :&lt;/h3&gt;&#xA;&lt;p&gt;Nous avons deux types de choses Ã  tester pour montrer l&amp;#8217;efficacitÃ© de notre extension. En effet, pour rechercher un vecteur, deux modes s&amp;#8217;offrent Ã  nous :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h4&gt;La distance cosinus&lt;/h4&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;La distance cosinus mesure non pas combien deux vecteurs sont Ã©loignÃ©s, mais l&amp;#8217;angle entre eux. Câ€™est un peu comme comparer la direction dans laquelle pointent deux vecteurs plutÃ´t que la distance rÃ©elle entre eux.&lt;/p&gt;&#xA;&lt;p&gt;Imaginons que nous sommes en train de lancer deux flÃ¨ches. La distance cosinus nous dira si les deux flÃ¨ches pointent dans la mÃªme direction (sont similaires) ou si elles pointent dans des directions trÃ¨s diffÃ©rentes (sont moins similaires).&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre de lâ€™IA, cette mesure est souvent utilisÃ©e pour comparer des embeddings (reprÃ©sentations numÃ©riques complexes), car elle se concentre sur la relation entre les Ã©lÃ©ments, indÃ©pendamment de leur taille exacte.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Prenons les deux films :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Film A : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Film B : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance cosinus ne va pas se soucier de la diffÃ©rence de valeur entre chaque composant, mais va regarder si les deux films ont des proportions similaires. Autrement dit, est-ce que leur &amp;#8220;profil&amp;#8221; gÃ©nÃ©ral est proche ou Ã©loignÃ© ?&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette distance, dans notre pg vector, on utilise la mÃ©thode suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+---------------------&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.05582537807240784&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.07142855242198809&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 0.09815280896106982&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Le symbole &amp;lt;=&amp;gt; reprÃ©sente une distance cosinus.&lt;/p&gt;&#xA;&lt;h4&gt;2. La distance Euclidienne&lt;/h4&gt;&#xA;&lt;p&gt;Imaginons que nous sommes sur une carte avec deux points : le point A et le point B. La distance euclidienne, c&amp;#8217;est la faÃ§on la plus intuitive de mesurer la distance entre ces deux points, comme si nous tracions une ligne droite entre eux. Pour parler en terme simple, câ€™est la &amp;#8220;distance Ã  vol d&amp;#8217;oiseau&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des vecteurs, la distance euclidienne mesure la diffÃ©rence entre deux vecteurs, un peu comme si chaque vecteur Ã©tait un point sur une carte en plusieurs dimensions. Plus cette distance est petite, plus les deux vecteurs (et donc les objets quâ€™ils reprÃ©sentent) sont similaires.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Imaginons deux films reprÃ©sentÃ©s par les vecteurs suivants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film A&lt;/strong&gt; : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film B&lt;/strong&gt; : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance euclidienne va calculer la diffÃ©rence entre chaque nombre des deux vecteurs et dÃ©terminer Ã  quel point ces films sont proches en termes de caractÃ©ristiques (genre, nombre dâ€™acteurs, budget, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Dans pg_vector on peut le tester ainsi :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+--------------------&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.1414213612422477&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.5385165006363984&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 1.0677078185041473&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Elle est reprÃ©sentÃ©e par le cigle &amp;lt;-&amp;gt; dans pg_vector.&lt;/p&gt;&#xA;&lt;h4&gt;3. Quand choisir l&amp;#8217;une ou l&amp;#8217;autre des distances ?&lt;/h4&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La distance euclidienne est utile quand tu veux mesurer la diffÃ©rence globale entre deux objets. Elle est facile Ã  comprendre et Ã  utiliser pour des comparaisons directes.&lt;/li&gt;&#xA;&lt;li&gt;La distance cosinus est utile quand tu veux savoir si deux objets sont globalement similaires dans leur profil, indÃ©pendamment de leur taille ou de leur Ã©chelle. Elle est souvent utilisÃ©e pour comparer des documents textuels ou des donnÃ©es complexes en IA&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector apporte une fonctionnalitÃ© puissante Ã  PostgreSQL, permettant de manipuler des donnÃ©es complexes sous forme de vecteurs. Que ce soit pour des systÃ¨mes de recommandation, des moteurs de recherche ou toute autre application liÃ©e Ã  lâ€™intelligence artificielle, elle offre un moyen simple et efficace d&amp;#8217;intÃ©grer l&amp;#8217;IA dans les bases de donnÃ©es. Et tout cela, sans avoir besoin de comprendre des mathÃ©matiques avancÃ©es : il suffit de savoir que ces vecteurs permettent de traiter des informations complexes de maniÃ¨re trÃ¨s efficace.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/&#34; rel=&#34;bookmark&#34; title=&#34;3 avril 2024&#34;&gt;pg_recursively_delete : Simplifier les suppressions rÃ©cursives&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des schÃ©mas de base de donnÃ©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-planifier-une-tache-avec-pg_cron/&#34; rel=&#34;bookmark&#34; title=&#34;24 septembre 2019&#34;&gt;PostgreSQL : planifier une tÃ¢che avec pg_cron&lt;/a&gt; (Emmanuel RAMI) [Non classÃ©PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/openrowset-episode-1/&#34; rel=&#34;bookmark&#34; title=&#34;13 juillet 2011&#34;&gt;OPENROWSET, Ã©pisode 1&lt;/a&gt; (David Baffaleuf) [SQL Server]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/transparent-data-encryption-pour-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;13 mai 2022&#34;&gt;Transparent Data Encryption pour PostgreSQL&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.017 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le rÃ´le des bases de donnÃ©es L&amp;#8217;intelligence artificielle (IA) connaÃ®t une popularitÃ© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup</title>
    <updated>2024-07-16T11:24:05Z</updated>
    <id>tag:blog.capdata.fr,2024-07-16:/index.php/postgresql-17-sauvegardes-incrementales/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-10592&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/07/SalesGrowth.jpg&#34; alt=&#34;&#34; width=&#34;279&#34; height=&#34;180&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonjour&lt;/p&gt;&#xA;&lt;p&gt;Les 11 et 12 juin derniers, nous Ã©tions aux journÃ©es PGDAY Ã  Lille pour dÃ©couvrir les nouveautÃ©s autour de PostgreSQL.&lt;br /&gt;&#xA;Cette confÃ©rence regroupe diffÃ©rents professionnels, de la communautÃ© francophone, qui agissent en contribuant sur des sujets techniques mais aussi sur les bonnes pratiques afin d&amp;#8217;utiliser PostgreSQL dans les meilleurs conditions.&lt;/p&gt;&#xA;&lt;p&gt;Un article m&amp;#8217;a particuliÃ¨rement intÃ©ressÃ© cette annÃ©e, c&amp;#8217;est celui de &lt;a href=&#34;https://www.linkedin.com/in/stefan-fercot/?originalSubdomain=be&#34;&gt;Stefan Fercot&lt;/a&gt; Senior DBA PostgreSQL qui vit en Belgique, et travaille pour une sociÃ©tÃ© allemande experte dans les solutions PostgreSQL. Sa prÃ©sentation portait sur le sujet &amp;#8220;dÃ©mystifier les sauvegardes incrÃ©mentales sous PostgreSQL&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;#8217;ai Ã©coutÃ© sa confÃ©rence tout en ayant hÃ¢te de tester sa mise en place dÃ¨s mon retour de Lille.&lt;/p&gt;&#xA;&lt;p&gt;Je tiens Ã  remercier Stefan pour son travail sur ce sujet sauvegardes PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Tout d&amp;#8217;abord, il faut savoir que les sujets sauvegardes incrÃ©mentales ont Ã©tÃ© dÃ©jÃ  abordÃ©s avec des outils comme &lt;strong&gt;Barman&lt;/strong&gt; ou &lt;strong&gt;Pg_BackRest&lt;/strong&gt;, et que certaines instances PostgreSQL de production sont sauvegardÃ©es via ces mÃ©canismes depuis quelques annÃ©es maintenant.&lt;/p&gt;&#xA;&lt;p&gt;Ici, nous parlons de la solution &amp;#8220;backup incremental&amp;#8221; inclu nativement dans le moteur PostgreSQL, et disponible avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8220;. C&amp;#8217;est d&amp;#8217;ailleurs ce point que Stefan a soulignÃ© durant la journÃ©e PGDAY du 11 juin dernier.&lt;/p&gt;&#xA;&lt;p&gt;Cette nouvelle fonctionnalitÃ© fait partie de la version &lt;strong&gt;PostgreSQL 17&lt;/strong&gt; qui est pour le moment, en version&lt;strong&gt; Beta 2&lt;/strong&gt;.&lt;br /&gt;&#xA;Celle ci devrait sortir, comme Ã  l&amp;#8217;accoutumÃ©, au cour de l&amp;#8217;automne prochain.&lt;/p&gt;&#xA;&lt;p&gt;Preuve que PostgreSQL est en perpÃ©tuel Ã©volution, et rejoint la liste des SGBD Ã©tant capable, comme peuvent le faire Oracle et SQL Server, de proposer nativement des sauvegardes incrÃ©mentales.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Installation de PostgreSQL 17&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette fonctionnalitÃ©, nous devons installer la toute derniÃ¨re version de PostgreSQL , la 17 beta 2. Attention, celle ci n&amp;#8217;Ã©tant pas disponible dans les dÃ©pÃ´ts PGDG, nous devons nous charger d&amp;#8217;installer cette version via le site postgresql.org&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&#34;&gt;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Nous disposons d&amp;#8217;un serveur Linux fork Red Hat 8 (Rocky Linux). Il nous faut donc tÃ©lÃ©charger les &amp;#8220;rpm&amp;#8221; liÃ©s Ã  cette version.&lt;/p&gt;&#xA;&lt;p&gt;Les packages dont nous avons besoin sont les suivants&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;# ls -lrt postgresql1* | awk &#39;{print$9}&#39;&#xD;&#xA;postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous les installons avec le compte &lt;strong&gt;root&lt;/strong&gt; de notre serveur.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[root@ tmp]# rpm -i postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous sommes sur un environnement &amp;#8220;Red Hat like&amp;#8221;, la crÃ©ation d&amp;#8217;une premiÃ¨re instance via &amp;#8220;initdb&amp;#8221; est nÃ©cessaire.&lt;br /&gt;&#xA;Surtout, ne pas oublier d&amp;#8217;activer les &amp;#8220;data checksums&amp;#8221; (option -k), nous verrons pourquoi dans la suite de cet article. La suite est Ã  faire avec le compte &lt;strong&gt;postgres&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ initdb -D /data/postgres/17/pg_data -k&#xD;&#xA;The files belonging to this database system will be owned by user &amp;quot;postgres&amp;quot;.&#xD;&#xA;This user must also own the server process.&#xD;&#xA;&#xD;&#xA;The database cluster will be initialized with locale &amp;quot;en_US.UTF-8&amp;quot;.&#xD;&#xA;The default database encoding has accordingly been set to &amp;quot;UTF8&amp;quot;.&#xD;&#xA;The default text search configuration will be set to &amp;quot;english&amp;quot;.&#xD;&#xA;&#xD;&#xA;Data page checksums are enabled.&#xD;&#xA;&#xD;&#xA;creating directory /data/postgres/17/pg_data ... ok&#xD;&#xA;creating subdirectories ... ok&#xD;&#xA;selecting dynamic shared memory implementation ... posix&#xD;&#xA;selecting default &amp;quot;max_connections&amp;quot; ... 100&#xD;&#xA;selecting default &amp;quot;shared_buffers&amp;quot; ... 128MB&#xD;&#xA;selecting default time zone ... UTC&#xD;&#xA;creating configuration files ... ok&#xD;&#xA;running bootstrap script ... ok&#xD;&#xA;performing post-bootstrap initialization ... ok&#xD;&#xA;syncing data to disk ... ok&#xD;&#xA;&#xD;&#xA;initdb: warning: enabling &amp;quot;trust&amp;quot; authentication for local connections&#xD;&#xA;initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.&#xD;&#xA;&#xD;&#xA;Success. You can now start the database server using:&#xD;&#xA;&#xD;&#xA;pg_ctl -D /data/postgres/17/pg_data -l logfile start&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;DÃ©marrer cette instance pour s&amp;#8217;assurer que tout fonctionne&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data -l logfile start&#xD;&#xA;waiting for server to start.... done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Notre version enregistrÃ©e est bien une Beta 2. Version qui ne doit pas Ãªtre mise sur un environnement de production comme le rappelle le site de la communautÃ© PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ psql&#xD;&#xA;(postgres@[local]:5437) [postgres] &amp;gt; select * from version();&#xD;&#xA;version&#xD;&#xA;------------------------------------------------------------------------------------------------------------&#xD;&#xA;PostgreSQL 17beta2 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-22), 64-bit&#xD;&#xA;(1 row)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Upgrade de version&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous disposions deja d&amp;#8217;une version PostgreSQL15 sur ce serveur, nous passons par un upgrade via l&amp;#8217;outil &amp;#8220;pg_upgrade&amp;#8221; toujours disponible dans cette nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Lancer pg_upgrade en mode check&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -c -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&#xD;&#xA;.....&#xD;&#xA;.....&#xD;&#xA;&#xD;&#xA;*Clusters are compatible*&#xD;&#xA;&amp;quot;/usr/pgsql-17/bin/pg_ctl&amp;quot; -w -D &amp;quot;/data/postgres/17/pg_data&amp;quot; -o &amp;quot;&amp;quot; -m smart stop  &amp;quot;/data/postgres/17/pg_data/pg_upgrade_output.d/20240708T085906.955/log/pg_upgrade_server.log&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;la log est gÃ©nÃ©rÃ©e dans le $PGDATA de la version 17.&lt;/p&gt;&#xA;&lt;p&gt;Puis lancer l&amp;#8217;exÃ©cution de pg_upgrade&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Effectuer une sauvegarde&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;PrÃ©requis&lt;/h3&gt;&#xA;&lt;p&gt;Avant de pouvoir effectuer une premiÃ¨re sauvegarde avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221; natif, il est primordial de respecter certains prÃ©requis important.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;L&amp;#8217;instance PostgreSQL doit Ãªtre crÃ©Ã©e avec les &amp;#8216;data checksums&amp;#8217; activÃ©s. Si ce n&amp;#8217;est pas le cas, utiliser l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_checksums&lt;/strong&gt;&amp;#8221; avec l&amp;#8217;option &amp;#8220;&lt;strong&gt;-e&lt;/strong&gt;&amp;#8220;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Si vous lancez une sauvegarde full puis une incrÃ©mentale immÃ©diatement, vous avez toutes les chances de tomber sur cette erreur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: incremental backups cannot be taken unless WAL summarization is enabled&lt;/pre&gt;&#xA;&lt;p&gt;En effet, pour avoir toutes les informations concernant les blocks modifiÃ©s, PostgreSQL a besoin de tracer dans les WALs toutes les modifications sur les objets en base.&lt;br /&gt;&#xA;Pour les DBA Oracle, le &amp;#8220;block change tracking&amp;#8221; de la version Enterprise Edition vous parlera trÃ¨s certainement&amp;#8230;.&lt;br /&gt;&#xA;Il s&amp;#8217;agit ici de la mÃªme fonctionnalitÃ©, c&amp;#8217;est Ã  dire, tracer les modifications effectuÃ©es dans les blocks de donnÃ©es.&lt;br /&gt;&#xA;Cette option est le &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Pour activer l&amp;#8217;option, nous aurons 2 paramÃ¨tres Ã  modifier, soit via un ALTER SYSTEM directement sous psql, ou bien dans le fichier &amp;#8220;postgresql.conf&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres backup]$ vi $PGDATA/postgresql.conf&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;# - WAL Summarization -&#xD;&#xA;&#xD;&#xA;#summarize_wal = off # run WAL summarizer process?&#xD;&#xA;#wal_summary_keep_time = &#39;10d&#39; # when to remove old summary files, 0 = never&lt;/pre&gt;&#xA;&lt;p&gt;Le premier paramÃ¨tre permet d&amp;#8217;activer cette option.&lt;br /&gt;&#xA;Le second dÃ©finit un temps de conservation des informations concernant les blocks modifiÃ©s entre une sauvegarde FULL et un incrÃ©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous activons donc l&amp;#8217;option &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8221; et la passons Ã  &lt;strong&gt;ON&lt;/strong&gt; et laissons Ã  10 jours le &amp;#8220;&lt;strong&gt;wal_summary_keep_time&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Attention, activez ces deux paramÃ¨tres avant votre premiÃ¨re sauvegarde FULL. Si vous le faites aprÃ¨s, vous risquez de rencontrer l&amp;#8217;erreur suivante&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: WAL summaries are required on timeline 1 from 1/AA000028 to 1/AC000060, but the summaries for that timeline and LSN range are incomplete&#xD;&#xA;DETAIL: The first unsummarized LSN in this range is 1/AA000028.&lt;/pre&gt;&#xA;&lt;p&gt;Le LSN pris lors de la premiÃ¨re sauvegarde FULL n&amp;#8217;est pas reconnu, et donc la sauvegarde incrÃ©mentale ne peut s&amp;#8217;appuyer dessus.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;RedÃ©marrer l&amp;#8217;instance une fois les modifications effectuÃ©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data/ restart&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Lancer une sauvegarde FULL&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Voici la nouvelle option prÃ©sente pour l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup --help&#xD;&#xA;pg_basebackup takes a base backup of a running PostgreSQL server.&#xD;&#xA;&#xD;&#xA;Usage:&#xD;&#xA;pg_basebackup [OPTION]...&#xD;&#xA;&#xD;&#xA;Options controlling the output:&#xD;&#xA;-D, --pgdata=DIRECTORY receive base backup into directory&#xD;&#xA;-F, --format=p|t output format (plain (default), tar)&#xD;&#xA;-i, --incremental=OLDMANIFEST&#xD;&#xA;take incremental backup&#xD;&#xA;-r, --max-rate=RATE maximum transfer rate to transfer data directory&#xD;&#xA;(in kB/s, or use suffix &amp;quot;k&amp;quot; or &amp;quot;M&amp;quot;)&#xD;&#xA;&#xD;&#xA;.... &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34;&gt;version 13&lt;/a&gt; de PostgreSQL, nous disposons pour chaque sauvegarde, d&amp;#8217;un fichier nommÃ© &amp;#8220;backup_manifest&amp;#8221;. Il s&amp;#8217;agit d&amp;#8217;un fichier json qui recense entiÃ¨rement les objets bases de donnÃ©es sauvegardÃ©s avec leur emplacement, leur taille, leur date de modification et leur &amp;#8220;checksum&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Celui ci est essentiel pour vÃ©rifier l&amp;#8217;intÃ©gritÃ© de notre sauvegarde avec &amp;#8220;&lt;strong&gt;pg_verifybackup&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Nous pouvons Ã  prÃ©sent faire une premiÃ¨re sauvegarde FULL de notre instance PG17.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17 -F p -l &amp;quot;Full Backup PG17&amp;quot; -P -v&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AD000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8048&amp;quot;&#xD;&#xA;3097788/3097788 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AD000158&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on effectue quelques transactions : crÃ©ation d&amp;#8217;une table et insertions de donnÃ©es sur cette table de test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [manu] $ &amp;gt; create table backup (nom varchar(20), type varchar(20), date_backup date);&#xD;&#xA;CREATE TABLE&#xD;&#xA;Time: 3.344 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;FULL&#39;,&#39;2024-07-08 12:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 3.612 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental&#39;,&#39;2024-07-08 13:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;RepÃ©rer le fichier &amp;#8220;backup_manifest&amp;#8221; de la sauvegarde FULL rÃ©alisÃ©e dans le dossier &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres PG17]$ ls -lrt backup*&#xD;&#xA;-rw-------. 1 postgres postgres 218 Jul 8 09:19 backup_label&#xD;&#xA;-rw-------. 1 postgres postgres 433295 Jul 8 09:20 backup_manifest&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Effectuer une sauvegarde incrÃ©mentale&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A partir de lÃ , lancer une sauvegarde incrÃ©mentale. Nous utilisons l&amp;#8217;option &amp;#8220;&lt;strong&gt;-i&lt;/strong&gt;&amp;#8221; pour indiquer Ã  &lt;strong&gt;pg_basebackup&lt;/strong&gt; ou est situÃ© le &amp;#8220;backup_manifest&amp;#8221; de la derniÃ¨re sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr -l &amp;quot;Incremental Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AF000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8139&amp;quot;&#xD;&#xA;12485/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AF000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;S&amp;#8217;il l&amp;#8217;on compare les deux rÃ©pertoires de sauvegardes &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221; et &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8220;, nous voyons que les tailles sont bien diffÃ©rentes&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;......&#xD;&#xA;3.0G /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;&#xD;&#xA;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17_incr&#xD;&#xA;......&#xD;&#xA;35M /data/postgres/backup/pg_basebackup/PG17_incr&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Un volume de 3Go pour la sauvegarde FULL de l&amp;#8217;instance contre 35Mo pour l&amp;#8217;incrÃ©mentale.&lt;br /&gt;&#xA;La taille occupÃ©e par les objets dans chacune des bases est bien plus faible dans la sauvegarde incrÃ©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous continuons Ã  insÃ©rer des donnÃ©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; [postgres - ]$ psql -d manu&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&#xD;&#xA;&#xD;&#xA;Time: 0.614 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental 2&#39;,&#39;2024-07-08 14:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.436 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;(3 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on lance une seconde sauvegarde incrÃ©mentale :&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr_2 -l &amp;quot;Incremental 2 Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17_incr/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/B1000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8313&amp;quot;&#xD;&#xA;12260/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/B1000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous remarquons l&amp;#8217;appel au &amp;#8220;backup manifest&amp;#8221; de la derniÃ¨re sauvegarde incrÃ©mentale prÃ©sente dans le rÃ©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on regarde la taille de ce nouveau backup&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres pg_basebackup]$ du -h PG17_incr_2&#xD;&#xA;.......&#xD;&#xA;35M PG17_incr_2&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A nouveau 35 Mo, mais vu le peu de modifications effectuÃ©es, la taille n&amp;#8217;est pas trÃ¨s reprÃ©sentative.&lt;/p&gt;&#xA;&lt;p&gt;Ce qu&amp;#8217;il faut retenir, c&amp;#8217;est qu&amp;#8217;en fonction du fichier &amp;#8220;backup manifest&amp;#8221; pris lors de l&amp;#8217;appel Ã  &lt;strong&gt;pg_basebackup&lt;/strong&gt;, vous pourrez faire soit&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde incrÃ©mentale qui prendra les derniÃ¨res modifications depuis la derniÃ¨re sauvegarde incrÃ©mentale effectuÃ©e.&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde diffÃ©rentielle qui prendra les modifications faites depuis la derniÃ¨re sauvegarde FULL si vous vous appuyez toujours sur le &amp;#8220;backup manifest&amp;#8221; de votre sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est donc ce fichier json &amp;#8220;backup manifest&amp;#8221; qui a un rÃ´le essentiel dans l&amp;#8217;Ã©laboration de votre stratÃ©gie de sauvegarde au fur et Ã  mesure du temps.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Et la restauration , comment ca se passe ?&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on souhaite restaurer tous ces jeux de sauvegardes, nous utilisons un nouvel outil qui est &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Cet outil permet de &amp;#8220;merger&amp;#8221; les diffÃ©rentes sauvegardes dans un et un seul dossier que l&amp;#8217;on restaurera par la suite.&lt;/p&gt;&#xA;&lt;p&gt;Dans notre exemple, nous avons fait 1 sauvegarde FULL puis 2 incrÃ©mentales.&lt;br /&gt;&#xA;Nous allons donc restaurer ces 3 jeux de sauvegardes afin de retrouver les donnÃ©es. A noter qu&amp;#8217;il existe une option &amp;#8220;&amp;#8211;dry-run&amp;#8221; pour tester la commande&lt;/p&gt;&#xA;&lt;p&gt;ExÃ©cuter la commande en prenant en paramÃ¨tre les dossiers de sauvegardes dans l&amp;#8217;ordre chronologique.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -n -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;Si aucune erreur en sortie, on exÃ©cute sans l&amp;#8217;option &amp;#8220;dry run&amp;#8221;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; [postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le rÃ©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_ALL&lt;/strong&gt;&amp;#8221; ainsi gÃ©nÃ©rÃ©, doit avoir une taille trÃ¨s lÃ©gÃ¨rement supÃ©rieure au dossier de la sauvegarde FULL.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h PG17_ALL&#xD;&#xA;....&#xD;&#xA;3.0G PG17_ALL&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;DerniÃ¨re Ã©tape, nous passons Ã  la restauration des donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Nous arrÃªtons l&amp;#8217;instance PG17&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ stop&#xD;&#xA;waiting for server to shut down.... done&#xD;&#xA;server stopped&lt;/pre&gt;&#xA;&lt;p&gt;Nous supprimons les donnÃ©es dans $PGDATA&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ rm -rf /data/postgres/17/pg_data/* &lt;/pre&gt;&#xA;&lt;p&gt;Puis nous restaurons ce jeu complet de donnÃ©es avec une simple copie.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ cp -r /data/postgres/backup/pg_basebackup/PG17_ALL/* /data/postgres/17/pg_data/ &lt;/pre&gt;&#xA;&lt;p&gt;Enfin redÃ©marrons l&amp;#8217;instance&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ start&#xD;&#xA;waiting for server to start....2024-07-08 10:51:45.671 UTC [8909] LOG: redirecting log output to logging collector process&#xD;&#xA;2024-07-08 10:51:45.671 UTC [8909] HINT: Future log output will appear in directory &amp;quot;log&amp;quot;.&#xD;&#xA;done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis contrÃ´ler que nous rÃ©cupÃ©rons bien toutes les lignes de notre table &amp;#8220;backup&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres@ip-172-44-2-96 pg_basebackup]$ psql -d manu&#xD;&#xA;(postgres@[local]:5437) [manu] primaire $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;Remarques&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Attention, toujours vÃ©rifier les sauvegardes Ã  chaque Ã©tape avec l&amp;#8217;outil &lt;strong&gt;pg_verifybackup &lt;/strong&gt;car rien ne garantit qu&amp;#8217;au moment de l&amp;#8217;appel Ã  &lt;strong&gt;pg_combinebackup&lt;/strong&gt; les diffÃ©rents jeux de sauvegardes FULL et/ou incrÃ©mentales ne soient pas corrompus.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Assurez vous d&amp;#8217;Ãªtre en mode &amp;#8220;data_checksum&amp;#8221; activÃ© et ne pas changer de mode entre les jeux de backup. Le &amp;#8220;backup manifest&amp;#8221; s&amp;#8217;appuie sur ce paramÃ©trage pour valider les checksums de chaque fichier.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le mode TAR pour &lt;strong&gt;pg_basebackup&lt;/strong&gt; n&amp;#8217;est pas compatible pour les sauvegardes full et incrÃ©mentales mÃªme si celui ci est possible. Mais c&amp;#8217;est Ã  vous de dÃ©tarer les fichiers &amp;#8220;&lt;strong&gt;base.tar.gz&lt;/strong&gt;&amp;#8221; Et au moment de la restaurationÂ  avec &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;, une possible corruption est rencontrÃ©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_all_tar /data/postgres/backup/pg_basebackup/PG17_TAR /data/postgres/backup/pg_basebackup/PG17_incr_TAR&#xD;&#xA;pg_combinebackup: error: could not write to file &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar/base/25284/25332&amp;quot;, offset 122470400: wrote 380928 of 409600&#xD;&#xA;pg_combinebackup: removing output directory &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;La compression a potentiellement ajoutÃ©e une corruption ne rendant pas possible l&amp;#8217;opÃ©ration de &amp;#8220;merge&amp;#8221; des donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La restauration PITR est possible bien entendu. N&amp;#8217;oubliez pas de crÃ©er le &amp;#8220;&lt;strong&gt;recovery.signal&lt;/strong&gt;&amp;#8221; dans $PGDATA et de dÃ©finir dans le fichier &amp;#8220;postgresql.conf&amp;#8221; les quelques paramÃ¨tres suivants&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_nameÂ &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_time &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_xid &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_lsn &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_inclusive = off ou on&lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_timeline = &amp;#8216;latest&amp;#8217; &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_action = &amp;#8216;pause&amp;#8217;Â &lt;/span&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.0.3/72x72/1f642.png&#34; alt=&#34;ğŸ™‚&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-la-streaming-replication-en-12/&#34; rel=&#34;bookmark&#34; title=&#34;19 novembre 2019&#34;&gt;PostgreSQL : la streaming replication en 12.&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/oracle-rds-effectuer-des-backup-rman-en-mode-paas/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;Oracle RDS : effectuer des backup RMAN en mode PaaS.&lt;/a&gt; (Emmanuel RAMI) [AWSNon classÃ©Oracle]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-comparatif-entre-barman-et-pgbackrest/&#34; rel=&#34;bookmark&#34; title=&#34;4 fÃ©vrier 2020&#34;&gt;PostgreSQL : Comparatif entre Barman et pgBackRest&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/haute-disponibilite-de-postgresql-avec-patroni/&#34; rel=&#34;bookmark&#34; title=&#34;2 fÃ©vrier 2022&#34;&gt;Haute disponibilitÃ© de PostgreSQL avec Patroni&lt;/a&gt; (Ludovic AUGEREAU) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.532 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&amp;#160; Bonjour Les 11 et 12 juin derniers, nous Ã©tions aux journÃ©es PGDAY Ã  Lille pour dÃ©couvrir les nouveautÃ©s autour de PostgreSQL. Cette confÃ©rence regroupe diffÃ©rents professionnels, de la communautÃ© francophone, qui agissent en contribuant sur des sujets techniques mais&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>PGO : la suite</title>
    <updated>2024-05-29T08:58:17Z</updated>
    <id>tag:blog.capdata.fr,2024-05-29:/index.php/pgo-la-suite/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;title=PGO%20%3A%20la%20suite&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PGO%20%3A%20la%20suite&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;La gestion efficace des clusters PostgreSQL dans un environnement Kubernetes est un dÃ©fi complexe auquel sont confrontÃ©es de nombreuses entreprises aujourd&amp;#8217;hui. PGO offre une solution dÃ©clarative qui automatise la gestion des clusters PostgreSQL, simplifiant ainsi le dÃ©ploiement, la mise Ã  l&amp;#8217;Ã©chelle et la gestion des bases de donnÃ©es PostgreSQL dans un environnement Kubernetes.&lt;/p&gt;&#xA;&lt;p&gt;Pour faire suite Ã  l&amp;#8217;article de David sur PGO et Ã  la demande d&amp;#8217;un de nos clients, j&amp;#8217;ai rÃ©alisÃ© une Ã©tude approfondie de plusieurs fonctionnalitÃ©s de PGO.&lt;br /&gt;&#xA;Cet article va faire un petit tour d&amp;#8217;horizon des outils principaux inclus dans l&amp;#8217;implÃ©mentation de PGO. Que ce soit pour la sauvegarde avec pgbackrest, pour la balance des connexion avec pgbouncer ou pour le monitoring avec prometheus, PGO ne manque pas d&amp;#8217;utilitaire dont l&amp;#8217;utilisation est facilitÃ©e par la solution tout embarquÃ©.&lt;/p&gt;&#xA;&lt;h3&gt;Pgbackrest :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;PgBackRest est une solution de sauvegarde et de restauration pour les bases de donnÃ©es PostgreSQL qui propose plusieurs fonctionnalitÃ©s, telles que la sauvegarde et la restauration parallÃ¨les, la compression, les sauvegardes complÃ¨tes, diffÃ©rentielles et incrÃ©mentielles, la rotation des sauvegardes et l&amp;#8217;expiration des archives, l&amp;#8217;intÃ©gritÃ© des sauvegardes, etc. Il prend en charge plusieurs rÃ©fÃ©rentiels, qui peuvent Ãªtre situÃ©s localement ou Ã  distance via TLS/SSH, ou Ãªtre des stockages fournis par le cloud comme S3/GCS/Azure.&lt;br /&gt;&#xA;L&amp;#8217;architecture de pgbackrest pour PGO est la suivante :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1.png&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10564&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1-300x168.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;168&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1-300x168.png 300w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image1.png 605w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;On peut imaginer plusieurs moyens de mettre en place le pgbackrest. Dans un premier temps, nous avons la sauvegarde classique en systÃ¨me de fichier, comme dans notre exemple sur le blog :&lt;/p&gt;&#xA;&lt;h5&gt;1) La sauvegarde sur volume persistant Kubernetes :&lt;/h5&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;- name: repo1&#xD;&#xA;  volume:&#xD;&#xA;    volumeClaimSpec:&#xD;&#xA;      accessModes:&#xD;&#xA;      - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;      resources:&#xD;&#xA;        requests:&#xD;&#xA;          storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ce type de sauvegarde utilise un volume persistant de Kubernetes pour recueillir nos sauvegardes et les garder.&lt;br /&gt;&#xA;Une PersistentVolumeClaim (PVC) est une demande de stockage faite par un utilisateur. Elle est similaire Ã  un Pod. Les Pods consomment des ressources de nÅ“ud et les PVC consomment des ressources de PV (PersistentVolume). Les Pods peuvent demander des niveaux spÃ©cifiques de ressources (CPU et mÃ©moire). Les revendications peuvent demander une taille spÃ©cifique et des modes d&amp;#8217;accÃ¨s spÃ©cifiques (par exemple, elles peuvent Ãªtre montÃ©es en ReadWriteOnce, ReadOnlyMany, ReadWriteMany, ou ReadWriteOncePod, voir AccessModes).&lt;/p&gt;&#xA;&lt;h5&gt;2) Le stockage pour S3 :&lt;/h5&gt;&#xA;&lt;p&gt;Pour pouvoir faire du stockage dans S3, il faut rajouter un fichier de configuration dans notre dossier de dÃ©ploiement. Le fichier doit sâ€™appeler s3.conf. Ce fichier contient les crÃ©dential de connexion Ã  un AWS S3 :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;repo1-s3-key=$YOUR_AWS_S3_KEY&#xD;&#xA;repo1-s3-key-secret=$YOUR_AWS_S3_KEY_SECRET&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois que câ€™est configurÃ© dans votre fichier, il ne reste plus quâ€™Ã  modifier le postgresql.yaml, et configurer dans la partie backup :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-s3-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster1/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        s3:&#xD;&#xA;          bucket: &amp;quot;&amp;lt;YOUR_AWS_S3_BUCKET_NAME&amp;gt;&amp;quot;&#xD;&#xA;          endpoint: &amp;quot;&amp;lt;YOUR_AWS_S3_ENDPOINT&amp;gt;&amp;quot;&#xD;&#xA;          region: &amp;quot;&amp;lt;YOUR_AWS_S3_REGION&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois configurÃ©, et le job mis dans le cron, vous devriez voir apparaitre les sauvegardes sur le volume S3.&lt;/p&gt;&#xA;&lt;h5&gt;3) Le stockage GCS :&lt;/h5&gt;&#xA;&lt;p&gt;Comme pour Amazon S3 on peut sauvegarder nos backups dans Google Cloud Storage. Pour pouvoir le faire fonctionner il vous faut copier votre GCS key secret (qui est un fichier JSON) dans un gcs.conf que vous allez placer dans votre dossier Kustomize.&lt;br /&gt;&#xA;Il vous suffit ensuite de modifier votre fichier postgres.yaml pour ajouter dans la partie backup la configuration pour une sauvegarde gcs :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-gcs-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster1/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        gcs:&#xD;&#xA;          bucket: &amp;quot;&amp;lt;YOUR_GCS_BUCKET_NAME&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il ne vous reste plus quâ€™Ã  regÃ©nÃ©rer vos pods, et votre sauvegarde arrivera directement dans votre Google Cloud Service.&lt;/p&gt;&#xA;&lt;h5&gt;4) Le stockage Azur Blob Storage :&lt;/h5&gt;&#xA;&lt;p&gt;Comme pour les deux points prÃ©cÃ©dents, vous pouvez Ã©galement stocker vos sauvegardes sur le blob storage dâ€™Azure. Pour cela il vous faut crÃ©er un fichier dans votre kustomize, avec Ã  lâ€™intÃ©rieur la configuration pour votre point de sauvegarde Azure. Il vous faut lâ€™appeler azure.conf et il devra contenir les lignes suivantes :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;repo1-azure-account=$YOUR_AZURE_ACCOUNT&#xD;&#xA;repo1-azure-key=$YOUR_AZURE_KEY&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il faut ensuite intÃ©grer ces modifications dans votre fichier postgres.yaml :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-azure-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        azure:&#xD;&#xA;          container: &amp;quot;&amp;lt;YOUR_AZURE_CONTAINER&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Bien sur rien ne vous interdit, et câ€™est mÃªme conseillÃ©, de joindre plusieurs moyens de sauvegarde. Cela permet notamment de sâ€™assurer une plus grande fiabilitÃ© du systÃ¨me de sauvegarde, en sâ€™assurant quâ€™elles sont disponibles Ã  plusieurs endroits.&lt;br /&gt;&#xA;Une fois que vous avez dÃ©cidÃ© dâ€™oÃ¹ vous allez stocker vos sauvegardes, et que vous lâ€™avez configurÃ©, il faut maintenant dÃ©cider des diffÃ©rents paramÃ¨tres de ces sauvegardes : la programmation, la rÃ©tentionâ€¦&lt;/p&gt;&#xA;&lt;h5&gt;5) La programmation des sauvegardes :&lt;/h5&gt;&#xA;&lt;p&gt;Il faut savoir que par dÃ©faut, PGO sauvegarde automatiquement les WAL dans la mÃ©thode de sauvegarde que vous lui avez configurÃ©. Câ€™est donc une forme de sauvegarde en soit.&lt;br /&gt;&#xA;Mais dans le cadre dâ€™une rÃ©cupÃ©ration aprÃ¨s incident majeur, il peut aussi Ãªtre utilise dâ€™avoir des sauvegardes full programmÃ©es. Pgbackrest, qui est lâ€™outil utilisÃ© par PGO permet de mettre en place trois types de sauvegarde : les incrÃ©mentales, les diffÃ©rentielles et les fulls.&lt;br /&gt;&#xA;Chaque type de sauvegarde peut Ãªtre programmÃ©e en suivant une notation identique Ã  celle des crontab. Par exemple :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        schedules:&#xD;&#xA;          full: &amp;quot;0 1 * * 0&amp;quot;&#xD;&#xA;          differential: &amp;quot;0 1 * * 1-6&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Le fait dâ€™implÃ©menter ces planifications crÃ©era des CronJobs dans Kubernetes.&lt;/p&gt;&#xA;&lt;h5&gt;6) La rÃ©tention des backups :&lt;/h5&gt;&#xA;&lt;p&gt;Vous pouvez dÃ©finir une rÃ©tention maximum pour vos backups sur le support de backup de votre choix. Une fois que cette rÃ©tention sera atteinte, pgbackrest fera le mÃ©nage tout seul des sauvegardes et des WAL qui lui sont reliÃ©es.&lt;br /&gt;&#xA;Il y a deux types de rÃ©tentions que lâ€™on peut dÃ©finir : les rÃ©tentions Â« count Â» basÃ©es sur le nombre de backup que lâ€™on souhaite garder et les rÃ©tentions Â« time Â» basÃ©es sur le nombre de jours ou vous souhaitez garder votre sauvegarde.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      global:&#xD;&#xA;        repo1-retention-full: &amp;quot;14&amp;quot;&#xD;&#xA;        repo1-retention-full-type: time&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h5&gt;7) La sauvegarde unique :&lt;/h5&gt;&#xA;&lt;p&gt;Si dans le cadre dâ€™un besoin particuliers, une grosse modification ou une migration par exemple, vous avez besoin de prendre une sauvegarde immÃ©diate sans forcÃ©ment attendre que le cron nâ€™arrive, vous pouvez le faire.&lt;br /&gt;&#xA;Pour la configuration de cette sauvegarde, il faudra lâ€™annoter comme Â« manuelle Â» :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      manual:&#xD;&#xA;        repoName: repo1&#xD;&#xA;        options:&#xD;&#xA;         - --type=full&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il vous faudra ensuite dÃ©clencher cette sauvegarde avec une commande manuelle. Dans le cadre de notre cluster exemple pgcluster1 :&lt;br /&gt;&#xA;kubectl annotate -n postgres-operator postgrescluster pgcluster1 \ postgres-operator.crunchydata.com/pgbackrest-backup=&amp;#8221;$(date)&amp;#8221;&lt;/p&gt;&#xA;&lt;h5&gt;8) Faire un clone Ã  partir dâ€™un repo :&lt;/h5&gt;&#xA;&lt;p&gt;Quand on a configurÃ© un repo sur notre instance primaire, on peut facilement crÃ©er un clone de notre instance Ã  lâ€™aide de notre sauvegarde. Ainsi, on crÃ©er un tout nouveau Pods Ã  partir des informations stockÃ©es Ã  propos du pod que lâ€™on possÃ¨de dÃ©jÃ . Ici, nous allons crÃ©er un nouveau pod Ã  partir de notre pod pgcluster1 :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;apiVersion: postgres-operator.crunchydata.com/v1beta1&#xD;&#xA;kind: PostgresCluster&#xD;&#xA;metadata:&#xD;&#xA;  name: pgcluster2&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;  image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres:ubi8-16.2-0&#xD;&#xA;  postgresVersion: 16&#xD;&#xA;  instances:&#xD;&#xA;    - dataVolumeClaimSpec:&#xD;&#xA;        accessModes:&#xD;&#xA;        - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;        resources:&#xD;&#xA;          requests:&#xD;&#xA;            storage: 1Gi&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        volume:&#xD;&#xA;          volumeClaimSpec:&#xD;&#xA;            accessModes:&#xD;&#xA;            - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;            resources:&#xD;&#xA;              requests:&#xD;&#xA;                storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici on peut noter entre autres la partie spec de la configuration, qui est le morceau de yaml nous permettant de dire quâ€™on sâ€™appuie sur le cluster existant pour crÃ©er un clone indÃ©pendant :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h5&gt;9) Point in Time Recovery :&lt;/h5&gt;&#xA;&lt;p&gt;De la mÃªme faÃ§on, si lâ€™on veut faire une restauration PITR, nous allons remplir la balise spec de notre yaml. Attention cependant, pour faire une restauration PITR, nous avons besoin de possÃ©der encore la sauvegarde. On ne peut pas faire une restauration PITR sur une sauvegarde lointaine quâ€™on ne possÃ¨derait plus. Imaginons que je souhaite repartir dâ€™une sauvegarde datant dâ€™hier soir Ã  20h30 de mon instance pgcluster1 sur mon instance pgcluster2, la configuration serait la suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;apiVersion: postgres-operator.crunchydata.com/v1beta1&#xD;&#xA;kind: PostgresCluster&#xD;&#xA;metadata:&#xD;&#xA;  name: pgcluster2&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;      options:&#xD;&#xA;      - --type=time&#xD;&#xA;      - --target=&amp;quot;2024-04-09 20:30:00-00&amp;quot;&#xD;&#xA;  image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres:ubi8-16.2-0&#xD;&#xA;  postgresVersion: 16&#xD;&#xA;  instances:&#xD;&#xA;    - dataVolumeClaimSpec:&#xD;&#xA;        accessModes:&#xD;&#xA;        - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;        resources:&#xD;&#xA;          requests:&#xD;&#xA;            storage: 1Gi&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        volume:&#xD;&#xA;          volumeClaimSpec:&#xD;&#xA;            accessModes:&#xD;&#xA;            - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;            resources:&#xD;&#xA;              requests:&#xD;&#xA;                storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;La partie qui nous intÃ©resse ici est la partie spec, ou nous avons rajouter un type de restauration (ici time) et une heure target. Cela indique Ã  pgbackrest quâ€™il doit aller chercher tous les fichiers de sauvegarde et WAL sur notre point de sauvegarde repo1 venant de lâ€™instance pgcluster1 pour les rÃ©appliquer sur notre nouveau cluster pgcluster2.&lt;br /&gt;&#xA;Vous pouvez Ã©galement vouloir rÃ©aliser une restauration In Place, câ€™est-Ã -dire Ã©craser lâ€™instance prÃ©sente pour la remplacer par la restauration. Auquel cas, plutÃ´t que de prÃ©ciser comment sâ€™appellera notre nouveau cluster, il faut alors passer par la balise restore :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      restore:&#xD;&#xA;        enabled: true&#xD;&#xA;        repoName: repo1&#xD;&#xA;        options:&#xD;&#xA;        - --type=time&#xD;&#xA;        - --target=&amp;quot;2024-04-09 20:30:00-00&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici, comme prÃ©cÃ©demment, nous restaurons Ã  lâ€™heure de 20 :30 hier soir, et cela sur notre propre instance. Ne reste plus quâ€™Ã  lancer la restauration :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;kubectl annotate -n postgres-operator postgrescluster pgcluster1 --overwrite \ postgres-operator.crunchydata.com/pgbackrest-restore=&amp;quot;$(date)&amp;quot;&lt;/pre&gt;&#xA;&lt;p&gt;A noter quâ€™il ne faut pas oublier de dÃ©sactiver ensuite le restore en le passant Ã  false si vous ne souhaitez pas quâ€™il soit de nouveau Ã©crasÃ© au prochain changement de configuration.&lt;/p&gt;&#xA;&lt;h5&gt;10) Restaurer une base de donnÃ©es spÃ©cifique :&lt;/h5&gt;&#xA;&lt;p&gt;Si votre besoin est de restaurer une base de donnÃ©es spÃ©cifique plutÃ´t que lâ€™intÃ©gralitÃ© de lâ€™instance, vous pouvez le prÃ©ciser dans les paramÃ¨tres de votre restauration.&lt;br /&gt;&#xA;Attention cependant, ce nâ€™est pas une restauration comme le serais un pg_dump. Ici si vous restaurez simplement une seule base de donnÃ©es et pas le reste du cluster, les autres bases que vous nâ€™avez pas choisit de restaurer deviendront inaccessibles.&lt;br /&gt;&#xA;Si nous voulons restaurer une base de donnÃ©es, et uniquement elle, voici la procÃ©dure :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;backups:&#xD;&#xA;  pgbackrest:&#xD;&#xA;    restore:&#xD;&#xA;      enabled: true&#xD;&#xA;      repoName: repo1&#xD;&#xA;      options:&#xD;&#xA;        - --db-include=capdata&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici, on ne restaurera que la base de donnÃ©es capdata, et aucunes autres bases Ã  partir de notre repo1.&lt;/p&gt;&#xA;&lt;h3&gt;PgBouncer :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;PgBouncer est un pooler de connexion pour PostgreSQL. Un pooler de connexion permet de maintenir ouvertes des sessions entre lui-mÃªme et le serveur, ce qui rend plus rapide l&amp;#8217;ouverture de sessions depuis les clients, une application Web par exemple.&lt;br /&gt;&#xA;PgBouncer permet aussi de mutualiser les sessions dans le serveur, Ã©conomisant ainsi des ressources. PgBouncer propose plusieurs modes de partage : par requÃªte (default), par transaction ou par session.&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour ajouter un bouncer Ã  notre configuration câ€™est une rÃ©alitÃ© trÃ¨s simple. Il suffit dâ€™ajouter dans notre fichier postgres.yaml la rubrique proxy :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;proxy:&#xD;&#xA;  pgBouncer:&#xD;&#xA;    image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbouncer:ubi8-1.21-3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois que vous avez rajoutÃ© cela dans la configuration, il nâ€™y a plus quâ€™Ã  appliquer celle-ci :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; kubectl apply -k kustomize/keycloak &lt;/pre&gt;&#xA;&lt;p&gt;Quand PGO crÃ©Ã© un nouveau connexion pooler sur notre instance dÃ©ployÃ©e, il modifier le fichier secrets de lâ€™utilisateur.&lt;br /&gt;&#xA;On voit que plusieurs champs qui concerne pg_bouncer sont apparus. Ils constituent les informations qui vont vous permettre de vous connecter sur votre bouncer nouvellement crÃ©Ã© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;{&#xD;&#xA;    &amp;quot;apiVersion&amp;quot;: &amp;quot;v1&amp;quot;,&#xD;&#xA;    &amp;quot;data&amp;quot;: {&#xD;&#xA;        &amp;quot;dbname&amp;quot;: &amp;quot;cGdjbHVzdGVyMQ==&amp;quot;,&#xD;&#xA;        &amp;quot;host&amp;quot;: &amp;quot;cGdjbHVzdGVyMS1wcmltYXJ5LnBvc3RncmVzLW9wZXJhdG9yLnN2Yw==&amp;quot;,&#xD;&#xA;        &amp;quot;jdbc-uri&amp;quot;: &amp;quot;amRiYzpwb3N0Z3Jlc3FsOi8vcGdjbHVzdGVyMS1wcmltYXJ5LnBvc3RncmVzLW9wZXJhdG9yLnN2Yzo1NDMyL3BnY2x1c3RlcjE/cGFzc3dvcmQ9NXNSaSUzRCU1QmZZbSUzQ2lSSGslMkElNUIlM0VuWGhqaiU3Q1EmdXNlcj1wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;password&amp;quot;: &amp;quot;NXNSaT1bZlltPGlSSGsqWz5uWGhqanxR&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-host&amp;quot;: &amp;quot;cGdjbHVzdGVyMS1wZ2JvdW5jZXIucG9zdGdyZXMtb3BlcmF0b3Iuc3Zj&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-jdbc-uri&amp;quot;: &amp;quot;amRiYzpwb3N0Z3Jlc3FsOi8vcGdjbHVzdGVyMS1wZ2JvdW5jZXIucG9zdGdyZXMtb3BlcmF0b3Iuc3ZjOjU0MzIvcGdjbHVzdGVyMT9wYXNzd29yZD01c1JpJTNEJTVCZlltJTNDaVJIayUyQSU1QiUzRW5YaGpqJTdDUSZwcmVwYXJlVGhyZXNob2xkPTAmdXNlcj1wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-port&amp;quot;: &amp;quot;NTQzMg==&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-uri&amp;quot;: &amp;quot;cG9zdGdyZXNxbDovL3BnY2x1c3RlcjE6NXNSaT0lNUJmWW0lM0NpUkhrJTJBJTVCJTNFblhoamolN0NRQHBnY2x1c3RlcjEtcGdib3VuY2VyLnBvc3RncmVzLW9wZXJhdG9yLnN2Yzo1NDMyL3BnY2x1c3RlcjE=&amp;quot;,&#xD;&#xA;        &amp;quot;port&amp;quot;: &amp;quot;NTQzMg==&amp;quot;,&#xD;&#xA;        &amp;quot;uri&amp;quot;: &amp;quot;cG9zdGdyZXNxbDovL3BnY2x1c3RlcjE6NXNSaT0lNUJmWW0lM0NpUkhrJTJBJTVCJTNFblhoamolN0NRQHBnY2x1c3RlcjEtcHJpbWFyeS5wb3N0Z3Jlcy1vcGVyYXRvci5zdmM6NTQzMi9wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;user&amp;quot;: &amp;quot;cGdjbHVzdGVyMQ==&amp;quot;,&#xD;&#xA;        &amp;quot;verifier&amp;quot;: &amp;quot;U0NSQU0tU0hBLTI1NiQ0MDk2OlgyQ3NQRU1FZjh3QkVlc05McDFJTkE9PSRKcDhKakl5Q0o1ZEpFRVhia1ptUERTNE5rR3d0V00rczdrMElsQmx0YkpvPTpEaHg3VzNCOE5vNDRYSHJ1Qm1RdENMQW9jNEtnSUZQa2dIeStUMkVWUUowPQ==&amp;quot;&#xD;&#xA;    },&#xD;&#xA;    &amp;quot;kind&amp;quot;: &amp;quot;Secret&amp;quot;,&#xD;&#xA;    &amp;quot;metadata&amp;quot;: {&#xD;&#xA;        &amp;quot;creationTimestamp&amp;quot;: &amp;quot;2024-04-09T16:37:36Z&amp;quot;,&#xD;&#xA;        &amp;quot;labels&amp;quot;: {&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/cluster&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/pguser&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/role&amp;quot;: &amp;quot;pguser&amp;quot;&#xD;&#xA;        },&#xD;&#xA;        &amp;quot;name&amp;quot;: &amp;quot;pgcluster1-pguser-pgcluster1&amp;quot;,&#xD;&#xA;        &amp;quot;namespace&amp;quot;: &amp;quot;postgres-operator&amp;quot;,&#xD;&#xA;        &amp;quot;ownerReferences&amp;quot;: [&#xD;&#xA;            {&#xD;&#xA;                &amp;quot;apiVersion&amp;quot;: &amp;quot;postgres-operator.crunchydata.com/v1beta1&amp;quot;,&#xD;&#xA;                &amp;quot;blockOwnerDeletion&amp;quot;: true,&#xD;&#xA;                &amp;quot;controller&amp;quot;: true,&#xD;&#xA;                &amp;quot;kind&amp;quot;: &amp;quot;PostgresCluster&amp;quot;,&#xD;&#xA;                &amp;quot;name&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;                &amp;quot;uid&amp;quot;: &amp;quot;7260b882-116f-4b02-b51a-18d4fe3a8038&amp;quot;&#xD;&#xA;            }&#xD;&#xA;        ],&#xD;&#xA;        &amp;quot;resourceVersion&amp;quot;: &amp;quot;9495&amp;quot;,&#xD;&#xA;        &amp;quot;uid&amp;quot;: &amp;quot;1fbdf1d2-48ea-4a45-b7d6-01248317dbee&amp;quot;&#xD;&#xA;    },&#xD;&#xA;    &amp;quot;type&amp;quot;: &amp;quot;Opaque&amp;quot;&#xD;&#xA;}&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Pour se connecter Ã  notre pgbouncer, il suffit dâ€™utiliser les informations fournies par le fichier de secret Ã  la place de nos infos de connexion habituelles, et cela nous permet dâ€™accÃ©der directement au bouncer et non plus Ã  lâ€™instance elle-mÃªme.&lt;/p&gt;&#xA;&lt;p&gt;Cette connexion peut Ãªtre facilement modifiÃ©e en utilisant la documentation de pgbouncer afin de pouvoir configurer Ã  notre guise notre pgbouncer. Un exemple de configuration quâ€™on pourrais rencontrer serait :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;  proxy:&#xD;&#xA;    pgBouncer:&#xD;&#xA;      image: {{.Values.image.pgBouncer }}&#xD;&#xA;      config:&#xD;&#xA;        global:&#xD;&#xA;          default_pool_size: &amp;quot;100&amp;quot;&#xD;&#xA;          max_client_conn: &amp;quot;10000&amp;quot;&#xD;&#xA;          pool_mode: transaction&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Pour cet exemple on voit quâ€™on a dÃ©finit un nombre de client maximum, la taille du pool Ã  100 et un mode transaction pour notre pool.&lt;/p&gt;&#xA;&lt;h3&gt;PGO et Prometheus&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;Prometheus est une trousse Ã  outils de surveillance et d&amp;#8217;alerte des systÃ¨mes en open source.&lt;br /&gt;&#xA;Prometheus collecte et stocke ses mÃ©triques sous forme de donnÃ©es de sÃ©ries temporelles, c&amp;#8217;est-Ã -dire que les informations de mÃ©triques sont stockÃ©es avec le timestamp auquel elles ont Ã©tÃ© enregistrÃ©es, aux cÃ´tÃ©s de paires clÃ©-valeur optionnelles appelÃ©es labels.&lt;br /&gt;&#xA;&amp;#8211; Un modÃ¨le de donnÃ©es multidimensionnel avec des donnÃ©es de sÃ©ries temporelles identifiÃ©es par le nom de la mÃ©trique et des paires clÃ©-valeur&lt;br /&gt;&#xA;&amp;#8211; PromQL, un langage de requÃªte flexible pour exploiter cette dimensionnalitÃ©&lt;br /&gt;&#xA;&amp;#8211; Aucune dÃ©pendance sur le stockage distribuÃ© ; les nÅ“uds de serveur individuels sont autonomes&lt;br /&gt;&#xA;&amp;#8211; La collecte de sÃ©ries temporelles se fait via un modÃ¨le de tirage sur HTTP&lt;br /&gt;&#xA;&amp;#8211; La poussÃ©e de sÃ©ries temporelles est prise en charge via une passerelle intermÃ©diaire&lt;br /&gt;&#xA;&amp;#8211; Les cibles sont dÃ©couvertes via la dÃ©couverte de service ou la configuration statique&lt;br /&gt;&#xA;&amp;#8211; Prise en charge de plusieurs modes de graphiques et de tableaux de bord&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir mettre en place une surveillance pour notre cluster, il est plus simple de tÃ©lÃ©charger et complÃ©ter le modÃ¨le fournit dans les exemples de pgo.&lt;br /&gt;&#xA;Ainsi, on peut rÃ©cupÃ©rer les exemples Ã  lâ€™aide de git :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;YOUR_GITHUB_UN=&amp;quot;$YOUR_GITHUB_USERNAME&amp;quot;&#xD;&#xA;git clone --depth 1 &amp;quot;git@github.com:${YOUR_GITHUB_UN}/postgres-operator-examples.git&amp;quot;&#xD;&#xA;cd postgres-operator-examples&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Les diffÃ©rentes configurations se trouvent dans le dossier kustomize/monitoring.&lt;br /&gt;&#xA;Pour activer le monitoring de notre instance, il faut ajouter la balise monitoring Ã  notre fichier postgres.yaml :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;monitoring:&#xD;&#xA;  pgmonitor:&#xD;&#xA;    exporter:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres-exporter:ubi8-5.5.1-0&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois notre configuration modifiÃ©e, on lâ€™applique afin que PGO dÃ©tecte les changements et configure tout seul lâ€™exporter pour quâ€™il puisse se connecter Ã  nos bases de donnÃ©es et rÃ©cupÃ©rer les mÃ©triques.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;kubectl apply -k kustomize/postgres&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il faut ensuite appliquer la configuration de base de pgmonitor pour quâ€™il crÃ©Ã© lui-mÃªme les fichiers de configuration pour prometheus (il le fera en mÃªme temps pour Grafana et Alertmanager qui sont deux autres outils de surveillance). Pour cela on applique le kustomize prÃ©sent dans le dossier monitoring :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;$kubectl apply -k kustomize\postgres&#xD;&#xA;postgrescluster.postgres-operator.crunchydata.com/pgcluster1 configured&#xD;&#xA;$kubectl apply -k kustomize\monitoring&#xD;&#xA;serviceaccount/alertmanager created&#xD;&#xA;serviceaccount/grafana created&#xD;&#xA;serviceaccount/prometheus created&#xD;&#xA;clusterrole.rbac.authorization.k8s.io/prometheus created&#xD;&#xA;clusterrolebinding.rbac.authorization.k8s.io/prometheus created&#xD;&#xA;configmap/alert-rules-config created&#xD;&#xA;configmap/alertmanager-config created&#xD;&#xA;configmap/crunchy-prometheus created&#xD;&#xA;configmap/grafana-dashboards created&#xD;&#xA;configmap/grafana-datasources created&#xD;&#xA;secret/grafana-admin created&#xD;&#xA;service/crunchy-alertmanager created&#xD;&#xA;service/crunchy-grafana created&#xD;&#xA;service/crunchy-prometheus created&#xD;&#xA;persistentvolumeclaim/alertmanagerdata created&#xD;&#xA;persistentvolumeclaim/grafanadata created&#xD;&#xA;persistentvolumeclaim/prometheusdata created&#xD;&#xA;deployment.apps/crunchy-alertmanager created&#xD;&#xA;deployment.apps/crunchy-grafana created&#xD;&#xA;deployment.apps/crunchy-prometheus created&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos services ont Ã©tÃ© correctement dÃ©ployÃ©s, il ne nous reste plus quâ€™Ã  utiliser celui qui nous intÃ©resse, ici service/crunchy-prometheus et lui indiquer de commencer Ã  envoyer les informations sur notre prometheus :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;$kubectl -n postgres-operator port-forward service/crunchy-prometheus 9090:9090&#xD;&#xA;Forwarding from 127.0.0.1:9090 -&amp;gt; 9090&#xD;&#xA;Forwarding from [::1]:9090 -&amp;gt; 9090&#xD;&#xA;Handling connection for 9090&#xD;&#xA;Handling connection for 9090&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Afin dâ€™accÃ©der Ã  notre service prometheus, il ne nous reste plus quâ€™Ã  se connecter avec lâ€™adresse de notre machine, sur le port 9090 prÃ©alablement ouvert, pour voir apparaitre le dashboard de prometheus :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2.jpg&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10567&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-300x66.jpg&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;66&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-300x66.jpg 300w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-1024x226.jpg 1024w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-768x170.jpg 768w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2.jpg 1386w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3&gt;PGO Client :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir gÃ©rer plus facilement le cluster crÃ©Ã© par PGO, CrunchyData Ã  dÃ©veloppÃ© une surcouche Ã  kubectl qui permet de faciliter les commandes que nous pouvons rÃ©aliser sur le cluster.&lt;br /&gt;&#xA;Cela permet de ne pas avoir Ã  taper les longues lignes de commandes qui permettent par exemple de dÃ©marrer les sauvegardes unitaires.&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir installer cette surcouche, il faut tÃ©lÃ©charger la version qui correspond au systÃ¨me dâ€™exploitation Ã  partir du GIT de pgo client :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;# wget https://github.com/CrunchyData/postgres-operator-client/releases/download/v0.4.1/kubectl-pgo-linux-arm64&#xD;&#xA;--2024-04-11 12:07:45--  https://github.com/CrunchyData/postgres-operator-client/releases/download/v0.4.1/kubectl-pgo-linux-arm64&#xD;&#xA;Resolving github.com (github.com)... 140.82.121.4&#xD;&#xA;Connecting to github.com (github.com)|140.82.121.4|:443... connected.&#xD;&#xA;HTTP request sent, awaiting response... 302 Found&#xD;&#xA;Resolving objects.githubusercontent.com (objects.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.110.133, ...&#xD;&#xA;Connecting to objects.githubusercontent.com (objects.githubusercontent.com)|185.199.109.133|:443... connected.&#xD;&#xA;HTTP request sent, awaiting response... 200 OK&#xD;&#xA;Length: 47895849 (46M) [application/octet-stream]&#xD;&#xA;Saving to: â€˜kubectl-pgo-linux-arm64â€™&#xD;&#xA;&#xD;&#xA;kubectl-pgo-linux-arm64                                     100%[========================================================================================================================================&amp;gt;]  45.68M  --.-KB/s    in 0.1s&#xD;&#xA;&#xD;&#xA;2024-04-11 12:07:45 (373 MB/s) - â€˜kubectl-pgo-linux-arm64â€™ saved [47895849/47895849]&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On renome le fichier tÃ©lÃ©chargÃ© en kubectl-pgo et on le dÃ©place dans nos bin pour pouvoir les utiliser :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;# mv kubectl-pgo-linux-arm64 kubectl-pgo&#xD;&#xA;# sudo mv kubectl-pgo /usr/local/bin/kubectl-pgo&#xD;&#xA;# sudo chmod +x /usr/local/bin/kubectl-pgo&#xD;&#xA;Une fois que ces actions sont rÃ©alisÃ©es, on peut tester le fonctionnement :&#xD;&#xA;# kubectl pgo version&#xD;&#xA;Client Version: v0.4.1&#xD;&#xA;Operator Version: v5.5.1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Les commandes disponibles avec cette extension sont les suivantes :&lt;br /&gt;&#xA;&amp;#8211; backup : Backup cluster&lt;br /&gt;&#xA;&amp;#8211; create : Create a resource&lt;br /&gt;&#xA;&amp;#8211; delete : Delete a resource&lt;br /&gt;&#xA;&amp;#8211; help : Help about any command&lt;br /&gt;&#xA;&amp;#8211; restore : Restore cluster&lt;br /&gt;&#xA;&amp;#8211; show Show : PostgresCluster details&lt;br /&gt;&#xA;&amp;#8211; start : Start cluster&lt;br /&gt;&#xA;&amp;#8211; stop : Stop cluster&lt;br /&gt;&#xA;&amp;#8211; support : Crunchy Support commands for PGO&lt;br /&gt;&#xA;&amp;#8211; version : PGO client&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pgo-operateurs-kubernetes-pour-postgresql-la-suite/&#34; rel=&#34;bookmark&#34; title=&#34;6 juin 2023&#34;&gt;PGO : opÃ©rateurs kubernetes pour PostgreSQL, la suite !&lt;/a&gt; (David Baffaleuf) [ContainerDevopsPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/kubegres-loperateur-kubernetes-cle-en-main-pour-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;26 avril 2023&#34;&gt;Kubegres : l&amp;#8217;opÃ©rateur Kubernetes clÃ© en main pour PostgreSQL&lt;/a&gt; (David Baffaleuf) [ContainerDevopsPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-sur-la-solution-kubernetes-locale-minikube/&#34; rel=&#34;bookmark&#34; title=&#34;29 mars 2023&#34;&gt;PostgreSQL sur la solution Kubernetes locale Minikube&lt;/a&gt; (Emmanuel RAMI) [ContainerPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-comparatif-entre-barman-et-pgbackrest/&#34; rel=&#34;bookmark&#34; title=&#34;4 fÃ©vrier 2020&#34;&gt;PostgreSQL : Comparatif entre Barman et pgBackRest&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/sauvegardes-sql-server-dans-un-azure-blob-storage/&#34; rel=&#34;bookmark&#34; title=&#34;21 aoÃ»t 2018&#34;&gt;Sauvegardes SQL Server dans un Azure Blob Storage&lt;/a&gt; (Capdata team) [AzureSQL Server]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.579 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;title=PGO%20%3A%20la%20suite&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PGO%20%3A%20la%20suite&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34;&gt;PGO : la suite&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pgo-la-suite/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;La gestion efficace des clusters PostgreSQL dans un environnement Kubernetes est un dÃ©fi complexe auquel sont confrontÃ©es de nombreuses entreprises aujourd&amp;#8217;hui. PGO offre une solution dÃ©clarative qui automatise la gestion des clusters PostgreSQL, simplifiant ainsi le dÃ©ploiement, la mise Ã &amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34;&gt;PGO : la suite&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>pg_recursively_delete : Simplifier les suppressions rÃ©cursives</title>
    <updated>2024-04-03T13:11:08Z</updated>
    <id>tag:blog.capdata.fr,2024-04-03:/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10505&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10505&amp;#038;title=pg_recursively_delete%20%3A%20Simplifier%20les%20suppressions%20r%C3%A9cursives&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_recursively_delete%20%3A%20Simplifier%20les%20suppressions%20r%C3%A9cursives&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10505&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Si vous avez Ã©tÃ© amenÃ© au fil de votre carriÃ¨re Ã  manipuler de gros volumes de donnÃ©es contenus dans plusieurs tables possÃ©dant des rÃ©fÃ©rences croisÃ©es entre elles, dÃ©pendantes d&amp;#8217;autres tables, qui elles-mÃªmes dÃ©pendent d&amp;#8217;autres tables, vous savez Ã  quel point il peut Ãªtre compliquÃ© de remonter l&amp;#8217;intÃ©gralitÃ© de l&amp;#8217;arbre de dÃ©pendance pour supprimer la moindre ligne. Cela peut Ãªtre long et fastidieux.&lt;/p&gt;&#xA;&lt;p&gt;Vous ne savez pas vraiment ce que vous supprimez, dans quelles tables, et quels impacts cela peut avoir sur votre base de donnÃ©es. Si les dÃ©pendances sont nombreuses, il est d&amp;#8217;autant plus compliquÃ© de tout retracer et d&amp;#8217;Ãªtre sÃ»r Ã  100 % de ce que votre DELETE va entraÃ®ner.&lt;/p&gt;&#xA;&lt;p&gt;Dans cet article, je vais vous prÃ©senter rapidement un petit outil sous la forme d&amp;#8217;une extension que je trouve pratique Ã  utiliser dans ce cas de figure. L&amp;#8217;outil s&amp;#8217;appelle pg_recursively_delete, et il permet de tracer avant d&amp;#8217;exÃ©cuter l&amp;#8217;ordre de suppression de votre ligne, et d&amp;#8217;avoir une arborescence des diffÃ©rentes donnÃ©es que vous allez impacter.&lt;/p&gt;&#xA;&lt;h2&gt;Installation d&amp;#8217;un moteur et de l&amp;#8217;extension :&lt;/h2&gt;&#xA;&lt;p&gt;Pour cet article, j&amp;#8217;ai choisi d&amp;#8217;utiliser PostgreSQL en version 16 pour tester si l&amp;#8217;extension fonctionnait toujours.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;root:~#sudo apt update &amp;amp;amp;&amp;amp;amp; sudo apt upgrade&#xD;&#xA;root:~#sudo sh -c &#39;echo &amp;quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&amp;quot; &amp;amp;gt; /etc/apt/sources.list.d/pgdg.list&#39;&#xD;&#xA;root:~#wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -&#xD;&#xA;root:~#sudo apt -y update&#xD;&#xA;root:~#sudo apt -y install postgresql-16&lt;/pre&gt;&#xA;&lt;p&gt;Notre moteur de base de donnÃ©es est installÃ©, Ã  prÃ©sent il nous faut tÃ©lÃ©charger les sources de l&amp;#8217;extension, et l&amp;#8217;installer.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;root:~# git clone https://github.com/trlorenz/PG-recursively_delete.git&#xD;&#xA;Cloning into &#39;PG-recursively_delete&#39;...&#xD;&#xA;remote: Enumerating objects: 155, done.&#xD;&#xA;remote: Counting objects: 100% (95/95), done.&#xD;&#xA;remote: Compressing objects: 100% (62/62), done.&#xD;&#xA;remote: Total 155 (delta 41), reused 74 (delta 29), pack-reused 60&#xD;&#xA;Receiving objects: 100% (155/155), 38.55 KiB | 3.21 MiB/s, done.&#xD;&#xA;Resolving deltas: 100% (70/70), done.&#xD;&#xA;root:~# cd PG-recursively_delete/&#xD;&#xA;root:~/PG-recursively_delete# make&#xD;&#xA;cp sql/recursively_delete.sql sql/recursively_delete--0.1.5.sql&#xD;&#xA;root:~/PG-recursively_delete# sudo make install&#xD;&#xA;/bin/mkdir -p &#39;/usr/share/postgresql/16/extension&#39;&#xD;&#xA;/bin/mkdir -p &#39;/usr/share/postgresql/16/extension&#39;&#xD;&#xA;/bin/mkdir -p &#39;/usr/share/doc/postgresql-doc-16/extension&#39;&#xD;&#xA;/usr/bin/install -c -m 644 .//recursively_delete.control &#39;/usr/share/postgresql/16/extension/&#39;&#xD;&#xA;/usr/bin/install -c -m 644 .//sql/recursively_delete--0.1.5.sql  &#39;/usr/share/postgresql/16/extension/&#39;&#xD;&#xA;/usr/bin/install -c -m 644 .//doc/changelog.md &#39;/usr/share/doc/postgresql-doc-16/extension/&#39;&lt;/pre&gt;&#xA;&lt;h2&gt;Mise en place de l&amp;#8217;environnement&lt;/h2&gt;&#xA;&lt;p&gt;Pour illustrer le fonctionnement de l&amp;#8217;extension, je vais utiliser la base de donnÃ©es de dÃ©monstration dvdrental. Nous allons donc la tÃ©lÃ©charger et la charger dans une toute nouvelle base de donnÃ©es que nous aurons crÃ©Ã©e sur notre instance fraÃ®chement crÃ©Ã©e :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; postgres:~$ wget https://www.postgresqltutorial.com/wp-content/uploads/2019/05/dvdrental.zip&#xD;&#xA;--2024-03-11 08:34:54--  https://www.postgresqltutorial.com/wp-content/uploads/2019/05/dvdrental.zip&#xD;&#xA;Resolving www.postgresqltutorial.com (www.postgresqltutorial.com)... 104.21.2.174, 172.67.129.129, 2606:4700:3037::6815:2ae, ...&#xD;&#xA;Connecting to www.postgresqltutorial.com (www.postgresqltutorial.com)|104.21.2.174|:443... connected.&#xD;&#xA;HTTP request sent, awaiting response... 200 OK&#xD;&#xA;Length: 550906 (538K) [application/zip]&#xD;&#xA;Saving to: â€˜dvdrental.zipâ€™&#xD;&#xA;&#xD;&#xA;dvdrental.zip                                               100%[========================================================================================================================================&amp;gt;] 537.99K  --.-KB/s    in 0.01s&#xD;&#xA;&#xD;&#xA;2024-03-11 08:34:54 (46.0 MB/s) - â€˜dvdrental.zipâ€™ saved [550906/550906]  &lt;/pre&gt;&#xA;&lt;p&gt;Une fois tÃ©lÃ©chargÃ©e, on la dezippe :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;postgres:~$ ls -l&#xD;&#xA;total 544&#xD;&#xA;drwxr-xr-x 3 postgres postgres   4096 Mar 11 08:30 16&#xD;&#xA;-rw-rw-r-- 1 postgres postgres 550906 May 12  2019 dvdrental.zip&#xD;&#xA;postgres:~$ unzip dvdrental.zip&#xD;&#xA;Archive:  dvdrental.zip&#xD;&#xA;  inflating: dvdrental.tar&#xD;&#xA;postgres:~$ ls -l&#xD;&#xA;total 3316&#xD;&#xA;drwxr-xr-x 3 postgres postgres    4096 Mar 11 08:30 16&#xD;&#xA;-rw-rw-r-- 1 postgres postgres 2835456 May 12  2019 dvdrental.tar&#xD;&#xA;-rw-rw-r-- 1 postgres postgres  550906 May 12  2019 dvdrental.zip&lt;/pre&gt;&#xA;&lt;p&gt;On crÃ©Ã© la base de donnÃ©es pour accueillir nos donnÃ©es, et on charge le fichier de sauvegarde :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;postgres:~$ psql&#xD;&#xA;psql (16.2 (Ubuntu 16.2-1.pgdg22.04+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help. &lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;postgres=# create database dvdrental;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \l&#xD;&#xA;                                                   List of databases&#xD;&#xA;   Name    |  Owner   | Encoding | Locale Provider | Collate |  Ctype  | ICU Locale | ICU Rules |   Access privileges&#xD;&#xA;-----------+----------+----------+-----------------+---------+---------+------------+-----------+-----------------------&#xD;&#xA; dvdrental | postgres | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           |&#xD;&#xA; postgres  | postgres | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           |&#xD;&#xA; template0 | postgres | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           | =c/postgres          +&#xD;&#xA;           |          |          |                 |         |         |            |           | postgres=CTc/postgres&#xD;&#xA; template1 | postgres | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           | =c/postgres          +&#xD;&#xA;           |          |          |                 |         |         |            |           | postgres=CTc/postgres&#xD;&#xA;(4 rows)&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;postgres:~$ pg_restore -U postgres -d dvdrental dvdrental.tar&lt;/pre&gt;&#xA;&lt;p&gt;Une fois que c&amp;#8217;est fait, on peut se connecter pour vÃ©rifier que tout a bien Ã©tÃ© chargÃ© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;postgres:~$ psql&#xD;&#xA;psql (16.2 (Ubuntu 16.2-1.pgdg22.04+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;postgres=# \c dvdrental&#xD;&#xA;You are now connected to database &amp;quot;dvdrental&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;dvdrental=# \dt&#xD;&#xA;             List of relations&#xD;&#xA; Schema |     Name      | Type  |  Owner&#xD;&#xA;--------+---------------+-------+----------&#xD;&#xA; public | actor         | table | postgres&#xD;&#xA; public | address       | table | postgres&#xD;&#xA; public | category      | table | postgres&#xD;&#xA; public | city          | table | postgres&#xD;&#xA; public | country       | table | postgres&#xD;&#xA; public | customer      | table | postgres&#xD;&#xA; public | film          | table | postgres&#xD;&#xA; public | film_actor    | table | postgres&#xD;&#xA; public | film_category | table | postgres&#xD;&#xA; public | inventory     | table | postgres&#xD;&#xA; public | language      | table | postgres&#xD;&#xA; public | payment       | table | postgres&#xD;&#xA; public | rental        | table | postgres&#xD;&#xA; public | staff         | table | postgres&#xD;&#xA; public | store         | table | postgres&#xD;&#xA;(15 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h2&gt;L&amp;#8217;extension :&lt;/h2&gt;&#xA;&lt;p&gt;Pour tester l&amp;#8217;extension, nous allons essayer de supprimer un client de la liste des clients.&lt;br /&gt;&#xA;Le schÃ©ma de la base de donnÃ©es dvdrental est le suivant :&lt;br /&gt;&#xA;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2024/03/dvd-rental-sample-database-diagram.png&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone wp-image-10507&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/03/dvd-rental-sample-database-diagram-238x300.png&#34; alt=&#34;&#34; width=&#34;336&#34; height=&#34;424&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2024/03/dvd-rental-sample-database-diagram-238x300.png 238w, https://blog.capdata.fr/wp-content/uploads/2024/03/dvd-rental-sample-database-diagram.png 730w&#34; sizes=&#34;auto, (max-width: 336px) 100vw, 336px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on observe attentivement le schÃ©ma ci-dessus, en voulant supprimer une donnÃ©e de la table customer, cela devrait avoir un impact sur les tables rental et payment qui sont directement liÃ©es Ã  la table customer. De plus, ces deux tables sont Ã©galement liÃ©es entre elles, ce qui signifie que supprimer une donnÃ©e dans la table rental modifiera nÃ©cessairement la table payment.&lt;/p&gt;&#xA;&lt;p&gt;Prenons l&amp;#8217;exemple de la suppression du client numÃ©ro 1. Si nous recherchons les dÃ©pendances de ce client dans la table rental, nous obtenons 32 lignes associÃ©es au customer_id 1 :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; dvdrental=# select count(*) from rental where customer_id = 1;&#xD;&#xA; count&#xD;&#xA;-------&#xD;&#xA;    32&#xD;&#xA;(1 row)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et si nous allons maintenant chercher toutes les occurrences de ce mÃªme client dans la table des paiements, nous obtenons :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;dvdrental=# select count(*) from payment where customer_id = 1;&#xD;&#xA; count&#xD;&#xA;-------&#xD;&#xA;    30&#xD;&#xA;(1 row) &lt;/pre&gt;&#xA;&lt;p&gt;Ã€ prÃ©sent, avec l&amp;#8217;extension recursive_delete, nous allons chercher Ã  obtenir le schÃ©ma de suppression pour vÃ©rifier si les rÃ©sultats que nous avons trouvÃ©s sont corrects :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;dvdrental=# create extension recursively_delete;&#xD;&#xA;CREATE EXTENSION&#xD;&#xA;dvdrental=# \set VERBOSITY terse&#xD;&#xA;dvdrental=# select recursively_delete(&#39;customer&#39;, 1);&#xD;&#xA;INFO:  DAMAGE PREVIEW (recursively_delete v0.1.5)&#xD;&#xA;INFO:&#xD;&#xA;INFO:          1     customer&#xD;&#xA;INFO:         30 r   | payment.[&amp;quot;customer_id&amp;quot;]&#xD;&#xA;INFO:         32 r   | rental.[&amp;quot;customer_id&amp;quot;]&#xD;&#xA;INFO:          ~ n   | | payment.[&amp;quot;rental_id&amp;quot;]&#xD;&#xA;INFO:&#xD;&#xA; recursively_delete&#xD;&#xA;--------------------&#xD;&#xA;                  0&#xD;&#xA;(1 row) &lt;/pre&gt;&#xA;&lt;p&gt;La fonction de suppression de l&amp;#8217;extension fonctionne avec les paramÃ¨tres suivants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le nom de la table en premier paramÃ¨tre&lt;/li&gt;&#xA;&lt;li&gt;La clause WHERE du DELETE en second paramÃ¨tre, qui peut Ãªtre de multiples types (des entiers, des chaÃ®nes de caractÃ¨res, des listes, des UUID&amp;#8230;)&lt;/li&gt;&#xA;&lt;li&gt;Le mode de fonctionnement de l&amp;#8217;extension, par dÃ©faut Ã  false, qui indique au programme de ne pas effectuer les suppressions, mais simplement de dresser le schÃ©ma. Le passer Ã  true entraÃ®nerait les suppressions.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Pour interprÃ©ter le schÃ©ma, voici la composition de chaque nÅ“ud :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;La premiÃ¨re colonne correspond au nombre de lignes&lt;/li&gt;&#xA;&lt;li&gt;Le type de contraintes qui expliquent l&amp;#8217;implication de la table dans le schÃ©ma : &amp;#8216;a&amp;#8217;, &amp;#8216;r&amp;#8217;, &amp;#8216;c&amp;#8217;, &amp;#8216;n&amp;#8217;, ou &amp;#8216;d&amp;#8217; (&amp;#8216;no action&amp;#8217;, &amp;#8216;restrict&amp;#8217;, &amp;#8216;cascade&amp;#8217;, &amp;#8216;set null&amp;#8217;, ou &amp;#8216;set default&amp;#8217;)&lt;/li&gt;&#xA;&lt;li&gt;Un indicateur de si oui ou non le champ en question participe Ã  une rÃ©fÃ©rence circulaire.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;En examinant le rÃ©sultat renvoyÃ© par notre extension, nous constatons que nous obtenons les mÃªmes rÃ©sultats : 30 lignes pour payment et 32 lignes pour rental. Nous obtenons Ã©galement une derniÃ¨re ligne qui nous indique que payment possÃ¨de une rÃ©fÃ©rence Ã  rental dans sa structure, et qu&amp;#8217;il va lui aussi procÃ©der Ã  des suppressions en fonction du rental_id. Cela pourrait Ãªtre par exemple le cas oÃ¹ une location effectuÃ©e par un client serait payÃ©e par un autre.&lt;/p&gt;&#xA;&lt;p&gt;Pour effectuer la suppression, il suffit simplement de prÃ©ciser true en troisiÃ¨me paramÃ¨tre.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;dvdrental=# select recursively_delete(&#39;customer&#39;, 1, true);&#xD;&#xA; recursively_delete&#xD;&#xA;--------------------&#xD;&#xA;                  1&#xD;&#xA;(1 row)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et Ã  prÃ©sent, si nous consultons notre table customer, la ligne 1 a disparu, ainsi que toutes les lignes qui la concernent dans d&amp;#8217;autres tables Ã©galement.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;dvdrental=# select count(*) from customer where customer_id = 1;&#xD;&#xA; count&#xD;&#xA;-------&#xD;&#xA;     0&#xD;&#xA;(1 row)&#xD;&#xA;&#xD;&#xA;dvdrental=# select count(*) from rental where customer_id = 1;&#xD;&#xA; count&#xD;&#xA;-------&#xD;&#xA;     0&#xD;&#xA;(1 row)&#xD;&#xA;&#xD;&#xA;dvdrental=# select count(*) from payment where customer_id = 1;&#xD;&#xA; count&#xD;&#xA;-------&#xD;&#xA;     0&#xD;&#xA;(1 row)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos lignes ont bel et bien disparu.&lt;/p&gt;&#xA;&lt;p&gt;Cette extension fonctionne Ã©galement avec les clÃ©s primaires composites. Il suffit de prÃ©ciser entre crochets les deux valeurs de notre clÃ© primaire, et le tour est jouÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Pour illustrer davantage le fonctionnement, je vais rÃ©aliser une suppression sur la table film. Cette table possÃ¨de quelques dÃ©pendances.&lt;br /&gt;&#xA;Disons que nous souhaitons supprimer les 10 premiers films de notre liste, car ils ne sont plus louÃ©s Ã©tant trop anciens (plus personne n&amp;#8217;a de magnÃ©toscope pour regarder de bonnes vieilles cassettes !).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;dvdrental=# select recursively_delete(&#39;film&#39;, (SELECT array_agg(film_id) FROM film  WHERE film_id between 1 and 10));&#xD;&#xA;INFO:  DAMAGE PREVIEW (recursively_delete v0.1.5)&#xD;&#xA;INFO:&#xD;&#xA;INFO:         10     film&#xD;&#xA;INFO:         62 r   | film_actor.[&amp;quot;film_id&amp;quot;]&#xD;&#xA;INFO:         10 r   | film_category.[&amp;quot;film_id&amp;quot;]&#xD;&#xA;INFO:         52 r   | inventory.[&amp;quot;film_id&amp;quot;]&#xD;&#xA;INFO:        165 r   | | rental.[&amp;quot;inventory_id&amp;quot;]&#xD;&#xA;INFO:          ~ n   | | | payment.[&amp;quot;rental_id&amp;quot;]&#xD;&#xA;INFO:&#xD;&#xA; recursively_delete&#xD;&#xA;--------------------&#xD;&#xA;                  0&#xD;&#xA;(1 row)&lt;/pre&gt;&#xA;&lt;p&gt;Nous observons donc que notre suppression de 10 films (dans un array) entraÃ®ne la suppression d&amp;#8217;acteurs, de catÃ©gories, d&amp;#8217;inventaires, et par extension, de locations et de paiements&lt;/p&gt;&#xA;&lt;h2&gt;Conclusion :&lt;/h2&gt;&#xA;&lt;p&gt;En conclusion, l&amp;#8217;extension pg_recursively_delete offre une solution pratique pour supprimer rÃ©cursivement des donnÃ©es dans PostgreSQL, simplifiant ainsi les tÃ¢ches de maintenance et de nettoyage des bases de donnÃ©es. Cependant, malgrÃ© ses avantages, cette extension prÃ©sente certaines limites en termes de performances.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;#8217;une des principales limitations rÃ©side dans le fait que la suppression rÃ©cursive peut entraÃ®ner des opÃ©rations coÃ»teuses en termes de temps d&amp;#8217;exÃ©cution, surtout lorsque les donnÃ©es concernÃ©es sont fortement imbriquÃ©es ou que la base de donnÃ©es est volumineuse. Les performances peuvent Ã©galement Ãªtre affectÃ©es lorsque les tables impliquÃ©es dans la suppression ont des index complexes ou des contraintes de clÃ©s Ã©trangÃ¨res.&lt;/p&gt;&#xA;&lt;p&gt;De plus, il est crucial de reconnaÃ®tre les risques associÃ©s Ã  la suppression de donnÃ©es ayant de nombreuses dÃ©pendances dans une base de donnÃ©es. La suppression inconsidÃ©rÃ©e de telles donnÃ©es peut entraÃ®ner des incohÃ©rences dans la base de donnÃ©es, des erreurs d&amp;#8217;intÃ©gritÃ© rÃ©fÃ©rentielle et mÃªme des pertes de donnÃ©es importantes. Il est donc essentiel de procÃ©der avec prudence et de prendre en compte toutes les implications potentielles avant d&amp;#8217;utiliser cette extension.&lt;/p&gt;&#xA;&lt;p&gt;En rÃ©sumÃ©, bien que l&amp;#8217;extension pg_recursively_delete offre une fonctionnalitÃ© utile pour gÃ©rer les opÃ©rations de suppression rÃ©cursive dans PostgreSQL, il est essentiel pour les utilisateurs de comprendre ses limites en termes de performances et les risques potentiels associÃ©s Ã  la suppression de donnÃ©es avec de nombreuses dÃ©pendances. Une utilisation judicieuse et une Ã©valuation minutieuse des scÃ©narios d&amp;#8217;utilisation sont indispensables pour garantir l&amp;#8217;intÃ©gritÃ© et la performance de la base de donnÃ©es.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pg_dirtyread-ou-comment-reparer-facilement-un-delete-sauvage/&#34; rel=&#34;bookmark&#34; title=&#34;27 mars 2024&#34;&gt;pg_dirtyread oÃ¹ comment rÃ©parer facilement un delete sauvage&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des schÃ©mas de base de donnÃ©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-planifier-une-tache-avec-pg_cron/&#34; rel=&#34;bookmark&#34; title=&#34;24 septembre 2019&#34;&gt;PostgreSQL : planifier une tÃ¢che avec pg_cron&lt;/a&gt; (Emmanuel RAMI) [Non classÃ©PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-anonymizer/&#34; rel=&#34;bookmark&#34; title=&#34;7 juillet 2022&#34;&gt;PostgreSQL Anonymizer&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34; rel=&#34;bookmark&#34; title=&#34;19 dÃ©cembre 2024&#34;&gt;La montÃ©e de version en zero-downtime : merci la rÃ©plication !&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.784 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10505&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10505&amp;#038;title=pg_recursively_delete%20%3A%20Simplifier%20les%20suppressions%20r%C3%A9cursives&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_recursively_delete%20%3A%20Simplifier%20les%20suppressions%20r%C3%A9cursives&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10505&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/&#34;&gt;pg_recursively_delete : Simplifier les suppressions rÃ©cursives&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Si vous avez Ã©tÃ© amenÃ© au fil de votre carriÃ¨re Ã  manipuler de gros volumes de donnÃ©es contenus dans plusieurs tables possÃ©dant des rÃ©fÃ©rences croisÃ©es entre elles, dÃ©pendantes d&amp;#8217;autres tables, qui elles-mÃªmes dÃ©pendent d&amp;#8217;autres tables, vous savez Ã  quel point&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/&#34;&gt;pg_recursively_delete : Simplifier les suppressions rÃ©cursives&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #120</title>
    <updated>2025-02-21T15:20:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-02-21:/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.octo.com/7-things-a-developer-should-know-about-databases&#34;&gt;7 things a developer should know about databases&lt;/a&gt;Â : de prÃ©cieux conseils, Ã  lire attentivement et Ã  faire circuler auprÃ¨s de vos Ã©quipes !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.dalibo.com//2025/02/10/patchs_parallelisations_2.html&#34;&gt;La suite des patchs sur la parallÃ©lisation &lt;/a&gt;Â : Au-delÃ  du fond, qui est intÃ©ressant, câ€™est le point de vue sur le dÃ©veloppement de PostgreSQLÂ est mis en Ã©vidence, et cela permet de mieux comprendre cet aspect de la communautÃ© PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.loxodata.com/post/pgwatch3/&#34;&gt;pgwatch3&lt;/a&gt; : quelques explications sur la nouvelle version de l&#39;outil de supervision pgwatchÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.twilio.com/en-us/blog/sqlite-postgresql-complicated&#34;&gt;SQLite or PostgreSQL? It&#39;s Complicated!&lt;/a&gt; : comparatif de performances sur de vraies donnÃ©es !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/&#34;&gt;PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!&lt;/a&gt; et &lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-173-167-1511-1416-and-1319-released-3015/&#34;&gt;PostgreSQL 17.3, 16.7, 15.11, 14.16, and 13.19 Released!&lt;/a&gt; : mettez Ã  jour !&#xA;&lt;ul&gt;&#xA;&lt;li&gt;en franÃ§ais : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-4/&#34;&gt;PostgreSQL 17.4 et autres correctifs&lt;/a&gt; et  &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-3/&#34;&gt;PostgreSQL 17.3 et autres correctifs&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/end-of-the-road-for-postgresql-streaming-replication/&#34;&gt;End of the road for PostgreSQL streaming replication?&lt;/a&gt; : pourquoi il est difficile de parallÃ©liser le rejeu de la rÃ©plication dans une instance StandbyÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/enhanced-postgres-release-notes&#34;&gt;Enhanced Postgres Release Notes&lt;/a&gt; : trÃ¨s bonne idÃ©e, et gros travail : on trouve maintenant un lien vers le commit pour chacune des entrÃ©es des notes de publicationÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #119</title>
    <updated>2025-01-31T16:16:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-01-31:/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semaines :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2024/12/01/sql-best-practices-dont-compare-count-with-0/&#34;&gt;SQL best practices â€“ donâ€™t compare count(*) with 0&lt;/a&gt; : il n&#39;est pas utile de compter quelque chose alors qu&#39;on juste savoir s&#39;il existe ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://raymondtukpe.com/sql-nulls-are-weird.html&#34;&gt;SQL NULLs are Weird!&lt;/a&gt;Â : maÃ®triser cet aspect du SQL n&#39;est pas si Ã©vident, et pourtant fondamentalÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://notso.boringsql.com/posts/deletes-are-difficult/&#34;&gt;DELETEs are difficult&lt;/a&gt;: tout savoir sur l&#39;opÃ©ration DELETE ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.pgedge.com/blog/understanding-and-reducing-postgresql-replication-lag&#34;&gt;Understanding and Reducing PostgreSQL Replication Lag&lt;/a&gt; : le retard de rÃ©plication peut avoir de nombreux impacts, le mesurer et le maitriser est important ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://thebuild.com/blog/2025/01/28/vacuum-index_cleanup-off-considered-harmful/&#34;&gt;VACUUM (INDEX_CLEANUP OFF) Considered Harmful&lt;/a&gt; : attention aux options de commandes qui pourraient paraÃ®tre intÃ©ressantes au premier abordÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.binwang.me/2024-12-02-PostgreSQL-High-Availability-Solutions-Part-1.html&#34;&gt;Jepsen Test on Patroni: A PostgreSQL High Availability Solution&lt;/a&gt;Â : test trÃ¨s complet de PatroniÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rodoq.medium.com/are-all-your-update-useful-6b8d548085bf&#34;&gt;Are all your UPDATE useful ?&lt;/a&gt;Â : Vos UPDATE sont-ils toujours utiles ?&lt;/li&gt;&#xA;&lt;li&gt;Le projet PostgreSQL Ecosystem est maintenant public : &lt;a href=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34; title=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34;&gt;https://www.loxodata.com/post/pg-ec...&lt;/a&gt; et &lt;a href=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34; title=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34;&gt;https://pg-ecosystem.gitlab.io/pg-e...&lt;/a&gt;Â ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #118</title>
    <updated>2024-11-22T16:09:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-11-22:/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgversions.com/&#34; title=&#34;https://pgversions.com/&#34;&gt;https://pgversions.com/&lt;/a&gt;Â : outil permettant de connaitre les diffÃ©rences entre une version mineure et l&#39;Ã©tat actuel de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgpedia.info/blog/index.html&#34; title=&#34;https://pgpedia.info/blog/index.html&#34;&gt;https://pgpedia.info/blog/index.htm...&lt;/a&gt;Â : blog rÃ©sumant l&#39;activitÃ© de dÃ©veloppement de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rhaas.blogspot.com/2024/11/why-pgdump-is-amazing.html&#34;&gt;Why pg_dump Is Amazing&lt;/a&gt;Â : oui, pg_dump est un bon outil, trÃ¨s utile, qu&#39;il faut maitriserÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://databaserookies.wordpress.com/2024/11/02/plpgsql-how-conditional-expressions-are-evaluated/&#34;&gt;PL/pgSQL Secrets: How Conditional Expressions Are Parsed and Evaluated Under the Hood.&lt;/a&gt;Â : ou on comprend qu&#39;un IF est en fait un SELECTÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Publication de PostgreSQL 17.2Â : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34; title=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34;&gt;https://www.loxodata.com/post/postg...&lt;/a&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/a-change-to-relresultinfo-a-near-miss-with-postgres-17-1&#34;&gt;A change to ResultRelInfo - A Near Miss with Postgres 17.1&lt;/a&gt;Â : retour sur un petit couac&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://challahscript.com/what_i_wish_someone_told_me_about_postgres&#34;&gt;What I Wish Someone Told Me About Postgres&lt;/a&gt;Â : le plein de bonnes idÃ©es Ã  retenirÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://stormatics.tech/blogs/scenarios-that-trigger-autovacuum-in-postgresql&#34;&gt;Scenarios That Trigger Autovacuum in PostgreSQL&lt;/a&gt;Â : article assez complet sur le fonctionnement d&#39;autovacuum.&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #117</title>
    <updated>2024-10-31T16:00:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-10-31:/blog/index.php/post/2024/31/10/PostgreSQL-Hebdo-117</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/31/10/PostgreSQL-Hebdo-117" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rhaas.blogspot.com/2024/10/is-pgdump-backup-tool.html&#34;&gt;Is pg_dump a Backup Tool?&lt;/a&gt;Â : la sauvegarde, et la restauration des donnÃ©es, et en rÃ©alitÃ© un processus, et non pas juste un problÃ¨me d&#39;outil. pg_dump est un outil qui peut faire partie du processus de sauvegarde/restauration, et Ã§a peut-Ãªtre utile pour BACK UP, c&#39;est-Ã -dire revenir dans un Ã©tat normalÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-17-released-2936/&#34;&gt;PostgreSQL 17 Released!&lt;/a&gt; : Publication de PostgreSQL 17.0 ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/whats-so-great-about-postgresql-v17/&#34;&gt;What&#39;s so great about PostgreSQL v17?&lt;/a&gt;Â : aperÃ§u de quelques fonctionnalitÃ©s de PostgreSQL 17Â ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://dev.to/lifen/as-rails-developers-why-we-are-excited-about-postgresql-17-27nj&#34;&gt;As Rails developers, why we are excited about PostgreSQL 17 &lt;/a&gt;Â : PostgreSQL 17 du point de vue d&#39;un dÃ©veloppeur RailsÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://notso.boringsql.com/posts/custom-postgresql-extensions-with-rust/&#34;&gt;Custom PostgreSQL extensions with Rust&lt;/a&gt;Â : comment faire une extension PostgreSQL en RustÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://danolivo.substack.com/p/7456653e-9716-4e91-ad09-83737784c665&#34;&gt;PostgreSQL &#39;VALUES -&amp;gt; ANY&#39; transformation&lt;/a&gt;Â : Ã  propos de l&#39;adaptation du Planner aux requÃªtes des utilisateursÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://amitkapila16.blogspot.com/2024/09/online-upgrading-logical-and-physical.html?m=1&#34;&gt;Online Upgrading Logical and Physical Replication Nodes&lt;/a&gt;Â : Ã  propos de la rÃ©plication logique lors d&#39;une mise Ã  jour majeureÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2024/10/29/new-way-to-search-postgresql-documentation/&#34;&gt;New way to search PostgreSQL documentation&lt;/a&gt;Â : un prompt simple pour rechercher dans la documentation de PostgreSQL, Ã  mettre dans ses bookmarksÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #116</title>
    <updated>2024-09-09T14:06:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-09-09:/blog/index.php/post/2024/09/09/PostgreSQL-Hebdo-116</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/09/09/PostgreSQL-Hebdo-116" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://begriffs.com/posts/2018-03-20-user-defined-order.html&#34;&gt;User-defined Order in SQL&lt;/a&gt;Â : Ordonner les informations, c&#39;est souvent adopter un certain point de vue, et cette dÃ©marche fait partie de la modÃ©lisation des donnÃ©esÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://mccue.dev/pages/8-16-24-just-use-postgres&#34;&gt;Just use Postgres&lt;/a&gt;Â : passage en revue des alternatives Ã  PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/pulse/do-you-still-need-pgbadger-youre-using-grafana-alicja-kucharczyk-cgfmf&#34;&gt;Do you still need pgBadger if youâ€™re using Grafana?&lt;/a&gt;Â : Grafana ne remplace pas complÃ¨tement un rapport pgBadger, dans lequel on trouve de nombreuses informations utiles Ã  la comprÃ©hension du fonctionnement d&#39;une instance PostgreSQL ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/pulse/not-so-good-idea-pipe-syntax-sql-franck-pachot-dx6he/&#34;&gt;&lt;/a&gt;Â : De la faÃ§on dont le language SQL s&#39;Ã©crit, ou pourquoi on manipule des ensembles et non pas des fluxÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/cybertec-postgresql/pgwatch&#34; title=&#34;https://github.com/cybertec-postgresql/pgwatch&#34;&gt;https://github.com/cybertec-postgre...&lt;/a&gt; la prochaine version de PgWatch poursuit son dÃ©veloppement avec la version 3.0 beta4&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://dataegret.com/2024/08/handling_cancellation_request/&#34;&gt;Handling Cancellation Request&lt;/a&gt;Â : Comment annuler correctement une requÃªte, depuis l&#39;application client, vers un cluster PostgreSQL avec le gestionnaire de connexions PgBouncerÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.shayon.dev/post/2024/225/stop-relying-on-if-not-exists-for-concurrent-index-creation-in-postgresql/&#34;&gt;Stop Relying on IF NOT EXISTS for Concurrent Index Creation in PostgreSQL&lt;/a&gt;Â : Ã  propos d&#39;index invalide et de crÃ©ation conditionelleÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://anyblockers.com/posts/postgres-as-a-search-engine&#34;&gt;Postgres as a search engine&lt;/a&gt;Â : Peut-on utiliser PostgreSQL comme moteur de recherche ?&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://okbob.blogspot.com/2024/09/how-to-get-info-about-relations-between.html?m=1&#34;&gt;How to get info about relations between system tables?&lt;/a&gt;Â : Ã  propos des liens internes du catalogueÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-17-rc1-released-2926/&#34;&gt;PostgreSQL 17 RC1 Released!&lt;/a&gt;Â  (et en franÃ§ais : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-rc1/&#34; title=&#34;https://www.loxodata.com/post/postgresql-17-rc1/&#34;&gt;https://www.loxodata.com/post/postg...&lt;/a&gt;)Â : la date prÃ©vue pour PostgreSQL 17.0 est le 26 septembreÂ !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/patroni/patroni/blob/master/docs/releases.rst#version-401&#34;&gt;Patroni 4.0&lt;/a&gt;Â : nouvelle version de l&#39;outil de gestion de la haute disponibilitÃ©, avec quelques ruptures de compatibilitÃ©Â ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #115</title>
    <updated>2024-08-09T14:39:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-08-09:/blog/index.php/post/2024/08/09/PostgreSQL-Hebdo-115</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/08/09/PostgreSQL-Hebdo-115" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semaines :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://swizec.com/blog/why-sql-is-forever/&#34;&gt;Why SQL is Forever&lt;/a&gt;Â : billet sur la pertinence du SQL et des transactions face aux bases de donnÃ©es Â« NoSQL Â», et sur le point de vue de Stonebraker (le crÃ©ateur de PostgreSQL) Ã  ce sujetÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.ubicloud.com/blog/difference-between-running-postgres-for-yourself-and-for-others&#34;&gt;Difference between running Postgres for yourself and for others&lt;/a&gt;Â : comparaison des modes d&#39;hÃ©bergement d&#39;une instance PostgreSQL (du point de vue d&#39;un clouder)Â ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://proopensource.it/blog/postgresql-connection-poolers&#34;&gt;PostgreSQL Connection Poolers&lt;/a&gt;Â : court billet sur les gestionnaires de connexions Ã  PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://danolivo.substack.com/p/designing-a-prototype-postgres-plan&#34;&gt;Designing a Prototype: Postgres Plan Freezing&lt;/a&gt;Â : intÃ©ressante dÃ©marche Ã  propos de la mise en cache de plan d&#39;exÃ©cution de requÃªtesÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://drew.silcock.dev/blog/how-postgres-stores-data-on-disk/&#34;&gt;How Postgres stores data on disk â€“ this one&#39;s a page turner&lt;/a&gt;Â : article complet sur la technique de stockage des donnÃ©s de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-164-158-1413-1316-1220-and-17-beta-3-released-2910/&#34;&gt;PostgreSQL 16.4, 15.8, 14.13, 13.16, 12.20, and 17 Beta 3 Released!&lt;/a&gt; (en franÃ§aisÂ : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-16-4/&#34;&gt;PostgreSQL 16.4 et autres correctifs&lt;/a&gt;)Â : TroisiÃ¨me BÃªta pour PostgreSQL 17 ! Ã€ vos tests !&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;p&gt;Ã€Â venirÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le programme de PgConf Europe 2024, qui a lieu Ã  AthÃ¨nes, est publiÃ© : &lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/&#34; title=&#34;https://www.postgresql.eu/events/pgconfeu2024/schedule/&#34;&gt;https://www.postgresql.eu/events/pg...&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQLâ€¦ Pythonâ€¦ Ã§a fait PL/Python !</title>
    <updated>2025-02-15T19:00:00Z</updated>
    <id>tag:blog.arthurbazin.com,2025-02-15:/programmation/postgresql-python-ca-fait-pl-python</id>
    <content type="html">&#xA;&lt;p&gt;Imaginez, vous utilisez PostgreSQL au quotidien pour stocker et traiter vos donnÃ©es. Comme vous Ãªtes curieux, vous avez essayÃ© Python pour faire quelques traitements et vous vous Ãªtes rendus compte que c&amp;rsquo;Ã©tait pas mal quand mÃªme&amp;#8230; Malheureusement vos scripts sont complÃ¨tement dissociÃ©s de la base de donnÃ©es et vous vous dites qu&amp;rsquo;il serait pratique que ces scripts soient directement pilotÃ©s depuis PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Et bien vous pouvez mÃ©langer les deux technologies grÃ¢ce au PL/Python. Â«Â SorcellerieÂ Â» me direz-vous&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;blockquote class=&#34;wp-block-quote is-layout-flow wp-block-quote-is-layout-flow&#34;&gt;&#xA;&lt;p&gt;Si, si, c&amp;rsquo;est possible !&lt;/p&gt;&#xA;&lt;cite&gt;Hassan Cehef &amp;#8211; Les Nuls&lt;/cite&gt;&lt;/blockquote&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le PL/Python est un langage de PostgreSQL permettant d&amp;rsquo;Ã©crire des fonctions en langage Python directement au sein d&amp;rsquo;une base de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;il s&amp;rsquo;agit d&amp;rsquo;une langage dit Â«Â untrustedÂ Â» (Â«Â sans confianceÂ Â») car il permet de faire tout et n&amp;rsquo;importe quoi (comme modifier des fichiers sur le serveur par exemple). C&amp;rsquo;est pour cela que seul un superutilisateur peut crÃ©er des fonctions avec ce langage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Introduction&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cet article prÃ©suppose que vous avez dÃ©jÃ  utilisÃ© Python et PostgreSQL et que vous possÃ©dez une version de Python sur votre machine en parallÃ¨le d&amp;rsquo;une installation de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devez par ailleurs avoir des notions sur les variables d&amp;rsquo;environnement et le fonctionnement des services.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Installation du langage&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Linux, il faut installer le package en lien avec l&amp;rsquo;extension : &lt;code&gt;postgresql-plpythonY-Z&lt;/code&gt; (avec &lt;code&gt;Y&lt;/code&gt; = 3 pour Python 3.X et &lt;code&gt;Z&lt;/code&gt; = version de PostgreSQL). Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bash&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo apt install postgresql-plpython3-16&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, le PL/Python est prÃ©installÃ© avec PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de lancer la requÃªte suivante pour l&amp;rsquo;activer :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE EXTENSION plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant utiliser le PL/Python pour vos fonctions et procÃ©dures. Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DO &#xA;$function$&#xA;&#xA;&#x9;import sys&#xA;&#x9;plpy.notice(sys.version)&#xA;&#xA;$function$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce bloc de code anonyme (oui, il n&amp;rsquo;est pas encapsulÃ© dans une fonction ou un procÃ©dure) ne retourne rien mais un message contenant la version de Python utilisÃ© est renvoyÃ© dans la sortie console.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Fonctionnement&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si l&amp;rsquo;Ã©tape prÃ©cÃ©dente a fonctionnÃ© du premier coup, fÃ©licitation ! Sinon, cette partie devrait vous aider.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Version de Python&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, PostgreSQL est compatible avec une version spÃ©cifique de Python qui est dÃ©finie lors de sa compilation. Cette information est disponible dans les notes d&amp;rsquo;installations prÃ©sentes dans &lt;em&gt;C:\Emplacement\de\PostgreSQL\XX\doc\installation-notes.html&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un tableau rÃ©sumant la compatibilitÃ© avec l&amp;rsquo;installeur PostgreSQL fournit par EDB.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Version de PostgreSQL&lt;/th&gt;&lt;th&gt;Version de Python compatible&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 17&lt;/td&gt;&lt;td&gt;Python 3.13.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 16&lt;/td&gt;&lt;td&gt;Python 3.12.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 15&lt;/td&gt;&lt;td&gt;Python 3.11.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 14&lt;/td&gt;&lt;td&gt;Python 3.9.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 13&lt;/td&gt;&lt;td&gt;Python 3.8.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 12 et avant&lt;/td&gt;&lt;td&gt;Python 2.7&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Tableau issu du site : &lt;a href=&#34;https://postgresapp.com/documentation/plpython.html&#34; data-type=&#34;link&#34; data-id=&#34;https://postgresapp.com/documentation/plpython.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;postgresapp.com&lt;/a&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Linux, je n&amp;rsquo;ai pas explicitement trouvÃ© l&amp;rsquo;information mais il semble que le tableau prÃ©cÃ©dent soit valable (en tout cas d&amp;rsquo;aprÃ¨s mes quelques tests c&amp;rsquo;est le cas).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si vous n&amp;rsquo;utilisez pas la bonne version de Python, PostgreSQL vous renverra un message d&amp;rsquo;erreur de ce type lors de lâ€™exÃ©cution d&amp;rsquo;une procÃ©dure Python :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SQL Error [58P01]: ERREUR: n&#39;a pas pu charger la bibliothÃ¨que Â« C:/Program Files/PostgreSQL/16/lib/plpython3.dll Â» : The specified module could not be found.&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Choix de l&amp;rsquo;interprÃ©teur&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;exÃ©cution du code Python se fait au travers d&amp;rsquo;un interprÃ©teur. Pour cela, PostgreSQL utilise l&amp;rsquo;interprÃ©teur disponible Â«Â par dÃ©fautÂ Â» sur la machine et donc celui disponible Ã  travers la variable d&amp;rsquo;environnement &lt;code&gt;PATH&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;DÃ©finir un autre interprÃ©teur n&amp;rsquo;est pas simple&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur Linux, c&amp;rsquo;est l&amp;rsquo;installation d&amp;rsquo;une version de Python autre que celle fourni par dÃ©faut, qui est complexe ; il faut en gÃ©nÃ©ral compiler l&amp;rsquo;interprÃ©teur. En revanche il est relativement simple de redÃ©finir la variable &lt;code&gt;PATH&lt;/code&gt; directement dans la configuration du service (&lt;a href=&#34;https://serverfault.com/a/413408&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©crit ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, c&amp;rsquo;est l&amp;rsquo;inverse&amp;#8230; DiffÃ©rentes versions de Python peuvent Ãªtre installÃ©es trÃ¨s facilement mais la redÃ©finition de la variable &lt;code&gt;PATH&lt;/code&gt; pour un service spÃ©cifique est relativement complexe (mais &lt;a href=&#34;https://serverfault.com/a/1103091&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©crite ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En lien avec le sujet, voici &lt;a href=&#34;https://stackoverflow.com/questions/67852675/postgresql-13-python-3-7-9-plpython3u-psql-server-closed-the-connection-u&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;un thread stackoverflow&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation de modules et environnements&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous aurez trÃ¨s probablement besoin d&amp;rsquo;installer des modules. Il est peu recommandÃ© de le faire directement dans l&amp;rsquo;environnement Python de base et il vaut mieux utiliser des environnements spÃ©cifiques Ã  chaque projet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il en est de mÃªme pour PostgreSQL, vous pouvez crÃ©er et utiliser des environnements pour vos projets.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela il faut utiliser le module &lt;code&gt;virtualenv&lt;/code&gt; car l&amp;rsquo;activation d&amp;rsquo;un environnement peut Ãªtre fait directement depuis Python avec cet outil :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bash&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;pip install virtualenv&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devez ensuite crÃ©er votre environnement dans un dossier spÃ©cifique. Vous pouvez crÃ©er un rÃ©pertoire spÃ©cifique dans l&amp;rsquo;installation de PostgreSQL par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;virtualenv &#34;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ensuite accÃ©der Ã  cet environnement et y installer tous les modules souhaitÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement\Scripts\activate.bat&#34;&#xA;pip install geopandas&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme ce n&amp;rsquo;est pas vous mais le service qui contrÃ´le le dÃ©marrage de PostgreSQL, il ne vous ai pas possible de dÃ©marrer l&amp;rsquo;environnement avant PostgreSQL (encore que en modifiant le service mais ce n&amp;rsquo;est pas des plus simple). Nous allons donc crÃ©er une fonction en PL/Python permettant de dÃ©marrer l&amp;rsquo;environnement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE PROCEDURE py_activate_venv(venv text)&#xA;RETURNS boolean AS&#xA;$BODY$&#xA;&#x9;import os&#xA;&#x9;import sys&#xA;&#xA;&#x9;if sys.platform in (&#39;win32&#39;, &#39;win64&#39;, &#39;cygwin&#39;):&#xA;&#x9;&#x9;activate_this = os.path.join(venv, &#39;Scripts&#39;, &#39;activate_this.py&#39;)&#xA;&#x9;else:&#xA;&#x9;&#x9;activate_this = os.path.join(venv, &#39;bin&#39;, &#39;activate_this.py&#39;)&#xA;&#xA;&#x9;try:&#xA;&#x9;&#x9;exec(open(activate_this).read(), dict(__file__=activate_this))&#xA;&#x9;except FileNotFoundError:&#xA;&#x9;&#x9;plpy.error(&#39;Virtual environment {} does not exist.&#39;.format(name))&#xA;&#x9;&#xA;&#x9;return True&#xA;$BODY$&#xA;LANGUAGE plpython3u&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour activer l&amp;rsquo;environnement, il suffit de lancer la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT py_activate_venv(&#39;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour aller plus loin, vous pouvez utiliser ce superbe projet GitHub qui automatise toute la gestion des environnements sous Python :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-1 wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/dpage/plpy_venv&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;GitHub &amp;#8211; plpy_venv&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Module plpy&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le langage PL/Python apporte un module python automatiquement chargÃ© : &lt;code&gt;plpy&lt;/code&gt; qui apporte quelques fonctions utiles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fonctions&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour retourner des message, utilisez les fonctions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;plpy.debug(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.log(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.info(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.notice(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.warning(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.error(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.fatal(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les arguments suivants peuvent Ãªtre utilisÃ©s pour ajouter des informations de contexte au message renvoyÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;detail&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;hint&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;sqlstate&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;schema_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;table_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;column_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;datatype_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;constraint_name&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour exÃ©cuter une requÃªte SQL au sein de la base de donnÃ©es, utilisez &lt;code&gt;plpy.execute(&#34;query&#34; [, limit])&lt;/code&gt; avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;query&lt;/code&gt; : la requÃªte.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;limit&lt;/code&gt; : un entier permettant de limiter le nombre de rÃ©sultat.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;objet rÃ©sultant est une liste (les lignes) de dictionnaires (ensemble de colonnes). Par exemple pour renvoyer une colonne de la 4Ã¨me ligne :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;result = plpy.execute(&#34;SELECT * FROM ma_table&#34;, 25)&#xA;return result[4][&#34;ma_colonne&#34;]&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe trois fonctions Ã©quivalentes Ã  leurs homonyme au sein de PostgreSQL : &lt;code&gt;plpy.quote_literal(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt;, &lt;code&gt;plpy.quote_nullable(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt; et &lt;code&gt;plpy.quote_ident(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Gestion des erreurs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions &lt;code&gt;plpy.execute&lt;/code&gt; et &lt;code&gt;plpy.cursor&lt;/code&gt; (non dÃ©crite dans cet article), renvoient une exception dans le cas oÃ¹ la requÃªte SQL passÃ©e en argument Ã©choue. L&amp;rsquo;exception est une instance de la classe &lt;code&gt;plpy.SPIError&lt;/code&gt; qui peut Ãªtre rÃ©cupÃ©rÃ©e via la construction &lt;code&gt;try&lt;/code&gt;/&lt;code&gt;except&lt;/code&gt;. Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE FUNCTION test_plpython() &#xA;RETURNS text AS &#xA;$BODY$&#xA;&#xA;    try:&#xA;        plpy.execute(&#34;UPDATE ma_table SET &#34;ma_colonne&#34; = 12&#34;)&#xA;&#xA;    except plpy.SPIError:&#xA;        return &#34;La mise Ã  jour a Ã©chouÃ©e&#34;&#xA;&#xA;    else:&#xA;        return &#34;La mise Ã  jour a fonctionnÃ©e&#34;&#xA;&#xA;$BODY$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible de cibler une erreur spÃ©cifique retournÃ©e par PostgreSQL. Pour cela, vous pouvez vÃ©rifier la valeur de l&amp;rsquo;attribut &lt;code&gt;sqlstate&lt;/code&gt; de la classe &lt;code&gt;SPIError&lt;/code&gt; ou utiliser le module &lt;code&gt;plpy.spiexceptions&lt;/code&gt; qui dÃ©finit une classe d&amp;rsquo;exception pour chaque condition PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour spÃ©cifier une erreur avec &lt;code&gt;spiexception&lt;/code&gt;, il suffit de se rÃ©fÃ©rer Ã  &lt;a href=&#34;https://www.postgresql.org/docs/current/errcodes-appendix.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;la liste des erreurs de PostgreSQL&lt;/a&gt; et de convertir le nom de l&amp;rsquo;erreur comme suivant : retirer les soulignÃ©s (Â«Â _Â Â») + mettre en majuscule la premiÃ¨re lettre de chaque mot. Ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;privilege_not_granted&lt;/code&gt; devient &lt;code&gt;PrivilegeNotGranted&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;data_exception&lt;/code&gt; devient &lt;code&gt;DataException&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;division_by_zero&lt;/code&gt; devient &lt;code&gt;DivisionByZero&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour attraper une erreur spÃ©cifique il suffit d&amp;rsquo;utiliser la syntaxe suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE FUNCTION test_plpython() &#xA;RETURNS text AS &#xA;$BODY$&#xA;&#xA;    try:&#xA;        plpy.execute(&#34;UPDATE ma_table SET &#34;ma_colonne&#34; = 12&#34;)&#xA;&#xA;    except plpy.spiexceptions.UniqueViolation:&#xA;        return &#34;La mise Ã  jour a Ã©chouÃ©e en raison d&#39;une erreur d&#39;unicitÃ©&#34;&#xA;&#xA;    except plpy.SPIError as e:&#xA;        return &#34;Une erreur s&#39;est produite : SQLSTATE %s&#34; % e.sqlstate&#xA;&#xA;    else:&#xA;        return &#34;La mise Ã  jour a fonctionnÃ©e&#34;&#xA;&#xA;$BODY$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Gestion des transactions&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lâ€™exÃ©cution d&amp;rsquo;une fonction en PL/Python se fait toujours au sein d&amp;rsquo;une transaction. Ainsi, lorsqu&amp;rsquo;une requÃªte est exÃ©cutÃ©e via &lt;code&gt;plpy.execute&lt;/code&gt;, une sous-transaction est automatiquement dÃ©marrÃ©e. Il devient alors possible de contrÃ´ler l&amp;rsquo;issue de cette sous-transaction via les fonctions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;plpy.commit()&lt;/code&gt; : valider la sous-transaction&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.rollback()&lt;/code&gt; : annuler la sous-transaction&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;AprÃ¨s la fin d&amp;rsquo;une sous-transaction, une nouvelle sous-transaction est automatiquement dÃ©marrÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas oÃ¹ plusieurs requÃªtes doivent Ãªtre exÃ©cutÃ©es et que l&amp;rsquo;intÃ©gralitÃ© de ces requÃªtes doivent Ãªtre validÃ©es ou non, il est possible de dÃ©marrer une sous-transaction grÃ¢ce Ã   &lt;code&gt;plpy.subtransaction()&lt;/code&gt;. Pour cela, il faudra l&amp;rsquo;utiliser de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;with plpy.subtransaction():&#xA;  plpy.execute(&#34;DELETE FROM ma_table WHERE colonne = &#39;xxx&#39;&#34;)&#xA;  plpy.execute(&#34;INSERT INTO autre_table (col_1, col_2) VALUES (&#39;valeur1&#39;, &#39;valeur2&#39;)&#34;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;une erreur lors de l&amp;rsquo;une des requÃªte entraine donc l&amp;rsquo;annulation de l&amp;rsquo;ensemble des requÃªtes de la sous-transaction mais engendre Ã©galement une exception qui stoppera lâ€™exÃ©cution de la fonction et annulera la transaction en cours. Pour limiter la propagation de l&amp;rsquo;exception, il est possible d&amp;rsquo;encapsuler le tout au sein d&amp;rsquo;un &lt;code&gt;try&lt;/code&gt;/&lt;code&gt;catch&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;try:&#xA;  with plpy.subtransaction():&#xA;    plpy.execute(&#34;DELETE FROM ma_table WHERE colonne = &#39;xxx&#39;&#34;)&#xA;    plpy.execute(&#34;INSERT INTO autre_table (col_1, col_2) VALUES (&#39;valeur1&#39;, &#39;valeur2&#39;)&#34;)&#xA;except plpy.SPIError as e:&#xA;  result = &#34;Erreur de requÃªte : %s&#34; % e.args&#xA;else:&#xA;  result = &#34;OpÃ©ration effectuÃ©e&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour allez plus loin&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lq &lt;a href=&#34;https://www.postgresql.org/docs/current/plpython.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentation de PostgreSQL sur le langage PL/Python&lt;/a&gt; vous permettra d&amp;rsquo;approfondir le sujet maintenant que vous avez les Ã©lÃ©ments clÃ©s en main.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/programmation/postgresql-python-ca-fait-pl-python" rel="alternate"></link>
    <summary type="html">Imaginez, vous utilisez PostgreSQL au quotidien pour stocker et traiter vos donnÃ©es. Comme vous Ãªtes curieux, vous avez essayÃ© Python pour faire quelques traitements et vous vous Ãªtes rendus compte que c&amp;#8217;Ã©tait pas mal quand mÃªme&amp;#8230; Malheureusement vos scripts sont complÃ¨tement dissociÃ©s de la base de donnÃ©es et vous vous dites qu&amp;#8217;il serait pratique que [&amp;#8230;]</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Soyons prÃ©cis avec PostGIS</title>
    <updated>2025-02-09T20:26:53Z</updated>
    <id>tag:blog.arthurbazin.com,2025-02-09:/bdd/postgresql/soyons-precis-avec-postgis</id>
    <content type="html">&#xA;&lt;p&gt;Vous Ãªtes vous dÃ©jÃ  demandÃ© quelle Ã©tait la prÃ©cision de PostGIS ? Moi oui&amp;#8230; Alors Ã©tudions cela ensemble.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La documentation de PostGIS n&amp;rsquo;est pas trÃ¨s claire sur la question de la prÃ©cision mais il faut savoir que toutes les coordonnÃ©es sont stockÃ©es sous forme d&amp;rsquo;entiers Ã  virgule flottante en double prÃ©cision. La prÃ©cision de PostGIS est donc liÃ©e Ã  ce format de stockage des numÃ©riques.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Virgule flottante et double prÃ©cision&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce paragraphe est une simplification de la norme IEEE 754 pour vous aidez Ã  comprendre le fonctionnement des nombres Ã  virgules flottantes en double precision. Des imprÃ©cisions sont donc volontairement prÃ©sentes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La &lt;strong&gt;virgule flottante&lt;/strong&gt; est une mÃ©thode de reprÃ©sentation d&amp;rsquo;un nombre en informatique qui s&amp;rsquo;apparente Ã  la notation scientifique (par exemple &lt;code&gt;1,234 * 10&lt;sup&gt;123&lt;/sup&gt;&lt;/code&gt;). Elle repose ainsi sur les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;un signe : + ou -.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une mantisse : une valeur binaire qui dÃ©finie une fraction entre 0 et 1.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une base : un nombre entier (par exemple 2 ou 10).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un exposant : un nombre entier.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On obtient la valeur finale grÃ¢ce Ã  l&amp;rsquo;opÃ©ration suivante : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;signe * 1,mantisse * base&lt;sup&gt;exposant&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quand on parle de &lt;strong&gt;double prÃ©cision&lt;/strong&gt;, on fait alors rÃ©fÃ©rence Ã  un format particulier de nombre Ã  virgule flottante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;encodage se fait sur 64 bits :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1 bit pour le signe (&lt;code&gt;0&lt;/code&gt; = &lt;code&gt;+&lt;/code&gt; et &lt;code&gt;1&lt;/code&gt; = &lt;code&gt;-&lt;/code&gt;)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;11 bits pour l&amp;rsquo;exposant&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;53 bits pour la mantisse dont :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1 bit pour le dÃ©calage (voir le paragraphe sur la dÃ©normalisation)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;52 bits pour la valeur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La base est 2 car le stockage se fait sous forme binaire.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;exposant est dÃ©calÃ©, par convention on ajoute 1023 a sa valeur rÃ©elle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le calcul d&amp;rsquo;un nombre en double prÃ©cision est alors le suivant :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (1 + mantisse) * 2&lt;sup&gt;exposant-1023&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Dans le cas d&amp;rsquo;un nombre dÃ©normalisÃ© (voir le paragraphe dÃ©diÃ©), le calcul est le suivant :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (0 + mantisse) * 2&lt;sup&gt;1-1023&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * 0,mantisse * 2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Exposant&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;exposant est codÃ© sur 11 bits ce qui permet les valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;0&lt;/code&gt; : &lt;code&gt;00000000000&lt;/code&gt; : valeur minimum&lt;br&gt;Valeur spÃ©cifique rÃ©servÃ©e pour reprÃ©senter le 0 ou un nombre dÃ©normalisÃ© (voir plus bas).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;1&lt;/code&gt; : &lt;code&gt;00000000001&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2046&lt;/code&gt; : &lt;code&gt;11111111110&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2047&lt;/code&gt; : &lt;code&gt;11111111111&lt;/code&gt; : valeur maximum&lt;br&gt;Valeur spÃ©cifique rÃ©servÃ©e pour reprÃ©sentÃ© les valeurs &lt;code&gt;infini&lt;/code&gt; ou &lt;code&gt;NaN&lt;/code&gt; (Not A Number : pas un nombre)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette valeur d&amp;rsquo;exposant est non signÃ©e. Afin de permettre le stockage d&amp;rsquo;exposants nÃ©gatifs, un dÃ©calage est introduit. Dans le cas du double prÃ©cision, ce dÃ©calage est de &lt;code&gt;1023&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, avec un exposant dÃ©calÃ© de 1023, la plage d&amp;rsquo;exposants utilisables est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;De &lt;code&gt;0 - 1023&lt;/code&gt; = &lt;code&gt;-1022&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Ã€ &lt;code&gt;2046 - 1023&lt;/code&gt; = &lt;code&gt;1023&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Mantisse&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La mantisse est codÃ©e sur 52 bits et reprÃ©sente une fraction comprise entre 0 et 1 sous la forme d&amp;rsquo;un nombre binaire. La mantisse peut ainsi avoir 2&lt;sup&gt;52&lt;/sup&gt; (4 503 599 627 370 496 = 4,503599627370496 Ã— 10&lt;sup&gt;15&lt;/sup&gt;) valeurs diffÃ©rentes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le calcul de la valeur dÃ©cimale de la mantisse Ã  partir de la valeur binaire se fait comme suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Valeur binaire : &lt;code&gt;10100...00101&lt;/code&gt; (la partie tronquÃ©e n&amp;rsquo;est composÃ©e que de zÃ©ros).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur dÃ©cimale est Ã©gale Ã  la somme des puissances de deux multipliÃ©es par la valeur du bit correspondant :&lt;br&gt;&lt;code&gt;(&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-1&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-2&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-3&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-4&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-5&lt;/sup&gt;) + ... + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-48&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-49&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-50&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-51&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-52&lt;/sup&gt;)&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat pour notre exemple est ainsi &lt;code&gt;0,6250000000000011102230246251565404236316680908203125&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Combinaison exposant + mantisse&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une explication plus simple du fonctionnement de l&amp;rsquo;exposant combinÃ©e Ã  la mantisse est de parler de fenÃªtres et de paliers. Imaginez que l&amp;rsquo;amplitude maximum permise par le type double prÃ©cision soit dÃ©coupÃ©e en fenÃªtres elles mÃªmes sous dÃ©coupÃ©es en paliers avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;2045&lt;/code&gt; fenÃªtres : 2047 exposants disponibles moins les exposants 0 et 2047 qui sont rÃ©servÃ©s.&lt;br&gt;Une fenÃªtre est donc bornÃ©e entre deux puissances de 2 : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La premiÃ¨re fenÃªtre (exposant 1) dÃ©bute Ã  2&lt;sup&gt;-1022&lt;/sup&gt; (2&lt;sup&gt;1-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusquâ€™Ã  2&lt;sup&gt;-1021&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La derniÃ¨re fenÃªtre (exposant 2046) dÃ©bute Ã  2&lt;sup&gt;1023&lt;/sup&gt; (2&lt;sup&gt;2046-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusqu&amp;rsquo;Ã  2&lt;sup&gt;1024&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; paliers (&lt;code&gt;4 503 599 627 370 496&lt;/code&gt;) par fenÃªtre : le nombre de valeurs de mantisse disponibles.&lt;br&gt;Pour chaque fenÃªtre, un nombre de valeurs limitÃ© est ainsi disponible, la valeur d&amp;rsquo;incrÃ©mentation du palier (et donc la prÃ©cision) dÃ©pend de la fenÃªtre Ã  laquelle il se rattache.&lt;br&gt;Le calcul de la prÃ©cision est le suivant : &lt;code&gt;(Taille de la fenÃªtre)/(nombre de valeurs de la mantisse)&lt;/code&gt;&lt;br&gt;Par exemple &lt;code&gt;(2&lt;sup&gt;-1021&lt;/sup&gt; - 2&lt;sup&gt;-1022&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; pour la premiÃ¨re fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Calcul de la mantisse et de l&amp;rsquo;exposant depuis une valeur rÃ©elle&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible de calculer la mantisse et l&amp;rsquo;exposant d&amp;rsquo;une valeur rÃ©elle en suivant les Ã©tapes suivantes. la valeur d&amp;rsquo;exemple sera 1234,56789.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã‰tape 1 &amp;#8211; Convertir le nombre en binaire :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; Diviser la partie entiÃ¨re par 2 puis noter le reste (0 ou 1), rÃ©pÃ©ter l&amp;rsquo;opÃ©ration jusquâ€™Ã  ce que l&amp;rsquo;opÃ©ration soit Ã©gale Ã  0.&lt;br&gt;Le reste est notÃ© en commenÃ§ant par la droite.&lt;br&gt;Dans notre exemple, divisons successivement 1234 par 2â€¯en rÃ©cupÃ©rant le reste :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1234 Ã· 2 = 617â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;617 Ã· 2 = 308â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;308 Ã· 2 = 154â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;154 Ã· 2 = 77â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;77 Ã· 2 = 38â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;38 Ã· 2 = 19â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;19 Ã· 2 = 9â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;9 Ã· 2 = 4â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;4 Ã· 2 = 2â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2 Ã· 2 = 1â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1 Ã· 2 = 0â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Donc, &lt;code&gt;1234&lt;sub&gt;10&lt;/sub&gt; â€‹= 10011010010&lt;sub&gt;2&lt;/sub&gt;â€‹&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; Multiplier la partie dÃ©cimale par 2 puis noter la partie entiÃ¨re (0 ou 1), rÃ©pÃ©ter l&amp;rsquo;opÃ©ration un grand nombre de fois (voir l&amp;rsquo;Ã©tape 2 pour dÃ©terminer ce nombre).&lt;br&gt;La partie entiÃ¨re est notÃ©e en commenÃ§ant par la gauche.&lt;br&gt;Dans notre exemple, multiplions successivement 0,56789 par 2, en prenant la partie entiÃ¨re de chaque produitâ€¯:&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt; 0,56789 Ã— 2 = 1,13578 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,13578 Ã— 2 = 0,27156 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,27156 Ã— 2 = 0,54312 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,54312 Ã— 2 = 1,08624 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,08624 Ã— 2 = 0,17248 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,17248 Ã— 2 = 0,34496 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,34496 Ã— 2 = 0,68992 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,68992 Ã— 2 = 1,37984 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&amp;#8230; on rÃ©pÃ¨te l&amp;rsquo;opÃ©ration un nombre important de fois&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En continuant, &lt;code&gt;0,56789&lt;sub&gt;10&lt;/sub&gt;â€‹ = 100100010110000100111101001100011011100111...&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt; (il s&amp;rsquo;agit d&amp;rsquo;une approximation)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur totale approximÃ©e est ainsi : &lt;code&gt;10011010010,100100010110000100111101001100011011100111&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã‰tape 2 &amp;#8211; Normaliser le nombre&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Normaliser le nombre sous la forme &lt;code&gt;1,xyz x 2&lt;sup&gt;abc&lt;/sup&gt;&lt;/code&gt;&lt;br&gt;Si le nombre dÃ©bute par &lt;code&gt;0,x&lt;/code&gt;, il faudra alors utiliser une puissance nÃ©gative.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur normalisÃ©e doit avoir 52 dÃ©cimales car la mantisse possÃ¨de 52 bits. Il vous faudra ajuster le nombre de calculs nÃ©cessaires Ã  l&amp;rsquo;Ã©tape 2. S&amp;rsquo;il ne vous est pas possible d&amp;rsquo;effectuer autant de calculs, complÃ©tez la mantisse par la valeur 0 (des bits nuls).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour notre exemple :&lt;br&gt;&lt;code&gt;10011010010,100100010110000100111101001100011011100111&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt; = &lt;code&gt;1,0011010010100100010110000100111101001100011011100111 x 2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas du nombre &lt;code&gt;0,0003&lt;/code&gt;, la valeur binaire est &lt;code&gt;0,000000000000001010001101101110001011101011000111000100001100101101&lt;/code&gt;. &lt;br&gt;La valeur normalisÃ©e est donc &lt;code&gt;1,010001101101110001011101011000111000100001100101101 x 2&lt;sup&gt;-14&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si votre valeur normalisÃ©e n&amp;rsquo;a pas 52 dÃ©cimales, complÃ©tez avec des 0 : &lt;code&gt;1,010011&lt;em&gt;0000000000000000000000000000000000000000000000&lt;/em&gt; x 2&lt;sup&gt;y&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã‰tape 3 &amp;#8211; Extraire les informations&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les informations sont disponibles presque immÃ©diatement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;exposant vous est donnÃ© par l&amp;rsquo;exposant de la valeur normalisÃ©e. &lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La mantisse est constituÃ©e de l&amp;rsquo;ensemble des valeurs suivant le Â«Â 1.Â Â».&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans notre exemple : &lt;code&gt;1,0011010010100100010110000100111101001100011011100111 x 2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;exposant est &lt;code&gt;10&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;exposant dÃ©calÃ© est &lt;code&gt;1033&lt;/code&gt; (&lt;code&gt;10 + 1023&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La fenÃªtre d&amp;rsquo;exposant est &lt;code&gt;2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt; Ã  &lt;code&gt;2&lt;sup&gt;11&lt;/sup&gt;&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La valeur d&amp;rsquo;incrÃ©mentation et donc la prÃ©cision est &lt;code&gt;(2&lt;sup&gt;11&lt;/sup&gt; - 2&lt;sup&gt;10&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;2,27373675443232059478759765625 Ã— 10&lt;sup&gt;-13&lt;/sup&gt;&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La mantisse est : &lt;code&gt;0011010010100100010110000100111101001100011011100111&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La valeur approchÃ©e stockÃ©e est &lt;code&gt;1234,567890000000033978722058236598968505859375&lt;/code&gt; (calcul fait sur &lt;a href=&#34;https://www.wolframalpha.com/input?i=1.0011010010100100010110000100111101001100011011100111+base+2+x+2%5E10&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfram Alpha&lt;/a&gt;).&lt;br&gt;La valeur n&amp;rsquo;est prÃ©cise qu&amp;rsquo;a &lt;code&gt;2,27 x 10&lt;sup&gt;-13&lt;/sup&gt;&lt;/code&gt; donc peut Ãªtre arrondie Ã  &lt;code&gt;1234,5678900000000&lt;/code&gt; soit &lt;code&gt;1234,56789&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Valeurs spÃ©cifiques&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La combinaison de valeurs spÃ©cifiques de la mantisse et de l&amp;rsquo;exposant permet de reprÃ©senter certaines valeurs :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 0&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse = 0&lt;/code&gt; : la valeur est &lt;code&gt;0&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 0&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse != 0&lt;/code&gt; : la valeur est dÃ©normalisÃ©&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 2047&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse = 0&lt;/code&gt; : la valeur est &lt;code&gt;infini&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 2047&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse != 0&lt;/code&gt; : &lt;code&gt;NaN&lt;/code&gt;, la valeur n&amp;rsquo;est pas un nombre&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;DÃ©normalisation&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La dÃ©normalisation permet de stocker des nombres plus petits que &lt;code&gt;2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt; (exposant le plus petit disponible). Pour cela, la mÃ©thode permettant de calculer la valeur finale change comme exposÃ© plus haut :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un nombre normalisÃ© se calcule de la faÃ§on suivante :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (1 + mantisse) * 2&lt;sup&gt;exposant-1023&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Alors qu&amp;rsquo;un nombre dÃ©normalisÃ© se calcule comme suivant : &lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (0 + mantisse) * 2&lt;sup&gt;1-1023&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * 0,mantisse * 2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sans entrer dans les dÃ©tails, le principe est de dire que dans ce mode de calcul, la valeur la plus haute de la mantisse (&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt;) est alors Ã©gale Ã  la valeur immÃ©diatement avant la plus petite valeur en mode normalisÃ©. Il devient ainsi possible d&amp;rsquo;augmenter l&amp;rsquo;amplitude.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D&amp;rsquo;un point de vue technique, le bit de dÃ©calage de la mantisse est alors dÃ©fini Ã  0 et les programmes traitent la valeur de la mantisse comme dÃ©normalisÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Amplitude de valeurs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La combinaison de la mantisse et de l&amp;rsquo;exposant permet ainsi de calculer un ensemble de nombres avec une certaine prÃ©cision. Cependant il n&amp;rsquo;est pas possible de reprÃ©senter la totalitÃ© des nombres rÃ©els.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une explication plus simple du fonctionnement est de parler de fenÃªtres et de paliers. La plage de valeurs utilisables est dÃ©coupÃ©e en fenÃªtres elles mÃªmes sous dÃ©coupÃ©es en paliers avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;2045&lt;/code&gt; fenÃªtres : 2047 exposants disponibles moins les exposants 0 et 2047 rÃ©servÃ©s.&lt;br&gt;Une fenÃªtre est donc bornÃ©e entre deux puissances de 2 :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La premiÃ¨re fenÃªtre (exposant 1) dÃ©bute Ã  2&lt;sup&gt;-1022&lt;/sup&gt; (2&lt;sup&gt;1-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusquâ€™Ã  2&lt;sup&gt;-1021&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La derniÃ¨re fenÃªtre (exposant 2046) dÃ©bute Ã  2&lt;sup&gt;1023&lt;/sup&gt; (2&lt;sup&gt;2046-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusqu&amp;rsquo;Ã  2&lt;sup&gt;1024&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; paliers (&lt;code&gt;4 503 599 627 370 496&lt;/code&gt;) par fenÃªtre : le nombre de valeurs de mantisses disponibles.&lt;br&gt;Pour chaque fenÃªtre, un nombre de valeurs limitÃ© est ainsi disponible, la valeur d&amp;rsquo;incrÃ©mentation du palier (et donc la prÃ©cision) dÃ©pend de la fenÃªtre auquel le palier se rattache.&lt;br&gt;Le calcul de la prÃ©cision est le suivant : &lt;code&gt;(Taille de la fenÃªtre)/(nombre de valeurs de la mantisse)&lt;/code&gt;&lt;br&gt;Par exemple &lt;code&gt;(2&lt;sup&gt;-1021&lt;/sup&gt; - 2&lt;sup&gt;-1022&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; pour la premiÃ¨re fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Partant de ce constat, voici un tableau de plusieurs valeurs intÃ©ressantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;FenÃªtre d&amp;rsquo;exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur d&amp;rsquo;incrÃ©mentation d&amp;rsquo;un palier&lt;br&gt;= &lt;strong&gt;PrÃ©cision&lt;/strong&gt;&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Mantisse&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur approchÃ©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;-1022&lt;/sup&gt; Ã  2&lt;sup&gt;-1021&lt;/sup&gt; : &lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 x 10&lt;sup&gt;âˆ’324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072013 x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus petit nombre normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;-1022&lt;/sup&gt; Ã  2&lt;sup&gt;-1021&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 x 10&lt;sup&gt;âˆ’324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072018 x 10&lt;sup&gt;âˆ’308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre immÃ©diatement aprÃ¨s le prÃ©cÃ©dent&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; Ã  2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 Ã— 10&lt;sup&gt;âˆ’16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,0&lt;/td&gt;&lt;td&gt;Valeur 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; Ã  2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 Ã— 10&lt;sup&gt;âˆ’16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,0000000000000002220446&lt;/td&gt;&lt;td&gt;Nombre immÃ©diatement aprÃ¨s le prÃ©cÃ©dent&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; Ã  2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 Ã— 10&lt;sup&gt;âˆ’16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;450 359 962 737 050&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,10000000000000008881784197001&lt;/td&gt;&lt;td&gt;Plus proche palier de 1.1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1074&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;51&lt;/sup&gt; Ã  2&lt;sup&gt;52&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0,5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1075&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;52&lt;/sup&gt; Ã  2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4 503 599 627 370 496&lt;/td&gt;&lt;td&gt;Le nombre suivant sera l&amp;rsquo;entier suivant&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1076&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;53&lt;/sup&gt; Ã  2&lt;sup&gt;54&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2046&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;1023&lt;/sup&gt; Ã  2&lt;sup&gt;1024&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,99584030953 Ã— 10&lt;sup&gt;292&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,79769313486231550856 x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre immÃ©diatement avant le plus grand nombre normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2046&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;1023&lt;/sup&gt; Ã  2&lt;sup&gt;1024&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,99584030953 Ã— 10&lt;sup&gt;292&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1 + (1 âˆ’ 2&lt;sup&gt;âˆ’52&lt;/sup&gt;))&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,79769313486231570814 x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus grand nombre normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce tableau nous permet de voir plusieurs Ã©lÃ©ments :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;tous les nombres ne peuvent Ãªtre reprÃ©sentÃ©s exactement, c&amp;rsquo;est le cas de 1,1 qui est approximÃ© Ã  1,100 000 000 000 000 088 817 841 970 01. &lt;br&gt;Si un calcul est rÃ©alisÃ© et qu&amp;rsquo;une valeur intermÃ©diaire est trouvÃ©e, alors la valeur sera arrondie au palier le plus proche (voir la partie sur la prÃ©cision).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le passage d&amp;rsquo;une valeur Ã  celle immÃ©diatement aprÃ¨s n&amp;rsquo;est pas rÃ©gulier et dÃ©pend de l&amp;rsquo;ordre de grandeur d&amp;rsquo;un nombre.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le point prÃ©cÃ©dent implique que la prÃ©cision d&amp;rsquo;un nombre dÃ©pend de son ordre de grandeur et peut aller de plusieurs centaines de chiffres aprÃ¨s la virgule Ã  plusieurs centaines de milliers en passant par un.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les valeurs Ã©tant extrÃªmes, vous pouvez effectuer le calcul sur le site &lt;a href=&#34;https://www.wolframalpha.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfram Alpha&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un tableau de quelques nombres dÃ©normalisÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Mantisse&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur d&amp;rsquo;incrÃ©mentation d&amp;rsquo;un palier&lt;br&gt;= &lt;strong&gt;PrÃ©cision&lt;/strong&gt;&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur approchÃ©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus petit nombre dÃ©normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9,881 x 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre dÃ©normalisÃ© suivant&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072008 x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus grand nombre dÃ©normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce tableau nous permet de voir que :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;la valeur d&amp;rsquo;incrÃ©mentation des nombres dÃ©normalisÃ©s est la mÃªme que le premier palier des nombres normalisÃ© car le calcul se base sur le mÃªme exposant (la mÃªme fenÃªtre) : &lt;code&gt;-1022&lt;/code&gt; et la mantisse possÃ¨de toujours le mÃªme nombre de valeurs (mÃªme nombre de paliers)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le plus grand nombre dÃ©normalisÃ© est immÃ©diatement avant la plus petite valeur normalisÃ©e ce qui permet une continuitÃ© des valeurs.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici enfin un dernier tableau prÃ©sentant certains nombres spÃ©cifiques :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th&gt;Mantisse&lt;/th&gt;&lt;th&gt;Valeur approchÃ©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;0,0&lt;/td&gt;&lt;td&gt;ZÃ©ro&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;Infini&lt;/td&gt;&lt;td&gt;Infini&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;&lt;em&gt;NaN&lt;/em&gt;&lt;/td&gt;&lt;td&gt;PremiÃ¨re valeur de NaN&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;&lt;em&gt;NaN&lt;/em&gt;&lt;/td&gt;&lt;td&gt;DerniÃ¨re valeur de NaN&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision et chiffres significatifs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La prÃ©cision reprÃ©sente la plus petite diffÃ©rence pouvant Ãªtre calculÃ©e entre deux valeurs consÃ©cutives. Cette prÃ©cision varie selon l&amp;rsquo;ordre de grandeur de la valeur d&amp;rsquo;oÃ¹ le terme de Â«Â nombre Ã  virgule flottanteÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Chaque valeur Ã©tant liÃ©e Ã  une plage d&amp;rsquo;exposant (une fenÃªtre) et chaque plage d&amp;rsquo;exposant pouvant Ãªtre dÃ©coupÃ©e par 2&lt;sup&gt;52&lt;/sup&gt; valeurs de mantisse (les paliers), la prÃ©cision de chaque plage peut Ãªtre estimÃ©e par l&amp;rsquo;approximation suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;prÃ©cision&lt;/code&gt; &lt;strong&gt;â‰ƒ&lt;/strong&gt; &lt;code&gt;(valeur / 2&lt;sup&gt;52&lt;/sup&gt;)&lt;/code&gt; &lt;strong&gt;â‰ƒ&lt;/strong&gt; &lt;code&gt;(valeur / (4,5 x 10&lt;sup&gt;15&lt;/sup&gt;))&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques ordres de grandeur de prÃ©cision :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Plus petit nombre normalisÃ© : 2,225 x 10&lt;sup&gt;-308&lt;/sup&gt; : &lt;code&gt;10&lt;sup&gt;-324&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 : &lt;code&gt;10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 x 10&lt;sup&gt;16&lt;/sup&gt; : &lt;code&gt;1&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Plus grand nombre normalisÃ© : 1,798 x 10&lt;sup&gt;308&lt;/sup&gt; : &lt;code&gt;10&lt;sup&gt;292&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le terme de Â«Â nombre de chiffres significatifsÂ Â» est Ã©galement utilisÃ© et reprÃ©sente le nombre de chiffre maximum qu&amp;rsquo;il faut pour percevoir une diffÃ©rence entre deux nombres en notation scientifique. Le nombre de chiffres significatifs est ici entre 15 et 16 car il faut au maximum 16 chiffres pour percevoir une diffÃ©rence entre deux nombres :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Plus petit nombre normalisÃ© : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;2,225 073 858 507 201 &lt;strong&gt;3&lt;/strong&gt; x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2,225 073 858 507 201 &lt;strong&gt;8&lt;/strong&gt; x 10&lt;sup&gt;âˆ’308&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1,000 000 000 000 000 &lt;strong&gt;0&lt;/strong&gt; x 10&lt;sup&gt;0&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1,000 000 000 000 000 &lt;strong&gt;2&lt;/strong&gt; x 10&lt;sup&gt;0&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur dont l&amp;rsquo;incrÃ©mentation est de 1 Ã  chaque palier :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;4,503 599 627 370 49&lt;strong&gt;6&lt;/strong&gt; x 10&lt;sup&gt;15&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;4,503 599 627 370 49&lt;strong&gt;7&lt;/strong&gt; x 10&lt;sup&gt;16&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Plus grand nombre normalisÃ© : 1,798 x 10&lt;sup&gt;308&lt;/sup&gt; :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1,797 693 134 862 315 &lt;strong&gt;5&lt;/strong&gt; x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1,797 693 134 862 315 &lt;strong&gt;7&lt;/strong&gt; x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas de PostgreSQL (et d&amp;rsquo;autres programmes) la valeur exacte stockÃ©e est arrondie selon la prÃ©cision permise pour celle-ci (grÃ¢ce Ã  &lt;a href=&#34;https://github.com/postgres/postgres/blob/master/src/common/d2s.c#L346&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;cette fonction dans le code source&lt;/a&gt;). &lt;br&gt;Ainsi, pour la valeur &lt;code&gt;1,1&lt;/code&gt;, le stockage en double prÃ©cision donne la valeur exacte &lt;code&gt;1,10000000000000008881784197001&lt;/code&gt; ce qui est prÃ©cis Ã  10&lt;sup&gt;-29&lt;/sup&gt;. Comme la prÃ©cision permise pour l&amp;rsquo;ordre de grandeur de la valeur est de &lt;code&gt;2,22 x 10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt; prÃ¨s, la valeur renvoyÃ©e est arrondie selon cette prÃ©cision donc &lt;code&gt;1,1000000000000000&lt;/code&gt; soit &lt;code&gt;1,1&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques ressources pour aller plus loin :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Des calculateurs de valeur en double prÃ©cision :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.omnicalculator.com/other/floating-point&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.omnicalculator.com/other/floating-point&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.binaryconvert.com/result_double.html?hexadecimal=0000000000000000&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.binaryconvert.com/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un outil de calcul surpuissant pour rapidement convertir des donnÃ©es : &lt;a href=&#34;https://www.wolframalpha.com/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfra Alpha&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;article WikipÃ©dia sur les nombre Ã  virgule flottante : &lt;a href=&#34;https://fr.wikipedia.org/wiki/Virgule_flottante&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://fr.wikipedia.org/wiki/Virgule_flottante&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un article intÃ©ressant sur les nombres Ã  virgule flottante : &lt;a href=&#34;https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;What Every Computer Scientist Should Know About Floating-Point Arithmetic&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La documentation de PostgreSQL sur les nombres Ã  virgule flottante : &lt;a href=&#34;https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-FLOAT&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-FLOAT&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision sous PostGIS&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision globale&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les coordonnÃ©es sous PostGIS sont stockÃ©es en utilisant le type double prÃ©cision de PostgreSQL. La prÃ©cision des valeurs dÃ©pend donc de l&amp;rsquo;ordre de grandeur et varie selon :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;le systÃ¨me de projection.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;la valeur de la coordonnÃ©e (et donc la position).&lt;br&gt;En rÃ¨gle gÃ©nÃ©rale, il est possible d&amp;rsquo;appliquer la formule suivante pour avoir une idÃ©e de la prÃ©cision possible : &lt;code&gt;10&lt;sup&gt;-16&lt;/sup&gt; x la valeur&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques Ã©lÃ©ments de prÃ©cision en lien avec diffÃ©rents systÃ¨mes de coordonnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;WGS84 (EPSG:4326) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;CoordonnÃ©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -180 Ã  180&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-14&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;CoordonnÃ©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de -90 Ã  90&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-14&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;WGS 84 / Pseudo-Mercator (EPSG:3857) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;CoordonnÃ©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -20037508,34 Ã  20037508,34&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-9&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;CoordonnÃ©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de -20048966,1 Ã  20048966,1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-9&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Lambert 93 (EPSG:2154) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;CoordonnÃ©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -378305,81 Ã  1320649,57 (entre environ 100 000 et 1 100 000 pour la France mÃ©tropolitaine)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-10&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt; mais qui ne sont presque jamais utilisÃ©es).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;CoordonnÃ©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de 6005281,2 Ã  7235612,72  (entre environ 6 033 000 et 7 130 000 pour la France mÃ©tropolitaine)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : 10&lt;sup&gt;-10&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le Lambert 93, la prÃ©cision est entre 10&lt;sup&gt;-10&lt;/sup&gt; soit 0,1 nanomÃ¨tres (1 Ã¥ngstrÃ¶m, la taille d&amp;rsquo;une molÃ©cule) et 10&lt;sup&gt;-16&lt;/sup&gt; soit 0,1 femtomÃ¨tre (la taille d&amp;rsquo;un nuclÃ©on : proton ou neutron) ce qui suffit largement Ã  positionner n&amp;rsquo;importe quoi&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour mieux visualiser la prÃ©cision, il est possible de tester quelques requÃªtes dans PostGIS. Dirigeons nous vers Chamonix en Haute Savoie oÃ¹ se trouve un point possÃ©dant les coordonnÃ©es suivantes en Lambert 93 : X = 1000000 et Y = 6543210. Il s&amp;rsquo;agit de la terrasse d&amp;rsquo;un hÃ´tel.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_text,&#xA;&#x9;ST_AsText(geom_text::geometry(point, 2154)) AS geom&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000.0000000001 6543210.000000001)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000.00000000001 6543210.0000000001)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000.00000000008 6543210.0000000008)&#39;)&#xA;) AS t (id, geom_text)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;POINT (1000000 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;POINT (1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000008 6543210.0000000008)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce que l&amp;rsquo;on observe c&amp;rsquo;est que lorsqu&amp;rsquo;une coordonnÃ©e dont la prÃ©cision est supÃ©rieure Ã  ce qui est permis par le type double prÃ©cision, alors celle-ci est automatiquement arrondie :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Dans le cas de la ligne 2, la valeur des coordonnÃ©es est permise par le type double prÃ©cision, les coordonnÃ©es sont conservÃ©es telles quelles avec une prÃ©cision Â«Â Ã  la molÃ©cule prÃ¨sÂ Â».&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Dans le cas de la ligne 3, les coordonnÃ©es X et Y possÃ¨dent une valeur dont l&amp;rsquo;ordre de grandeur est 10&lt;sup&gt;6&lt;/sup&gt;. La prÃ©cision maximum est donc de 10&lt;sup&gt;-10&lt;/sup&gt; (&lt;code&gt;10&lt;sup&gt;6&lt;/sup&gt; x 10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt;). Les valeurs sont donc arrondies Ã  10&lt;sup&gt;-10&lt;/sup&gt;. Notez que pour la valeur de Y, la valeur de la partie entiÃ¨re impose un arrondi Ã  10&lt;sup&gt;-9&lt;/sup&gt; plutÃ´t que 10&lt;sup&gt;-10&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pour la ligne 4, le principe est le mÃªme mais l&amp;rsquo;arrondi se faisant au plus proche, nous rÃ©cupÃ©rons la valeur au dessus.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que la transformation des coordonnÃ©es dans le systÃ¨me WGS 84 (EPSG:4326) permet d&amp;rsquo;utiliser plus de dÃ©cimales car les valeurs possÃ¨dent un ordre de grandeur plus faible :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;ST_AsText(&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#39;POINT (1000000 6543210)&#39;::geometry(point, 2154), &#xA;&#x9;&#x9;&#x9;4326&#xA;&#x9;&#x9;)&#xA;&#x9;) AS geom&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat est &lt;code&gt;POINT(6.87241320435217 45.92236395248839)&lt;/code&gt; : la prÃ©cision est de 10&lt;sup&gt;-14&lt;/sup&gt; pour les coordonnÃ©es X et Y. Ici aussi vous pouvez voir que selon la valeur de la partie entiÃ¨re, la prÃ©cision autorisÃ©e oscille entre 10&lt;sup&gt;-16&lt;/sup&gt; et 10&lt;sup&gt;-15&lt;/sup&gt; multipliÃ©e par l&amp;rsquo;ordre de grandeur.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision lors des calculs&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les calculs sous PostGIS sont rÃ©alisÃ©s en double prÃ©cision et donc avec la prÃ©cision dÃ©taillÃ©e prÃ©cÃ©demment. Par exemple, une distance entre deux objets aura une prÃ©cision qui dÃ©pendra de l&amp;rsquo;ordre de grandeur de la valeur elle-mÃªme.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;il s&amp;rsquo;agit de comparer des gÃ©omÃ©tries, le cas est plus complexe. Nous allons Ã©tudier la fonction &lt;code&gt;ST_Intersects&lt;/code&gt; mais le principe est le mÃªme pour les autres fonctions de relation spatiale.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Relation sommet Ã  sommet : il s&amp;rsquo;agit simplement de comparer les coordonnÃ©es entres-elles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_text,&#xA;&#x9;ST_AsText(geom_text::geometry(point, 2154)) AS geom,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_text::geometry(point, 2154),&#xA;&#x9;&#x9;&#39;POINT(1000000 6543210)&#39;::geometry(geometry, 2154)&#xA;&#x9;) AS st_intersects&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000.0000000001 6543210)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000.00000000001 6543210)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000.00000000008 6543210)&#39;),&#xA;&#x9;(5, &#39;POINT (999999.99999999990 6543210)&#39;),&#xA;&#x9;(6, &#39;POINT (999999.99999999997 6543210)&#39;)&#xA;) AS t (id, geom_text)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;POINT (1000000 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;POINT (1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000008 6543210.0000000008)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td&gt;POINT (999999.99999999990 6543210)&lt;/td&gt;&lt;td&gt;POINT(999999.9999999999 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td&gt;POINT (999999.99999999997 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, la requÃªte prÃ©cÃ©dente permet de visualiser que la correspondance doit Ãªtre exacte. Lorsqu&amp;rsquo;une coordonnÃ©es est Â«Â trop prÃ©ciseÂ Â», elle est simplement arrondie afin de pouvoir Ãªtre traitÃ©e puis comparÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que dans le cas du type &lt;code&gt;geography&lt;/code&gt;, deux gÃ©omÃ©tries s&amp;rsquo;intersectent si elles sont distantes de moins de 0,00001 mÃ¨tre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Relation sommet Ã  segment : ce cas est plus complexe car il faut calculer la distance entre un sommet rÃ©el et un point virtuel situÃ© sur le segment. Pour faire cela, plusieurs calculs sont rÃ©alisÃ©s, tous en double prÃ©cision. Ainsi, la distance doit Ãªtre infÃ©rieur Ã  la prÃ©cision permise par les coordonnÃ©es des objets comparÃ©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ces opÃ©rations peuvent d&amp;rsquo;ailleurs entrainer des erreurs en raison de la nature imprÃ©cise des nombre en double prÃ©cision. Il est donc possible d&amp;rsquo;avoir de faux nÃ©gatifs : deux objets considÃ©rÃ©s comme ne s&amp;rsquo;intersectant pas alors qu&amp;rsquo;ils le sont ou inversement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requÃªte qui compare un point avec des lignes trÃ¨s proches de celui-ci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_line AS geom_text,&#xA;&#x9;ST_AsText(geom_line::geometry(linestring, 2154)),&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_distance,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.0000000001)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.000000001)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.00000001)&#39;)&#xA;) AS t (id, geom_pt, geom_line)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les objets sont alignÃ©s selon un axe globalement Est-Ouest. La variation de la coordonnÃ©e Y du sommet le plus Ã  l&amp;rsquo;Est de la ligne permet de dÃ©caler lÃ©gÃ¨rement celle-ci par rapport au point testÃ© pour vÃ©rifier l&amp;rsquo;intersection des deux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat est le suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.00000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210.00000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0000000055879354&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne 1 est une intersection parfaite. Vous pouvez observer que les gÃ©omÃ©tries trop prÃ©cises dans le cas de la ligne 2 sont ici aussi arrondies. En revanche, la ligne 3 met en valeur le fait que les arrondis de calcul entrainent une distance nulle alors que les objets ne s&amp;rsquo;intersectent pas ; en rÃ©alitÃ©, la distance est infinitÃ©simale et est donc arrondie Ã  0. La ligne 4 montre un Ã©cart trÃ¨s petit.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dernier exemple intÃ©ressant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_line AS geom_text,&#xA;&#x9;ST_AsText(geom_line::geometry(linestring, 2154)) AS geom_line,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_distance,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) * 1e100 AS st_distance_xe100,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) * 1e308 AS st_distance_xe308,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects,&#xA;&#x9;st_astext(&#xA;&#x9;&#x9;ST_LineInterpolatePoint(&#xA;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;ST_LineLocatePoint(&#xA;&#x9;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;&#x9;geom_pt::geometry(point, 2154)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;)&#xA;&#x9;) AS geom_point_proj,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;ST_LineInterpolatePoint(&#xA;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;ST_LineLocatePoint(&#xA;&#x9;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;&#x9;geom_pt::geometry(point, 2154)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects_proj&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-100)&#39;),&#xA;&#x9;(2, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-323)&#39;),&#xA;&#x9;(3, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-324)&#39;)&#xA;) AS t (id, geom_pt, geom_line)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;J&amp;rsquo;ai repris l&amp;rsquo;exemple d&amp;rsquo;une ligne avec un point mais l&amp;rsquo;ai amplifiÃ© : une ligne qui dÃ©bute en X = 0 et finie en X = 10 est comparÃ©e Ã  un point positionnÃ© en X = 2. Pour dÃ©caler la ligne du point, la fin de la ligne est dÃ©placÃ©e selon l&amp;rsquo;axe Y d&amp;rsquo;une distance trÃ¨s petite (en limite du type double prÃ©cision).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je calcule la distance, ainsi que la distance multipliÃ©e par 10&lt;sup&gt;100&lt;/sup&gt; et 10&lt;sup&gt;300&lt;/sup&gt; pour Ã©viter de passer sous la tolÃ©rance d&amp;rsquo;affichage des double prÃ©cision de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je dÃ©termine Ã©galement un point projetÃ© sur la ligne Ã  partir du point testÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom_line&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance_xe100&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance_xe300&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;th&gt;geom_point_proj&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects_proj&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 0)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-100)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 1e-100)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;sup&gt;99&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;td&gt;POINT(1 1e-101)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-323)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 1e-323)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-324)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que le point projetÃ© n&amp;rsquo;intersecte la ligne sur laquelle il est censÃ© Ãªtre positionnÃ© que dans le premier cas. Dans le cas d&amp;rsquo;un dÃ©calage, mÃªme infinitÃ©simale (dans le cas de la ligne 2, la distance entre la ligne et le point projetÃ© est tellement infime qu&amp;rsquo;il n&amp;rsquo;est pas calculable avec PostGIS), il n&amp;rsquo;y a pas intersection.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez essayer avec des dÃ©calages plus importants (de l&amp;rsquo;ordre de 1 m par exemple) mais trÃ¨s souvent il n&amp;rsquo;y aura pas d&amp;rsquo;intersection car un point projetÃ© sur un segment de ligne n&amp;rsquo;est qu&amp;rsquo;une approximation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Pour avoir une intersection fiable, il doit y avoir une correspondance topologique : un sommet avec un sommet.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;RÃ©duire la prÃ©cision&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme avoir une cohÃ©rence topologique ne vous intÃ©resse pas&amp;#8230; vous voulez rÃ©duire la prÃ©cision. Soit !&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il n&amp;rsquo;est pas possible de spÃ©cifier une prÃ©cision Ã  utiliser pour une base de donnÃ©es avec PostGIS. D&amp;rsquo;ailleurs le simple fait de vouloir contraindre la prÃ©cision des coordonnÃ©es doit amener Ã  rÃ©flÃ©chir sur les propositions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Il ne faut pas confondre prÃ©cision de la mesure et prÃ©cision des coordonnÃ©es : une mesure effectuÃ©e avec un GPS ayant une prÃ©cision de Â± 10 mÃ¨tres doit Ãªtre stockÃ©e telle que mesurÃ©e. &lt;br&gt;Par exemple X = 33,5 m, alors la valeur rÃ©elle est comprise entre 23,5 et 43,5 m, rÃ©duire la prÃ©cision Ã  10 mÃ¨tres prÃ¨s entrainerait alors une perte d&amp;rsquo;information.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Lorsque les coordonnÃ©es d&amp;rsquo;un point sont calculÃ©es par interpolation, la valeur peut avoir plus de dÃ©cimales que les valeurs utilisÃ©es dans l&amp;rsquo;interpolation. &lt;br&gt;Par exemple, deux points distants dont les coordonnÃ©es sont au mÃ¨tre prÃ¨s (pas de dÃ©cimales) peuvent entrainer le calcul d&amp;rsquo;un point mÃ©dian avec des coordonnÃ©es Ã  dÃ©cimales.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La rÃ©duction de la prÃ©cision au niveau des coordonnÃ©es implique une perte de prÃ©cision des valeurs issues de calculs Ã  partir des coordonnÃ©es (aire, pÃ©rimÃ¨tre&amp;#8230;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La reprojection des coordonnÃ©es peut impliquer un changement du nombre de dÃ©cimales. &lt;br&gt;Par exemple, les coordonnÃ©es en WGS 84 (en degrÃ©s) impliquent un nombre plus important de dÃ©cimales que les coordonnÃ©es en Lambert 93 (en mÃ¨tres).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe cependant plusieurs mÃ©thodes pour rÃ©duire la prÃ©cision des coordonnÃ©es ou des calculs associÃ©s aux coordonnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision des coordonnÃ©es&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_SnapToGrid.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_SnapToGrid&lt;/a&gt;&lt;/code&gt; : dÃ©place les sommets de gÃ©omÃ©tries en entrÃ©e sur une grille dont le pas est dÃ©fini. Les points consÃ©cutifs dÃ©placÃ©s au mÃªme endroit ainsi que les gÃ©omÃ©tries nulles sont supprimÃ©s. Attention, des gÃ©omÃ©tries invalides peuvent Ãªtre crÃ©Ã©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_ReducePrecision.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_ReducePrecision&lt;/a&gt;&lt;/code&gt; : rÃ©duit la prÃ©cision des coordonnÃ©es en les arrondissant selon la prÃ©cision choisie. Les gÃ©omÃ©tries crÃ©Ã©es sont toutes valides.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_QuantizeCoordinates.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_QuantizeCoordinates&lt;/a&gt;&lt;/code&gt; : rÃ©duit la prÃ©cision des coordonnÃ©es tout en opÃ©rant un traitement spÃ©cifique sur leur stockage afin d&amp;rsquo;en augmenter la compressibilitÃ©. Pour cela, les valeurs des bits non significatifs de la mantisse sont dÃ©finies Ã  zÃ©ro. Il s&amp;rsquo;agit de la meilleure mÃ©thode pour rÃ©duire le poids d&amp;rsquo;une gÃ©omÃ©trie.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision des calculs&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la prÃ©cision des calculs, c&amp;rsquo;est diffÃ©rents. En effet, PostGIS utilise toujours la prÃ©cision permise par le type double prÃ©cision et seules quelques fonctions permettent d&amp;rsquo;utiliser une tolÃ©rance. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les fonctions qui permettent de spÃ©cifier une tolÃ©rance (le paramÃ¨tre gridsize) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;ST_Union&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_UnaryUnion&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Difference&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Intersection&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_SymDifference&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Subdivide&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cependant, dans la plupart des cas c&amp;rsquo;est la mÃ©thode qu&amp;rsquo;il faut adapter. Il s&amp;rsquo;agit ainsi d&amp;rsquo;utiliser une fonction rÃ©duisant la prÃ©cision des coordonnÃ©es en conjonction d&amp;rsquo;une fonction classique ou d&amp;rsquo;utiliser une autre mÃ©thode que celle habituelle. Voici quelques cas et adaptations possibles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Intersects&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour tester si deux gÃ©omÃ©tries s&amp;rsquo;intersectent avec une certaine tolÃ©rance, il faut utiliser la fonction &lt;code&gt;ST_DWithin()&lt;/code&gt; qui permet de dÃ©terminer si deux gÃ©omÃ©tries sont situÃ©es Ã  une certaine distance l&amp;rsquo;une de l&amp;rsquo;autre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Covers&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour tester le recouvrement de deux gÃ©omÃ©tries, vous pouvez appliquer une zone tampon Ã  la gÃ©omÃ©trie Â«Â englobanteÂ Â» avec la fonction &lt;code&gt;ST_Buffer()&lt;/code&gt;. Par exemple, une zone tampon de 5 mÃ¨tres permet de savoir si une gÃ©omÃ©trie englobe une autre Ã  5 mÃ¨tres prÃ¨s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Touches&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Deux gÃ©omÃ©tries se touchent si elle s&amp;rsquo;intersectent mais pas leurs Â«Â intÃ©rieursÂ Â». Introduire une tolÃ©rance implique alors d&amp;rsquo;autoriser un lÃ©ger chevauchement des intÃ©rieurs. Il faudra alors utiliser la fonction &lt;code&gt;ST_DWithin&lt;/code&gt; pour valider que les gÃ©omÃ©tries soient proches l&amp;rsquo;une de lâ€™autre. Il faut ensuite valider que l&amp;rsquo;intersection des deux gÃ©omÃ©tries soit minime en calculant l&amp;rsquo;aire d&amp;rsquo;intersection avec &lt;code&gt;ST_Area(ST_Intersection())&lt;/code&gt; et en la comparant Ã  l&amp;rsquo;aire de chacune des gÃ©omÃ©tries. Il conviendra de dÃ©finir un pourcentage maximum (par exemple Â«Â moins de 1% d&amp;rsquo;intersectionÂ Â»).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Relation topologique : cas gÃ©nÃ©ral&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le calcul des relations topologiques de maniÃ¨re gÃ©nÃ©rale, tout va dÃ©pendre du rÃ©sultat voulu. Selon les cas, il faudra rÃ©duire la prÃ©cision des coordonnÃ©es avant d&amp;rsquo;utiliser la fonction ou encore combiner plusieurs autres fonctions permettant de dÃ©terminer la relation voulue.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Distance&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le calcul d&amp;rsquo;une distance n&amp;rsquo;est pas Ã  proprement parlÃ© liÃ© Ã  une tolÃ©rance mais la prÃ©cision du rÃ©sultat peut Ãªtre modifiÃ© avec la fonction &lt;code&gt;round()&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques liens pour approfondir le sujet :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un excellent article de LoÃ¯c Bartoletti sur Geotribu sur le sujet de la tolÃ©rance dans PostGIS : &lt;a href=&#34;https://geotribu.fr/articles/2024/2024-07-16_de-la-tolerance-en-sig-geometrie-00-annonce/&#34;&gt;https://geotribu.fr/articles/2024/2024-07-16_de-la-tolerance-en-sig-geometrie-00-annonce/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le type PostGIS &lt;code&gt;geometry&lt;/code&gt; : &lt;a href=&#34;https://postgis.net/docs/using_postgis_dbmanagement.html#PostGIS_Geometry&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://postgis.net/docs/using_postgis_dbmanagement.html#PostGIS_Geometry&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Discussion sur l&amp;rsquo;implÃ©mentation (future) d&amp;rsquo;une tolÃ©rance dans PostGIS : &lt;a href=&#34;https://trac.osgeo.org/postgis/wiki/ToleranceDiscussion#no1&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://trac.osgeo.org/postgis/wiki/ToleranceDiscussion#no1&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un article sur l&amp;rsquo;origine de &lt;code&gt;ST_QuantizeCoordinates()&lt;/code&gt; : &lt;a href=&#34;http://www.danbaston.com/posts/2018/02/15/optimizing-postgis-geometries.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;http://www.danbaston.com/posts/2018/02/15/optimizing-postgis-geometries.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la possibilitÃ© de dÃ©finir une rÃ©solution spatiale : &lt;a href=&#34;https://gis.stackexchange.com/questions/424798/is-it-possible-to-define-a-spatial-resolution-for-a-geometry-column-in-postgis&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://gis.stackexchange.com/questions/424798/is-it-possible-to-define-a-spatial-resolution-for-a-geometry-column-in-postgis&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la prÃ©cision des fonctions dans PostGIS : &lt;a href=&#34;https://stackoverflow.com/questions/70258656/postgis-precision-of-functions&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://stackoverflow.com/questions/70258656/postgis-precision-of-functions&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la mailing list PostGIS Ã  propos de la prÃ©cision du WKT : &lt;a href=&#34;https://lists.osgeo.org/pipermail/postgis-users/2008-May/019606.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://lists.osgeo.org/pipermail/postgis-users/2008-May/019606.html&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/soyons-precis-avec-postgis" rel="alternate"></link>
    <summary type="html">Vous Ãªtes vous dÃ©jÃ  demandÃ© quelle Ã©tait la prÃ©cision de PostGIS ? Moi oui... Alors Ã©tudions cela ensemble.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Monitorer PostgreSQL avec Prometheus et Grafana</title>
    <updated>2024-05-21T19:35:50Z</updated>
    <id>tag:blog.arthurbazin.com,2024-05-21:/it/monitorer-postgresql-avec-prometheus-et-grafana</id>
    <content type="html">&#xA;&lt;p&gt;Plus une instance PostgreSQL est utilisÃ©e et plus il devient crucial de la monitorer. De nombreuses solutions existent, je vais vous en prÃ©senter une que j&amp;rsquo;utilise rÃ©guliÃ¨rement et qui repose sur Prometheus et Grafana et qui permet de faire de beaux tableaux de bord.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img fetchpriority=&#34;high&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-3303&#34; style=&#34;width:768px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-300x159.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-768x407.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1536x813.png 1536w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1.png 1611w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Voila un trÃ¨s beau tableau de bord &lt;img src=&#34;https://s.w.org/images/core/emoji/15.0.3/72x72/1f609.png&#34; alt=&#34;ğŸ˜‰&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Pourquoi cette solution ? Car il est possible de monitorer d&amp;rsquo;autres programmes ainsi que des serveurs. Il s&amp;rsquo;agit donc d&amp;rsquo;une solution trÃ¨s modulaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Grafana&lt;/strong&gt; est un logiciel libre de visualisation de donnÃ©es. Il permet notamment la rÃ©alisation de tableaux de bord et s&amp;rsquo;interface parfaitement avec Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Prometheus &lt;/strong&gt;est un logiciel libre dâ€™enregistrement de mÃ©triques en temps rÃ©el. Il permet l&amp;rsquo;interrogation des donnÃ©es Ã  l&amp;rsquo;aide d&amp;rsquo;un langage simple (PromQL) et de gÃ©nÃ©rer des alertes si besoin.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Exporters&lt;/strong&gt; : il s&amp;rsquo;agit de petits logiciels qui permettent de rÃ©cupÃ©rer des donnÃ©es en temps rÃ©el dans un format comprÃ©hensible par Prometheus. Il en existe de toutes sortes dont celui pour PostgreSQL : &lt;strong&gt;Postgres Exporter&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Exporters&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Postgres Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Postgres Exporter est l&amp;rsquo;outil qui va interroger votre instance PostgreSQL est rÃ©cupÃ©rer les mÃ©triques nÃ©cessaires. Il est en gÃ©nÃ©ral installÃ© sur le serveur sur lequel se trouve l&amp;rsquo;instance PostgreSQL mais il peut Ãªtre installer ailleurs, il doit simplement pouvoir accÃ©der Ã  la base de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que Postgres Exporter gÃ¨re le multi-instance mais ce n&amp;rsquo;est pour l&amp;rsquo;instant pas recommandÃ© de l&amp;rsquo;utiliser. Il faudra donc autant de processus que d&amp;rsquo;instance PostgreSQL (pour rappel, une instance de PostgreSQL peut possÃ©der plusieurs bases de donnÃ©es).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, il n&amp;rsquo;est pas possible de sÃ©curiser l&amp;rsquo;accÃ¨s aux donnÃ©es exportÃ©es par Postgres Exporter directement. L&amp;rsquo;outil ne gÃ¨re pas l&amp;rsquo;authentification, il faut donc utiliser des rÃ¨gle de pare-feu ou un serveur web frontal pour Ã©viter que n&amp;rsquo;importe qui puisse voir les donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par tÃ©lÃ©charger le logiciel depuis &lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le projet GitHub&lt;/a&gt; (dans les Releases).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le dÃ©zipper puis de la placer lÃ  oÃ¹ vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ez ensuite un fichier &lt;code&gt;start_127.0.0.1_5432.bat&lt;/code&gt; dans le rÃ©pertoire de Postgres Exporter avec le contenu suivant (en remplaÃ§ant l&amp;rsquo;url d&amp;rsquo;accÃ¨s Ã  votre base de donnÃ©es dans le fichier et dans son nom) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;@echo off&#xA;&#xA;REM DÃ©claration d&#39;une variable pour identifier la source de donnÃ©es&#xA;set DATA_SOURCE_NAME=postgresql://postgres:postgres@127.0.0.1:5432/postgres?sslmode=disable&#xA;&#xA;REM Lancement du processus postgres_exporter.exe avec diffÃ©rentes options&#xA;postgres_exporter.exe ^&#xA;  --web.listen-address=:9187 \&#xA;  --collector.database_wraparound ^&#xA;  --collector.locks ^&#xA;  --collector.long_running_transactions ^&#xA;  --collector.postmaster ^&#xA;  --collector.stat_activity_autovacuum ^&#xA;  --collector.stat_bgwriter ^&#xA;  --collector.stat_database ^&#xA;  --collector.stat_statements ^&#xA;  --collector.stat_user_tables ^&#xA;  --collector.statio_user_indexes ^&#xA;  --collector.statio_user_tables ^&#xA;  --collector.wal&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce script permet deux choses :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;de gÃ©rer la variable &lt;code&gt;DATA_SOURCE_NAME&lt;/code&gt; qui permet de dÃ©clarer la base de donnÃ©es Ã  surveiller.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;de dÃ©clarer et Ã©ventuellement modifier facilement les options de surveillance (&lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter?tab=readme-ov-file#flags&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©taillÃ©es ici&lt;/a&gt;).&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9187&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donnÃ©es pourront Ãªtre rÃ©cupÃ©rÃ©es via HTTP.&lt;br&gt;9187 est le port par dÃ©faut mais vous pouvez en attribuer un autre si celui-ci est dÃ©jÃ  utilisÃ© ou si vous avez plusieurs instances Ã  surveiller.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La surveillance peut ensuite dÃ©marrer en lanÃ§ant le fichier &lt;code&gt;bat&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9187&lt;/code&gt;, vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005124&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.00158&#xA;go_gc_duration_seconds_sum 8.0821208&#xA;go_gc_duration_seconds_count 30800&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 16&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi Ãªtre crÃ©Ã© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de crÃ©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM, si vous avez prÃ©vu d&amp;rsquo;installer Grafana, vous pouvez attendre de l&amp;rsquo;avoir fait plutÃ´t que de tÃ©lÃ©charger NSSM.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois rÃ©cupÃ©rer, vous pourrez crÃ©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Prometheus - Postgres Exporter - 127.0.0.1:5432&#34; &#34;C:\chemin\vers\start_127.0.0.1_5432.bat&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Prometheus - Postgres Exporter - 127.0.0.1:5432&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ© (si vous avez dÃ©jÃ  PostgreSQL installÃ© il est probable que l&#39;utilisateur existe dÃ©jÃ )&#xA;sudo useradd postgres --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ©&#xA;sudo mkdir /opt/postgres_exporter&#xA;&#xA;# TÃ©lÃ©chargement de Postgres_exporter&#xA;# Attention Ã  la verion, dans le doute RDV sur le projet GitHub : https://github.com/prometheus-community/postgres_exporter&#xA;sudo wget -P /opt/postgres_exporter https://github.com/prometheus-community/postgres_exporter/releases/download/v0.15.0/postgres_exporter-0.15.0.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64.tar.gz -C /opt/postgres_exporter&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64 /opt/postgres_exporter/postgres_exporter&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown postgres:postgres -R /opt/postgres_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ons le fichier de configuration des variables d&amp;rsquo;environnement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/postgres_exporter/postgres_exporter_127.0.0.1_5432.env&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez alors la configuration suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# BDD Ã  monitorer&#xA;DATA_SOURCE_NAME=&#34;postgresql://postgres:postgres@127.0.0.1:5432/?sslmode=disable&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Postgres Exporter. Ajoutez une information sur l&amp;rsquo;instance monitorÃ©e car postgres_exporter ne gÃ¨re pas correctement le multi-instance.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/postgres_exporter_127.0.0.1_5432.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus exporter for Postgresql&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=postgres&#xA;Group=postgres&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;&#xA;WorkingDirectory=/opt/postgres_exporter&#xA;EnvironmentFile=/opt/postgres_exporter/postgres_exporter_127.0.0.1_5432.env&#xA;ExecStart=/opt/postgres_exporter/postgres_exporter/postgres_exporter \&#xA;    --web.listen-address=:9187 \&#xA;    --collector.database_wraparound \&#xA;    --collector.locks \&#xA;    --collector.long_running_transactions \&#xA;    --collector.postmaster \&#xA;    --collector.stat_activity_autovacuum \&#xA;    --collector.stat_bgwriter \&#xA;    --collector.stat_database \&#xA;    --collector.stat_statements \&#xA;    --collector.stat_user_tables \&#xA;    --collector.statio_user_indexes \&#xA;    --collector.statio_user_tables \&#xA;    --collector.wal&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous intÃ©grons dans la ligne de commande diffÃ©rentes options de surveillance (&lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter?tab=readme-ov-file#flags&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©taillÃ©es ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34; id=&#34;block-013a31d6-fbb5-4dd0-8c9a-f05ee7df2cad&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9187&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donnÃ©es pourront Ãªtre rÃ©cupÃ©rÃ©es via HTTP.&lt;br&gt;9187 est le port par dÃ©faut mais vous pouvez en attribuer un autre si celui-ci est dÃ©jÃ  utilisÃ© ou si vous avez plusieurs instances Ã  surveiller.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable postgres_exporter_127.0.0.1_5432.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start postgres_exporter_127.0.0.1_5432&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status postgres_exporter_127.0.0.1_5432&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u postgres_exporter_127.0.0.1_5432.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9187&lt;/code&gt;. Vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005124&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.00158&#xA;go_gc_duration_seconds_sum 8.0821208&#xA;go_gc_duration_seconds_count 30800&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 16&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Node Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Node Exporter est l&amp;rsquo;outil qui va collecter les mÃ©triques du systÃ¨me Linux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, il n&amp;rsquo;est pas possible de sÃ©curiser l&amp;rsquo;accÃ¨s aux donnÃ©es exportÃ©es par Node Exporter directement. L&amp;rsquo;outil ne gÃ¨re pas l&amp;rsquo;authentification, il faut donc utiliser des rÃ¨gle de pare-feu ou un serveur web frontal pour Ã©viter que n&amp;rsquo;importe qui puisse voir les donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ©&#xA;sudo useradd node_exporter --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ©&#xA;sudo mkdir /opt/node_exporter&#xA;&#xA;# TÃ©lÃ©chargement de Node_exporter&#xA;# Attention Ã  la verion, dans le doute RDV sur le site de Prometheus : https://prometheus.io/download/#node_exporter&#xA;sudo wget -P /opt/node_exporter https://github.com/prometheus/node_exporter/releases/download/v1.8.1/node_exporter-1.8.1.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/node_exporter/node_exporter-1.8.1.linux-amd64.tar.gz -C /opt/node_exporter&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/node_exporter/node_exporter-1.8.1.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/node_exporter/node_exporter-1.8.1.linux-amd64 /opt/node_exporter/node_exporter&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown node_exporter:node_exporter -R /opt/node_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Node Exporter. Ajoutez une information sur l&amp;rsquo;instance monitorÃ©e car postgres_exporter ne gÃ¨re pas correctement le multi-instance.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/node_exporter.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus exporter for Linux&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=node_exporter&#xA;Group=node_exporter&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;&#xA;WorkingDirectory=/opt/node_exporter&#xA;ExecStart=/opt/node_exporter/node_exporter/node_exporter \&#xA;    --web.listen-address=:9100 &#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous pouvons intÃ©grer dans la ligne de commande diffÃ©rentes options de surveillance (&lt;a href=&#34;https://github.com/prometheus/node_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©taillÃ©es ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34; id=&#34;block-013a31d6-fbb5-4dd0-8c9a-f05ee7df2cad&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9100&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donnÃ©es pourront Ãªtre rÃ©cupÃ©rÃ©es via HTTP.&lt;br&gt;9100 est le port par dÃ©faut mais vous pouvez en attribuer un autre si celui-ci est dÃ©jÃ  utilisÃ©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable node_exporter.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start node_exporter&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status node_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u node_exporter.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9100&lt;/code&gt;. Vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0&#xA;go_gc_duration_seconds_sum 0&#xA;go_gc_duration_seconds_count 0&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 7&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.22.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Windows Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Windows Exporter est l&amp;rsquo;outil qui va collecter les mÃ©triques du systÃ¨me Windows.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La procÃ©dure d&amp;rsquo;installation de cet exporter est bien dÃ©taillÃ©e sur la page du projet GitHub. Je ne la dÃ©taillerai donc pas entiÃ¨rement ici.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-vertical is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-2 wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/prometheus-community/windows_exporter?tab=readme-ov-file#installation&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ProcÃ©dure d&amp;rsquo;installation de Windows Exporter&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/prometheus-community/windows_exporter/releases&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;TÃ©lÃ©chargement de Windows Exporter&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la ligne de commande utilisÃ©e pour installer l&amp;rsquo;exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;msiexec /i &#34;C:\chemin_vers\windows_exporter-0.25.1-amd64.msi&#34; LISTEN_PORT=9182 EXTRA_FLAGS=&#34;--config.file=&#34;&#34;C:\Program Files\windows_exporter\config.yml&#34;&#34;&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cela permet de configurer Windows Exporter avec un fichier de configuration afin de pouvoir facilement modifier certains paramÃ¨tres si besoin (il suffit ensuite de relancer le service pour prendre en compte le nouveau paramÃ©trage).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9182&lt;/code&gt;. Vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005129&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.0005364&#xA;go_gc_duration_seconds_sum 0.0058283&#xA;go_gc_duration_seconds_count 37&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 15&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.5&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Prometheus&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prometheus est l&amp;rsquo;outil qui va stocker les donnÃ©es rÃ©cupÃ©rÃ©es par Postgres Exporter. Pour cela, il doit pouvoir contacter Postgres Exporter via HTTP.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prometheus gÃ¨re l&amp;rsquo;authentification basique, il faut pour cela suivre la procÃ©dure indiquÃ©e sur le site officiel : &lt;a href=&#34;https://prometheus.io/docs/guides/basic-auth&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://prometheus.io/docs/guides/basic-auth&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par tÃ©lÃ©charger le logiciel depuis &lt;a href=&#34;https://prometheus.io/download/&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Prometheus&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le dÃ©zipper puis de la placer lÃ  oÃ¹ vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La configuration de Prometheus se fait au travers d&amp;rsquo;un fichier YAML. Un fichier de configuration de base est fournit, ouvrez le et complÃ©tez le avec les informations suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Configuration globale&#xA;global:&#xA;  # Interval global de rÃ©cupÃ©ration (dÃ©faut 1 min)&#xA;  scrape_interval: 15s&#xA;  # Interval global d&#39;Ã©valuation des rÃ¨gles (dÃ©faut 1 min)&#xA;  evaluation_interval: 15s&#xA;  # Interval global de timeout (dÃ©faut 10s)&#xA;  scrape_timeout: 10s&#xA;&#xA;# Gestionnaire d&#39;alertes&#xA;alerting:&#xA;  alertmanagers:&#xA;    - static_configs:&#xA;        - targets:&#xA;          # - alertmanager:9093&#xA;&#xA;# RÃ¨gles&#xA;rule_files:&#xA;  # - &#34;first_rules.yml&#34;&#xA;  # - &#34;second_rules.yml&#34;&#xA;&#xA;# Configuration des data scraper (rÃ©cupÃ©rateurs de donnÃ©es)&#xA;scrape_configs:&#xA;  # Prometheus lui-mÃªme&#xA;  # &#34;job_name&#34; est ajoutÃ© Ã  chaque donnÃ©e rÃ©cupÃ©rÃ©e via cette configuration&#xA;  - job_name: &#34;Prometheus - Local&#34;&#xA;    static_configs:&#xA;      # Cible Ã  atteindre&#xA;      - targets: [&#34;localhost:9090&#34;]&#xA;&#xA;    # Identifiant et mot de passe pour accÃ©der Ã  Prometheus&#xA;    basic_auth:&#xA;      username: identifiant&#xA;      password: mdp&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons ensuite sÃ©curiser l&amp;rsquo;accÃ¨s Ã  Prometheus. CrÃ©ez un fichier web.yml avec les Ã©lÃ©ments suivants (pensez Ã  utiliser les mÃªmes identifiant/mdp dans le fichier prÃ©cÃ©dent : Prometheus doit pouvoir accÃ©der Ã  lui-mÃªme pour s&amp;rsquo;auto-monitorer) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;basic_auth_users:&#xA;  # Utilisateur 1 : identifiant: mdp_encryptÃ©&#xA;  identifiant: $2a$12$P63ADVOo///fo4HiMm4sYuogjceHfzT3vfShmgAYvEw8v28Bt4GBq&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant d&amp;rsquo;utilisateurs que vous le souhaitez. Le mot de passe doit Ãªtre spÃ©cifiÃ© de faÃ§on cryptÃ© avec bcrypt. Vous pouvez utiliser un crypteur sur le web &lt;a href=&#34;https://bcrypt-generator.com/&#34;&gt;comme celui-ci&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ez ensuite un fichier &lt;code&gt;start.bat&lt;/code&gt; dans le rÃ©pertoire de Prometheus avec le contenu suivant (en remplaÃ§ant l&amp;rsquo;url d&amp;rsquo;accÃ¨s Ã  votre base de donnÃ©es dans le fichier et dans son nom) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;@echo off&#xA;&#xA;REM Lancement du processus prometheus.exe avec diffÃ©rentes options&#xA;prometheus.exe ^&#xA;  --web.listen-address=:9090 ^&#xA;  --web.config.file=web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce script permet de dÃ©clarer et Ã©ventuellement modifier facilement les options de Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;option &lt;code&gt;web.listen-adress=:9090&lt;/code&gt; permet de dÃ©finir le port d&amp;rsquo;Ã©coute. &lt;br&gt;La valeur 9090 est la valeur par dÃ©faut, cette option n&amp;rsquo;est donc pas indispensable dans notre cas.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;option &lt;code&gt;web.config.file=web.yml&lt;/code&gt; permet d&amp;rsquo;activer l&amp;rsquo;authentification.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La surveillance peut ensuite dÃ©marrer en lanÃ§ant le fichier &lt;code&gt;bat&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Prometheus Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9090&lt;/code&gt;. Vous devriez obtenir la page suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;440&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png&#34; alt=&#34;&#34; class=&#34;wp-image-3323&#34; style=&#34;width:696px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-300x129.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-768x330.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil.png 1041w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi Ãªtre crÃ©Ã© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de crÃ©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM, si vous avez prÃ©vu d&amp;rsquo;installer Grafana, vous pouvez attendre de l&amp;rsquo;avoir fait plutÃ´t que de tÃ©lÃ©charger NSSM.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois rÃ©cupÃ©rer, vous pourrez crÃ©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Prometheus&#34; &#34;C:\chemin\vers\start.exe&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Prometheus&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ©&#xA;sudo useradd prometheus --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ© et d&#39;un rÃ©pertoire pour stocker les donnÃ©es&#xA;sudo mkdir /opt/prometheus&#xA;sudo mkdir /opt/prometheus/data&#xA;&#xA;# TÃ©lÃ©chargement de Prometheus&#xA;# Attention Ã  la version qu&#39;il vous faudra adapter&#xA;sudo wget -P /opt/prometheus https://github.com/prometheus/prometheus/releases/download/v2.51.1/prometheus-2.51.1.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/prometheus/prometheus-2.51.1.linux-amd64.tar.gz -C /opt/prometheus&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/prometheus/prometheus-2.51.1.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/prometheus/prometheus-2.51.1.linux-amd64 /opt/prometheus/prometheus&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown prometheus:prometheus -R /opt/prometheus&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La configuration de Prometheus se fait au travers d&amp;rsquo;un fichier YAML. Un fichier de configuration de base est fournit, ouvrez le :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/prometheus/prometheus/prometheus.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Configuration globale&#xA;global:&#xA;  # Interval global de rÃ©cupÃ©ration (dÃ©faut 1 min)&#xA;  scrape_interval: 15s&#xA;  # Interval global d&#39;Ã©valuation des rÃ¨gles (dÃ©faut 1 min)&#xA;  evaluation_interval: 15s&#xA;  # Interval global de timeout (dÃ©faut 10s)&#xA;  scrape_timeout: 10s&#xA;&#xA;# Gestionnaire d&#39;alertes&#xA;alerting:&#xA;  alertmanagers:&#xA;    - static_configs:&#xA;        - targets:&#xA;          # - alertmanager:9093&#xA;&#xA;# RÃ¨gles&#xA;rule_files:&#xA;  # - &#34;first_rules.yml&#34;&#xA;  # - &#34;second_rules.yml&#34;&#xA;&#xA;# Configuration des data scraper (rÃ©cupÃ©rateurs de donnÃ©es)&#xA;scrape_configs:&#xA;  # Prometheus lui-mÃªme&#xA;  # &#34;job_name&#34; est ajoutÃ© Ã  chaque donnÃ©e rÃ©cupÃ©rÃ©e via cette configuration&#xA;  - job_name: &#34;Prometheus - Local&#34;&#xA;    static_configs:&#xA;      # Cible Ã  atteindre&#xA;      - targets: [&#34;localhost:9090&#34;]&#xA;&#xA;    # Identifiant et mot de passe pour accÃ©der Ã  Prometheus&#xA;    basic_auth:&#xA;      username: identifiant&#xA;      password: mdp&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons ensuite sÃ©curiser l&amp;rsquo;accÃ¨s Ã  Prometheus. CrÃ©ez un fichier web.yml avec les Ã©lÃ©ments suivants (pensez Ã  utiliser les mÃªmes identifiant/mdp dans le fichier prÃ©cÃ©dent : Prometheus doit pouvoir accÃ©der Ã  lui-mÃªme pour s&amp;rsquo;auto-monitorer) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/prometheus/prometheus/web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;basic_auth_users:&#xA;  # Utilisateur 1 : identifiant: mdp_encryptÃ©&#xA;  identifiant: $2a$12$P63ADVOo///fo4HiMm4sYuogjceHfzT3vfShmgAYvEw8v28Bt4GBq&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant d&amp;rsquo;utilisateurs que vous le souhaitez. Le mot de passe doit Ãªtre spÃ©cifiÃ© de faÃ§on cryptÃ© avec bcrypt. Vous pouvez utiliser un crypteur sur le web &lt;a href=&#34;https://bcrypt-generator.com/&#34;&gt;comme celui-ci&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La rÃ©cupÃ©ration des donnÃ©es peut ensuite dÃ©marrer en lanÃ§ant le programme Prometheus via la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;/opt/prometheus/prometheus/prometheus --config.file=prometheus.yml --web.config.file=web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Prometheus Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9090&lt;/code&gt;. Vous devriez obtenir la page suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;440&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png&#34; alt=&#34;&#34; class=&#34;wp-image-3323&#34; style=&#34;width:696px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-300x129.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-768x330.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil.png 1041w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Prometheus est disponible peut Ãªtre modifier avec l&amp;rsquo;argument &lt;code&gt;--web.listen-address&lt;/code&gt; a ajouter lors du dÃ©marrage du programme (comme avec Postgres Exporter).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/prometheus.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus &#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=prometheus &#xA;Group=prometheus &#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;ExecStart=/opt/prometheus/prometheus/prometheus \&#xA;    --config.file=/opt/prometheus/prometheus/prometheus.yml \&#xA;    --web.config.file=/opt/prometheus/prometheus/web.yml \&#xA;    --web.listen-address=:9090 \&#xA;    --storage.tsdb.path=/opt/prometheus/data \&#xA;    --storage.tsdb.retention.time=30d&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable prometheus.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start prometheus&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status prometheus&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u prometheus.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Liaison Prometheus &amp;#8211; Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour que Prometheus rÃ©cupÃ¨re les donnÃ©es d&amp;rsquo;un Exporter que vous avez installÃ©, il vous faut Ã©diter le fichier de configuration YAML.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez un nouveau Â«Â jobÂ Â» dans la partie &lt;code&gt;scrape_configs&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour PostgreSQL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;  # PostgreSQL Monitoring avec postgres_exporter&#xA;  - job_name: &#39;PostgreSQL Exporter&#39;&#xA;    scrape_interval: 5s&#xA;    static_configs:&#xA;      # Cible Ã  atteindre&#xA;      - targets: [&#39;127.0.0.1:9187&#39;]&#xA;        labels:&#xA;          # &#34;instance&#34; est ajoutÃ© Ã  chaque donnÃ©e rÃ©cupÃ©rÃ©e et prend la valeur du paramÃ¨tre &amp;lt;targets&gt;, comme on sait qu&#39;il n&#39;y a qu&#39;un PG derriÃ¨re, on renomme l&#39;instance&#xA;          &#34;instance&#34;: &#34;127.0.0.1:5431&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour Node Exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt; # Linux Monitoring with node_exporter&#xA;  - job_name: &#39;Node Exporter&#39;&#xA;    scrape_interval: 15s&#xA;    static_configs:&#xA;      - targets: [&#39;127.0.0.1:9100&#39;]&#xA;        labels:&#xA;          &#34;instance&#34;: &#34;Mon serveur XYZ&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour Windows Exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt; # Windows Monitoring with windows_exporter&#xA;  - job_name: &#39;Windows Exporter&#39;&#xA;    scrape_interval: 15s&#xA;    static_configs:&#xA;      - targets: [&#39;127.0.0.1:9182&#39;]&#xA;        labels:&#xA;          &#34;instance&#34;: &#34;Mon serveur ABC&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant de job que nÃ©cessaire, afin que votre Prometheus rÃ©cupÃ¨re des donnÃ©es de divers services.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;RedÃ©marrez le service de Prometheus et rendez-vous dans la page Â«Â StatusÂ Â» =&amp;gt; Â«Â TargetÂ Â» de l&amp;rsquo;interface, vous devriez voir la connexion avec Postgres Exporter et Node Exporter&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;520&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-1024x520.png&#34; alt=&#34;&#34; class=&#34;wp-image-3324&#34; style=&#34;width:757px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-1024x520.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-300x152.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-768x390.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target.png 1036w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Grafana&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par tÃ©lÃ©charger le logiciel depuis &lt;a href=&#34;https://grafana.com/grafana/download?platform=windows&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Grafana&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le dÃ©zipper puis de la placer lÃ  oÃ¹ vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le logiciel se lance simplement en dÃ©marrant le programme &lt;code&gt;grafana-server.exe&lt;/code&gt; situÃ© dans le rÃ©pertoire &lt;code&gt;bin&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Grafana Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Grafana est disponible peut Ãªtre modifier dans le fichier de configuration &lt;code&gt;conf/defaults.ini&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi Ãªtre crÃ©Ã© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de crÃ©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM dans le rÃ©pertoire &lt;code&gt;svc-x&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois rÃ©cupÃ©rer, vous pourrez crÃ©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Grafana&#34; &#34;C:\chemin\vers\grafana-server.exe&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Grafana&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe une multitude de faÃ§on d&amp;rsquo;installer Grafana sur Linux (Ubuntu/Debian).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ©&#xA;sudo useradd grafana --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ©&#xA;sudo mkdir /opt/grafana&#xA;&#xA;# TÃ©lÃ©chargement de Prometheus&#xA;# Attention Ã  la version qu&#39;il vous faudra adapter&#xA;sudo wget -P /opt/grafana https://dl.grafana.com/enterprise/release/grafana-enterprise-11.0.0.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/grafana/grafana-enterprise-11.0.0.linux-amd64.tar.gz -C /opt/grafana&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/grafana/grafana-enterprise-11.0.0.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/grafana/grafana-v11.0.0 /opt/grafana/grafana&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown grafana:grafana -R /opt/grafana&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le logiciel se lance simplement en dÃ©marrant le programme &lt;code&gt;grafana&lt;/code&gt; situÃ© dans le rÃ©pertoire &lt;code&gt;bin&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;grafana server&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Grafana Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Grafana est disponible peut Ãªtre modifier dans le fichier de configuration &lt;code&gt;conf/defaults.ini&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Grafana.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/grafana.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Grafana&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=grafana&#xA;Group=grafana&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;WorkingDirectory=/opt/grafana/grafana&#xA;ExecStart=/opt/grafana/grafana/bin/grafana server&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable grafana.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start grafana&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status grafana&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u grafana.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;ParamÃ©trages&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant accÃ©der Ã  Grafana sur l&amp;rsquo;adresse &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le premier Ã©cran vous demande de vous connecter, utilisez l&amp;rsquo;identifiant &lt;code&gt;admin&lt;/code&gt; avec &lt;code&gt;admin&lt;/code&gt; pour mot de passe. L&amp;rsquo;Ã©crans suivant vous demandera de dÃ©finir un nouveau mot de passe.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;594&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-1024x594.png&#34; alt=&#34;&#34; class=&#34;wp-image-3293&#34; style=&#34;width:604px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-1024x594.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-300x174.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-768x446.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in.png 1034w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Dans l&amp;rsquo;interface suivante, cliquer sur l&amp;rsquo;icone pour ouvrir le menu de gauche puis sur Â«Â Add new connectionÂ Â» :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;772&#34; height=&#34;462&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion.png&#34; alt=&#34;&#34; class=&#34;wp-image-3294&#34; style=&#34;width:590px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion.png 772w, https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion-300x180.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion-768x460.png 768w&#34; sizes=&#34;auto, (max-width: 772px) 100vw, 772px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant ajouter une connexion vers Prometheus en renseignant son url d&amp;rsquo;accÃ¨s &lt;code&gt;http://serveur:9090&lt;/code&gt; puis en choisissant le type d&amp;rsquo;authentification Â«Â basiqueÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il ne vous reste plus qu&amp;rsquo;a crÃ©er votre tableau de bord ou en rÃ©cupÃ©rer un dÃ©jÃ  crÃ©Ã© depuis &lt;a href=&#34;https://grafana.com/grafana/dashboards/&#34; data-type=&#34;link&#34; data-id=&#34;https://grafana.com/grafana/dashboards/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Grafana&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple de tableau de bord :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-3303&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-300x159.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-768x407.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1536x813.png 1536w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1.png 1611w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici le code json Ã  tÃ©lÃ©charger pour importer ce tableau de bord dans votre Grafana : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-3 wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/wp-content/uploads/tdb_postgresql.zip&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Tableau de bord PostgreSQL &amp;#8211; 7ko&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;MÃ©triques importantes&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quelles sont les mÃ©triques importantes Ã  surveiller ? &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Tout dÃ©pends des usages mais en voici quelques unes que j&amp;rsquo;ai pu choisir pour PostgreSQL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_up&lt;/code&gt; : l&amp;rsquo;Ã©tat actif ou non de l&amp;rsquo;instance.&lt;br&gt;C&amp;rsquo;est un peu la base de tout le monitoring&amp;#8230;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;process_start_time_seconds&lt;/code&gt; : le dÃ©lais d&amp;rsquo;activitÃ© (depuis quand la base est-elle dÃ©marrÃ©e ?)&lt;br&gt;Cela permet de repÃ©rer les redÃ©marrages de la base.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_activity_count&lt;/code&gt; et &lt;code&gt;pg_settings_max_connections&lt;/code&gt; : le nombre de connexions par rapport au nombre total de connexions possibles.&lt;br&gt;Pour savoir s&amp;rsquo;il faut augmenter le pool de connexions disponibles.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_database_size_bytes&lt;/code&gt; : la taille totale des bases de l&amp;rsquo;instance&lt;br&gt;Pour identifier celle qui pourrait poser problÃ¨me et/ou anticiper une augmentation de la capacitÃ© du serveur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_xact_commit&lt;/code&gt; et &lt;code&gt;pg_stat_database_xact_rollback&lt;/code&gt; : le taux de COMMIT et de ROLLBACK.&lt;br&gt;S&amp;rsquo;il y a beaucoup de ROLLBACK, il y a peut Ãªtre un problÃ¨me avec certaines requÃªtes.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;process_resident_memory_bytes&lt;/code&gt; et &lt;code&gt;process_cpu_seconds_total&lt;/code&gt; : les consommations RAM et CPU.&lt;br&gt;Il s&amp;rsquo;agit plus de valeur indicatives de la charge de la base, il n&amp;rsquo;y a pas de mise en rapport avec la puissance du serveur et donc pas d&amp;rsquo;information sur l&amp;rsquo;Ã©tat de charge de la machine.&lt;br&gt;Il faudra plutot surveiller le serveur en lui-mÃªme.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_tup_fetched&lt;/code&gt; et &lt;code&gt;pg_stat_database_tup_returned&lt;/code&gt; : le rapport entre le nombre de tuples lus directement dans le stockage (returned) par rapport au nombre de tuples rÃ©ellement nÃ©cessaires (fetched). Cela permet de dÃ©celer un manque d&amp;rsquo;indexation.&lt;br&gt;Par exemple, sur une table de 1000 lignes sans index, une requÃªte avec une clause ne renvoyant que 100 lignes aura un nombre de tuples Â«Â returnedÂ Â» de 1000 et un nombre de tuples Â«Â fetchedÂ Â» de 100 car il aura fallu scanner toutes les lignes pour rÃ©cupÃ©rer le rÃ©sultat. Avec un index, la valeur de returned aurait Ã©tÃ© bien moindre (probablement lÃ©gÃ¨rement supÃ©rieur Ã  100).&lt;br&gt;Attention, le nombre de tuples Â«Â fetchedÂ Â» ne correspond pas forcÃ©ment au nombre de tuples retournÃ©s au clients ce qui est interessant ici c&amp;rsquo;est bien le rapport entre les deux valeurs.&lt;br&gt;Attention, la valeur porte sur la base entiÃ¨re, il conviendra ensuite d&amp;rsquo;auditer les requÃªtes pour identifier l&amp;rsquo;origine du manque d&amp;rsquo;indexation.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_blks_hit&lt;/code&gt; et &lt;code&gt;pg_stat_database_blks_read&lt;/code&gt; : le nombre de blocs lu sur le disque (read) par rapport au nombre de bloc lu dans la mÃ©moire tampon (hit).&lt;br&gt;Cela permet de dÃ©tecter un Ã©ventuel manque de ressources pour la mÃ©moire tampon (paramÃ¨tre shared buffer).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_user_tables_n_dead_tup&lt;/code&gt; : le nombre de tuples mort (dead tuple).&lt;br&gt;Cela permet de surveiller le bon fonctionnement du processus de VACUUM.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, Postgres Exporter se focalise sur une seule base de donnÃ©es et ne permet donc pas d&amp;rsquo;avoir certaines mÃ©triques en Â«Â multibaseÂ Â», sur l&amp;rsquo;instance complÃ¨te (en fait si mais Â«Â c&amp;rsquo;est compliquÃ©Â Â» et non recommandÃ©). Il faudrait ainsi avoir plusieurs Postgres Exporter en parallÃ¨le, un pour chaque base d&amp;rsquo;une instance&amp;#8230; Je complÃ¨terai cet article lorsque j&amp;rsquo;aurai identifiÃ© une solution (sous peu j&amp;rsquo;espÃ¨re)&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D&amp;rsquo;autres mÃ©triques sont intÃ©ressantes, notamment si vous avez mis en place de la rÃ©plication. Voici quelques ressources utiles :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Une liste dÃ©taillÃ©e de mÃ©triques : &lt;a href=&#34;https://www.datadoghq.com/blog/postgresql-monitoring&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.datadoghq.com/blog/postgresql-monitoring&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une autre liste de mÃ©triques : &lt;a href=&#34;https://sysdig.com/blog/postgresql-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://sysdig.com/blog/postgresql-monitoring/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des exemples de tableaux de bord : &lt;a href=&#34;https://promcat.io/apps/postgresql/latest&#34;&gt;https://promcat.io/apps/postgresql/latest&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les tableau de bord prÃ©construits pour Grafana : &lt;a href=&#34;https://grafana.com/grafana/dashboards/?search=postgresql&#34;&gt;https://grafana.com/grafana/dashboards/?search=postgresql&lt;/a&gt;&lt;br&gt;On y trouve beaucoup d&amp;rsquo;exemples et de bonnes idÃ©es.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Retrouvez Ã©galement quelques Ã©lÃ©ments dans l&amp;rsquo;article suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-embed is-type-wp-embed is-provider-bazinga-039-s wp-block-embed-bazinga-039-s&#34;&gt;&lt;div class=&#34;wp-block-embed__wrapper&#34;&gt;&#xA;&lt;blockquote class=&#34;wp-embedded-content&#34; data-secret=&#34;2qLbf2cgdB&#34;&gt;&lt;a href=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-7&#34;&gt;PostgreSQL &amp;#8211; Vade-mecum SQL &amp;#8211; 7/8 &amp;#8211; Administration serveur&lt;/a&gt;&lt;/blockquote&gt;&lt;iframe loading=&#34;lazy&#34; class=&#34;wp-embedded-content&#34; sandbox=&#34;allow-scripts&#34; security=&#34;restricted&#34;  title=&#34;Â«Â PostgreSQL &amp;#8211; Vade-mecum SQL &amp;#8211; 7/8 &amp;#8211; Administration serveurÂ Â» &amp;#8212; BazinGa&amp;#039;s&#34; src=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-7/embed#?secret=hIDLWEJ0Nz#?secret=2qLbf2cgdB&#34; data-secret=&#34;2qLbf2cgdB&#34; width=&#34;600&#34; height=&#34;338&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34;&gt;&lt;/iframe&gt;&#xA;&lt;/div&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour les serveurs Windows et Linux, cela dÃ©pendra Ã©galement ce que vous faites avec ceux-ci. Voici ce que je surveille Ã  minima :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La charge CPU&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La consommation de mÃ©moire RAM&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La consommation d&amp;rsquo;espace disque&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La quantitÃ© d&amp;rsquo;Ã©criture et de lecture sur le disque et leur rapiditÃ© (i/o).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Eventuellement le nombre d&amp;rsquo;utilisateur connectÃ©s pour un Windows.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/it/monitorer-postgresql-avec-prometheus-et-grafana" rel="alternate"></link>
    <summary type="html">Monitorez votre instance PostgreSQL avec Postgres Exporter, Prometheus et Grafana.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Stockage physique, gestion des donnÃ©es et VACUUM</title>
    <updated>2024-02-03T13:32:02Z</updated>
    <id>tag:blog.arthurbazin.com,2024-02-03:/bdd/postgresql/stockage-physique-gestion-des-donnees-et-vacuum</id>
    <content type="html">&#xA;&lt;p&gt;En SIG, on oppose souvent le stockage sous forme de fichiers plats au stockage en base de donnÃ©es. Mais comment fait PostgreSQL pour stocker rÃ©ellement les donnÃ©es ? Et bien il utilise des fichiers plats&amp;#8230; (le serpent se mort la queue). Nous allons donc dÃ©mystifier un peu ce fonctionnement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre question que j&amp;rsquo;ai pu avoir en lien avec le stockage : pourquoi aprÃ¨s avoir fait du nettoyage dans une base de donnÃ©es, l&amp;rsquo;espace disque n&amp;rsquo;avait pas franchement diminuÃ©, y compris aprÃ¨s avoir utilisÃ© la commande &lt;code&gt;VACUUM&lt;/code&gt; ? Nous allons voir d&amp;rsquo;oÃ¹ provient ce comportement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que je prendrais parfois quelques raccourcis pour pour simplifier les explications. Nous ne parlerons Ã©galement que des tables et non des index.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Fonctions personnalisÃ©es&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour nous aider dans notre quÃªte, nous allons avoir besoin d&amp;rsquo;extensions spÃ©cifiques et de fonctions crÃ©Ã©es pour l&amp;rsquo;occasion. Les voici, vous pourrez les dÃ©cortiquer une fois que vous aurez lu l&amp;rsquo;article :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;extension&#34; data-enlighter-group=&#34;install&#34;&gt;-- Ajout des extensions&#xA;CREATE EXTENSION pgstattuple;&#xA;CREATE EXTENSION pageinspect;&#xA;CREATE EXTENSION pg_freespacemap;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;table_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_table_info(relname TEXT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_table_info(relname TEXT)&#xA;RETURNS TABLE(&#xA;  &#34;schema&#34; text,&#xA;  &#34;table&#34; text,&#xA;  &#34;tablespace&#34; text,&#xA;  oid_table oid,&#xA;  numero_heap_file oid,&#xA;  heap_file_segment_0_location text,&#xA;  nb_page bigint,&#xA;  tuple_count bigint,&#xA;  dead_tuple_count bigint,&#xA;  table_length bigint,&#xA;  table_length_human text,&#xA;  tuple_length bigint,&#xA;  tuple_percent numeric,&#xA;  dead_tuple_length bigint,&#xA;  dead_tuple_percent numeric,&#xA;  free_space_length bigint,&#xA;  free_space_percent numeric,&#xA;  max_frozen_txid xid,&#xA;  n_tup_ins bigint,&#xA;  n_tup_upd bigint,&#xA;  n_tup_del bigint,&#xA;  n_mod_since_analyze bigint,&#xA;  n_ins_since_vacuum bigint,&#xA;  last_vacuum timestamp with time zone, &#xA;  last_autovacuum timestamp with time zone, &#xA;  last_analyze timestamp with time zone,&#xA;  last_autoanalyze timestamp with time zone,&#xA;  toast_oid oid,&#xA;  toast_table text,&#xA;  toast_heap_file_segment_0_location text,&#xA;  toast_nb_page bigint,&#xA;  toast_nb_tuple bigint,&#xA;  toast_length bigint,&#xA;  toast_length_human text&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION table_info(relname TEXT)&#xA; * Renvoi diffÃ©rentes informations sur une table et son stockage&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : objet Ã  analyser au choix :&#xA; *    - &#39;schema.Table&#39; : pour analyser une table en particulier.&#xA; *    - &#39;schema&#39; : pour analyser toutes les tables d&#39;un schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; * &#xA; */&#xA;DECLARE &#xA;  var_requete TEXT;&#xA;  schemaname TEXT;&#xA;  table_schema record;&#xA;  schema_check boolean DEFAULT FALSE;&#xA;  where_clause TEXT;&#xA;&#xA;BEGIN&#xA;  &#xA;  -- Nettoyage du nom d&#39;objet&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  &#xA;&#xA;&#xA;  -- L&#39;analyse porte-elle sur un schÃ©ma ?&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      TRUE&#xA;    FROM &#xA;      information_schema.schemata&#xA;    WHERE &#xA;      schema_name = $a$ || quote_literal(relname)&#xA;  ;&#xA;&#xA;  EXECUTE &#xA;    var_requete&#xA;  INTO &#xA;    schema_check&#xA;  ;&#xA;  &#xA;&#xA;  &#xA;  -- Action selon si schema/table&#xA;  IF schema_check THEN&#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for schema&#39;;&#xA;    &#xA;    -- Clause de rÃ©cupÃ©ration des donnÃ©es d&#39;un schÃ©ma&#xA;    where_clause := &#xA;      $a$pgc.relnamespace = $a$ || quote_literal(relname) || $a$::regnamespace $a$&#xA;    ;&#xA;  &#xA;    -- Boucle sur toutes les tables d&#39;un schema&#xA;    var_requete := &#xA;      $a$SELECT&#xA;        pgc.relname::TEXT AS &#34;table&#34;&#xA;      FROM&#xA;        pg_class AS pgc&#xA;      WHERE &#xA;        $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;  &#xA;    FOR table_schema IN EXECUTE var_requete&#xA;        &#xA;    LOOP&#xA;      &#xA;      var_requete := &#xA;        $a$ANALYZE $a$ || quote_ident(relname) || &#39;.&#39; || quote_ident(table_schema.&#34;table&#34;)&#xA;      ;&#xA;      &#xA;      --RAISE NOTICE USING MESSAGE = var_requete;&#xA;&#xA;        -- Analyse de la table&#xA;      EXECUTE &#xA;        var_requete&#xA;      ;&#xA;      &#xA;      &#xA;    END LOOP;&#xA;    &#xA;  &#xA;  ELSE &#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for table&#39;;&#xA;  &#xA;    -- Quotation du schema.table&#xA;    relname := &#xA;      quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;      &#39;.&#39; || &#xA;      quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;    ;&#xA;  &#xA;    -- Clause de rÃ©cuÃ©pration d&#39;une table&#xA;    where_clause :=&#xA;      $a$pgc.oid = $a$ || quote_literal(relname) || $a$::regclass $a$&#xA;    ;&#xA;&#xA;    -- Analyse de la table&#xA;    EXECUTE &#xA;      $a$ANALYZE $a$ || relname&#xA;    ;&#xA;  &#xA;  END IF;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      pgc.relnamespace::regnamespace::text AS &#34;schema&#34;,&#xA;      pgc.relname::text AS &#34;table&#34;,&#xA;      COALESCE (pgt.spcname, &#39;pg_default&#39;)::TEXT AS &#34;tablespace&#34;,&#xA;      pgc.oid AS oid_table,&#xA;      pg_relation_filenode(pgc.oid) AS numero_heap_file,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgc.oid) AS &#34;heap_file_segment_0_location&#34;,&#xA;      pgc.relpages::int AS nb_page,&#xA;      pst.tuple_count::bigint,&#xA;      pst.dead_tuple_count::bigint,&#xA;      pst.table_len::bigint AS table_length,&#xA;      pg_size_pretty(pst.table_len) AS table_length_human,&#xA;      pst.tuple_len::bigint AS tuple_length,&#xA;      pst.tuple_percent::numeric,&#xA;      pst.dead_tuple_len::bigint AS dead_tuple_length,&#xA;      pst.dead_tuple_percent::numeric,&#xA;      pst.free_space::bigint AS free_space_length,&#xA;      pst.free_percent::NUMERIC AS free_space_percent,&#xA;      pgc.relfrozenxid AS max_frozen_txid,&#xA;      psut.n_tup_ins::bigint,&#xA;      psut.n_tup_upd::bigint,&#xA;      psut.n_tup_del::bigint,&#xA;      psut.n_mod_since_analyze::bigint,&#xA;      psut.n_ins_since_vacuum::bigint,&#xA;      psut.last_vacuum, &#xA;      psut.last_autovacuum, &#xA;      psut.last_analyze,&#xA;      psut.last_autoanalyze,&#xA;      pgc.reltoastrelid AS toast_oid,&#xA;      pgct.relname::text AS toast_table,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgct.oid) AS &#34;toast_heap_file_segment_0_location&#34;,&#xA;      pgct.relpages::int AS toast_nb_page,&#xA;      pgct.reltuples::int AS toast_nb_tuple,&#xA;      pg_relation_size(pgc.reltoastrelid)::bigint AS toast_length,&#xA;      pg_size_pretty(pg_relation_size(pgc.reltoastrelid))::text AS toast_length_human&#xA;    FROM &#xA;      pg_class AS pgc&#xA;    LEFT JOIN &#xA;      pg_tablespace AS pgt &#xA;      ON pgt.oid = pgc.reltablespace &#xA;    LEFT JOIN &#xA;      pg_class AS pgct &#xA;      ON pgct.oid = pgc.reltoastrelid&#xA;    LEFT JOIN&#xA;      pg_stat_user_tables AS psut&#xA;      ON psut.relid = pgc.oid&#xA;    LEFT JOIN LATERAL&#xA;      pgstattuple(pgc.oid::regclass::text) AS pst&#xA;      ON TRUE&#xA;    WHERE &#xA;      $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;    &#xA;    RETURN QUERY EXECUTE &#xA;      var_requete&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;table_info() (PG &lt; 12)&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_table_info(relname TEXT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_table_info(relname TEXT)&#xA;RETURNS TABLE(&#xA;  &#34;schema&#34; text,&#xA;  &#34;table&#34; text,&#xA;  &#34;tablespace&#34; text,&#xA;  oid_table oid,&#xA;  numero_heap_file oid,&#xA;  heap_file_segment_0_location text,&#xA;  nb_page bigint,&#xA;  tuple_count bigint,&#xA;  dead_tuple_count bigint,&#xA;  table_length bigint,&#xA;  table_length_human text,&#xA;  tuple_length bigint,&#xA;  tuple_percent numeric,&#xA;  dead_tuple_length bigint,&#xA;  dead_tuple_percent numeric,&#xA;  free_space_length bigint,&#xA;  free_space_percent numeric,&#xA;  max_frozen_txid xid,&#xA;  n_tup_ins bigint,&#xA;  n_tup_upd bigint,&#xA;  n_tup_del bigint,&#xA;  n_mod_since_analyze bigint,&#xA;  last_vacuum timestamp with time zone, &#xA;  last_autovacuum timestamp with time zone, &#xA;  last_analyze timestamp with time zone,&#xA;  last_autoanalyze timestamp with time zone,&#xA;  toast_oid oid,&#xA;  toast_table text,&#xA;  toast_heap_file_segment_0_location text,&#xA;  toast_nb_page bigint,&#xA;  toast_nb_tuple bigint,&#xA;  toast_length bigint,&#xA;  toast_length_human text&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION table_info(relname TEXT)&#xA; * Renvoi diffÃ©rentes informations sur une table et son stockage&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : objet Ã  analyser au choix :&#xA; *    - &#39;schema.Table&#39; : pour analyser une table en particulier.&#xA; *    - &#39;schema&#39; : pour analyser toutes les tables d&#39;un schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; * &#xA; */&#xA;DECLARE &#xA;  var_requete TEXT;&#xA;  schemaname TEXT;&#xA;  table_schema record;&#xA;  schema_check boolean DEFAULT FALSE;&#xA;  where_clause TEXT;&#xA;&#xA;BEGIN&#xA;  &#xA;  -- Nettoyage du nom d&#39;objet&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  &#xA;&#xA;&#xA;  -- L&#39;analyse porte-elle sur un schÃ©ma ?&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      TRUE&#xA;    FROM &#xA;      information_schema.schemata&#xA;    WHERE &#xA;      schema_name = $a$ || quote_literal(relname)&#xA;  ;&#xA;&#xA;  EXECUTE &#xA;    var_requete&#xA;  INTO &#xA;    schema_check&#xA;  ;&#xA;  &#xA;&#xA;  &#xA;  -- Action selon si schema/table&#xA;  IF schema_check THEN&#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for schema&#39;;&#xA;    &#xA;    -- Clause de rÃ©cupÃ©ration des donnÃ©es d&#39;un schÃ©ma&#xA;    where_clause := &#xA;      $a$pgc.relnamespace = $a$ || quote_literal(relname) || $a$::regnamespace $a$&#xA;    ;&#xA;  &#xA;    -- Boucle sur toutes les tables d&#39;un schema&#xA;    var_requete := &#xA;      $a$SELECT&#xA;        pgc.relname::TEXT AS &#34;table&#34;&#xA;      FROM&#xA;        pg_class AS pgc&#xA;      WHERE &#xA;        $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;  &#xA;    FOR table_schema IN EXECUTE var_requete&#xA;        &#xA;    LOOP&#xA;      &#xA;      var_requete := &#xA;        $a$ANALYZE $a$ || quote_ident(relname) || &#39;.&#39; || quote_ident(table_schema.&#34;table&#34;)&#xA;      ;&#xA;      &#xA;      --RAISE NOTICE USING MESSAGE = var_requete;&#xA;&#xA;        -- Analyse de la table&#xA;      EXECUTE &#xA;        var_requete&#xA;      ;&#xA;      &#xA;      &#xA;    END LOOP;&#xA;    &#xA;  &#xA;  ELSE &#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for table&#39;;&#xA;  &#xA;    -- Quotation du schema.table&#xA;    relname := &#xA;      quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;      &#39;.&#39; || &#xA;      quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;    ;&#xA;  &#xA;    -- Clause de rÃ©cuÃ©pration d&#39;une table&#xA;    where_clause :=&#xA;      $a$pgc.oid = $a$ || quote_literal(relname) || $a$::regclass $a$&#xA;    ;&#xA;&#xA;    -- Analyse de la table&#xA;    EXECUTE &#xA;      $a$ANALYZE $a$ || relname&#xA;    ;&#xA;  &#xA;  END IF;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      pgc.relnamespace::regnamespace::text AS &#34;schema&#34;,&#xA;      pgc.relname::text AS &#34;table&#34;,&#xA;      COALESCE (pgt.spcname, &#39;pg_default&#39;)::TEXT AS &#34;tablespace&#34;,&#xA;      pgc.oid AS oid_table,&#xA;      pg_relation_filenode(pgc.oid) AS numero_heap_file,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgc.oid) AS &#34;heap_file_segment_0_location&#34;,&#xA;      pgc.relpages::int AS nb_page,&#xA;      pst.tuple_count::bigint,&#xA;      pst.dead_tuple_count::bigint,&#xA;      pst.table_len::bigint AS table_length,&#xA;      pg_size_pretty(pst.table_len) AS table_length_human,&#xA;      pst.tuple_len::bigint AS tuple_length,&#xA;      pst.tuple_percent::numeric,&#xA;      pst.dead_tuple_len::bigint AS dead_tuple_length,&#xA;      pst.dead_tuple_percent::numeric,&#xA;      pst.free_space::bigint AS free_space_length,&#xA;      pst.free_percent::NUMERIC AS free_space_percent,&#xA;      pgc.relfrozenxid AS max_frozen_txid,&#xA;      psut.n_tup_ins::bigint,&#xA;      psut.n_tup_upd::bigint,&#xA;      psut.n_tup_del::bigint,&#xA;      psut.n_mod_since_analyze::bigint,&#xA;      psut.last_vacuum, &#xA;      psut.last_autovacuum, &#xA;      psut.last_analyze,&#xA;      psut.last_autoanalyze,&#xA;      pgc.reltoastrelid AS toast_oid,&#xA;      pgct.relname::text AS toast_table,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgct.oid) AS &#34;toast_heap_file_segment_0_location&#34;,&#xA;      pgct.relpages::int AS toast_nb_page,&#xA;      pgct.reltuples::int AS toast_nb_tuple,&#xA;      pg_relation_size(pgc.reltoastrelid)::bigint AS toast_length,&#xA;      pg_size_pretty(pg_relation_size(pgc.reltoastrelid))::text AS toast_length_human&#xA;    FROM &#xA;      pg_class AS pgc&#xA;    LEFT JOIN &#xA;      pg_tablespace AS pgt &#xA;      ON pgt.oid = pgc.reltablespace &#xA;    LEFT JOIN &#xA;      pg_class AS pgct &#xA;      ON pgct.oid = pgc.reltoastrelid&#xA;    LEFT JOIN&#xA;      pg_stat_user_tables AS psut&#xA;      ON psut.relid = pgc.oid&#xA;    LEFT JOIN LATERAL&#xA;      pgstattuple(pgc.oid::regclass::text) AS pst&#xA;      ON TRUE&#xA;    WHERE &#xA;      $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;    &#xA;    RETURN QUERY EXECUTE &#xA;      var_requete&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;heap_page_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_heap_page_info(relname TEXT, page_number INT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_heap_page_info(relname TEXT, page_number INT DEFAULT -1)&#xA;RETURNS TABLE(&#xA;  page_num int,&#xA;  lsn pg_lsn, &#xA;  nb_pointer int,&#xA;  nb_tuple int,&#xA;  nb_tuple_visible int,&#xA;  length_header int,&#xA;  length_pointer int,&#xA;  length_free_space int,&#xA;  length_tuple int,&#xA;  length_meta int,&#xA;  length_data int,&#xA;  length_empty int,&#xA;  length_special int,&#xA;  offset_pointer int,&#xA;  offset_free_space int,&#xA;  offset_data int,&#xA;  offset_special int,&#xA;  offset_page_end int,&#xA;  unused_line_pointer bool,&#xA;  no_free_space bool,&#xA;  all_visible bool&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION heap_page_info(relname TEXT, page_number INT)&#xA; * Renvoi diffÃ©rentes informations sur les pages d&#39;une table&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : table Ã  analyser prÃ©fixÃ©e par son schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; *  page_number INT : (facultatif) numÃ©ro de page Ã  analyser.&#xA; *    Sans ce paramÃ¨tre, toutes les pages sont remontÃ©es&#xA; * &#xA; */&#xA;BEGIN&#xA;  -- Quotation du schema.table&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  relname := &#xA;    quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;    &#39;.&#39; || &#xA;    quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;  ;&#xA;  &#xA;  &#xA;  -- Analyse de la table&#xA;  EXECUTE &#xA;    $a$ANALYZE $a$ || relname ;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  RETURN QUERY EXECUTE &#xA;    $a$SELECT&#xA;      pages.page_num,&#xA;      -- Identifiant xlog de la derniÃ¨re opÃ©ration effectuÃ©e sur la page.&#xA;      ph.lsn,&#xA;      tm.count_pointer::int AS nb_pointer,&#xA;      tm.count_tuple::int AS nb_tuple,&#xA;      tm.count_tuple_visible::int AS nb_tuple_visible,&#xA;      24::int AS length_header,&#xA;      (ph.lower - 24)::int AS length_pointer,&#xA;      (ph.upper - ph.lower)::int AS length_free_space,&#xA;      (ph.special - ph.upper)::int AS length_tuple,&#xA;      (tm.length_meta)::int,&#xA;      (tm.length_data)::int,&#xA;      (tm.length_empty)::int,&#xA;      (ph.pagesize - ph.special)::int AS length_special,&#xA;      24::int AS offset_pointer,&#xA;      (ph.lower)::int AS offset_free_space,&#xA;      (ph.upper)::int AS offset_data,&#xA;      (ph.special)::int AS offset_special,&#xA;      (ph.pagesize)::int AS offset_page_end,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0001&#39;) = (x&#39;0001&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS unused_line_pointer,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0002&#39;) = (x&#39;0002&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS no_free_space,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0004&#39;) = (x&#39;0004&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS all_visible&#xA;    FROM &#xA;      pg_catalog.pg_class AS pgc&#xA;    LEFT JOIN LATERAL &#xA;        generate_series(0, pgc.relpages - 1) AS pages(page_num)&#xA;        ON TRUE&#xA;    LEFT JOIN LATERAL&#xA;        page_header(&#xA;          get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;        ) AS ph&#xA;        ON TRUE&#xA;    LEFT JOIN LATERAL (&#xA;        SELECT&#xA;          -- Nombre de pointeur&#xA;          count(1) AS count_pointer,&#xA;          -- Nombre de tuples&#xA;          count(&#xA;            CASE &#xA;              WHEN hpi.lp_len &gt; 0 THEN 1&#xA;            END&#xA;          ) AS count_tuple,&#xA;          -- Nombre de tuples visibles&#xA;          count(&#xA;            CASE &#xA;              WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39;)  &#xA;              OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0800&#39;)&#xA;              OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0200&#39; | x&#39;0800&#39;)&#xA;                THEN 1&#xA;            END&#xA;          ) AS count_tuple_visible,&#xA;          -- Longueur des mÃ©tadonnÃ©es&#xA;          sum(hpi.t_hoff::int) AS length_meta,&#xA;          -- Longueur des donnÃ©es&#xA;          sum((hpi.lp_len - hpi.t_hoff)::int) AS length_data,&#xA;          -- Longueur des espaces vides&#xA;          sum(((ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8) - (hpi.lp_off + hpi.lp_len))::int) AS length_empty&#xA;        FROM&#xA;          heap_page_items(&#xA;            get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;          ) AS hpi &#xA;        ) AS tm&#xA;        ON TRUE&#xA;    WHERE &#xA;      pgc.oid = $a$ || quote_literal(relname) || $a$::regclass &#xA;    AND (&#xA;      (&#xA;        $a$ || page_number || $a$ &amp;lt;&gt; -1&#xA;        AND&#xA;        $a$ || page_number || $a$ = pages.page_num&#xA;      )OR &#xA;      $a$ || page_number || $a$ = - 1&#xA;    ) $a$&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;heap_tuple_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les tuples&#xA;DROP FUNCTION IF EXISTS public.get_heap_tuple_info(relname text);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_heap_tuple_info(relname TEXT, page_number INT DEFAULT -1)&#xA;RETURNS TABLE(&#xA;  ctid tid, &#xA;  page_num int,&#xA;  page_index int, &#xA;  offset_start int,&#xA;  offset_end int,&#xA;  offset_next int,&#xA;  length_tuple int,&#xA;  length_meta int,&#xA;  length_data int,&#xA;  length_empty int,&#xA;  xmin text, &#xA;  xmax text, &#xA;  state text,&#xA;  visible bool,&#xA;  &#34;update&#34; bool,&#xA;  direction text,&#xA;  hot bool,&#xA;  &#34;delete&#34; bool, &#xA;  &#34;freeze&#34; bool,&#xA;  info text[]&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION heap_tuple_info(relname TEXT, page_number INT)&#xA; * Renvoi diffÃ©rentes informations sur les tuples prÃ©sents dans les pages d&#39;une table&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : table Ã  analyser prÃ©fixÃ©e par son schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; *  page_number INT : (facultatif) numÃ©ro de page Ã  analyser.&#xA; *    Sans ce paramÃ¨tre, tous les tuples de toutes les pages sont remontÃ©s&#xA; * &#xA; */&#xA;BEGIN&#xA;  -- Quotation du schema.table&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  relname := &#xA;    quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;    &#39;.&#39; || &#xA;    quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;  ;&#xA;  &#xA;  -- Analyse de la table&#xA;  EXECUTE &#xA;    $a$ANALYZE $a$ || relname ;&#xA;  &#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  RETURN QUERY EXECUTE &#xA;    $a$SELECT&#xA;      -- Indentifiant du tuple&#xA;      hpi.t_ctid AS ctid,&#xA;      -- NumÃ©ro de page&#xA;      pages.page_num,&#xA;      -- Index dans la page&#xA;      hpi.lp::int AS page_index,&#xA;      -- DÃ©but du tuple dans la page&#xA;      hpi.lp_off::int AS offset_start,&#xA;      -- Fin du tuple dans la page&#xA;      (hpi.lp_off + hpi.lp_len)::int AS offset_end,&#xA;      -- DÃ©but du tuple suivant dans la page&#xA;      (ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8)::int AS offset_next,&#xA;      -- Longueur du tuple&#xA;      hpi.lp_len::int AS length_tuple,&#xA;      -- Longueur des mÃ©tadonnÃ©es&#xA;      hpi.t_hoff::int AS length_meta,&#xA;      -- Longueur des donnÃ©es&#xA;      (hpi.lp_len - hpi.t_hoff)::int AS length_data,&#xA;      -- Longueur de l&#39;espacement avant le tuple suivant&#xA;      ((ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8) - (hpi.lp_off + hpi.lp_len))::int AS length_empty,&#xA;      -- ID de transaction de dÃ©but de vie&#xA;      --    c : transaction commitÃ©e&#xA;      --    a : transaction annulÃ©e&#xA;      concat(&#xA;        hpi.t_xmin,&#xA;        CASE &#xA;          WHEN ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) &amp;amp; (x&#39;0100&#39; | x&#39;0200&#39;)) = (x&#39;0100&#39; | x&#39;0200&#39;) THEN &#39; - f&#39;&#xA;          WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0100&#39;) = x&#39;0100&#39; THEN &#39; - c&#39;&#xA;          WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0200&#39;) = x&#39;0200&#39; THEN &#39; - a&#39;&#xA;        END&#xA;      ) AS xmin,&#xA;      -- ID de transaction de fin de vie&#xA;      --    c : transaction commitÃ©e&#xA;      --    a : transaction annulÃ©e&#xA;      NULLIF(&#xA;        concat(&#xA;          hpi.t_xmax,&#xA;          CASE &#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0400&#39;) = x&#39;0400&#39; THEN &#39; - c&#39;&#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0800&#39;) = x&#39;0800&#39; THEN &#39; - a&#39;&#xA;          END&#xA;        ),&#xA;        &#39;0 - a&#39;&#xA;      ) AS xmax,&#xA;      -- Etat de la ligne&#xA;      CASE lp_flags&#xA;        WHEN 0 THEN &#39;unused&#39;&#xA;        WHEN 1 THEN &#39;normal&#39;&#xA;        WHEN 2 THEN &#39;redirect to &#39;||lp_off&#xA;        WHEN 3 THEN &#39;dead&#39;&#xA;      END AS state,&#xA;      -- VisibilitÃ© actuelle du tuple&#xA;      CASE &#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39;)  &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0800&#39;)&#xA;          THEN TRUE&#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0200&#39;) &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0200&#39; | x&#39;0800&#39;)  &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0000&#39;) &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0400&#39;) &#xA;          THEN FALSE&#xA;        ELSE FALSE&#xA;      END AS visible,&#xA;      -- Tuple concernÃ© par un UPDATE&#xA;      CASE &#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;)&#xA;        OR t_infomask IS NULL &#xA;        OR ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;4000&#39;)) = (x&#39;4000&#39;)&#xA;        OR ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0400&#39;) AND NOT (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;))&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS &#34;update&#34;,&#xA;      -- Si concernÃ© par un UPDATE, tuple initial (to) ou final (from)&#xA;      NULLIF(&#xA;        concat_ws(&#xA;          &#39; and &#39;,&#xA;          CASE &#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;)&#xA;              THEN &#39;from&#39;&#xA;          END,&#xA;          CASE &#xA;            WHEN t_infomask IS NULL &#xA;            OR ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;4000&#39;)) = (x&#39;4000&#39;)&#xA;              THEN &#39;to&#39;&#xA;          END&#xA;        ),&#xA;        &#39;&#39;&#xA;      ) || &#39; another line&#39; AS direction,&#xA;      -- Tuple hot updated &#xA;      --    le tuple actuel et son ancienne version sont sur la mÃªme page&#xA;      CASE &#xA;        WHEN (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;4000&#39;)&#xA;        OR (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;8000&#39;)&#xA;        OR (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;4000&#39; | x&#39;8000&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS hot,&#xA;      -- Tuple supprimÃ© (ou attribut clÃ© mis Ã  jour)&#xA;      CASE &#xA;        WHEN ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;2000&#39;)) = (x&#39;2000&#39;)&#xA;          THEN TRUE &#xA;        ELSE FALSE&#xA;      END AS &#34;delete&#34;,&#xA;      -- Identifiant de transaction xmin gelÃ©&#xA;      CASE &#xA;        WHEN ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) &amp;amp; (x&#39;0100&#39; | x&#39;0200&#39;)) = (x&#39;0100&#39; | x&#39;0200&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE &#xA;      END AS &#34;freeze&#34;,&#xA;      -- Drapeaux d&#39;information&#xA;      ARRAY(&#xA;        SELECT&#xA;          array_to_string(&#xA;            regexp_matches(&#xA;              heap_tuple_infomask_flags(t_infomask, t_infomask2)::TEXT,&#xA;              &#39;[A-Za-z0-9_\-]+&#39;,&#xA;              &#39;g&#39;&#xA;            ),&#xA;            &#39;&#39;&#xA;          )&#xA;      )::text[] AS info&#xA;    FROM &#xA;      pg_catalog.pg_class AS pgc,&#xA;      LATERAL &#xA;        generate_series(0, pgc.relpages - 1) AS pages(page_num),&#xA;      LATERAL&#xA;        heap_page_items(&#xA;          get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;        ) AS hpi&#xA;    WHERE &#xA;      pgc.oid = $a$ || quote_literal(relname) || $a$::regclass &#xA;    AND (&#xA;      (&#xA;        $a$ || page_number || $a$ &amp;lt;&gt; -1&#xA;        AND&#xA;        $a$ || page_number || $a$ = pages.page_num&#xA;      )OR &#xA;      $a$ || page_number || $a$ = - 1&#xA;    ) $a$&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Stockage physique&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CÃ´tÃ© base, les donnÃ©es sont structurÃ©es de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Base de donnÃ©es&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;SchÃ©ma&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Table&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Ligne&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Attribut&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Mais dans le systÃ¨me de fichiers, les donnÃ©es sont structurÃ©es diffÃ©remment :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un rÃ©pertoire racine par tablespace.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un rÃ©pertoire par base de donnÃ©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des fichiers spÃ©cifiques pour chaque table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Tablespace&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le lien entre les donnÃ©es et le systÃ¨me de fichier se matÃ©rialise en base via le tablespace. Cet objet permet aux administrateurs de dÃ©finir l&amp;#8217;emplacement des donnÃ©es. Par dÃ©faut deux tablespaces existent et pointent vers le rÃ©pertoire &lt;code&gt;$PGDATA/base&lt;/code&gt; du rÃ©pertoire (sur Windows, il s&amp;rsquo;agit par dÃ©faut de Â«Â C:\Program Files\PostgreSQL\16\data\baseÂ Â»). Il s&amp;rsquo;se nomment :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_default&lt;/code&gt; : emplacement de stockage par dÃ©faut.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_global&lt;/code&gt; : emplacement de stockage des objets contenant le &lt;a href=&#34;https://www.postgresql.org/docs/current/catalogs.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;catalogue systÃ¨me&lt;/a&gt; (donnÃ©es sur le cluster).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible crÃ©er un nouveau tablespace pour stocker des donnÃ©es sur un stockage spÃ©cifique (un disque dur plus rapide par exemple) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLESPACE pgraster_data&#xA;&#x9;OWNER postgres&#xA;&#x9;LOCATION &#39;C:\mon_repertoire\de_stockage&#39;&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un tablespace est liÃ© Ã  une instance PostgreSQL et ne peut pas Ãªtre ouvert par une instance autre que celle qui l&amp;rsquo;a crÃ©Ã©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un tablespace non trouvable (dÃ©faillance du disque dur, dÃ©placement&amp;#8230;) peut empÃªcher le dÃ©marrage de l&amp;rsquo;instance PostgreSQL.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;un tablespace peut Ãªtre utilisÃ© par n&amp;rsquo;importe qu&amp;rsquo;elle base de donnÃ©e de l&amp;rsquo;instance Ã  laquelle il appartient.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;un tablespace ne peut Ãªtre supprimÃ© tant qu&amp;rsquo;un objet est stockÃ© dedans.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque vous crÃ©ez un tablespace, un lien symbolique est crÃ©Ã© dans le rÃ©pertoire &lt;code&gt;$PGDATE/pg_tblspc&lt;/code&gt; et pointe vers le rÃ©pertoire dÃ©finit pour stocker les donnÃ©es du tablespace.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez lister les diffÃ©rents tablespaces ainsi que leurs emplacements de stockage grÃ¢ce Ã  la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  pt.spcname AS nom,&#xA;  pa.rolname AS proprietaire,&#xA;  pg_tablespace_location(pt.oid) AS emplacement,&#xA;  pg_size_pretty(pg_tablespace_size(pt.oid)) AS poids&#xA;FROM &#xA;  pg_tablespace AS pt&#xA;LEFT JOIN&#xA;  pg_authid AS pa&#xA;  ON pa.oid = pt.spcowner&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fichiers&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le systÃ¨me de fichier, les donnÃ©es sont stockÃ©es dans le rÃ©pertoire du tablespace et s&amp;rsquo;organise assez simplement : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un rÃ©pertoire par base de donnÃ©es, dont le nom correspond Ã  l&amp;rsquo;OID de la base au sein de l&amp;rsquo;instance PostgreSQL.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un ensemble de fichiers par table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque table il existe un ou plusieurs fichiers dont le nom dÃ©bute toujours par un numÃ©ro nommÃ© &lt;em&gt;filenode&lt;/em&gt; qui correspond souvent Ã  l&amp;rsquo;OID de la table (mais pas toujours, par exemple lorsqu&amp;rsquo;une table est rÃ©Ã©crite, un nouveau fichier est crÃ©Ã© avec un nouveau numÃ©ro ; voir &lt;a href=&#34;#vacuum&#34;&gt;la partir sur les VACUUM&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez trouver les fichiers suivants pour chaque table (exemple pour un filenode = 112233 ) : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le &lt;strong&gt;heap file&lt;/strong&gt; : ensemble de fichiers contenant les donnÃ©es.&lt;br&gt;Chaque fichier du &lt;em&gt;heap file&lt;/em&gt; est appelÃ© segment et ne peut exÃ©der 1 Go, il y a donc un nombre de segments diffÃ©rent selon la taille de la table.&lt;br&gt;Le premier segment est nommÃ© &lt;code&gt;filenode&lt;/code&gt; sans extension (&lt;code&gt;112233&lt;/code&gt; dans notre exemple), le second se voit ajouter l&amp;rsquo;extension Â«Â 1Â Â» (&lt;code&gt;112233.1&lt;/code&gt;), le troisiÃ¨me l&amp;rsquo;extension Â«Â 2Â Â» (&lt;code&gt;11223.2&lt;/code&gt;) et ainsi de suite&amp;#8230;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La &lt;strong&gt;free space map&lt;/strong&gt; : liste l&amp;rsquo;espace disponible dans chaque page.&lt;br&gt;Le fichier est nommÃ©  &lt;code&gt;filenode_fsm&lt;/code&gt; (&lt;code&gt;112233_fsm&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La &lt;strong&gt;visibility map&lt;/strong&gt; : liste indiquant pour chaque page si toutes les lignes sont visibles pour toutes les transactions et si tous les tuples sont gelÃ©s. Cela permet au VACUUM de ne pas avoir Ã  scanner ces pages afin d&amp;rsquo;aller plus vite.&lt;br&gt;Le fichier est nommÃ© &lt;code&gt;filenode_vm&lt;/code&gt; (&lt;code&gt;112233_vm&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;MÃªme si c&amp;rsquo;est trÃ¨s rare, les fichiers fsm et vm peuvent se voir attribuer des extensions Â«Â 1Â Â», Â«Â 2Â Â»&amp;#8230; s&amp;rsquo;ils dÃ©passent 1 Go et que d&amp;rsquo;autres fichiers doivent Ãªtre crÃ©Ã©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un graphique pour vous reprÃ©senter la rÃ©partition des donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_filesystem.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3002&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Exemple d&amp;rsquo;une carte de visibilitÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Only visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Only frozen&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La premiÃ¨re page ne contient que des tuples visibles, en revanche, les pages d&amp;rsquo;aprÃ¨s contiennent des tuples non visibles : il s&amp;rsquo;agit de tuples supprimÃ©s qui sont encore prÃ©sents dans la base et en attente de suppression par le &lt;code&gt;VACUUM&lt;/code&gt;. Ce dernier n&amp;rsquo;a donc pas besoin de travailler sur la premiÃ¨re page pour le nettoyage. Nous allons voir dans le paragraphe suivant ce qu&amp;rsquo;est un tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Page&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour faciliter la gestion des donnÃ©es, leur stockage au sein des segments du &lt;em&gt;heap file&lt;/em&gt; se fait sous la forme de paquets de 8 ko de donnÃ©es (paramÃ©trable mais par dÃ©faut 8 ko). Un paquet de donnÃ©es est appelÃ© &lt;strong&gt;page&lt;/strong&gt; (ou bloc). Un segment peut donc contenir plusieurs pages.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3007&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Les pages sont toujours structurÃ©es de la mÃªme faÃ§on :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;diffÃ©rentes mÃ©tadonnÃ©es sur la page (24 octets).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Les pointeurs :&lt;/strong&gt; il s&amp;rsquo;agit de donnÃ©es contenant l&amp;#8217;emplacement de chaque tuple stockÃ© dans la page (4 octets chacun).&lt;br&gt;Les index rÃ©fÃ©rencent ces pointeurs.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;espace restant disponible dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Les tuples :&lt;/strong&gt; un tuple Ã©quivaut Ã  une ligne dans la table. &lt;br&gt;Il s&amp;rsquo;agit d&amp;rsquo;un ensemble de mÃ©tadonnÃ©es associÃ©es aux valeurs des attributs de la ligne les unes Ã  la suite des autres.&lt;br&gt;Les Ã©lÃ©ments sont positionnÃ©s dans l&amp;rsquo;ordre inverse : du dernier au premier et accolÃ©s Ã  la fin de la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des donnÃ©es spÃ©cifiques (uniquement pour les table d&amp;rsquo;index).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3097&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;La page est considÃ©rÃ©e comme complÃ¨te lorsque l&amp;rsquo;espace disponible vient Ã  manquer : au fur et Ã  mesure du remplissage, les pointeurs rejoignent les tuples et l&amp;rsquo;espace entre les deux devient insuffisant pour stocker un nouvel Ã©lÃ©ment.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que les tuples sont toujours placÃ©s de faÃ§on Ã  Ãªtre alignÃ©s sur des multiples de 8 octets. Ce positionnement entraine la prÃ©sence d&amp;rsquo;espace entre les tuples lorsque ceux-ci ne possÃ¨dent pas une longueur multiple de 8.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Avec une telle structure, vous pouvez donc voir que lorsque PostgreSQL crÃ©Ã© une nouvelle page, celle-ci occupe immÃ©diatement 8 ko, mÃªme si elle est presque vide car il s&amp;rsquo;agit d&amp;rsquo;un conteneur de taille fixe. Ainsi, une base PostgreSQL grossit par multiple de 8 ko.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la lecture des donnÃ©es, il y a deux cas :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le scan sÃ©quentiel : lors d&amp;rsquo;un parcours complet de la table, PostgreSQL lit chaque pointeur ce qui lui permet ensuite d&amp;rsquo;aller lire chaque tuple.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le scan indexÃ© : lors d&amp;rsquo;un parcours via un index, ce dernier contient le numÃ©ro de page ainsi que l&amp;#8217;emplacement du pointeur de chaque donnÃ©e indexÃ©e. &lt;br&gt;PostgreSQL n&amp;rsquo;a plus qu&amp;rsquo;a parcourir les pointeurs pour rÃ©cupÃ©rer la donnÃ©e sans avoir Ã  lire tous les tuples (scan sÃ©quentiel). &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Tuple&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es de toutes les colonnes d&amp;rsquo;une ligne sont stockÃ©es au sein d&amp;rsquo;un tuple (en franÃ§ais Â«Â upletÂ Â»). Pour faire simple, il s&amp;rsquo;agit d&amp;rsquo;une liste de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les tuples sont organisÃ©s de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un en-tÃªte contenant l&amp;rsquo;identifiant du tuple (ctid), des donnÃ©es de visibilitÃ© de transaction (t_xmin et t_xmax) et d&amp;rsquo;autres Ã©lÃ©ments que nous verrons plus tard.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une carte des valeurs &lt;code&gt;NULL&lt;/code&gt; au sein de la ligne. &lt;br&gt;Cette carte n&amp;rsquo;est prÃ©sente que si la ligne contient des valeurs &lt;code&gt;NULL&lt;/code&gt;.&lt;br&gt;Il s&amp;rsquo;agit d&amp;rsquo;une suite de valeurs boolÃ©enne reprÃ©sentant chaque colonne (dans l&amp;rsquo;ordre donc) avec Â«Â 1Â Â» indiquant la prÃ©sence d&amp;rsquo;une valeur &lt;code&gt;NULL&lt;/code&gt;, Â«Â 0Â Â» dans le cas contraire.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les donnÃ©es les unes Ã  la suite des autres.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;en-tÃªte d&amp;rsquo;un tuple mesurant 23 octets, il y a donc 1 octet ajoutÃ© pour l&amp;rsquo;alignement si aucune carte de valeurs &lt;code&gt;NULL&lt;/code&gt; n&amp;rsquo;existe : c&amp;rsquo;est la taille minimum d&amp;rsquo;un tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le placement des donnÃ©es au sein du tuple se fait dans l&amp;rsquo;ordre de dÃ©finition des colonnes en respectant deux rÃ¨gles : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;espace occupÃ© dÃ©pend du type :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;espace peut Ãªtre fixe (smallint, integer, bigint&amp;#8230;)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;espace peut Ãªtre variable et dÃ©pend donc de la donnÃ©e (varchar, text&amp;#8230;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;#8217;emplacement d&amp;rsquo;une donnÃ©e par rapport Ã  la prÃ©cÃ©dente dÃ©pend du type :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;#8217;emplacement peut Ãªtre alignÃ© (smallint, integer, bigint&amp;#8230;) (mÃªme principe que l&amp;rsquo;alignement des tuples dans la page sauf qu&amp;rsquo;ici la longueur est variable).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;#8217;emplacement peut Ãªtre non alignÃ© (boolÃ©en, varchar&amp;#8230;)&lt;br&gt;Si ce type de donnÃ©e est en premiÃ¨re position et qu&amp;rsquo;aucune carte de valeurs NULL n&amp;rsquo;est prÃ©sente, un alignement sur le 24&lt;sup&gt;Ã¨me&lt;/sup&gt; octet est tout de mÃªme rÃ©alisÃ©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques cas de figure pour les types les plus utilisÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;BoolÃ©en :&lt;/strong&gt;&lt;br&gt;Pas d&amp;rsquo;alignement : se place directement aprÃ¨s la donnÃ©e de la colonne prÃ©cÃ©dente.&lt;br&gt;Espace occupÃ© de 1 octet.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Smallint &amp;#8211; int2 :&lt;/strong&gt; &lt;br&gt;Alignement sur un multiple de 2 octets.&lt;br&gt;Espace occupÃ© de 2 octets.&lt;br&gt;Attention Ã  ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occupÃ© qui sont les mÃªmes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Integer &amp;#8211; int4 :&lt;/strong&gt;  &lt;br&gt;Alignement sur un multiple de 4 octets.&lt;br&gt;Espace occupÃ© de 4 octets.&lt;br&gt;Attention Ã  ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occupÃ© qui sont les mÃªmes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Biginteger &amp;#8211; int8 :&lt;/strong&gt;&lt;br&gt;Alignement sur un multiple de 8 octets.&lt;br&gt;Espace occupÃ© de 8 octets.&lt;br&gt;Attention Ã  ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occupÃ© qui sont les mÃªmes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Text, Varchar :&lt;/strong&gt;&lt;br&gt;Alignement variable : aucun alignement en dessous d&amp;rsquo;une certaine taille ; au dela, les donnÃ©es peuvent Ãªtre compressÃ©e et/ou TOASTÃ©es et un header alignÃ© sur un multiple de 4 octets est ajoutÃ©.&lt;br&gt;Espace occupÃ© variable : 1 octet de header plus les donnÃ©es en dessous d&amp;rsquo;une certaine taille ; au dela, 4 octets de header plus les donnÃ©es.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requÃªte permettant de connaitre la taille fixÃ©e pour les types de donnÃ©es (pour les types variables, l&amp;rsquo;alignement se fait pour le header Ã©ventuellement prÃ©sent) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;typname AS type,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typcategory,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typcategory&#xA;&#x9;&#x9;&#x9;WHEN &#39;A&#39; THEN &#39;Array types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;B&#39; THEN &#39;Boolean types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;C&#39; THEN &#39;Composite types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;D&#39; THEN &#39;Date/time types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;E&#39; THEN &#39;Enum types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;G&#39; THEN &#39;Geometric types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;I&#39; THEN &#39;Network address types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;N&#39; THEN &#39;Numeric types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;P&#39; THEN &#39;Pseudo-types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;R&#39; THEN &#39;Range types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;S&#39; THEN &#39;String types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;T&#39; THEN &#39;Timespan types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;U&#39; THEN &#39;User-defined types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;V&#39; THEN &#39;Bit-string types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;X&#39; THEN &#39;unknown type&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;Z&#39; THEN &#39;Internal-use types&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS category,&#xA;&#x9;CASE &#xA;&#x9;&#x9;WHEN typlen = -1 THEN &#39;variable&#39;&#xA;&#x9;&#x9;ELSE typlen::text&#xA;&#x9;END AS longueur,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typalign,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typalign&#xA;&#x9;&#x9;&#x9;WHEN &#39;c&#39; THEN &#39;char alignment, i.e., no alignment needed&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;s&#39; THEN &#39;short alignment (2 bytes on most machines)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;i&#39; THEN &#39;int alignment (4 bytes on most machines)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;d&#39; THEN &#39;double alignment (8 bytes on many machines, but by no means all)&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS alignement,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typstorage,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typstorage&#xA;&#x9;&#x9;&#x9;WHEN &#39;p&#39; THEN &#39;plain: Values must always be stored plain (non-varlena types always use this value)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;e&#39; THEN &#39;external: Values can be stored in a secondary â€œTOASTâ€ relation&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;m&#39; THEN &#39;main: Values can be compressed and stored inline&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;x&#39; THEN &#39;extended: Values can be compressed and/or moved to a secondary relation&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS stockage&#xA;FROM &#xA;&#x9;pg_type&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette valeur d&amp;rsquo;alignement implique donc une potentielle perte d&amp;rsquo;espace entre les valeurs de chaque colonne. Ainsi, l&amp;rsquo;ordre des colonnes a une forte incidence sur le poids d&amp;rsquo;une table. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple concret pour mieux situer le problÃ¨me. Voila deux tables avec les mÃªmes colonnes mais des agencements diffÃ©rents et l&amp;rsquo;impact que cela a :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.test_non_optimise (&#xA;  a int2,&#xA;  b int8,&#xA;  c int2,&#xA;  d int8&#xA;)&#xA;;&#xA;&#xA;INSERT INTO public.test_non_optimise&#xA;VALUES (1, 1, 1, 1)&#xA;;&#xA;&#xA;SELECT &#xA;  pg_column_size(test_non_optimise.*) &#xA;FROM &#xA;  public.test_non_optimise&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne insÃ©rÃ©e pÃ¨se 56 octets que l&amp;rsquo;on peut dÃ©composer ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;position &amp;#8211; longueur : commentaire&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;0  - 23 o&lt;/code&gt; : MÃ©tadonnÃ©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;23 -  1 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;24 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;26 -  6 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;32 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;40 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;42 -  6 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;48 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On note beaucoup d&amp;rsquo;octets d&amp;rsquo;espacement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.test_optimise (&#xA;  b int8,&#xA;  d int8,&#xA;  a int2,&#xA;  c int2&#xA;)&#xA;;&#xA;&#xA;INSERT INTO public.test_optimise &#xA;VALUES (1, 1, 1, 1)&#xA;;&#xA;&#xA;SELECT &#xA;  pg_column_size(test_optimise.*) &#xA;FROM &#xA;  public.test_optimise&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne insÃ©rÃ©e pÃ¨se 44 octets que l&amp;rsquo;on peut dÃ©composer ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;position &amp;#8211; longueur : commentaire&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;0  - 23 o&lt;/code&gt; : MÃ©tadonnÃ©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;23 -  1 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;24 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;32 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;40 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;42 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;optimisation du placement des colonnes permet de gagner 22% d&amp;rsquo;espace disque : c&amp;rsquo;est non nÃ©gligeable sur des tables de grande taille.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Toast&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es d&amp;rsquo;un tuple ne peuvent dÃ©passer une page. Ainsi, pour contourner cette limite avec des donnÃ©es lourdes, un mÃ©canisme spÃ©cifique appelÃ© TOAST est utilisÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;TOAST signifie Â«Â The Oversized-Attribute Storage TechniqueÂ Â» et se dÃ©clenche de faÃ§on automatisÃ©e et totalement transparente pour l&amp;rsquo;utilisateur lorsqu&amp;rsquo;une ligne est trop lourde pour le stockage Â«Â standardÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fonctionnement est le suivant : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Jusquâ€™Ã  2 ko (par dÃ©faut, dÃ©finit via la variable &lt;code&gt;TOAST_TUPLE_THRESHOLD&lt;/code&gt;), un tuple est stockÃ© normalement, directement dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;A partir de 2 ko, le systÃ¨me compresse le tuple, puis deux cas de figures se prÃ©sentent :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le poids du tuple compressÃ© est infÃ©rieur Ã  2 ko (par dÃ©faut, dÃ©finit via la variable &lt;code&gt;TOAST_TUPLE_TARGET&lt;/code&gt;), alors ce dernier est stockÃ© compressÃ© dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le poids du tuple compressÃ© est supÃ©rieur Ã  2 ko, alors le systÃ¨me transfert les donnÃ©es colonne par colonne dans une table annexe appelÃ©e table TOAST.&lt;br&gt;Le transfert commence par les colonnes les plus lourdes et s&amp;rsquo;arrÃªte lorsque les colonnes restantes peuvent Ãªtre stockÃ©es dans la page (lorsqu&amp;rsquo;il reste moins de 2 ko).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_toast_diagram-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3183&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Les tables TOAST sont stockÃ©es dans le schÃ©ma systÃ¨me &lt;code&gt;pg_toast&lt;/code&gt; et sont nommÃ©es d&amp;rsquo;aprÃ¨s l&amp;rsquo;OID de la table d&amp;rsquo;origine sous la forme &lt;code&gt;pg_toast_oidorigine&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il s&amp;rsquo;agit de tables standards (et donc qui peuvent Ãªtre lues via un simple &lt;code&gt;SELECT&lt;/code&gt;) Ã  la structure suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;chunk_id&lt;/code&gt; : identifiant de bloc (permettant la correspondance avec un tuple spÃ©cifique de la table source).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;chunk_seq&lt;/code&gt; : numÃ©ro d&amp;rsquo;ordre du bloc (une donnÃ©e importante peut Ãªtre dÃ©coupÃ©e en plusieurs blocs qu&amp;rsquo;il faut pouvoir ordonnancer).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;chunk_data&lt;/code&gt; : donnÃ©e au format binaire.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es y sont stockÃ©es Ã  raison d&amp;rsquo;un bloc par ligne, chaque bloc Ã©tant un morceau de 2 ko (par dÃ©faut, dÃ©finit via la variable &lt;code&gt;TOAST_MAX_CHUNK_SIZE&lt;/code&gt;) de la donnÃ©e d&amp;rsquo;origine qui a donc Ã©tÃ© dÃ©coupÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette division permet de rÃ©partir le poids des donnÃ©es et de les stocker de faÃ§on classique (dans un &lt;em&gt;heap file&lt;/em&gt;), sans dÃ©passer la taille limite dâ€™une page. Voici un exemple schÃ©matisÃ© du contenu de deux pages d&amp;rsquo;une table TOAST :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_toast_page.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3186&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Notez que lorsque vous requÃªtez une table, la rÃ©cupÃ©ration des donnÃ©es TOASTÃ©es possÃ¨de un certain coÃ»t car PostgreSQL doit lire la table TOAST, rÃ©cupÃ©rer les morceaux de donnÃ©es, les assembler puis retourner la donnÃ©es consolidÃ©e. C&amp;rsquo;est une des raisons pour lesquelles le sÃ©lecteur &lt;code&gt;*&lt;/code&gt; est souvent dÃ©conseillÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre point, depuis PostgreSQL 14, vous pouvez choisir l&amp;rsquo;algorithme de compression via la variable &lt;code&gt;default_toast_compression&lt;/code&gt; qui permet de choisir entre &lt;em&gt;pglz&lt;/em&gt; (format compression par dÃ©faut) et &lt;em&gt;lz4 (nouveau format jusquâ€™Ã &lt;/em&gt; 80% plus rapide pour un taux de compression similaire).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Quelques requÃªtes&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques requÃªtes pour rÃ©cupÃ©rer des informations sur vos tables et mieux apprÃ©hender la structure des pages.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par crÃ©er une table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant rÃ©cupÃ©rer quelques donnÃ©es grÃ¢ce Ã  la premiÃ¨re fonction &lt;code&gt;get_table_info()&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats (tronquÃ©, je n&amp;rsquo;ai pas mis toutes les colonnes) avec en gras les valeurs qui mâ€™intÃ©ressent :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;schema&lt;/td&gt;&lt;td&gt;public&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table&lt;/td&gt;&lt;td&gt;table_test&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tablespace&lt;/td&gt;&lt;td&gt;pg_default&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;oid_table&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;numero_heap_file&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;Le numÃ©ro du fichier peut Ãªtre diffÃ©rent de l&amp;rsquo;oid de la table&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;heap_file_segment_0_location&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;C:/&amp;#8230;/PG16-data/base/246510/350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;nb_page&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table vient d&amp;rsquo;Ãªtre crÃ©Ã©e et ne contient aucune donnÃ©e donc aucune page n&amp;rsquo;a Ã©tÃ© crÃ©Ã©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;tuple_count&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;Aucune donnÃ©es.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;table_length&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table venant d&amp;rsquo;Ãªtre crÃ©Ã©e, elle ne pÃ¨se encore rien&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;table_length_human&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0 bytes&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;dead_tuple_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;free_space_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;toast_oid&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350937&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table TOAST est dÃ©jÃ  crÃ©Ã©e dans le SGBD bien qu&amp;rsquo;il n&amp;rsquo;y ait pas encore eu besoin du systÃ¨me TOAST..&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;toast_table&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;pg_toast_350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_heap_file_segment_0_location&lt;/td&gt;&lt;td&gt;C:/&amp;#8230;/PG16-data/base/246510/350937&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_nb_page&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_nb_tuple&lt;/td&gt;&lt;td&gt;-1&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_length_human&lt;/td&gt;&lt;td&gt;0 bytes&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez une ligne de donnÃ©es puis recalculez les statistiques :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Insertion de la donnÃ©e&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats (tronquÃ©s) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;nb_page&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;Une page a Ã©tÃ© crÃ©Ã©e&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_count&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table_length_human&lt;/td&gt;&lt;td&gt;8192 bytes&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_length&lt;/td&gt;&lt;td&gt;2113&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;free_space_length&lt;/td&gt;&lt;td&gt;6036&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est intÃ©ressant de constater que les donnÃ©es pÃ¨sent 2113 octets (tuple_length) et que la page pÃ¨se 8,192 ko. En effet, les pages font toujours la mÃªme taille.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir qu&amp;rsquo;il reste 6036 octets d&amp;rsquo;espace disponible dans la page avant la crÃ©ation d&amp;rsquo;une seconde.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez maintenant un peu plus en dÃ©tail le stockage des donnÃ©es grÃ¢ce Ã  cette seconde fonction &lt;code&gt;get_heap_page_info()&lt;/code&gt; qui remonte des statistiques sur le contenu des pages d&amp;rsquo;une table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;page_num&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;NumÃ©ro de page&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;lsn&lt;/td&gt;&lt;td&gt;4/1D111198&lt;/td&gt;&lt;td&gt;Identifiant xlog de la derniÃ¨re opÃ©ration effectuÃ©e sur la page.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_pointer&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_tuple&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de tuple.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_tuple_visible&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_header&lt;/td&gt;&lt;td&gt;24&lt;/td&gt;&lt;td&gt;Taille des mÃ©tadonnÃ©es de la page.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_pointer&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;td&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_free_space&lt;/td&gt;&lt;td&gt;6036&lt;/td&gt;&lt;td&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_tuple&lt;/td&gt;&lt;td&gt;2120&lt;/td&gt;&lt;td&gt;Taille occupÃ©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_meta&lt;/td&gt;&lt;td&gt;48&lt;/td&gt;&lt;td&gt;Taille des mÃ©tadonnÃ©es des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_data&lt;/td&gt;&lt;td&gt;2065&lt;/td&gt;&lt;td&gt;Taille des donnÃ©es des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_empty&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;td&gt;Taille des espaces laissÃ©s par l&amp;rsquo;alignement des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_special&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;Taille des donnÃ©es spÃ©cifiques.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_pointer&lt;/td&gt;&lt;td&gt;24&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but des pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_free_space&lt;/td&gt;&lt;td&gt;32&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but de l&amp;rsquo;espace disponible.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_data&lt;/td&gt;&lt;td&gt;6072&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but des donnÃ©es.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_special&lt;/td&gt;&lt;td&gt;8192&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but des donnÃ©es spÃ©cifique.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_page_end&lt;/td&gt;&lt;td&gt;8192&lt;/td&gt;&lt;td&gt;Positionnement de la fin de la page.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un schÃ©ma de l&amp;rsquo;Ã©tat actuel de la page, vous remarquerez qu&amp;rsquo;il n&amp;rsquo;y a pas de bloc spÃ©cifique car il s&amp;rsquo;agit d&amp;rsquo;une table classique et non pas d&amp;rsquo;une table d&amp;rsquo;index :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_test-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3099&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Bon nous voyons dÃ©jÃ  pas mal de chose mais nous ne savons pas comment se rÃ©partissent les tuples, leurs mÃ©tadonnÃ©es ainsi que les espaces vides. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Allez donc un peu plus loin (puisque vous Ãªtes lÃ  pour Ã§a), grÃ¢ce Ã  une troisiÃ¨me fonction &lt;code&gt;get_heap_tuple_info()&lt;/code&gt; qui permet de rÃ©cupÃ©rer toutes les informations disponibles sur les tuples prÃ©sents dans la page.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats (attention, j&amp;rsquo;ai plusieurs lignes donc mon tableau est maintenant dans l&amp;rsquo;autre sens).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_end&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_next&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_meta&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_data&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_empty&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position de la fin du tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position du dÃ©but du tuple prÃ©cÃ©dent.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur des mÃ©tadonnÃ©es du tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur des donnÃ©es en elle-mÃªme&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Espace vide&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8192&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2002&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1978&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6183&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;111&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;87&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la reprÃ©sentation exacte de la page (avec en jaune l&amp;rsquo;espace perdu Ã  cause de l&amp;rsquo;alignement) :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_test_accurate-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3101&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que le premier tuple possÃ¨de un peu moins de 2000 octets de donnÃ©es : c&amp;rsquo;est Ã  cause du champ &lt;code&gt;commentaire_2&lt;/code&gt;. En effet, le type de donnÃ©es &lt;code&gt;char(2000)&lt;/code&gt; limite les donnÃ©es Ã  2000 caractÃ¨res maximum. Cependant, ce type de donnÃ©es est en fait le type &lt;code&gt;bpchar(2000)&lt;/code&gt; comme &lt;em&gt;blank padded caractÃ¨re&lt;/em&gt; : PostgreSQL ajoute des espaces au texte jusquâ€™Ã  ce qu&amp;rsquo;il atteigne 2000 caractÃ¨res ce qui force la ligne Ã  prendre plus de place que nÃ©cessaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre Ã©lÃ©ment, le second tuple ne possÃ¨de que 87 octets de donnÃ©es. C&amp;rsquo;est Ã  cause du systÃ¨me TOAST qui s&amp;rsquo;est dÃ©clenchÃ© car les donnÃ©es pesaient plus que 2 ko, elles ont donc Ã©tÃ© compressÃ©es. Comme le rÃ©sultat pÃ¨se moins de 2 ko, aucune colonne n&amp;rsquo;a Ã©tÃ© transfÃ©rÃ©e dans la table TOAST.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez Ã©galement que les pointeurs renseignent sur l&amp;#8217;emplacement des tuples.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez encore des donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_end&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position de la fin du tuple.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6183&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6066&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2056&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4058&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;48&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2050&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une page supplÃ©mentaire a Ã©tÃ© crÃ©Ã©e, la table pÃ¨se maintenant 2 x 8 ko : 16 ko (vous pouvez le vÃ©rifier avec &lt;code&gt;get_table_info()&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Gestion des donnÃ©es&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Colonnes systÃ¨me&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Des colonnes systÃ¨me sont prÃ©sentes dans chacune des tables. Il suffit de les spÃ©cifier dans vos requÃªtes pour y accÃ©der, les voici :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;tableoid&lt;/code&gt; : l&amp;rsquo;OID de la table, utilisez &lt;code&gt;tableoid::regclass&lt;/code&gt; pour obtenir le nom de la table.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;ctid&lt;/code&gt; : emplacement physique de la ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;xmin&lt;/code&gt; : identifiant de la transaction d&amp;rsquo;insertion.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;cmin&lt;/code&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/ddl-system-columns.html#DDL-SYSTEM-COLUMNS-CMIN&#34;&gt;&lt;/a&gt; : identifiant de commande au sein de la transaction d&amp;rsquo;insertion.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;xmax&lt;/code&gt; : identifiant de la transaction de supression.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;cmax&lt;/code&gt; : identifiant de commande au sein de la transaction de suppression.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple avec notre table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  tableoid::regclass,&#xA;  tableoid,&#xA;  ctid,&#xA;  xmin,&#xA;  xmax,&#xA;  *&#xA;FROM &#xA;  public.table_test&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;tableoid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;tableoid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;commentaire_1&lt;/th&gt;&lt;th&gt;commentaire_2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td&gt;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;E&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;F&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si besoin, n&amp;rsquo;hÃ©sitez pas Ã  utiliser cette requÃªte pour voir Ã  quelles lignes correspondent les tuples que nous allons analyser.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fonctionnement&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Maintenant que nous connaissons un peu mieux la faÃ§on dont les donnÃ©es sont stockÃ©es physiquement, regardons comment les mouvements sont gÃ©rÃ©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans une base PostgreSQL, l&amp;rsquo;accÃ¨s aux donnÃ©es peut se faire de faÃ§on concurrentielle (en mÃªme temps) depuis diffÃ©rents clients. Il faut donc gÃ©rer correctement l&amp;rsquo;ordonnancement des transactions. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, il existe le MVCC : Multiversion Concurrency Control ou contrÃ´le d&amp;rsquo;accÃ¨s simultanÃ©, il s&amp;rsquo;agit d&amp;rsquo;un systÃ¨me permettant la conservation des diffÃ©rents Ã©tats de la donnÃ©e afin de permettre Ã  chaque transaction de travailler sur un instantanÃ© de la base. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fonctionnement repose sur le principe suivant : chaque transaction possÃ¨de un identifiant unique et incrÃ©mentale, lorsqu&amp;rsquo;elle effectue une opÃ©ration, les lignes modifiÃ©es se voient attribuer son identifiant ce qui permet de ressituer l&amp;rsquo;Ã©tat des donnÃ©es par rapport Ã  toute autre transaction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Horaire&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 1&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h00&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but UPDATE sur la table X&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but INSERT sur la table Y&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h06&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin INSERT sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h08&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin UPDATE sur la table X&lt;br&gt;DÃ©but UPDATE sur la table Y&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin UPDATE sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque la transaction 1 effectue sa seconde opÃ©ration, l&amp;rsquo;Ã©tat des donnÃ©es doit Ãªtre celui qui existait lors du dÃ©marrage de la transaction. Cependant, pour Ã©viter de bloquer tous les utilisateurs, PostgreSQL a dÃ©jÃ  effectuÃ© l&amp;rsquo;INSERT de la transaction 2. Ainsi, pour conserver l&amp;rsquo;isolation de chaque transaction, une version de la table telle qu&amp;rsquo;elle Ã©tait lors de dÃ©marrage de la transaction 1 existe toujours aprÃ¨s la finalisation de la transaction 2, le temps que la transaction 1 puisse se terminer.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que si la transaction 2 avait effectuÃ© une opÃ©ration modifiant des donnÃ©es de la table Y concernÃ©es par la transaction 1, PostgreSQL aurait attendu la fin de la transaction grÃ¢ce Ã  un systÃ¨me de verrous placÃ©s sur les lignes concernÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que selon le niveau d&amp;rsquo;isolation, il est possible pour une transaction de Â«Â voirÂ Â» les lignes modifiÃ©es par d&amp;rsquo;autres transactions. Il s&amp;rsquo;agit du rÃ©glage de la variable &lt;code&gt;default_transaction_isolation&lt;/code&gt; qui peut prendre l&amp;rsquo;une des valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;READ COMMITTED&lt;/code&gt; : une requÃªte n&amp;rsquo;a accÃ¨s qu&amp;rsquo;aux lignes commitÃ©es avant qu&amp;rsquo;elle ne commence, c&amp;rsquo;est donc le dÃ©marrage de la requÃªte qui fait foi. &lt;br&gt;Ainsi, les derniÃ¨res requÃªtes d&amp;rsquo;une transaction peuvent opÃ©rer sur des donnÃ©es ayant Ã©tÃ© modifiÃ©es par d&amp;rsquo;autres transactions par rapport aux premiÃ¨res requÃªtes.&lt;br&gt;Il s&amp;rsquo;agit de la valeur par dÃ©faut.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;REPEATABLE READ&lt;/code&gt; : une transaction ne peut voir que les lignes commitÃ©es avant que la premiÃ¨re requÃªte de la transaction ne soit exÃ©cutÃ©e.&lt;br&gt;Deux transactions concurrentes peuvent modifier des donnÃ©es diffÃ©rentes mais appartenant Ã  la mÃªme table ce qui peut conduire Ã  des donnÃ©es inconsistantes (car calculÃ©es sur une base qui n&amp;rsquo;existe plus par exemple).&lt;br&gt;En revanche, si une seconde transaction modifie les mÃªmes donnÃ©es que la premiÃ¨re, une erreur &lt;code&gt;serialization_failure&lt;/code&gt; est remontÃ©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;SERIALIZABLE&lt;/code&gt; : une transaction ne peut voir que les lignes commitÃ©es avant que la premiÃ¨re requÃªte de la transaction ne soit exÃ©cutÃ©e. &lt;br&gt;Si deux transactions concurrentes modifient les mÃªmes donnÃ©es, la premiÃ¨re transaction Ã  commiter Â«Â gagneÂ Â» et la seconde est annulÃ©e (&lt;code&gt;ROLLBACK&lt;/code&gt;) et une erreur &lt;code&gt;serialization_failure&lt;/code&gt; est remontÃ©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Mais comment cela fonctionne en dÃ©tail ? Pour voir cela, nous allons devoir utiliser un exemple concret.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;INSERT &amp;#8211; UPDATE &amp;#8211; DELETE&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour dÃ©marrer nos test, nous allons repartir de la table prÃ©cÃ©dente (disponible dans l&amp;rsquo;onglet Â«Â initialisationÂ Â»).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;DÃ©marrez une transaction et affichez son identifiant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW gestion_data_insert_delete_udpate&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;txid_current()&#34; data-enlighter-group=&#34;gestion_data_insert_delete_udpate&#34;&gt;BEGIN;&#xA;&#xA;SELECT txid_current();&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;gestion_data_insert_delete_udpate&#34;&gt;-- !!!&#xA;-- Attention Ã  bien exÃ©cuter chaque requÃªte dans une transaction spÃ©cifique&#xA;-- Ce que permet le COMMIT Ã  la suite de chaque requÃªte si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- CrÃ©ation d&#39;une table de test&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ma transaction porte le numÃ©ro d&amp;rsquo;identifiant &lt;strong&gt;4440&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Modifiez des donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Mise Ã  jour de la ligne 3&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Validez la transaction :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Tant qu&amp;rsquo;a faire, faites la suppression suivante suivit d&amp;rsquo;une insertion :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez les donnÃ©es : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4442 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4440 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;br&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous dÃ©couvrez les colonnes &lt;code&gt;xmin&lt;/code&gt; et &lt;code&gt;xmax&lt;/code&gt; qui indiquent Â«Â Ã  partir deÂ Â» et Â«Â jusquâ€™Ã Â Â» quelle transaction un tuple est visible. J&amp;rsquo;ai ajoutÃ© un petit drapeau Ã  cÃ´tÃ© de chaque valeur :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;c : la transaction a Ã©tÃ© validÃ©e (&lt;code&gt;COMMIT&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;a : la transaction a Ã©tÃ© annulÃ©e (&lt;code&gt;ROLLBACK&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous noterez donc que PostgreSQL garde en mÃ©moire les donnÃ©es qui ont Ã©tÃ© modifiÃ©es lors des transactions abandonnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir plusieurs Ã©lÃ©ments :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les lignes visibles ne possÃ¨dent pas de &lt;em&gt;xmax&lt;/em&gt; (en vrai il est Ã©gal Ã  0).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;id = 3&lt;/code&gt; a Ã©tÃ© mise Ã  jour.&lt;br&gt;Son ancien emplacement avec les donnÃ©es d&amp;rsquo;origine est toujours prÃ©sent et correspond Ã  la troisiÃ¨me ligne. Elle est identifiÃ©e comme Â«Â morteÂ Â» et devra Ãªtre nettoyÃ©e.&lt;br&gt;La nouvelle version est prÃ©sente Ã  la derniÃ¨re ligne (&lt;code&gt;ctid = (1,2)&lt;/code&gt;).&lt;br&gt;PostgreSQL a rÃ©alisÃ© un &lt;code&gt;INSERT&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;ctid = (0,4)&lt;/code&gt; correspond Ã  la ligne &lt;code&gt;id = 4&lt;/code&gt; que nous avons supprimÃ©e.&lt;br&gt;Ici aussi la donnÃ©e n&amp;rsquo;est pas supprimÃ©e mais simplement Â«Â tagguÃ©eÂ Â» comme non visible.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;ctid = (1,3)&lt;/code&gt; correspond Ã  la ligne que nous venons d&amp;rsquo;ajouter : elle est situÃ©e en derniÃ¨re position.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un &lt;code&gt;UPDATE&lt;/code&gt; est en rÃ©alitÃ© la mÃªme opÃ©ration qu&amp;rsquo;un &lt;code&gt;DELETE&lt;/code&gt; suivi d&amp;rsquo;un &lt;code&gt;INSERT&lt;/code&gt;, d&amp;rsquo;ailleurs son coÃ»t est assez similaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce fonctionnement nous montre Ã©galement pourquoi les lignes peuvent paraitre dÃ©sordonnÃ©es lors d&amp;rsquo;un &lt;code&gt;SELECT&lt;/code&gt;. En effet, PostgreSQL remonte les lignes dans l&amp;rsquo;ordre dans lequel elles sont stockÃ©es. Dans notre cas, un simple &lt;code&gt;SELECT&lt;/code&gt; sur la table nous aurait donnÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;initialement 1, 2, 3, 4, 5, 6.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;AprÃ¨s l&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; 1, 2, 4, 5, 6, 3.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;AprÃ¨s le &lt;code&gt;DELETE&lt;/code&gt; 1, 2, 5, 6, 3.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;HOT UPDATE&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le Heap Only Tuple UPDATE (ou simplement &lt;code&gt;HOT UPDATE&lt;/code&gt;) un processus particulier de PostgreSQL qui se produit lorsqu&amp;rsquo;il reste suffisamment de place dans une page pour que l&amp;rsquo;ancienne et la nouvelle version d&amp;rsquo;un tuple y soient stockÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lancez maintenant la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Mise Ã  jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez les donnÃ©es de la deuxiÃ¨me page :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;, 1);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4440 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from and to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;160&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette fois-ci vous pouvez voir :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;&lt;code&gt;INSERT&lt;/code&gt; est fait en fin de donnÃ©es (&lt;code&gt;ctid = (1,2)&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; de la ligne &lt;code&gt;id = 3&lt;/code&gt; est ici un &lt;code&gt;HOT UPDATE&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le processus en image :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_1-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3104&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Voici la table dans son Ã©tat initial&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3106&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;&lt;br&gt;PremiÃ¨re Ã©tape du HOT UPDATE&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;La nouvelle version du tuple est insÃ©rÃ©e en derniÃ¨re position avec le &lt;code&gt;ctid = (1,4)&lt;/code&gt; et porte de tag Â«Â HOT UPDATEÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;ancienne version est Â«Â dÃ©sactivÃ©eÂ Â» : son &lt;code&gt;ctid&lt;/code&gt; devient &lt;code&gt;(1,4)&lt;/code&gt; et les tags Â«Â HOT UPDATEÂ Â» et Â«Â HEAP ONLY TUPLEÂ Â» sont ajoutÃ©s. Ceci permet Ã  PostgreSQL de comprendre, lors de la lecture du tuple 2, qu&amp;rsquo;il doit aller lire le tuple 4.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le &lt;code&gt;HOT UPDATE&lt;/code&gt; n&amp;rsquo;est en rÃ©alitÃ© pas terminÃ©, une seconde opÃ©ration va Ãªtre menÃ©e par la base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Faites la requÃªte SELECT suivante puis rÃ©analysez la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- SELECT&#xA;SELECT * FROM public.table_test;&#xA;&#xA;-- Analyse&#xA;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;, 1);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les donnÃ©es de la 2Ã¨me page : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;redirect to 4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from and to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le tuple 2, qui contient l&amp;rsquo;ancienne version de la ligne &lt;code&gt;id = 3&lt;/code&gt;, a Ã©tÃ© Â«Â nettoyÃ©eÂ Â» et sont pointeur redirige vers le pointeur 4. L&amp;rsquo;offset des tuples a Ã©tÃ© modifiÃ© Ã  cause d&amp;rsquo;une dÃ©fragmentation de la page : c&amp;rsquo;est la seconde opÃ©ration du &lt;code&gt;HOT UPDATE&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le processus imagÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_3-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3107&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Pruning : mise Ã  jour du pointeur ce qui tue le tuple 2&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Lors de la premiÃ¨re requÃªte qui suit l&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; et qui lit les donnÃ©es de la table (un &lt;code&gt;SELECT&lt;/code&gt; par exemple), PostgreSQL opÃ¨re un processus de pruning :&lt;br&gt;il met Ã  jour le pointeur du tuple 2 et remplace la valeur de position du tuple 2 par celle du pointeur de la nouvelle version (ici le pointeur 4).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, lors d&amp;rsquo;une lecture de la donnÃ©e, c&amp;rsquo;est toujours le pointeur 2 qui sera lu en premier mais PostgreSQL est directement redirigÃ© vers le nouveau pointeur (le 4) qui l&amp;rsquo;envoi ainsi vers le nouveau tuple (le 4 donc). Ceci permet de ne pas avoir Ã  modifier les index dans ce type de situation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que dans le cas d&amp;rsquo;une lecture sÃ©quentiel, cette opÃ©ration (de redirection) est similaire en temps et en coÃ»t que de lire directement le pointeur 4.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_4-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3108&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;PostgreSQL effectue ensuite une dÃ©fragmentation de la page en supprimant physiquement le tuple 2 (ce qui entraine un Â«Â dÃ©calageÂ Â» des tuples pour combler l&amp;rsquo;espace vide). Cette dÃ©fragmentation ne concerne pas les pointeurs, le 2&lt;sup&gt;Ã¨me&lt;/sup&gt; reste donc prÃ©sent, rÃ©fÃ©renÃ§ant toujours le pointeur 4 (toujours pour ne pas avoir Ã  toucher aux index).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le processus de lecture est donc identique Ã  l&amp;rsquo;Ã©tape prÃ©cÃ©dente mais de l&amp;rsquo;espace est rendu disponible.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que si un second &lt;code&gt;HOT UPDATE&lt;/code&gt; est rÃ©alisÃ© sur le mÃªme tuple et ceci juste aprÃ¨s le premier &lt;code&gt;HOT UPDATE&lt;/code&gt;, la nouvelle version est insÃ©rÃ©e dans l&amp;rsquo;espace qui aurait du Ãªtre nettoyÃ© par la dÃ©fragmentation, le pointeur qui redirigeait vers un autre pointeur (pt&lt;sub&gt;1-2&lt;/sub&gt; dans notre exemple) est alors rÃ©tabli. La dÃ©fragmentation nettoiera alors le tuple intermÃ©diaire ainsi que son pointeur (pt&lt;sub&gt;1-4&lt;/sub&gt;, tuple 4).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le &lt;code&gt;HOT UPDATE&lt;/code&gt; est ainsi plus rapide Ã  executer qu&amp;rsquo;un &lt;code&gt;UPDATE&lt;/code&gt; classique et permet de libÃ©rer de l&amp;rsquo;espace en Ã©vitant de conserver l&amp;rsquo;ancien tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous savez maintenant plus prÃ©cisÃ©ment comment fonctionne le stockage physique. Vous voyez ainsi que lorsque beaucoup d&amp;rsquo;opÃ©rations sont faites, des lignes mortes ainsi que des pointeurs supplÃ©mentaires sont prÃ©sents dans vos tables ce qui entraine une grande perte d&amp;rsquo;espace.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Heureusement, un outil spÃ©cifique existe pour nettoyer tout cela : le &lt;code&gt;VACUUM&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34; id=&#34;vacuum&#34;&gt;VACUUM&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Passons l&amp;rsquo;aspirateur ! Ce n&amp;rsquo;est pas pour rien que le mot &lt;em&gt;VACUUM&lt;/em&gt; a Ã©tÃ© choisi pour cette opÃ©ration&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM consiste en le nettoyage d&amp;rsquo;une table afin d&amp;rsquo;en retirer tous les Ã©lÃ©ments qui ne sont plus utiles (lignes mortes) ainsi que de rÃ©arranger les Ã©lÃ©ments pour gagner de la place.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Deux types de VACUUM existent :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le Plain VACUUM (standard) : nettoyage rapide et dÃ©fragmentation partielle de la table.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le VACUUM FULL (complet) : nettoyage et dÃ©fragmentation complets de la table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;opÃ©ration de VACUUM est lancÃ©e automatiquement par PostgreSQL via l&amp;rsquo;autovacuum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;VACUUM standard&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM standard (ou VACUUM concurrentiel ou Plain VACUUM) peut Ãªtre exÃ©cuter sans verrouiller la table sur laquelle il porte.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il opÃ¨re les actions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Analyse des pages pour identifier les tuples morts (issus d&amp;rsquo;un &lt;code&gt;UPDATE&lt;/code&gt;, d&amp;rsquo;un &lt;code&gt;DELETE&lt;/code&gt; ou d&amp;rsquo;une transaction abandonnÃ©e).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;FREEZE des tuples si nÃ©cessaire (voir le chapitre VACUUM FREEZE)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Suppression des entrÃ©es des index correspondant Ã  des tuples morts.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pour chaque page :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Suppression des tuples morts&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;DÃ©fragmentation de la page pour rÃ©cupÃ©rer l&amp;rsquo;espace des tuples morts.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Mise Ã  jour de la &lt;em&gt;free space map&lt;/em&gt; et de la &lt;em&gt;visibility map&lt;/em&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Suppression de la derniÃ¨re page si possible (si aucun tuple vivant dedans).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Mise Ã  jour des statistiques de la table dans les tables systÃ¨me.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;Ã©tape 1 commence par un listing des tuples mort, cette lsite est crÃ©Ã©e en mÃ©moire. C&amp;rsquo;est pour cette Ã©tape que la variable de configuration &lt;code&gt;maintenance_work_mem&lt;/code&gt; est importante. En effet, si sa valeur est trop faible, PostgreSQL devra itÃ©rer plusieurs fois sur la table jusquâ€™Ã  ce qu&amp;rsquo;il ne trouve plus de tuple mort.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;Ã©tape 2 est un FREEZE des valeurs &lt;em&gt;xmin&lt;/em&gt; des tuples. Cette opÃ©ration est dÃ©taillÃ©e dans le chapitre &lt;a href=&#34;#vacuum_freeze&#34;&gt;VACUUM FREEZE&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;Ã©tape 4 se dÃ©roule de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3114&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Ã‰tat initial : un tuple est considÃ©rÃ© comme mort&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3115&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Les donnÃ©es sont effacÃ©es et le pointeur du tuple est rÃ©initialisÃ©&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_3.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3117&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;La dÃ©fragmentation rÃ©organise les donnÃ©es mais conserve le pointeur 2&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple, repartez de notre table d&amp;rsquo;exemple utilisÃ©e prÃ©cÃ©demment (disponible dans l&amp;rsquo;onglet Â«Â initialisationÂ Â») puis supprimez quelques lignes et analysezla :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;get_heap_tuple_info()&#34; data-enlighter-group=&#34;start_vacuum_plain&#34;&gt;DELETE FROM public.table_test&#xA;WHERE id IN (6, 3)&#xA;;&#xA;&#xA;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;start_vacuum_plain&#34;&gt;-- !!!&#xA;-- Attention Ã  bien exÃ©cuter chaque requÃªte dans une transaction spÃ©cifique&#xA;-- Ce que permet le COMMIT Ã  la suite de chaque requÃªte si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- CrÃ©ation de la table&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 2&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Suppression de la ligne 4&#xA;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- SÃ©lection des donnÃ©es pour finalisation HOT UPDATE&#xA;SELECT * FROM public.table_test&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devriez avoir la structure suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4530 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2056&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4533 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;redirect to 4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4531 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4532 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4533 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez la diffÃ©rence entre les tuples non visibles qui ont Ã©tÃ© mis Ã  jour et les tuples non visibles qui ont Ã©tÃ© supprimÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les premiers ont dÃ©jÃ  Ã©tÃ© nettoyÃ©s des tables, leurs pointeurs sont toujours prÃ©sents mais ne pointent vers rien ou redirigent vers un autre pointeur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les seconds en revanche sont toujours prÃ©sents mais simplement non visibles.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez Ã©galement le rÃ©sultat de la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple_visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille occupÃ©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2012&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6136&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2128&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6024&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lancez un VACUUM puis analysez les donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;VACUUM public.table_test;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4531 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que les tuples vivants ont Ã©tÃ© rÃ©organisÃ©s (modification des offsets), quand aux morts, ils ont Ã©tÃ© supprimÃ©s mais leurs pointeurs sont toujours prÃ©sents dans un Ã©tat Â«Â inutilisÃ©Â Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez les statistiques au niveau de chaque page :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple_visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille occupÃ©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4020&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4128&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6148&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2008&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir immÃ©diatement que l&amp;rsquo;espace prÃ©cÃ©demment occupÃ© par les tuples morts a pu Ãªtre rÃ©cupÃ©rÃ©. Les prochaines insertions se feront alors d&amp;rsquo;abord dans la premiÃ¨re page puis dans la seconde avant de crÃ©er une Ã©ventuelle troisiÃ¨me page.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En revanche, vous pouvez voir que les pointeurs n&amp;rsquo;ont pas disparus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez Ã©galement que les donnÃ©es prÃ©sentes dans la page 2 pourraient tout Ã  fait Ãªtre transfÃ©rÃ©es dans la page 1 maintenant qu&amp;rsquo;il y a suffisamment de place., c&amp;rsquo;est le &lt;code&gt;VACUUM FULL&lt;/code&gt; qui permet de faire cela.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;VACUUM FULL&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM FULL permet d&amp;rsquo;aller au delÃ  du VACUUM standard. En effet, ce dernier ne permet pas de rÃ©duire la taille des tables.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM FULL rÃ©Ã©crit complÃ¨tement le &lt;em&gt;heap file&lt;/em&gt; afin de rÃ©organiser les tuples et d&amp;rsquo;Ã©liminer les pages en trop. L&amp;rsquo;avantage est un gain de place qui peut Ãªtre consÃ©quent.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;inconvÃ©nient est que pendant la rÃ©Ã©criture, la table n&amp;rsquo;est plus accessible. Un autre inconvÃ©nient est que deux versions de la table seront prÃ©sentes sur le disque lors de la phase de rÃ©Ã©criture ce qui peut entrainer des problÃ¨mes d&amp;rsquo;espace disque si les donnÃ©es sont trÃ¨s volumineuses.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Reprenez notre exemple (disponible dans l&amp;rsquo;onglet Â«Â initialisationÂ Â») et analysez la table avec la fonction &lt;code&gt;get_heap_page_info()&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;get_heap_tuple_info()&#34; data-enlighter-group=&#34;start_vacuum_full&#34;&gt;-- Quelques statistiques&#xA;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;start_vacuum_full&#34;&gt;-- !!!&#xA;-- Attention Ã  bien exÃ©cuter chaque requÃªte dans une transaction spÃ©cifique&#xA;-- Ce que permet le COMMIT Ã  la suite de chaque requÃªte si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- CrÃ©ation de la table&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 2&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Suppression de la ligne 4&#xA;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- SÃ©lection des donnÃ©es pour finalisation HOT UPDATE&#xA;SELECT * FROM public.table_test&#xA;;&#xA;COMMIT;&#xA;&#xA;-- VACUUM Standard&#xA;VACUUM public.table_test&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused_line_pointer&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;PrÃ©sence de pointeurs non utilisÃ©s.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4020&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6148&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Maintenant, rÃ©alisez un VACUUM FULL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- VACUUM FULL&#xA;VACUUM FULL public.table_test&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;RÃ©analysons la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le retour :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused_line_pointer&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;PrÃ©sence de pointeurs non utilisÃ©s.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2016&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les tuples ont Ã©tÃ© rÃ©organisÃ©s sur la premiÃ¨re page du nouveau fichier. D&amp;rsquo;ailleurs dans l&amp;rsquo;exemple, mon filenode Ã©tait &lt;strong&gt;350934&lt;/strong&gt; (l&amp;rsquo;OID de la table). GrÃ¢ce Ã  la fonction &lt;code&gt;get_table_info()&lt;/code&gt; je vois maintenant qu&amp;rsquo;il est Ã©gal Ã  &lt;strong&gt;351418&lt;/strong&gt; : le fichier heap a bien Ã©tÃ© rÃ©Ã©crit.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le VACUUM FULL rÃ©Ã©crit Ã©galement les index, la visibility map ainsi que la free space map.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34; id=&#34;vacuum_freeze&#34;&gt;FREEZE des donnÃ©es&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM possÃ¨de une option : &lt;code&gt;FREEZE&lt;/code&gt; qui permet de geler les donnÃ©es. Mais Ã  quoi Ã§a sert ?&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ID de transaction&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme vous l&amp;rsquo;avez vu, le systÃ¨me de contrÃ´le d&amp;rsquo;accÃ¨s simultanÃ© (MVCC) utilise l&amp;rsquo;identifiant des transactions pour dÃ©terminer la visibilitÃ© des tuples. Cet identifiant est nommÃ© &lt;strong&gt;txid&lt;/strong&gt; et est assignÃ© par le gestionnaire de transaction. Il s&amp;rsquo;agit d&amp;rsquo;un nombre entier non signÃ© de 32 bit (soit 2&lt;sup&gt;32&lt;/sup&gt; = 4 294 967 295 valeurs diffÃ©rentes).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, lorsqu&amp;rsquo;une transaction est en cours, tous les Ã©lÃ©ments portant un &lt;em&gt;txid&lt;/em&gt; infÃ©rieur Ã  celui de la transaction sont considÃ©rÃ©s comme dans le passÃ© et donc modifiables par la transaction. Tous ceux qui ont un &lt;em&gt;txid&lt;/em&gt; supÃ©rieur, sont dans le futur et donc non modifiables par la transaction (cela dÃ©pend du mode de transaction utilisÃ© mais ne compliquons pas les choses).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;une seule transaction peut contenir plusieurs instructions SQL, chaque instruction se voit alors assigner un identifiant de commande (&lt;strong&gt;cid&lt;/strong&gt;), nombre entier non signÃ© de 32 bits Ã©galement ; permettant de comparer les rÃ©sultats des instructions les uns par rapport aux autres, exactement comme avec les &lt;em&gt;txid&lt;/em&gt;, au sein de la transaction. Ceci contraint d&amp;rsquo;ailleurs le systÃ¨me Ã  ne pouvoir exÃ©cuter Â«Â queÂ Â» 4,2 milliard d&amp;rsquo;instructions SQL par transaction (on est large&amp;#8230;)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les &lt;em&gt;txid&lt;/em&gt; suivants sont spÃ©ciaux :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;0 : &lt;em&gt;txid&lt;/em&gt; invalide.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1 : &lt;em&gt;txid&lt;/em&gt; d&amp;rsquo;initialisation du cluster.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2 : avant PG 9.4, il s&amp;rsquo;agit de la valeur &lt;em&gt;xmin&lt;/em&gt; gelÃ©e, maintenant c&amp;rsquo;est un drapeau qui est ajoutÃ© au tuple.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;assignement du &lt;em&gt;txid&lt;/em&gt; se produit lorsque la transaction commence Ã  Ã©crire et n&amp;rsquo;indique donc pas l&amp;rsquo;ordre de dÃ©marrage des transactions. Ceci implique qu&amp;rsquo;une transaction peut Â«Â doublerÂ Â» une autre. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Horaire&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 1&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h00&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but &lt;code&gt;SELECT&lt;/code&gt; sur la table X&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but &lt;code&gt;INSERT&lt;/code&gt; sur la table Y&lt;br&gt;&lt;strong&gt;=&amp;gt; Assignation d&amp;rsquo;un txid&lt;/strong&gt; : 1000&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h06&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;INSERT&lt;/code&gt; sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h08&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;SELECT&lt;/code&gt; sur la table X&lt;br&gt;DÃ©but &lt;code&gt;UPDATE&lt;/code&gt; sur la table Y&lt;br&gt;&lt;strong&gt;=&amp;gt; Assignation d&amp;rsquo;un txid&lt;/strong&gt; : 1001&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;UPDATE&lt;/code&gt; sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Les actions de la transaction 1 sont considÃ©rÃ©es comme ayant Ã©tÃ© rÃ©alisÃ©es aprÃ¨s la transaction 2 bien que cette derniÃ¨re ait dÃ©marrÃ©e aprÃ¨s&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Bouclage ou wraparound&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le problÃ¨me, c&amp;rsquo;est que 4,2 milliards de valeurs ce n&amp;rsquo;est pas forcÃ©ment assez dans la vie d&amp;rsquo;une base de donnÃ©es. Lorsqu&amp;rsquo;il y a plusieurs milliers de transactions par minutes, le compteur peut Ãªtre dÃ©passÃ© en moins de 8 ans (ok on est large mais une base avec plusieurs millions de transactions par jour cela peut arriver).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour rÃ©soudre ceci, PostgreSQL utilise le bouclage (wraparround) : lorsque les 4,2 milliards de valeurs sont atteintes, le compteur redÃ©marre Ã  0. Le problÃ¨me c&amp;rsquo;est qu&amp;rsquo;au moment du bouclage, la transaction portant le &lt;code&gt;txid = 4,1 milliards&lt;/code&gt; qui Ã©tait dans le passÃ© se retrouve alors dans le futur (le &lt;em&gt;txid&lt;/em&gt; courant Ã©tant maintenant infÃ©rieur). Pour Ã©viter ce phÃ©nomÃ¨ne, PostgreSQL considÃ¨re que les 2,1 milliards de transactions prÃ©cÃ©dentes sont dans le passÃ© et les 2,1 milliards suivantes dans le futur en tenant compte de ce bouclage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple, ma transaction porte le &lt;code&gt;txid = 1000&lt;/code&gt;, la Â«Â boucle du tempsÂ Â» serait la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table is-style-regular&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;txid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;TemporalitÃ©&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;999&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;mark style=&#34;background-color:rgba(0, 0, 0, 0)&#34; class=&#34;has-inline-color has-bleu-dodger-color&#34;&gt;&lt;strong&gt;1000&lt;/strong&gt;&lt;/mark&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;mark style=&#34;background-color:rgba(0, 0, 0, 0)&#34; class=&#34;has-inline-color has-bleu-dodger-color&#34;&gt;&lt;strong&gt;PrÃ©sent&lt;/strong&gt;&lt;/mark&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1001&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Futur -&amp;gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;31&lt;/sup&gt; + 999&lt;br&gt;2 147 484 647&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Futur -&amp;gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;31&lt;/sup&gt; + 1000&lt;br&gt;2 147 484 648&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;32&lt;/sup&gt;&lt;br&gt;4 294 967 295&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_freeze_wraparround-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3132&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requÃªte pour connaitre les limites de votre passÃ© et de votre futur :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  txid_current() AS &#34;txid_current&#34;,&#xA;  CASE &#xA;    WHEN txid_current() &amp;lt; 2^31 THEN txid_current() + 2^31 - 1&#xA;    ELSE txid_current() + 2^31 - 2^32 - 1&#xA;  END AS &#34;limite_futur&#34;,&#xA;  CASE &#xA;    WHEN txid_current() &gt; 2^31 THEN txid_current() - 2^31&#xA;    ELSE txid_current() - 2^31 + 2^32&#xA;  END AS &#34;limite_passÃ©&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Gel des donnÃ©es : Freeze&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le problÃ¨me qui peut survenir c&amp;rsquo;est que lorsqu&amp;rsquo;il y a eu plus de 2,1 (exactement 2&lt;sup&gt;21&lt;/sup&gt;) milliards de transactions, PostgreSQL va considÃ©rer d&amp;rsquo;anciennes transactions comme Ã©tant dans le futur. Pas trÃ¨s pratique&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;C&amp;rsquo;est pour rÃ©soudre ce problÃ¨me que le FREEZE a Ã©tÃ© inventÃ©. Il permet d&amp;rsquo;ajouter un drapeau sur un tuple indiquant que son &lt;em&gt;xmin &lt;/em&gt;est Â«Â gelÃ©Â Â», c&amp;rsquo;est Ã  dire que peu importe la valeur du &lt;em&gt;xmin&lt;/em&gt;, il doit Ãªtre considÃ©rÃ© comme infÃ©rieur au &lt;em&gt;txid&lt;/em&gt; actuel, mÃªme si ce n&amp;rsquo;est pas le cas.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, le VACUUM se charge de geler les lignes adÃ©quates selon les cas suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM standard :&lt;/strong&gt; tous les tuples dont le &lt;em&gt;xmin&lt;/em&gt; est infÃ©rieur de la valeur Ã  : &lt;code&gt;oldest_current_txid&lt;/code&gt; &amp;#8211; &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt;&lt;br&gt;Le FREEZE n&amp;rsquo;est opÃ©rÃ© que sur les pages pour lesquelles le VACUUM opÃ¨re : les pages contenant des tuples morts. On parle alors de lazy FREEZE (FREEZE paresseux).&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La valeur de &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt; est dÃ©finie dans le fichier &lt;em&gt;postgresql.com&lt;/em&gt; et est fixÃ©e par dÃ©faut fixÃ©e Ã  50 000 000.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;oldest_current_txid&lt;/code&gt; correspond au plus vieux txid des transaction en cours.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM FREEZE :&lt;/strong&gt; tous les tuples dont le &lt;em&gt;xmin&lt;/em&gt; est infÃ©rieur Ã  &lt;code&gt;oldest_current_txid&lt;/code&gt;.&lt;br&gt;Le FREEZE est opÃ©rÃ© sur toutes les pages de la table. On parle de FREEZE aggressif.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM FULL :&lt;/strong&gt; Ã©quivalent du VACUUM FREEZE, les opÃ©rations de nettoyage sont diffÃ©rentes mais les opÃ©rations de FREEZE intÃ©grÃ©e sont Ã©quivalentes.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si l&amp;rsquo;age de la table (age du plus vieux tuple) dÃ©passe la valeur de la variable &lt;code&gt;vacuum_freeze_table_age&lt;/code&gt; (par dÃ©faut 150 000 000) alors le prochain VACUUM lancÃ© s&amp;rsquo;accompagnera d&amp;rsquo;un FREEZE aggressif.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention car le gel des tuples d&amp;rsquo;une page implique de rÃ©Ã©crire entiÃ¨rement cette derniÃ¨re et a donc un coÃ»t important. Si le VACUUM prend trop de temps, il est possible de le stopper, le travail dÃ©jÃ  accompli en sera pas perdu (notamment sur le gel des donnÃ©es).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A la fin du VACUUM, des statistiques sont calculÃ©es et les valeurs suivantes renseignÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; : &lt;em&gt;txid&lt;/em&gt; le plus rÃ©cent ayant Ã©tÃ© gelÃ© dans la table.&lt;br&gt;Il s&amp;rsquo;agit de la valeur ayant Ã©tÃ© utilisÃ©e pour geler les tuples (&lt;code&gt;txid&lt;/code&gt; ou &lt;code&gt;txid&lt;/code&gt; &amp;#8211; &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt;), pas forcÃ©ment du &lt;em&gt;txid&lt;/em&gt; gelÃ© le plus rÃ©cent ; ce dernier est en effet plus ancien ou Ã©gal Ã  cette valeur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_catalog.pg_database.datfrozenxid&lt;/code&gt; : &lt;em&gt;txid&lt;/em&gt; le plus rÃ©cent ayant Ã©tÃ© gelÃ© dans toute la base.&lt;br&gt;Il s&amp;rsquo;agit du &lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; le plus ancien.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas de notre exemple, la colonne &lt;code&gt;max_frozen_txid&lt;/code&gt; de la fonction &lt;code&gt;get_table_info()&lt;/code&gt; vaut &lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;AUTOVACUUM&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;blockquote class=&#34;wp-block-quote is-layout-flow wp-block-quote-is-layout-flow&#34;&gt;&#xA;&lt;p&gt;Vacuuming is like exercising. If it hurts, youâ€™re not doing it enough!&lt;/p&gt;&#xA;&lt;cite&gt;Robert Haas, PGConf.EU 2023, Prague, 13 dÃ©cembre 2023&lt;/cite&gt;&lt;/blockquote&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un VACUUM cela peut Ãªtre trÃ¨s rapide mais cela peut aussi Ãªtre trÃ¨s lourd et c&amp;rsquo;est pour cela qu&amp;rsquo;il faut le lancer rÃ©guliÃ¨rement. C&amp;rsquo;est justement le rÃ´le de l&amp;rsquo;autovacuum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Toutes les minutes (interval paramÃ©trable via le paramÃ¨tre &lt;code&gt;autovacuum_naptime&lt;/code&gt;), l&amp;rsquo;autovacuum se lance, analyse les donnÃ©es de la vue &lt;code&gt;pg_stat_all_tables&lt;/code&gt; afin de dÃ©terminer s&amp;rsquo;il doit lancer un &lt;code&gt;VACUUM&lt;/code&gt; et ou un &lt;code&gt;ANALYSE&lt;/code&gt; sur les diffÃ©rentes tables de la base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Plusieurs tables peuvent Ãªtre nettoyÃ©es en mÃªme temps : un processus de VACUUM sur une table utilise un worker et par dÃ©faut jusquâ€™Ã  trois peuvent Ãªtre lancÃ©s (variable &lt;code&gt;autovacuum_max_workers&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le dÃ©clenchement de l&amp;rsquo;autovacuum sur une table se fait si au moins l&amp;rsquo;une des conditions suivantes est remplie :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt; Le &lt;em&gt;txid&lt;/em&gt; courant est plus rÃ©cent que :&lt;br&gt;&lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; + &lt;code&gt;autovacuum_freeze_max_age&lt;/code&gt;&lt;br&gt;Le tuple le plus vieux de la table est plus ancien que la valeur de la variable &lt;code&gt;autovacuum_freeze_max_age&lt;/code&gt; (par dÃ©faut 200 000 000).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le nombre de tuples morts est plus important que :&lt;br&gt;&lt;code&gt;autovacuum_vacuum_threshold&lt;/code&gt; + ( &lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; Ã— &lt;code&gt;nombre_tuples_relation&lt;/code&gt; )&lt;br&gt;Avec les valeurs par dÃ©faut cela correspond Ã  250 tuples morts pour 1000 tuples dans la table ou 2050 pour 10 000.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le nombre de tuples insÃ©rÃ©s est plus important que :&lt;br&gt;&lt;code&gt;autovacuum_vacuum_insert_threshold&lt;/code&gt; + ( &lt;code&gt;autovacuum_vacuum_insert_scale_factor&lt;/code&gt; Ã— &lt;code&gt;nombre_tuples_relation&lt;/code&gt; )&lt;br&gt;Avec les valeurs par dÃ©faut cela correspond Ã  3000 tuples insÃ©rÃ©s pour 10 000 tuples dans la table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur par dÃ©faut de &lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; est trop importante pour les grosses tables. Par exemple, une table qui contient 1 000 000 d&amp;rsquo;enregistrements ne se verra nettoyÃ©e qu&amp;rsquo;aprÃ¨s 200 050 mouvements ce qui est trÃ¨s important. D&amp;rsquo;autant plus que le VACUUM qui sera dÃ©clenchÃ© risque d&amp;rsquo;Ãªtre trÃ¨s lourds en raison de la taille importante de la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les paramÃ¨tres suivants sont intÃ©ressants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;maintenance_work_mem&lt;/code&gt; / &lt;code&gt;autovacuum_work_mem&lt;/code&gt; : quantitÃ© de mÃ©moire allouÃ©e pour les processus de maintenance. N&amp;rsquo;hÃ©sitez pas Ã  le pousser jusquâ€™Ã  1 Go (au delÃ , le VACUUM n&amp;rsquo;en a pas l&amp;rsquo;utilitÃ©).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; : pourcentage de tuples modifiÃ©s au delÃ  duquel l&amp;rsquo;autovacuum se lance. Il est intÃ©ressant de le dÃ©finir spÃ©cifiquement pour les tables de grande taille.&lt;br&gt;Par exemple pour le passer Ã  5% : &lt;code&gt;ALTER TABLE table_name SET (autovacuum_vacuum_scale_factor = 0.05);&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_vacuum_insert_scale_factor&lt;/code&gt; : pourcentage de tuples insÃ©rÃ©s au delÃ  duquel l&amp;rsquo;autovacuum se lance. Il est intÃ©ressant de le dÃ©finir spÃ©cifiquement pour les tables de grande taille.&lt;br&gt;Par exemple pour le passer Ã  5% : &lt;code&gt;ALTER TABLE table_name SET (autovacuum_vacuum_insert_scale_factor = 0.05);&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_max_workers&lt;/code&gt; : nombre de workers pouvant Ãªtre lancÃ©s simultanÃ©ment durant le processus d&amp;rsquo;autovacuum.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les statistiques que nous avons actuellement pour la table de notre exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;schema&lt;/td&gt;&lt;td&gt;public&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table&lt;/td&gt;&lt;td&gt;table_test&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_page&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_count&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;dead_tuple_count&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;max_frozen_txid&lt;/td&gt;&lt;td&gt;4644&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_ins&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_upd&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_del&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_mod_since_analyze&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_ins_since_vacuum&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_vacuum&lt;/td&gt;&lt;td&gt;2024-01-01 01:01:01.000 +0100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_autovacuum&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_analyze&lt;/td&gt;&lt;td&gt;2024-01-01 01:01:01.000 +0100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_autoanalyze&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour en savoir plus&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voila un trÃ¨s gros rÃ©sumÃ© de comment PostgreSQL gÃ¨re les donnÃ©es physiquement. Vous pouvez pousser le sujet en consultant les ressources suivantes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le stockage physique :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage-page-layout.htm&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage-page-layout.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/pageinspect.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/pageinspect.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/pgstattuple.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/pgstattuple.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/ddl-system-columns.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/ddl-system-columns.html&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le systÃ¨me de contrÃ´le concurrentiel :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/transaction-id.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/transaction-id.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql05.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql05.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.thenile.dev/blog/transaction-isolation-postgres&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.thenile.dev/blog/transaction-isolation-postgres&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://medium.com/quadcode-life/structure-of-heap-table-in-postgresql-d44c94332052&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://medium.com/quadcode-life/structure-of-heap-table-in-postgresql-d44c94332052&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://postgrespro.com/blog/pgsql/5967892&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://postgrespro.com/blog/pgsql/5967892&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://idrawone.github.io/2020/10/09/Heap-Page-in-details/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://idrawone.github.io/2020/10/09/Heap-Page-in-details/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur les TOAST :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage-toast.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage-toast.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.anayrat.info/en/2022/02/14/postgresql-toast-compression-and-toast_tuple_target/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://blog.anayrat.info/en/2022/02/14/postgresql-toast-compression-and-toast_tuple_target/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le VACUUM :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/maintenance.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/maintenance.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql05/10.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql05/10.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql06.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql06.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://public.dalibo.com/exports/formation/manuels/modules/m5/m5.handout.html#param%C3%A9trage-de-vacuum-autovacuum&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://public.dalibo.com/exports/formation/manuels/modules/m5/m5.handout.html#param%C3%A9trage-de-vacuum-autovacuum&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://pankajconnect.medium.com/vacuum-and-vacuum-full-postgresql-4c9da30a1500&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://pankajconnect.medium.com/vacuum-and-vacuum-full-postgresql-4c9da30a1500&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/stockage-physique-gestion-des-donnees-et-vacuum" rel="alternate"></link>
    <summary type="html">Base de donnÃ©es ou fichiers plats ? Saviez-vous que PostgreSQL stockait les donnÃ©es dans des fichiers plats ? DÃ©mystifions un peu ce fonctionnement.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Ouvrez les fenÃªtres de PostgreSQL â€“ Guide complet sur le fenÃªtrage</title>
    <updated>2024-01-04T16:39:54Z</updated>
    <id>tag:blog.arthurbazin.com,2024-01-04:/bdd/postgresql/ouvrez-les-fenetres-de-postgresql-guide-complet-sur-le-fenetrage</id>
    <content type="html">&#xA;&lt;p&gt;Sous PostgreSQL, il est possible d&amp;rsquo;effectuer des opÃ©rations de statistique (de type agrÃ©gat) sur un ensemble de lignes sans avoir Ã  les agrÃ©ger grÃ¢ce aux fonctions de fenÃªtrage. Il devient ainsi possible de calculer des valeurs cumulÃ©es ou encore des sommes par unitÃ© de temps (dans le cas de donnÃ©es datÃ©es)&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fenÃªtrage permet en outre de dÃ©finir la portÃ© de la fonction, c&amp;rsquo;est Ã  dire de spÃ©cifier les limites des regroupements de lignes utilisÃ©s dans la fonction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple de ce qu&amp;rsquo;il est possible de calculer : les deux derniÃ¨res colonnes se basent sur des fonctions de fenÃªtrage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Cumul&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Moyenne par mois&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;27&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;47&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;E&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;23&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;70&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;F&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;90&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;G&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;H&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;113&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;I&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;123&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Syntaxe&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Clause WINDOW&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La syntaxe est relativement simple : il suffit d&amp;rsquo;utiliser une fonction de fenÃªtrage dans la clause &lt;code&gt;SELECT&lt;/code&gt; puis dÃ©finir la fenÃªtre Ã  utiliser dans la clause &lt;code&gt;WINDOW&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;colonne_1,&#xA;&#x9;colonne_2,&#xA;&#x9;fonction_fenetre(colonne_3) OVER ma_fenetre&#xA;FROM&#xA;&#x9;mon_schema.ma_table&#xA;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;--definition&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;il est possible de dÃ©finir la fenÃªtre directement aprÃ¨s la fonction de fenÃªtrage :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;colonne_1,&#xA;&#x9;colonne_2,&#xA;&#x9;fonction_fenetre(colonne_3) OVER (&#xA;&#x9;&#x9;--definition&#xA;&#x9;)&#xA;FROM&#xA;&#x9;mon_schema.ma_table&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est tout Ã  fait possible de dÃ©finir plusieurs fenÃªtres dans la clause &lt;code&gt;WINDOW&lt;/code&gt; afin d&amp;rsquo;utiliser des portÃ©es diffÃ©rentes dans chaque fonction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention les lignes vues par la fenÃªtre dÃ©pendent des clauses prÃ©sentes dans votre requÃªte :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La clause &lt;code&gt;WHERE&lt;/code&gt; restreint le nombre de lignes dans le rÃ©sultat de la requÃªte mais Ã©galement dans la fenÃªtre.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Avec la clause &lt;code&gt;GROUP BY&lt;/code&gt;, les lignes vues par la fenÃªtre sont les lignes regroupÃ©es et non les lignes d&amp;rsquo;origines.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La clause &lt;code&gt;HAVING&lt;/code&gt; restreint le nombre de lignes groupÃ©es visibles par la fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;DÃ©finition&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La dÃ©finition d&amp;rsquo;une fenÃªtre peut faire appel Ã  diffÃ©rents Ã©lÃ©ments, tous optionnels :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La clause &lt;code&gt;PARTITION BY&lt;/code&gt; : comment regrouper les lignes ?&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La clause &lt;code&gt;ORDER BY&lt;/code&gt; : comment ordonnancer les lignes ?&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de la fenÃªtre : quelles lignes du groupe faut-il utiliser ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;-- Regroupement&#xA;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;ma_colonne_1&#xA;&#x9;&#x9;-- Ordonnancement&#xA;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;ma_colonne_2&#xA;&#x9;&#x9;-- Limites&#xA;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;PARTITION BY : regroupement&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La clause de regroupement &lt;code&gt;PARTITION BY&lt;/code&gt; permet de grouper les lignes issues de la requÃªtes en partitions. Chacune de ces partitions est traitÃ©e individuellement par la fonction de fenÃªtrage. Ainsi, chaque ligne se voit attribuer une valeur calculÃ©e par la fonction de fenÃªtrage en fonction de la partition Ã  laquelle elle appartient. Par exemple la somme ou encore la valeur moyenne de toutes les valeurs d&amp;rsquo;une partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette clause attend une expression pouvant contenir une ou plusieurs colonnes ainsi que des expressions SQL (fonction, calcul&amp;#8230;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si cette clause n&amp;rsquo;est pas spÃ©cifiÃ©e alors toutes les lignes de la requÃªte sont considÃ©rÃ©es comme faisant partie de la mÃªme partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici deux exemples de regroupement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pays&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe calculÃ© par &lt;code&gt;PARTITION BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;France&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;France&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Suisse&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Suisse&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;france&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 3&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Regroupement basÃ© sur une colonne : &lt;code&gt;PARTITION BY pays&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ma_colonne_date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe calculÃ© par &lt;code&gt;PARTITION BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;08/04/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;15/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Regroupement basÃ© sur une expression : &lt;code&gt;PARTITION BY extract(MONTH FROM ma_colonne_date)&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le regroupement des valeurs entraine un ordonnancement de celles-ci qui influe sur l&amp;rsquo;ordre des lignes dans les rÃ©sultats de la requÃªte. Il pourra Ãªtre nÃ©cessaire d&amp;rsquo;utiliser la clause &lt;code&gt;ORDER BY&lt;/code&gt; (dans la requÃªte, pas le &lt;code&gt;ORDER BY&lt;/code&gt; de la fenÃªtre) pour spÃ©cifier un ordre particulier des rÃ©sultats.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;ORDER BY : l&amp;rsquo;ordonnancement&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Selon le calcul rÃ©alisÃ©, il peut Ãªtre intÃ©ressant d&amp;rsquo;ordonnancer les valeurs de la fenÃªtre. Par exemple dans le cas d&amp;rsquo;une somme cumulÃ©e (croissante ou dÃ©croissante), il est important que les valeurs au sein d&amp;rsquo;une partition soient triÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette clause attend une expression permettant d&amp;rsquo;ordonnancer les lignes, cela peut Ãªtre une ou plusieurs colonnes ainsi que des expressions SQL (fonction, calculâ€¦).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ma_colonne_date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Rang calculÃ© par &lt;code&gt;ORDER BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;15/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Ordonnancement basÃ© sur une colonne, &lt;code&gt;ma_colonne_date&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les options suivantes peuvent Ãªtre utilisÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ASC&lt;/code&gt; ou &lt;code&gt;DESC&lt;/code&gt; : pour spÃ©cifier un tri ascendant ou descendant.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;NULLS { FIRST | LAST }&lt;/code&gt;  pour gÃ©rer l&amp;rsquo;ordre des valeurs nulles (en premier ou en dernier).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque plusieurs fonctions de fenÃªtrage sont utilisÃ©es, les valeurs peuvent Ãªtre triÃ©es plusieurs fois de suites.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les fenÃªtre ayant des clauses &lt;code&gt;PARTITION BY&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; Ã©quivalente seront Ã©valuÃ©es en mÃªme temps et auront donc exactement le mÃªme ordre de tri (mÃªme si &lt;code&gt;ORDER BY&lt;/code&gt; ne dÃ©finit pas une faÃ§on unique de trier les lignes).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les fenÃªtres ayant des clauses &lt;code&gt;PARTITION BY&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; diffÃ©rentes seront Ã©valuÃ©es sÃ©parÃ©ment. Il en rÃ©sulte un tri potentiellement diffÃ©rent entre deux fenÃªtres ayant des partions diffÃ©rentes mais un ordre de tri identique (lorsque &lt;code&gt;ORDER BY&lt;/code&gt; ne dÃ©finit pas une faÃ§on unique de trier les lignes).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que l&amp;rsquo;ordonnancement des valeurs influe sur l&amp;rsquo;ordre des lignes dans les rÃ©sultats de la requÃªte. Il pourra Ãªtre nÃ©cessaire d&amp;rsquo;utiliser la clause &lt;code&gt;ORDER BY&lt;/code&gt; (dans la requÃªte, pas le &lt;code&gt;ORDER BY&lt;/code&gt; de la fenÃªtre) pour spÃ©cifier un ordre particulier des rÃ©sultats.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Clause de portÃ©e : les limites de la fenÃªtre&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions ne portent pas directement sur toutes les ligne de la partition qu&amp;rsquo;elles sont en train de traiter. En fait, leur calcul est dÃ©pendant de la ligne en cour de traitement. En effet, chaque fenÃªtre possÃ¨de un portÃ©e limitÃ©e au sein de la partition dÃ©finie (par &lt;code&gt;PARTITION BY&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par dÃ©faut, cette limite s&amp;rsquo;Ã©tend Ã  toute la partition sauf dans le cas oÃ¹ une clause &lt;code&gt;ORDER BY&lt;/code&gt; est dÃ©finie pour la fenÃªtre. Dans ce dernier cas, la limite est comprise entre Â«Â toutes les lignes prÃ©cÃ©dentesÂ Â» et Â«Â la ligne actuelleÂ Â». Donc la fonction ne Â«Â voientÂ Â» pas les lignes qui Â«Â suiventÂ Â» au sein de la mÃªme partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les limites se dÃ©finissent de la faÃ§on suivante : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le mode de dÃ©finition&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de dÃ©but&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de fin&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les exclusions&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;{ROWS | RANGE | GROUPS}&#xA;BETWEEN&#xA;&#x9;{UNBOUNDED PRECEDING | n PRECEDING | CURRENT ROW | n FOLLOWING}&#xA;AND&#xA;&#x9;{n PRECEDING | CURRENT ROW | n FOLLOWING | UNBOUNDED FOLLOWING}&#xA;EXCLUDE &#xA;&#x9;{CURRENT ROW | EXCLUDE GROUP | EXCLUDE TIES | EXCLUDE NO OTHERS}&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe trois modes de dÃ©finition des limites :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : que je traduis par ligne.&lt;br&gt;On dÃ©finit un nombre spÃ©cifique de lignes avant ou aprÃ¨s la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : que je traduis par rang.&lt;br&gt;On dÃ©finit un nombre de rangs sÃ©parant la limite de la ligne courante.&lt;br&gt;Le rang de chaque ligne est dÃ©finit avec la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Plusieurs lignes peuvent avoir le mÃªme rang, on parle alors de Â«Â groupe de lignes Ã©quivalentesÂ Â» dans le tri ce qui Ã©quivaut Ã  Â«Â groupe de ligne ayant le mÃªme rangÂ Â» dans le tri.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : (mode par dÃ©faut) que je traduis par intervalle.&lt;br&gt;On dÃ©finit un intervalle d&amp;rsquo;Ã©cart entre la ligne courante et la limite&lt;br&gt;L&amp;rsquo;intervalle est calculÃ© sur une colonne unique dÃ©finie dans la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Le type de l&amp;rsquo;intervalle dÃ©pend de la colonne spÃ©cifiÃ©e (numÃ©rique, date&amp;#8230;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La dÃ©finition des limites peut utiliser les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;UNBOUNDED PRECEDING&lt;/code&gt; : toutes les lignes prÃ©cÃ©dentes (limite infÃ©rieur par dÃ©faut)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;n PRECEDING&lt;/code&gt; : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : n = nombre de ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : n = nombre de rang/groupe.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : n = intervalle avec la ligne actuelle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;CURRENT ROW&lt;/code&gt; : (limite supÃ©rieur par dÃ©faut)&lt;br&gt;Ã‰quivalent Ã  &lt;code&gt;0 PRECEDING&lt;/code&gt; ou &lt;code&gt;0 FOLLOWING&lt;/code&gt;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : la ligne courante ainsi que toutes les lignes ayant le mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;En dÃ©but de portÃ©e, la ligne utilisÃ©e sera la premiÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;En fin de portÃ©e, la ligne utilisÃ©e sera la derniÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : la ligne courante ainsi que toutes les lignes ayant le mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;En dÃ©but de portÃ©e, la ligne utilisÃ©e sera la premiÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;En fin de portÃ©e, la ligne utilisÃ©e sera la derniÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;n FOLLOWING&lt;/code&gt; :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : n = nombre de ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : n = nombre de rang/groupe.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : n = intervalle avec la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;UNDOUNDED FOLLOWING&lt;/code&gt; : toutes les lignes suivantes.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention aux restrictions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;le dÃ©but de la portÃ©e ne peut valoir &lt;code&gt;UNBOUNDED FOLLOWING&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La fin de la portÃ©e ne peut valoir &lt;code&gt;UNBOUNDED PRECEDING&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le dÃ©but de la portÃ©e doit toujours Ãªtre infÃ©rieur Ã  la fin de la portÃ©e (&lt;code&gt;ROWS BETWEEN 7 PRECEDING AND 8 PRECEDING&lt;/code&gt; ne donne aucune ligne et &lt;code&gt;RANGE BETWEEN CURRENT ROW AND &lt;em&gt;n&lt;/em&gt; PRECEDING&lt;/code&gt; renvoie une erreur).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que lorsque la clause &lt;code&gt;ORDER BY&lt;/code&gt; n&amp;rsquo;est pas spÃ©cifiÃ©e, toutes les lignes sont considÃ©rÃ©es comme ayant le mÃªme rang. Ainsi, il est important de tenir compte de cet Ã©lÃ©ment dans les modes &lt;code&gt;GROUPS&lt;/code&gt; et &lt;code&gt;RANGE&lt;/code&gt; et par consÃ©quent avec la limite par dÃ©faut qui est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;RANGE BETWEEN&#xA;&#x9;UNBOUNDED PRECEDING&#xA;AND&#xA;&#x9;CURRENT ROW&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En effet, avec la limite par dÃ©faut, toutes les lignes entre la premiÃ¨re de la partition et la ligne courante incluant les lignes de mÃªme rang sont utilisÃ©es. Ainsi, deux cas de figure se prÃ©sentes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Une clause &lt;code&gt;ORDER BY&lt;/code&gt; est spÃ©cifiÃ©e : une partie seulement des lignes de la partition est utilisÃ©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Aucune clause &lt;code&gt;ORDER BY&lt;/code&gt; n&amp;rsquo;est spÃ©cifiÃ©e : toutes les lignes possÃ¨dent le mÃªme rang, ainsi elles sont toutes incluses dans la fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans tous les cas, la distance jusqu&amp;rsquo;Ã  la fin de la portÃ©e est limitÃ©e par la distance jusqu&amp;rsquo;Ã  la fin de la partition. Si la limite dÃ©passe la fin de la partition, alors la derniÃ¨re ligne est la derniÃ¨re de la partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est enfin possible de dÃ©finir un ensemble de lignes Ã  exclure de la fenÃªtre avec la clause &lt;code&gt;EXCLUDE&lt;/code&gt; qui peut prendre les valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE NO OTHERS&lt;/code&gt; : ne rien exclure (comportement par dÃ©faut).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;CURRENT ROW&lt;/code&gt; : exclure la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE GROUP&lt;/code&gt; : exclure la ligne courante ainsi que toutes les lignes de mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE TIES&lt;/code&gt; : conserver la ligne courante mais exclure toutes les lignes de mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;FenÃªtres de fenÃªtre&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;une fenÃªtre est dÃ©finie sans clause de portÃ©e, il est possible d&amp;rsquo;en dÃ©finir une seconde Ã  partir de celle-ci.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans ce cas :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La seconde reprend le partitionnement de la fenÃªtre source.&lt;br&gt;Il est impossible de spÃ©cifier une clause &lt;code&gt;PARTITION BY&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La seconde reprend l&amp;rsquo;ordonnancement de la fenÃªtre source si la clause &lt;code&gt;ORDER BY&lt;/code&gt; existe.&lt;br&gt;Dans ce cas, il est impossible de spÃ©cifier une clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Sinon, la seconde peut se voir dÃ©finir un clause &lt;code&gt;ORDER BY&lt;/code&gt; qui lui sera spÃ©cifique.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La seconde peut avoir ses propres limites de fenÃªtre via sa propre clause de portÃ©e.&lt;br&gt;Si les limites ne sont pas dÃ©finies, les limites par dÃ©faut s&amp;rsquo;appliquent (&lt;code&gt;RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;-- Regroupement&#xA;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;ma_colonne_1&#xA;&#x9;),&#xA;&#xA;&#x9;ma_seconde_fenetre as (&#xA;&#x9;&#x9;-- FenÃªtre source&#xA;&#x9;&#x9;ma_fenetre&#xA;&#x9;&#x9;-- Ordonnancement (car la fenÃªtre source ne spÃ©cifie pas de clause ORDER BY)&#xA;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;ma_colonne_2&#xA;&#x9;&#x9;-- Limites spÃ©cifiques&#xA;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Les fonctions&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions de fenÃªtrage peuvent Ãªtre utilisÃ©es dans les clauses &lt;code&gt;SELECT&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; uniquement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ces fonctions regroupent Ã  la fois les fonctions spÃ©cifiques au fenÃªtrage (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-window.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentÃ©es ici&lt;/a&gt;) ainsi que certaines fonctions d&amp;rsquo;agrÃ©gation : celles Ã  but gÃ©nÃ©ral (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentÃ©es ici&lt;/a&gt;) et celles Ã  but statistique (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentÃ©es ici&lt;/a&gt;) mais pas les autres.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La syntaxe est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;fonction_fenetre(colonne) OVER ma_fenetre&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lors de l&amp;rsquo;utilisation de fonctions d&amp;rsquo;agrÃ©gation avec une fenÃªtre, il n&amp;rsquo;est pas possible d&amp;rsquo;utiliser les clauses &lt;code&gt;DISTINCT&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; dans les arguments de la fonction comme habituellement avec les fonctions d&amp;rsquo;agrÃ©gation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En revanche, ces fonctions d&amp;rsquo;agrÃ©gation autorisent le filtrage des lignes utilisÃ©es par celles-ci grÃ¢ce Ã  la clause &lt;code&gt;FILTER&lt;/code&gt; de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;fonction_fenetre(colonne) FILTER ( WHERE ma_clause_where ) OVER ma_fenetre&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est ainsi possible d&amp;rsquo;utiliser n&amp;rsquo;importe quelle condition qui sera testÃ©e sur chaque ligne de la fenÃªtre avant de fournir celles-ci Ã  la fonction. Les lignes ne satisfaisant pas la conditions seront ignorÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les principales fonctions de fenÃªtrage :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table alignwide has-fixed-layout is-style-stripes&#34;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Fonction&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;row_number()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;NumÃ©ro de ligne&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang de l&amp;rsquo;objet avec trou. &lt;br&gt;Comme row_number() mais deux objets peuvent avoir le mÃªme rang.&lt;br&gt;Par exemple : &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;6&lt;/code&gt;, &lt;code&gt;7&lt;/code&gt;, &lt;code&gt;7&lt;/code&gt;, &lt;code&gt;9&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;dense_rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang de l&amp;rsquo;objet sans trou. &lt;br&gt;Comme rank() mais si plusieurs objets ont le mÃªme rang, l&amp;rsquo;objet d&amp;rsquo;aprÃ¨s possÃ¨de le rang suivant.&lt;br&gt;Par exemple : &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;3&lt;/code&gt;, &lt;code&gt;4&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;6&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;percent_rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang en pourcentage (de 0% Ã  100%) : (rang -1) / (nb_ligne_total &amp;#8211; 1).&lt;br&gt;Par exemple (pour 4 valeurs) : &lt;code&gt;0%&lt;/code&gt;, &lt;code&gt;33%&lt;/code&gt;, &lt;code&gt;66%&lt;/code&gt;, &lt;code&gt;100%&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;cume_dist()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang en pourcentage (de n% Ã  100%) : (nb_lignes_prÃ©cÃ©dentes + nb_ligne_mÃªme_rang + 1) / (nb_ligne_total).&lt;br&gt;Par exemple (pour 4 valeurs) : &lt;code&gt;25%&lt;/code&gt;, &lt;code&gt;50%&lt;/code&gt;, &lt;code&gt;75%&lt;/code&gt;, &lt;code&gt;100%&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;first_value(colonne_1)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;PremiÃ¨re valeur issue de la fenÃªtre pour la colonne indiquÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;last_value(colonne_1)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;DerniÃ¨re valeur issue de la fenÃªtre pour la colonne indiquÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;nth_value(colonne_1,n)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur &amp;lsquo;n&amp;rsquo; issue de la fenÃªtre pour la colonne indiquÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;lag(colonne_1,n,&#39;text&#39;)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur issue de la fenÃªtre pour la colonne indiquÃ©e situÃ©e n lignes (defaut = &lt;code&gt;1&lt;/code&gt;) avant la ligne Ã©valuÃ©e. &lt;br&gt;Si aucune valeur n&amp;rsquo;existe, &amp;lsquo;text&amp;rsquo; (dÃ©faut = &lt;code&gt;NULL&lt;/code&gt;) est renvoyÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;lead(colonne_1,n,&#39;text&#39;)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur issue de la fenÃªtre pour la colonne indiquÃ©e situÃ©e n lignes (defaut = &lt;code&gt;1&lt;/code&gt;) aprÃ¨s la ligne Ã©valuÃ©e. &lt;br&gt;Si aucune valeur n&amp;rsquo;existe, &amp;lsquo;text&amp;rsquo; (dÃ©faut = &lt;code&gt;NULL&lt;/code&gt;) est renvoyÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Exemples&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Exemple basique&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;DonnÃ©es d&amp;rsquo;exemple&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour rÃ©aliser nos exemples, nous allons utiliser les donnÃ©es suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;valeur&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;13&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;23&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;30&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;31&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;32&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;33&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la requÃªte qui permet de crÃ©er une table contenant ces donnÃ©es, notez que les lignes sont dans le dÃ©sordre (pour mieux apprÃ©cier le fonctionnement des fenÃªtres) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- DROP TABLE public.test_fenetrage;&#xA;&#xA;CREATE TABLE public.test_fenetrage AS &#xA;SELECT&#xA;&#x9;*&#xA;FROM (&#xA;&#x9;VALUES&#xA;&#x9;&#x9;(&#39;C-3&#39;, &#39;C&#39;, 2, 32),&#xA;&#x9;&#x9;(&#39;A-1&#39;, &#39;A&#39;, 1, 10),&#xA;&#x9;&#x9;(&#39;C-1&#39;, &#39;C&#39;, 4, 30),&#xA;&#x9;&#x9;(&#39;B-4&#39;, &#39;B&#39;, 3, 23),&#xA;&#x9;&#x9;(&#39;B-3&#39;, &#39;B&#39;, 2, 22),&#xA;&#x9;&#x9;(&#39;A-2&#39;, &#39;A&#39;, 2, 11),&#xA;&#x9;&#x9;(&#39;C-4&#39;, &#39;C&#39;, 1, 33),&#xA;&#x9;&#x9;(&#39;B-1&#39;, &#39;B&#39;, 1, 20),&#xA;&#x9;&#x9;(&#39;C-2&#39;, &#39;C&#39;, 3, 31),&#xA;&#x9;&#x9;(&#39;A-3&#39;, &#39;A&#39;, 3, 12),&#xA;&#x9;&#x9;(&#39;A-4&#39;, &#39;A&#39;, 4, 13),&#xA;&#x9;&#x9;(&#39;B-2&#39;, &#39;B&#39;, 2, 21)&#xA;) as t1 (identifiant, groupe, ordre, valeur)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre par dÃ©faut&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un premier test avec la fenÃªtre par dÃ©faut :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons le numÃ©ro de ligne (&lt;code&gt;row_number&lt;/code&gt;) qui correspond au numÃ©ro d&amp;rsquo;ordre des lignes dans la fenÃªtre. Cette derniÃ¨re n&amp;rsquo;ayant pas de clause &lt;code&gt;ORDER BY&lt;/code&gt;, il s&amp;rsquo;agit du numÃ©ro d&amp;rsquo;ordre dans la table (dans le stockage physique).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous pouvons voir que toutes les lignes possÃ¨dent le mÃªme rang (&lt;code&gt;rank&lt;/code&gt;) car nous n&amp;rsquo;avons pas utilisÃ© la clause &lt;code&gt;ORDER BY&lt;/code&gt; dans la fenÃªtre. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons Ã©galement une information sur les valeurs immÃ©diatement prÃ©cÃ©dentes (&lt;code&gt;lag&lt;/code&gt;) et suivantes (&lt;code&gt;lead&lt;/code&gt;) de chaque ligne ainsi que la premiÃ¨re (&lt;code&gt;first_value&lt;/code&gt;) et la derniÃ¨re (&lt;code&gt;last_value&lt;/code&gt;) valeur de la partition (et donc de la table).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons utiliser la mÃªme fenÃªtre mais avec une clause &lt;code&gt;ORDER BY&lt;/code&gt; au niveau de la requÃªte :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;ORDER BY&#xA;&#x9;identifiant&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devriez avoir les rÃ©sultats suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons exactement les mÃªmes donnÃ©es que prÃ©cÃ©demment mais l&amp;rsquo;ordre des lignes n&amp;rsquo;est pas le mÃªme. Ceci dÃ©montre que le fenÃªtrage permet de calculer des donnÃ©es sur des ensembles bien spÃ©cifiques avec un ordre bien spÃ©cifique.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Fonctionnement du CURRENT ROW&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Testez la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER fenetre_range,&#xA;&#x9;rank() OVER fenetre_range,&#xA;&#x9;first_value(identifiant) OVER fenetre_range as first_value_range,&#xA;&#x9;last_value(identifiant) OVER fenetre_range as last_value_range,&#xA;&#x9;first_value(identifiant) OVER fenetre_row as first_value_row,&#xA;&#x9;last_value(identifiant) OVER fenetre_row as last_value_row&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;fenetre_range AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;),&#xA;&#x9;fenetre_row AS (&#xA;&#x9;&#x9;ROWS&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Elle renvoie ces rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value_range&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value_range&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value_row&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value_row&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voyez la diffÃ©rence entre les modes &lt;code&gt;RANGE&lt;/code&gt; (ou &lt;code&gt;GROUPS&lt;/code&gt;) et &lt;code&gt;ROWS&lt;/code&gt;. Avec les deux premiers modes, &lt;code&gt;CURRENT ROW&lt;/code&gt; inclut toutes les lignes de mÃªme rang que la ligne courante. La premiÃ¨re ligne correspond alors Ã  la premiÃ¨re ligne de mÃªme rang que la ligne courante remontÃ©e par la requÃªte. C&amp;rsquo;est la mÃªme chose pour la derniÃ¨re ligne.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme il n&amp;rsquo;y a pas de sous ordre dÃ©finit au sein d&amp;rsquo;un mÃªme rang, c&amp;rsquo;est l&amp;rsquo;ordre de stockage des lignes qui est utilisÃ©. Ainsi, la premiÃ¨re ligne d&amp;rsquo;un rang donnÃ© correspond Ã  la premiÃ¨re ligne de ce rang rencontrÃ© lors du parcours de la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre partitionnÃ©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisons maintenant les partitions avec &lt;code&gt;PARTITION BY&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;groupe,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;PARTITION BY&#xA;&#x9;&#x9;&#x9;groupe&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/th&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les calculs sont maintenant effectuÃ©s Â«Â par partitionÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est intÃ©ressant de constater que les lignes ont Ã©tÃ© rÃ©ordonnÃ©es, c&amp;rsquo;est Ã  cause du &lt;code&gt;PARTITION BY&lt;/code&gt; qui implique une rÃ©organisation des lignes lors du calcul. Notez cependant que les lignes conservent leur positionnement d&amp;rsquo;origine au sein de chaque partition (A-4 est avant A-2 qui est avant A-1 qui est avant A-3 comme dans la table d&amp;rsquo;origine).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre ordonnancÃ©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;RemplaÃ§ons les partitions par &lt;code&gt;ORDER BY&lt;/code&gt; afin dâ€™ordonnancer nos valeurs :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;ordre,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;dense_rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;ordre ASC&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es suivantes sont renvoyÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dense_rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La partition s&amp;rsquo;Ã©tend maintenant Ã  toute la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est intÃ©ressant de constater que les lignes ont ici aussi Ã©tÃ© rÃ©ordonnÃ©es, c&amp;rsquo;est Ã  cause du &lt;code&gt;ORDER BY&lt;/code&gt; qui implique une rÃ©organisation des lignes lors du calcul.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;IntÃ©ressons nous aux colonnes &lt;code&gt;row_number&lt;/code&gt;, &lt;code&gt;rank&lt;/code&gt; et &lt;code&gt;dense_rank&lt;/code&gt;. Nous pouvons maintenant voir la diffÃ©rence entre ces fonctions :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;row_number&lt;/code&gt; indique le numÃ©ro de ligne aprÃ¨s le rÃ©ordonnancement effectuÃ© par la fenÃªtre. &lt;br&gt;A-1, B-1 et C-4 possÃ¨de le numÃ©ro d&amp;rsquo;ordre 1, il est donc logique de les retrouver en 1&lt;sup&gt;Ã¨re&lt;/sup&gt;, 2&lt;sup&gt;Ã¨me&lt;/sup&gt; et 3&lt;sup&gt;Ã¨me&lt;/sup&gt; place.&lt;br&gt;Notez que C-4 est avant A-1 qui est avant B-1 ce qui correspond Ã  leurs positionnements dans la table d&amp;rsquo;origine.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;rank&lt;/code&gt; permet de dÃ©finir le rang de chaque ligne. &lt;br&gt;A-1, B-1 et C-4 possÃ¨de le numÃ©ro d&amp;rsquo;ordre 1, il possÃ¨dent donc tous les trois le rang 1. A-2, B-2, B-3 et C-3 possÃ¨de la valeur d&amp;rsquo;ordre 2, il sont donc au rang suivant : 4. &lt;br&gt;Le numÃ©ro de rang correspond au premier numÃ©ro de ligne (&lt;code&gt;row_number&lt;/code&gt;) du groupe de lignes Ã©quivalentes.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;dense_rank&lt;/code&gt; permet de dÃ©finir le rang de chaque ligne mais sans trous.&lt;br&gt;A-1, B-1 et C-4 sont au rang 1 puis A-2, B-2, B-3 et C-3 sont au rang 2.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre partitionnÃ©e et ordonnancÃ©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Combinons le &lt;code&gt;PARTITION BY&lt;/code&gt; avec le &lt;code&gt;ORDER BY&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;groupe,&#xA;&#x9;ordre,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;dense_rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;PARTITION BY&#xA;&#x9;&#x9;&#x9;groupe&#xA;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;ordre ASC&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dense_rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons maintenant des donnÃ©es calculÃ©es pour chaque partition en utilisant un ordre d&amp;rsquo;affichage spÃ©cifique.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Statistiques sur mon dernier voyage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons maintenant voir un cas lÃ©gÃ¨rement plus concret. Il s&amp;rsquo;agit d&amp;rsquo;un petit tour que j&amp;rsquo;ai fait en Europe et dont j&amp;rsquo;aimerais calculer quelques statistiques.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-bleu-dodger-color has-text-color has-link-color wp-elements-3c6d8cfd14dcc1cdeb3ec9c6ac006d7c&#34;&gt;Notez que vous aurez besoin de PostGIS pour cet exemple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- DROP TABLE public.voyage_fenetrage;&#xA;&#xA;CREATE TABLE public.voyage_fenetrage AS &#xA;SELECT&#xA;  *&#xA;FROM (&#xA;  VALUES&#xA;    (&#39;2023-07-01&#39;::date, &#39;Maison&#39;, &#39;Maison&#39;, &#39;SRID=4326;POINT(6.3183 46.19)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-01&#39;::date, &#39;Suisse&#39;, &#39;GenÃ¨ve&#39;, &#39;SRID=4326;POINT(6.14 46.20)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-03&#39;::date, &#39;Suisse&#39;, &#39;Berne&#39;, &#39;SRID=4326;POINT(7.44 46.95)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-07&#39;::date, &#39;Suisse&#39;, &#39;Zurich&#39;, &#39;SRID=4326;POINT(8.54 47.37)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-10&#39;::date, &#39;Autriche&#39;, &#39;Innsbruck&#39;, &#39;SRID=4326;POINT(11.39 47.26)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-12&#39;::date, &#39;Allemagne&#39;, &#39;Munich&#39;, &#39;SRID=4326;POINT(11.58 48.14)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-17&#39;::date, &#39;Allemagne&#39;, &#39;Francfort&#39;, &#39;SRID=4326;POINT(8.68 50.11)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-21&#39;::date, &#39;Allemagne&#39;, &#39;Berlin&#39;, &#39;SRID=4326;POINT(13.41 52.52)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-25&#39;::date, &#39;Allemagne&#39;, &#39;Hambourg&#39;, &#39;SRID=4326;POINT(9.99 53.55)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-29&#39;::date, &#39;Danemark&#39;, &#39;Copenhague&#39;, &#39;SRID=4326;POINT(12.58 55.68)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-01&#39;::date, &#39;Royaume-Uni&#39;, &#39;Ã‰dimbourg&#39;, &#39;SRID=4326;POINT(-3.20 55.95)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-05&#39;::date, &#39;Royaume-Uni&#39;, &#39;Glasgow&#39;, &#39;SRID=4326;POINT(-4.25 55.86)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-09&#39;::date, &#39;Royaume-Uni&#39;, &#39;Manchester&#39;, &#39;SRID=4326;POINT(-2.24 53.48)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-13&#39;::date, &#39;Royaume-Uni&#39;, &#39;Londres&#39;, &#39;SRID=4326;POINT(0 51.51)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-16&#39;::date, &#39;France&#39;, &#39;Paris&#39;, &#39;SRID=4326;POINT(2.35 48.85)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-20&#39;::date, &#39;France&#39;, &#39;Nantes&#39;, &#39;SRID=4326;POINT(-1.55 47.21)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-22&#39;::date, &#39;France&#39;, &#39;Toulouse&#39;, &#39;SRID=4326;POINT(1.44 43.60)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-25&#39;::date, &#39;France&#39;, &#39;Marseille&#39;, &#39;SRID=4326;POINT(5.37 43.29)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-28&#39;::date, &#39;France&#39;, &#39;Annecy&#39;, &#39;SRID=4326;POINT(6.13 45.90)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-31&#39;::date, &#39;Maison&#39;, &#39;Maison&#39;, &#39;SRID=4326;POINT(6.3183 46.19)&#39;::geometry(point, 4326))&#xA;) as t1 (date_arrive, pays, ville, geom)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je considÃ¨re que la date d&amp;rsquo;arrivÃ©e quelque part correspond Ã  la date d&amp;rsquo;arrivÃ©e Ã  l&amp;rsquo;Ã©tape suivante.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le but est d&amp;rsquo;avoir des informations tout au long du trajet : distance parcourue, pourcentage d&amp;rsquo;avancement, avancement par pays&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons utiliser plusieurs fenÃªtres en parallÃ¨le afin de calculer ce dont nous avons besoin.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;  -- Localisation Ã©tape&#xA;  concat(ville, &#39; (&#39;, pays, &#39;)&#39;) AS etape,&#xA;  -- Date d&#39;arrivÃ©e&#xA;  date_arrive,&#xA;  -- Date de dÃ©part : date d&#39;arrivÃ©e de la ligne suivante&#xA;  lead(date_arrive, 1) OVER toutes_lignes AS date_depart,&#xA;  -- DurÃ©e de l&#39;Ã©tape&#xA;  lead(date_arrive, 1) OVER toutes_lignes - date_arrive AS duree_etape,&#xA;  -- DurÃ©e totale du voyage trajet depuis la premiÃ¨re localisation&#xA;  -- Fonction first_value permettant de rÃ©cupÃ©rer la premiÃ¨re ligne de la fenÃªtre&#xA;  date_arrive - first_value(date_arrive) OVER toutes_lignes AS duree_voyage,&#xA;  -- Distance parcourue depuis la localisation prÃ©cÃ©dente&#xA;  -- Fonction lag permettant de rÃ©cupÃ©rer la ligne prÃ©cÃ©dente&#xA;  -- ST_DistanceSpheroid pour obtenir la distance entre deux coordonnÃ©es en WGS84&#xA;  ST_DistanceSpheroid(&#xA;    geom, &#xA;    lag(geom, 1) OVER toutes_lignes,&#xA;    &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;  )::integer/1000 AS distance_depuis_loc_precedente,&#xA;  -- Distance totale parcourue depuis la premiÃ¨re localisation&#xA;  -- Fonction ST_MakeLine permettant de crÃ©er une ligne constituÃ©e de l&#39;ensemble des points de la fenÃªtre&#xA;  -- L&#39;ordre des point est assurÃ© par la fenÃªtre&#xA;  -- ST_DistanceSpheroid pour obtenir la longueur d&#39;une ligne en WGS84&#xA;  ST_LengthSpheroid(&#xA;    ST_MakeLine(geom) OVER lignes_precedentes,&#xA;    &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;  )::integer/1000 AS distance_parcourue,&#xA;  -- Calcul d&#39;un pourcentage de parcours en comparant les valeurs issues de calculs sur deux fenÃªtres diffÃ©rentes&#xA;  round(&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER lignes_precedentes,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric /&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER toutes_lignes,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric *&#xA;    100,&#xA;    2&#xA;  ) AS pourcentage_trajet,&#xA;  -- Calcul d&#39;un pourcentage de parcours par pays en comparant les valeurs issues de calculs sur deux fenÃªtres diffÃ©rentes&#xA;  -- La fonction nullif permet d&#39;Ã©liminer les divisions par 0&#xA;  round(&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER lignes_precedentes_pays,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric /&#xA;    nullif(ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER toutes_lignes_pays,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric,0) *&#xA;    100,&#xA;    2&#xA;  ) AS pourcentage_trajet_pays&#xA;FROM &#xA;  public.voyage_fenetrage&#xA;WINDOW&#xA;  toutes_lignes AS (&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        UNBOUNDED FOLLOWING&#xA;  ),&#xA;  lignes_precedentes AS (&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        CURRENT ROW&#xA;  ),&#xA;  toutes_lignes_pays AS (&#xA;    PARTITION BY &#xA;      pays&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        UNBOUNDED FOLLOWING&#xA;  ),&#xA;  lignes_precedentes_pays AS (&#xA;    PARTITION BY &#xA;      pays&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        CURRENT ROW&#xA;  )&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;etape&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;date_arrive&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;date_depart&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;duree_etape&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;duree_voyage&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;distance_depuis_loc_precedente&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;distance_parcourue&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pourcentage_trajet&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pourcentage_trajet_pays&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Maison (Maison)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;GenÃ¨ve (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-03&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0,28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Berne (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-03&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-07&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;129&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;144&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,76&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;57,61&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Zurich (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-07&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;95&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;240&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Innsbruck (Autriche)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;215&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;456&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8,69&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Munich (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;98&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;554&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10,58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Francfort (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-21&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;304&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;859&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16,38&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;30,89&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Berlin (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-21&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;424&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1â€¯284&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24,48&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;73,99&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Hambourg (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-29&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;256&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1â€¯540&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;29,37&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Copenhague (Danemark)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-29&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;290&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1â€¯830&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;34,9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Ã‰dimbourg (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;987&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2â€¯818&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;53,72&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Glasgow (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;35&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;66&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2â€¯884&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;54,99&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10,58&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Manchester (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;39&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;294&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3â€¯179&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;60,61&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;57,53&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Londres (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;43&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;266&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3â€¯446&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;65,7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Paris (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;46&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;340&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3â€¯786&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;72,18&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Nantes (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-22&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;50&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;343&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4â€¯130&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;78,72&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24,11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Toulouse (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-22&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;52&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;464&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4â€¯594&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;87,57&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;56,72&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Marseille (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;55&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;319&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4â€¯914&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;93,67&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;79,19&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Annecy (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;296&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5â€¯210&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;99,32&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Maison (Maison)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;61&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;35&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5â€¯246&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous voyez qu&amp;rsquo;avec le fenÃªtrage il devient simple de rÃ©aliser tout un tas de calculs divers et variÃ©s sur vos donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un excellent exemple est Ã©galement fournit dans l&amp;rsquo;article suivant oÃ¹ je me sers du fenÃªtrage pour dÃ©terminer le parcours du PÃ¨re NoÃ«l dans la nuit du 24 au 25.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-embed aligncenter is-type-wp-embed is-provider-bazinga-039-s wp-block-embed-bazinga-039-s&#34;&gt;&lt;div class=&#34;wp-block-embed__wrapper&#34;&gt;&#xA;&lt;blockquote class=&#34;wp-embedded-content&#34; data-secret=&#34;1XkVFCGu98&#34;&gt;&lt;a href=&#34;https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis&#34;&gt;Suivons le PÃ¨re NoÃ«l avec PostGIS (Nouvelle version)&lt;/a&gt;&lt;/blockquote&gt;&lt;iframe loading=&#34;lazy&#34; class=&#34;wp-embedded-content&#34; sandbox=&#34;allow-scripts&#34; security=&#34;restricted&#34;  title=&#34;Â«Â Suivons le PÃ¨re NoÃ«l avec PostGIS (Nouvelle version)Â Â» &amp;#8212; BazinGa&amp;#039;s&#34; src=&#34;https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis/embed#?secret=31T1XinWsi#?secret=1XkVFCGu98&#34; data-secret=&#34;1XkVFCGu98&#34; width=&#34;600&#34; height=&#34;338&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34;&gt;&lt;/iframe&gt;&#xA;&lt;/div&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cet article fait parti du cours sur PostgreSQL, parties 3 et 4 du Vade-mecum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-vertical is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-4 wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/sql/postgresql-tout-comprendre-1&#34;&gt;Cours sur PostgreSQL&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/sql/postgresql-vade-mecum-3#le_fenetrage&#34;&gt;Vade-mecum &amp;#8211; 3 &amp;#8211; GÃ©rer la donnÃ©e&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-4#fonction_de_fenetrage&#34;&gt;Vade-mecum &amp;#8211; 4 &amp;#8211; Fonctions et opÃ©rateurs&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/ouvrez-les-fenetres-de-postgresql-guide-complet-sur-le-fenetrage" rel="alternate"></link>
    <summary type="html">Voici un guide complet sur l&#39;utilisation du fenÃªtrage sous PostgreSQL. Ces fonctionnalitÃ©s sont particuliÃ¨rement pratique lors de l&#39;analyse de donnÃ©es continues.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Suivons le PÃ¨re NoÃ«l avec PostGIS (Nouvelle version)</title>
    <updated>2023-12-14T13:23:01Z</updated>
    <id>tag:blog.arthurbazin.com,2023-12-14:/bdd/postgresql/suivons-le-pere-noel-avec-postgis</id>
    <content type="html">&#xA;&lt;p&gt;Cette annÃ©e pour NoÃ«l, j&amp;rsquo;ai eu l&amp;rsquo;idÃ©e de monter une application de suivi du PÃ¨re NoÃ«l en temps rÃ©el. &lt;a href=&#34;https://santatracker.google.com/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;Google&lt;/a&gt; le fait dÃ©jÃ  et le &lt;a href=&#34;https://www.noradsanta.org/fr/index.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;NORAD&lt;/a&gt; aussi alors pourquoi pas un frenchy ?&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme j&amp;rsquo;ai Â«Â quelques notionsÂ Â» de SQL et que je travaille chez &lt;a href=&#34;https://www.business-geografic.com/fr/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;Business Geografic&lt;/a&gt; (&lt;a href=&#34;https://www.cirilgroup.com/fr/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;Ciril GROUP&lt;/a&gt;) (Ã©diteur franÃ§ais de solutions cartographiques web) qui a accepter de suivre ma dÃ©marche, j&amp;rsquo;ai tous les outils nÃ©cessaires Ã  une telle application sous la main. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la suite des explications, c&amp;rsquo;est juste en dessous de l&amp;rsquo;appli (que vous pouvez consulter en plein Ã©cran sur &lt;a href=&#34;https://noel.cirilgroup.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;noel.cirilgroup.com&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;iframe loading=&#34;lazy&#34; id=&#34;iframe_santa_tracker&#34; title=&#34;Le voyage du PÃ¨re NoÃ«l&#34; src=&#34;https://geoservices.business-geografic.com/adws/app/c2d0e97d-6c09-11ed-9a76-19bfa8332a84/&#34; width=&#34;100%&#34; height=&#34;650px&#34;&gt;&#xA;&lt;/iframe&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que cet article sâ€™intÃ©resse surtout Ã  la partie donnÃ©e (PostgreSQL + PostGIS) et moins Ã  la partie conception de l&amp;rsquo;application qui repose sur &lt;a href=&#34;https://www.business-geografic.com/fr/geo-software/geo-technologies.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;GEO Software de Business Geografic (Ciril GROUP)&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;hr class=&#34;wp-block-separator has-alpha-channel-opacity is-style-default&#34;/&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le suivi, j&amp;rsquo;ai un peu Ã©tudier la chose et il s&amp;rsquo;avÃ¨re qu&amp;rsquo;un traineau magique, Ã§a nâ€™apparait pas sur les radars. Il est donc compliquÃ© de suivre le bonhomme. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;MalgrÃ© mes nombreux courriers, le PÃ¨re NoÃ«l refuse Ã©galement de m&amp;rsquo;envoyer son itinÃ©raire dÃ©taillÃ©, un petit GPX aurait pourtant bien fait mon affaire mais il semble qu&amp;rsquo;il n&amp;rsquo;utilise pas de GPS&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut donc un peu ruser pour suivre Santa Ã  la trace et voici comment j&amp;rsquo;ai procÃ©dÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le principe est de partir d&amp;rsquo;une liste de destinations que le PÃ¨re NoÃ«l va visiter. On calcule ensuite le trajet pour rejoindre toutes ces destinations en tenant compte du fait que le passage doit s&amp;rsquo;effectuer durant la nuit du 24 au 25 dÃ©cembre et que la terre tourne donc que l&amp;rsquo;heure de passage s&amp;rsquo;Ã©tale de GMT+12 Ã  GMT-12 (d&amp;rsquo;est en ouest). Plus facile Ã  dire qu&amp;rsquo;a faire mais essayons.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;application repose sur PostgreSQL 11 + PostGIS 2.5 (je sais, c&amp;rsquo;est oldschool mais Ã§a tourne bien) mais vous pouvez utiliser les requÃªtes suivantes dans PostgreSQL 15 + PostGIS 3.x.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous serons dans le schÃ©ma suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE SCHEMA IF NOT EXISTS santa_tracker;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Destination&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A priori, le PÃ¨re NoÃ«l visite toutes les maisons du monde. Ceci dit, Â«Â toutes les maisons du mondeÂ Â» c&amp;rsquo;est complexe Ã  cartographier : un igloo doit il Ãªtre considÃ©rÃ© comme une maison mÃªme s&amp;rsquo;il n&amp;rsquo;a pas de cheminÃ©e ? &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Alors simplifions un peu la chose et basons nous sur l&amp;rsquo;ensemble des villes du monde. Bon lÃ  aussi c&amp;rsquo;est complexe car il y a vraiment beaucoup de villes et Ã§a risque d&amp;rsquo;Ãªtre difficile de suivre tous les dÃ©placements. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Simplifions encore et prenons environ 500 destinations parmi les plus connues dans le monde (avec une sur reprÃ©sentation des villes de lâ€™hexagone ;-).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour rÃ©cupÃ©rer ces donnÃ©es, une petite recherche sur internet et nous voila avec &lt;a rel=&#34;noreferrer noopener nofollow&#34; href=&#34;https://public.opendatasoft.com/explore/dataset/geonames-all-cities-with-a-population-1000/&#34; target=&#34;_blank&#34;&gt;un magnifique jeu de donnÃ©es&lt;/a&gt; du monde entier dont la population est supÃ©rieure Ã  1000 habitants.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quelques traitements plus tard (rien de bien sorcier, juste des formules magiques pour rÃ©cupÃ©rer les villes qui m&amp;rsquo;intÃ©ressent) nous voici avec la table suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE santa_tracker.destination (&#xA;&#x9;-- Un identifiant numÃ©rique&#xA;&#x9;id_destination int8 PRIMARY KEY,&#xA;&#x9;-- La rÃ©gion de la destination&#xA;&#x9;region text,&#xA;&#x9;-- Le nom de la destination&#xA;&#x9;ville text,&#xA;&#x9;-- Le nombre d&#39;habitant dans cette destination&#xA;&#x9;population int8,&#xA;&#x9;-- L&#39;interval de temps entre le fuseau horaire de la destination et GMT&#xA;&#x9;utc_offset interval,&#xA;&#x9;-- L&#39;emplacement de la destination&#xA;&#x9;geom public.geometry(point, 4326)&#xA;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;ProblÃ¨me, cette table ne possÃ¨de pas l&amp;#8217;emplacement du PÃ¨re NoÃ«l&amp;#8230; Nous allons rusÃ© pour cela.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Quelques variables&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour les diffÃ©rents calculs que nous allons mener, je vais avoir besoin de dÃ©finir certains paramÃ¨tres. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, nous allons crÃ©er une vue dans laquelle nous stockerons des variables que nous pourrons utiliser dans nos diffÃ©rentes requÃªtes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_00_variable CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_00_variable as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;-- Population&#xA;&#x9;&#x9;-- Le nombre total d&#39;Ãªtre humain sur Terre&#xA;&#x9;&#x9;8000000000 as pop_total,&#xA;&#x9;&#x9;-- Le pourcentage de personne recevant des cadeaux (oui, certains ont Ã©tÃ© mÃ©chants cette annÃ©e)&#xA;&#x9;&#x9;0.95 as cadeau_par_pop,&#xA;&#x9;&#x9;-- Le nombre de cadeau par personnes&#xA;&#x9;&#x9;1 as cadeau_par_pers,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;-- Autres donnÃ©es&#xA;&#x9;&#x9;-- Largeur d&#39;une zone de longitude (ce qui permet de diviser le globe en secteurs de passage)&#xA;&#x9;&#x9;10 as largeur_zone_longitude,&#xA;&#x9;&#x9;-- Le pourcentage de temps total passÃ© Ã  voler de maison en maison (ici 90% de temps de vol donc 10% du temps passÃ© dans les maisons)&#xA;&#x9;&#x9;90::numeric as pourcent_temps_de_vol,&#xA;&#x9;&#x9;-- Les informations sur l&#39;emplacement de la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;jsonb_build_object(&#xA;&#x9;&#x9;&#x9;&#39;id&#39;, 0,&#xA;&#x9;&#x9;&#x9;&#39;region&#39;, &#39;Svalbard&#39;,&#xA;&#x9;&#x9;&#x9;&#39;ville&#39;, &#39;Maison de la famille NoÃ«l&#39;,&#xA;&#x9;&#x9;&#x9;&#39;population&#39;, 2,&#xA;&#x9;&#x9;&#x9;&#39;utc_offset&#39;, 1,&#xA;&#x9;&#x9;&#x9;&#39;geom_4326&#39;, &#39;SRID=4326;POINT(24 80)&#39;&#xA;&#x9;&#x9;) as maison_pere_noel,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;-- Dates et horaire&#xA;&#x9;&#x9;-- Les dates contiennent toujours les heures&#xA;&#x9;&#x9;-- Le temps est exprimÃ© en temps UTC&#xA;&#x9;&#x9;-- L&#39;heure exacte du dÃ©but de la distribution (le 24 dÃ©cembre Ã  19h sur le premier fuseau horaire)&#xA;&#x9;&#x9;(extract(year from now()) || &#39;-12-24 19:00:00 +12&#39;)::timestamp with time zone as debut_distrib,&#xA;&#x9;&#x9;-- L&#39;heure exacte de la fin de la distribution (le 25 dÃ©cembre Ã  5h sur le dernier fuseau horaire)&#xA;&#x9;&#x9;(extract(year from now()) || &#39;-12-25 05:00:00 -12&#39;)::timestamp with time zone as fin_distrib,&#xA;&#x9;&#x9;-- DurÃ©e du trajet pour rejoindre la premiÃ¨re destination depuis la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;-- DurÃ©e Ã©galement pour rejoindre la maison du PÃ¨re NoÃ«l depuis la derniÃ¨re maison&#xA;&#x9;&#x9;&#39;2 minutes&#39;::interval as delai_dest_santa_house,&#xA;&#xA;&#x9;&#x9;-- Heure du dÃ©but de la transaction&#xA;&#x9;&#x9;--transaction_timestamp() as &#34;now&#34;&#x9;-- Maintenant&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez l&amp;rsquo;utilisation des heures avec fuseau horaire car il faut tenir compte des diffÃ©rents emplacements sur Terre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le calcul des dates, on utilise une extraction de l&amp;rsquo;annÃ©e depuis la fonction &lt;code&gt;transaction_timestamp()&lt;/code&gt; afin de rendre la vue valide tous les ans.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On dÃ©finit Ã©galement une variable &lt;code&gt;now&lt;/code&gt; que l&amp;rsquo;on utilisera lors des calculs Ã  un instant t car cela permet de faire des tests en fixant cette valeur. Cette derniÃ¨re peut Ãªtre modifiÃ©e pour vos tests, voila quelques moments possibles :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Heure du dÃ©but de la transaction&#xA;transaction_timestamp() as &#34;now&#34;&#x9;-- Maintenant&#xA;&#39;2023-07-03 08:00:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Fabrication&#xA;&#39;2023-12-24 07:59:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage aller&#xA;&#39;2023-12-24 19:00:10 +1200&#39;::timestamp WITH time zone as &#34;now&#34; -- Distribution 1Ã¨re destination&#xA;&#39;2023-12-24 19:00:45 +1200&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage depuis 1Ã¨re destination&#xA;&#39;2023-12-25 00:29:25 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Distribution Ã  GenÃ¨ve&#xA;&#39;2023-12-25 00:30:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage depuis GenÃ¨ve&#xA;&#39;2023-12-25 05:01:00 -1200&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage retour&#xA;&#39;2023-12-27 08:00:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Repos&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Trajet&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous devons maintenant calculer le trajet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce trajet doit rÃ©pondre au critÃ¨res suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Passer par toutes les destinations&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;DÃ©marrer et finir par la maison du PÃ¨re NoÃ«l&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Chaque destination doit Ãªtre visitÃ©e la nuit&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons donc devoir dÃ©couper la Terre en zones de passage dans lesquelles le PÃ¨re NoÃ«l aura un timing bien spÃ©cifique Ã  respecter. Le principe est de dÃ©terminer l&amp;rsquo;intervalle de temps pendant lequel le PÃ¨re NoÃ«l effectue sa tournÃ©e puis de diviser cet intervalle par le nombre de zones de passage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans la vue &lt;code&gt;v_00_variable&lt;/code&gt; j&amp;rsquo;avais indiquÃ© un dÃ©coupage en zone de 10 degrÃ©s mais notez que si aucune destination nâ€™existe dans une zone, il ne faudra alors pas en tenir compte.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;intervalle est dÃ©finit par les dates de dÃ©but et de fin de la tournÃ©e spÃ©cifiÃ©es dans la vue &lt;code&gt;v_00_variable&lt;/code&gt; : du 24 dÃ©cembre Ã  19h (+12) jusqu&amp;rsquo;au 25 dÃ©cembre Ã  5h (-12) : 1j et 10h soit 34h.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour calculer le trajet et pouvoir relancer le calcul facilement, je vais me baser sur plusieurs vues.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Calcul du rang longitudinal&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le principe est d&amp;rsquo;attribuer Ã  chaque destination un numÃ©ro de rang correspondant au numÃ©ro d&amp;rsquo;ordre de la zone de longitude Ã  laquelle appartient la destination.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une zone de longitude est une portion de la surface terrestre comprise entre deux bornes de longitudes. Ces bornes sont dÃ©finies par rapport Ã  un dÃ©coupage du globe tous les x degrÃ©s ; x Ã©tant dÃ©fini dans la vue &lt;code&gt;v_00_variable&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_01_destination_rang_longitudeCASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_01_destination_rang_longitude as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration du rang de chaque zone de longitude (plage de x degrÃ© dÃ©finit dans la vue v_00_variable)&#xA;&#x9;&#x9;-- Le fenÃªtrage permet d&#39;Ã©liminer les zones sans destination&#xA;&#x9;&#x9;dense_rank() OVER zone_longitude as rang_longitude,&#xA;&#x9;&#x9;geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.destination &#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;zone_longitude AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;floor(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(-ST_X(geom) + 180)::numeric &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;/ var.largeur_zone_longitude&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;+ 1&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Ordonnancement par latitude&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Au sein de chaque zone de longitude, les destinations sont ordonnancÃ©es afin d&amp;rsquo;avoir un trajet cohÃ©rent allant du nord au sud dans une zone puis du sud au nord dans la zone suivante dans un mouvement Ã  l&amp;rsquo;effet Â«Â yoyoÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_02_destination_rang_latitude CASCADE;&#xA;&#xA;CREATE VIEW santa_tracker.v_02_destination_rang_latitude as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration du rang de chaque destination au sein de sa zone de longitude&#xA;&#x9;&#x9;-- Le rang est dÃ©terminÃ© par la latitude de l&#39;objet&#xA;&#x9;&#x9;-- Pour faire un effet &#34;yoyo&#34;, on inverse l&#39;ordonnancement des latitudes une zone de longitude sur deux&#xA;&#x9;&#x9;row_number() OVER zone_latitude as rang_latitude,&#xA;&#x9;&#x9;last_value(rang_longitude) OVER all_zone_longitude as nb_zone_longitude,&#xA;&#x9;&#x9;count(id_destination) OVER part_by_zone_longitude as nb_destination_in_zone,&#xA;&#x9;&#x9;geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_01_destination_rang_longitude&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;zone_latitude AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN rang_longitude % 2 = 0 THEN ST_Y(geom)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE -ST_Y(geom)&#xA;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;part_by_zone_longitude AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY rang_longitude&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;all_zone_longitude AS (&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Consolidation des destinations&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque destination, on va calculer plusieurs valeurs, notamment des cumuls par rapport aux destination prÃ©cÃ©dentes. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette vue est une sorte de version amÃ©liorÃ©e de la table &lt;code&gt;destination&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_03_destination CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_03_destination as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la prochaine destination&#xA;&#x9;&#x9;first_value(id_destination) OVER next_etape as id_destination_next,&#xA;&#x9;&#x9;first_value(region) OVER next_etape as region_next,&#xA;&#x9;&#x9;first_value(ville) OVER next_etape as ville_next,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;-- CrÃ©ation d&#39;une valeur de population fictive&#xA;&#x9;&#x9;-- pour qu&#39;une fois toutes destination visitÃ©es, le PÃ¨re NoÃ«l ait vu toute la population mondiale&#xA;&#x9;&#x9;round( &#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(population / sum(population) OVER ()) &#xA;&#x9;&#x9;&#x9;&#x9;* var.pop_total::NUMERIC&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as pop_fictive,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;-- Rang de l&#39;Ã©tape&#xA;&#x9;&#x9;row_number() OVER all_etape as rang_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;-- Temps de passage dans chaque zone&#xA;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;(var.fin_distrib - var.debut_distrib) &#xA;&#x9;&#x9;&#x9;/ nb_zone_longitude &#xA;&#x9;&#x9;) AS duree_zone,&#xA;&#x9;&#x9;-- Temps de passage dans chaque destination (distribution + trajet pour la suivante)&#xA;&#x9;&#x9;-- DurÃ©e totale / nb zone longitude = durÃ©e par zone&#xA;&#x9;&#x9;-- DurÃ©e par zone / nb Ã©tape dans zone = temps par Ã©tape&#xA;&#x9;&#x9;-- Pour la derniÃ¨re zone, on retire le temps du dernier trajet (retour Ã  la maison du PÃ¨re NoÃ«l)&#xA;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;WHEN rang_longitude = nb_zone_longitude THEN &#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.fin_distrib - var.debut_distrib) &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;/ nb_zone_longitude &#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;/ (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;((nb_destination_in_zone - 1) * (var.pourcent_temps_de_vol/100))&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;+ (nb_destination_in_zone * ((100 - var.pourcent_temps_de_vol)/100))&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;ELSE &#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.fin_distrib - var.debut_distrib) &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;/ nb_zone_longitude &#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;/ nb_destination_in_zone&#xA;&#x9;&#x9;END as duree_destination,&#xA;&#x9;&#x9;-- On reprojete les donnÃ©es pour travailler en coordonnÃ©es projetÃ©es&#xA;&#x9;&#x9;ST_Transform(geom, 3857) as geom,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la gÃ©omÃ©trie de la prochaine destination&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;first_value(geom) OVER next_etape,&#xA;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;) as geom_next&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_02_destination_rang_latitude&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;all_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude, &#xA;&#x9;&#x9;&#x9;&#x9;rang_latitude&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;next_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude, &#xA;&#x9;&#x9;&#x9;&#x9;rang_latitude&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Ã‰tapes de distribution&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A partir des donnÃ©es des destination, on gÃ©nÃ¨re des Ã©tapes de distribution des cadeaux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pendant ces Ã©tapes, le PÃ¨re NoÃ«l s&amp;rsquo;arrÃªte dans la destination et distribue les prÃ©sents.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_04_etape_distribution CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_04_etape_distribution as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la prochaine destination&#xA;&#x9;&#x9;-- S&#39;il n&#39;y a pas de prochaine destination, alors on retourne chez le PÃ¨re NoÃ«l&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(id_destination) OVER next_etape,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;id&#39;)::int&#xA;&#x9;&#x9;) as id_destination_next,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(region) OVER next_etape,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39;&#xA;&#x9;&#x9;) as region_next,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(ville) OVER next_etape,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39;&#xA;&#x9;&#x9;) as ville_next,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;-- CrÃ©ation d&#39;une valeur de population fictive&#xA;&#x9;&#x9;-- pour qu&#39;une fois toutes destination visitÃ©es, le PÃ¨re NoÃ«l ait vu toute la population mondiale&#xA;&#x9;&#x9;round( &#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;population * var.pop_total::NUMERIC&#xA;&#x9;&#x9;&#x9;&#x9;/ sum(population) OVER ()&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as pop_fictive,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(utc_offset) OVER next_etape,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval&#xA;&#x9;&#x9;) as utc_offset_next,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;(1 - (var.pourcent_temps_de_vol / 100)) * (duree_destination) AS duree_etape,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer l&#39;heure de dÃ©but de l&#39;Ã©tape&#xA;&#x9;&#x9;var.debut_distrib + &#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(duree_destination) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;&#39;0&#39;::interval&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;as date_debut,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer l&#39;heure de fin de l&#39;Ã©tape&#xA;&#x9;&#x9;var.debut_distrib &#xA;&#x9;&#x9;+ (1 - (var.pourcent_temps_de_vol / 100)) * (duree_destination) &#xA;&#x9;&#x9;+ coalesce(&#xA;&#x9;&#x9;&#x9;sum(duree_destination) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;&#39;0&#39;::interval&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;as date_fin,&#xA;&#x9;&#x9;-- Trajet effectuÃ© (ici ce sera un point)&#xA;&#x9;&#x9;-- On utilise une gÃ©omÃ©trie de type ligne pour homogÃ©nÃ©Ã¯ser les types de gÃ©omÃ©trie avec les trajets&#xA;&#x9;&#x9;ST_MakeLine(geom, geom) as geom,&#xA;&#x9;&#x9;geom AS geom_etape,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la gÃ©omÃ©trie de la prochaine destination&#xA;&#x9;&#x9;-- S&#39;il n&#39;y a pas de prochaine destination, alors on retourne chez le PÃ¨re NoÃ«l&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;&#x9;first_value(geom) OVER next_etape,&#xA;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;) as geom_etape_next&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_03_destination&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;next_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY rang_etape&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;all_preceding_step AS (&#xA;&#x9;&#x9;&#x9;ORDER BY rang_etape&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Ã‰tapes de trajet&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A partir des donnÃ©es des destination, on gÃ©nÃ¨re Ã©galement des Ã©tapes de trajet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pendant ces Ã©tapes, le PÃ¨re NoÃ«l vol Ã  bord de son traineau de destination en destination.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_05_trajet CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_05_trajet as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;-- Il n&#39;y a aucune population lors du vol&#xA;&#x9;&#x9;0 AS population,&#xA;&#x9;&#x9;0 AS pop_fictive,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;-- La durÃ©e du trajet est Ã©gale Ã  la durÃ©e totale de la destination moins la durÃ©e de l&#39;Ã©tape&#xA;&#x9;&#x9;duree_destination - duree_etape AS duree_trajet,&#xA;&#x9;&#x9;-- La date de dÃ©but du trajet est identique Ã  la date de fin de l&#39;Ã©tape&#xA;&#x9;&#x9;date_fin AS date_debut,&#xA;&#x9;&#x9;-- La date de fin correspond Ã  la date de dÃ©but de l&#39;Ã©tape + la durÃ©e sur la destination&#xA;&#x9;&#x9;date_debut + duree_destination AS date_fin,&#xA;&#x9;&#x9;-- Trajet effectuÃ©&#xA;&#x9;&#x9;ST_MakeLine(geom_etape, geom_etape_next) as geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_04_etape_distribution&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;-- On ne calcul pas de trajet pour le retour Ã  la maison du PÃ¨re NoÃ«l&#xA;&#x9;WHERE &#xA;&#x9;&#x9;id_destination_next &amp;lt;&gt; 0&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Construction du voyage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour crÃ©er le voyage, les Ã©tapes suivantes sont associÃ©es (via des &lt;code&gt;UNION ALL&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le trajet de la maison du PÃ¨re NoÃ«l jusqu&amp;rsquo;Ã  la premiÃ¨re destination (crÃ©Ã© dans la requÃªte).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les Ã©tapes de distribution des cadeaux.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les Ã©tapes de trajet entre destinations.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le trajet de derniÃ¨re destination jusqu&amp;rsquo;Ã  la la maison du PÃ¨re NoÃ«l (crÃ©Ã© dans la requÃªte).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les Ã©lÃ©ments sont ensuite rÃ©agencÃ©s selon l&amp;rsquo;ordre de passage afin de pouvoir calculer certains cumuls (population visitÃ©e, cadeaux distribuÃ©s, distance parcourue&amp;#8230;)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_06_voyage CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_06_voyage as (&#xA;&#xA;WITH &#xA;&#x9;all_steps AS (&#xA;&#x9;&#x9;-- Trajet de la maison du PÃ¨re NoÃ«l Ã  la premiÃ¨re destination&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;etp.id_destination AS id_destination_next,&#xA;&#x9;&#x9;&#x9;etp.region AS region_next,&#xA;&#x9;&#x9;&#x9;etp.ville AS ville_next,&#xA;&#x9;&#x9;&#x9;-- Il n&#39;y a aucune population lors du vol&#xA;&#x9;&#x9;&#x9;0 AS population,&#xA;&#x9;&#x9;&#x9;0 AS pop_fictive,&#xA;&#x9;&#x9;&#x9;0 AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;etp.utc_offset AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;0 AS rang_longitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_latitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_etape,&#xA;&#x9;&#x9;&#x9;1 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Trajet&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;0 AS nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;0 AS nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e totale pour la destination est uniquement la durÃ©e du trajet (pas de distribution)&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_destination,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e du trajet est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_etape,&#xA;&#x9;&#x9;&#x9;-- La date de dÃ©but du trajet est calculÃ©e par rapport aux variables&#xA;&#x9;&#x9;&#x9;var.debut_distrib - var.delai_dest_santa_house AS date_debut,&#xA;&#x9;&#x9;&#x9;-- La date de fin est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.debut_distrib AS date_fin,&#xA;&#x9;&#x9;&#x9;-- Trajet effectuÃ©&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;etp.geom_etape&#xA;&#x9;&#x9;&#x9;) AS geom&#x9;&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable AS var&#xA;&#x9;&#x9;LEFT JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_04_etape_distribution AS etp&#xA;&#x9;&#x9;&#x9;ON etp.rang_etape = 1&#xA;&#x9;&#x9;UNION ALL &#xA;&#x9;&#x9;-- Etapes de distribution des cadeaux&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;&#x9;-- Nombre de cadeau distribuÃ©&#xA;&#x9;&#x9;&#x9;round( var.cadeau_par_pop * pop_fictive::numeric, 0) AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;&#x9;2 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Distribution&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_04_etape_distribution&#xA;&#x9;&#x9;CROSS JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;UNION ALL &#xA;&#x9;&#x9;-- Trajets entre les Ã©tapes de distribution&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;&#x9;0 AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;&#x9;2 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Trajet&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;&#x9;duree_trajet AS duree_etape,&#xA;&#x9;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_05_trajet&#xA;&#x9;&#x9;UNION ALL&#xA;&#x9;&#x9;-- Trajet de la derniÃ¨re destination Ã  la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;etp.id_destination AS id_destination,&#xA;&#x9;&#x9;&#x9;etp.region AS region,&#xA;&#x9;&#x9;&#x9;etp.ville AS ville,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville_next,&#xA;&#x9;&#x9;&#x9;-- Il n&#39;y a aucune population lors du vol&#xA;&#x9;&#x9;&#x9;0 AS population,&#xA;&#x9;&#x9;&#x9;0 AS pop_fictive,&#xA;&#x9;&#x9;&#x9;0 AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;etp.utc_offset AS utc_offset,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;0 AS rang_longitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_latitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_etape,&#xA;&#x9;&#x9;&#x9;3 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Trajet&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;0 AS nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;0 AS nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e totale pour la destination est uniquement la durÃ©e du trajet (pas de distribution)&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_destination,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e du trajet est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_etape,&#xA;&#x9;&#x9;&#x9;-- La date de dÃ©but du trajet est calculÃ©e par rapport aux variables&#xA;&#x9;&#x9;&#x9;var.fin_distrib AS date_debut,&#xA;&#x9;&#x9;&#x9;-- La date de fin est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.fin_distrib + var.delai_dest_santa_house AS date_fin,&#xA;&#x9;&#x9;&#x9;-- Trajet effectuÃ©&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;etp.geom_etape,&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;) AS geom&#x9;&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable AS var&#xA;&#x9;&#x9;LEFT JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_04_etape_distribution AS etp&#xA;&#x9;&#x9;&#x9;ON etp.rang_etape = 440&#xA;&#x9;)&#xA;&#x9;SELECT &#xA;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#39;-&#39;,&#xA;&#x9;&#x9;&#x9;rang_voyage::text,&#xA;&#x9;&#x9;&#x9;rang_longitude::text,&#xA;&#x9;&#x9;&#x9;rang_latitude::text,&#xA;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Distribution&#39; THEN &#39;d&#39;&#xA;&#x9;&#x9;&#x9;&#x9;ELSE &#39;t&#39;&#xA;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;) AS id_voyage,&#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de population visitÃ©e&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(pop_fictive) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as pop_fictive_cumul,&#xA;&#x9;&#x9;cadeau_distribue,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de population visitÃ©e&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(cadeau_distribue) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as cadeau_distribue_cumul,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;rang_voyage,&#xA;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de temps de voyage&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(duree_etape) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;&#39;0 second&#39;::interval&#xA;&#x9;&#x9;) as duree_etape_cumul,&#xA;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;-- Distance parcourue durant le trajet&#xA;&#x9;&#x9;round(&#xA;&#x9;&#x9;&#x9;ST_Length(geom)::NUMERIC,&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as distance_to_next,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de distance parcourue&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;round(&#xA;&#x9;&#x9;&#x9;&#x9;(sum(ST_Length(geom)) OVER all_preceding_step)::NUMERIC,&#xA;&#x9;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as distance_cumul,&#xA;&#x9;&#x9;-- Azimuth du symbole sur la carte&#xA;&#x9;&#x9;Degrees(ST_Azimuth(ST_StartPoint(geom),ST_EndPoint(geom))) as azimuth,&#xA;&#x9;&#x9;-- Orientation du symbole sur la carte&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;WHEN Degrees(ST_Azimuth(ST_StartPoint(geom),ST_EndPoint(geom))) &amp;lt; 180 THEN &#39;Est&#39; &#xA;&#x9;&#x9;&#x9;ELSE &#39;Ouest&#39;&#xA;&#x9;&#x9;END as orientation,&#xA;&#x9;&#x9;geom::geometry(linestring,3857)&#xA;&#x9;FROM &#xA;&#x9;&#x9;all_steps&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;all_preceding_step AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_voyage,&#xA;&#x9;&#x9;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;&#x9;&#x9;type_etape&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On fixe ensuite les donnÃ©es du voyage dans une vue matÃ©rialisÃ©e pour amÃ©liorer les performance lors de la consultation :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP MATERIALIZED VIEW IF EXISTS santa_tracker.vm_06_voyage CASCADE;&#xA;&#xA;CREATE MATERIALIZED VIEW santa_tracker.vm_06_voyage as (&#xA;&#x9;SELECT * &#xA;&#x9;FROM santa_tracker.v_06_voyage&#xA;)&#xA;WITH DATA&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;L&#39;Â Â»instant tÂ Â»&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Avoir un trajet c&amp;rsquo;est bien mais connaitre toutes les infos sur le trajet Ã  un Â«Â instant tÂ Â», c&amp;rsquo;est mieux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;DonnÃ©es&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons crÃ©er une nouvelle vue qui va se baser sur la vue matÃ©rialisÃ©e &lt;code&gt;vm_06_voyage&lt;/code&gt; pour calculer la position du PÃ¨re NoÃ«l et divers les paramÃ¨tres au moment de la consultation de cette vue.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette vue dÃ©finies trois grands temps dans l&amp;rsquo;annÃ©e :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Du 1er janvier au 24 dÃ©cembre : le PÃ¨re NoÃ«l se trouve chez lui et fabrique les cadeaux&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Du 24 au 25 dÃ©cembre : le PÃ¨re NoÃ«l distribue les cadeaux selon les donnÃ©es prÃ©sentes dans la vue matÃ©rialisÃ©e &lt;code&gt;vm_06_voyage&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;A partir du 25 dÃ©cembre : le PÃ¨re NoÃ«l se repose chez lui aprÃ¨s tout ce travail.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#xA;&#xA;&#xA;DROP VIEW IF EXISTS santa_tracker.v_instant_t CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_instant_t as (&#xA;&#xA;WITH &#xA;&#x9;voyage_instant_t as (&#xA;&#x9;&#x9;-- Etape de prÃ©paration des cadeaux&#xA;&#x9;&#x9;-- Cette Ã©tape sera visible du 1er janvier au dÃ©but de la tournÃ©e&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;&#39;PrÃ©paratifs&#39; as type_trajet,&#xA;&#x9;&#x9;&#x9;&#39;0-0-0-p&#39; AS id_voyage,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination,&#xA;&#x9;&#x9;&#x9;NULL AS id_destination_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;NULL as region_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;NULL as ville_next,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;population&#39;)::integer AS population,&#xA;&#x9;&#x9;&#x9;NULL as pop_fictive,&#xA;&#x9;&#x9;&#x9;NULL as pop_fictive_cumul,&#xA;&#x9;&#x9;&#x9;-- Nombre total de cadeau total Ã  fabriquer&#xA;&#x9;&#x9;&#x9;(var.pop_total * var.cadeau_par_pop) as cadeau_distribue,&#xA;&#x9;&#x9;&#x9;0 as cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;NULL AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time ZONE - var.debut_distrib)::interval as duree_etape,&#xA;&#x9;&#x9;&#x9;&#39;0 second&#39;::interval as duree_etape_cumul,&#xA;&#x9;&#x9;&#x9;-- DÃ©but de fabrication le 1er janvier (fuseau horaire du PÃ¨re NoÃ«l)&#xA;&#x9;&#x9;&#x9;(extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone as date_debut,&#xA;&#x9;&#x9;&#x9;-- Fin de fabrication lors du dÃ©but de la distribution&#xA;&#x9;&#x9;&#x9;var.debut_distrib as date_fin,&#xA;&#x9;&#x9;&#x9;-- Calcul du pourcentage d&#39;avancement sur l&#39;Ã©tape&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.&#34;now&#34;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from ((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone))&#xA;&#x9;&#x9;&#x9;&#x9;) / (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.debut_distrib)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from ((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone))&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;)::NUMERIC as avancement,&#xA;&#x9;&#x9;&#x9;NULL as distance_to_next,&#xA;&#x9;&#x9;&#x9;NULL as distance_cumul,&#xA;&#x9;&#x9;&#x9;0 AS azimuth,&#xA;&#x9;&#x9;&#x9;NULL AS orientation,&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326), &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;) as geom &#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &amp;lt; (var.debut_distrib - var.delai_dest_santa_house)&#xA;&#x9;&#x9;UNION ALL&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration des Ã©tapes du voyage&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;&#x9;id_voyage,&#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;&#x9;pop_fictive_cumul,&#xA;&#x9;&#x9;&#x9;cadeau_distribue,&#xA;&#x9;&#x9;&#x9;cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;&#x9;duree_etape_cumul,&#xA;&#x9;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;&#x9;-- Calcul du pourcentage d&#39;avancement sur l&#39;Ã©tape&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.&#34;now&#34;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from date_debut)&#xA;&#x9;&#x9;&#x9;&#x9;) / (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from date_fin)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from date_debut)&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;)::NUMERIC as avancement,&#xA;&#x9;&#x9;&#x9;distance_to_next,&#xA;&#x9;&#x9;&#x9;distance_cumul,&#xA;&#x9;&#x9;&#x9;azimuth,&#xA;&#x9;&#x9;&#x9;orientation,&#xA;&#x9;&#x9;&#x9;geom &#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.vm_06_voyage as t&#xA;&#x9;&#x9;CROSS JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;WHERE &#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &gt;= date_debut&#xA;&#x9;&#x9;AND &#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &amp;lt; date_fin&#xA;&#x9;&#x9;UNION ALL&#xA;&#x9;&#x9;-- Ajout d&#39;une Ã©tape de repos&#xA;&#x9;&#x9;-- Cette Ã©tape sera visible aprÃ¨s la fin de la tournÃ©e &#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;&#39;Repos&#39; as type_trajet,&#xA;&#x9;&#x9;&#x9;&#39;0-0-0-r&#39; AS id_voyage,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination,&#xA;&#x9;&#x9;&#x9;NULL AS id_destination_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;NULL as region_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;NULL as ville_next,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;population&#39;)::integer AS population,&#xA;&#x9;&#x9;&#x9;NULL as pop_fictive,&#xA;&#x9;&#x9;&#x9;var.pop_total as pop_fictive_cumul,&#xA;&#x9;&#x9;&#x9;(var.pop_total * var.cadeau_par_pop) as cadeau_distribue,&#xA;&#x9;&#x9;&#x9;(var.pop_total * var.cadeau_par_pop) as cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;NULL AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-12-31 23:59:59 +01&#39;)::timestamp with time ZONE - var.fin_distrib)::interval as duree_etape,&#xA;&#x9;&#x9;&#x9;&#39;0 second&#39;::interval as duree_etape_cumul,&#xA;&#x9;&#x9;&#x9;-- DÃ©but du repos Ã  la fin de la distribution&#xA;&#x9;&#x9;&#x9;var.fin_distrib as date_debut,&#xA;&#x9;&#x9;&#x9;-- Fin du repos le 1er janvier Ã  00h00 (fuseau horaire du PÃ¨re NoÃ«l)&#xA;&#x9;&#x9;&#x9;((extract(year from now()) + 1)::text || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone as date_fin,&#xA;&#x9;&#x9;&#x9;-- Calcul du pourcentage d&#39;avancement sur l&#39;Ã©tape&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.&#34;now&#34;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from var.fin_distrib)&#xA;&#x9;&#x9;&#x9;&#x9;) / (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.fin_distrib)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from ((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone))&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;)::NUMERIC as avancement,&#xA;&#x9;&#x9;&#x9;NULL as distance_to_next,&#xA;&#x9;&#x9;&#x9;NULL as distance_cumul,&#xA;&#x9;&#x9;&#x9;0 AS azimuth,&#xA;&#x9;&#x9;&#x9;NULL AS orientation,&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326), &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;) as geom &#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &gt; (var.fin_distrib + var.delai_dest_santa_house)&#xA;&#x9;)&#xA;SELECT &#xA;&#x9;type_trajet,&#xA;&#x9;id_voyage,&#xA;&#x9;id_destination,&#xA;&#x9;id_destination_next,&#xA;&#x9;region,&#xA;&#x9;region_next,&#xA;&#x9;ville,&#xA;&#x9;ville_next,&#xA;&#x9;population,&#xA;&#x9;pop_fictive,&#xA;&#x9;pop_fictive_cumul,&#xA;&#x9;-- Calcul du nombre de personnes visitÃ©es au moment de la visualisation&#xA;&#x9;round(&#xA;&#x9;&#x9;pop_fictive_cumul + &#xA;&#x9;&#x9;(pop_fictive * avancement)::numeric,&#xA;&#x9;&#x9;0&#xA;&#x9;) as pop_fictive_cumul_actuel,&#xA;&#x9;cadeau_distribue,&#xA;&#x9;cadeau_distribue_cumul,&#xA;&#x9;-- Calcul du nombre de cadeau distribuÃ© au moment de la visualisation&#xA;&#x9;round(&#xA;&#x9;&#x9;cadeau_distribue_cumul + &#xA;&#x9;&#x9;(cadeau_distribue * avancement)::numeric,&#xA;&#x9;&#x9;0&#xA;&#x9;) as cadeau_cumul_actuel,&#xA;&#x9;utc_offset,&#xA;&#x9;utc_offset_next,&#xA;&#x9;duree_etape,&#xA;&#x9;date_debut,&#xA;&#x9;date_fin,&#xA;&#x9;avancement,&#xA;&#x9;distance_to_next,&#xA;&#x9;distance_cumul,&#xA;&#x9;-- Calcul de la distance parcourue au moment de la visualisation&#xA;&#x9;round(&#xA;&#x9;&#x9;distance_cumul + &#xA;&#x9;&#x9;(distance_to_next * avancement)::numeric,&#xA;&#x9;&#x9;0&#xA;&#x9;) as distance_cumul_actuel,&#xA;&#x9;azimuth,&#xA;&#x9;orientation,&#xA;&#x9;-- Calcul de l&#39;emplacement au moment de la visualisation&#xA;&#x9;ST_LineInterpolatePoint(geom, avancement)::geometry(point,3857) as geom&#xA;FROM &#xA;&#x9;voyage_instant_t&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Affichage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Selon le moment de l&amp;rsquo;annÃ©e, nous n&amp;rsquo;allons pas afficher les mÃªmes donnÃ©es. Dans le cadre de l&amp;rsquo;application, j&amp;rsquo;ai mis en forme les donnÃ©es avec beaucoup de HTML, c&amp;rsquo;est peu lisible et nous allons donc ici gÃ©nÃ©rer quelque chose de beaucoup plus simple mais avec les mÃªmes informations.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ons une vue qui rÃ©cupÃ¨re les donnÃ©es et les mets en forme :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_instant_t_affichage CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_instant_t_affichage as (&#xA;&#xA;SELECT &#xA;&#x9;id_voyage,&#xA;&#x9;type_trajet,&#xA;&#x9;-- On gÃ©nÃ¨re des paroles du PÃ¨re NoÃ«l.&#xA;&#x9;-- Le texte varie selon le moment de l&#39;annÃ©e et change toutes les 10 secondes&#xA;&#x9;jsonb_extract_path_text(&#xA;&#x9;&#x9;$${&#xA;&#x9;&#x9;&#x9;&#34;PrÃ©paratifs&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Vive le vent d&#34;,&#34;hiver !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum ?!&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Quel beau camion !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Ah, une belle poupÃ©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Trajet&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux NoÃ«l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez comÃ¨te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Distribution&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh hisse !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;SerrÃ©e cette cheminÃ©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Chut, pas un bruit !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum un petit biscuit...&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Repos&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;RONFFFFFFFLE&#34;&#xA;&#x9;&#x9;&#x9;]&#xA;&#x9;&#x9;}$$::jsonb,&#xA;&#x9;&#x9;type_trajet,&#xA;&#x9;&#x9;FLOOR(EXTRACT(second from transaction_timestamp()) / 10)::text&#xA;&#x9;) as parole,&#xA;&#x9;CASE &#xA;&#x9;&#x9;WHEN type_trajet = &#39;PrÃ©paratifs&#39; THEN &#39;Le PÃ¨re NoÃ«l prÃ©pare les cadeaux&#39;&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Trajet&#39; THEN &#39;Le PÃ¨re NoÃ«l voyage vers un nouveau lieu de distribution&#39;&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Distribution&#39; THEN &#39;Le PÃ¨re NoÃ«l est en cours de distribution&#39;&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Repos&#39; THEN &#39;Le PÃ¨re NoÃ«l a terminÃ© et prend un repos bien mÃ©ritÃ©&#39;&#xA;&#x9;END AS titre,&#xA;&#x9;ville || &#39; (&#39; || region || &#39;)&#39; AS ville,&#xA;&#x9;ville_next || &#39; (&#39; || region_next || &#39;)&#39; AS ville_next,&#xA;&#x9;concat(&#xA;&#x9;&#x9;NULLIF(extract(day from (date_fin - var.&#34;now&#34;)), 0) || &#39; jours, &#39;,&#xA;&#x9;&#x9;NULLIF(extract(hour from (date_fin - var.&#34;now&#34;)), 0) || &#39; heures, &#39;,&#xA;&#x9;&#x9;NULLIF(extract(minute from (date_fin - var.&#34;now&#34;)), 0) || &#39; minutes et &#39;,&#xA;&#x9;&#x9;NULLIF(round(extract(second from (date_fin - var.&#34;now&#34;))::numeric, 0), 0) || &#39; secondes&#39;&#xA;&#x9;) AS timer,&#xA;&#x9;to_char(date_debut,&#39;DD TMmon YYYY&#39;) AS date_debut,&#xA;&#x9;to_char(date_debut,&#39;HH24:MI:SS&#39;) AS heure_debut,&#xA;&#x9;to_char(date_debut AT TIME ZONE utc_offset,&#39;DD TMmon YYYY&#39;) AS date_debut_local,&#xA;&#x9;to_char(date_debut AT TIME ZONE utc_offset,&#39;HH24:MI:SS&#39;) AS heure_debut_local,&#xA;&#x9;to_char(date_fin,&#39;DD TMmon YYYY&#39;) AS date_fin,&#xA;&#x9;to_char(date_fin,&#39;HH24:MI:SS&#39;) AS heure_fin,&#xA;&#x9;to_char(date_fin AT TIME ZONE utc_offset,&#39;DD TMmon YYYY&#39;) AS date_fin_local,&#xA;&#x9;to_char(date_fin AT TIME ZONE utc_offset,&#39;HH24:MI:SS&#39;) AS heure_fin_local,&#xA;&#x9;trim(to_char(cadeau_cumul_actuel, &#39;999 999 999 999&#39;)) AS cadeau,&#xA;&#x9;trim(to_char(pop_fictive_cumul_actuel, &#39;999 999 999 999&#39;)) AS population,&#xA;&#x9;trim(to_char(distance_cumul_actuel/1000, &#39;999 999 999 999 km&#39;)) AS distance&#xA;FROM&#xA;&#x9;santa_tracker.v_instant_t&#xA;CROSS JOIN&#xA;&#x9;santa_tracker.v_00_variable as var &#xA;&#x9;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est maintenant possible d&amp;rsquo;appeler la vue avec un SELECT qui finalise la mise en forme. N&amp;rsquo;hÃ©sitez pas Ã  utiliser du HTML.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id_voyage,&#xA;&#x9;CASE &#xA;&#x9;&#x9;WHEN type_trajet = &#39;PrÃ©paratifs&#39; THEN &#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Emplacement actuel : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;DÃ©part prÃ©vu dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux fabriquÃ©s : &#39; || cadeau&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Trajet&#39; THEN&#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;DÃ©collage : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;le &#39; || date_debut || &#39; Ã  &#39; || heure_debut,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_debut_local || &#39; Ã  &#39; || heure_debut_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;ArrivÃ©e prÃ©vue dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Atterissage : &#39; || ville_next ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_fin_local || &#39; Ã  &#39; || heure_fin_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux distribuÃ©s : &#39; || cadeau,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Population visitÃ©e : &#39; || population,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Distance parcourue : &#39; || distance&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Distribution&#39; THEN&#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Emplacement actuel : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;ArrivÃ© sur place le &#39; || date_debut || &#39; Ã  &#39; || heure_debut,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_debut_local || &#39; Ã  &#39; || heure_debut_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Prochain dÃ©part le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_fin_local || &#39; Ã  &#39; || heure_fin_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Prochaine destination : &#39; || ville_next ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux distribuÃ©s : &#39; || cadeau,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Population visitÃ©e : &#39; || population,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Distance parcourue : &#39; || distance&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Repos&#39; THEN&#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Emplacement actuel : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Prochaine fabrication de cadeau dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux distribuÃ©s : &#39; || cadeau,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Population visitÃ©e : &#39; || population&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;END as informations&#xA;FROM&#xA;&#x9;santa_tracker.v_instant_t_affichage&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voila un exemple de rÃ©ponse :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-columns is-layout-flex wp-container-core-columns-is-layout-1 wp-block-columns-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&#xA;&lt;p class=&#34;has-text-align-center&#34;&gt;&lt;strong&gt;Le PÃ¨re NoÃ«l est en cours de distribution&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Petit mot du PÃ¨re NoÃ«l : Oh hisse !&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Emplacement actuel : Anadyr (Russie)&lt;br&gt;ArrivÃ© sur place le 24 dÃ©c. 2023 Ã  08:00:00&lt;br&gt;(24 dÃ©c. 2023 Ã  19:00:00 heure locale)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prochaine destination : Majuro Atoll (Ãles Marshall)&lt;br&gt;DÃ©part dans 36 secondes&lt;br&gt;Le 24 dÃ©c. 2023 Ã  08:00:37&lt;br&gt;(24 dÃ©c. 2023 Ã  19:00:37 heure locale)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cadeaux distribuÃ©s : 7 222&lt;br&gt;Population visitÃ©e : 7 602&lt;br&gt;Distance parcourue : 18 108 km&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;L&amp;rsquo;Ã©tat des lieux&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque destination, il est possible de voir en temps rÃ©el si le PÃ¨re NoÃ«l est passÃ© ou non. Pour cela nous allons nous appuyer sur la table des destinations ainsi que la vue matÃ©rialisÃ©e &lt;code&gt;vm_06_voyage&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Vue contenant toutes les destinations&#xA;DROP VIEW IF EXISTS santa_tracker.v_destination CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_destination AS &#xA;&#xA;WITH &#xA;&#x9;all_destinations AS (&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration de toutes les destinations&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.destination&#xA;&#x9;&#x9;UNION&#xA;&#x9;&#x9;-- Ajout de la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;id&#39;)::integer AS id_destination,&#xA;&#x9;&#x9;&#x9;maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;population&#39;)::integer AS population,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(Point,4326) AS geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable&#xA;&#x9;)&#xA;&#x9;SELECT &#xA;&#x9;&#x9;t1.id_destination,&#xA;&#x9;&#x9;t1.region,&#xA;&#x9;&#x9;t1.ville,&#xA;&#x9;&#x9;t1.population,&#xA;&#x9;&#x9;t1.utc_offset,&#xA;&#x9;&#x9;-- GÃ©nÃ©ration d&#39;un message d&#39;information sur l&#39;Ã©tat de passage&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;-- S&#39;il n&#39;y a pas de date de dÃ©but (pas de distribution) alors il s&#39;agit de la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;&#x9;WHEN voy.date_debut IS NULL THEN &#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; var.debut_distrib THEN &#39;Le PÃ¨re NoÃ«l prÃ©pare les cadeaux&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; var.fin_distrib THEN &#39;Le PÃ¨re NoÃ«l est absent&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE &#39;Le PÃ¨re NoÃ«l se repose&#39;&#xA;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;-- Sinon on dÃ©termine si la visite est rÃ©alisÃ©e en fonction de l&#39;heure de passage&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &gt; voy.date_fin  THEN &#39;A reÃ§u la visite du PÃ¨re NoÃ«l&#39;&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &gt; voy.date_debut  THEN &#39;Le PÃ¨re NoÃ«l est ici, Youpi !&#39;&#xA;&#x9;&#x9;&#x9;ELSE &#39;Attend la visite du PÃ¨re NoÃ«l&#39;&#xA;&#x9;&#x9;END AS informations,&#xA;&#x9;&#x9;t1.geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;all_destinations AS t1&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable AS var&#xA;&#x9;LEFT JOIN &#xA;&#x9;&#x9;santa_tracker.vm_06_voyage as voy&#xA;&#x9;&#x9;ON voy.id_destination = t1.id_destination&#xA;&#x9;&#x9;AND voy.type_etape = &#39;Distribution&#39;&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;hr class=&#34;wp-block-separator has-alpha-channel-opacity&#34;/&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center&#34;&gt;Voila ! J&amp;rsquo;espÃ¨re que Ã§a vous a plu et n&amp;rsquo;hÃ©sitez pas Ã  suivre le PÃ¨re NoÃ«l !!&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center has-rouge-color has-text-color&#34;&gt;&lt;a href=&#34;https://noel.cirilgroup.com/index.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;&lt;strong&gt;noel.cirilgroup.com&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center has-rouge-color has-text-color has-large-font-size&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.0.3/72x72/1f384.png&#34; alt=&#34;ğŸ„&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; &lt;strong&gt;Joyeux NoÃ«l !!&lt;/strong&gt; &lt;img src=&#34;https://s.w.org/images/core/emoji/15.0.3/72x72/1f384.png&#34; alt=&#34;ğŸ„&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/p&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis" rel="alternate"></link>
    <summary type="html">DÃ©couvrez ce qui se cache derriÃ¨re une application de suivi du PÃ¨re NoÃ«l. Une liste de destination, quelques requÃªtes SQL et le tour est jouÃ© ? Ce n&#39;est pas aussi simple que Ã§a, vous allez le voir...&#xA;En partenariat avec Ciril GROUP.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Substituer une variable dans un script SQL</title>
    <updated>2024-11-25T08:00:00Z</updated>
    <id>tag:fljd.in,2024-11-25:/2024/11/25/substituer-une-variable-dans-un-script-sql/</id>
    <link href="https://fljd.in/2024/11/25/substituer-une-variable-dans-un-script-sql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Il est frÃ©quent de vouloir automatiser une tÃ¢che rÃ©pÃ©titive en la scriptant&#xA;rapidement, puis Ã  force d&amp;rsquo;itÃ©rations, de l&amp;rsquo;enrichir, voire de l&amp;rsquo;intÃ©grer dans&#xA;la base de code d&amp;rsquo;un projet. Ã€ ce jeu, les outils comme SQL*Plus et psql peuvent&#xA;Ãªtre de puissants alliÃ©s et des interprÃ©teurs aussi pertinents que Bash ou&#xA;Python.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des projets de migration que je mÃ¨ne rÃ©guliÃ¨rement, il m&amp;rsquo;arrive de&#xA;tomber sur ces scripts, en grand nombre. Certains ont la particularitÃ© de&#xA;proposer des paramÃ¨tres d&amp;rsquo;entrÃ©e, traitÃ©s par SQL*Plus avec le mÃ©canisme trÃ¨s&#xA;confortable de substitution de variables. Dans cet article, je partage quelques&#xA;astuces pour convertir certains aspects de ces scripts grÃ¢ce aux fonctionnalitÃ©s&#xA;Ã©quivalentes que l&amp;rsquo;on retrouve sur l&amp;rsquo;outil psql de PostgreSQL.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Poissons et coquillages</title>
    <updated>2024-10-14T08:30:00Z</updated>
    <id>tag:fljd.in,2024-10-14:/2024/10/14/poissons-et-coquillages/</id>
    <link href="https://fljd.in/2024/10/14/poissons-et-coquillages/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;En tant que pur produit acadÃ©mique des annÃ©es 2010, mon langage de script de prÃ©dilection a&#xA;toujours Ã©tÃ© le Bash (&lt;em&gt;Bourne Again Shell&lt;/em&gt;). Non sans ignorer qu&amp;rsquo;il ait pu en exister d&amp;rsquo;autres, je&#xA;ne me suis jamais vraiment tournÃ© vers d&amp;rsquo;autres shells pour automatiser les tÃ¢ches du quotidien&#xA;dans mon mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;Et pour cause, j&amp;rsquo;ai administrÃ© des centaines de serveurs de distributions trÃ¨s variÃ©es et il&#xA;n&amp;rsquo;Ã©tait pas bien vu d&amp;rsquo;installer des dÃ©pendances systÃ¨mes lourdes pour enrichir des scripts Python&#xA;ou Perl. Nous apprenions donc Ã  Ã©crire des scripts portables et universels, compatibles partout&#xA;oÃ¹ nous dÃ©posions nos valises.&lt;/p&gt;&#xA;&lt;p&gt;Me suis-je enfermÃ© dans un dogme conservateur, en m&amp;rsquo;interdisant &lt;em&gt;de facto&lt;/em&gt; Ã  me tourner vers des&#xA;shells modernes et bien plus aisÃ©s Ã  apprÃ©henderÂ ?&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Les types hiÃ©rarchiques</title>
    <updated>2024-09-19T11:20:00Z</updated>
    <id>tag:fljd.in,2024-09-19:/2024/09/19/les-types-hierarchiques/</id>
    <link href="https://fljd.in/2024/09/19/les-types-hierarchiques/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Bien que la norme SQL dÃ©finisse un ensemble de rÃ¨gles pour que les systÃ¨mes de bases&#xA;de donnÃ©es puissent Ãªtre interchangeables, il existe de petites singularitÃ©s dans la&#xA;nature. Ã€ ce titre, le type de donnÃ©es &lt;code&gt;hierarchyid&lt;/code&gt; fourni par SQL Server est un&#xA;exemple flagrant. Si vous Ãªtes amenÃ© Ã  basculer vers PostgreSQL, deux solutions s&amp;rsquo;offrent&#xA;Ã  vous.&lt;/p&gt;&#xA;&lt;p&gt;Une premiÃ¨re et plus simple consiste Ã  lier chaque nÅ“ud Ã  son parent Ã  l&amp;rsquo;aide d&amp;rsquo;une nouvelle&#xA;colonne &lt;code&gt;parentid&lt;/code&gt; et d&amp;rsquo;y appliquer une contrainte de clÃ© Ã©trangÃ¨re. Une autre approche,&#xA;plus complÃ¨te, consiste Ã  utiliser l&amp;rsquo;extension &lt;code&gt;ltree&lt;/code&gt;. Cet article traite de ce dernier&#xA;cas.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Faire vivre une communautÃ©</title>
    <updated>2024-07-30T09:30:00Z</updated>
    <id>tag:fljd.in,2024-07-30:/2024/07/30/faire-vivre-une-communaute/</id>
    <link href="https://fljd.in/2024/07/30/faire-vivre-une-communaute/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le &lt;a href=&#34;https://pgday.fr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PG Day France&lt;/a&gt; s&amp;rsquo;est tenu les 11 et 12 juin derniers Ã  Lille, ma ville natale.&#xA;Il s&amp;rsquo;agit de l&amp;rsquo;Ã©vÃ©nement de la communautÃ© franÃ§aise de PostgreSQL qui pose ses valises dans une&#xA;ville diffÃ©rente chaque annÃ©e. L&amp;rsquo;occasion Ã©tait trop belle pour moi et j&amp;rsquo;y ai rencontrÃ© de nombreuses&#xA;personnes venant de toute la France et de ses alentours, pour discuter de PostgreSQL au cours&#xA;de deux jours d&amp;rsquo;ateliers et de confÃ©rences.&lt;/p&gt;&#xA;&lt;p&gt;Pour cette Ã©dition, j&amp;rsquo;ai eu le plaisir de prendre la parole et de faire un retour d&amp;rsquo;expÃ©rience&#xA;sur l&amp;rsquo;animation du groupe Meetup local dont j&amp;rsquo;ai repris les rennes il y a maintenant quatre ans.&#xA;Dans cet article, je souhaite retranscrire les principaux points abordÃ©s lors de cette prÃ©sentation,&#xA;en attendant que la vidÃ©o de la confÃ©rence soit mise en ligne.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Un assistant pour copier les donnÃ©es distantes</title>
    <updated>2024-05-28T00:00:00Z</updated>
    <id>tag:fljd.in,2024-05-28:/2024/05/28/un-assistant-pour-copier-les-donnees-distantes/</id>
    <link href="https://fljd.in/2024/05/28/un-assistant-pour-copier-les-donnees-distantes/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lors de la derniÃ¨re &lt;a href=&#34;https://blog.dalibo.com/2023/12/08/pgsession16_programme.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGSession 16&lt;/a&gt;, j&amp;rsquo;ai rÃ©digÃ© et animÃ© un &lt;a href=&#34;https://dali.bo/wsfdw_html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;atelier&lt;/a&gt; de&#xA;trois heures au sujet de la migration vers PostgreSQL Ã  l&amp;rsquo;aide des Foreign Data&#xA;Wrappers, ou FDW. Ce fut notamment l&amp;rsquo;occasion de prÃ©senter au grand public,&#xA;l&amp;rsquo;extension &lt;a href=&#34;https://github.com/cybertec-postgresql/db_migrator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;db_migrator&lt;/code&gt;&lt;/a&gt; pour laquelle j&amp;rsquo;ai dÃ©diÃ© un &lt;a href=&#34;https://fljd.in/2023/07/28/en-route-vers-la-liberte-avec-db_migrator/&#34;&gt;article&lt;/a&gt; sur ce&#xA;blog.&lt;/p&gt;&#xA;&lt;p&gt;Au cours de cet atelier, nous pouvons constater que la copie des donnÃ©es avec&#xA;l&amp;rsquo;extension &lt;code&gt;db_migrator&lt;/code&gt; n&amp;rsquo;est pas parfaitement prise en charge. En effet, bien&#xA;qu&amp;rsquo;il existe une fonction de bas niveau pour rÃ©partir sur plusieurs processus le&#xA;transfert table Ã  table, de nombreuses situations devront exiger de rÃ©diger un&#xA;grand nombre de requÃªtes SQL pour se tirer d&amp;rsquo;affaire. Au cours des mois qui&#xA;suivirent, je me suis attelÃ© Ã  la conception d&amp;rsquo;un &lt;a href=&#34;https://github.com/fljdin/fdw-assistant&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;assistant&lt;/a&gt; Ã©crit en&#xA;PL/pgSQL dont le but est de simplifier la gÃ©nÃ©ration de ces requÃªtes.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>On analyse la nouvelle collation de PostgreSQL 17</title>
    <updated>2024-06-07T11:40:12Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-06-07:/2024/06/07/pg17-utf8-collation.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/06/07/pg17-utf8-collation.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL 17 est sorti en version bÃªta le 23 mai dernier, et dans ce billet on&#xA;va dÃ©tailler une de ses nouveautÃ©s: une collation interne gÃ©rant lâ€™UTF-8 avec des&#xA;comparaisons de texte en binaire.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les rapports de bugs de Postgres en 2023</title>
    <updated>2024-01-24T10:23:10Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-01-24:/2024/01/24/pgsql-bugs-annee-2023.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/01/24/pgsql-bugs-annee-2023.html" rel="alternate"></link>
    <summary type="html">Une revue quantitative des rapports de bugs de Postgres en 2023</summary>
  </entry>
  <entry>
    <title>Classification des caractÃ¨res avec ICU</title>
    <updated>2023-06-11T14:32:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2023-06-11:/2023/06/11/caracteres-icu.html</id>
    <link href="https://blog-postgresql.verite.pro/2023/06/11/caracteres-icu.html" rel="alternate"></link>
    <summary type="html">Avec PostgreSQL 16 oÃ¹ ICU devient le fournisseur de collations par dÃ©faut, il y a quelques diffÃ©rences sÃ©mantiques Ã  anticiper dans la classification des caractÃ¨res. Cet article en dÃ©taille quelques-unes.</summary>
  </entry>
  <entry>
    <title>Isolation Repeatable Read avec PostgreSQL versus MySQL</title>
    <updated>2020-02-10T17:50:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-02-10:/2020/02/10/isolation-postgresql-vs-mysql.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/02/10/isolation-postgresql-vs-mysql.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Les moteurs SQL permettent aux transactions concurrentes dâ€™Ãªtre&#xA;isolÃ©es les unes des autres pour Ã©viter les interfÃ©rences.&#xA;Cette propriÃ©tÃ© dâ€™isolation correspond Ã  la lettre I de lâ€™acronyme&#xA;bien connu &lt;a href=&#34;https://fr.wikipedia.org/wiki/Propri%C3%A9t%C3%A9s_ACID&#34;&gt;â€œACIDâ€&lt;/a&gt;,&#xA;les autres propriÃ©tÃ©s Ã©tant AtomicitÃ©, CohÃ©rence&#xA;(&lt;em&gt;Consistency&lt;/em&gt; en anglais) et DurabilitÃ©.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Recherche et remplacement multiple avec plperl</title>
    <updated>2020-01-22T09:05:14Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-01-22:/2020/01/22/multi-replace.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/01/22/multi-replace.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Remplacer une chaÃ®ne par une autre dans une chaÃ®ne plus large est simple&#xA;en SQL, avec la fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;replace&lt;/code&gt;:&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les collations non dÃ©terministes</title>
    <updated>2019-10-16T16:32:15Z</updated>
    <id>tag:blog-postgresql.verite.pro,2019-10-16:/2019/10/16/collations-non-deterministes.html</id>
    <link href="https://blog-postgresql.verite.pro/2019/10/16/collations-non-deterministes.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Depuis la version 12, les collations de PostgreSQL peuvent Ãªtre crÃ©Ã©es&#xA;avec un paramÃ¨tre nommÃ© &lt;strong&gt;deterministic&lt;/strong&gt;, qui peut Ãªtre vrai&#xA;ou faux, si bien que les collations  sont maintenant&#xA;soit &lt;strong&gt;dÃ©terministes&lt;/strong&gt; (ce quâ€™elles sont par dÃ©faut), soit&#xA;&lt;strong&gt;non dÃ©terministes&lt;/strong&gt;.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>De retour du pgDay Paris 2024.</title>
    <updated>2024-03-18T09:39:28Z</updated>
    <id>tag:blog.anayrat.info,2024-03-18:/2024/03/18/de-retour-du-pgday-paris-2024./</id>
    <link href="https://blog.anayrat.info/2024/03/18/de-retour-du-pgday-paris-2024./" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Me voilÃ  rentrÃ© du pgDay Paris. Jâ€™ai beaucoup aimÃ© cette Ã©dition. Jâ€™Ã©tais dÃ©jÃ  venu Ã  celle de &lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2019/schedule/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2019&lt;/a&gt; et je dois dire que je nâ€™ai pas Ã©tÃ© dÃ©Ã§u. Pour rappel, le pgDay Paris est une confÃ©rence internationale. Les prÃ©sentations sont en anglais et permettent dâ€™attirer des orateurs et un public plus anglophone.&lt;/p&gt;&#xA;&lt;p&gt;Je vois souvent cette confÃ©rence comme un petit &lt;a href=&#34;https://www.postgresql.eu/events/series/pgconfeu-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGConf Europe&lt;/a&gt; : on retrouve un contenu assez riche avec la dimension internationale.&lt;/p&gt;&#xA;&lt;p&gt;On croise des tÃªtes dÃ©jÃ  connues : public, orateurs, bÃ©nÃ©voles, contributeurs : Tout ce petit monde qui fait vivre la communautÃ© Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Puis, câ€™est lâ€™occasion de mettre des visages sur des noms que lâ€™on croise en lisant des articles ou les mailing-list Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Voici un petit retour sur les confÃ©rences auxquelles jâ€™ai assistÃ© :&lt;/p&gt;&#xA;&lt;h1 id=&#34;elephant-in-a-nutshell---navigating-the-postgres-community-101&#34;&gt;Elephant in a nutshell - Navigating the Postgres community 101&lt;/h1&gt;&#xA;&lt;p&gt;Avec &lt;a href=&#34;https://2024.pgday.paris/organization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Carole et StÃ©phanie&lt;/a&gt;, on a pensÃ© que ce serait bien dâ€™avoir cette confÃ©rence en introduction.&lt;/p&gt;&#xA;&lt;p&gt;Je lâ€™ai trouvÃ© trÃ¨s complÃ¨te. Elle parle de Postgres, mais aussi et surtout de sa communautÃ©. Câ€™est ce qui fait sa force.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5293/slides/481/pgDay%20Paris_Valeria%27s%20talk%20-%20Elephant%20in%20a%20nutshell.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles.&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;sustainable-database-performance-profiling-in-postgresql&#34;&gt;Sustainable Database Performance profiling in PostgreSQL&lt;/h1&gt;&#xA;&lt;p&gt;Postgres dispose de nombreuses vues statistiques apportant des informations sur son fonctionnement.&lt;/p&gt;&#xA;&lt;p&gt;Elles peuvent Ãªtre natives (&lt;em&gt;pg_stat_statements&lt;/em&gt; â€¦) ou via des extensions &lt;em&gt;pg_stat_kcache&lt;/em&gt;, &lt;em&gt;pg_wait_sampling&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, et câ€™est ce que souligne cette confÃ©rence, elles apportent une vue Ã  un instant T.&lt;/p&gt;&#xA;&lt;p&gt;Pour les exploiter, il faut les historiser. Lâ€™orateur prÃ©sente un outil basÃ© sur ce qui se fait sur Oracle : &lt;a href=&#34;https://github.com/zubkov-andrei/pg_profile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pg_profile&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;En revanche, il le prÃ©sente comme lâ€™unique outil permettant dâ€™exploiter ces informations. Une personne dans le public lui a fait remarquer quâ€™il existait un autre projet : &lt;a href=&#34;https://powa.readthedocs.io/en/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PoWA&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Les deux outils ne fournissent pas les mÃªmes fonctions, &lt;em&gt;pg_profile&lt;/em&gt; gÃ©nÃ¨re un rapport HTML. Il est plutÃ´t facile Ã  installer, il ne nÃ©cessite pas de librairies externe car il est Ã©crit en pl/pgsql.&lt;/p&gt;&#xA;&lt;p&gt;PoWA apporte des graphes, de la suggestion dâ€™indexâ€¦ mais est plus lourd Ã  installer.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5067/slides/482/20240314_dkrautschick_PGdayParis_SustainableDatabasePerformanceProfilingInPostgreSQL.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgresql-without-permanent-local-data-storage&#34;&gt;PostgreSQL without permanent local data storage&lt;/h1&gt;&#xA;&lt;p&gt;LÃ , on rentre dans une confÃ©rence trÃ¨s technique. Matthias travaille sur le projet &lt;a href=&#34;https://neon.tech/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Neon&lt;/a&gt; et il participe rÃ©guliÃ¨rement sur les &lt;a href=&#34;https://www.postgresql.org/list/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mailing-list Postgres&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Neon est un fork opensource de Postgres visant Ã  sÃ©parer le &lt;em&gt;compute&lt;/em&gt; et le &lt;em&gt;storage&lt;/em&gt;. Câ€™est ce quâ€™a fait AWS avec le projet Aurora.&lt;/p&gt;&#xA;&lt;p&gt;Heikki Linnakangas, un des co-fondateurs de Neon et committer de Postgres a fait plusieurs prÃ©sentations :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=rES0yzeERns&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Neon: Serverless PostgreSQL! (Heikki Linnakangas)&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://neon.tech/blog/architecture-decisions-in-neon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Architecture decisions in Neon&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Matthias a prÃ©sentÃ© les diffÃ©rents problÃ¨mes que cela posait de vouloir sÃ©parer le stockage du reste du moteur. Câ€™est clairement un projet trÃ¨s ambitieux. Pour le moment, il est difficile de savoir si ce fork perdurera ou non.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, on peut souligner que les personnes travaillant dessus ont une trÃ¨s grande connaissance du moteur. On peut espÃ©rer que Ã§a ait des implications positives dans le projet Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Affaire Ã  suivreâ€¦&lt;/p&gt;&#xA;&lt;h1 id=&#34;lightning-talks&#34;&gt;Lightning Talks!&lt;/h1&gt;&#xA;&lt;p&gt;Les Lightning Talks sont une bonne occasion de balayer certains sujets un peu plus lÃ©gers. Ca passe plutÃ´t bien aprÃ¨s le repas. Câ€™est assez divertissant. Jâ€™ai bien aimÃ© la prÃ©sentation de LÃ©o Unbekandt sur lâ€™architecture des instances Postgres Ã  Scalingo. Pas de K8S, une architecture simple et Ã©prouvÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;Jâ€™ai aussi aimÃ© la prÃ©sentation de Chris Ellis oÃ¹ il fabrique un objet dÃ©coratif lumineux avec de lâ€™ESP32 dedans.&lt;/p&gt;&#xA;&lt;h1 id=&#34;multi-tenant-database-the-good-the-bad-the-ugly&#34;&gt;Multi-tenant database: the good, the bad, the ugly.&lt;/h1&gt;&#xA;&lt;p&gt;AprÃ¨s, les Lightning Talks, on retourne dans le vif du sujet avec cette prÃ©sentation de Pierre Ducroquet.&lt;/p&gt;&#xA;&lt;p&gt;Je connais bien Pierre, la premiÃ¨re fois que je lâ€™ai croisÃ©, câ€™Ã©tait au pgDay France 2016. Il avait fait une trÃ¨s bonne prÃ©sentation sur &lt;a href=&#34;https://2016.pgday.fr/programme.html#comprendre-requete-lente&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Comprendre pourquoi une requÃªte est lente, et comment rÃ©gler le soucis&lt;/a&gt;. Ensuite, Ã§a a Ã©tÃ© mon collÃ¨gue de travail pendant quelques annÃ©es oÃ¹ on a rencontrÃ© les problÃ¨mes que pouvaient poser les bases de donnÃ©es &lt;em&gt;multi-tenant&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il prÃ©sente diffÃ©rentes faÃ§ons de faire du &lt;em&gt;multi-tenant&lt;/em&gt; avec les contraintes que cela implique. Il donne des chiffres assez impressionnants comme plus de 200 000 tables!&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.pinaraf.info/2024/03/look-ma-i-wrote-a-new-jit-compiler-for-postgresql/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelque chose me dit quâ€™on ne va pas tarder Ã  le revoir&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;beyond-b-trees-looking-at-columnar-storage-and-lsm-trees&#34;&gt;Beyond B-trees looking at Columnar Storage and LSM trees&lt;/h1&gt;&#xA;&lt;p&gt;Une autre confÃ©rence assez bas niveau sur le stockage colonne et les LSM Tree.&lt;/p&gt;&#xA;&lt;p&gt;Ce type de stockage peut effectivement faire partie du futur de Postgres. Le moteur commence Ã  Ãªtre utilisÃ© pour de plus en plus de projets analytiques oÃ¹ on manipule de gros volumes de donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Il faut donc des mÃ©thodes de stockage capable dâ€™encaisse des Ã©critures rapides.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgres-16-highlight-logical-decoding-on-standby&#34;&gt;Postgres 16 highlight: Logical decoding on standby&lt;/h1&gt;&#xA;&lt;p&gt;Une nouveautÃ© assez attendue sur Postgres 16 : La possibilitÃ© de faire du dÃ©codage logique sur un secondaire.&lt;/p&gt;&#xA;&lt;p&gt;Qui mieux quâ€™un des auteurs de cette fonctionnalitÃ© pour en parler ?&lt;/p&gt;&#xA;&lt;p&gt;Bertrand prÃ©sente les difficultÃ©s pour faire un dÃ©codage logique sur un secondaire, et comment elles ont Ã©tÃ© rÃ©solues.&lt;/p&gt;&#xA;&lt;p&gt;Il a aussi fait une dÃ©monstration. Câ€™est vraiment impressionnant, car câ€™est un sujet assez compliquÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Point bonus, il explique aussi une nouveautÃ© de Postres 17 : la synchronisation des slots de rÃ©plication.&lt;/p&gt;&#xA;&lt;p&gt;Actuellement, on peut difficilement â€œraccrocherâ€ une rÃ©plication logique en cas de bascule. Il y a un risque de perte de transaction.&lt;/p&gt;&#xA;&lt;p&gt;Postgres 17 devrait permettre de synchroniser un slot de rÃ©plication. En cas de bascule, on peut reprendre la rÃ©plication.&#xA;On est chanceux, il vient tout juste dâ€™Ã©crire un article sur le sujet : &lt;a href=&#34;https://bdrouvot.github.io/2024/03/16/postgres-17-highlight-logical-replication-slots-synchronization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Postgres 17 highlight: Logical replication slots synchronization&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5122/slides/483/pgdayParis2024.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;closing&#34;&gt;Closing&lt;/h1&gt;&#xA;&lt;p&gt;Câ€™Ã©tait la derniÃ¨re confÃ©rence de la journÃ©e. On a pu se retrouver pour le social event.&lt;/p&gt;&#xA;&lt;p&gt;Câ€™est un moment que jâ€™affectionne particuliÃ¨rement. Car au-delÃ  des confÃ©rences, câ€™est surtout une occasion dâ€™Ã©changer entre passionnÃ©s. De retrouver des connaissances et amis de longue date.&lt;/p&gt;&#xA;&lt;p&gt;Jâ€™ai rÃ©alisÃ© que jâ€™avais un peu dÃ©laissÃ© les confÃ©rences, entre le covid, mon passage en freelance etcâ€¦ A lâ€™avenir, jâ€™essaierai dâ€™Ãªtre plus prÃ©sent sur ce genre dâ€™Ã©vÃ¨nement (si je peux prendre le train).&lt;/p&gt;&#xA;&lt;h1 id=&#34;merci&#34;&gt;Merci&lt;/h1&gt;&#xA;&lt;p&gt;Jâ€™en profite aussi pour remercier les &lt;a href=&#34;https://2024.pgday.paris/organization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;organisateurs et bÃ©nÃ©voles&lt;/a&gt;. On a du mal Ã  rÃ©aliser lâ€™investissement que Ã§a demande. Un grand merci Ã  eux pour cet Ã©vÃ¨nement !&lt;/p&gt;&#xA;&lt;p&gt;On se verra sÃ»rement au pgDay 2025 !&lt;/p&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Recommandations de lectures pour amÃ©liorer ses connaissances en base de donnÃ©es et PostgreSQL</title>
    <updated>2024-02-12T08:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-02-12:/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/</id>
    <link href="https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#fondamentaux-des-bases-de-donnÃ©es&#34;&gt;Fondamentaux des bases de donnÃ©es&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#the-manga-guide-to-databases&#34;&gt;The Manga Guide to Databases&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#database-design-for-mere-mortals&#34;&gt;Database Design for Mere Mortals&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-antipatterns&#34;&gt;SQL Antipatterns&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-for-smarties&#34;&gt;SQL for Smarties&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#the-art-of-sql&#34;&gt;The Art Of SQL&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#performance&#34;&gt;Performance&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-performance-explained&#34;&gt;SQL Performance Explained&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#indexing-beyond-the-basics&#34;&gt;Indexing Beyond the Basics&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#postgresql&#34;&gt;PostgreSQL&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#practical-sql&#34;&gt;Practical SQL&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#postgresql---architecture-et-notions-avancÃ©es&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#learn-postgresql&#34;&gt;Learn PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#postgresql-14-internals&#34;&gt;PostgreSQL 14 Internals&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;p&gt;Je ne vais lister que quelques livres, mais je pourrais en citer pleins d&amp;rsquo;autres &amp;#x1f603; . J&amp;rsquo;espÃ¨re que Ã§a permettra Ã  plus de dÃ©veloppeurs, DBA, DEVOPS, CTO &amp;hellip; de mieux comprendre les bases de donnÃ©es et leurs enjeux.&lt;/p&gt;&#xA;&lt;h1 id=&#34;fondamentaux-des-bases-de-donnÃ©es&#34;&gt;Fondamentaux des bases de donnÃ©es&lt;/h1&gt;&#xA;&lt;h2 id=&#34;the-manga-guide-to-databases&#34;&gt;The Manga Guide to Databases&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-the-manga-guide-to-databases&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;manga&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_79a33cb973abaedb22e66948cdc60d80.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_c3accdb2c9ecf2675e6df1dee150cd9e.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_79a33cb973abaedb22e66948cdc60d80.webp&#34;&#xA;               width=&#34;474&#34;&#xA;               height=&#34;626&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      The Manga Guide to Databases&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://nostarch.com/mg_databases.htm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Manga Guide to Databases&lt;/a&gt; est celui que je recommande dans la plupart de mes rapports d&amp;rsquo;audit.&lt;/p&gt;&#xA;&lt;p&gt;Il est vraiment gÃ©nial, facile Ã  lire et pour autant, il ne sacrifie pas le fond Ã  la forme.&lt;/p&gt;&#xA;&lt;p&gt;Il couvre un peu tous les aspects importants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ModÃ©lisation&lt;/li&gt;&#xA;&lt;li&gt;Ã‰criture de requÃªtes simples&lt;/li&gt;&#xA;&lt;li&gt;Grands principes des bases de donnÃ©es : transaction, isolation&amp;hellip;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;database-design-for-mere-mortals&#34;&gt;Database Design for Mere Mortals&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-database-design-for-mere-mortals&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;design&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_721347960fb63df78ab2314199294f15.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_2a81b8ec12f19038971875854feca26c.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_721347960fb63df78ab2314199294f15.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Database Design for Mere Mortals&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.informit.com/store/database-design-for-mere-mortals-25th-anniversary-edition-9780136788041&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Database Design for Mere Mortals&lt;/a&gt; de &lt;em&gt;Michael J. Hernandez&lt;/em&gt; est, comme son nom l&amp;rsquo;indique, orientÃ© sur la modÃ©lisation.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est un gros pavÃ© de plus de 600 pages, mais il ne faut pas se laisser impressionner. Il se lit trÃ¨s bien, c&amp;rsquo;est bien vulgarisÃ© et l&amp;rsquo;auteur a fait attention  Ã  Ã©viter de s&amp;rsquo;embarquer dans la thÃ©orie qui peut parfois Ãªtre indigeste.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai beaucoup aimÃ© le processus d&amp;rsquo;interviews pour construire le modÃ¨le de donnÃ©es, l&amp;rsquo;accent mis sur la documentation du modÃ¨le. Il  parle peu des formes normales, c&amp;rsquo;est un parti pris. Cependant, si on suit son processus, le modÃ¨le respecte bien les formes normales.&lt;/p&gt;&#xA;&lt;h2 id=&#34;sql-antipatterns&#34;&gt;SQL Antipatterns&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-antipatterns&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;antipatterns&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_c320047c4b1f0cff61ce38e7e7f6d3dc.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_0d0faf00cb44ab3739d2b4e20f0b205e.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_c320047c4b1f0cff61ce38e7e7f6d3dc.webp&#34;&#xA;               width=&#34;633&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL Antipatterns&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://pragprog.com/titles/bksap1/sql-antipatterns-volume-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Antipatterns&lt;/a&gt; est un bon livre pour identifier les &lt;em&gt;anti-patterns&lt;/em&gt; et apporte des solutions.&#xA;Je m&amp;rsquo;en sers rÃ©guliÃ¨rement quand j&amp;rsquo;ai besoin d&amp;rsquo;expliquer ce qui ne va pas dans un modÃ¨le ou une requÃªte.&lt;/p&gt;&#xA;&lt;h2 id=&#34;sql-for-smarties&#34;&gt;SQL for Smarties&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-for-smarties&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;smarties&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_c6c3d9973032c4ac34459909ff559894.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_ca4d66cca791addd71955b48a3f29c2c.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_c6c3d9973032c4ac34459909ff559894.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL for Smarties&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : AvancÃ©&lt;/p&gt;&#xA;&lt;p&gt;Comment ne pas mentionner les livres de &lt;a href=&#34;https://en.wikipedia.org/wiki/Joe_Celko&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Joe Celko&lt;/a&gt;.&#xA;Il a participÃ© au standard SQL et Ã©crit de &lt;a href=&#34;https://www.oreilly.com/pub/au/1919&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nombreux livres&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sciencedirect.com/book/9780128007617/joe-celkos-sql-for-smarties&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL for Smarties&lt;/a&gt; fait partie&#xA;des rÃ©fÃ©rences en matiÃ¨re de SQL. La premiÃ¨re Ã©dition date de 1995&amp;hellip; oui&amp;hellip; presque 30 ans quand j&amp;rsquo;Ã©cris ces lignes !&#xA;La cinquiÃ¨me Ã©dition date de 2015, malgrÃ© ces 10 ans, le contenu est toujours d&amp;rsquo;actualitÃ©. On trouve mÃªme des ordres assez rÃ©cents comme &lt;code&gt;LATERAL&lt;/code&gt;, les &lt;em&gt;window functions&lt;/em&gt;, &lt;code&gt;CTE&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;On est aussi sur un gros pavÃ© de plus de 800 pages, le livre est trÃ¨s complet, assez exhaustif. Je dirai rÃ©servÃ© Ã  ceux qui veulent vraiment approfondir leurs connaissances en SQL.&lt;/p&gt;&#xA;&lt;p&gt;Ã€ noter qu&amp;rsquo;il existe une version en franÃ§ais basÃ© sur la seconde Ã©dition qui date de 2000, elle accuse un peu l&amp;rsquo;age : &lt;a href=&#34;https://www.decitre.fr/livres/sql-avance-9782711786367.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL AvancÃ©&lt;/a&gt;. On peut le trouver &lt;a href=&#34;https://www.momox-shop.fr/joe-celko-sql-avance-taschenbuch-M02841801411.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;d&amp;rsquo;occasion&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;the-art-of-sql&#34;&gt;The Art Of SQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-the-art-of-sql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;art&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_2bb5db8f1a45e313260bc7467bf92c17.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_ad989b301e7ba70987c52db0c9c535e3.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_2bb5db8f1a45e313260bc7467bf92c17.webp&#34;&#xA;               width=&#34;579&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      The Art Of SQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : AvancÃ©&lt;/p&gt;&#xA;&lt;p&gt;Avec &lt;a href=&#34;https://www.oreilly.com/library/view/the-art-of/0596008945/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Art of SQL&lt;/a&gt; de &lt;a href=&#34;https://www.oreilly.com/pub/au/2005&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stephane Faroult&lt;/a&gt;, on change de catÃ©gorie. LÃ , on est sur du SQL plus avancÃ©.&#xA;Le livre va Ãªtre orientÃ© performances, bonnes pratiques. MalgrÃ© ses 18 ans, son contenu est toujours d&amp;rsquo;actualitÃ©. C&amp;rsquo;est un livre trÃ¨s puissant, il vous faudra du temps pour le lire et assimiler chaque page.&lt;/p&gt;&#xA;&lt;h1 id=&#34;performance&#34;&gt;Performance&lt;/h1&gt;&#xA;&lt;h2 id=&#34;sql-performance-explained&#34;&gt;SQL Performance Explained&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-performance-explained&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;luke&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_d25868af42f9fe155d70736822260a43.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_c361959935046d9adedd33681287b70f.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_d25868af42f9fe155d70736822260a43.webp&#34;&#xA;               width=&#34;480&#34;&#xA;               height=&#34;737&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL Performance Explained&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;Impossible de ne pas mentionner l&amp;rsquo;excellent livre de &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Markus Winand&lt;/a&gt;, &lt;a href=&#34;https://sql-performance-explained.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Performance Explained&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Comme son titre l&amp;rsquo;indique, on va parler performance, indexation, Ã©criture de requÃªtes. Ã€ noter qu&amp;rsquo;il a Ã©galement Ã©tÃ© traduit en plusieurs langues : Allemand, Espagnol, Japonais et FranÃ§ais grÃ¢ce Ã  Guillaume Lelarge &lt;a href=&#34;https://sql-au-coeur-des-performances.fr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL : Au cÅ“ur des performances&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le contenu du livre est Ã©galement disponible sur son site &lt;a href=&#34;https://use-the-index-luke.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Use the Index, Luke !&lt;/a&gt;. Markus est aussi l&amp;rsquo;auteur d&amp;rsquo;un excellent site sur les fonctionnalitÃ©s avancÃ©s du SQL : &lt;a href=&#34;https://modern-sql.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL&lt;/a&gt;. Lors de l&amp;rsquo;Ã©mission &lt;a href=&#34;https://youtu.be/mGqqQg-dG-w?si=he4R6eTC_2VckAVA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL sur Postgres.FM&lt;/a&gt;, il a annoncÃ© la volontÃ© d&amp;rsquo;en faire un livre. J&amp;rsquo;ai hÃ¢te ! Il a aussi fait de nombreuses &lt;a href=&#34;https://winand.at/sql-slides-for-developers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prÃ©sentations&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;indexing-beyond-the-basics&#34;&gt;Indexing Beyond the Basics&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-indexing-beyond-the-basics&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;indexing&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_cd04fe528416e6d69ed46ae57835a97e.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_7b7f71022bce674d799dc5af2cfdb5cb.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_cd04fe528416e6d69ed46ae57835a97e.webp&#34;&#xA;               width=&#34;668&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Indexing Beyond the Basics&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant - IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://sqlfordevs.com/ebooks/indexing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Indexing Beyond the Basics&lt;/a&gt; est un e-book orientÃ© sur les index. Un point intÃ©ressant est qu&amp;rsquo;il mentionne aussi pourquoi le moteur n&amp;rsquo;utilise pas un index.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgresql&#34;&gt;PostgreSQL&lt;/h1&gt;&#xA;&lt;h2 id=&#34;practical-sql&#34;&gt;Practical SQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-practical-sql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;practical&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_c3df0446f9f62391d13c57dd10ec2e89.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_f2aecb321cb118f7fb40dddd50422be5.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_c3df0446f9f62391d13c57dd10ec2e89.webp&#34;&#xA;               width=&#34;477&#34;&#xA;               height=&#34;630&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Practical SQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant - intermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://nostarch.com/practical-sql-2nd-edition/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Practical SQL&lt;/a&gt; est un super livre pour quelqu&amp;rsquo;un qui dÃ©bute sur Postgres. Il parle d&amp;rsquo;un peu de tout, du SQL jusqu&amp;rsquo;aux types avancÃ©s. Comment utiliser le SQL pour analyser des donnÃ©es, faire du &lt;em&gt;full text search&lt;/em&gt;, opÃ©ration d&amp;rsquo;administration&amp;hellip;&lt;/p&gt;&#xA;&lt;h2 id=&#34;postgresql---architecture-et-notions-avancÃ©es&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-postgresql---architecture-et-notions-avancÃ©es&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;architecture&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_8da2fb9ff08beb89b92a47f2af0154cc.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_504568017e4d0ef28b5f0f36871185ec.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_8da2fb9ff08beb89b92a47f2af0154cc.webp&#34;&#xA;               width=&#34;559&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      PostgreSQL - Architecture et notions avancÃ©es&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire - avancÃ©&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.d-booker.fr/bases-de-donnees/805-1338-postgresql-architecture-et-notions-avancees-5ed.html#/21-option-consultation_en_ligne&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/a&gt; par Guillaume Lelarge et Julien Rouhaud est &lt;strong&gt;le&lt;/strong&gt; livre que je recommande pour qui veut comprendre comment fonctionne Postgres. Mon seul regret est qu&amp;rsquo;il ne soit pas traduit en anglais pour en faire profiter plus de lecteurs.&lt;/p&gt;&#xA;&lt;p&gt;Ã€ noter aussi qu&amp;rsquo;il est mis Ã  jour tous les ans.&lt;/p&gt;&#xA;&lt;h2 id=&#34;learn-postgresql&#34;&gt;Learn PostgreSQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-learn-postgresql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;learn&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_2e08c564415b06ee6ac817f7ac0914b0.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_c22b1c79c1fe1d43eb51d2ce83b5ee11.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_2e08c564415b06ee6ac817f7ac0914b0.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Learn PostgreSQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.packtpub.com/product/learn-postgresql-second-edition/9781837635641&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Learn PostgreSQL&lt;/a&gt; par Lucas Ferrari et Enrico Pirozzi est un livre trÃ¨s complet sur l&amp;rsquo;administration de Postgres. Un &lt;em&gt;must have&lt;/em&gt; pour un DBA.&lt;/p&gt;&#xA;&lt;p&gt;Pour les francophones, vous pouvez vous orienter vers &lt;a href=&#34;https://www.editions-eni.fr/livre/postgresql-administration-et-exploitation-de-vos-bases-de-donnees-4e-edition-9782409011467&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL Administration et exploitation de vos bases de donnÃ©es&lt;/a&gt; de SÃ©bastien LardiÃ¨re.&lt;/p&gt;&#xA;&lt;h2 id=&#34;postgresql-14-internals&#34;&gt;PostgreSQL 14 Internals&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-postgresql-14-internals&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;internals&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_8639f0d8b0e15fe8fb464f6e5412e100.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_3d76ec668fd76ab0113449dbb278d740.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_8639f0d8b0e15fe8fb464f6e5412e100.webp&#34;&#xA;               width=&#34;384&#34;&#xA;               height=&#34;552&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      PostgreSQL 14 Internals&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://postgrespro.com/community/books/internals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL 14 Internals&lt;/a&gt; par Egor Rogov est un livre sur les entrailles de Postgres. Il est vraiment trÃ¨s complet. Un grand merci Ã  lui de le mettre Ã  disposition en accÃ¨s libre.&lt;/p&gt;&#xA;&lt;p&gt;Dans le mÃªme style, il existe un site &lt;a href=&#34;https://www.interdb.jp/pg/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Internals of PostgreSQL&lt;/a&gt; par Hironobu SUZUKI.&lt;/p&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Postgres Ã  nouveau Ã©lu SGBD de l&#39;annÃ©e en 2023, mais je suis inquiet</title>
    <updated>2024-02-05T08:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-02-05:/2024/02/05/postgres-a-nouveau-elu-sgbd-de-lannee-en-2023-mais-je-suis-inquiet/</id>
    <link href="https://blog.anayrat.info/2024/02/05/postgres-a-nouveau-elu-sgbd-de-lannee-en-2023-mais-je-suis-inquiet/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cette annÃ©e encore, Postgres a Ã©tÃ© Ã©lu SGBD de l&amp;rsquo;annÃ©e par &lt;a href=&#34;https://db-engines.com/en/blog_post/106&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DB-Engines&lt;/a&gt;. MÃªme si ce n&amp;rsquo;est qu&amp;rsquo;un classement, cela donne une tendance. Cela fait aussi plusieurs annÃ©es qu&amp;rsquo;il est reconnu selon&#xA;les sondages de Stackoverflow : &lt;a href=&#34;https://survey.stackoverflow.co/2023/#section-most-popular-technologies-databases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Most popular Databases&lt;/a&gt;.&#xA;C&amp;rsquo;est un SGBD trÃ¨s apprÃ©ciÃ©, tant par les dÃ©veloppeurs, que par les DBA chevronnÃ©s&amp;hellip; Mais aussi par les directeurs qui y trouvent une stabilitÃ©&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Postgres a tout pour sÃ©duire :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AnnÃ©e aprÃ¨s annÃ©e, de nouvelles fonctionnalitÃ©s sont rajoutÃ©es. Je pense notamment Ã  : la parallÃ©lisation, le partitionnement, la rÃ©plication logique&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;Il a su, depuis toujours, garder sa fiabilitÃ©.&lt;/li&gt;&#xA;&lt;li&gt;Sa communautÃ© n&amp;rsquo;a fait que grandir. Les confÃ©rences dÃ©diÃ©es Ã  Postgres battent des records d&amp;rsquo;affluence tous les ans.&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est devenu un standard, mÃªme pour les autres logiciels : les Ã©diteurs rajoutent mÃªme le support du protocole Postgres pour faciliter leur intÃ©gration : Aurora, AlloyDB, QuestDB&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est un des rares projets de cette envergure Ã  Ãªtre communautaire. On a pu voir qu&amp;rsquo;il ne suffit pas que le projet soit opensource, il faut aussi compter sur la communautÃ© et son Ã©cosystÃ¨me.&lt;/li&gt;&#xA;&lt;li&gt;Il est supportÃ© par les gros acteurs : les GAFAM emploient de nombreux committers et contributeurs. Ils sponsorisent Ã©galement les confÃ©rences. Par exemple, le prochain &lt;a href=&#34;https://2024.pgday.paris/sponsors/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pgDay Paris est sponsorisÃ© par Microsoft&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cependant, je suis un peu inquiet pour le futur. Non pas pour PostgreSQL. Bruce Momjian a fait plusieurs prÃ©sentations sur ce sujet :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/challenges.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Future Postgres Challenges&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/forever.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Will Postgres Live Forever?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/past_present_future.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL: Past, Present, and Future&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;C&amp;rsquo;est mÃªme le sujet de la Keynote d&amp;rsquo;ouverture du dernier PGConf Europe : &lt;a href=&#34;https://www.youtube.com/watch?v=8W-J36IxYv4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Simon Riggs: The Next 20 Years (PGConf.EU 2023)&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Non, je suis plutÃ´t inquiet sur la perte de connaissance du mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;A quoi servira Postgres si on ne sait pas l&amp;rsquo;utiliser correctement ?&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#un-peu-dhistoire&#34;&gt;Un peu d&amp;rsquo;histoire&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#quest-ce-quon-oublie-&#34;&gt;Qu&amp;rsquo;est-ce qu&amp;rsquo;on oublie ?&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#oui-mais-le-cloud&#34;&gt;Oui, mais le cloud!&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#on-oublie-le-mÃ©tier-de-dba&#34;&gt;On oublie le mÃ©tier de DBA&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#on-oublie-le-passÃ©&#34;&gt;On oublie le passÃ©&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#le-code-change-la-donnÃ©e-reste&#34;&gt;Le code change, la donnÃ©e reste&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#il-faut-quelques-minutes-pour-prendre-une-mauvaise-dÃ©cision-sur-une-base-de-donnÃ©e&#34;&gt;Il faut quelques minutes pour prendre une mauvaise dÃ©cision sur une base de donnÃ©e&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#lusage-du-cloud&#34;&gt;L&amp;rsquo;usage du cloud&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#ce-quil-faudrait-changer&#34;&gt;Ce qu&amp;rsquo;il faudrait changer&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#pour-conclure&#34;&gt;Pour conclure&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;un-peu-dhistoire&#34;&gt;Un peu d&amp;rsquo;histoire&lt;/h1&gt;&#xA;&lt;p&gt;Par le passÃ©, il y avait une spÃ©cialisation forte des compÃ©tences : dÃ©veloppeurs, testeurs, DBA Ã©tude, DBA prod, ingÃ©nieur systÃ¨me, ingÃ©nieur stockage, ingÃ©nieur sauvegarde&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Chaque spÃ©cialitÃ© Ã©voluait un peu dans sa bulle, ce qui compliquait la collaboration avec des cycles de dÃ©veloppement longs.&lt;/p&gt;&#xA;&lt;p&gt;Cette organisation a laissÃ© place Ã  une nouvelle faÃ§on de travailler : dÃ©veloppeurs &lt;em&gt;fullstack&lt;/em&gt;, &lt;em&gt;DEVOPS/SRE&lt;/em&gt;, des data &amp;ldquo;quelque chose&amp;rdquo; (engineer, analyst, steward&amp;hellip;).&lt;/p&gt;&#xA;&lt;p&gt;Les compÃ©tences se sont diluÃ©es sur les diffÃ©rents mÃ©tiers. Je croise de plus en plus rarement des DBA.&lt;/p&gt;&#xA;&lt;p&gt;A la place, la base de donnÃ©e est &lt;em&gt;gÃ©rÃ©e&lt;/em&gt; par les dÃ©veloppeurs. Ou, si on a un peu de chance, par des &amp;ldquo;data engineer&amp;rdquo; ou &amp;ldquo;data analyst&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;AprÃ¨s plusieurs annÃ©es, alors que je baigne dedans, j&amp;rsquo;ai encore du mal Ã  dÃ©finir ces mÃ©tiers.&lt;/p&gt;&#xA;&lt;p&gt;Le constat : bonne connaissance du python, monte des pipelines, on assemble en quelque sorte des Legos avec pleins d&amp;rsquo;outils : airflow, dbt&amp;hellip; Puis, on envoie ces donnÃ©es dans du Redshift, Biquery, Snowflake&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Cependant, j&amp;rsquo;ai l&amp;rsquo;impression que la connaissance du SQL s&amp;rsquo;appauvrit Ã  cause des couches d&amp;rsquo;abstraction.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Du moment oÃ¹ on manipule de la donnÃ©e, la premiÃ¨re des compÃ©tences Ã  avoir, devrait Ãªtre la maitrise du SQL.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;quest-ce-quon-oublie-&#34;&gt;Qu&amp;rsquo;est-ce qu&amp;rsquo;on oublie ?&lt;/h1&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai le sentiment, qu&amp;rsquo;annÃ©e aprÃ¨s annÃ©e, on oublie le mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, ce dernier va Ãªtre Ã  la croisÃ©e de plusieurs chemins :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Il a des compÃ©tences pures sur la base de donnÃ©es :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ModÃ©lisation.&lt;/li&gt;&#xA;&lt;li&gt;Maitrise du SQL.&lt;/li&gt;&#xA;&lt;li&gt;Maitrise du SGBD : connait le fonctionnement du moteur (&lt;em&gt;vacuum&lt;/em&gt;, &lt;em&gt;checkpoint&lt;/em&gt; &amp;hellip;). Comprend les mÃ©canismes de verrouillages (&lt;em&gt;MVCC&lt;/em&gt;, &lt;em&gt;locks&lt;/em&gt;&amp;hellip;).&lt;/li&gt;&#xA;&lt;li&gt;Conserve une veille technique : le Postgres que j&amp;rsquo;ai connu Ã  mes dÃ©buts est trÃ¨s loin du Postgres actuel.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Mais Ã©galement des compÃ©tences plus transverses :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Avoir une bonne connaissance systÃ¨me pour investiguer sur les problÃ¨mes de performance, dimensionner les ressources.&lt;/li&gt;&#xA;&lt;li&gt;Un vernis en dÃ©veloppement pour comprendre les besoins des dÃ©veloppeurs et pouvoir les accompagner.&lt;/li&gt;&#xA;&lt;li&gt;De la culture &amp;ldquo;computer science&amp;rdquo;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;oui-mais-le-cloud&#34;&gt;Oui, mais le cloud!&lt;/h1&gt;&#xA;&lt;p&gt;On pourrait penser que le cloud a rebattu les cartes et qu&amp;rsquo;on n&amp;rsquo;a plus besoin de DBA. Dans la liste que j&amp;rsquo;ai donnÃ©e ci-dessus, quelles compÃ©tences sont couvertes par le cloud ?&lt;/p&gt;&#xA;&lt;p&gt;Le cloud rÃ©sout une partie des besoins : hÃ©bergement, maintenance, rÃ©seau, monitoring (qu&amp;rsquo;il faut souvent complÃ©ter avec un APM ou un Datadog like).&#xA;Et il rajoute d&amp;rsquo;autres problÃ¨mes :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Il faut rajouter un mÃ©tier de &lt;a href=&#34;https://lota.cloud/finops-cloud-2/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FinOps&lt;/a&gt; pour maitriser et optimiser les dÃ©penses.&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est parfois une boite noire et il peut Ãªtre difficile d&amp;rsquo;investiguer sur des problÃ¨mes de performance&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Cet excellent article de Markus Winand prÃ©sente aussi d&amp;rsquo;autres inconvÃ©nients : &lt;a href=&#34;https://winand.at/newsletter/2024-01/clouds-bring-rain&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sometimes Clouds Bring Rain&lt;/a&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Changer de cloud provider est difficile. Je dirais mÃªme que c&amp;rsquo;est volontaire de leur part.&lt;/li&gt;&#xA;&lt;li&gt;Les coÃ»ts peuvent changer &lt;em&gt;Just because it is cheap today doesnâ€™t mean it will be cheap forever&lt;/em&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Il faut prÃ©voir un plan de sortie : Ã©viter les services propriÃ©taires, conserver un faible nombre de services.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Car une fois dans le cloud, qui s&amp;rsquo;occupe de : la modÃ©lisation, l&amp;rsquo;optimisation des requÃªtes, l&amp;rsquo;indexation, la veille technique sur le SGBD&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;, l&amp;rsquo;investigation sur les performances, comprendre les problÃ¨mes de verrouillages, l&amp;rsquo;accompagnement des dÃ©veloppeurs ?&lt;/p&gt;&#xA;&lt;p&gt;Ceci est confirmÃ© dans mes audits, je vois rÃ©guliÃ¨rement des problÃ¨mes trÃ¨s basiques :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Absence de clÃ© primaire.&lt;/li&gt;&#xA;&lt;li&gt;Pas d&amp;rsquo;index sur des cas trÃ¨s simples.&lt;/li&gt;&#xA;&lt;li&gt;Aucun respect des formes normales, mÃªme les plus basiques. Le JSON n&amp;rsquo;a pas arrangÃ© les choses.&lt;/li&gt;&#xA;&lt;li&gt;RequÃªtes spaghetti.&lt;/li&gt;&#xA;&lt;li&gt;Des jointures faÃ§on SQL-89 alors que Ã§a fait plus de 30 ans que le mot clÃ© &lt;code&gt;JOIN&lt;/code&gt; existe.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;S&amp;rsquo;il faut retenir une chose : &lt;strong&gt;Le cloud ne permet pas de s&amp;rsquo;affranchir du DBA. Ce n&amp;rsquo;est pas parce qu&amp;rsquo;on peut obtenir les clÃ©s d&amp;rsquo;un avion, qu&amp;rsquo;on sait le piloter.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Un article intÃ©ressant sur le nombre de DBA dont vous avez besoin : &lt;a href=&#34;https://www.bytebase.com/blog/how-many-dbas-should-a-company-hire/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How many DBAs should a company hire?&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;on-oublie-le-mÃ©tier-de-dba&#34;&gt;On oublie le mÃ©tier de DBA&lt;/h1&gt;&#xA;&lt;p&gt;On pourrait naÃ¯vement penser qu&amp;rsquo;on confie ces tÃ¢ches Ã  des DBA experts, mais j&amp;rsquo;ai de plus en plus de doutes. J&amp;rsquo;ai l&amp;rsquo;impression &amp;ldquo;qu&amp;rsquo;on&amp;rdquo; est en train de perdre la connaissance d&amp;rsquo;un mÃ©tier.&#xA;J&amp;rsquo;ai dÃ©jÃ  croisÃ© des dÃ©veloppeurs expÃ©rimentÃ©s qui ne savaient mÃªme pas que le mÃ©tier de DBA existait.&#xA;Des recruteurs qui me demandaient si en tant que DBA, je savais optimiser des requÃªtes et si je connaissais le SQL. C&amp;rsquo;est mon mÃ©tier ! C&amp;rsquo;est un peu comme demander Ã  un plombier s&amp;rsquo;il sait changer un robinet !&lt;/p&gt;&#xA;&lt;p&gt;Ce qui est d&amp;rsquo;autant plus alarmant, c&amp;rsquo;est que je crains qu&amp;rsquo;il y ait aussi des CTO qui ont aussi cette mÃ©connaissance de la donnÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;La consÃ©quence est qu&amp;rsquo;en cas de problÃ¨me de performance, on ne fait qu&amp;rsquo;augmenter les ressources des instances.&#xA;Avec le cloud, la facture croÃ®t linÃ©airement avec la taille de l&amp;rsquo;instance.&#xA;Si la croissance de la charge est exponentielle, il faudra scaler la base et la facture qui va avec. On se retrouve avec une facture exponentielle.&lt;/p&gt;&#xA;&lt;p&gt;Quand on n&amp;rsquo;arrive plus Ã  s&amp;rsquo;en sortir, on va accuser l&amp;rsquo;outil ou le modÃ¨le, donc on va changer de SGBD ou aller vers du NoSQL. Spoiler : Ã§a ne rÃ©soudra pas vos problÃ¨mes.&lt;/p&gt;&#xA;&lt;h1 id=&#34;on-oublie-le-passÃ©&#34;&gt;On oublie le passÃ©&lt;/h1&gt;&#xA;&lt;p&gt;Pendant un temps, j&amp;rsquo;ai voulu Ã©crire un livre pour parler optimisation de requÃªte, des erreurs courantes que je rencontre, etc.&lt;/p&gt;&#xA;&lt;p&gt;En regardant ma bibliothÃ¨que, elle est pleine de livres de ce genre. Ils ont pour la plupart entre 10 et 30 ans et le contenu est toujours d&amp;rsquo;actualitÃ©. A quoi servirait un Ã©niÃ¨me livre s&amp;rsquo;il n&amp;rsquo;est pas connu ?&lt;/p&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai un autre exemple en tÃªte : les data warehouse (DWH). Ce terme devient de plus en plus galvaudÃ©.&#xA;La construction d&amp;rsquo;un DWH est complexe, il faut passer par une phase de modÃ©lisation afin de stocker correctement les donnÃ©es. Cela permet de bonnes performances et facilite l&amp;rsquo;Ã©criture&#xA;des requÃªtes analytiques.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant, je croise rÃ©guliÃ¨rement des &amp;ldquo;data warehouse&amp;rdquo; qui se rÃ©sument Ã  envoyer toutes les donnÃ©es dans un SGBD spÃ©cialisÃ© (redshift, biquery &amp;hellip;). Sans travail de modÃ©lisation et avec des requÃªtes trÃ¨s mal Ã©crites, parfois gÃ©nÃ©rÃ©es, car les utilisateurs ne savent pas faire du SQL.&lt;/p&gt;&#xA;&lt;p&gt;Ces services coÃ»tent trÃ¨s cher et ne font pas de miracle s&amp;rsquo;il n&amp;rsquo;y a pas eu un travail approfondi de modÃ©lisation et d&amp;rsquo;optimisation.&lt;/p&gt;&#xA;&lt;p&gt;Pourtant, les livres sur les DWH et le SQL ont entre 10 et 30 ans. A cette Ã©poque, le cloud n&amp;rsquo;existait pas, les SSD non plus, les CPU avec plusieurs coeurs non plus.&#xA;Pourtant, on savait construire des DWH, faire des sites performants&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Il ne faudrait pas que le cloud nous fasse oublier tout cet hÃ©ritage. Sinon, on risque de payer la dette technique et la perte de connaissance trÃ¨s cher, avec les intÃ©rÃªts en plus.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Il faut avoir en tÃªte que mÃªme si le SQL a Ã©voluÃ©, les SGBD gagnÃ©s en fonctionnalitÃ©s, &lt;strong&gt;les principes fondateurs sont toujours justes&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;le-code-change-la-donnÃ©e-reste&#34;&gt;Le code change, la donnÃ©e reste&lt;/h1&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai eu un super manager, ancien DBA, qui expliquait aux dÃ©veloppeurs : tu n&amp;rsquo;es pas ici pour &amp;ldquo;produire du code&amp;rdquo; =&amp;gt; yeux Ã©carquillÃ©s du dÃ©veloppeur.&#xA;&amp;ldquo;tu es lÃ  pour produire et manipuler de la donnÃ©e.&amp;rdquo;&lt;/p&gt;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;il y avait une dÃ©cision compliquÃ©e. Par exemple, prendre plus de temps pour revoir le code applicatif, faire une migration plus compliquÃ©e, plutÃ´t qu&amp;rsquo;une solution&#xA;&amp;ldquo;quick win&amp;rdquo;. Ce mÃªme manager expliquait :&amp;quot;&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;D&amp;rsquo;ici 5-10 ans, ton code aura Ã©tÃ© rÃ©Ã©crit plusieurs fois, peut-Ãªtre mÃªme dans un autre langage.&#xA;Nous, la donnÃ©e, dans 50 ans, elle sera toujours lÃ . C&amp;rsquo;est notre devoir de nous assurer qu&amp;rsquo;elle sera toujours exploitable.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h1 id=&#34;il-faut-quelques-minutes-pour-prendre-une-mauvaise-dÃ©cision-sur-une-base-de-donnÃ©e&#34;&gt;Il faut quelques minutes pour prendre une mauvaise dÃ©cision sur une base de donnÃ©e&lt;/h1&gt;&#xA;&lt;p&gt;&lt;em&gt;Et parfois plusieurs mois / annÃ©es pour la corriger.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Il m&amp;rsquo;est arrivÃ© de faire des audits oÃ¹ le modÃ¨le Ã©tait catastrophique. Il avait Ã©voluÃ© de solutions Ã  court terme en d&amp;rsquo;autres solutions Ã  court terme.&#xA;&amp;ldquo;On corrigera plus tard, il faut faire passer cette fonctionnalitÃ© dans le sprint&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;Un DBA peut corriger le modÃ¨le de donnÃ©es Ã  coup de grosses migrations (encore faut-il avoir un DBA, difficile si on ignore que ce mÃ©tier existe&amp;hellip;).&#xA;Au-delÃ  de Ã§a, le problÃ¨me va se poser autour : il faut rÃ©Ã©crire une grosse partie du code applicatif (qui est souvent dans le mÃªme Ã©tat que la base).&lt;/p&gt;&#xA;&lt;p&gt;Parfois, la complexitÃ© est quadratique ou exponentielle. Il vaut mieux tout jeter pour tout recommencer.&lt;/p&gt;&#xA;&lt;p&gt;On se retrouve face Ã  plusieurs dilemmes :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Augmenter la taille des instances.&lt;/li&gt;&#xA;&lt;li&gt;Parfois, cette solution n&amp;rsquo;est pas suffisante. J&amp;rsquo;explique : &amp;ldquo;lÃ , vous pouvez faire encore fois dix sur la taille de l&amp;rsquo;instance, mais vous ne pourrez jouer cette carte qu&amp;rsquo;une fois&amp;rdquo;. Notez que cette solution est inutile si le traitement ne peut pas Ãªtre parallÃ©lisÃ©.&lt;/li&gt;&#xA;&lt;li&gt;Tout jeter pour tout recommencer. LÃ  aussi, le coÃ»t ou la perte peut Ãªtre dÃ©mentielle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Alors qu&amp;rsquo;il aurait suffi des conseils d&amp;rsquo;un DBA Ã  quelques moments de la vie du projet pour Ã©viter de partir dans une mauvaise direction.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;On ne bÃ¢tit pas un chÃ¢teau sur du sable&lt;/strong&gt;. J&amp;rsquo;ai une anecdote en tÃªte, une personne de mon entourage m&amp;rsquo;a racontÃ© une histoire d&amp;rsquo;un bÃ¢timent qui avait Ã©tÃ© contrÃ´lÃ© au moment de la livraison :&lt;/p&gt;&#xA;&lt;p&gt;Un prÃ©lÃ¨vement avait Ã©tÃ© fait dans les murs et il n&amp;rsquo;y avait pas assez de ciment, le bÃ¢timent, &lt;strong&gt;neuf&lt;/strong&gt;, pouvait s&amp;rsquo;Ã©crouler. Il venait d&amp;rsquo;Ãªtre totalement terminÃ©, Ã©lectricitÃ©, plomberie, menuiseries&amp;hellip; Tout Ã©tait terminÃ©.&#xA;Il a dÃ» Ãªtre rasÃ© complÃ¨tement. Autant il existe des assurances dans le bÃ¢timent, mais pas pour le dÃ©veloppement&amp;hellip;&#xA;Je pense que certaines sociÃ©tÃ©s ne survivent pas si la dette technique est trop importante.&lt;/p&gt;&#xA;&lt;h1 id=&#34;lusage-du-cloud&#34;&gt;L&amp;rsquo;usage du cloud&lt;/h1&gt;&#xA;&lt;p&gt;Le cloud a de nombreux avantages :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;On peut rapidement obtenir des bases de donnÃ©es avec une installation relativement propre.&lt;/li&gt;&#xA;&lt;li&gt;Le cloud provider vous obligera Ã  rester sur des versions supportÃ©es.&lt;/li&gt;&#xA;&lt;li&gt;&amp;ldquo;Ã‰cologiquement&amp;rdquo;, cela permet de mutualiser des ressources physiques. Mais c&amp;rsquo;est aussi une faiblesse. L&amp;rsquo;accÃ¨s facile Ã  ces ressources peut aussi entrainer un gaspillage. On peut facilement dÃ©ployer&#xA;une centaine d&amp;rsquo;instances. LÃ , oÃ¹ avec une infrastructure &lt;em&gt;on-premise&lt;/em&gt;, il faut concilier avec les ressources physiques Ã  disposition : puissance des serveurs, puissance Ã©lectrique, espace dans les baies&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;On paye ce qu&amp;rsquo;on consomme. On peut facilement identifier combien coute un service. Qu&amp;rsquo;une requÃªte est responsable de 80% de la facture. Ce qui peut inciter Ã  l&amp;rsquo;optimiser, le gain financier est immÃ©diat. Encore faut-il qu&amp;rsquo;il y ait des personnes qui s&amp;rsquo;y intÃ©ressent.&#xA;Je n&amp;rsquo;ai pas l&amp;rsquo;impression qu&amp;rsquo;il y ait beaucoup de FinOps. S&amp;rsquo;il y en a, est-ce que ces derniers pensent Ã  optimiser la base ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Mais il y a aussi de vrais inconvÃ©nients :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Perte de souverainetÃ© numÃ©rique. A cela s&amp;rsquo;ajoute des risques juridiques. Comment garantir que vos donnÃ©es ne sont pas stockÃ©es ailleurs ? Si vous avez choisi un service managÃ©, comment en sortir si la lÃ©gislation vous impose d&amp;rsquo;Ãªtre sur le sol FranÃ§ais ou d&amp;rsquo;un autre pays ?&lt;/li&gt;&#xA;&lt;li&gt;Perte de compÃ©tences.&lt;/li&gt;&#xA;&lt;li&gt;DÃ©pendance Ã  un cloud provider : encore que sur ce point, on voit Ã©merger de nouvelles offres &amp;ldquo;cloud agnostique&amp;rdquo; : Des sociÃ©tÃ©s crÃ©ent un cloud par-dessus un autre cloud.&#xA;Je pense notamment Ã  &lt;a href=&#34;https://aiven.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aiven&lt;/a&gt;, &lt;a href=&#34;https://www.enterprisedb.com/docs/biganimal/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EDB BigAnimal&lt;/a&gt;, &lt;a href=&#34;https://www.crunchydata.com/products/crunchy-bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Crunchy Bridge&lt;/a&gt; et j&amp;rsquo;en oublie certainement&amp;hellip;&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;li&gt;Les couts dÃ©collent quand l&amp;rsquo;infrastructure est importante. Certains commencent Ã  quitter le cloud. Je pense notamment Ã  Basecamp :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/why-we-re-leaving-the-cloud-654b47e0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Why we&amp;rsquo;re leaving the cloud&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/we-stand-to-save-7m-over-five-years-from-our-cloud-exit-53996caa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;We stand to save $7m over five years from our cloud exit&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/the-big-cloud-exit-faq-20274010&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Big Cloud Exit FAQ&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;ce-quil-faudrait-changer&#34;&gt;Ce qu&amp;rsquo;il faudrait changer&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Redonner de la valeur Ã  la donnÃ©e : des sociÃ©tÃ©s rechignent Ã  faire appel Ã  des DBA ou prendre des contrats de supports sur leur base. Quel est le cout d&amp;rsquo;une indisponibilitÃ© de service, d&amp;rsquo;une corruption de donnÃ©e, d&amp;rsquo;une perte de la base ?&lt;/li&gt;&#xA;&lt;li&gt;RÃ©investir le champ des compÃ©tences en base de donnÃ©e : SQL, modÃ©lisation&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;. A ce sujet, j&amp;rsquo;aime beaucoup le titre de Markus Winand : &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Renaissance Ambassador&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;S&amp;rsquo;attarder un peu plus sur l&amp;rsquo;usage des ressources : la consommation du numÃ©rique est importante, si les serveurs et l&amp;rsquo;Ã©lectricitÃ© Ã©taient plus chers, on serait contraint d&amp;rsquo;optimiser.&lt;/li&gt;&#xA;&lt;li&gt;Surveiller les dÃ©penses sur les bases. Que Ã§a soit dans le cloud, mais Ã©galement on-premise. Pour cela, il faut avoir des indicateurs de couts.&lt;/li&gt;&#xA;&lt;li&gt;Penser pas Ã  faire appel Ã  des DBA pour anticiper les problÃ¨mes et investiguer sur les problÃ¨mes de performance : J&amp;rsquo;ai auditÃ© des bases dans un Ã©tat catastrophique, Ã§a aurait pu Ãªtre Ã©vitÃ© si un DBA Ã©tait intervenu dans la phase de modÃ©lisation. Sur les problÃ¨mes de performance, il m&amp;rsquo;est dÃ©jÃ  arrivÃ© de diviser des factures de cloud par 10 ou de baisser la charge moyenne de 80% Ã  5% avec un suivi rÃ©gulier.&lt;/li&gt;&#xA;&lt;li&gt;Il ne faut pas se rÃ©signer Ã  payer de grosses factures cloud plutÃ´t que d&amp;rsquo;investir dans de la compÃ©tence de DBA.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;pour-conclure&#34;&gt;Pour conclure&lt;/h1&gt;&#xA;&lt;p&gt;C&amp;rsquo;est un article moins technique par rapport Ã  ce que vous avez l&amp;rsquo;habitude de lire sur mon blog.&#xA;Cependant, c&amp;rsquo;est un des plus importants que j&amp;rsquo;ai Ã©tÃ© amenÃ© Ã  Ã©crire.&#xA;Ca fait plus de dix ans que je fais du Postgres et je rÃ©alise que la tendance ne va pas dans la bonne direction.&#xA;J&amp;rsquo;espÃ¨re qu&amp;rsquo;il y aura une prise de conscience pour un avenir plus durable des bases de donnÃ©es.&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Ainsi que dans le public, il est dans le &lt;a href=&#34;https://code.gouv.fr/data/sill.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Socle interministÃ©riel de logiciels libres&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:2&#34;&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://twitter.com/pgconfeu/status/1734860251390750980&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;720 personnes Ã  la PGEurope 2023&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:3&#34;&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.datadoghq.com/blog/aws-ebs-latency-and-iops-the-surprising-truth/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS EBS latency and IOPS: The surprising truth&lt;/a&gt;&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Ultimately, due to AWSâ€™ opacity, there is simply no way to know how much throughput (from the physical disks and from the network that sits in-between) to expect for a given EBS volume. Provisioned IOPS only offer a partial solution to this issue, at a higher hourly cost.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:4&#34;&gt;&#xA;&lt;p&gt;Le Postgres actuel est trÃ¨s loin du Postgres avec lequel j&amp;rsquo;ai dÃ©butÃ© :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Nouvelles fonctionnalitÃ©s liÃ©es au standard SQL : JSONPath par exemple. &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Markus Winand&lt;/a&gt; est l&amp;rsquo;auteur d&amp;rsquo;un super site Ã  ce sujet: &lt;a href=&#34;https://modern-sql.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;Nouvelles fonctionnalitÃ©s sur le moteur : parallÃ©lisme, partitionnement, nouveaux noeuds d&amp;rsquo;exÃ©cution, rÃ©plication logique&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;La consÃ©quence est un nombre de paramÃ¨tres qui augmente au fur et Ã  mesure.&lt;/li&gt;&#xA;&lt;li&gt;De nouvelles extensions.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:5&#34;&gt;&#xA;&lt;p&gt;Je n&amp;rsquo;ai pas travaillÃ© avec ces offres, je n&amp;rsquo;ai pas de recul dessus. On peut nÃ©anmoins souligner que ces sociÃ©tÃ©s emploient des dÃ©veloppeurs qui contribuent Ã  Postgres.&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:6&#34;&gt;&#xA;&lt;p&gt;Il y a quelques annÃ©es, un article Ã©tait tirÃ© d&amp;rsquo;une confÃ©rence.&lt;/p&gt;&#xA;&lt;p&gt;Le titre est particuliÃ¨rement juste : &lt;a href=&#34;https://www.citusdata.com/blog/2018/03/19/postgres-database-constraints&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Database constraints in Postgres: The last line of defense&lt;/a&gt;.&#xA;Voici la vidÃ©o de la confÃ©rence : &lt;a href=&#34;https://www.youtube.com/watch?v=hWh8QoV8z8k&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Constraints: a Developer&amp;rsquo;s Secret Weapon - Will Leinweber&lt;/a&gt;&#xA;et ses &lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2018/sessions/session/1835/slides/70/2018-03-15%20constraints%20a%20developers%20secret%20weapon%20pgday%20paris.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;slides&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Optimisation du GROUP BY</title>
    <updated>2024-01-26T09:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-01-26:/2024/01/26/optimisation-du-group-by/</id>
    <link href="https://blog.anayrat.info/2024/01/26/optimisation-du-group-by/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Un commit a attirÃ© mon attention lors de ma veille technique :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;commit 0452b461bc405e6d35d8a14c02813c15e28ae516&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Author:     Alexander Korotkov &amp;lt;akorotkov@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AuthorDate: Sun Jan 21 22:21:36 2024 +0200&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Commit:     Alexander Korotkov &amp;lt;akorotkov@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CommitDate: Sun Jan 21 22:21:36 2024 +0200&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Explore alternative orderings of group-by pathkeys during optimization.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    When evaluating a query with a multi-column GROUP BY clause, we can minimize&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sort operations or avoid them if we synchronize the order of GROUP BY clauses&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    with the ORDER BY sort clause or sort order, which comes from the underlying&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    query tree. Grouping does not imply any ordering, so we can compare&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    the keys in arbitrary order, and a Hash Agg leverages this. But for Group Agg,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    we simply compared keys in the order specified in the query. This commit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    explores alternative ordering of the keys, trying to find a cheaper one.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    The ordering of group keys may interact with other parts of the query, some of&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    which may not be known while planning the grouping. For example, there may be&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    an explicit ORDER BY clause or some other ordering-dependent operation higher up&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    in the query, and using the same ordering may allow using either incremental&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sort or even eliminating the sort entirely.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    The patch always keeps the ordering specified in the query, assuming the user&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    might have additional insights.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    This introduces a new GUC enable_group_by_reordering so that the optimization&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    may be disabled if needed.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Discussion: https://postgr.es/m/7c79e6a5-8597-74e8-0671-1c39d124c9d6%40sigaev.ru&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Author: Andrei Lepikhov, Teodor Sigaev&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Tomas Vondra, Claudio Freire, Gavin Flower, Dmitry Dolgov&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Robert Haas, Pavel Borisov, David Rowley, Zhihong Yu&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Tom Lane, Alexander Korotkov, Richard Guo, Alena Rybakina&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On remarque le message du commit assez explicite en mentionnant les personnes impliquÃ©es (12 relecteurs!) ainsi que le lien vers la discussion :&#xA;&lt;a href=&#34;https://www.postgresql.org/message-id/flat/7c79e6a5-8597-74e8-0671-1c39d124c9d6%40sigaev.ru&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;POC: GROUP BY optimization&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Les travaux ont commencÃ© en 2018! Il aura fallu 5 ans et demi pour aboutir Ã  ce commit. C&amp;rsquo;est le fruit de nombreux Ã©changes afin de parvenir Ã  un consensus en prenant en compte les multiples idÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Pour tester ce patch, j&amp;rsquo;ai compilÃ© Postgres depuis les sources. Prenons un exemple tout simple :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_000_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;vacuum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On obtient une table de 422Mo et un index de 66Mo.&#xA;Vous noterez au passage que j&amp;rsquo;ai utilisÃ© une nouveautÃ© de Postgres 16 en utilisant des &amp;ldquo;underscore&amp;rdquo; dans le &lt;em&gt;generate_series&lt;/em&gt;&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Si on fait un &lt;code&gt;GROUP BY&lt;/code&gt; sur &lt;em&gt;c1,c2&lt;/em&gt;, on obtient un parcours d&amp;rsquo;index :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c1,c2 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                    QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------------------------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; GroupAggregate  (cost=0.43..235342.27 rows=100000 width=16) (actual time=3.605..3501.887 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Group Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Index Only Scan using t1_c1_c2_idx on t1  (cost=0.43..159340.96 rows=10000175 width=8) (actual time=0.070..1900.730 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Heap Fetches: 0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: enable_group_by_reordering = &amp;#39;off&amp;#39;, random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.191 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 3502.036 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Vous remarquerez que j&amp;rsquo;ai volontairement dÃ©sactivÃ© la fonctionnalitÃ© dans un premier temps (enable_group_by_reordering=off). J&amp;rsquo;ai Ã©galement dÃ©sactivÃ© la parallÃ©lisation pour plus de clartÃ©.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;On a le plan attendu, le moteur va lire 10447 blocs avec un parcours &lt;em&gt;Index Only Scan&lt;/em&gt;. Le moteur va chercher le plan qui manipule le moins de blocs possible.&lt;/p&gt;&#xA;&lt;p&gt;En revanche, si on change l&amp;rsquo;ordre du group by :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c2,c1 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                          QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Sort  (cost=602422.32..602672.32 rows=100000 width=16) (actual time=5393.446..5393.503 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Sort Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Sort Method: quicksort  Memory: 79kB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  HashAggregate  (cost=514992.50..594117.50 rows=100000 width=16) (actual time=5392.351..5392.894 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Group Key: c2, c1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Batches: 1  Memory Usage: 3217kB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         -&amp;gt;  Seq Scan on t1  (cost=0.00..154055.00 rows=10000000 width=8) (actual time=0.033..1186.171 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: enable_group_by_reordering = &amp;#39;off&amp;#39;, random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.189 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 5394.566 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans ce cas, le moteur va lire toute la table (&lt;em&gt;seqscan&lt;/em&gt;) et faire un tri, alors que le rÃ©sultat est identique.&lt;/p&gt;&#xA;&lt;p&gt;Le moteur lit 422Mo de donnÃ©es contre 80Mo, soit 5 fois plus. Le rÃ©sultat peut Ãªtre dÃ©sastreux suivant les performances du stockage.&#xA;LÃ , on a de la &amp;ldquo;chance&amp;rdquo;, mon instance est dans un ramdisk donc la requÃªte n&amp;rsquo;est pas beaucoup plus lente.&#xA;Avec du stockage mÃ©canique ou des disques cloud, le temps de rÃ©ponse peut augmenter drastiquement.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;ordre des colonnes dans un group by est important, c&amp;rsquo;est une optimisation assez simple pour peu qu&amp;rsquo;on connaisse le schÃ©ma de la base et qu&amp;rsquo;on maitrise les requÃªtes exÃ©cutÃ©es sur le serveur.&lt;/p&gt;&#xA;&lt;p&gt;Malheureusement, avec les ORM, on peut perdre cette maitrise ou rater des corrections.&#xA;C&amp;rsquo;est lÃ  oÃ¹ cette fonctionnalitÃ© est intÃ©ressante. Voyons son effet :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres=# set enable_group_by_reordering to on;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SET&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres=# explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c2,c1 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                    QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------------------------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; GroupAggregate  (cost=0.43..235338.33 rows=100000 width=16) (actual time=4.502..3658.168 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Group Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Index Only Scan using t1_c1_c2_idx on t1  (cost=0.43..159338.33 rows=10000000 width=8) (actual time=0.081..1923.553 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Heap Fetches: 0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.230 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 3658.337 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On retrouve le premier plan bien plus performant.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est une fonctionnalitÃ© assez simple qui devrait amÃ©liorer les temps d&amp;rsquo;exÃ©cutions de certaines requÃªtes dont la clause group by n&amp;rsquo;a pas Ã©tÃ© optimisÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est une demande assez rÃ©currente d&amp;rsquo;amÃ©liorer le planificateur afin de gÃ©rer des cas en apparence simple. Il faut avoir en tÃªte que le risque est de d&amp;rsquo;augmenter&#xA;les opÃ©rations de calculs dans le planificateur. Or, on veut que cette Ã©tape soit la plus rapide possible La rÃ©ponse est souvent rÃ©sumÃ©e Ã  : &amp;ldquo;on ne veut pas alourdir le planificateur alors qu&amp;rsquo;on peut corriger la requÃªte&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, ce type d&amp;rsquo;optimisation peut Ãªtre acceptÃ©e si on sait que Ã§a ne sera pas couteux pour le planificateur.&lt;/p&gt;&#xA;&lt;p&gt;Il n&amp;rsquo;y a plus qu&amp;rsquo;Ã  espÃ©rer que cette fonctionnalitÃ© ne soit pas retirÃ©e d&amp;rsquo;ici la sortie de Postgres 17 :)&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Petite anecdote, pour ajouter cette fonctionnalitÃ©, l&amp;rsquo;auteur a fait Ã©voluer le standard SQL : &lt;a href=&#34;http://peter.eisentraut.org/blog/2023/09/20/grouping-digits-in-sql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grouping digits in SQL&lt;/a&gt; .&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL compression du TOAST et toast_tuple_target</title>
    <updated>2022-02-14T07:00:00Z</updated>
    <id>tag:blog.anayrat.info,2022-02-14:/2022/02/14/postgresql-compression-du-toast-et-toast_tuple_target/</id>
    <link href="https://blog.anayrat.info/2022/02/14/postgresql-compression-du-toast-et-toast_tuple_target/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Quelques rappels sur le TOAST et prÃ©sentation d&amp;rsquo;un changement apparu avec PostgreSQL 11.&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#quest-ce-que-le-toast-&#34;&gt;Qu&amp;rsquo;est-ce que le TOAST ?&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#exemple-avec-le-jsonb&#34;&gt;Exemple avec le JSONB&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#paramÃ©trage-avancÃ©&#34;&gt;ParamÃ©trage avancÃ©&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#conclusion&#34;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#bonus&#34;&gt;Bonus&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;quest-ce-que-le-toast-&#34;&gt;Qu&amp;rsquo;est-ce que le TOAST ?&lt;/h1&gt;&#xA;&lt;p&gt;Vous Ãªtes-vous dÃ©jÃ  posÃ© la question sur comment Postgres fait pour stocker des lignes dÃ©passant la taille d&amp;rsquo;un bloc? Pour rappel, la taille par dÃ©faut d&amp;rsquo;un bloc est de 8Ko.&lt;/p&gt;&#xA;&lt;p&gt;Postgres utilise un mÃ©canisme appelÃ© TOAST pour &lt;a href=&#34;https://www.postgresql.org/docs/current/storage-toast.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Oversized-Attribute Storage Technique&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;un enregistrement devient trop gros pour Ãªtre stockÃ© dans un bloc, le moteur va le stocker &amp;ldquo;Ã  part&amp;rdquo;, dans une table de toast.&#xA;L&amp;rsquo;enregistrement sera dÃ©coupÃ© en &lt;em&gt;chunks&lt;/em&gt;, ainsi la table principale (appelÃ©e &lt;em&gt;heap&lt;/em&gt;) contiendra un pointeur (&lt;em&gt;chunk_id&lt;/em&gt;) pointant vers le bon &lt;em&gt;chunk&lt;/em&gt; dans la table de toast.&lt;/p&gt;&#xA;&lt;p&gt;Ce &lt;em&gt;chunk&lt;/em&gt; sera stockÃ© sur plusieurs lignes, pour un &lt;em&gt;chunk_id&lt;/em&gt; on peut avoir plusieurs lignes dans cette table de toast.&#xA;Ainsi, cette table de toast est composÃ©e de 3 colonnes:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_id&lt;/em&gt; : NumÃ©ro du chunk rÃ©fÃ©rencÃ© dans la heap&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_seq&lt;/em&gt; : NumÃ©ro de chaque segment d&amp;rsquo;un chunk&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_data&lt;/em&gt; : Partie donnÃ©es de chaque segment&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La rÃ©alitÃ© est un peu plus complexe, en vrai le moteur va tenter d&amp;rsquo;Ã©viter de stocker la donnÃ©e dans la table toast.&#xA;Si la ligne dÃ©passe &lt;code&gt;TOAST_TUPLE_THRESHOLD&lt;/code&gt; (2Ko), il va tenter de compresser les colonnes pour essayer de faire rentrer la ligne dans le bloc.&#xA;Plus prÃ©cisÃ©ment, il faut que la taille soit infÃ©rieure Ã  &lt;code&gt;TOAST_TUPLE_TARGET&lt;/code&gt; (2Ko par dÃ©faut, on va en reparler).&lt;/p&gt;&#xA;&lt;p&gt;Si on a de la chance, la ligne compressÃ©e rentre dans la heap. Sinon, il va tenter de compresser les colonnes,&#xA;de la plus grande Ã  la plus petite et les stocker dans la partie toast jusqu&amp;rsquo;Ã  ce que les colonnes restantes rentrent dans une ligne de la heap. &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;A noter Ã©galement que si le gain en compression est trop faible, il considÃ¨re qu&amp;rsquo;il est inutile de dÃ©penser&#xA;de la ressource de calcul Ã  tenter de compresser. Il stocke donc la donnÃ©e sans compression. &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;Avez-vous dÃ©jÃ  prÃªtÃ© attention Ã  la colonne &amp;ldquo;Storage&amp;rdquo; lorsque vous affichez les caractÃ©ristiques d&amp;rsquo;une table Ã  l&amp;rsquo;aide de la mÃ©ta commande &lt;code&gt;\d+ table&lt;/code&gt; ?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;stackoverflow=# \d+ posts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   Table &amp;#34;public.posts&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Column     |  Type   | Collation | Nullable | Default | Storage  |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---------------+---------+-----------+----------+---------+----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; id            | integer |           | not null |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; posttypeid    | integer |           | not null |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; score         | integer |           |          |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; viewcount     | integer |           |          |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; body          | text    |           |          |         | extended |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans cet exemple, la colonne prend comme valeur &lt;em&gt;plain&lt;/em&gt; ou &lt;em&gt;extended&lt;/em&gt;. En rÃ©alitÃ©, il existe 4 valeurs possibles selon le type de donnÃ©e :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;em&gt;plain&lt;/em&gt; : la colonne est stockÃ©e dans la heap uniquement et sans compression.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;extended&lt;/em&gt; : la colonne peut Ãªtre compressÃ©e et stockÃ©e dans le toast si nÃ©cessaire.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;external&lt;/em&gt; : la colonne peut Ãªtre stockÃ©e dans le toast mais uniquement sans compression. Parfois on peut utiliser ce mode pour avoir un gain en performance (Ã©vite la compression/dÃ©compression)&#xA;au prix d&amp;rsquo;une consommation plus importante de l&amp;rsquo;espace disque.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;main&lt;/em&gt; : La colonne est stockÃ©e dans la heap uniquement mais contrairement au mode &lt;em&gt;plain&lt;/em&gt;, on autorise la compression.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Au premier abord, on peut penser que l&amp;rsquo;intÃ©rÃªt est surtout sur la possibilitÃ© de stocker&#xA;des lignes dÃ©passant la taille d&amp;rsquo;un bloc et de compresser la donnÃ©e pour gagner de l&amp;rsquo;espace disque.&lt;/p&gt;&#xA;&lt;p&gt;Il y a un autre intÃ©rÃªt : lors d&amp;rsquo;une mise Ã  jour d&amp;rsquo;une ligne, si les colonnes &amp;ldquo;toastÃ©es&amp;rdquo; ne sont pas modifiÃ©es, le moteur n&amp;rsquo;a pas besoin de modifier la table toast.&#xA;On va ainsi Ã©viter de devoir dÃ©compresser et recompresser le toast et Ã©crire tout Ã§a dans des journaux de transaction.&lt;/p&gt;&#xA;&lt;p&gt;Nous allons voir qu&amp;rsquo;un autre avantage est que le moteur peut Ã©viter de lire le toast si ce n&amp;rsquo;est pas nÃ©cessaire.&lt;/p&gt;&#xA;&lt;h1 id=&#34;exemple-avec-le-jsonb&#34;&gt;Exemple avec le JSONB&lt;/h1&gt;&#xA;&lt;p&gt;Pour Ã©tudier Ã§a, on va utiliser le type JSONB. De maniÃ¨re gÃ©nÃ©rale, je dÃ©conseille l&amp;rsquo;usage de ce type :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;On perd les avantages d&amp;rsquo;avoir un schÃ©ma :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;vÃ©rification des types&lt;/li&gt;&#xA;&lt;li&gt;contraintes d&amp;rsquo;intÃ©gritÃ©&lt;/li&gt;&#xA;&lt;li&gt;pas de clÃ©s Ã©trangÃ¨res&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;L&amp;rsquo;Ã©criture des requÃªtes devient plus complexe&lt;/li&gt;&#xA;&lt;li&gt;Absence des statistiques sur les clÃ©s d&amp;rsquo;un champ json&lt;/li&gt;&#xA;&lt;li&gt;Perte d&amp;rsquo;efficacitÃ© du stockage vu qu&amp;rsquo;on stocke les clÃ©s pour chaque ligne&lt;/li&gt;&#xA;&lt;li&gt;Pas de mise Ã  jour partielle du JSONB. Si on modifie une clÃ© on est obligÃ© de &lt;em&gt;detoaster&lt;/em&gt; et &lt;em&gt;toaster&lt;/em&gt; tout le JSONB&lt;/li&gt;&#xA;&lt;li&gt;Pas de &lt;em&gt;detoast&lt;/em&gt; partiel : si on souhaite lire une seule clÃ© du JSONB, on est contraint de &lt;em&gt;detoaster&lt;/em&gt; tout le JSONB &lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cependant, il y a quelques exceptions oÃ¹ le JSON peut Ãªtre utile :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Lorsqu&amp;rsquo;on n&amp;rsquo;a pas besoin de chercher dans de multiples champs et qu&amp;rsquo;on rÃ©cupÃ¨re le json via une autre colonne. (Statistiques sur les clÃ©s du json inutiles).&lt;/li&gt;&#xA;&lt;li&gt;Et, lorsqu&amp;rsquo;il serait trÃ¨s difficile de faire rentrer le json dans un schÃ©ma relationnel. Certains cas impliqueraient d&amp;rsquo;avoir Ã©normÃ©ment de colonnes et la plupart Ã  &lt;code&gt;NULL&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Par exemple, pour stocker des caractÃ©ristiques de produit oÃ¹ une version normalisÃ©e entrainerait l&amp;rsquo;usage de beaucoup de colonnes dont la plupart seraient Ã  &lt;code&gt;NULL&lt;/code&gt;.&#xA;Imaginons que vous stockez des produits, une tÃ©lÃ©vision aurait des caractÃ©ristiques spÃ©cifiques (type d&amp;rsquo;Ã©cran, taille etc). Une machine Ã  laver aurait aussi d&amp;rsquo;autre caractÃ©ristiques spÃ©cifiques (vitesse essorage, poids acceptÃ©&amp;hellip;).&lt;/p&gt;&#xA;&lt;p&gt;On pourrait ainsi envisager d&amp;rsquo;avoir des colonnes &amp;ldquo;normales&amp;rdquo; comprenant le modÃ¨le, son prix, sa rÃ©fÃ©rence etc, et une colonne contenant toutes les caractÃ©ristiques.&#xA;On accÃ¨derait Ã  la ligne via la rÃ©fÃ©rence et ainsi on rÃ©cupÃ¨rerait toutes les caractÃ©ristiques du produit stockÃ©es dans le json.&lt;/p&gt;&#xA;&lt;p&gt;Je vais rÃ©utiliser la table des posts de Stackoverflow en dÃ©plaÃ§ant quelques colonnes dans une colonne de type jsonb (colonne &lt;em&gt;jsonfield&lt;/em&gt; dans cet exemple):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;\d posts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            Unlogged table &amp;#34;public.posts&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Column         |            Type             | Collation | Nullable | Default&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----------------------+-----------------------------+-----------+----------+---------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; id                    | integer                     |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; posttypeid            | integer                     |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; acceptedanswerid      | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; parentid              | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; creationdate          | timestamp without time zone |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; score                 | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; viewcount             | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; body                  | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; owneruserid           | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditoruserid      | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditordisplayname | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditdate          | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lastactivitydate      | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; title                 | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tags                  | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; answercount           | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; commentcount          | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; favoritecount         | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; closeddate            | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; communityowneddate    | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; jsonfield             | jsonb                       |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Voici une requÃªte toute simple d&amp;rsquo;agrÃ©gation :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;viewcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;answercount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commentcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;favoritecount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                          QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Aggregate  (cost=10265135.77..10265135.78 rows=1 width=128) (actual time=170221.557..170221.558 rows=1 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1 read=9186137&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   I/O Timings: read=138022.290&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Seq Scan on posts  (cost=0.00..9725636.88 rows=53949888 width=16) (actual time=0.014..153665.913 rows=53949886 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=1 read=9186137&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         I/O Timings: read=138022.290&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.240 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 170221.627 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(8 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La requÃªte lit 70 Go de donnÃ©es et met environ 2min 50s Ã  s&amp;rsquo;exÃ©cuter.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant la mÃªme requÃªte, mais cette fois en utilisant les clÃ©s prÃ©sentes dans le json.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ViewCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;AnswerCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CommentCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;FavoriteCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Aggregate  (cost=11883632.41..11883632.42 rows=1 width=128)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            (actual time=520917.028..520917.030 rows=1 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=241116554 read=13625756&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Seq Scan on posts  (cost=0.00..9725636.88 rows=53949888 width=570)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          (actual time=0.972..70569.365 rows=53949886 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared read=9186138&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.118 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 520945.395 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(10 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La requÃªte met environ 8min 40s Ã  s&amp;rsquo;exÃ©cuter. En revanche le nombre de blocs lus semble un peu dÃ©lirant :&lt;/p&gt;&#xA;&lt;p&gt;Le Seq Scan indique comme tout Ã  l&amp;rsquo;heure 70Go. En revanche, le nÅ“ud parent indique plus de 1.9 To lus!&lt;/p&gt;&#xA;&lt;p&gt;Voici la taille de la table avec le paramÃ©trage par dÃ©faut. Il faut savoir que pour certains enregistrements,&#xA;le moteur va, soit compresser la ligne dans la heap, soit la compresser et la placer dans le toast.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SELECT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(oid)) table_size,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(reltoastrelid)) toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FROM pg_class&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WHERE relname = &amp;#39;posts&amp;#39;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; table_size | toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------+-----------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 70 GB      | 33 GB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(1 row)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Comment expliquer les 1.9 To lus ?&lt;/p&gt;&#xA;&lt;p&gt;Par curiositÃ©, j&amp;rsquo;ai fait la mÃªme requÃªte, mais avec une seule agrÃ©gation et j&amp;rsquo;obtiens environ 538 Go.&lt;/p&gt;&#xA;&lt;p&gt;On peut se poser plusieurs questions :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Comment savoir si le moteur va lire le toast ?&lt;/li&gt;&#xA;&lt;li&gt;Pourquoi un tel Ã©cart de temps d&amp;rsquo;exÃ©cution entre la version &amp;ldquo;colonne standard&amp;rdquo; et champ jsonb?&lt;/li&gt;&#xA;&lt;li&gt;A quoi correspondent les compteurs dans le nÅ“ud &lt;code&gt;Aggregate&lt;/code&gt; ?&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pour rÃ©pondre Ã  la premiÃ¨re question, il suffit de lire la vue &lt;code&gt;pg_statio_user_tables&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Avant exÃ©cution de la requÃªte :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;select relid,schemaname,relname,heap_blks_read,heap_blks_hit,toast_blks_read,toast_blks_hit from pg_statio_all_tables where relname in (&amp;#39;posts&amp;#39;,&amp;#39;pg_toast_26180851&amp;#39;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  relid   | schemaname |      relname      | heap_blks_read | heap_blks_hit | toast_blks_read | toast_blks_hit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----------+------------+-------------------+----------------+---------------+-----------------+----------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180851 | public     | posts             |      422018238 |      87673549 |       129785076 |      628153337&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180854 | pg_toast   | pg_toast_26180851 |      129785076 |     628153337 |                 |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;AprÃ¨s :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  relid   | schemaname |      relname      | heap_blks_read | heap_blks_hit | toast_blks_read | toast_blks_hit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----------+------------+-------------------+----------------+---------------+-----------------+----------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180851 | public     | posts             |      431204376 |      87673549 |       134156898 |      686299551&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180854 | pg_toast   | pg_toast_26180851 |      134156898 |     686299551 |                 |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ce qui nous fait :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;431204376&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;87673549&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;422018238&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;87673549&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;heap_buffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;134156898&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;686299551&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;129785076&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;628153337&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_buffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;heap_buffers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_buffers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------+---------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;477&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Le moteur va bien lire le toast. En revanche les compteurs laissent penser que le moteur va lire plusieurs fois le toast.&lt;/p&gt;&#xA;&lt;p&gt;Si je fais le mÃªme calcul, mais cette fois en effectuant l&amp;rsquo;agrÃ©gation que sur un seul champ, j&amp;rsquo;obtiens 119 Go (~ 477 Go / 4)&#xA;J&amp;rsquo;imagine que le moteur lit le toast pour chaque fonction.&lt;/p&gt;&#xA;&lt;p&gt;Ensuite, l&amp;rsquo;Ã©cart du temps d&amp;rsquo;exÃ©cution s&amp;rsquo;explique par plusieurs facteurs :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le moteur va devoir lire et &lt;em&gt;detoaster&lt;/em&gt; (dÃ©compresser) le toast&lt;/li&gt;&#xA;&lt;li&gt;Faire des opÃ©rations supplÃ©mentaires sur le jsonb pour accÃ©der Ã  la valeur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Avec la premiÃ¨re requÃªte, le moteur n&amp;rsquo;avait pas Ã  lire le toast. D&amp;rsquo;une part, il a moins de donnÃ©es Ã  lire,&#xA;d&amp;rsquo;autre part, il n&amp;rsquo;a pas Ã  manipuler le json pour identifier la clÃ© et extraire la valeur Ã  calculer.&lt;/p&gt;&#xA;&lt;p&gt;Enfin, les compteurs du nÅ“ud aggregate doivent correspondre aux donnÃ©es dÃ©compressÃ©es pour chaque fonction qui va lire dans le json.&#xA;En effet, si on prend le total moins le &lt;em&gt;seqscan&lt;/em&gt; de la table, donc que la partie &lt;em&gt;toast&lt;/em&gt;, on a :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;468 Go pour un seul champ&lt;/li&gt;&#xA;&lt;li&gt;936 Go, le double pour deux champs&lt;/li&gt;&#xA;&lt;li&gt;1873 Go pour les 4 champs (donc environ 4 x 468 Go)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;C&amp;rsquo;est ce qui explique pourquoi on obtient une valeur aussi Ã©levÃ©e.&lt;/p&gt;&#xA;&lt;h1 id=&#34;paramÃ©trage-avancÃ©&#34;&gt;ParamÃ©trage avancÃ©&lt;/h1&gt;&#xA;&lt;p&gt;Maintenant, on va encourager Postgres Ã  placer le maximum de donnÃ©es dans le toast grÃ¢ce Ã  l&amp;rsquo;option &lt;em&gt;toast_tuple_target&lt;/em&gt; apparue avec la version 11 de Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Cette option permet de manipuler le seuil Ã  partir duquel les donnÃ©es sont stockÃ©e dans le &lt;em&gt;toast&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Par ailleurs, Ã©tant sous Postgres 14, j&amp;rsquo;en ai profitÃ© pour utiliser l&amp;rsquo;algorithme de compression lz4 (paramÃ¨tre &lt;em&gt;default_toast_compression&lt;/em&gt;).&#xA;Cet algorithme offre un ratio de compression similaire Ã  pglz, cependant, il est beaucoup plus rapide (Voir &lt;a href=&#34;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is the new LZ4 TOAST compression in PostgreSQL 14, and how fast is it?&lt;/a&gt;).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts_toast&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_tuple_target&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Voici la taille de la table obtenue.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SELECT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(oid)) table_size,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(reltoastrelid)) toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FROM pg_class&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WHERE relname = &amp;#39;posts_toast&amp;#39;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; table_size | toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------+------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 59 GB      | 52 GB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Au total, la table avec le toast fait grosso-modo la mÃªme taille. Dans l&amp;rsquo;exemple avec la premiÃ¨re table,&#xA;il faut savoir que le moteur compresse aussi les donnÃ©es dans la heap.&lt;/p&gt;&#xA;&lt;p&gt;Rejouons notre requÃªte d&amp;rsquo;agrÃ©gation :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;viewcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;answercount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commentcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;favoritecount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts_toast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cette fois la requÃªte lit 59 Go de donnÃ©es et met 2min 17 secondes.&#xA;On a gagnÃ© environ 20% de temps d&amp;rsquo;exÃ©cution sur cet exemple.&lt;/p&gt;&#xA;&lt;p&gt;On pourrait gagner beaucoup plus si la partie stockÃ©e en toast Ã©tait plus importante. Le volume de donnÃ©e Ã  lire dans la heap serait beaucoup plus rÃ©duit.&lt;/p&gt;&#xA;&lt;p&gt;Par curiositÃ©, j&amp;rsquo;ai aussi exÃ©cutÃ© la requÃªte qui fait l&amp;rsquo;agrÃ©gation depuis les donnÃ©es du champ json. J&amp;rsquo;obtiens un temps d&amp;rsquo;exÃ©cution de 7min 17s.&lt;/p&gt;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;RÃ©sumÃ© en quelques chiffres :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AgrÃ©gation type standard, stockage standard : 2min 50s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type jsonb, stockage standard : 8min 40s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type standard, stockage avec &lt;em&gt;toast_tuple_target&lt;/em&gt; = 128 : 2min 17s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type jsonb, stockage avec &lt;em&gt;toast_tuple_target&lt;/em&gt; = 128 : 7min 17s&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;On constate que l&amp;rsquo;usage du JSON est bien plus couteux que d&amp;rsquo;utiliser les types standards. Le moteur doit faire plus d&amp;rsquo;opÃ©rations pour accÃ©der Ã  la valeur d&amp;rsquo;une clÃ© json.&lt;/p&gt;&#xA;&lt;p&gt;Par ailleurs, il est obligÃ© de dÃ©compresser les donnÃ©es dans le toast pour y accÃ©der. NÃ©anmoins, on peut aussi jouer avec le paramÃ¨tre &lt;code&gt;toast_tuple_target&lt;/code&gt; pour pousser plus&#xA;d&amp;rsquo;informations dans le toast. Ainsi, dans certains cas, cela peut permettre de rÃ©duire la quantitÃ© de donnÃ©es lues en Ã©vitant de lire le toast.&lt;/p&gt;&#xA;&lt;h1 id=&#34;bonus&#34;&gt;Bonus&lt;/h1&gt;&#xA;&lt;p&gt;Comment souvent dans Postgres, tout Ã©volue au fil des versions. Le TOAST n&amp;rsquo;Ã©chappe pas Ã  cette rÃ¨gle.&#xA;Ainsi, quelques nouveautÃ©s pourraient apparaitre dans les prochaines versions :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Un premier patch a Ã©tÃ© proposÃ© pour avoir plus de statistiques sur le toast : &lt;a href=&#34;https://commitfest.postgresql.org/37/3457/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pg_stat_toast&lt;/a&gt;.&#xA;L&amp;rsquo;idÃ©e, est d&amp;rsquo;avoir des statistiques sur la compression : gain compression, stockage inline ou sÃ©parÃ© dans le toast&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;Un second patch appelÃ© &lt;a href=&#34;https://commitfest.postgresql.org/37/3490/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pluggable toaster&lt;/a&gt;. Celui-ci est beaucoup plus important. Il propose d&amp;rsquo;Ã©tendre le &lt;em&gt;&amp;ldquo;toaster&amp;rdquo;&lt;/em&gt;.&#xA;L&amp;rsquo;idÃ©e serait de pouvoir proposer diffÃ©rents &lt;em&gt;&amp;ldquo;toaster&amp;rdquo;&lt;/em&gt; selon le type de donnÃ©e (notamment le JSONB).&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Voir &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/access/heap/heaptoast.c;h=55bbe1d584760a849960871296dfbdd7447b2b67;hb=refs/heads/REL_14_STABLE#l160&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;heap_toast_insert_or_update&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:2&#34;&gt;&#xA;&lt;p&gt;Il existe deux algorithmes de compression supportÃ©s : &lt;em&gt;pglz&lt;/em&gt; (historique et intÃ©grÃ© dans Postgres) et &lt;em&gt;lz4&lt;/em&gt; (depuis Postgres 14).&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Pour &lt;em&gt;pglz&lt;/em&gt;, voir &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/include/common/pg_lzcompress.h;h=3e53fbe97bd0a10e3fbf7ed4396924084f657868;hb=refs/heads/REL_14_STABLE#l25&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGLZ_Strategy&lt;/a&gt;&#xA;et &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/common/pg_lzcompress.c;h=a30a2c2eb83a71725754d8dd680621a02e7557e9;hb=refs/heads/REL_14_STABLE#l223&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;strategy_default_data&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;Pour &lt;em&gt;lz4&lt;/em&gt;, il s&amp;rsquo;agit d&amp;rsquo;une librarie externe. Voir &lt;a href=&#34;https://github.com/lz4/lz4/blob/dev/lib/lz4.h#L145&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LZ4_compress_default&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:3&#34;&gt;&#xA;&lt;p&gt;Voir les slides de la confÃ©rence d&amp;rsquo;Oleg Bartunov et Nikita Glukhov : &lt;a href=&#34;http://www.sai.msu.su/~megera/postgres/talks/jsonb-nizhny-2021.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;json or not json that is the question&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Cas d&#39;usages du partitionnement natif dans PostgreSQL</title>
    <updated>2021-09-01T07:00:00Z</updated>
    <id>tag:blog.anayrat.info,2021-09-01:/2021/09/01/cas-dusages-du-partitionnement-natif-dans-postgresql/</id>
    <link href="https://blog.anayrat.info/2021/09/01/cas-dusages-du-partitionnement-natif-dans-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;AprÃ¨s une pÃ©riode d&amp;rsquo;inactivitÃ©, je reprends l&amp;rsquo;Ã©criture d&amp;rsquo;articles techniques sur Postgres. C&amp;rsquo;est aussi pour moi l&amp;rsquo;occasion de vous annoncer mon changement d&amp;rsquo;activitÃ©. Depuis courant 2021 je suis passÃ© freelance pour permettre aux entreprises de bÃ©nÃ©ficier de mon expÃ©rience sur Postgres.&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#histoire-du-partitionnement-dans-postgresql&#34;&gt;Histoire du partitionnement dans PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#erreurs-courantes&#34;&gt;Erreurs courantes&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#il-faut-partitionner-dÃ¨s-que-la-volumÃ©trie-est-importante&#34;&gt;&amp;ldquo;Il faut partitionner dÃ¨s que la volumÃ©trie est importante&amp;rdquo;&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#il-faut-partitionner-pour-rÃ©partir-les-donnÃ©es-sur-plusieurs-disques&#34;&gt;&amp;ldquo;Il faut partitionner pour rÃ©partir les donnÃ©es sur plusieurs disques&amp;rdquo;&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#cas-dusages-du-partitionnement&#34;&gt;Cas d&amp;rsquo;usages du partitionnement&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-gÃ©rer-la-rÃ©tention&#34;&gt;Partitionner pour gÃ©rer la rÃ©tention&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-contrÃ´ler-la-fragmentation-des-index&#34;&gt;Partitionner pour contrÃ´ler la fragmentation des index&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-faciliter-lexÃ©cution-de-requÃªte-lorsque-la-cardinalitÃ©-est-faible&#34;&gt;Partitionner pour faciliter l&amp;rsquo;exÃ©cution de requÃªte lorsque la cardinalitÃ© est faible&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-obtenir-de-meilleures-statistiques&#34;&gt;Partitionner pour obtenir de meilleures statistiques&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionwise-join--partitionwise-aggregate&#34;&gt;partitionwise join &amp;amp; partitionwise aggregate&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#stockage-avec-tiering&#34;&gt;Stockage avec tiering&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#conclusion&#34;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;histoire-du-partitionnement-dans-postgresql&#34;&gt;Histoire du partitionnement dans PostgreSQL&lt;/h1&gt;&#xA;&lt;p&gt;PostgreSQL permet depuis trÃ¨s longtemps de partitionner des tables en exploitant l&amp;rsquo;hÃ©ritage de table. Toutefois, cette mÃ©thode Ã©tait assez lourde Ã  mettre en oeuvre : elle impliquait de mettre en place soi-mÃªme des triggers pour rediriger les Ã©critures (moins performant que le partitionnement natif), le temps de planification pouvait augmenter fortement au-delÃ  d&amp;rsquo;une centaine de partitions&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Le partitionnement natif est arrivÃ© avec la version 10. C&amp;rsquo;est depuis cette version que le moteur est capable (entre autres) de diriger lui-mÃªme les Ã©critures vers les bonnes tables, lire seulement les tables concernÃ©es, d&amp;rsquo;utiliser des algorithmes exploitant le partitionnement etc.&#xA;Il offre ainsi de meilleures performances et une facilitÃ© d&amp;rsquo;exploitation. On peut entre autres :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Partitionner :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Par liste&lt;/li&gt;&#xA;&lt;li&gt;Par hashage&lt;/li&gt;&#xA;&lt;li&gt;Par intervalles&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Faire des partitionnements Ã  plusieurs niveaux&lt;/li&gt;&#xA;&lt;li&gt;Partitionner sur plusieurs colonnes&lt;/li&gt;&#xA;&lt;li&gt;Utiliser des clÃ©s primaires et clÃ©s Ã©trangÃ¨res&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Toutes ces fonctionnalitÃ©s sont intÃ©ressantes, mais on en vient Ã  se poser une question toute bÃªte : quand mettre en oeuvre le partitionnement?&lt;/p&gt;&#xA;&lt;p&gt;Je vais vous prÃ©senter plusieurs cas d&amp;rsquo;usages que j&amp;rsquo;ai pu rencontrer. Mais avant, voici quelques erreurs courantes sur le partitionnement.&lt;/p&gt;&#xA;&lt;h1 id=&#34;erreurs-courantes&#34;&gt;Erreurs courantes&lt;/h1&gt;&#xA;&lt;h2 id=&#34;il-faut-partitionner-dÃ¨s-que-la-volumÃ©trie-est-importante&#34;&gt;&amp;ldquo;Il faut partitionner dÃ¨s que la volumÃ©trie est importante&amp;rdquo;&lt;/h2&gt;&#xA;&lt;p&gt;DÃ©jÃ , qu&amp;rsquo;est-ce qu&amp;rsquo;une volumÃ©trie &amp;ldquo;importante&amp;rdquo;?&lt;/p&gt;&#xA;&lt;p&gt;Certains diront que c&amp;rsquo;est au-delÃ  de plusieurs centaines de Go, d&amp;rsquo;autres au-delÃ  du tÃ©raoctet, d&amp;rsquo;autres encore au-delÃ  du pÃ©taoctet&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Il n&amp;rsquo;existe pas vraiment de rÃ©ponse Ã  cette question et globalement Ã§a va dÃ©pendre du type d&amp;rsquo;activitÃ© : ratio INSERT/UPDATE/DELETE, type de SELECT (OLTP, OLAP&amp;hellip;).&#xA;Ca dÃ©pendra Ã©galement du matÃ©riel. Il y a 10 ans, quand les serveurs n&amp;rsquo;avaient que quelques Go de RAM avec des disques mÃ©caniques, il Ã©tait probable qu&amp;rsquo;une base de quelques centaines de Go soit perÃ§ue comme une grosse base.&#xA;Maintenant il n&amp;rsquo;est pas rare de voir des serveurs avec plus d&amp;rsquo;un tÃ©raoctet de RAM, des disques NVMe.&lt;/p&gt;&#xA;&lt;p&gt;Ainsi, une base de quelques centaines de Go n&amp;rsquo;est plus considÃ©rÃ©e comme une grosse base. Mais plutÃ´t comme une base de taille modeste.&lt;/p&gt;&#xA;&lt;p&gt;Petite anecdote, pour se rassurer, un client m&amp;rsquo;a questionnÃ© si Postgres Ã©tait dÃ©jÃ  utilisÃ© pour des volumÃ©tries &amp;ldquo;importantes&amp;rdquo;. On parlait alors d&amp;rsquo;une base d&amp;rsquo;une quarantaine de Go sur un serveur qui disposait de 64Go de RAM. Toutes les lectures se faisaient depuis le cache&amp;hellip; :). J&amp;rsquo;ai pu le rassurer sur la taille de sa base qui Ã©tait relativement modeste.&lt;/p&gt;&#xA;&lt;p&gt;Il peut tout Ã  fait Ãªtre superflu de partitionner une base de quelques To comme il peut Ãªtre nÃ©cessaire de partitionner une base de quelques centaines de Go. Par exemple, si l&amp;rsquo;activitÃ© consiste juste Ã  ajouter des lignes Ã  des tables et que les requÃªtes se rÃ©sument Ã  de simple &lt;code&gt;WHERE colonne = 4&lt;/code&gt; qui retournent quelques lignes. Un simple Btree fera l&amp;rsquo;affaire. Et si la requÃªte retourne un nombre assez important de lignes, il est possible d&amp;rsquo;utiliser les index BRIN ou les bloom filter.&lt;/p&gt;&#xA;&lt;p&gt;Les index BRIN prÃ©sentent des bÃ©nÃ©fices proches du partitionnement ou sharding en Ã©vitant la complexitÃ© de mise en oeuvre&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;il-faut-partitionner-pour-rÃ©partir-les-donnÃ©es-sur-plusieurs-disques&#34;&gt;&amp;ldquo;Il faut partitionner pour rÃ©partir les donnÃ©es sur plusieurs disques&amp;rdquo;&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;idÃ©e serait de crÃ©er des partitions et des tablespaces sur diffÃ©rents disques afin de rÃ©partir les opÃ©rations d&amp;rsquo;entrÃ©es/sorties.&lt;/p&gt;&#xA;&lt;p&gt;Pour PostgreSQL, un tablespace n&amp;rsquo;est ni plus, ni moins qu&amp;rsquo;un chemin vers un rÃ©pertoire. Il est tout Ã  fait possible&#xA;de gÃ©rer le stockage au niveau du systÃ¨me d&amp;rsquo;exploitation et d&amp;rsquo;agrÃ©ger plusieurs disques (en RAID10) par exemple.&#xA;Ensuite, il suffit de stocker la table sur le volume crÃ©Ã©. Ainsi, on peut rÃ©partir les I/O sur un ensemble de disques.&lt;/p&gt;&#xA;&lt;p&gt;Dans ce cas, il n&amp;rsquo;est donc pas nÃ©cessaire de mettre en oeuvre le partitionnement. Toutefois, nous verrons un cas oÃ¹ il pourrait avoir du sens.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant nous allons nous intÃ©resser Ã  des cas d&amp;rsquo;usage &amp;ldquo;lÃ©gitimes&amp;rdquo; du partitionnement.&lt;/p&gt;&#xA;&lt;h1 id=&#34;cas-dusages-du-partitionnement&#34;&gt;Cas d&amp;rsquo;usages du partitionnement&lt;/h1&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-gÃ©rer-la-rÃ©tention&#34;&gt;Partitionner pour gÃ©rer la rÃ©tention&lt;/h2&gt;&#xA;&lt;p&gt;A cause du modÃ¨le MVCC, la suppression massive de donnÃ©es entraine de la fragmentation dans les tables.&lt;/p&gt;&#xA;&lt;p&gt;Un cas d&amp;rsquo;usage possible est de partitionner par date. Supprimer les anciennes donnÃ©es revient Ã  supprimer une partition complÃ¨te. L&amp;rsquo;opÃ©ration sera rapide et les tables ne seront pas fragmentÃ©es&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-contrÃ´ler-la-fragmentation-des-index&#34;&gt;Partitionner pour contrÃ´ler la fragmentation des index&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;ajout et modification de donnÃ©es dans une table fragmente les index au fil du temps. Pour faire simple, on ne peut pas rÃ©cupÃ©rer l&amp;rsquo;espace libre dans un bloc tant qu&amp;rsquo;il n&amp;rsquo;est pas vide. Avec le temps les splits d&amp;rsquo;index crÃ©ent du &amp;ldquo;vide&amp;rdquo; dans ce dernier et le seul moyen de rÃ©cupÃ©rer cet espace est de reconstruire l&amp;rsquo;index.&lt;/p&gt;&#xA;&lt;p&gt;On appelle cela le &amp;ldquo;bloat&amp;rdquo;. Il y a eu de nombreuses amÃ©liorations sur les derniÃ¨res versions de Postgres:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 12, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/12/release-12.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Improve performance and space utilization of btree indexes with many duplicates (Peter Geoghegan, Heikki Linnakangas)&lt;/p&gt;&#xA;&lt;p&gt;Previously, duplicate index entries were stored unordered within their duplicate groups. This caused overhead during index inserts, wasted space due to excessive page splits, and it reduced VACUUM&amp;rsquo;s ability to recycle entire pages. Duplicate index entries are now sorted in heap-storage order.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 13, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;More efficiently store duplicates in B-tree indexes (Anastasia Lubennikova, Peter Geoghegan)&lt;/p&gt;&#xA;&lt;p&gt;This allows efficient B-tree indexing of low-cardinality columns by storing duplicate keys only once. Users upgrading with pg_upgrade will need to use REINDEX to make an existing index use this feature.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 14, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/14/release-14.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Allow btree index additions to remove expired index entries to prevent page splits (Peter Geoghegan)&lt;/p&gt;&#xA;&lt;p&gt;This is particularly helpful for reducing index bloat on tables whose indexed columns are frequently updated.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;Pour contrÃ´ler le bloat, on pourrait reconstruire l&amp;rsquo;index Ã  intervalles rÃ©guliers (merci &lt;code&gt;REINDEX CONCURRENTLY&lt;/code&gt; arrivÃ© en version 12). Cette solution serait contraignante, car il faudrait rÃ©guliÃ¨rement reconstruire l&amp;rsquo;intÃ©gralitÃ© de l&amp;rsquo;index.&lt;/p&gt;&#xA;&lt;p&gt;Si la majoritÃ© des modifications sont faites sur les donnÃ©es rÃ©centes, par exemple: table de logs, commandes clients, rendez-vous&amp;hellip; On pourrait imaginer un partitionnement par mois. Ainsi, Ã  chaque dÃ©but de mois on part sur une table &amp;ldquo;neuve&amp;rdquo; et on peut rÃ©-indexer la prÃ©cÃ©dente table pour supprimer le bloat.&lt;/p&gt;&#xA;&lt;p&gt;On peut aussi en profiter pour faire un &lt;code&gt;CLUSTER&lt;/code&gt; sur la table pour avoir une bonne corrÃ©lation des donnÃ©es avec le stockage.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-faciliter-lexÃ©cution-de-requÃªte-lorsque-la-cardinalitÃ©-est-faible&#34;&gt;Partitionner pour faciliter l&amp;rsquo;exÃ©cution de requÃªte lorsque la cardinalitÃ© est faible&lt;/h2&gt;&#xA;&lt;p&gt;Petit Ã  petit on va voir des cas d&amp;rsquo;usages un peu plus compliquÃ©s :)&lt;/p&gt;&#xA;&lt;p&gt;Prenons un exemple : une table de commande comprenant un statut de livraison, au bout de quelques annÃ©es 99% des commandes sont livrÃ©es (on l&amp;rsquo;espÃ¨re!) et trÃ¨s peu en cours de paiement ou livraison.&lt;/p&gt;&#xA;&lt;p&gt;Imaginons qu&amp;rsquo;on souhaite rÃ©cupÃ©rer 100 commandes en cours de livraison. On va crÃ©er un index sur le statut et l&amp;rsquo;utiliser pour rÃ©cupÃ©rer les enregistrements.&#xA;En Ã©tant un peu astucieux, on peut crÃ©er un index partiel sur ce statut particulier. ProblÃ¨me, cet index va se fragmenter assez vite au fur et Ã  mesure que les commandes seront livrÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Dans ce cas on pourrait faire un partitionnement sur le statut. Ainsi, rÃ©cupÃ©rer 100 commandes en cours de livraison revient Ã  lire 100 enregistrements de la partition.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-obtenir-de-meilleures-statistiques&#34;&gt;Partitionner pour obtenir de meilleures statistiques&lt;/h2&gt;&#xA;&lt;p&gt;Pour dÃ©terminer le meilleur plan d&amp;rsquo;exÃ©cution, Postgres prend des dÃ©cisions Ã  partir des statistiques d&amp;rsquo;une table. Ces statistiques sont obtenues Ã  partir d&amp;rsquo;un Ã©chantillon de la table (le &lt;code&gt;default_statistic_target&lt;/code&gt; qui vaut 100 par dÃ©faut).&lt;/p&gt;&#xA;&lt;p&gt;Par dÃ©faut le moteur va collecter 300 x &lt;code&gt;default_statistic_target&lt;/code&gt; lignes, soit 30 000 lignes. Avec une table de plusieurs centaines de millions de lignes, cet Ã©chantillon est parfois trop petit.&lt;/p&gt;&#xA;&lt;p&gt;On peut augmenter de maniÃ¨re drastique la taille de l&amp;rsquo;Ã©chantillon, mais cette approche prÃ©sente quelques inconvÃ©nients:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ca alourdis le temps de planification&lt;/li&gt;&#xA;&lt;li&gt;Ca alourdis le &lt;code&gt;ANALYZE&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Parfois ce n&amp;rsquo;est pas suffisant si les donnÃ©es sont mal rÃ©parties. Par exemple si on prend quelques centaines de milliers de lignes sur une table qui comprend plusieurs centaines de millions, on peut rater les lignes dont le statut est en livraison.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Avec le partitionnement on pourrait avoir un mÃªme Ã©chantillon, mais par partition, ce qui permet de gagner en prÃ©cision.&lt;/p&gt;&#xA;&lt;p&gt;Ce serait Ã©galement utile quand on a des donnÃ©es corrÃ©lÃ©es entre colonnes. Je vais reprendre l&amp;rsquo;exemple des commandes. On a une annÃ©e entiÃ¨re de commandes: toutes les commandes qui ont plus d&amp;rsquo;un mois sont livrÃ©es, celles du dernier mois sont livrÃ©es Ã  90% (10% sont en cours de livraison).&lt;/p&gt;&#xA;&lt;p&gt;Intuitivement, si je cherche une commande en cours de livraison il y a plus de 6 mois je ne devrais pas avoir de rÃ©sultat. Inversement, si je cherche des commandes en cours de livraison sur le dernier mois, je devrais obtenir 10% de la table. Or, le moteur ne le sait pas, pour lui les commandes en cours de livraison sont rÃ©parties sur toute la table.&lt;/p&gt;&#xA;&lt;p&gt;Avec un partitionnement par date, il peut estimer qu&amp;rsquo;il n&amp;rsquo;y a pas de commande en cours de livraisons de plus d&amp;rsquo;un mois. Ce type d&amp;rsquo;approche permet surtout de rÃ©duire une erreur d&amp;rsquo;estimation dans un plan d&amp;rsquo;exÃ©cution.&lt;/p&gt;&#xA;&lt;p&gt;Voici un exemple avec cette table de commandes, &lt;code&gt;orders_p&lt;/code&gt; est la version partitionnÃ©e par mois de la table &lt;code&gt;orders&lt;/code&gt;. Les donnÃ©es Ã©tant identiques dans les deux tables.&lt;/p&gt;&#xA;&lt;p&gt;On peut remarquer que l&amp;rsquo;estimation est bien meilleure dans le cas oÃ¹ la table est partitionnÃ©e, le moteur ayant des statistiques par partition.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_13_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_13&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;42&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;120&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;059&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;---------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;44&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3978&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Removed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100161&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;188&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;141&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;571&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Maintenant prenons la mÃªme requÃªte sur le dernier mois:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;43&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2417&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;19215&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20931&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;297&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;618&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;44&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15008&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20931&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Removed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;79230&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;146&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;326&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Ici aussi on peut remarquer que l&amp;rsquo;estimation est meilleure.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionwise-join--partitionwise-aggregate&#34;&gt;partitionwise join &amp;amp; partitionwise aggregate&lt;/h2&gt;&#xA;&lt;p&gt;Un autre intÃ©rÃªt du partitionnement est de bÃ©nÃ©ficier de meilleurs algorithmes pour les jointures et agrÃ©gation.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;code&gt;partitionwise aggregate&lt;/code&gt; permet de faire une agregation ou un regroupement partition par partition. Un exemple vaut mieux qu&amp;rsquo;un long discours:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;508361&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;508365&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Append&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;408317&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20008890&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20000000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45308&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;131708&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;576&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5273&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;217&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enable_partitionwise_aggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Append&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;408343&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;83&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1765&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60013&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60013&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;37&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45308&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;174455&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;174455&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;131708&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;461&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4669&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;315&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;63&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Dans le premier cas l&amp;rsquo;agrÃ©gation se fait une fois pour toutes les tables, alors que dans le second exemple, on fait l&amp;rsquo;agrÃ©gation par partition.&#xA;On peut Ã©galement remarquer que le coÃ»t total est infÃ©rieur dans le plan avec agrÃ©gation par partition.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;code&gt;partitionwise join&lt;/code&gt; fonctionne sur le mÃªme principe, on fait une jointure partition par partition. C&amp;rsquo;est utile pour joindre deux tables partitionnÃ©es.&lt;/p&gt;&#xA;&lt;h2 id=&#34;stockage-avec-tiering&#34;&gt;Stockage avec tiering&lt;/h2&gt;&#xA;&lt;p&gt;Enfin, un autre cas d&amp;rsquo;usage serait de vouloir stocker une partie de la table sur un stockage diffÃ©rent:&lt;/p&gt;&#xA;&lt;p&gt;On peut stocker une table partitionnÃ©e dans des tablespaces diffÃ©rents. Par exemple les donnÃ©es rÃ©centes sur un tablespace rapide sur SSD NVMe.&#xA;Puis les donnÃ©es plus rarement accÃ©dÃ©es sur un autre tablespace, avec des disques mÃ©caniques moins couteux.&lt;/p&gt;&#xA;&lt;p&gt;Cette approche peut aussi avoir du sens Ã  l&amp;rsquo;heure du cloud oÃ¹ le stockage est trÃ¨s onÃ©reux.&lt;/p&gt;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;VoilÃ , je pense avoir fait le tour des principaux cas d&amp;rsquo;usages qui me venaient en tÃªte.&lt;/p&gt;&#xA;&lt;p&gt;Evidemment, la mise en oeuvre du partitionnement implique une plus grande complexitÃ© (gestion des partitions&amp;hellip;)&#xA;et des limitations qu&amp;rsquo;il faudra Ã©tudier en amont.&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;&amp;ldquo;BRIN indexes provide similar benefits to horizontal partitioning or sharding but without needing to explicitly declare partitions.&amp;rdquo; - &lt;a href=&#34;https://en.wikipedia.org/wiki/Block_Range_Index&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://en.wikipedia.org/wiki/Block_Range_Index&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Mesurer facilement la latence I/O avec PostgreSQL 16</title>
    <updated>2023-09-02T16:30:00Z</updated>
    <id>tag:pgphil.ovh,2023-09-02:/traqueur_16_01.php</id>
    <link href="http://pgphil.ovh/traqueur_16_01.php" rel="alternate"></link>
    <summary type="html">DÃ©monstration avec le traqueur d&#39;une nouvelle fonctionnalitÃ© PostgreSQL 16 facilitant le suivi des performances et le diagnostic des ralentissements</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Mettre Ã  jour PostgreSQL pour amÃ©liorer les performances</title>
    <updated>2023-05-21T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-05-21:/migration_performance_14_15_01.php</id>
    <link href="http://pgphil.ovh/migration_performance_14_15_01.php" rel="alternate"></link>
    <summary type="html">Pagination, ex aequo...obtenez vos rÃ©sultats triÃ©s bien plus rapidement avec PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL inspire les autres SGBD ?</title>
    <updated>2023-04-12T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-04-12:/oracle23c_ou_oracle23p_comme_postgresql.php</id>
    <link href="http://pgphil.ovh/oracle23c_ou_oracle23p_comme_postgresql.php" rel="alternate"></link>
    <summary type="html">Oracle 23c ou 23p comme PostgreSQL ?</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>CYCLE</title>
    <updated>2022-12-03T15:00:00Z</updated>
    <id>tag:pgphil.ovh,2022-12-03:/nocycle_15_01.php</id>
    <link href="http://pgphil.ovh/nocycle_15_01.php" rel="alternate"></link>
    <summary type="html">NouveautÃ©s autour des requÃªtes hiÃ©rarchiques avec PostgreSQL 14 et versions supÃ©rieures</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>MERGE</title>
    <updated>2022-03-29T17:30:00Z</updated>
    <id>tag:pgphil.ovh,2022-03-29:/upsert_15_devel_01.php</id>
    <link href="http://pgphil.ovh/upsert_15_devel_01.php" rel="alternate"></link>
    <summary type="html">Introduction de la commande MERGE par PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Limitations du planner (optimiseur) de PostgreSQL</title>
    <updated>2022-03-06T18:45:00Z</updated>
    <id>tag:pgphil.ovh,2022-03-06:/limitations_planner_13_01.php</id>
    <link href="http://pgphil.ovh/limitations_planner_13_01.php" rel="alternate"></link>
    <summary type="html">Est-il toujours possible en 2022 de faire trÃ©bucher l&#39;optimiseur statistique de PostgreSQL ? Comment y remÃ©dier ?</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>[Infographie] PostgreSQL</title>
    <updated>2021-02-11T11:23:13Z</updated>
    <id>tag:blog.atolcd.com,2021-02-11:/infographie-postgresql/</id>
    <content type="html">&#xA;&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuliÃ¨rement chez Atol CD ! Retrouvez dans cette infographie quelques caractÃ©ristiques techniques, des chiffres-clÃ©, son histoire mais aussi pourquoi nous l&amp;rsquo;aimons et notre Top5 des fonctionnalitÃ©s cÃ´tÃ© dÃ©veloppement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-gallery columns-1 is-cropped wp-block-gallery-1 is-layout-flex wp-block-gallery-is-layout-flex&#34;&gt;&lt;ul class=&#34;blocks-gallery-grid&#34;&gt;&lt;li class=&#34;blocks-gallery-item&#34;&gt;&lt;figure&gt;&lt;img fetchpriority=&#34;high&#34; decoding=&#34;async&#34; width=&#34;866&#34; height=&#34;2560&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; alt=&#34;&#34; data-id=&#34;4477&#34; data-full-url=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; data-link=&#34;https://blog.atolcd.com/infographie-postgresql/infographie_postgresql/&#34; class=&#34;wp-image-4477&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg 866w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-101x300.jpg 101w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-346x1024.jpg 346w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-768x2271.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-520x1536.jpg 520w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-693x2048.jpg 693w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-600x1774.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-945x2794.jpg 945w&#34; sizes=&#34;(max-width: 866px) 100vw, 866px&#34; /&gt;&lt;/figure&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/figure&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/infographie-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=infographie-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuliÃ¨rement chez Atol CD ! Retrouvez dans cette infographie quelques caractÃ©ristiques techniques, des chiffres-clÃ©, son histoire mais aussi pourquoi nous l&amp;#8217;aimons et notre Top5 des fonctionnalitÃ©s cÃ´tÃ© dÃ©veloppement.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 13</title>
    <updated>2020-09-24T05:54:57Z</updated>
    <id>tag:blog.atolcd.com,2020-09-24:/sortie-de-postgresql-13/</id>
    <content type="html">&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;&lt;img decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-4130&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg&#34; alt=&#34;&#34; width=&#34;960&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg 960w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-300x169.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-768x432.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-600x338.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-945x532.jpg 945w&#34; sizes=&#34;(max-width: 960px) 100vw, 960px&#34; /&gt;MalgrÃ© des actualitÃ©s plutÃ´t moroses au Botswana concernant nos chers Ã©lÃ©phants, il y en a un qui se porte bien et est encore plus fort Ã  savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.Â &lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;AprÃ¨s seulement 3 versions BÃªta et une RC le voilÃ  dans les starting blocks pour dÃ©barquer sur vos serveurs ! Et comme Ã  chaque nouvelle version son&lt;/span&gt; &lt;span style=&#34;font-weight: 400;&#34;&gt;lot de nouveautÃ©s&lt;/span&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;Un petit rappel qui peut parfois Ã©viter bien des catastrophes, si vous avez prÃ©vu de migrer vers PostgreSQL 13, vous devriez jeter un oeil sur &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html#id-1.11.6.5.4&#34;&gt;les potentielles incompatibilitÃ©s avec les prÃ©cÃ©dentes versions&lt;/a&gt;Â  (et aussi sur les versions intermÃ©diaires si vous faite un gap de plusieurs versions d&amp;rsquo;un coup), il est toujours prÃ©fÃ©rable d&amp;rsquo;identifier ces lÃ©gers changements en amont plutÃ´t qu&amp;rsquo;une fois en production. Mais rassurez-vous, dans cette version pas de quoi freiner significativement une migration.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Partitionnement&lt;/h1&gt;&#xA;&lt;p&gt;Des amÃ©liorations sont ajoutÃ©es sur le partitionnement de tables, tant au niveau performance avec l&amp;rsquo;ajout de cas oÃ¹ une jointure directe entre partition peut Ãªtre utilisÃ©e dans une requÃªte, mais aussi de fonctionnalitÃ©s telles queÂ  la gestion des triggers avec le support de la clause BEFORE ou bien encore la rÃ©plication logique sans avoir besoin de publier chaque partition.&lt;/p&gt;&#xA;&lt;h1&gt;Index&lt;/h1&gt;&#xA;&lt;p&gt;LÃ  aussi des amÃ©liorations de performances mais aussi des gains d&amp;rsquo;espace disque sur les index B-tree surtout pour ceux contenant des doublons, mais si vous passez par un pg_upgrade il voudra passer par un reindex pour bÃ©nÃ©ficier de ces changements.&lt;/p&gt;&#xA;&lt;h1&gt;Planificateur&lt;/h1&gt;&#xA;&lt;p&gt;Le planificateur de requÃªte PostgreSQL a lui aussi eu le droit Ã  quelques amÃ©liorations notamment au niveau des statistiques ce qui peut amÃ©liorer les plans d&amp;rsquo;exÃ©cution et donc les performances.&lt;/p&gt;&#xA;&lt;h1&gt;Performance gÃ©nÃ©rale&lt;/h1&gt;&#xA;&lt;p&gt;Les performances ne sont pas en reste dans cette nouvelle version, avec l&amp;rsquo;ajout du &lt;span style=&#34;font-weight: 400;&#34;&gt;tri incrÃ©mentiel ce qui accÃ©lÃ¨re le tri des donnÃ©es dans certains cas, Â sur les agrÃ©gations de hachage qui peuvent dÃ©sormais utiliser le stockage sur disque dans le cadre de grands ensembles d&amp;rsquo;agrÃ©gation, sur la conversion de type entier vers texte.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Vues systÃ¨me&lt;/h1&gt;&#xA;&lt;p&gt;De nouvelles vues systÃ¨me font leur apparition :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#BASEBACKUP-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_basebackup &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#ANALYZE-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_analyze &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/view-pg-shmem-allocations.html&#34;&gt;pg_shmem_allocations &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#MONITORING-PG-STAT-SLRU-VIEW&#34;&gt;pg_stat_slru&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;la vue &lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#PG-STAT-ACTIVITY-VIEW&#34;&gt;pg_stat_activity&lt;/a&gt; se voit elle ajoutÃ©e une colonne leader_pid ce qui permet de retrouver rapidementÂ tous les processus impliquÃ©s dans une requÃªte parallÃ¨le.&lt;/p&gt;&#xA;&lt;h1&gt;FonctionnalitÃ©s&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ajout de la fonctionnalitÃ© &lt;a href=&#34;https://www.postgresql.org/docs/13/sql-select.html#SQL-LIMIT&#34;&gt;FETCH FIRST WITH TIES&lt;/a&gt; (vous trouverez &lt;a href=&#34;http://pgphil.ovh/topn_13_beta_01.php&#34;&gt;ici&lt;/a&gt; un exemple)&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la fonction gen_random_uuid() utilisable sans activer dâ€™extensions&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilitÃ© de renommer une colonne d&amp;rsquo;une vue :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;ALTER VIEW [ IF EXISTS ] name RENAME [ COLUMN ] column_name TO new_column_name&lt;/pre&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la fonction .datetime() dans les jsonpath pour convertir automatique une chaÃ®ne en date ou horodatage&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Client psql&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de nouvelles commandes pour afficher la description de classe d&amp;rsquo;opÃ©rateur et famille d&amp;rsquo;opÃ©rateur&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a class=&#34;link&#34; title=&#34;Meta-Commands&#34; href=&#34;https://www.postgresql.org/docs/13/app-psql.html#APP-PSQL-META-COMMANDS&#34;&gt;&lt;code class=&#34;literal&#34;&gt;\dAc&lt;/code&gt;&lt;/a&gt;,Â &lt;code class=&#34;literal&#34;&gt;\dAf&lt;/code&gt;,Â &lt;code class=&#34;literal&#34;&gt;\dAo&lt;/code&gt;, et &lt;code class=&#34;literal&#34;&gt;\dAp&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Ajout du statut de la transaction dans le promptÂ &lt;br /&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;* dans une transaction&lt;/li&gt;&#xA;&lt;li&gt;! dans un Ã©chec de transaction&lt;/li&gt;&#xA;&lt;li&gt;? pour un Ã©tat indÃ©terminÃ© de la transaction&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Administration&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la capacitÃ© de la commande VACUUM Ã  traiter des index en parallÃ¨le&lt;/li&gt;&#xA;&lt;li&gt;la commande reindexdb peut aussi parallÃ©liser les tÃ¢ches&lt;/li&gt;&#xA;&lt;li&gt;introduction de la notion de Â« trusted extension Â» qui permet Ã  un super utilisateur de dÃ©finir les extensions quâ€™un utilisateur a le droit d&amp;rsquo;installer dans sa base de donnÃ©es en ayant le droit CREATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout pour pg_dump de l&amp;rsquo;option &amp;#8211;include-foreign-data pour inclure dans la sauvegarde les donnÃ©es de serveurs distants&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La liste des nouveautÃ©s dans cette version est grande, toutes les nouveautÃ©s n&amp;rsquo;ont pas Ã©tÃ© abordÃ©es mais vous pouvez bien sur les retrouver dans la &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html&#34;&gt;note de version&lt;/a&gt;. Le focus a surtout Ã©tÃ© fait sur le cÃ´tÃ© utilisateur plutÃ´t qu&amp;rsquo;administrateur de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-13/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-13" rel="alternate"></link>
    <summary type="html">&lt;p&gt;MalgrÃ© des actualitÃ©s plutÃ´t moroses au Botswana concernant nos chers Ã©lÃ©phants, il y en a un qui se porte bien et est encore plus fort Ã  savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.Â  AprÃ¨s... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 11</title>
    <updated>2018-10-19T13:12:39Z</updated>
    <id>tag:blog.atolcd.com,2018-10-19:/sortie-de-postgresql-11/</id>
    <content type="html">&lt;p&gt;AprÃ¨s seulement une release candidate (mais auparavant 4 version bÃªta), PostgreSQL 11 vient de sortir!!!! Et comme Ã  chaque nouvelle version son lot de nouveautÃ©s que nous allons essayer de passer rapidement en revue.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-3169&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg&#34; alt=&#34;&#34; width=&#34;826&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg 826w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-300x196.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-768x502.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-600x392.jpg 600w&#34; sizes=&#34;(max-width: 826px) 100vw, 826px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;AmÃ©lioration de la parallÃ©lisation&lt;/h2&gt;&#xA;&lt;p&gt;Quoi de mieux que de commencer le tour des nouveautÃ©s par un sujet que l&amp;rsquo;on a abordÃ© lors du &lt;a href=&#34;https://blog.atolcd.com/conference-la-parallelisation-au-service-de-loptimisation/&#34;&gt;PG Day France 2018&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL 11 va encore plus loin dans la parallÃ©lisation avec :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;CrÃ©ation d&amp;rsquo;index B-tree en parallÃ¨le&lt;/li&gt;&#xA;&lt;li&gt;ParallÃ©lisation des UNION ALL&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration du Parallel hash join (parallÃ©liser le remplissage dâ€™une seule table de hachage, partagÃ©e) et parallelized sequential scans&lt;/li&gt;&#xA;&lt;li&gt;ParallÃ©lisation sur la crÃ©ation de vue matÃ©rialisÃ©e et table Ã  partir des rÃ©sultats d&amp;rsquo;une requÃªte&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE .. AS, SELECT INTO et CREATE MATERIALIZED VIEW.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un paramÃ¨tre de configuration du serveur Â«Â parallel_leader_participationÂ Â» qui permet de contrÃ´ler si le processus leader participe Ã  l&amp;rsquo;exÃ©cution des sous plans d&amp;rsquo;exÃ©cution&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;AmÃ©lioration du partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilitÃ© de partitionner une table par hashage de clÃ© (en plus des autres)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE hash1 (col1 NUMERIC, col2 VARCHAR(10)) PARTITION BY HASH(col1);&#xD;&#xA;CREATE TABLE hash1a PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 0) ;&#xD;&#xA;CREATE TABLE hash1b PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 1) ;&#xD;&#xA;CREATE TABLE hash1c PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 2) ;&#xD;&#xA;CREATE TABLE hash1d PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 3) ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout possible d&amp;rsquo;une partition par dÃ©faut pour les donnÃ©es ne correspondant Ã  aucune partition&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table1d PARTITION OF table1 DEFAULT;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilitÃ© de crÃ©er des clÃ©s primaires, clÃ©s Ã©trangÃ¨res, index et triggers qui seront automatiquement applicables sur l&amp;rsquo;ensemble des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support du changement automatique de partition en cas de mise Ã  jour de la clÃ© de partitionnement&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances lors des SELECT sur la lecture des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support des upsert sur les tables partitionnÃ©es&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;INSERT  INTO  tablep1 (col1, col2) &#xD;&#xA;VALUES  (100,  &#39;update&#39;) &#xD;&#xA;ON  CONFLICT ON CONSTRAINT tablep1_pkey &#xD;&#xA;DO UPDATE SET col2=&#39;update&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Gestion des transactions dans les procÃ©dures stockÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit la possibilitÃ© de crÃ©er des procÃ©dures (en PL/pgSQL, PL/Perl, PL/Python, et PL/Tcl). Depuis de nombreuses annÃ©es, il est possible dans PostgreSQL de crÃ©er des fonctions et bien ici Ã§a y ressemble fortement, sauf que l&amp;rsquo;on ne retourne pas de rÃ©sultats et que l&amp;rsquo;on peut gÃ©rer les transactions !&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PROCEDURE transaction_test1()&#xD;&#xA;LANGUAGE plpgsql&#xD;&#xA;AS $$&#xD;&#xA;BEGIN&#xD;&#xA;  FOR i IN 0..9 LOOP&#xD;&#xA;    INSERT INTO table1 (col1) VALUES (i) ;&#xD;&#xA;    IF i % 2 = 0 THEN&#xD;&#xA;      COMMIT;&#xD;&#xA;    ELSE&#xD;&#xA;      ROLLBACK;&#xD;&#xA;    END IF;&#xD;&#xA;  END LOOP;&#xD;&#xA;END;&#xD;&#xA;$$;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;exÃ©cution de ces procÃ©dures se fait en utilisant la commande CALL&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CALL transaction_test1();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Compilation JIT&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit le support de la compilation Just-in-Time (JIT) pour optimiser lâ€™exÃ©cution de code et dâ€™autres opÃ©rations. Utilisant des composants du projet LLVM, lâ€™introduction de JIT dans PostgreSQL accÃ©lÃ¨re les requÃªtes utilisant des expressions, listes, agrÃ©gats, projections, ainsi que certaines opÃ©rations internes.&lt;/p&gt;&#xA;&lt;p&gt;Pour pouvoir utiliser la compilation JIT, vous devrez installer la dÃ©pendance LLVM puis activer la compilation JIT soit dans le fichier de configuration (jit = on), soit durant votre session en exÃ©cutant SET jit = on.&lt;/p&gt;&#xA;&lt;p&gt;La compilation JIT bÃ©nÃ©ficie surtout aux requÃªtes de longue durÃ©e et limitÃ©es par le processeur. Ce seront souvent des requÃªtes analytiques (OLAP). Pour les requÃªtes courtes, le surcoÃ»t apportÃ© par la compilation JIT sera souvent supÃ©rieur au temps qu&amp;rsquo;elle permet de gagner.&lt;/p&gt;&#xA;&lt;h2&gt;AmÃ©liorations gÃ©nÃ©rales SQL&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de toutes les clauses (SQL:2011) dans les fonctions de fenÃªtrage ce qui permet maintenant lâ€™utilisation de RANGE dans des clauses PRECEDING/FOLLOWING, GROUPS ou dâ€™exclusion&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;WINDOW window_name AS ( &#xD;&#xA;  [ PARTITION BY expression [, ...] ]&#xD;&#xA;  [ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]&#xD;&#xA;  [ frame_clause ]&#xD;&#xA;)&#xD;&#xA;&#xD;&#xA;frame_clause :&#xD;&#xA;{ RANGE | ROWS | GROUPS } frame_start [ frame_exclusion ]&#xD;&#xA;{ RANGE | ROWS | GROUPS } BETWEEN frame_start AND frame_end [ frame_exclusion ]&#xD;&#xA;&#xD;&#xA;frame_start / frame_end :&#xD;&#xA;&#xD;&#xA;UNBOUNDED PRECEDING&#xD;&#xA;offset PRECEDING&#xD;&#xA;CURRENT ROW&#xD;&#xA;offset FOLLOWING&#xD;&#xA;UNBOUNDED FOLLOWING&#xD;&#xA;&#xD;&#xA;frame_exclusion :&#xD;&#xA;&#xD;&#xA;EXCLUDE CURRENT ROW&#xD;&#xA;EXCLUDE GROUP&#xD;&#xA;EXCLUDE TIES&#xD;&#xA;EXCLUDE NO OTHERS&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de fonctions de hash sha-2 : sha224(), sha256(), sha384() et sha512()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions de recherche plein texte : json(b)_to_tsvector() et websearch_to_tsquery()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;opÃ©rateur ^@ identique Ã  LIKE &amp;lsquo;mot%&amp;rsquo; mais plus efficace sur un index b-tree&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;text ^@ text&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration des index avec l&amp;rsquo;ajout du mot clef INCLUDE, qui permet d&amp;rsquo;indiquer une liste de colonnes qui seront incluses dans l&amp;rsquo;index comme des colonnes non clÃ©s. L&amp;rsquo;ajout de colonnes dans la crÃ©ation d&amp;rsquo;index permet alors l&amp;rsquo;utilisation de parcours d&amp;rsquo;index couvrants.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE [ UNIQUE ] INDEX [ CONCURRENTLY ] [ [ IF NOT EXISTS ] nom ] ON [ ONLY ] nom_table [ USING mÃ©thode ]&#xD;&#xA;    ( { nom_colonne | ( expression ) } [ COLLATE collation ] [ classeop ] [ ASC | DESC ] [ NULLS { FIRST | LAST } ] [, ...] )&#xD;&#xA;    [ INCLUDE ( nom_colonne [, ...] ) ]&#xD;&#xA;    [ WITH ( parametre_stockage = valeur [, ... ] ) ]&#xD;&#xA;    [ TABLESPACE nom_espacelogique ]&#xD;&#xA;    [ WHERE prÃ©dicat ]&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration de lâ€™ordre ALTER TABLE .. ADD COLUMN .. DEFAULT .. avec une valeur par dÃ©faut non NULL nâ€™a plus besoin de rÃ©Ã©crire entiÃ¨rement la table lors de son exÃ©cution, ce qui entraÃ®ne une grosse amÃ©lioration des performances.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Authentification&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;authentification LDAP, mais celle ci n&amp;rsquo;est utilisÃ©e que pour valider les paires nom d&amp;rsquo;utilisateur/mot de passe. De ce fait, pour pouvoir utiliser LDAP comme mÃ©thode d&amp;rsquo;authentification, l&amp;rsquo;utilisateur doit prÃ©alablement exister dans la base.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;psql&lt;/h2&gt;&#xA;&lt;p&gt;Le client psql Ã©volue lui aussi :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des commandes Â«Â quitÂ Â» et Â«Â exitÂ Â» dans le client psql&amp;#8230; (fini les personnes prisent de panique pour sortir de leur terminal ??? )&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://media.giphy.com/media/xTk9ZBWrma4PIC9y4E/giphy.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la commande \gdesc pour afficher les noms et types de colonnes du rÃ©sultat de la requÃªte&lt;/li&gt;&#xA;&lt;li&gt;Ajout de variables pour les erreurs et activitÃ©s des requÃªtes ERROR, SQLSTATE, ROW_COUNT, LAST_ERROR_MESSAGE, and LAST_ERROR_SQLSTATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilitÃ© de tester l&amp;rsquo;existence d&amp;rsquo;une variable par exemple dans un if&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;\if :{?variable_name}&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration de la complÃ©tion dans l&amp;rsquo;Ã©criture de requÃªtes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;En dehors de ces nouveautÃ©s en terme d&amp;rsquo;utilisation, cette nouvelle version apporte aussi des amÃ©liorations de performance et d&amp;rsquo;utilisation de mÃ©moire.&lt;/p&gt;&#xA;&lt;p&gt;Et voilÃ , nous avons fini notre petit tour rapide des nouveautÃ©s de postgreSQL 11, mais ne vous inquiÃ©tez pas une version 12 est dÃ©jÃ  en prÃ©paration pour le troisiÃ¨me trimestre 2019.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-11/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-11" rel="alternate"></link>
    <summary type="html">&lt;p&gt;AprÃ¨s seulement une release candidate (mais auparavant 4 version bÃªta), PostgreSQL 11 vient de sortir!!!! Et comme Ã  chaque nouvelle version son lot de nouveautÃ©s que nous allons essayer de passer rapidement en revue. AmÃ©lioration de la parallÃ©lisation Quoi de... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Pimp My PostgreSQL</title>
    <updated>2018-01-26T11:07:23Z</updated>
    <id>tag:blog.atolcd.com,2018-01-26:/pimp-my-postgresql/</id>
    <content type="html">&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignright wp-image-2934&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pimp-my-postgresql.png&#34; alt=&#34;&#34; width=&#34;491&#34; height=&#34;290&#34; /&gt;Une question qui se pose souvent aprÃ¨s l&amp;rsquo;installation d&amp;rsquo;une instance postgreSQL, c&amp;rsquo;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par dÃ©faut, ce qui ne va pas poser vraiment de problÃ¨me pour une utilisation lÃ©gÃ¨re. Mais si on a une instance postgreSQL avec postGIS et des millions d&amp;rsquo;enregistrements, cela va rapidement se trouver problÃ©matique si on laisse les valeurs par dÃ©faut&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;Pour les initiÃ©s qui installent rÃ©guliÃ¨rement de nouvelles instances postgreSQL, se plonger dans les plus de 600 lignes du fichier de configuration par dÃ©faut ne les effraie pas. Mais on n&amp;rsquo;installe pas forcÃ©ment tous les jours un nouveau serveur avec des caractÃ©ristiques diffÃ©rentes. Il faut donc soit se replonger pour une centiÃ¨me fois dans la documentation de postgres pour se rappeler Ã  notre bonne mÃ©moire les diffÃ©rents paramÃ¨tres et les valeurs Ã  adapter en fonction de la ram, disque, cpu&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;En plus de devoir se rappeler les &lt;strong&gt;paramÃ¨tres Ã  modifier,&lt;/strong&gt; il faut aussi connaÃ®tre les &lt;strong&gt;rÃ¨gles de calcul &lt;/strong&gt;pour les valeurs comme par exemple le Â«Â effective_cache_sizeÂ Â» qui est prÃ©conisÃ© Ã  75% de la ram total du serveur si celui-ci est dÃ©diÃ© Ã  postgres.&lt;/p&gt;&#xA;&lt;p&gt;Le but de cet article n&amp;rsquo;est pas de voir ni de dÃ©tailler tous les paramÃ¨tres de configuration possibles et inimaginables, mais de voir cela comme un mÃ©mo pour les initiÃ©s ou de sâ€™interroger sur les &lt;strong&gt;paramÃ¨tres qui seraient potentiellement Ã  modifier en fonction du serveur&lt;/strong&gt; (et des applications qui l&amp;rsquo;utilisent) si l&amp;rsquo;on ne connait pas l&amp;rsquo;utilisation des paramÃ¨tres de ce fichier postgresql.conf.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela un petit outil a Ã©tÃ© conÃ§u par Cybertec, qui permet de renseigner quelques caractÃ©ristiques et de voir Ã©voluer en consÃ©quence le fichier postgresql.conf notamment en fonction de la ram du serveur, du nombre de cpu, de la taille de la base&amp;#8230; etc.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-2925&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png&#34; alt=&#34;&#34; width=&#34;1005&#34; height=&#34;993&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png 1005w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-300x296.png 300w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-768x759.png 768w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-945x934.png 945w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-600x593.png 600w&#34; sizes=&#34;auto, (max-width: 1005px) 100vw, 1005px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cela ne remplace pas une connaissance aguerrie de postgreSQL et de sa configuration mais Ã§a permet de se faire une idÃ©e des paramÃ¨tres Ã  adapter en fonction de son serveur et de ses besoins.&lt;/p&gt;&#xA;&lt;p&gt;Cet outil est disponible en ligne Ã  cette adresse : &lt;a href=&#34;http://pgconfigurator.cybertec.at/&#34;&gt;http://pgconfigurator.cybertec.at/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/pimp-my-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=pimp-my-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Une question qui se pose souvent aprÃ¨s l&amp;#8217;installation d&amp;#8217;une instance postgreSQL, c&amp;#8217;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par dÃ©faut, ce qui ne va pas poser vraiment de problÃ¨me pour une... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 10</title>
    <updated>2017-10-05T13:28:32Z</updated>
    <id>tag:blog.atolcd.com,2017-10-05:/sortie-de-postgresql-10/</id>
    <content type="html">&lt;p&gt;Aujourd&amp;rsquo;hui, c&amp;rsquo;est la sortie de &lt;strong&gt;PostgreSQL 10&lt;/strong&gt;!!!! PremiÃ¨re rÃ©volution, la numÃ©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures Ã  10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des donnÃ©es. Une opÃ©ration beaucoup plus lourde que la seule mise Ã  jour des exÃ©cutables !&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2788&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg&#34; alt=&#34;&#34; width=&#34;558&#34; height=&#34;337&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg 558w, https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10-300x181.jpg 300w&#34; sizes=&#34;auto, (max-width: 558px) 100vw, 558px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Voici quelques dÃ©tails sur cette&lt;strong&gt; nouvelle version 10&lt;/strong&gt; et ce qu&amp;rsquo;elle apporte :&lt;/p&gt;&#xA;&lt;h2&gt;Performance et partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Le partitionnement de table est maintenant un attribut de la table :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table_name ( ... )&#xD;&#xA;[ PARTITION BY { RANGE | LIST } ( { column_name | ( expression ) }&#xD;&#xA;&#xD;&#xA;CREATE TABLE table_name&#xD;&#xA;PARTITION OF parent_table [ (&#xD;&#xA;) ] FOR VALUES partition_bound_spec&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;PostgreSQL 10 va plus loin dans la parallÃ©lisation avec le parallÃ©lisme des Index-Only Scan, Index Scan, Bitmap Heap Scan, Merge Join / Gather Merge, Subplan-Related Improvements&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances pour les agrÃ©gats et jointures avec &lt;code&gt;postgres_fdw&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances de l&amp;rsquo;analyseur de requÃªte&lt;/li&gt;&#xA;&lt;li&gt;Apparition des statistiques multi-colonnes&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration du plan dâ€™exÃ©cution des requÃªtes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;RÃ©plication et scalabilitÃ©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;RÃ©plication logique : lÃ©gÃ¨re et basÃ©e sur les WAL, rÃ©pliquant les objets individuellement via les commandes PUBLICATION (primaire) et SUBSCRIPTION (secondaire)&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PUBLICATION financials FOR TABLE ONLY loans, ONLY fines;&lt;/pre&gt;&lt;br /&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE SUBSCRIPTION financials&#xD;&#xA;CONNECTION &#39;dbname=libdata user=postgres host=172.17.0.2&#39;&#xD;&#xA;PUBLICATION financials;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;QUORUM replication : avec ANY et FIRST pour synchronous_standby_names;&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;synchronous_standby_names = ANY 2(node1,node2,node3);&#xD;&#xA;synchronous_standby_names = FIRST 2(node1,node2);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Suppression automatique Ã  la fin de la session des slots de rÃ©plication temporaires&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration de libpq permettant des connexions a de multiples systÃ¨mes&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances de la rÃ©plication physique&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Administration&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de la compression pour pg_receivewal&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;informations sur les Background processes et Wait Events dans pg_stat_activity&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions qui remontent Ã  l&amp;rsquo;utilisateur des informations sur le status de transaction. L&amp;rsquo;usage principal de ces fonctions est de dÃ©terminer les transactions commitÃ©es entre deux snapshots.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;txid_status(bigint)&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;FonctionnalitÃ©s SQL et dÃ©veloppeurs&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Gestion de colonne Identity qui vise Ã  remplacer l&amp;rsquo;utilisation du type serial et qui est conforme au standard SQL&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE test_new (&#xD;&#xA;    id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,&#xD;&#xA;    payload text&#xD;&#xA;);&lt;/pre&gt;&lt;p&gt;plus d&amp;rsquo;informations sur ce sujet &lt;a href=&#34;https://blog.2ndquadrant.com/postgresql-10-identity-columns/&#34;&gt;ici par exemple&lt;/a&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;PossibilitÃ© de renommer la valeur d&amp;rsquo;une Ã©numÃ©ration&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TYPE langage AS ENUM (&#39;SQL&#39;, &#39;JAVA&#39;, &#39;HTML&#39;) ;&#xD;&#xA;ALTER TYPE langage RENAME VALUE &#39;HTML&#39; TO &#39;HTML5&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des triggers AFTER STATEMENT qui peuvent avoir accÃ¨s Ã  lâ€™ensemble des lignes modifiÃ©es, avant et aprÃ¨s changement, Ã  travers une pseudo-variable de type table&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TRIGGER nom_trigger AFTER DELETE ON nom_table&#xD;&#xA;REFERENCING OLD TABLE AS OLD&#xD;&#xA;FOR EACH STATEMENT&#xD;&#xA;EXECUTE PROCEDURE nom_procedure();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la fonction xmltable qui produit une table basÃ©e sur la valeur XML donnÃ©e.&lt;/li&gt;&#xA;&lt;li&gt;Supprimer des Ã©lÃ©ments d&amp;rsquo;un JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;SELECT &#39;{&#34;a&#34;:1 , &#34;b&#34;:2, &#34;c&#34;:3}&#39;::jsonb - &#39;{a,c}&#39;::text[] ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Il est possible de crÃ©er des indexes full text sur une colonne JSON ou JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE INDEX bookdata_fts ON bookdata&#xD;&#xA;USING gin (( to_tsvector(&#39;english&#39;,bookdata) ));&#xD;&#xA;&#xD;&#xA;SELECT bookdata -&amp;gt; &#39;title&#39;&#xD;&#xA;FROM bookdata&#xD;&#xA;WHERE to_tsvector(&#39;english&#39;,bookdata) @@ to_tsquery(&#39;duke&#39;);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;SÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Authentification SCRAM plus sÃ©curisÃ©e que md5&lt;/li&gt;&#xA;&lt;li&gt;CrÃ©ation de nouveau rÃ´le pour le monitoring Ã©vitant ainsi d&amp;rsquo;Ãªtre super utilisateur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;pg_read_all_settings : Lit toutes les variables de configuration, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_read_all_stats : Lit toutes les vues pg_stat_* et utilise plusieurs extensions relatives aux statistiques, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_stat_scan_tables : ExÃ©cute des fonctions de monitoring pouvant prendre des verrous verrous ACCESS SHARE sur les tables, potentiellement pour une longue durÃ©e.&#xD;&#xA;pg_monitor : Lit et exÃ©cute plusieurs vues et fonctions de monitoring. Ce rÃ´le est membre de pg_read_all_settings, pg_read_all_stats et pg_stat_scan_tables.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de politiques restrictive dans les politiques de sÃ©curitÃ© pour l&amp;rsquo;accÃ¨s aux lignes et plus seulement de politiques permissives&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE POLICY admin_local_only ON passwd AS RESTRICTIVE TO admin&#xD;&#xA;    USING (pg_catalog.inet_client_addr() IS NULL);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Autres fonctionnalitÃ©s&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;file_fdw peut maintenant utiliser les programmes&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE FOREIGN TABLE&#xD;&#xA;   test(a int, b text)&#xD;&#xA;   SERVER csv&#xD;&#xA;   OPTIONS (program &#39;gunzip -c /tmp/data.czv.gz&#39;);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;support des collations ICU&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un module amcheck permettant de vÃ©rifier cohÃ©rence / corruption d&amp;rsquo;un index B-Tree&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE EXTENSION amcheck ;&#xD;&#xA;   SELECT bt_index_check(&#39;idx1_check1&#39;) ;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Modifications entrainant une incompatibilitÃ© ascendante&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;â€œxlogâ€ et â€œclogâ€ qui deviennent respectivement â€œwalâ€ et â€œxactâ€.&lt;/li&gt;&#xA;&lt;li&gt;fin du support du protocole client/serveur 1.0 (clients datant dâ€™avant la version 6.3)&lt;/li&gt;&#xA;&lt;li&gt;changement de valeurs par dÃ©faut pour pg_basebackup&lt;/li&gt;&#xA;&lt;li&gt;fin du support des TIMESTAMP avec floating point.&lt;/li&gt;&#xA;&lt;li&gt;Le module contrib/tsearch2 a Ã©tÃ© supprimÃ© qui permettait une comptabilitÃ© avec les fonction de recherche full text avant la version 8.3&lt;/li&gt;&#xA;&lt;li&gt;fin du support de la commande pg_dump pour les bases de donnÃ©es plus anciennes que la version 8.0&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Et voilÃ , nous avons fini notre petit tour rapide des nouveautÃ©s de postgreSQL 10 mais une version 11 est dÃ©jÃ  prÃ©vue pour dans 12 mois !&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-10/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-10" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Aujourd&amp;#8217;hui, c&amp;#8217;est la sortie de PostgreSQL 10!!!! PremiÃ¨re rÃ©volution, la numÃ©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures Ã  10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Nouveau module dâ€™export de donnÃ©es pour REMOcRA</title>
    <updated>2017-05-12T13:52:26Z</updated>
    <id>tag:blog.atolcd.com,2017-05-12:/nouveau-module-dexport-de-donnees-remocra/</id>
    <content type="html">&lt;h1&gt;Objectif du module&lt;/h1&gt;&#xA;&lt;p&gt;Le SDIS du Var ne disposait pas jusqu&amp;rsquo;Ã  ce jour, Ã  travers la plate-forme collaborative &lt;a href=&#34;http://sdis.atolcd.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;REMOcRA&lt;/a&gt;, d&amp;rsquo;une mÃ©thode simple pour exporter le contenu de la base de donnÃ©es auprÃ¨s de ses partenaires. Les demandes Ã©tant de plus en plus rÃ©currentes, le SDIS du Var a dÃ©cidÃ© &lt;strong&gt;de faire Ã©voluer l&amp;rsquo;application pour l&amp;rsquo;enrichir d&amp;rsquo;un module dÃ©diÃ© aux exports&lt;/strong&gt; et a confiÃ© Ã  Atol Conseils et DÃ©veloppements sa rÃ©alisation en veillant Ã  respecter les besoins suivants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;En tant qu&amp;rsquo;administrateur de l&amp;rsquo;extranet, Ãªtre en mesure de rÃ©aliser facilement des exports de donnÃ©es en se basant sur des modÃ¨les administrables. Ce module devait Ãªtre en mesure de produire des fichiers tabulaires ou des fichiers gÃ©ographiques.&lt;/li&gt;&#xA;&lt;li&gt;En tant que partenaire, Ãªtre en mesure d&amp;rsquo;exporter soit mÃªme les donnÃ©es mises Ã  disposition par le SDIS sur un territoire autorisÃ©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Comment Ã§a marche ?&lt;/h1&gt;&#xA;&lt;h2&gt;Un fonctionnement basÃ© sur des modÃ¨les d&amp;rsquo;exports&lt;/h2&gt;&#xA;&lt;p&gt;Le mÃ©canisme d&amp;rsquo;export repose sur des modÃ¨les. Ces derniers peuvent Ãªtre rÃ©fÃ©rencÃ©s directement par les administrateurs de la plate-forme REMOcRA grÃ¢ce Ã  des fichiers de dÃ©finition de modÃ¨le (format XML) dÃ©posÃ©s fia FTP dans un sous-dossier de REMOcRA.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-large wp-image-2626&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-1024x220.png&#34; alt=&#34;&#34; width=&#34;676&#34; height=&#34;145&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-1024x220.png 1024w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-300x64.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-768x165.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-945x203.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-600x129.png 600w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1.png 1067w&#34; sizes=&#34;auto, (max-width: 676px) 100vw, 676px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Le fichier XML prÃ©cise principalement la requÃªte SQL Ã  utiliser pour filtrer et formater les donnÃ©es Ã  la bonne structure. L&amp;rsquo;attribut spatial du nÅ“ud racine permet de prÃ©ciser si l&amp;rsquo;export est de type tabulaire (CSV) ou gÃ©ographique (Esri Shapefile). Dans le cas d&amp;rsquo;un export gÃ©ographique, la colonne Â« wkt Â» contenant la gÃ©omÃ©trie encodÃ©e en WKT est exploitÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2627&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2.png&#34; alt=&#34;&#34; width=&#34;822&#34; height=&#34;341&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2.png 822w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2-300x124.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2-768x319.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2-600x249.png 600w&#34; sizes=&#34;auto, (max-width: 822px) 100vw, 822px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Le rÃ©fÃ©rencement des modÃ¨les est rÃ©alisÃ© directement depuis l&amp;rsquo;interface en exÃ©cutant depuis REMOcRAÂ le traitement Â« RÃ©fÃ©rencer les modÃ¨les d&amp;rsquo;export de donnÃ©es Â» disponible dans la catÃ©gorie d&amp;rsquo;applications Â« Divers Â»&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2628&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3.png&#34; alt=&#34;&#34; width=&#34;968&#34; height=&#34;288&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3.png 968w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-300x89.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-768x228.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-945x281.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-600x179.png 600w&#34; sizes=&#34;auto, (max-width: 968px) 100vw, 968px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Un traitement spÃ©cifique intÃ©grant le filtrage spatial des donnÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-large wp-image-2629&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-1024x525.png&#34; alt=&#34;&#34; width=&#34;676&#34; height=&#34;347&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-1024x525.png 1024w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-300x154.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-768x394.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-945x484.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-600x307.png 600w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4.png 1167w&#34; sizes=&#34;auto, (max-width: 676px) 100vw, 676px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;La rÃ©alisation d&amp;rsquo;un export de donnÃ©es depuis le systÃ¨me REMOcRAÂ se base sur le mÃ©canisme suivant :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;L&amp;rsquo;utilisateur de profil Â« administrateur Â» dispose d&amp;rsquo;un nouveau traitement intitulÃ© Â« Exporter les donnÃ©es Ã  partir d&amp;rsquo;un modÃ¨le Â». Ce dernier permet de rÃ©aliser des exports de donnÃ©es en s&amp;rsquo;appuyant sur la liste de modÃ¨les.&lt;/li&gt;&#xA;&lt;li&gt;AprÃ¨s avoir choisi son modÃ¨le, la demande d&amp;rsquo;export formulÃ©e par l&amp;rsquo;utilisateur est stockÃ©e en file d&amp;rsquo;attente. Une tÃ¢che planifiÃ©e vÃ©rifie rÃ©guliÃ¨rement la prÃ©sence de demandes en attente&lt;/li&gt;&#xA;&lt;li&gt;Lors de lâ€™exÃ©cution de la tÃ¢che planifiÃ©e, le moteur ETL exÃ©cute les demandes d&amp;rsquo;export en attente en s&amp;rsquo;appuyant sur les informations contenues dans le modÃ¨le pour gÃ©nÃ©rer un fichier CSV (dans le cas de donnÃ©es non gÃ©ographiques) ou des fichiers de formes (fichiers ESRI Shapefile).&lt;/li&gt;&#xA;&lt;li&gt;A l&amp;rsquo;issu du traitement, les fichiers produits sont compressÃ©s au format ZIP et un lien de tÃ©lÃ©chargement est fourni dans un mÃ©l envoyÃ© au demandeur du traitement.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2630&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5.png&#34; alt=&#34;&#34; width=&#34;962&#34; height=&#34;367&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5.png 962w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-300x114.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-768x293.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-945x361.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-600x229.png 600w&#34; sizes=&#34;auto, (max-width: 962px) 100vw, 962px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Une mutualisation des connaissances !&lt;/h2&gt;&#xA;&lt;p&gt;Le SDIS du Var (83), Ã  l&amp;rsquo;initiative de la plate-forme collaborative mÃ©tier REMOcRA, a dÃ©cidÃ© de faire bÃ©nÃ©ficier ses confrÃ¨res de sa dÃ©marche en redistribuant gratuitement l&amp;rsquo;outil et ce module sous licence Creative Commons.&lt;br /&gt;&#xA;Dans cette dÃ©marche open source, la solution et le nouveau module sont disponibles sur Github pour installation et test Ã  tous les SDIS sur &lt;a href=&#34;https://github.com/atolcd/sdis-remocra&#34; target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;https://github.com/atolcd/sdis-remocra&lt;/a&gt;. Pour plus d&amp;rsquo;information sur la solution REMOcRA, consulter &lt;a href=&#34;http://sdis.atolcd.com&#34; target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;http://sdis.atolcd.com&lt;/a&gt;&lt;br /&gt;&#xA;&lt;em&gt;REMOcRA est cofinancÃ© par lâ€™Union europÃ©enne. Lâ€™Europe sâ€™engage avec le Fonds europÃ©en de dÃ©veloppement rÃ©gional.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/&#34;&gt;Nouveau module d&amp;rsquo;export de donnÃ©es pour REMOcRA&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=nouveau-module-dexport-de-donnees-remocra" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Objectif du module Le SDIS du Var ne disposait pas jusqu&amp;#8217;Ã  ce jour, Ã  travers la plate-forme collaborative REMOcRA, d&amp;#8217;une mÃ©thode simple pour exporter le contenu de la base de donnÃ©es auprÃ¨s de ses partenaires. Les demandes Ã©tant de plus... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/&#34;&gt;Nouveau module d&amp;rsquo;export de donnÃ©es pour REMOcRA&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity</title>
    <updated>2020-03-08T05:33:26Z</updated>
    <id>tag:rjuju.github.io,2020-03-08:/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html</id>
    <content type="html">&lt;h3 id=&#34;nouvelle-colonne-leader_pid-dans-la-vue-pg_stat_activity&#34;&gt;Nouvelle colonne leader_pid dans la vue pg_stat_activity&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ã‰tonnamment, depuis que les requÃªtes parallÃ¨les ont Ã©tÃ© ajoutÃ©es dans&#xA;PostgreSQL 9.6, il Ã©tait impossible de savoir Ã  quel processus client Ã©tait liÃ©&#xA;un worker parallÃ¨le.  Ainsi, comme &lt;a href=&#34;https://twitter.com/g_lelarge/status/1209486212190343168&#34;&gt;Guillaume lâ€™a fait&#xA;remarquer&lt;/a&gt;, it makes&#xA;il est assez difficile de construire des outils simples permettant&#xA;dâ€™Ã©chantillonner les Ã©vÃ©nements dâ€™attente liÃ©s Ã  tous les processus impliquÃ©s&#xA;dans une requÃªte.  Une solution simple Ã  ce problÃ¨me est dâ€™exporter&#xA;lâ€™information de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;lock group leader&lt;/code&gt; disponible dans le processus client au&#xA;niveau SQL :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit b025f32e0b5d7668daec9bfa957edf3599f4baa8&#xA;Author: Michael Paquier &amp;lt;michael@paquier.xyz&amp;gt;&#xA;Date:   Thu Feb 6 09:18:06 2020 +0900&#xA;&#xA;Add leader_pid to pg_stat_activity&#xA;&#xA;This new field tracks the PID of the group leader used with parallel&#xA;query.  For parallel workers and the leader, the value is set to the&#xA;PID of the group leader.  So, for the group leader, the value is the&#xA;same as its own PID.  Note that this reflects what PGPROC stores in&#xA;shared memory, so as leader_pid is NULL if a backend has never been&#xA;involved in parallel query.  If the backend is using parallel query or&#xA;has used it at least once, the value is set until the backend exits.&#xA;&#xA;Author: Julien Rouhaud&#xA;Reviewed-by: Sergei Kornilov, Guillaume Lelarge, Michael Paquier, Tomas&#xA;Vondra&#xA;Discussion: https://postgr.es/m/CAOBaU_Yy5bt0vTPZ2_LUM6cUcGeqmYNoJ8-Rgto+c2+w3defYA@mail.gmail.com&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Avec cette modification, il est maintenant trÃ¨s simple de trouver tous les&#xA;processus impliquÃ©s dans une requÃªte parallÃ¨le.  Par exemple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;array_agg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_activity&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;GROUP&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;       &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-------------------+------------+---------------&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;mi&#34;&gt;31630&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32269&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32268&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Attention toutefois, comme indiquÃ© dans le message de commit, si la colonne&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;leader_pid&lt;/code&gt; Ã  la mÃªme valeur que la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pid&lt;/code&gt;, cela ne veut pas forcÃ©ment&#xA;dire que le processus client est actuellement en train dâ€™effectuer une requÃªte&#xA;parallÃ¨le, car une fois que le champ est positionnÃ© il nâ€™est jamais&#xA;rÃ©initialisÃ©.  De plus, pour Ã©viter tout surcoÃ»t, aucun verrou supplÃ©mentaire&#xA;nâ€™est maintenu lors de lâ€™affichage de ces donnÃ©es.  Cela veut dire que chaque&#xA;ligne est traitÃ©e indÃ©pendamment.  Ainsi, bien que cela soit fort peu probable,&#xA;vous pouvez obtenir des donnÃ©es incohÃ©rentes dans certaines circonstances,&#xA;comme par exemple un worker paralÃ¨lle pointant vers un pid qui est dÃ©jÃ &#xA;dÃ©connectÃ©.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html&#34;&gt;Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on March 08, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>pgÂ qualstats 2: Suggestion d&#39;index globale</title>
    <updated>2020-01-06T12:23:29Z</updated>
    <id>tag:rjuju.github.io,2020-01-06:/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html</id>
    <content type="html">&lt;p&gt;Parvenir Ã  une suggestion dâ€™index de qualitÃ© peut Ãªtre une tÃ¢che complexe.&#xA;Cela nÃ©cessite Ã  la fois une connaissance des requÃªtes applicatives et des&#xA;spÃ©cificitÃ©s de la base de donnÃ©es.  Avec le temps de nombreux projets ont&#xA;essayÃ© de rÃ©soudre ce problÃ¨me, lâ€™un dâ€™entre eux Ã©tant &lt;a href=&#34;https://powa.readthedocs.io/&#34;&gt;PoWA version&#xA;3&lt;/a&gt;, avec lâ€™aide de &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_qualstats.html&#34;&gt;pg_qualstats&#xA;extension&lt;/a&gt;.&#xA;Cet outil donne de plutÃ´t bonnes suggestions dâ€™index, mais il est nÃ©cessaire&#xA;dâ€™installer et configurer PoWA, alors que certains utilisateurs aimeraient&#xA;nâ€™avoir que la suggestion dâ€™index globale.  Pour rÃ©pondre Ã  ce besoin de&#xA;simplicitÃ©, lâ€™algorithme utilisÃ© dans PoWA est maintenant disponible dans&#xA;pg_qualstats version 2, sans avoir besoin dâ€™utiliser des composants&#xA;additionnels.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;EDIT: La fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_qualstats_index\_advisor()&lt;/code&gt; a Ã©tÃ© changÃ©e pour retourner&#xA;du &lt;strong&gt;json&lt;/strong&gt; plutÃ´t que du &lt;strong&gt;jsonb&lt;/strong&gt;, afin de conserver la compatibilitÃ© avec PostgreSQL&#xA;9.3.  Les requÃªtes dâ€™exemples sont donc Ã©galement modifiÃ©es pour utiliser&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;json_array_elements()&lt;/code&gt; plutÃ´t que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;jsonb_array_elements()&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;quest-ce-que-pg_qualstats&#34;&gt;Quâ€™est-ce que pg_qualstats&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une maniÃ¨re simple dâ€™expliquer ce quâ€™est pg_qualstats serait de dire quâ€™il&#xA;sâ€™agit dâ€™une extension similaire Ã &#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/pgstatstatements.html&#34;&gt;pg_stat_statements&lt;/a&gt;&#xA;mais travaillant au niveaux des prÃ©dicats.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette extension sauvegarde des statistiques utiles pour les clauses &lt;strong&gt;WHERE&lt;/strong&gt;&#xA;et &lt;strong&gt;JOIN&lt;/strong&gt; : Ã  quelle table et quelle colonne un prÃ©dicat fait rÃ©fÃ©rÃ©nce, le&#xA;nombre de fois quâ€™un prÃ©dicat a Ã©tÃ© utilisÃ©, le nombre dâ€™exÃ©cutions de&#xA;lâ€™opÃ©rateur sous-jacent, si le prÃ©dicat provient dâ€™un parcours dâ€™index ou non,&#xA;la sÃ©lectivitÃ©, la valeur des constantes et bien plus encore.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est possible de dÃ©duire beaucoup de choses depuis ces informations.  Par&#xA;exemple, si vous examinez les prÃ©dicats qui contiennent des rÃ©fÃ©rences Ã  des&#xA;tables diffÃ©rentes, vous pouvez trouver quelles tables sont jointes ensembles,&#xA;et Ã  quel point les conditions de jointures sont sÃ©lectives.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;suggestion-globale-&#34;&gt;Suggestion Globale ?&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Comment je lâ€™ai mentionnÃ©, la suggestion dâ€™index globale ajoutÃ©e dans&#xA;pg_qualstats 2 utilise la mÃªme approche que celle de PoWA, ainsi cet article&#xA;peut servir Ã  dÃ©crire le fonctionnement des deux outils.  La seule diffÃ©rence&#xA;est que vous obtiendrez probablement une suggestion de meilleure qualitÃ© avec&#xA;PoWA, puisque plus de prÃ©dicats seront disponibles, et que vous pourrez&#xA;Ã©galement choisir sur quel intervalle de temps vous souhaitez effectuer une&#xA;suggestion dâ€™index manquants.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La chose importante Ã  retenir ici est quâ€™il sâ€™agit dâ€™une suggestion effectuÃ©e&#xA;de maniÃ¨re &lt;strong&gt;globale&lt;/strong&gt;, câ€™est-Ã -dire en prenant en compte tous les prÃ©dicats&#xA;intÃ©ressant en mÃªme temps.  Cette approche est diffÃ©rente de toutes les autres&#xA;dont jâ€™ai connaissance, qui ne prennent en compte quâ€™une seule requÃªte Ã  la&#xA;fois.  Selon moi, une approche globale est meilleure, car il est possible de&#xA;rÃ©duire le nombre total dâ€™index, en maximisant lâ€™efficacitÃ© des index&#xA;multi-colonnes.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;comment-marche-la-suggestion-globale&#34;&gt;Comment marche la suggestion globale&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;La premiÃ¨re Ã©tape consiste Ã  rÃ©cupÃ©rer tous les prÃ©dicats qui pourraient&#xA;bÃ©nÃ©ficier de nouveaux index.  Câ€™est particuliÃ¨rement facile Ã  obtenir avec&#xA;pg_qualstats.  En filtrant les prÃ©dicats venant dâ€™un parcours sÃ©quentiel,&#xA;exÃ©cutÃ©s de nombreuses fois et qui filtrent de nombreuses lignes (Ã  la fois en&#xA;nombre et en pourcentage), vous obtenez une liste parfaite de prÃ©dicats qui&#xA;auraient trÃ¨s probablement besoin dâ€™un index (ou alors dans certains cas une&#xA;liste des requÃªtes mal Ã©crites).  Voyons regardons par exemple le cas dâ€™une&#xA;applications qui utiliserait ces 4 prÃ©dicats:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_1_quals.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_1_quals.png&#34; alt=&#34;Liste de tous les prÃ©dicats&#xA;trouvÃ©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, il faut construire lâ€™ensemble entier des chemins de toutes les&#xA;prÃ©dicats joints par un AND logique, qui contiennent dâ€™autres prÃ©dicats, qui&#xA;peuvent Ãªtre eux-meme Ã©galement joints par des AND logiques.  En utilisants les&#xA;mÃªme 4 prÃ©dicats vus prÃ©cÃ©demments, nous obtenons ces chemins :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_2_graphs.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_2_graphs.png&#34; alt=&#34;Construction de tous les chemins de prÃ©dicats&#xA;possibles&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois tous les chemins construits, il suffit dâ€™obtenir le meilleur chemin&#xA;pour trouver le meilleur index Ã  suggÃ©rer.  Le classement de ces chemins est&#xA;pour le moment fait en donnant un poids Ã  chaque nÅ“ud de chaque chemin qui&#xA;correspond au nombre de prÃ©dicats simple quâ€™il contient, et en additionnant le&#xA;poids pour chaque chemin.  Câ€™est une approche trÃ¨s simple, et qui permet de&#xA;favoriser un nombre minimal dâ€™index qui optimisent le plus de requÃªtes&#xA;possible.  Avec nos exemple, nous obtenons :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_3_weighted.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_3_weighted.png&#34; alt=&#34;Ajout d&#39;un poids Ã  tous les chemins et choix du score le plus&#xA;haut&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, dâ€™autres approches de classement pourraient Ãªtre utilisÃ©e pour&#xA;prendre en compte dâ€™autres paramÃ¨tres, et potentiellement obtenir une meilleur&#xA;suggestion.  Par exemple, en prenant en compte Ã©galement le nombre dâ€™exÃ©cution&#xA;ou la sÃ©lectivitÃ© des prÃ©dicats.  Si le ratio de lecture/Ã©criture pour chaque&#xA;table est connu (ce qui est disponible avec lâ€™extension&#xA;&lt;a href=&#34;https://github.com/powa-team/powa-archivist&#34;&gt;powa-archivist&lt;/a&gt;), il serait&#xA;Ã©galement possible dâ€™adapter le classement pour limiter la suggestion dâ€™index&#xA;pour les tables qui ne sont accÃ©dÃ©es presque exclusivement en Ã©criture.  Avec&#xA;cet algorithme, ces ajustements seraient relativement simples Ã  faire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois que le meilleur chemin est trouvÃ©, on peut gÃ©nÃ©rer lâ€™ordre de crÃ©ation&#xA;de lâ€™index !  Comme lâ€™ordre des colonnes peut Ãªtre important, lâ€™ordre est&#xA;gÃ©nÃ©rÃ© en rÃ©cupÃ©rant les colonnes de chaque nÅ“ud par poids croissant.  Avec&#xA;notre exemple, lâ€™index suivant est gÃ©nÃ©rÃ© :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Une fois que lâ€™index est trouvÃ©, on supprime simplement les prÃ©dicats contenus&#xA;de la liste globale de prÃ©dicats et on reprendre de zÃ©ro jusquâ€™Ã  ce quâ€™il nâ€™y&#xA;ait plus de prÃ©dicats.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;un-peu-plus-de-dÃ©tails-et-mise-en-garde&#34;&gt;Un peu plus de dÃ©tails et mise en garde&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, il sâ€™agit ici dâ€™une version simplifiÃ©e de lâ€™algorithme de&#xA;suggestion, car dâ€™autres informations sont nÃ©cessaires.  Par exemple, la liste&#xA;des prÃ©dicats est en rÃ©alitÃ© ajustÃ©e avec les &lt;a href=&#34;https://www.postgresql.org/docs/current/indexes-opclass.html&#34;&gt;classes dâ€™opÃ©rateurs et mÃ©thode&#xA;dâ€™acces&lt;/a&gt; en&#xA;fonction du type de la colonne et de sont opÃ©rateur, afin de sâ€™assurer&#xA;dâ€™obtenir des index valides.  Si plusieurs mÃ©thodes dâ€™accÃ¨s aux index sont&#xA;trouvÃ©es pour un mÃªme meilleur chemin, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;btree&lt;/code&gt; sera choisi en prioritÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cela nous amÃ¨ne Ã  un autre dÃ©tail : cette approche est principalement pensÃ©e&#xA;pour les index &lt;strong&gt;btree&lt;/strong&gt;, pour lesqules lâ€™ordre des colonnes est critiques.&#xA;Dâ€™autres mÃ©thodes dâ€™accÃ¨s ne requiÃ¨rent pas un ordre spÃ©cifique pour les&#xA;colonnes, et pour ces mÃ©thodes dâ€™accÃ¨s il est possible quâ€™une suggestion plus&#xA;optimale soit possible si lâ€™ordre des colonnes nâ€™Ã©tait pas pris en compte.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un autre point important est que les classes dâ€™opÃ©rateurs et mÃ©thodes dâ€™accÃ¨s&#xA;ne sont pas gÃ©rÃ©s en dur mais rÃ©cupÃ©rÃ©s Ã  lâ€™exÃ©cution en utilisant les&#xA;catalogues locaux.  Par consÃ©quent, vous pouvez obtenir des rÃ©sultats&#xA;diffÃ©rents (et potentiellement meilleurs) si vous faites en sorte dâ€™avoir&#xA;toutes les classes dâ€™opÃ©rateur additionelles disponibles quand vous utilisez la&#xA;suggestion dâ€™index globale.  Cela pourrait Ãªtre les extensions &lt;strong&gt;btree_gist&lt;/strong&gt;&#xA;et &lt;strong&gt;btree_gist&lt;/strong&gt;, mais Ã©galement dâ€™autres mÃ©thodes dâ€™accÃ¨s aux index.  Il est&#xA;Ã©galement possible que certain types / opÃ©rateurs nâ€™aient pas de mÃ©thode&#xA;dâ€™accÃ¨s associÃ©e dans les catalogues.  Dans ce cas, ces prÃ©dicats sont&#xA;retournÃ©es sÃ©parÃ©ment dans une liste de prÃ©dicats non optimisables&#xA;automatiquement, et pour lequel une analyse manuelle est nÃ©cessaire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Enfin, comme pg_qualstats ne traite pas les prÃ©dicats composÃ©s dâ€™expressions,&#xA;lâ€™outil ne peut pas suggÃ©rer dâ€™index sur des expressions, par exemple en cas&#xA;dâ€™utilisateur de recherche plein texte.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;exemple-dutilisation&#34;&gt;Exemple dâ€™utilisation&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une simple fonction est fournie, avec des paramÃ¨tres facultatifs, qui retourne&#xA;une valeur de type json :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_selectivity&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;forbidden_am&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;{}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Les noms de paramÃ¨tres sont parlants :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_filter&lt;/code&gt;: combien de lignes le prÃ©dicat doit-il filtrer en moyenne pour&#xA;Ãªtre pris en compte par la suggestion globale, par dÃ©faut &lt;strong&gt;1000&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_selectivity&lt;/code&gt;: quelle doit Ãªtre la sÃ©lectivitÃ© moyenne dâ€™un prÃ©dicat&#xA;pour quâ€™il soit pris en compte par la suggestion globale, par dÃ©faut&#xA;&lt;strong&gt;30%&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;forbidden_am&lt;/code&gt;: liste des mÃ©thodes dâ€™accÃ¨s aux index Ã  ignorer.  Aucune par&#xA;dÃ©faut, bien que pour les version 9.6 et infÃ©rieures &lt;strong&gt;les index hash sont&#xA;ignorÃ© en interne&lt;/strong&gt;, puisque ceux-ci ne sont sur que depuis la version 10.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple simple, tirÃ©s des tests de non rÃ©gression de pg_qualstats :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;a&#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;line &#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ILIKE&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;moh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Et voici ce que la fonction retourne :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;indexes&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;                               &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------------------------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (id1)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (val, id1, id2, id3)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.pgqs USING btree (id)&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;unoptimised&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;        &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;adv.val ~~* ?&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/&#34;&gt;version 2 de pg_qualstats&lt;/a&gt;&#xA;nâ€™est pas encore disponible en version stable, mais nâ€™hÃ©sitez pas Ã  la tester&#xA;et &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/issues&#34;&gt;rapporter tout problÃ¨me que vous pourriez&#xA;rencontrer&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html&#34;&gt;pgÂ qualstats 2: Suggestion d&#39;index globale&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on January 06, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: Nouveau daemon powa-collector</title>
    <updated>2019-12-10T18:54:17Z</updated>
    <id>tag:rjuju.github.io,2019-12-10:/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie dâ€™une sÃ©rie dâ€™article sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et dÃ©crit le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-daemon-powa-collector&#34;&gt;Nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ce daemon remplace le prÃ©cÃ©dent &lt;em&gt;background worker&lt;/em&gt; lorsque le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;mode&#xA;remote&lt;/a&gt; est utilisÃ©.&#xA;Il sâ€™agit dâ€™un simple daemon Ã©crit en python, qui sâ€™occupera de toutes les&#xA;Ã©tapes nÃ©cessaires pour effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;.  Il est &lt;a href=&#34;https://pypi.org/project/powa-collector/&#34;&gt;disponible&#xA;sur pypi&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme je lâ€™ai expliquÃ© dans mon &lt;a href=&#34;/postgresql/2019/05/17/powa-4-with-remote-mode-beta-is-available.html&#34;&gt;prÃ©cÃ©dent article introduistant PoWA 4&lt;/a&gt;, ce&#xA;daemon est nÃ©cessaire  pour la configuration dâ€™un mode remote, en gardant cette&#xA;architecture Ã  lâ€™esprit :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture de PoWA 4 en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Sa configuration est trÃ¨s simple.  Il vous suffit tout simplement de renommer&#xA;le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa-collector.conf.sample&lt;/code&gt; fourni, et dâ€™adapter &lt;a href=&#34;https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING&#34;&gt;lâ€™URI de&#xA;connexion&lt;/a&gt;&#xA;pour dÃ©crire comment se connecter sur votre &lt;em&gt;serveur repository&lt;/em&gt; dÃ©diÃ©, et&#xA;câ€™est fini.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une configuration typique devrait ressembler Ã  :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;{&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;repository&#34;&lt;/span&gt;: {&#xA;        &lt;span class=&#34;s2&#34;&gt;&#34;dsn&#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&#34;postgresql://powa_user@server_dns:5432/powa&#34;&lt;/span&gt;,&#xA;    },&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;debug&#34;&lt;/span&gt;: &lt;span class=&#34;n&#34;&gt;true&lt;/span&gt;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La liste des &lt;em&gt;serveur distants&lt;/em&gt;, leur configuration ainsi que tout le reste qui&#xA;est nÃ©cessaire pour le bon fonctionnement sera automatiquement rÃ©cupÃ©rÃ© depuis&#xA;le &lt;em&gt;serveur repository&lt;/em&gt; que vous ave dÃ©jÃ  configurÃ©.  Une fois dÃ©marrÃ©, il&#xA;dÃ©marrera un thread dÃ©diÃ© par &lt;em&gt;serveur distant&lt;/em&gt; dÃ©clarÃ©, et maintiendra une&#xA;&lt;strong&gt;connexion persistente&lt;/strong&gt; sur ce &lt;em&gt;serveur distant&lt;/em&gt;.  Chaque thread effectuera&#xA;un &lt;em&gt;snapshot distant&lt;/em&gt;, exportant les donnÃ©es sur le &lt;em&gt;serveur repository&lt;/em&gt; en&#xA;utilisant les nouvelles &lt;em&gt;fonctions sources&lt;/em&gt;.  Chaque thread ouvrira et fermera&#xA;une connexion sur le &lt;em&gt;serveur repository&lt;/em&gt; lors de lâ€™exÃ©cution du &lt;em&gt;snapshot&#xA;distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, ce daemon a besoin de pouvoir se connecter sur tous les&#xA;&lt;em&gt;serveurs distants&lt;/em&gt; dÃ©clarÃ©s ainsi que le &lt;em&gt;serveur repository&lt;/em&gt;.  La table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;, qui stocke la liste des &lt;em&gt;serveurs distants&lt;/em&gt;, a un champ pour&#xA;stocker les nom dâ€™utilisateur et mot de passe pour se connecter aux &lt;em&gt;serveur&#xA;distants&lt;/em&gt;.  Stocker un mot de passe en clair dans cette table est une hÃ©rÃ©sie,&#xA;si lâ€™on considÃ¨re lâ€™aspect sÃ©curitÃ©.  Ainsi, comme indiquÃ© dans la&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section sÃ©curitÃ© de&#xA;PoWA&lt;/a&gt;,&#xA;vous pouve stocker un mot de passe NULL et &lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;utiliser Ã  la place nâ€™importe&#xA;laquelle des autres mÃ©thodes dâ€™authentification supportÃ©es par la&#xA;libpq&lt;/a&gt; (fichier&#xA;.pgpass, certificatâ€¦).  Câ€™est trÃ¨s fortement recommandÃ© pour toute&#xA;installation sÃ©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La connexion persistente sur le &lt;em&gt;serveur repository&lt;/em&gt; est utilisÃ©e pour&#xA;superviser la daemon :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;pour vÃ©rifier  que le daemon est bien dÃ©marrÃ©&lt;/li&gt;&#xA;  &lt;li&gt;pour communiquer au travers de lâ€™UI en utilisant un &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/protocol.html&#34;&gt;protocole simple&lt;/a&gt;&#xA;afin dâ€™effectuer des actions diverses (recharger la configuration, vÃ©rifier&#xA;le status dâ€™un thread dÃ©diÃ© Ã  un &lt;em&gt;serveur distant&lt;/em&gt;â€¦)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Il est Ã  noter que vous pouvez Ã©galement demander au daemon de recharger sa&#xA;configuration en envoyant un SIGHUP au processus du daemon.  Un rechargement&#xA;est nÃ©cessaire pour toute modification effectuÃ©e sur la liste des serveurs&#xA;distants (ajout ou suppression dâ€™un &lt;em&gt;serveur distant&lt;/em&gt;, ou mise Ã  jour dâ€™un&#xA;existant).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez Ã©galement noter que, par choix,&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&lt;/a&gt;&#xA;nâ€™effectuera pas de &lt;em&gt;snapshot local&lt;/em&gt;.  Si vous voulez utiliser PoWA pour le&#xA;&lt;em&gt;serveur repository&lt;/em&gt;, il vous faudra activer le &lt;em&gt;background worker&lt;/em&gt; original.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouvelle-page-de-configuration&#34;&gt;Nouvelle page de configuration&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;La page de configuration est maintenant modifiÃ©e pour donner toutes les&#xA;informations nÃ©cessaires sur le status du background worker, le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&#xA;daemon&lt;/a&gt;&#xA;(incluant tous ses threads dÃ©diÃ©s) ainsi que la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;dÃ©clarÃ©s.  Voici un exemple de cette nouvelle page racine de configuration :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_configuration_page.png&#34;&gt;&lt;img src=&#34;/images/powa_4_configuration_page.png&#34; alt=&#34;Nouvelle page de&#xA;configuration&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;est utilisÃ©, le status de chaque serveur distant sera rÃ©cupÃ©rÃ© en utilisant le&#xA;protocole de communication.  Si le collecteur rencontre des erreurs (lors de la&#xA;connexion Ã  un &lt;em&gt;serveur distant&lt;/em&gt;, durant un &lt;em&gt;snapshot&lt;/em&gt; par exemple), celles-ci&#xA;seront Ã©galement affichÃ©es ici.  Ã€ noter Ã©galement que ces erreurs seront&#xA;Ã©galement affichÃ©es en haut de chaque page de toutes les pages de lâ€™UI, afin&#xA;dâ€™Ãªtre sÃ»r de ne pas les rater.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;De plus, la section configuration a maintenant une hiÃ©rarchie, et vous pourrez&#xA;voir la liste des extensions ainsi que la configuration actuelle de PostgreSQL&#xA;pour le serveur &lt;strong&gt;local&lt;/strong&gt; ou &lt;strong&gt;distant&lt;/strong&gt; en cliquant sur le serveur de votre&#xA;choix!&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y a Ã©galement un nouveau bouton &lt;strong&gt;Reload collector&lt;/strong&gt; sur le bandeau&#xA;dâ€™en-tÃªte qui, comme on pourrait sâ€™y attendre, demandera au collecteur de&#xA;recharger sa configuration.  Cela peut Ãªtre utile si vous avez dÃ©clarÃ©s de&#xA;nouveaux serveurs mais nâ€™ave pas dâ€™accÃ¨s au serveur sur lequel le collecteur&#xA;sâ€™exÃ©cute.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette article est le dernier de la sÃ©urie concernant la nouvelle version de&#xA;PoWA.  Il est toujours en beta, nâ€™hÃ©sitez donc pas Ã  le tester, &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;rapporter&#xA;tout bug rencontrÃ©&lt;/a&gt;&#xA;ou donner tout autre retour!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html&#34;&gt;PoWA 4: Nouveau daemon powa-collector&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on December 10, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: nouveautÃ©s dans powa-archivist !</title>
    <updated>2019-06-05T14:26:17Z</updated>
    <id>tag:rjuju.github.io,2019-06-05:/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie dâ€™une sÃ©rie dâ€™article sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et dÃ©crit les changements prÃ©sents dans&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/index.html&#34;&gt;powa-archivist&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus dâ€™information sur cette version 4, vous pouvez consulter &lt;a href=&#34;/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;lâ€™article&#xA;de prÃ©sentation gÃ©nÃ©ral&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;aperÃ§u-rapide&#34;&gt;AperÃ§u rapide&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Tout dâ€™abord, il faut savoir quâ€™il nâ€™y a pas dâ€™upgrade possible depuis la v3&#xA;vers la v4, il est donc nÃ©cessaire dâ€™effectuer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DROP EXTENSION powa&lt;/code&gt; si vous&#xA;utilisiez dÃ©jÃ  PoWA sur vos serveurs.  Cela est du au fait que la v4 apporte&#xA;&lt;strong&gt;de trÃ¨s nombreux&lt;/strong&gt; changements dans la partie SQL de lâ€™extension, ce qui en&#xA;fait le changement le plus significatif dans la suite PoWA pour cette nouvelle&#xA;version.  Au moment oÃ¹ jâ€™Ã©cris cet article, la quantitÃ© de changements apportÃ©s&#xA;dans cette extension est :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt; CHANGELOG.md       |   14 +&#xA; powa--4.0.0dev.sql | 2075 +++++++++++++++++++++-------&#xA; powa.c             |   44 +-&#xA; 3 files changed, 1629 insertions(+), 504 deletions(-)&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Lâ€™absence dâ€™upgrade ne devrait pas Ãªtre un problÃ¨me en pratique.  PoWA est un&#xA;outil pour analyser les performances, il est fait pour avoir des donnÃ©es avec&#xA;une grande prÃ©cision mais un historique trÃ¨s limitÃ©.  Si vous cherchez une&#xA;solution de supervision gÃ©nÃ©raliste pour conserver des mois de donnÃ©es, PoWA&#xA;nâ€™est dÃ©finitivement pas lâ€™outil quâ€™il vous faut.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;configurer-la-liste-des-serveurs-distants&#34;&gt;Configurer la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;En ce qui concerne les changements Ã  proprement parler, le premier petit&#xA;changement est que le &lt;a href=&#34;https://www.postgresql.org/docs/current/bgworker.html&#34;&gt;background&#xA;worker&lt;/a&gt; nâ€™est plus&#xA;nÃ©cessaire pour le fonctionnement de powa-archivist, car il nâ€™est pas utilisÃ©&#xA;pour le mode distant.  Cela signifie quâ€™un redÃ©marrage de PostgreSQL nâ€™est plus&#xA;nÃ©cessaire pour installer PoWA.  Bien Ã©videmment, un redÃ©marrage est toujours&#xA;nÃ©cessaire si vous souhaitez utiliser le mode local, en utilisant le background&#xA;worker, or si vous voulez installer des extensions additionelles qui&#xA;nÃ©cessitent elles-mÃªme un redÃ©marrage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, comme PoWA requiert un peu de configuration (frÃ©quence des snapshot,&#xA;rÃ©tention des donnÃ©es et ainsi de suite), certaines nouvelles tables sont&#xA;ajouter pour permettre de configurer tout Ã§a.  La nouvelle table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;&#xA;stocke la configuration de toutes les instances distantes dont les donnÃ©es&#xA;doivent Ãªtre stockÃ©es sur cette instance.  Cette &lt;em&gt;instance PoWA locale&lt;/em&gt; est&#xA;appelÃ©e un &lt;strong&gt;serveur repository&lt;/strong&gt; (qui devrait typiquement Ãªtre dÃ©diÃ©e Ã &#xA;stocker des donnÃ©es PoWA), en opposition aux &lt;strong&gt;instances distantes&lt;/strong&gt; qui sont&#xA;les instances que vous voulez monitorer.  Le contenu de cette table est tout ce&#xA;quâ€™il y a de plus simple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_servers&lt;/span&gt;&#xA;                              &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_servers&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                 &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------+----------+-----------+----------+------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;            &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nextval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;powa_servers_id_seq&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regclass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;hostname&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;alias&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;dbname&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;frequency&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;powa_coalesce&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;retention&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;1 day&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Si vous avez dÃ©jÃ  utilisÃ© PoWA, vous devriez reconnaÃ®tre la plupart des options&#xA;de configuration qui sont maintenant stockÃ©es ici.  Les nouvelles options sont&#xA;utilisÃ©es pour dÃ©crire comment se connecter aux &lt;em&gt;instances distances&lt;/em&gt;, et&#xA;peuvent fournir un alias Ã  afficher sur lâ€™UI.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous avez Ã©galement probablement remarquÃ© une colonne &lt;strong&gt;password&lt;/strong&gt;.  Stocker un&#xA;mot de passe en clair dans cette table est une hÃ©rÃ©sie pour nâ€™importe qui&#xA;dÃ©sirant un minimum de sÃ©curitÃ©.  Ainsi, comme mentionnÃ© dans la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section&#xA;sÃ©curitÃ© de la documentation de PoWA&#xA;&lt;/a&gt;,&#xA;vous pouvez stocker NULL pour le champ password et Ã  la place utiliser&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;nâ€™importe laquelle des autres mÃ©thodes dâ€™authentification supportÃ©e par la&#xA;libpq&lt;/a&gt;&#xA;(fichier .pgpass, certificatâ€¦).  Une authentification plus sÃ©curisÃ©e est&#xA;chaudement recommandÃ©e pour toute installation sÃ©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une autre table, la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_snapshot_metas&lt;/code&gt;, est Ã©galement ajoutÃ©e pour&#xA;stocker quelques mÃ©tadonnÃ©es concernant les informations de snapshot pour&#xA;chaque &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;                                   &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_snapshot_metas&#34;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;--------------+--------------------------+-----------+----------+---------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;                  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;coalesce_seq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;snapts&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;aggts&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;purgets&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;errors&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Il sâ€™agit tout simplement dâ€™un compteur pour compter le nombre de snapshots&#xA;effectuÃ©s, un timestamp pour chaque type dâ€™Ã©vÃ©nement survenu (snapshot,&#xA;aggrÃ©gation et purge) et un tableau de chaÃ®ne de caractÃ¨res pour stocker toute&#xA;erreur survenant durant le snapshot, afin que lâ€™UI pour lâ€™afficher.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;api-sql-pour-configurer-les-serveurs-distants&#34;&gt;API SQL pour configurer les &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien que ces tables soient trÃ¨s simples, une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html#configure-powa-and-stats-extensions-on-each-remote-server&#34;&gt;API SQL basique est disponible&#xA;pour dÃ©clarer de nouveaux serveurs et les&#xA;configurer&lt;/a&gt;.&#xA;6 fonctions de bases sont disponibles :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_register_server()&lt;/code&gt;, pour dÃ©clarer un nouveau &lt;em&gt;servuer distant&lt;/em&gt;, ainsi&#xA;que la liste des extensions qui y sont disponibles&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_configure_server()&lt;/code&gt; pour mettre Ã  jour un des paramÃ¨tres pour le&#xA;&lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ© (en utilisant un paramÃ¨tre JSON, oÃ¹ la clÃ© est&#xA;le nom du paramÃ¨tre Ã  changer et la valeur la nouvelle valeur Ã  utiliser)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_server()&lt;/code&gt; pour dÃ©sactiver les snapshots pour le &lt;em&gt;serveur&#xA;distant&lt;/em&gt; spÃ©cifiquÃ© (ce qui concrÃ¨tement positionnera le paramÃ¨tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;frequency&lt;/code&gt; Ã  &lt;strong&gt;-1&lt;/strong&gt;)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_delete_and_purge_server()&lt;/code&gt; pour supprimer le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;spÃ©cifiÃ© de la liste des serveurs et supprimer toutes les donnÃ©es associÃ©es&#xA;aux snapshots&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_activate_extension()&lt;/code&gt;, pour dÃ©clarer quâ€™une nouvelle extension est&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ©&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_extension()&lt;/code&gt;, pour spÃ©cifier quâ€™une extension nâ€™est plus&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Toute action plus compliquÃ©e que Ã§a devra Ãªtre effectuÃ©e en utilisant des&#xA;requÃªtes SQL.  Heureusement, il ne devrait pas y avoir beaucoup dâ€™autres&#xA;besoins, et les tables sont vraiment trÃ¨s simple donc cela ne devrait pas poser&#xA;de soucis.  &lt;a href=&#34;https://github.com/powa-team/powa-archivist/issues&#34;&gt;Nâ€™hÃ©sitez cependant pas Ã  demander de nouvelles&#xA;fonctions&lt;/a&gt; si vous aviez&#xA;dâ€™autres besoins.  Veuillez Ã©galement noter que lâ€™UI ne vous permet pas&#xA;dâ€™appeler ces fonctions, puisque celle-ci est pour le moment &lt;strong&gt;entiÃ¨rement en&#xA;lecture seule&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;effectuer-des-snapshots-distants&#34;&gt;Effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Puisque les mÃ©triques sont maintenant stockÃ©es sur une instance PostgreSQL&#xA;diffÃ©rente, nous avons Ã©normÃ©ment changÃ© la faÃ§on dont les &lt;em&gt;snapshots&lt;/em&gt;&#xA;(rÃ©cupÃ©rer les donnÃ©es fournies par une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extensions&#xA;statistique&lt;/a&gt;&#xA;et les stockÃ©es dans le catalogue PoWA &lt;a href=&#34;/postgresqlfr/2019/04/06/minimiser-le-surcout-de-stockage-par-ligne.html&#34;&gt;de maniÃ¨re Ã  optimiser le stockage&lt;/a&gt;) sont&#xA;effectuÃ©s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La liste de toutes les extensions statistiques, ou &lt;em&gt;sources de donnÃ©es&lt;/em&gt;, qui&#xA;sont disponibles sur un &lt;strong&gt;serveur&lt;/strong&gt; (soit &lt;em&gt;distant&lt;/em&gt; soit &lt;em&gt;local&lt;/em&gt;) et pour&#xA;lesquelles un &lt;em&gt;snapshot&lt;/em&gt; devrait Ãªtre effectuÃ© est stockÃ©e dans une table&#xA;appelÃ©e &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_functions&lt;/code&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;               &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_functions&#34;&lt;/span&gt;&#xA;     &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;----------------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;operation&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;query_source&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;added_manually&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;enabled&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;priority&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Un nouveau champ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;query_source&lt;/code&gt; a Ã©tÃ© rajoutÃ©.  Celui-ci fournit le nom de la&#xA;&lt;em&gt;fonction source&lt;/em&gt;, nÃ©cessaire pour la compatibilitÃ© dâ€™une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extension&#xA;statistique&lt;/a&gt;&#xA;avec les snapshots distants.  Cette fonction est utilisÃ©e pour exporter les&#xA;compteurs fournis par cette extension sur un serveur diffÃ©rent, dans une &lt;em&gt;table&#xA;transitoire&lt;/em&gt; dÃ©diÃ©e.  La fonction de &lt;em&gt;snapshot&lt;/em&gt; effectuera alors le &lt;em&gt;snapshot&lt;/em&gt;&#xA;en utilisant automatiquement ces donnÃ©es exportÃ©es plutÃ´t que celles fournies&#xA;par lâ€™extension statististique locale quand le mode distant est utilisÃ©.  Il&#xA;est Ã  noter que lâ€™export de ces compteurs ainsi que le snapshot distant est&#xA;effectuÃ© automatiquement par le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;que je prÃ©senterai dans un autre article.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple montant comment PoWA effectue un &lt;em&gt;snapshot distant&lt;/em&gt; dâ€™une&#xA;liste de base donnÃ©es.  Comme vous allez le voir, câ€™est trÃ¨s simple ce qui&#xA;signifie quâ€™il est Ã©galement trÃ¨s simple dâ€™ajouter cette mÃªme compatibilitÃ©&#xA;pour une nouvelle extension statistique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;table transitoire&lt;/em&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;   &lt;span class=&#34;n&#34;&gt;Unlogged&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_databases_src_tmp&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Pour de meilleurs performances, toutes les &lt;em&gt;tables transitoires&lt;/em&gt; sont &lt;strong&gt;non&#xA;journalisÃ©es (unlogged)&lt;/strong&gt;, puisque leur contenu nâ€™est nÃ©cessaire que durant un&#xA;&lt;em&gt;snapshot&lt;/em&gt; et sont supprimÃ©es juste aprÃ¨s.  Dans cet examlple, la &lt;em&gt;table&#xA;transitoire&lt;/em&gt; ne stocke que lâ€™identifiant du serveur distant correspondant Ã  ces&#xA;donnÃ©es, lâ€™oid ainsi que le nom de chacune des bases de donnÃ©es prÃ©sentes sur&#xA;le &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Et la &lt;em&gt;fonction source&lt;/em&gt; :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powa_databases_src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SETOF&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_database&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;ELSE&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_databases_src_tmp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Cette fonction retourne simplement le contenu de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; si les donnÃ©es&#xA;locales sont demandÃ©es (lâ€™identifiant de serveur &lt;strong&gt;0&lt;/strong&gt; est toujours le serveur&#xA;local), ou alors le contenu de la &lt;em&gt;table transitoire&lt;/em&gt; pour le serveur distant&#xA;spÃ©cifiÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;fonction de snapshot&lt;/em&gt; peut alors facilement effectuer nâ€™importe quel&#xA;traitement avec ces donnÃ©es pour le &lt;em&gt;serveur distant&lt;/em&gt; voulu.  Dans le cas de la&#xA;fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_databases_snapshot()&lt;/code&gt;, il sâ€™agit simplement de synchroniser la&#xA;liste des bases de donnÃ©es, et de stocker le timestamp de suppression si une&#xA;base de donnÃ©es qui existait prÃ©cÃ©demment nâ€™est plus listÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus de dÃ©tails, vous pouvez consulter la documentation concernant&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/development.html&#34;&gt;lâ€™ajout dâ€™une source de donnÃ©es dans&#xA;PoWA&lt;/a&gt;,&#xA;qui a Ã©tÃ© mise Ã  jour pour les spÃ©cificitÃ©s de la version 4.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html&#34;&gt;PoWA 4: nouveautÃ©s dans powa-archivist !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on June 05, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4 apporte un mode remote, disponible en beta !</title>
    <updated>2019-05-17T11:04:17Z</updated>
    <id>tag:rjuju.github.io,2019-05-17:/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html</id>
    <content type="html">&lt;p&gt;&lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;PoWA 4&lt;/a&gt; est disponible en beta.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-mode-remote-&#34;&gt;Nouveau mode remote !&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau mode remote&lt;/a&gt;&#xA;est la plus grosse fonctionnalitÃ© ajoutÃ©e dans PoWA 4, bien quâ€™il y ait eu&#xA;dâ€™autres amÃ©liorations.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Je vais dÃ©crire ici ce que ce nouveau mode implique ainsi que ce qui a changÃ©&#xA;sur lâ€™&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;UI&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si de plus amples dÃ©tails sur le reste des changements apportÃ©s dans PoWA 4&#xA;vous intÃ©resse, je publierai bientÃ´t dâ€™autres articles sur le sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour les plus pressÃ©s, nâ€™hÃ©sitez pas Ã  aller directement sur la &lt;a href=&#34;https://dev-powa.anayrat.info/&#34;&gt;dÃ©mo v4 de&#xA;PoWA&lt;/a&gt;, trÃ¨s gentiment hÃ©bergÃ©e par &lt;a href=&#34;http://blog.anayrat.info/&#34;&gt;Adrien&#xA;Nayrat&lt;/a&gt;.  Aucun authentification nâ€™est requise,&#xA;cliquez simplement sur â€œLoginâ€.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;pourquoi-un-mode-remote-est-il-important&#34;&gt;Pourquoi un mode remote est-il important&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette fonctionnalitÃ© a probablement Ã©tÃ© la plus frÃ©quemment demandÃ©e depuis que&#xA;PoWA a Ã©tÃ© publiÃ©, en 2014.  Et câ€™est pour de bonnes raisons, car un mode local&#xA;a quelques inconvÃ©nients.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Tout dâ€™abord, voyons comment se prÃ©sentait lâ€™architecture avec les versions 3&#xA;et antÃ©rieures.  Imaginons une instance contenant 2 bases de donnÃ©es (db1 et&#xA;db2), ainsi quâ€™&lt;strong&gt;une base de donnÃ©es dÃ©diÃ©e Ã  PoWA&lt;/strong&gt;.  Cette base de donnÃ©es&#xA;dÃ©diÃ©e contient Ã  la fois les &lt;em&gt;extensions statistiques&lt;/em&gt; nÃ©cessaires pour&#xA;rÃ©cupÃ©rer compteurs de performances actuels ainsi que pour &lt;strong&gt;les stocker&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_local.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_local.svg&#34; alt=&#34;Architecture en mode local&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est dÃ©marrÃ© par PoWA, qui est responsable dâ€™effectuer des &lt;em&gt;snapshots&lt;/em&gt; et de les&#xA;stocker dans la base powa dÃ©diÃ©e Ã  intervalle rÃ©guliers.  Ensuite, en utilisant&#xA;powa-web, vous pouvez consulter lâ€™activitÃ© de nâ€™importe laquelle des bases de&#xA;donnÃ©es &lt;strong&gt;locales&lt;/strong&gt; en effectuant des requÃªtes sur les donnÃ©es stockÃ©es dans la&#xA;base dÃ©diÃ©, et potentiellement en se connectant sur lâ€™une des autres bases de&#xA;donnÃ©es locales lorsque les donnÃ©es complÃ¨tes sont nÃ©cessaires, par exemple&#xA;lorsque lâ€™outil de suggestion dâ€™index est utilisÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec la version 4, lâ€™architecture avec une configuration distante change de&#xA;maniÃ¨re significative:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous pouvez voir quâ€™une base de donnÃ©e powa dÃ©diÃ©e est toujours nÃ©cessaire,&#xA;mais &lt;strong&gt;uniquement pour les extensions statistiques&lt;/strong&gt;.  Les donnÃ©es sont&#xA;maintenant stockÃ©es sur une instance diffÃ©rente.  Ensuite, le &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est remplacÃ© par un &lt;strong&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;nouveau daemon&#xA;collecteur&lt;/a&gt;&lt;/strong&gt;,&#xA;qui lit les mÃ©triques de performance depuis les &lt;em&gt;serveurs distants&lt;/em&gt;, et les&#xA;stocke sur le &lt;em&gt;serveur repository&lt;/em&gt; dÃ©diÃ©.  Powa-web pourra prÃ©senter les&#xA;donnÃ©es en se connectant sur le &lt;em&gt;serveur repository&lt;/em&gt;, ainsi que sur les&#xA;&lt;strong&gt;serveurs distants&lt;/strong&gt; lorsque des donnÃ©es complÃ¨tes sont nÃ©cessaires.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En rÃ©sumÃ©, avec le nouveau mode distant ajoutÃ© dans cette version 4&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;un redÃ©marrage de PostgreSQL nâ€™est plus nÃ©cessaire pour installer&#xA;powa-archivist&lt;/li&gt;&#xA;  &lt;li&gt;il nâ€™y a plus de surcoÃ»t du au fait de stocker et requÃªter les donnÃ©es sur&#xA;le mÃªme serveur PostgreSQL que vos serveurs de productions (il y a toujours&#xA;certaines partie de lâ€™UI qui nÃ©cessitent dâ€™effectuer des requÃªtes sur le&#xA;serveur dâ€™origine, par exemple pour montrer des plans avec EXPLAIN, mais le&#xA;surcoÃ»t est nÃ©gligeable)&lt;/li&gt;&#xA;  &lt;li&gt;il est maintenant possible dâ€™utiliser PoWA sur un &lt;strong&gt;serveur en&#xA;hot-standby&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Lâ€™UI vous accueillera donc maintenant avec une page initiale afin de choisir&#xA;lequel des serveurs stockÃ©s sur la base de donnÃ©es cible vous voulez&#xA;travailler :&#xA;&lt;a href=&#34;/images/powa_4_all_servers.png&#34;&gt;&lt;img src=&#34;/images/powa_4_all_servers.png&#34; alt=&#34;Choix des serveurs&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La principale raison pour laquelle il a fallu tellement de temps pour apporter&#xA;ce mode distant est parce que cela apporte beaucoup de complexitÃ©, nÃ©cessitant&#xA;une rÃ©Ã©criture majeure de PoWA.  Nous voulions Ã©galement ajouter dâ€™abord&#xA;dâ€™autres fonctionnalitÃ©s, comme la &lt;strong&gt;suggestion globale dâ€™index&lt;/strong&gt;, avec une&#xA;&lt;strong&gt;validation grÃ¢ce Ã  &lt;a href=&#34;http://hypopg.readthedocs.io/&#34;&gt;hypopg&lt;/a&gt;&lt;/strong&gt; introduit avec&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/releases/v3.0.0.html&#34;&gt;PoWA 3&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;changements-dans-powa-web&#34;&gt;Changements dans &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;powa-web&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Lâ€™&lt;em&gt;interface graphique&lt;/em&gt; est le composant qui a le plus de changements visibles&#xA;dans cette version 4.  Voici les plus changements les plus importants.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;compatibilitÃ©-avec-le-mode-distant&#34;&gt;CompatibilitÃ© avec le mode distant&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Le changement le plus important est bien Ã©videmment le support pour le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau&#xA;mode remote&lt;/a&gt;.  En&#xA;consÃ©quence, la premiÃ¨re page affichÃ©e est maintenant une page de &lt;strong&gt;sÃ©lection&#xA;de serveur&lt;/strong&gt;, affichant tous les &lt;em&gt;serveurs distants&lt;/em&gt; enregistrÃ©s.  AprÃ¨s avoir&#xA;choisi le &lt;em&gt;serveur distant&lt;/em&gt; voulu (ou le &lt;em&gt;serveur local&lt;/em&gt; si vous nâ€™utilisez pas&#xA;le mode distant), toutes les autres pages seront similaires Ã  celles&#xA;disponibles jusquâ€™Ã  la version 3, mais afficheront les donnÃ©es pour un &lt;em&gt;serveur&#xA;distant&lt;/em&gt; spÃ©cifique uniquement, et bien entendu en rÃ©cupÃ©rant les donnÃ©es&#xA;depuis la &lt;strong&gt;base de donnÃ©es repository&lt;/strong&gt;, avec en plus de nouvelles&#xA;informations dÃ©crites ci-dessous.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez notez que puisque les donnÃ©es sont maintenant stockÃ©es sur un &lt;em&gt;serveur&#xA;repository&lt;/em&gt; dÃ©diÃ© quand le mode remote est utilisÃ©, la majoritÃ© de lâ€™UI est&#xA;utilisable sans se connecter au &lt;em&gt;serveur distant&lt;/em&gt; sÃ©lectionnÃ©.  Toutefois,&#xA;powa-web nÃ©cessite toujours de pouvoir se connecter sur le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;quand les donnÃ©es originales sont nÃ©cessaires (par exemple, pour la suggestion&#xA;dâ€™index ou pour montrer des plans avec &lt;strong&gt;EXPLAIN&lt;/strong&gt;).  Les &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;mÃªmes considÃ©rations&#xA;et possibilitÃ©s concernant&#xA;lâ€™authentification&lt;/a&gt;&#xA;que pour le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&#xA;&lt;/a&gt;&#xA;(qui sera dÃ©crit dans un prochain article) sâ€™appliquent ici.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;pg_track_settings-support&#34;&gt;&lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt; support&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand cette extension est correctement configurÃ©e, un nouveau widget timeline&#xA;apparaÃ®tra, placÃ© entre chaque graph et son aperÃ§u, affichant diffÃ©rents types&#xA;de changements enregistrÃ©s si ceux-ci ont Ã©tÃ© dÃ©tectÃ©s sur lâ€™intervalle de&#xA;temps sÃ©lectionnÃ©.  Sur les pages par base de donnÃ©es et par requÃªte, la liste&#xA;sera Ã©galement filtrÃ©e en fonction de la base de donnÃ©es sÃ©lectionnÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La mÃªme timeline sera affichÃ©e sur chacun des graphs de chacune des pages, afin&#xA;de facilement vÃ©rifier si ces changements ont eu un impact visible en utilisant&#xA;les diffÃ©rents graphs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez noter que les dÃ©tails des changements sont affichÃ©s au survol de la&#xA;souris.  Vous pouvez Ã©galement cliquer sur nâ€™importe lequel des Ã©vÃ©nements de&#xA;la timeline pour figer lâ€™affichage, et tracer une ligne verticale sur le graph&#xA;associÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple dâ€™un tel changement de configuration en action :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_track_settings_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_track_settings_powa4.png&#34; alt=&#34;Changements de configuration dÃ©tectÃ©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez Ã©galement noter quâ€™il est nÃ©cessaire dâ€™avoir au minimum la version&#xA;2.0.0 de &lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt;, et&#xA;que lâ€™extension doit Ãªtre installÃ©e &lt;strong&gt;Ã  la fois sur les &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;ainsi que sur le &lt;em&gt;serveur repository&lt;/em&gt;.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouveaux-graphs-disponibles&#34;&gt;Nouveaux graphs disponibles&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_stat_kcache.html&#34;&gt;pg_stat_kcache&lt;/a&gt;&#xA;est configurÃ©, ses informations nâ€™Ã©taient auparavant affichÃ©es que sur la page&#xA;par requÃªte.  Les informations sont maintenant Ã©galement affichÃ©es sur les&#xA;pages par serveur et par base, dans deux nouveaux graphs :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;dans le graph &lt;strong&gt;Block Access&lt;/strong&gt;, oÃ¹ les mÃ©triques &lt;strong&gt;OS cache&lt;/strong&gt; et &lt;strong&gt;disk&#xA;read&lt;/strong&gt; remplaceront la mÃ©trique &lt;strong&gt;read&lt;/strong&gt;&lt;/li&gt;&#xA;  &lt;li&gt;dans un nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; (qui est Ã©galement ajoutÃ© dans&#xA;la page &lt;em&gt;par requÃªte&lt;/em&gt;), montrant les &lt;a href=&#34;/postgresql/2018/07/17/pg_stat_kcache-2-1-is-out.html&#34;&gt;metrics ajoutÃ©es dans pg_stat_kcache&#xA;2.1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un example de ce nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34; alt=&#34;Ressources systÃ¨me&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y avait Ã©galement un graph &lt;strong&gt;Wait Events&lt;/strong&gt; (disponible quand &lt;a href=&#34;https://powa.readthedocs.io/en/v4/components/stats_extensions/pg_wait_sampling.html&#34;&gt;lâ€™extension&#xA;pg_wait_sampling&lt;/a&gt;&#xA;est configuÃ©e) disponible uniquement sur la page par requÃªte.  Ce graph est&#xA;maintenant disponible sur les pages par serveur et par base Ã©galement.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;documentation-des-mÃ©triques-et-liens-vers-la-documentation&#34;&gt;Documentation des mÃ©triques et liens vers la documentation&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certaines mÃ©triques affichÃ©es sur lâ€™interface sont assez parlante, mais&#xA;certaines autres peuvent Ãªtre un peu obscures.  Jusquâ€™Ã  maintenant, il nâ€™y&#xA;avait malheureusement aucune documentation pour les mÃ©triques.  Le problÃ¨me est&#xA;maintenant rÃ©glÃ©, et tous les graphs ont une &lt;em&gt;icÃ´ne dâ€™information&lt;/em&gt;, qui&#xA;affichent une description des mÃ©triques utilisÃ©e dans le graph au survol de la&#xA;souris.  Certains graphs incluent Ã©galement un lien vers la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;documentation PoWA&#xA;de extension&#xA;statistiques&lt;/a&gt;&#xA;pour les utilisateurs qui dÃ©sirent en apprendre plus Ã  leur sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_metrics_doc.png&#34;&gt;&lt;img src=&#34;/images/powa_4_metrics_doc.png&#34; alt=&#34;Documentation des mÃ©triques&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;et-des-correctifs-de-bugs-divers&#34;&gt;Et des correctifs de bugs divers&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certains problÃ¨mes de longues dates ont Ã©galement Ã©tÃ© rapportÃ©s :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;la boÃ®te affichÃ©e au survol dâ€™un graph montant les valeurs des mÃ©triques&#xA;avait une position verticale incorrecte&lt;/li&gt;&#xA;  &lt;li&gt;la sÃ©lection temporelle en utilisant lâ€™aperÃ§u des graphs ne montrait pas un&#xA;aperÃ§u correct aprÃ¨s avoir appliquÃ© la sÃ©lection&lt;/li&gt;&#xA;  &lt;li&gt;les erreurs lors de la crÃ©ation dâ€™index hypothÃ©tiques ou dans certains cas&#xA;leur affichage nâ€™Ã©tait pas correctement gÃ©rÃ©s sur plusieurs pages&lt;/li&gt;&#xA;  &lt;li&gt;les filtres des tableaux nâ€™Ã©tait pas rÃ©appliquÃ©s quand lâ€™intervalle de&#xA;temps sÃ©lectionnÃ© Ã©tait changÃ©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Si un de ces problÃ¨mes vous a un jour posÃ© problÃ¨me, vous serez ravi&#xA;dâ€™apprendre quâ€™ils sont maintenant tous corrigÃ©s !&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette 4Ã¨me version de PoWA reprÃ©sente un temps de dÃ©veloppement trÃ¨s important,&#xA;de nombreuses amÃ©liorations sur la documentation et beaucoup de tests.  Nous&#xA;somme maintenant assez satisfaits, mais il est possible que nous ayons ratÃ©s&#xA;certains bugs.  Si vous vous intÃ©ressez Ã  ce projet, jâ€™espÃ¨re que vous&#xA;essaierez de tester cette beta, et si besoin nâ€™hÃ©sitez pas Ã  &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;nous remonter un&#xA;bug&lt;/a&gt;!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;PoWA 4 apporte un mode remote, disponible en beta !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on May 17, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>NouveautÃ© pg12: Statistiques sur les erreurs de checkums</title>
    <updated>2019-04-18T11:02:26Z</updated>
    <id>tag:rjuju.github.io,2019-04-18:/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html</id>
    <content type="html">&lt;h3 id=&#34;data-checksums&#34;&gt;Data checksums&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;AjoutÃ©s dans &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=96ef3b8ff1c&#34;&gt;PostgreSQL&#xA;9.3&lt;/a&gt;,&#xA;les &lt;a href=&#34;https://www.postgresql.org/docs/current/app-initdb.html#APP-INITDB-DATA-CHECKSUMS&#34;&gt;data&#xA;checksums&lt;/a&gt;&#xA;peuvent aider Ã  dÃ©tecter les corruptions de donnÃ©es survenant sur votre&#xA;stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les checksums sont activÃ©s si lâ€™instance a Ã©tÃ© initialisÃ©e en utilisant &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&#xA;--data-checksums&lt;/code&gt; (ce qui nâ€™est pas le comportement par dÃ©faut), ou sâ€™ils ont&#xA;Ã©tÃ© activÃ©s aprÃ¨s en utilisant la nouvelle utilitaire&#xA;activated afterwards with the new&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/devel/app-pgchecksums.html&#34;&gt;pg_checksums&lt;/a&gt;&#xA;Ã©galement &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=ed308d783790&#34;&gt;ajoutÃ© dans PostgreSQL&#xA;12&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Quand les checksums sont ativÃ©s, ceux-ci sont Ã©crits Ã  chaque fois quâ€™un bloc&#xA;de donnÃ©es est Ã©crit sur disque, et vÃ©rifiÃ©s Ã  chaque fois quâ€™un bloc est lu&#xA;depuis le disque (ou depuis le cache du systÃ¨me dâ€™exploitation).  Si la&#xA;vÃ©rification Ã©choue, une erreur est remontÃ©e dans les logs.  Si le bloc Ã©tait&#xA;lu par un processus client, la requÃªte associÃ©e Ã©chouera bien Ã©videmment, mais&#xA;si le bloc Ã©tait lu par une opÃ©ration&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;&#xA;(tel que pg_basebackup), la commande continuera Ã  sâ€™exÃ©cuter.  Bien que les&#xA;data checksums ne dÃ©tecteront quâ€™un sous ensemble des problÃ¨mes possibles, ils&#xA;ont tout de mÃªme une certaine utilisÃ©, surtout si vous ne faites pas confiance&#xA;Ã  votre stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Jusquâ€™Ã  PostgreSQL 11, les erreurs de validation de checksum ne pouvaient Ãªtre&#xA;trouvÃ©es quâ€™en cherchant dans les logs, ce qui nâ€™est clairement pas pratique si&#xA;vous voulez monitorer de telles erreurs.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveaux-compteurs-disponibles-dans-pg_stat_database&#34;&gt;Nouveaux compteurs disponibles dans pg_stat_database&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour rendre la supervision des erreurs de checksum plus simple, et pour aider&#xA;les utilisateurs Ã  rÃ©agir dÃ¨s quâ€™un tel problÃ¨me survient, PostgreSQL 12 ajoute&#xA;de nouveaux compteurs dans la vue &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 6b9e875f7286d8535bff7955e5aa3602e188e436&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Sat Mar 9 10:45:17 2019 -0800&#xA;&#xA;Track block level checksum failures in pg_stat_database&#xA;&#xA;This adds a column that counts how many checksum failures have occurred&#xA;on files belonging to a specific database. Both checksum failures&#xA;during normal backend processing and those created when a base backup&#xA;detects a checksum failure are counted.&#xA;&#xA;Author: Magnus Hagander&#xA;Reviewed by: Julien Rouhaud&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 77bd49adba4711b4497e7e39a5ec3a9812cbd52a&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Fri Apr 12 14:04:50 2019 +0200&#xA;&#xA;    Show shared object statistics in pg_stat_database&#xA;&#xA;    This adds a row to the pg_stat_database view with datoid 0 and datname&#xA;    NULL for those objects that are not in a database. This was added&#xA;    particularly for checksums, but we were already tracking more satistics&#xA;    for these objects, just not returning it.&#xA;&#xA;    Also add a checksum_last_failure column that holds the timestamptz of&#xA;    the last checksum failure that occurred in a database (or in a&#xA;    non-dataabase file), if any.&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 252b707bc41cc9bf6c55c18d8cb302a6176b7e48&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Wed Apr 17 13:51:48 2019 +0200&#xA;&#xA;    Return NULL for checksum failures if checksums are not enabled&#xA;&#xA;    Returning 0 could falsely indicate that there is no problem. NULL&#xA;    correctly indicates that there is no information about potential&#xA;    problems.&#xA;&#xA;    Also return 0 as numbackends instead of NULL for shared objects (as no&#xA;    connection can be made to a shared object only).&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;    Reviewed-by: Robert Treat &amp;lt;rob@xzilla.net&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces compteurs reflÃ¨teront les erreurs de validation de checksum Ã  la fois pour&#xA;les processus clients et pour lâ€™activitÃ©&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;,&#xA;par base de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;rjuju&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_database&lt;/span&gt;&#xA;                        &lt;span class=&#34;k&#34;&gt;View&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;pg_catalog.pg_stat_database&#34;&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------------+--------------------------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datid&lt;/span&gt;                 &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;                      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;                     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_failures&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_last_failure&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;stats_reset&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_failures&lt;/code&gt; montrera un nombre cumulÃ© dâ€™erreurs, et la&#xA;colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_last_failure&lt;/code&gt; montrera lâ€™horodatage de la derniÃ¨re erreur de&#xA;validation sur la base de donnÃ©es (NULL si aucune erreur nâ€™est jamais&#xA;survenue).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour Ã©viter toute confusion (merci Ã  Robert Treat pour lâ€™avoir signalÃ©), ces&#xA;deux colonnes retourneront toujours NULL si les data checkums ne sont pas&#xA;activÃ©s, afin quâ€™on ne puisse pas croire que les checksums sont toujours&#xA;vÃ©rifiÃ©s avec succÃ¨s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme effet de bord, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt;  montrera maintenant Ã©galement les&#xA;statistiques disponibles pour les objets partagÃ©s (tels que la table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; par exemple), dans une nouvelle ligne pour laquelle &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datid&lt;/code&gt; vaut&#xA;&lt;strong&gt;0&lt;/strong&gt;, et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datname&lt;/code&gt; vaut &lt;strong&gt;NULL&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;del&gt;Une sonde dÃ©diÃ©e est Ã©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/issues/226&#34;&gt;dÃ©jÃ &#xA;planifiÃ©e&lt;/a&gt; dans&#xA;&lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/del&gt;&#xA;Une sonde dÃ©diÃ©e est Ã©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/commit/0e8b516e95e4364470d4e205aebc9fe68bbcfd23&#34;&gt;dÃ©jÃ &#xA;disponible&lt;/a&gt;&#xA;dans &lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html&#34;&gt;NouveautÃ© pg12: Statistiques sur les erreurs de checkums&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on April 18, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>Mettre en place une streaming replication avec PostgreSQL 10</title>
    <updated>2018-03-13T06:28:00Z</updated>
    <id>tag:blog.raveland.tech,2018-03-13:/post/postgresql_sr_fr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_sr_fr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Dans ce post, je vais vous expliquer comment mettre en place une &lt;em&gt;streaming replication&lt;/em&gt; avec PostgreSQL 10. Par contre, je n&amp;rsquo;expliquerais pas comment installer PostgreSQL donc je suppose que cela est dÃ©jÃ  le cas.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>OpenBSD / PostgreSQL / Authentification</title>
    <updated>2017-11-29T11:31:53Z</updated>
    <id>tag:blog.raveland.tech,2017-11-29:/post/openbsd_pg/</id>
    <link href="https://blog.raveland.tech/post/openbsd_pg/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Si vous Ãªtes un utilisateur d&amp;rsquo;OpenBSD et de PostgreSQL, vous pouvez utiliser l&amp;rsquo;authentification BSD pour vous authentifier sur vos bases.&#xA;Nous allons voir comment faire cela.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>Postgresql et la rÃ©plication logique</title>
    <updated>2017-11-27T08:32:06Z</updated>
    <id>tag:blog.raveland.tech,2017-11-27:/post/postgresql_lr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_lr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cet article va tester la nouvelle fonctionnalitÃ© disponible depuis PostgreSQL 10.0 : la rÃ©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Pour en savoir plus, l&amp;rsquo;excellente &lt;a href=&#34;https://docs.postgresql.fr/10/logical-replication.html&#34;&gt;documentation de PostgreSQL&lt;/a&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>Utiliser le dÃ©pÃ´t Debian/Ubuntu de PostgreSQL.org</title>
    <updated>2013-04-03T06:05:00Z</updated>
    <id>tag:blog.kryskool.org,2013-04-03:/utiliser-le-depot-debian-ubuntu-de-postgresql-org-fr.html</id>
    <link href="http://blog.kryskool.org/utiliser-le-depot-debian-ubuntu-de-postgresql-org-fr.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le projet PostgreSQL possÃ¨de depuis peu son propre dÃ©pÃ´t APT pour les diffÃ©rentes versions des serveurs encore maintenu et &lt;a class=&#34;reference external&#34; href=&#34;http://pgadmin.org/&#34;&gt;PgAdmin3&lt;/a&gt;, sur les versions de Debian et Ubuntu suivantes&lt;/p&gt;&#xA;&lt;ul class=&#34;simple&#34;&gt;&#xA;&lt;li&gt;Debian&lt;ul&gt;&#xA;&lt;li&gt;Etch&lt;/li&gt;&#xA;&lt;li&gt;Lenny&lt;/li&gt;&#xA;&lt;li&gt;Squeeze&lt;/li&gt;&#xA;&lt;li&gt;Wheezy&lt;/li&gt;&#xA;&lt;li&gt;Sid&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Ubuntu&lt;ul&gt;&#xA;&lt;li&gt;Precise (12.04)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Si vous utilisiez dÃ©jÃ  le dÃ©pÃ´t squeeze backports par exemple, vous pouvez basculer facilement vers ce nouveau dÃ©pÃ´t sans problÃ¨me&lt;/p&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;cle-de-signature-des-paquets&#34;&gt;&#xA;&lt;h2&gt;ClÃ© de signature des paquets&lt;/h2&gt;&#xA;&lt;p&gt;Avant d&#39;installer une version de PostgreSQL, il faut ajouter la clÃ© d&#39;authentification des paquets dans notre trousseau de clÃ©.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;wget -O - http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc | sudo apt-key add -&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;source-list&#34;&gt;&#xA;&lt;h2&gt;source.list&lt;/h2&gt;&#xA;&lt;p&gt;Il faut ensuite ajouter le dÃ©pÃ´t au source.list, pour cela crÃ©er le fichier &lt;tt class=&#34;docutils literal&#34;&gt;/etc/apt/sources.list.d/pgdg.list&lt;/tt&gt;&#xA;et ajouter les lignes suivantes (l&#39;exemple ci-dessous est pour la version squeeze).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;deb http://apt.postgresql.org/pub/repos/apt/ squeeze-pgdg main&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Remplacer &lt;tt class=&#34;docutils literal&#34;&gt;Squeeze&lt;/tt&gt; par le nom de votre distribution.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;preferences&#34;&gt;&#xA;&lt;h2&gt;PrÃ©fÃ©rences&lt;/h2&gt;&#xA;&lt;p&gt;Pour indiquer Ã  votre distribution de prendre et mettre Ã  jour votre ou vos PostgreSQL Ã  partir de cette source,&#xA;il faut rajouter une configuration dite de &lt;tt class=&#34;docutils literal&#34;&gt;pinning&lt;/tt&gt;&lt;/p&gt;&#xA;&lt;p&gt;CrÃ©er le fichier &lt;tt class=&#34;docutils literal&#34;&gt;/etc/apt/preferences.d/pgdg.pref&lt;/tt&gt; et ajouter les lignes suivantes&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;Package: *&#xA;Pin: release o=apt.postgresql.org&#xA;Pin-Priority: 500&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;initialisation&#34;&gt;&#xA;&lt;h2&gt;Initialisation&lt;/h2&gt;&#xA;&lt;p&gt;Une fois la configuration, il faut faire un &lt;tt class=&#34;docutils literal&#34;&gt;update&lt;/tt&gt; pour mettre a jour votre gestionnaire de paquet avec ce nouveau dÃ©pÃ´t, et charger le trousseau de clÃ©&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;apt-get update&#xA;apt-get install pgdg-keyring&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Ensuite il en reste plus qu&#39;a installer la version de PostgreSQL que vous souhaitez.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;apt-get install postgresql-9.2 postgresql-client-9.2 postgresql-contrib-9.2 postgresql-plpython-9.2 postgresql-server-dev-9.2 libpq-dev&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>Christophe Chauvet</name>
    </author>
  </entry>
  <entry>
    <title>Connaitre la taille d&#39;un base de donnÃ©es PostgreSQL</title>
    <updated>2011-12-12T11:30:00Z</updated>
    <id>tag:blog.kryskool.org,2011-12-12:/connaitre-taille-base-postgresql.html</id>
    <link href="http://blog.kryskool.org/connaitre-taille-base-postgresql.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Pour connaitre la taille d&#39;un base de donnÃ©es il faut utiliser la fonction &lt;a class=&#34;reference external&#34; href=&#34;http://docs.postgresql.fr/9.1/functions-admin.html&#34;&gt;pg_database_size&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;production=# select pg_database_size(&amp;#39;production&amp;#39;);&#xA; pg_database_size&#xA;------------------&#xA;        513343780&#xA;(1 ligne)&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Cette taille est donnÃ©e en octets, pour avoir une meilleur reprÃ©sentation en MÃ©ga ou Giga, il faut utiliser la fonction &lt;a class=&#34;reference external&#34; href=&#34;http://docs.postgresql.fr/9.1/functions-admin.html&#34;&gt;pg_size_pretty&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;production=# select pg_size_pretty(pg_database_size(&amp;#39;production&amp;#39;));&#xA; pg_size_pretty&#xA;----------------&#xA; 490 MB&#xA;(1 ligne)&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Ensuite si l&#39;on souhaite connaÃ®tre la taille d&#39;un table il faut utiliser la fonction &lt;a class=&#34;reference external&#34; href=&#34;http://docs.postgresql.fr/9.1/functions-admin.html&#34;&gt;pg_relation_size&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;production=# select pg_size_pretty(pg_relation_size(&amp;#39;res_partner&amp;#39;));&#xA; pg_size_pretty&#xA;----------------&#xA; 152 kB&#xA;(1 ligne)&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Si l&#39;on souhaite Ã©galement avoir la place prise par les indexes, il faut utiliser la fonction &lt;a class=&#34;reference external&#34; href=&#34;http://docs.postgresql.fr/9.1/functions-admin.html&#34;&gt;pg_total_relation_size&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;production=# select pg_size_pretty(pg_total_relation_size(&amp;#39;res_partner&amp;#39;));&#xA; pg_size_pretty&#xA;----------------&#xA; 528 kB&#xA;(1 ligne)&#xA;&lt;/pre&gt;&lt;/div&gt;</summary>
    <author>
      <name>Christophe Chauvet</name>
    </author>
  </entry>
  <entry>
    <title>Installation TinyERP 4.2 avec PostgreSQL 8.3</title>
    <updated>2008-05-25T09:33:00Z</updated>
    <id>tag:blog.kryskool.org,2008-05-25:/Installation-TinyERP-42-avec-PostgreSQL-83-fr.html</id>
    <link href="http://blog.kryskool.org/Installation-TinyERP-42-avec-PostgreSQL-83-fr.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Depuis la version 8.3, certain CAST ne sont plus implicites, notamment ceux qui peuvent ramener des rÃ©sultats inattendus.&#xA;Dans la version de TinyERP 4.2 (4.2.2 actuellement) certaines requÃªtes avec des CAST implicites sur les dates Ã©taient utilisÃ©s,&#xA;ceux qui avec PostgreSQL 8.3 ramÃ¨ne un message d&#39;erreur Ã  l&#39;utilisation de cette requÃªte. La question que l&#39;on se pose:&lt;/p&gt;&#xA;&lt;ul class=&#34;simple&#34;&gt;&#xA;&lt;li&gt;Doit on utiliser PostgreSQL 8.3 avec TinyERP 4.2.2 ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La rÃ©ponse est non, simplement que le version 4.2 de TinyERP est la version stable, il ne faut surtout pas toucher au code.&#xA;Le Trunk du SVN fonctionne dÃ©jÃ  avec la version 8.3, ainsi la prochaine version de OpenERP fonctionnera avec PostgreSQL 8.3.&lt;/p&gt;&#xA;&lt;ul class=&#34;simple&#34;&gt;&#xA;&lt;li&gt;Quelle version de PostgreSQL puis je utiliser ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Avec TinyERP 4.2 il est possible d&#39;utiliser PostgreSQL 7.4, 8.0, 8.1 et 8.2 sauf sous Windows ou les versions 8.0 et 8.1 ne sont plus maintenus. Sous Windows seule la version 8.2 est supportÃ©.&lt;/p&gt;&#xA;&lt;p&gt;08/09/2008 : Ceci n&#39;est plus tout a fait vrai, voir ce &lt;a class=&#34;reference external&#34; href=&#34;Premier-patch-pour-TinyERP/OpenERP&#34;&gt;billet&lt;/a&gt; pour les explications&lt;/p&gt;</summary>
    <author>
      <name>Christophe Chauvet</name>
    </author>
  </entry>
  <entry>
    <title>RÃ©installation PostgreSQL sous Windows XP</title>
    <updated>2008-03-31T14:00:00Z</updated>
    <id>tag:blog.kryskool.org,2008-03-31:/Reinstallation-PostgreSQL-sous-Windows-XP-fr.html</id>
    <link href="http://blog.kryskool.org/Reinstallation-PostgreSQL-sous-Windows-XP-fr.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Ce message d&#39;erreur vous indique que l&#39;utilisateur systÃ¨me Windows existe dÃ©jÃ , et donc par consÃ©quent que sa crÃ©ation Ã  Ã©chouÃ©,&#xA;si vous aviez mÃ©morisÃ© le mot de passe attribuer Ã  ce compte, il vous suffit de le saisir, sinon il va falloir supprimer l&#39;utilisateur avec la commande ci-dessous&#xA;a lancer dans une fenÃªtre CMD avec les droits administrateurs.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;net user postgres &lt;span class=&#34;n&#34;&gt;/DELETE&lt;/span&gt;&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Ensuite il vous suffit de relancer l&#39;installation, qui recrÃ©era le nouveau compte &lt;strong&gt;postgres&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Si vous avez Ã©galement rÃ©installÃ© &lt;strong&gt;PostgreSQL&lt;/strong&gt;, lors de la prÃ©cÃ©dente dÃ©sinstallation, le rÃ©pertoire de donnÃ©es&#xA;se trouvant dans &amp;quot;Program FilesPostgreSQL8.x&amp;quot; (ou X est le numÃ©ro de version mineure) n&#39;est pas supprimÃ©,&#xA;ce qui fait Ã©galement Ã©chouer l&#39;installation lors de la crÃ©ation du &lt;em&gt;CLUSTER&lt;/em&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Christophe Chauvet</name>
    </author>
  </entry>
  <entry>
    <title>Base de donnÃ©es de test utilisÃ©e pour les articles du site</title>
    <updated>2008-03-12T11:30:00Z</updated>
    <id>tag:blog.kryskool.org,2008-03-12:/Base-de-donnees-de-test-utilises-pour-les-articles-du-site-fr.html</id>
    <link href="http://blog.kryskool.org/Base-de-donnees-de-test-utilises-pour-les-articles-du-site-fr.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;La base de test utilisÃ©e, se nomme Pagila. Elle fait partie du projet &lt;em&gt;DbSample&lt;/em&gt; sur &lt;em&gt;pgFoundry.org&lt;/em&gt;&#xA;vous pouvez la tÃ©lÃ©charger directement &lt;a class=&#34;reference external&#34; href=&#34;http://pgfoundry.org/frs/download.php/1556/pagila-0.10.0.zip&#34;&gt;ici&lt;/a&gt;.&#xA;La version 0.10 supporte la version 8.3 de PostgreSQL qui intÃ¨gre nativement Tsearch2 (la recherche FullText native),&#xA;les versions antÃ©rieurs de pagila nÃ©cessitait d&#39;avoir tsearch2 d&#39;activer ce qui n&#39;Ã©tait pas possible de faire sous Windows sans compilation.&lt;/p&gt;&#xA;&lt;p&gt;L&#39;installation de la base pagila se fera en ligne de commande.&#xA;Les utilisateurs de windows se rÃ©fÃ¨rerons a cet &lt;a class=&#34;reference external&#34; href=&#34;/Utilisation-de-psql-sous-Windows&#34;&gt;article&lt;/a&gt; pour utiliser correctement la mÃ©thode en ligne de commande,&#xA;les utilisateurs sous Linux utiliserons l&#39;utilisateur systÃ¨me &lt;em&gt;postgres&lt;/em&gt; directement.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;%PSQL%&lt;span class=&#34;se&#34;&gt;\c&lt;/span&gt;reatedb -U postgres -E UTF8 -e pagila&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Lorsque vous allez valider cette commande, le mot de passe de l&#39;utilisateur &lt;em&gt;postgres&lt;/em&gt; vous sera demandÃ©, et la base &lt;em&gt;pagila&lt;/em&gt; sera crÃ©e avec un encodage en UTF8.&#xA;La base de donnÃ©es est crÃ©e, nous allons pouvoir importer les donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Positionnez vous dans le rÃ©pertoire ou vous avez dÃ©compressez l&#39;archive de &lt;em&gt;Pagila&lt;/em&gt;, puis toujours en ligne de commande exÃ©cuter la commande suivante :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;%PSQL%&lt;span class=&#34;se&#34;&gt;\p&lt;/span&gt;sql -U postgres -d pagila -f pagila-schema.sql&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;une fois la touche entrÃ©e validÃ©, le mot de passe de l&#39;utilisateur &lt;em&gt;postgres&lt;/em&gt; peut vous Ãªtre demander, et ensuite vous verrez apparaÃ®tre le retour de chaque commande,&#xA;vÃ©rifier qu&#39;aucun message d&#39;erreur n&#39;apparaÃ®t. a cet instant le schÃ©ma devant accueillir les donnÃ©es a Ã©tÃ© insÃ©rÃ© dans la base &lt;em&gt;pagila&lt;/em&gt; crÃ©e prÃ©cÃ©demment.&lt;/p&gt;&#xA;&lt;p&gt;Nous allons maintenant y insÃ©rÃ© les donnÃ©es Ã  l&#39;aide de cette commande.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;%PSQL%&lt;span class=&#34;se&#34;&gt;\p&lt;/span&gt;sql -U postgres -d pagila -f pagila-data.sql&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;Si pas de message d&#39;erreur, notre base de test est prÃªte, nous allons faire une petite requÃªte de vÃ©rification dans &lt;em&gt;psql&lt;/em&gt;. une fois connectÃ©, exÃ©cuter la requÃªte suivante&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;span class=&#34;n&#34;&gt;pagila&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;description&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;film&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;film_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;      &lt;span class=&#34;n&#34;&gt;title&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                                           &lt;span class=&#34;n&#34;&gt;description&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;------------------+--------------------------------------------------------------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;ACADEMY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DINOSAUR&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Epic&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Drama&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Feminist&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;And&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Mad&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scientist&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;who&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;must&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Battle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Teacher&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;The&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Canadian&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Rockies&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;n&#34;&gt;pagila&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&#xA;&lt;/pre&gt;&lt;/div&gt;</summary>
    <author>
      <name>Christophe Chauvet</name>
    </author>
  </entry>
  <entry>
    <title>Installation de PostgreSQL 8.3 sous Windows XP</title>
    <updated>2008-02-26T13:02:00Z</updated>
    <id>tag:blog.kryskool.org,2008-02-26:/Installation-de-PostgreSQL-83-sous-Windows-XP-fr.html</id>
    <link href="http://blog.kryskool.org/Installation-de-PostgreSQL-83-sous-Windows-XP-fr.html" rel="alternate"></link>
    <summary type="html">&lt;div class=&#34;section&#34; id=&#34;telechargement&#34;&gt;&#xA;&lt;h2&gt;TÃ©lÃ©chargement&lt;/h2&gt;&#xA;&lt;p&gt;Avant l&#39;installation de PostgreSQL 8.3, nous devons au prÃ©alable le rÃ©cupÃ©rer, pour cela nous allons le tÃ©lÃ©charger sur l&#39;un des &lt;a class=&#34;reference external&#34; href=&#34;http://wwwmaster.postgresql.org/download/mirrors-ftp?file=%2Fbinary%2Fv8.3.0%2Fwin32%2Fpostgresql-8.3.0-1.zip&#34;&gt;miroirs&lt;/a&gt; disponibles.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;lancement&#34;&gt;&#xA;&lt;h2&gt;Lancement&lt;/h2&gt;&#xA;&lt;p&gt;Un fois le tÃ©lÃ©chargement terminÃ©, vous obtenez un fichier nommÃ© postgresql-8.3.0-1.zip dans votre rÃ©pertoire de destination. DÃ©compresser le et vous obtiendrez la liste de fichier ci-dessous.&lt;/p&gt;&#xA;&lt;img alt=&#34;Listes_fichiers&#34; src=&#34;images/InstPg83/liste_fichier.jpg&#34; /&gt;&#xA;&lt;p&gt;Puisqu&#39;il s&#39;agit de la premiÃ¨re version stable de la version 8.3, il est pas conseiller d&#39;exÃ©cuter une mise Ã  jour avec upgrade.bat, Ã  partir des versions RC ou Beta.&#xA;Le script upgrade.bat ne peut en aucun cas servir Ã  mettre Ã  jour une 8.2 vers une 8.3. Il servira uniquement Ã  la mise Ã  jour de votre 8.3 lorsque de nouvelle versions correctives sortiront.&lt;/p&gt;&#xA;&lt;div class=&#34;note&#34;&gt;&#xA;&lt;p class=&#34;first admonition-title&#34;&gt;Note&lt;/p&gt;&#xA;&lt;p class=&#34;last&#34;&gt;Afin d&#39;eviter le plantage lors du dÃ©marrage du service PostgreSQL une fois installÃ©, il convient de vÃ©rifier que le service windows &lt;strong&gt;Connexion secondaire&lt;/strong&gt; est dÃ©marrÃ©.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Pour commencer l&#39;installation de PostgreSQL 8.3, exÃ©cuter indiffÃ©remment &lt;strong&gt;SETUP.bat&lt;/strong&gt; ou &lt;strong&gt;postgresql-8.3.msi&lt;/strong&gt; (si votre environnement Windows est correctement installÃ©,&#xA;le fichier msi devrait dÃ©clencher l&#39;installation.). Un fois lancer vous obtiendrez l&#39;Ã©cran suivant.&lt;/p&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;ecran-d-accueil&#34;&gt;&#xA;&lt;h3&gt;Ecran d&#39;accueil&lt;/h3&gt;&#xA;&lt;img alt=&#34;Choix_Langue&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--14-56-00.jpg&#34; /&gt;&#xA;&lt;p&gt;Ce premier Ã©cran va nous permettre de sÃ©lectionner la langue utiliser pour le reste de l&#39;installation, nous allons bien Ã©videment choisir Â« French / FranÃ§ais Â». Nous allons Ã©galement cocher la case Â« &#39;&#39;Write detailed installation log to postgresql-8.3.log in the current directory&#39;&#39; Â», ceci enregistrera des informations utiles pour un Ã©ventuel dÃ©pannage, si l&#39;installation ne se dÃ©roulait pas correctement.&lt;/p&gt;&#xA;&lt;p&gt;Pour poursuivre l&#39;installation appuyer sur le bouton Â« Start Â».&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;ecran-bienvenue-en-francais&#34;&gt;&#xA;&lt;h3&gt;Ecran bienvenue en FranÃ§ais&lt;/h3&gt;&#xA;&lt;img alt=&#34;Ecran debut install&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--14-56-40.jpg&#34; /&gt;&#xA;&lt;p&gt;Sur cette Ã©cran, rien de bien compliquer, il suffit de suivre les instructions, et de cliquer sur Â« Suivant Â»&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;license&#34;&gt;&#xA;&lt;h3&gt;License&lt;/h3&gt;&#xA;&lt;img alt=&#34;Licence&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--14-56-50.jpg&#34; /&gt;&#xA;&lt;p&gt;Cette Ã©cran dÃ©taille toutes les licenses inclus dans cette installation&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;option-d-installation&#34;&gt;&#xA;&lt;h3&gt;Option d&#39;installation&lt;/h3&gt;&#xA;&lt;img alt=&#34;Choix des options&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--14-57-23.jpg&#34; /&gt;&#xA;&lt;p&gt;Les options par dÃ©faut sont suffisantes, pour avoir la gestion de la langue, activÃ© Ã©galement &lt;strong&gt;Support de la langue&lt;/strong&gt;.&#xA;les messages d&#39;erreurs apparaÃ®trons Ã©galement traduit, il sera possible au niveau de la session de les obtenir en Anglais,&#xA;ce qui vous permettra d&#39;avoir plus de resultat lors de la recherche de message d&#39;erreur similaire dans votre moteur de recherche favori.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;configuration-du-service&#34;&gt;&#xA;&lt;h3&gt;Configuration du service&lt;/h3&gt;&#xA;&lt;img alt=&#34;Configuration du service&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--14-58-05.jpg&#34; /&gt;&#xA;&lt;p&gt;PostgreSQL sous Windows est vu comme un service, celui a besoin d&#39;avoir un compte utilisateur avec le minimum de droit,&#xA;par defaut l&#39;utilisateur crÃ©e se nomme &lt;strong&gt;postgres&lt;/strong&gt;,&#xA;il convient de mÃ©moriser son mot de passe, qui vous permettra par la suite de faire cohabiter plusieurs versions de &lt;strong&gt;PostgreSQL&lt;/strong&gt;,&#xA;en utilisant le mÃªme utilisateur systÃ¨me pour dÃ©marrer les diffÃ©rents services.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;initialisation-du-cluster&#34;&gt;&#xA;&lt;h3&gt;Initialisation du cluster&lt;/h3&gt;&#xA;&lt;img alt=&#34;Initialisation du cluster&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--14-58-46.jpg&#34; /&gt;&#xA;&lt;p&gt;&lt;strong&gt;psql&lt;/strong&gt; dans une console Windows a besoin d&#39;un encodage WIN1252. dans cette configuration cotÃ© serveur faut absolument choisir l&#39;encodage UTF8.&#xA;Par dÃ©faut un utilisateur &lt;strong&gt;postgres&lt;/strong&gt; est crÃ©e dans la base de donnÃ©es, il s&#39;agit du super utilisateur qui possÃ¨dent les pleins droits sur le cluster de base de donnÃ©es.&#xA;Pour cette raison il faut bien mÃ©moriser le mot de passe que vous lui attribuer, car celui ci servira Ã  Ã©tablir la premiÃ¨re connexion Ã  la base de donnÃ©es,&#xA;en vue du crÃ©e votre premiÃ¨re base, mais Ã©galement un utilisateur lambda.&#xA;Il est bien sur fortement conseiller de mettre un mot de passe diffÃ©rents de celui qui a servit Ã  crÃ©er l&#39;utilisateur local de la machine.&lt;/p&gt;&#xA;&lt;img alt=&#34;Connexions distantes&#34; src=&#34;images/InstPg83/Connexions%20distantes--2008-02-12--14-59-07.jpg&#34; /&gt;&#xA;&lt;p&gt;Ce message vous indique que vous avez activÃ© la connexion TCP/IP et que votre serveur PostgreSQL est accessible Ã  travers toutes les machines du rÃ©seau, pour en restreindre l&#39;usage, consulter cette &lt;a class=&#34;reference external&#34; href=&#34;http://docs.postgresqlfr.org/8.3/client-authentication.html#auth-pg-hba-conf&#34;&gt;partie&lt;/a&gt; de la documentation.&lt;/p&gt;&#xA;&lt;ul class=&#34;simple&#34;&gt;&#xA;&lt;li&gt;Dans cette configuration il convient de choisir un mot de passe pour le super-utilisateur &lt;strong&gt;postgres&lt;/strong&gt; qui ne soit pas identique au login.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;langages-proceduraux&#34;&gt;&#xA;&lt;h3&gt;Langages procÃ©duraux&lt;/h3&gt;&#xA;&lt;img alt=&#34;Langages procÃ©duraux&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--14-59-17.jpg&#34; /&gt;&#xA;&lt;p&gt;Les langages proceduraux (PL) peuvent Ãªtre installer sÃ©parÃ©ment, pendant l&#39;installation ou ultÃ©rieurement. Par dÃ©faut PL/pgSQL est activÃ©,&#xA;cela signifie qu&#39;il sera installÃ© dans la base &lt;strong&gt;template1&lt;/strong&gt; qui est utilisÃ© comme modÃ¨le lors de la crÃ©ation d&#39;une nouvelle base de donnÃ©es.&#xA;L&#39;activation des case a cochÃ© pour les autres langages dÃ©pend si le module d&#39;installation a dÃ©tectÃ© la prÃ©sence des interpreteurs pour les diffÃ©rents langages.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;choix-des-contrib&#34;&gt;&#xA;&lt;h3&gt;Choix des contrib&lt;/h3&gt;&#xA;&lt;img alt=&#34;Choix des contribs&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--15-00-08.jpg&#34; /&gt;&#xA;&lt;p&gt;Par dÃ©faut 2 contributions sont installÃ©s&lt;/p&gt;&#xA;&lt;ul class=&#34;simple&#34;&gt;&#xA;&lt;li&gt;Adminpack&lt;/li&gt;&#xA;&lt;li&gt;Debugger&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Si vous cochez d&#39;autres contributions, celles-ci seront installÃ©s et activÃ©s par dÃ©faut, sinon elle seront juste installÃ©s dans le rÃ©pertoire de contrib et&#xA;leur activation se fera au travers de leurs scripts d&#39;installation respectif (dans ce mÃªme rÃ©pertoire se trouve Ã©galement les scripts de dÃ©sinstallations)&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;progression-de-l-installation&#34;&gt;&#xA;&lt;h3&gt;Progression de l&#39;installation&lt;/h3&gt;&#xA;&lt;img alt=&#34;Debut installation&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--15-00-20.jpg&#34; /&gt;&#xA;&lt;p&gt;L&#39;installation ne devrait pas poser de soucis, sinon vous obtiendrez un message d&#39;erreur explique, mais Ã©galement une trace dans le fichier de log.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;fin-d-installation&#34;&gt;&#xA;&lt;h3&gt;Fin d&#39;installation&lt;/h3&gt;&#xA;&lt;img alt=&#34;Ecran final&#34; src=&#34;images/InstPg83/PostgreSQL--2008-02-12--15-01-07.jpg&#34; /&gt;&#xA;&lt;p&gt;Voila &lt;strong&gt;PostgreSQL&lt;/strong&gt; est fraichement installÃ© sur votre environnement. sur ce dernier Ã©cran il vous est conseillÃ© de vous inscrire Ã  la liste &lt;strong&gt;psql-announce&lt;/strong&gt;&#xA;pour Ãªtre informer des nouvelles mises Ã  jour mais Ã©galement des bugs ou correction de bug.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;premiere-connexion&#34;&gt;&#xA;&lt;h2&gt;PremiÃ¨re connexion&lt;/h2&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;avec-psql&#34;&gt;&#xA;&lt;h3&gt;Avec psql&lt;/h3&gt;&#xA;&lt;p&gt;Pour la premiÃ¨re connexion avec psql, faite &lt;strong&gt;Demarrer / Executer&lt;/strong&gt; puis saisissez &lt;strong&gt;cmd&lt;/strong&gt;. Lorsque la console est ouverte saisissez les lignes ci-dessous.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;chcp 1252&#xA;set PSQL=&amp;quot;c:\Program Files\PostgreSQL\8.3\bin&amp;quot;&#xA;%PSQL%\psql -U postgres&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;p&gt;vous devriez obtenir l&#39;Ã©cran ci-dessous, aprÃ¨s avoir saisie le mot de passe de l&#39;utilisateur &lt;strong&gt;postgres&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;Password for user postgres:&#xA;Welcome to psql 8.3.0, the PostgreSQL interactive terminal.&#xA;&#xA;Type:  \copyright for distribution terms&#xA;       \h for help with SQL commands&#xA;       \? for help with psql commands&#xA;       \g or terminate with semicolon to execute query&#xA;       \q to quit&#xA;&#xA;postgres=#&#xA;&lt;/pre&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;section&#34; id=&#34;avec-pgadmin-iii&#34;&gt;&#xA;&lt;h3&gt;Avec pgAdmin III&lt;/h3&gt;&#xA;&lt;p&gt;Pour lancer pgAdmin3, aller sur &lt;strong&gt;Demarrer / Programmes / PostgreSQL 8.3 / pgAdmin3&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;img alt=&#34;pgAdmin3 Connexion&#34; src=&#34;images/InstPg83/pgAdmin_III--2008-03-01--20-58-50.jpg&#34; /&gt;&#xA;&lt;p&gt;Choisissez le serveur sur lequel vous souhaitez vous connecter, pour l&#39;instant 1 seul est dÃ©clarÃ© et faites un clic droit, puis &lt;strong&gt;Se connecter&lt;/strong&gt;,&#xA;vous pouvez maintenant naviguer dans l&#39;arborescence, et commencer par crÃ©er un Utilisateur puis une base de donnÃ©es.&lt;/p&gt;&#xA;&lt;img alt=&#34;pgAdmin3 Arborescence&#34; src=&#34;images/InstPg83/pgAdmin_III--2008-03-01--21-23-40.jpg&#34; /&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>Christophe Chauvet</name>
    </author>
  </entry>
</feed>