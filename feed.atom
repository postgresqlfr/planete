<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>Plan√®te PostgreSQL</title>
  <id>https://planete.postgresql.fr/</id>
  <updated>2025-12-19T20:40:06Z</updated>
  <subtitle>L&#39;actualit√© de PostgreSQL de fran√ßais</subtitle>
  <link href="https://planete.postgresql.fr/"></link>
  <author>
    <name>PostgreSQL.fr</name>
    <email>contact@postgresql.fr</email>
  </author>
  <entry>
    <title>Open Source Experience 2025</title>
    <updated>2025-12-19T00:00:00Z</updated>
    <id>tag:localhost:8080,2025-12-19:/fr/blog/open-source-experience-2025/</id>
    <content type="html"> &lt;p&gt;L‚Äô√©dition 2025 de l‚Äô&lt;a href=&#34;__https://www.opensource-experience.com/__&#34;&gt;Open Source Experience (OSXP)&lt;/a&gt; s‚Äôest tenue les 10 et 11 d√©cembre sous le th√®me ¬´ Open Source, cl√© de l‚Äôautonomie strat√©gique de l‚ÄôEurope ¬ª. L‚Äôaccent portait, comme vous l‚Äôimaginez, enti√®rement sur la red√©finition de l‚Äôavenir num√©rique europ√©en comme √©tant men√© par les innovations open source √† travers toutes les technologies (incluant l‚ÄôIA, la gestion des donn√©es, le cloud et la cybers√©curit√©).&lt;/p&gt;&#xA;&lt;p&gt;L‚Äô√©v√©nement a dur√© 2 jours avec 90 exposants, 130 sessions, 150 intervenants et plus de 4 000 participants - une conf√©rence de tr√®s grande envergure, situ√©e √† la Cit√© des Sciences et de l‚ÄôIndustrie √† Paris. Les pr√©sentations √©taient en anglais et en fran√ßais.&lt;/p&gt;&#xA;&lt;p&gt;Deux membres de notre √©quipe √©taient pr√©sents et ont pu d√©couvrir divers exposants et salles d√©di√©es aux conf√©rences r√©partis sur trois √©tages. Ces derni√®res duraient 20 minutes et bien que trop succinct pour entrer dans les d√©tails, ce format √©tait int√©ressant pour d√©couvrir les nouvelles technologies et attiser notre curiosit√© d‚Äôun coup d‚Äô≈ìil.&lt;/p&gt;&#xA;&lt;p&gt;La fr√©quentation a √©t√© particuli√®rement importante d√®s le premier jour. Nous avons √©t√© ravis d‚Äôavoir l‚Äôoccasion de rencontrer OW2, Odoo et Nextcloud qui sont tous de fiers fournisseurs open source et dont nous sommes partenaires officiels chez Data Bene.&lt;/p&gt;&#xA;&lt;p&gt;Bien que l‚Äô√©v√©nement se concentrait enti√®rement sur les technologies open source dans leur ensemble, nous avons pu discuter de sujets tels que le support PostgreSQL, les difficult√©s et impacts pour les entreprises souhaitant migrer vers PostgreSQL, et la demande du march√© pour se lib√©rer des contraintes de licence Oracle avec d‚Äôautres participants.&lt;/p&gt;&#xA;&lt;p&gt;Nous avons √©galement eu le plaisir de discuter avec Christophe Biquard de Thales sur le d√©veloppement des processeurs open source CORE-V CVA6, un sujet mis en avant sur leur stand.&lt;/p&gt;&#xA;&lt;p&gt;L‚Äô√©v√©nement √©tait r√©ussi et bien organis√©. La seule chose qui aurait am√©lior√© l‚Äôexp√©rience aurait √©t√© des pr√©sentations plus longues pour explorer plus en profondeur les diff√©rents sujets abord√©s. Pour ceux qui souhaitent y assister, il faut noter que l‚Äô√©v√©nement √©tait √©galement int√©ressant pour prospecter de nouveaux clients et entreprises √† soutenir ou avec lesquelles s‚Äôassocier - c‚Äô√©tait une excellente opportunit√© de r√©seautage.&lt;/p&gt;&#xA;&lt;p&gt;Dans l‚Äôensemble, nous avons beaucoup appr√©ci√© l‚Äô√©v√©nement et esp√©rons y assister l‚Äôann√©e prochaine !&lt;/p&gt;&#xA;&lt;p&gt;Vous nous avez rencontr√©s l√†-bas mais avez oubli√© de prendre nos coordonn√©es ? On esp√®re que vous trouverez cet article. üòâ Contactez notre √©quipe, √† tout moment : &lt;a href=&#34;https://data-bene.io/en/#contact&#34; rel=&#34;noopener&#34;&gt;https://data-bene.io/en/#contact&lt;/a&gt;&lt;/p&gt;&#xA; </content>
    <link href="http://localhost:8080/fr/blog/open-source-experience-2025/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Gr√©gory Tiram</name>
    </author>
  </entry>
  <entry>
    <title>Transitionnez facilement vers PostgreSQL depuis Oracle</title>
    <updated>2025-12-10T00:00:00Z</updated>
    <id>tag:localhost:8080,2025-12-10:/fr/blog/transitionnez-facilement-vers-postgresql-depuis-oracle/</id>
    <content type="html"> &lt;p&gt;Si vous avez besoin de transition rapidement d‚ÄôOracle vers PostgreSQL, sans vous pr√©occuper des conversions de types ou autres packages Oracle qui n√©cessitent des modifications pour √™tre compatible PostgreSQL, une solution utile est IvorySQL !&lt;/p&gt;&#xA;&lt;h2 id=&#34;introduction&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#introduction&#34;&gt;Introduction&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;De plus en plus d‚Äôentreprises cherchent √† se lib√©rer des co√ªts et des contraintes d‚ÄôOracle en migrant vers PostgreSQL. Mais comment r√©ussir cette transition sans y passer des mois‚ÄØ? Voici une m√©thode √©prouv√©e, rapide et s√©curis√©e, bas√©e sur des retours d‚Äôexp√©rience et des outils open source.&lt;/p&gt;&#xA;&lt;h3 id=&#34;commencer-par-evaluer-et-cartographier&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#commencer-par-evaluer-et-cartographier&#34;&gt;Commencer par √©valuer et cartographier&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Avant de migrer, il est essentiel de faire l‚Äô√©tat des lieux : lister les objets Oracle par une extraction compl√®te (tables, vues, s√©quences, proc√©dures, fonctions, packages).&lt;/p&gt;&#xA;&lt;p&gt;Mais aussi avoir des √©changes r√©guliers avec le client pour affiner les constats et valider les orientations, mais aussi d‚Äôidentifier les d√©pendances (applications connect√©es avec quelle technologie, jobs, interfaces,‚Ä¶)&lt;/p&gt;&#xA;&lt;p&gt;Et enfin, rep√©rer les sp√©cificit√©s Oracle du client (fonctions sp√©cifiques comme ROWID, DUAL, DBMS_XXX,‚Ä¶) et tout autre mot-cl√© demandant une attention particuli√®re.&lt;/p&gt;&#xA;&lt;h3 id=&#34;choisir-les-bons-outils-open-source&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#choisir-les-bons-outils-open-source&#34;&gt;Choisir les bons outils open source&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;La r√©ussite d‚Äôune transition vers PostgreSQL - car il s‚Äôagit bien d‚Äôune transition progressive et non d‚Äôune migration - repose autant sur la strat√©gie que sur les outils.&lt;/p&gt;&#xA;&lt;p&gt;Il ne suffit pas de copier des objets : il faut comprendre les subtilit√©s du moteur Oracle et les transposer intelligemment dans l‚Äôunivers PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Parmi les outils incontournables, Ora2Pg joue un r√¥le central. Il permet non seulement de g√©n√©rer des rapports d‚Äôinventaire clairs, mais aussi d‚Äôautomatiser la conversion des sch√©mas, des donn√©es et du code PL/SQL. C‚Äôest un acc√©l√©rateur pr√©cieux pour les projets bien structur√©s.&lt;/p&gt;&#xA;&lt;p&gt;Mais dans certains contextes, la r√©alit√© est plus complexe. De nombreux clients accumulent une dette technique importante, avec des milliers de lignes de code proc√©dural. Tenter de tout r√©√©crire en PL/pgSQL dans un d√©lai court reviendrait √† √©puiser les √©quipes, tout en compromettant la migration elle-m√™me. Maintenir deux bases de code ‚Äî l‚Äôune en PL/SQL, l‚Äôautre en PL/pgSQL ‚Äî pendant une phase de transition compl√®te est souvent intenable sur le plan organisationnel.&lt;/p&gt;&#xA;&lt;p&gt;C‚Äôest pr√©cis√©ment l√† qu‚ÄôIvorySQL offre une alternative puissante. Ce fork de PostgreSQL, enrichi de compatibilit√©s Oracle (PL/SQL, ROWID, DUAL, etc.), permet de r√©duire consid√©rablement le besoin de r√©√©criture imm√©diate. En combinant IvorySQL avec une documentation cibl√©e et des scripts de validation m√©tier, on obtient une transition plus rapide, plus fiable, et surtout mieux ma√Ætris√©e.&lt;/p&gt;&#xA;&lt;p&gt;Une fois en production, les √©quipes disposent du temps n√©cessaire pour r√©√©crire progressivement leur code proc√©dural en PL/pgSQL, sans pression ni rupture fonctionnelle.&lt;/p&gt;&#xA;&lt;h3 id=&#34;integration-et-tests&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#integration-et-tests&#34;&gt;Int√©gration et tests&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;L‚Äôun des grands avantages d‚ÄôIvorySQL, c‚Äôest qu‚Äôil r√©alise une partie de l‚Äôint√©gration en amont. Gr√¢ce √† son support natif du PL/SQL, des objets Oracle et de la syntaxe Oracle-compatible, de nombreux √©l√©ments migr√©s via Ora2Pg fonctionnent imm√©diatement sans adaptation lourde.&lt;/p&gt;&#xA;&lt;p&gt;Cela ne dispense √©videmment pas d‚Äôune phase de test, bien au contraire‚ÄØ: il est essentiel de valider les comportements m√©tier dans un environnement de pr√©production IvorySQL. Les proc√©dures, fonctions, packages, triggers et vues doivent √™tre test√©s avec des cas r√©els, en comparant les r√©sultats entre Oracle et IvorySQL pour garantir l‚Äô√©quivalence fonctionnelle.&lt;/p&gt;&#xA;&lt;p&gt;Des scripts de comparaison peuvent √™tre utilis√©s pour v√©rifier les r√©ponses aux requ√™tes, les effets des transactions, ou les comportements des fonctions migr√©es. Mais dans bien des cas, IvorySQL permet de r√©duire consid√©rablement le besoin de patchs ou de r√©√©criture, ce qui acc√©l√®re la mise en production et s√©curise la transition.&lt;/p&gt;&#xA;&lt;h3 id=&#34;documenter-et-accompagner&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#documenter-et-accompagner&#34;&gt;Documenter et accompagner&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Une transition r√©ussie ne se limite pas √† la technique‚ÄØ: elle repose aussi sur une documentation claire et un accompagnement adapt√©. Il est essentiel de r√©diger des cahiers de tests entiers et exhaustifs par objet complexe et modules (proc√©dure, package, trigger‚Ä¶), afin de garder une trace des choix techniques, des adaptations r√©alis√©es, et des points d‚Äôattention.&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôaccompagnement des √©quipes client est tout aussi important. Des ateliers cibl√©s permettent de transmettre les bonnes pratiques, d‚Äôexpliquer les diff√©rences entre Oracle et PostgreSQL, et de faciliter la prise en main d‚ÄôIvorySQL.&lt;/p&gt;&#xA;&lt;p&gt;Enfin, la r√©ussite d‚Äôune transition vers PostgreSQL repose aussi sur l‚Äôaccompagnement des √©quipes techniques et fonctionnelles. Des sessions de formation cibl√©es permettent aux d√©veloppeurs, DBA et chefs de projet de s‚Äôapproprier les sp√©cificit√©s d‚ÄôIvorySQL, de comprendre les diff√©rences avec Oracle, et de monter en comp√©tence rapidement.&lt;/p&gt;&#xA;&lt;p&gt;Ce dispositif s‚Äôappuie √©galement sur un support technique structur√©, qui aide √† r√©soudre les blocages, √† s√©curiser les choix d‚Äôimpl√©mentation, et √† fluidifier les √©changes entre les √©quipes projet et les experts migration.&lt;/p&gt;&#xA;&lt;h2 id=&#34;ivorysql-dans-le-monde-reel&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#ivorysql-dans-le-monde-reel&#34;&gt;IvorySQL dans le monde r√©el&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Lors d‚Äôune mission r√©cente pour une entreprise du secteur priv√©, nous avons accompagn√© la transition d‚Äôune base Oracle vers IvorySQL dans un contexte contraint : dette technique importante, volum√©trie √©lev√©e, et d√©lais serr√©s.&lt;/p&gt;&#xA;&lt;p&gt;Gr√¢ce √† IvorySQL et notre capacit√© √† automatiser cette transition, cette transition s‚Äôest faite rapidement et la quasi totalit√© des objets ont √©t√© int√©gr√©s sans r√©√©criture.&lt;/p&gt;&#xA;&lt;p&gt;La bascule d‚ÄôIvorySQL vers PostgreSQL peut s‚Äôeffectuer sereinement, dans la mesure o√π l‚Äôapplication fonctionne pleinement et r√©pond aux attentes m√©tier.&lt;/p&gt;&#xA;&lt;p&gt;Les √©quipes ont pu se concentrer sur les tests m√©tier, tandis que la formation cibl√©e et le support technique ont permis une mont√©e en comp√©tence rapide.&lt;/p&gt;&#xA;&lt;p&gt;Il est indispensable de r√©ussir ce genre de projet pour emmagasiner de la confiance et d√©velopper cette op√©ration sur la totalit√© de votre parc d‚Äôinstances Oracle !&lt;/p&gt;&#xA;&lt;p&gt;Vous envisagez une transition Oracle vers PostgreSQL‚ÄØ? Parlons-en.&lt;/p&gt;&#xA;&lt;p&gt;Contactez notre √©quipe d‚Äôexperts, √† tout moment: &lt;a href=&#34;mailto:contact@data-bene.io&#34;&gt;contact@data-bene.io&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Le 26 novembre 2025, IvorySQL 5.0 a √©t√© publi√© - &lt;a href=&#34;https://www.postgresql.org/about/news/ivorysql-50-released-major-oracle-compatibility-expansion-on-postgresql-180-foundation-3180/&#34; rel=&#34;noopener&#34;&gt;voir l‚Äôannonce ici&lt;/a&gt; pour plus d‚Äôinformations sur ce projet open source.&lt;/p&gt;&#xA; </content>
    <link href="http://localhost:8080/fr/blog/transitionnez-facilement-vers-postgresql-depuis-oracle/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Gr√©gory Tiram</name>
    </author>
  </entry>
  <entry>
    <title>Le saviez-vous ? Les tables dans PostgreSQL sont limit√©es √† 1600 colonnes</title>
    <updated>2025-11-13T00:00:00Z</updated>
    <id>tag:localhost:8080,2025-11-13:/fr/blog/le-saviez-vous-les-tables-dans-postgresql-sont-limitees-a-1600-colonnes/</id>
    <content type="html"> &lt;p&gt;&lt;strong&gt;Saviez-vous qu‚Äôune table ne peut pas contenir plus de 1¬†600 colonnes¬†?&lt;/strong&gt; Cet article de blog est inspir√© d‚Äôune conversation avec Pierre Ducroquet.&lt;/p&gt;&#xA;&lt;h2 id=&#34;tout-dabord-la-documentation&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#tout-dabord-la-documentation&#34;&gt;Tout d‚Äôabord, la documentation&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/limits.html&#34; rel=&#34;noopener&#34;&gt;L‚Äôannexe K&lt;/a&gt; de la documentation PostgreSQL  indique qu‚Äôune table peut contenir jusqu‚Äô√† 1¬†600 colonnes.&lt;/p&gt;&#xA;&lt;p&gt;Il s‚Äôagit d‚Äôune &lt;strong&gt;limite cod√©e en dur&lt;/strong&gt;, visible dans le code source √† l‚Äôadresse &lt;code&gt;src/include/access/htup_details.h&lt;/code&gt;¬†:&lt;/p&gt;&#xA;&lt;pre class=&#34;language-plaintext&#34;&gt;&lt;code class=&#34;language-plaintext&#34;&gt;#define MaxTupleAttributeNumber 1664&#xA;#define MaxHeapAttributeNumber&#x9;1600&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;h2 id=&#34;atteindre-la-limite-de-maniere-classique&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#atteindre-la-limite-de-maniere-classique&#34;&gt;Atteindre la limite de mani√®re classique&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;V√©rifions d‚Äôabord cette affirmation par quelques tests.&lt;/p&gt;&#xA;&lt;h3 id=&#34;jouer-avec-la-definition-de-la-table&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#jouer-avec-la-definition-de-la-table&#34;&gt;Jouer avec la d√©finition de la table&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Nous utilisons ici un script bash simple, facile √† adapter aux diff√©rents tests.&lt;/p&gt;&#xA;&lt;pre class=&#34;language-sql&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;-- Exemple classique&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token keyword&#34;&gt;DO&lt;/span&gt; $$&#xA;&lt;span class=&#34;token keyword&#34;&gt;DECLARE&lt;/span&gt;&#xA;    i &lt;span class=&#34;token keyword&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;DROP TABLE IF EXISTS tint_1601;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;CREATE TABLE tint_1601(i_1 int);&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;FOR&lt;/span&gt; i &lt;span class=&#34;token operator&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.1601&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&#xA;        &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;ALTER TABLE tint_1601 ADD COLUMN i_%s int;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; $$&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Le r√©sultat est le suivant :&lt;/p&gt;&#xA;&lt;pre class=&#34;language-plaintext&#34;&gt;&lt;code class=&#34;language-plaintext&#34;&gt;NOTICE:  table &#34;tint_1600&#34; does not exist, skipping&#xA;ERROR:  tables can have at most 1600 columns&#xA;CONTEXT:  SQL statement &#34;ALTER TABLE tint_1600 ADD COLUMN i_1601 int;&#34;&#xA;PL/pgSQL function inline_code_block line 8 at EXECUTE&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Jusqu‚Äôici, tout va bien (ou du moins, tout fonctionne comme pr√©vu).&lt;/p&gt;&#xA;&lt;p&gt;Vous pourriez tenter de remplacer le type &lt;code&gt;int4&lt;/code&gt; par le type &lt;code&gt;int2&lt;/code&gt; pour arriver √† cr√©er une table de plus de 1¬†600 colonnes. Mais cela ne fonctionnera pas plus, car il s‚Äôagit d‚Äôune limite cod√©e en dur.&lt;/p&gt;&#xA;&lt;h3 id=&#34;jouer-avec-le-contenu-dune-table&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#jouer-avec-le-contenu-dune-table&#34;&gt;Jouer avec le contenu d‚Äôune table&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;G√©n√©rons une table de 1600 colonnes √† partir du script sql pr√©c√©dent :&lt;/p&gt;&#xA;&lt;pre class=&#34;language-sql&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;&lt;span class=&#34;token keyword&#34;&gt;DO&lt;/span&gt; $$&#xA;&lt;span class=&#34;token keyword&#34;&gt;DECLARE&lt;/span&gt;&#xA;    i &lt;span class=&#34;token keyword&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;DROP TABLE IF EXISTS tint_1600;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;CREATE TABLE tint_1600(i_1 int);&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;FOR&lt;/span&gt; i &lt;span class=&#34;token operator&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.1600&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&#xA;        &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;ALTER TABLE tint_1600 ADD COLUMN i_%s int;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; $$&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Construisons puis ins√©rons un tuple de 1600 colonnes :&lt;/p&gt;&#xA;&lt;pre class=&#34;language-sql&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;&lt;span class=&#34;token keyword&#34;&gt;DO&lt;/span&gt; $$&#xA;&lt;span class=&#34;token keyword&#34;&gt;DECLARE&lt;/span&gt;&#xA;    s &lt;span class=&#34;token keyword&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    rows_inserted &lt;span class=&#34;token keyword&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;BEGIN&lt;/span&gt;&#xA;    s :&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&#xA;                 &lt;span class=&#34;token string&#34;&gt;&#39;INSERT INTO tint_1600 VALUES (1%s);&#39;&lt;/span&gt;&#xA;               &lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;repeat&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;,1&#39;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1599&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&#xA;               &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; s&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&#xA;    GET DIAGNOSTICS rows_inserted &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; ROW_COUNT&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    RAISE NOTICE &lt;span class=&#34;token string&#34;&gt;&#39;Rows inserted: %&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; rows_inserted&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; $$&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;The output is:&lt;/p&gt;&#xA;&lt;pre class=&#34;language-plaintext&#34;&gt;&lt;code class=&#34;language-plaintext&#34;&gt;NOTICE:  Rows inserted: 1&#xA;DO&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Sans surprise, c‚Äôest encore un succ√®s.&lt;/p&gt;&#xA;&lt;h3 id=&#34;trop-gros-pour-echouer&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#trop-gros-pour-echouer&#34;&gt;Trop gros pour √©chouer¬†?&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Continuons √† repousser les limites.&lt;/p&gt;&#xA;&lt;p&gt;On cr√©√© maintenant une autre table de 1¬†600 colonnes, cette fois avec le type de donn√©es &lt;code&gt;char(127)&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;On r√©utilise notre script bash avec quelques modifications¬†:&lt;/p&gt;&#xA;&lt;pre class=&#34;language-sql&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;-- Create a table with 1,600 columns: 1 x int + 1599 x char(127)&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;DO&lt;/span&gt; $$&#xA;&lt;span class=&#34;token keyword&#34;&gt;DECLARE&lt;/span&gt;&#xA;    i &lt;span class=&#34;token keyword&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;DROP TABLE IF EXISTS tint_1600;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;CREATE TABLE tint_1600(i_1 int);&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;FOR&lt;/span&gt; i &lt;span class=&#34;token operator&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.1600&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&#xA;        &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;ALTER TABLE tint_1600 ADD COLUMN c_%s char(127) NOT NULL;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; $$&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token comment&#34;&gt;-- Insert a tuple - 1 x int + 1599 x char(127)&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;DO&lt;/span&gt; $$&#xA;&lt;span class=&#34;token keyword&#34;&gt;DECLARE&lt;/span&gt;&#xA;    s &lt;span class=&#34;token keyword&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;BEGIN&lt;/span&gt;&#xA;    s :&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&#xA;                 &lt;span class=&#34;token string&#34;&gt;&#39;INSERT INTO tint_1600 VALUES (1%s);&#39;&lt;/span&gt;&#xA;               &lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;repeat&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt; $q$&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;1&#39;&lt;/span&gt;::&lt;span class=&#34;token keyword&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;$q$ &lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1599&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&#xA;               &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; s&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; $$&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;token identifier&#34;&gt;&lt;span class=&#34;token punctuation&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;`&lt;/span&gt;&#xA;&#xA;Le r√©sultat est :&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;ERROR:  row is too big: size 25616, maximum size 8160&lt;/p&gt;&#xA;&lt;pre class=&#34;language-plaintext&#34;&gt;&lt;code class=&#34;language-plaintext&#34;&gt;&#xA;Comme on peut le voir, la table comporte effectivement 1 600 colonnes, mais cette fois, le tuple ne peut pas tenir dans une seule page heap, ce qui explique l&#39;erreur ¬´ row is too big: size 25616, maximum size 8160 ¬ª. Si vous avez fait attention au script, vous avez pu constater que les colonnes sont d√©finies comme `NOT NULL`. Aussi, lors de la cr√©ation de la table, PostgreSQL aurait pu se rendre compte que l&#39;insertion de donn√©es serait impossible. Mais il n&#39;y a pas eu d&#39;alerte.&#xA;&#xA;## Quid des JOINs ?&#xA;&#xA;Pour simplifier, testons avec une jointure automatique :&#xA;&#xA;```sql&#xA;SELECT a.*,b.* FROM tint_1600 a, tint_1600 b;&#xA;ERROR:  target lists can have at most 1664 entries&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Maintenant, c‚Äôest la clause &lt;code&gt;SELECT&lt;/code&gt; de (&lt;code&gt;a.*,b.*&lt;/code&gt;) qui a atteint sa propre limite (&lt;code&gt;MaxTupleAttributeNumber = 1664&lt;/code&gt;).&lt;/p&gt;&#xA;&lt;h2 id=&#34;atteindre-la-limite-de-colonnes-de-maniere-inattendue&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#atteindre-la-limite-de-colonnes-de-maniere-inattendue&#34;&gt;Atteindre la limite de colonnes de mani√®re inattendue&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Il arrive que vous deviez modifier votre application, et que cela entra√Æne des modifications de sch√©ma.&lt;br&gt;&#xA;La plupart du temps, il s‚Äôagit de modifications de tables, comme l‚Äôajout ou la suppression de colonnes.&lt;/p&gt;&#xA;&lt;h3 id=&#34;explorer-add-/-drop-column&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#explorer-add-/-drop-column&#34;&gt;Explorer &lt;code&gt;ADD&lt;/code&gt; / &lt;code&gt;DROP COLUMN&lt;/code&gt;&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Voyons ce qui se passe c√¥t√© SQL lorsque nous ajoutons, puis supprimons, une colonne.&lt;/p&gt;&#xA;&lt;pre class=&#34;language-sql&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# CREATE TABLE tadc_1600(i_1 int NOT NULL);&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token keyword&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;TABLE&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# ALTER TABLE tadc_1600 ADD COLUMN i_2 int NOT NULL;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token keyword&#34;&gt;ALTER&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;TABLE&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# SELECT attname,attnum,attstorage,attnotnull,attisdropped&lt;/span&gt;&#xA;   &lt;span class=&#34;token keyword&#34;&gt;FROM&lt;/span&gt; pg_attribute&#xA;   &lt;span class=&#34;token keyword&#34;&gt;WHERE&lt;/span&gt; attrelid&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;SELECT&lt;/span&gt; oid&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;FROM&lt;/span&gt; pg_class&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;WHERE&lt;/span&gt; relname&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;tadc_1600&#39;&lt;/span&gt;&#xA;                   &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&#xA;     &lt;span class=&#34;token operator&#34;&gt;AND&lt;/span&gt; attnum &lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;BY&lt;/span&gt; attnum&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&#xA; attname &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attnum &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attstorage &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attnotnull &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attisdropped&#xA;&lt;span class=&#34;token comment&#34;&gt;---------+--------+------------+------------+--------------&lt;/span&gt;&#xA; i_1     &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f&#xA; i_2     &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f&#xA;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# ALTER TABLE tadc_1600 DROP COLUMN i_2;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token keyword&#34;&gt;ALTER&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;TABLE&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# SELECT attname,attnum,attstorage,attnotnull,attisdropped&lt;/span&gt;&#xA;   &lt;span class=&#34;token keyword&#34;&gt;FROM&lt;/span&gt; pg_attribute&#xA;   &lt;span class=&#34;token keyword&#34;&gt;WHERE&lt;/span&gt; attrelid&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;SELECT&lt;/span&gt; oid&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;FROM&lt;/span&gt; pg_class&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;WHERE&lt;/span&gt; relname&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;tadc_1600&#39;&lt;/span&gt;&#xA;                   &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&#xA;     &lt;span class=&#34;token operator&#34;&gt;AND&lt;/span&gt; attnum &lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;BY&lt;/span&gt; attnum&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&#xA;           attname            &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attnum &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attstorage &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attnotnull &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attisdropped&#xA;&lt;span class=&#34;token comment&#34;&gt;------------------------------+--------+------------+------------+--------------&lt;/span&gt;&#xA; i_1                          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f&#xA; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pg&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropped&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t&#xA;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Lors de la suppression d‚Äôune colonne, cette colonne&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;est renomm√©e en ¬´¬†. ¬ª + ¬´¬†pg.dropped.¬ª + attnum + ¬´¬†.¬†¬ª,&lt;/li&gt;&#xA;&lt;li&gt;devient NULLable,&lt;/li&gt;&#xA;&lt;li&gt;est marqu√©e comme supprim√©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 id=&#34;iterer-sur-lajout/la-suppression-de-colonnes&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#iterer-sur-lajout/la-suppression-de-colonnes&#34;&gt;It√©rer sur l‚Äôajout/la suppression de colonnes&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;On peut se demander s‚Äôil existe une limite au nombre d‚Äôop√©rations d‚Äôajout/suppression qui peuvent √™tre ex√©cut√©es sur une table donn√©e.&lt;/p&gt;&#xA;&lt;p&gt;Comme d‚Äôhabitude, testons¬†:&lt;/p&gt;&#xA;&lt;pre class=&#34;language-sql&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;-- ADD / DROP COLUMN example&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;DO&lt;/span&gt; $$&#xA;&lt;span class=&#34;token keyword&#34;&gt;DECLARE&lt;/span&gt;&#xA;    i &lt;span class=&#34;token keyword&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;DROP TABLE IF EXISTS tadc;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;CREATE TABLE tadc(i_1 int);&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;FOR&lt;/span&gt; i &lt;span class=&#34;token operator&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.1601&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&#xA;        &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;ALTER TABLE tadc ADD COLUMN i_%s int;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;        &lt;span class=&#34;token keyword&#34;&gt;EXECUTE&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;ALTER TABLE tadc DROP COLUMN i_%s;&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;LOOP&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;token keyword&#34;&gt;END&lt;/span&gt; $$&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Le r√©sultat est :&lt;/p&gt;&#xA;&lt;pre class=&#34;language-plaintext&#34;&gt;&lt;code class=&#34;language-plaintext&#34;&gt;ERROR:  tables can have at most 1600 columns&#xA;CONTEXT:  SQL statement &#34;ALTER TABLE tadc ADD COLUMN i_1601 int;&#34;&#xA;PL/pgSQL function inline_code_block line 8 at EXECUTE&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;Oh oh ! On a atteint la limite des 1¬†600 ici aussi !&lt;/p&gt;&#xA;&lt;p&gt;Explorons un peu ce qui se passe :&lt;/p&gt;&#xA;&lt;pre class=&#34;language-sql&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;# SELECT attname,attnum,attstorage,attnotnull,attisdropped&lt;/span&gt;&#xA;   &lt;span class=&#34;token keyword&#34;&gt;FROM&lt;/span&gt; pg_attribute&#xA;   &lt;span class=&#34;token keyword&#34;&gt;WHERE&lt;/span&gt; attrelid&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;SELECT&lt;/span&gt; oid&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;FROM&lt;/span&gt; pg_class&#xA;                   &lt;span class=&#34;token keyword&#34;&gt;WHERE&lt;/span&gt; relname&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;tadc&#39;&lt;/span&gt;&#xA;                   &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&#xA;     &lt;span class=&#34;token operator&#34;&gt;AND&lt;/span&gt; attnum &lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;BY&lt;/span&gt; attnum&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&#xA;&#xA;             attname             &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attnum &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attstorage &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attnotnull &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; attisdropped&#xA;&lt;span class=&#34;token comment&#34;&gt;---------------------------------+--------+------------+------------+--------------&lt;/span&gt;&#xA; i_1                             &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f&#xA; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pg&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropped&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;    &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t&#xA; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pg&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropped&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;3.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;    &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t&#xA; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pg&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropped&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;4.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;    &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t&#xA; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pg&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropped&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;5.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;    &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;token number&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t&#xA;&#xA; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pg&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropped&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1599.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;token number&#34;&gt;1599&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t&#xA; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pg&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropped&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1600.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;token number&#34;&gt;1600&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; p          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; f          &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; t&#xA;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1600&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;La table &lt;code&gt;tadc&lt;/code&gt; comporte 1¬†600 colonnes. Vous pouvez vous en apercevoir car toutes les modifications sont ajout√©es √† la table, et son contenu n‚Äôest pas r√©√©crit.&lt;/p&gt;&#xA;&lt;p&gt;Aussi, √† ce stade, toute modification suppl√©mentaire visant √† ajouter ou supprimer des colonnes sera vou√©e √† l‚Äô√©chec.&lt;/p&gt;&#xA;&lt;p&gt;Comment faire pour me sortir de cette situation¬†?&lt;/p&gt;&#xA;&lt;h4 id=&#34;le-chevalier-du-vacuum-devrait-sauver-la-princesse-postgresql-non&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#le-chevalier-du-vacuum-devrait-sauver-la-princesse-postgresql-non&#34;&gt;Le chevalier du VACUUM devrait sauver la princesse PostgreSQL, non ?&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;Et non ! La commande &lt;code&gt;VACUUM&lt;/code&gt; fonctionne au niveau du tuple, donc m√™me si vous ex√©cutez un &lt;code&gt;VACUUM FULL&lt;/code&gt;, la structure de la table ne changera pas.&lt;/p&gt;&#xA;&lt;h4 id=&#34;donc-le-dragon-a-mange-le-chevalier-que-fait-on&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#donc-le-dragon-a-mange-le-chevalier-que-fait-on&#34;&gt;Donc le dragon a mang√© le chevalier, que fait-on ?&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;Il ne s‚Äôagit pas d‚Äôun probl√®me de tuples morts, mais plut√¥t d‚Äôun probl√®me de catalogue.&lt;br&gt;&#xA;Vous devez cr√©er une nouvelle d√©finition de table.&lt;/p&gt;&#xA;&lt;p&gt;Voici quelques solutions, des plus simples aux plus complexes¬†:&lt;/p&gt;&#xA;&lt;ol class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Cr√©er une nouvelle table avec interruption de service&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;CREATE TABLE LIKE (INCLUDING ALL)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Copier (&lt;code&gt;COPY&lt;/code&gt;) les donn√©es de l‚Äôancienne table vers la nouvelle&lt;/li&gt;&#xA;&lt;li&gt;Renommer les tables&lt;/li&gt;&#xA;&lt;li&gt;Supprimer l‚Äôancienne table&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Exploiter la r√©plication logique pour minimiser les interruptions de service&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;CREATE TABLE LIKE (INCLUDING ALL)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;CREATE local PUBLICATION/SUBSCRIPTION&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Une fois les donn√©es synchronis√©es, arr√™ter/mettre en pause le service applicatif&lt;/li&gt;&#xA;&lt;li&gt;Supprimer l‚Äôabonnement&lt;/li&gt;&#xA;&lt;li&gt;Renommer les tables&lt;/li&gt;&#xA;&lt;li&gt;Red√©marrer/relancer l‚Äôapplication&lt;/li&gt;&#xA;&lt;li&gt;Supprimer l‚Äôancienne table&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 id=&#34;contactez-nous&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#contactez-nous&#34;&gt;Contactez-nous&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Vous avez d‚Äôautres id√©es pour r√©soudre ce probl√®me¬†? Vous avez trouv√© d‚Äôautres moyens √©tranges de d√©clencher cette erreur li√©e √† la limite cod√©e en dur¬†? &lt;a href=&#34;https://www.data-bene.io/en/#contact&#34; rel=&#34;noopener&#34;&gt;Contactez-nous&lt;/a&gt;¬†! Nous sommes toujours ravis d‚Äô√©changer sur PostgreSQL.&lt;/p&gt;&#xA; </content>
    <link href="http://localhost:8080/fr/blog/le-saviez-vous-les-tables-dans-postgresql-sont-limitees-a-1600-colonnes/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Gr√©gory Tiram</name>
    </author>
  </entry>
  <entry>
    <title>Statistiques cumulatives dans PostgreSQL 18</title>
    <updated>2025-09-29T00:00:00Z</updated>
    <id>tag:localhost:8080,2025-09-29:/fr/blog/statistiques-cumulatives-dans-postgresql-18/</id>
    <content type="html"> &lt;p&gt;Dans &lt;strong&gt;PostgreSQL 18&lt;/strong&gt;, le sous-syst√®me de statistiques et de supervision b√©n√©ficie d‚Äôune refonte majeure: statistiques cumulatives √©tendues, nouvelle visibilit√© I/O par backend, possibilit√© pour les extensions d‚Äôexporter / importer / ajuster les statistiques, et am√©liorations des contr√¥les GUC ainsi que du comportement de cache et de snapshot. Ces changements ouvrent de nouvelles perspectives pour l‚Äôanalyse de performance, la simulation inter-environnements et une meilleure int√©gration avec les extensions. Dans cet article, j‚Äôexplore les nouveaut√©s, les points d‚Äôattention, les param√®tres GUC, ainsi que la mani√®re dont les auteurs d‚Äôextensions peuvent exploiter la nouvelle API en C.&lt;/p&gt;&#xA;&lt;h2 id=&#34;introduction-and-motivation&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#introduction-and-motivation&#34;&gt;Introduction &amp;amp; motivation&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Les statistiques (au sens large: compteurs de supervision, m√©triques I/O, et estimations pour le planificateur / optimiseur) sont au c≈ìur √† la fois de l‚Äôoptimisation de performance et des d√©cisions internes de PostgreSQL. Des statistiques transparentes, fiables et manipulables permettent entre autres aux DBAs d‚Äôadresser directement l‚Äôefficacit√© de PostgreSQL, et donnent aux ¬´extensions¬ª la possibilit√© d‚Äôam√©liorer l‚Äôexp√©rience utilisateur.&lt;/p&gt;&#xA;&lt;p&gt;Cela dit, le syst√®me historique de statistiques de PostgreSQL n‚Äô√©tait pas exempt de frictions: capacit√© limit√©e √† r√©initialiser les statistiques des relations, m√©triques exprim√©es dans des unit√©s pas toujours align√©es avec les besoins utilisateurs, absence d‚ÄôAPI C pour utiliser le moteur de statistiques cumulatives de PostgreSQL. PostgreSQL 18 r√©pond directement √† ces pr√©occupations.&lt;/p&gt;&#xA;&lt;p&gt;Voici un r√©sum√© des am√©liorations cl√©s.&lt;/p&gt;&#xA;&lt;h2 id=&#34;un-avertissement-sur-les-statistiques&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#un-avertissement-sur-les-statistiques&#34;&gt;Un avertissement sur les statistiques&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Bien que les statistiques soient extr√™mement utiles, leur collecte peut consommer du temps et des ressources. PostgreSQL 18 introduit un point important: avec l‚Äô√©largissement du spectre des m√©triques collectables, la taille maximale de la table de hachage a √©t√© augment√©e. Gardez cela √† l‚Äôesprit, surtout si vous concevez des syst√®mes √† grande √©chelle avec des architectures ¬´un ensemble de tables par client¬ª: on a constat√© que la limite de 1 Go pouvait √™tre atteinte avec quelques millions de tables.&lt;/p&gt;&#xA;&lt;h2 id=&#34;quoi-de-neuf-dans-postgresql-18-et-les-¬´-stats-¬ª&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#quoi-de-neuf-dans-postgresql-18-et-les-¬´-stats-¬ª&#34;&gt;Quoi de neuf dans PostgreSQL 18 et les ¬´ stats ¬ª&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Voici les nouvelles fonctionnalit√©s majeures ou les am√©liorations concernant les statistiques et la supervision.&lt;/p&gt;&#xA;&lt;p&gt;De mani√®re g√©n√©rale, &lt;a href=&#34;https://www.postgresql.org/docs/18/monitoring-stats.html#MONITORING-PG-STAT-IO-VIEW&#34; rel=&#34;noopener&#34;&gt;pg_stat_io&lt;/a&gt; rapporte d√©sormais l‚Äôactivit√© I/O en octets plut√¥t qu‚Äôen pages, ce qui est plus pratique pour l‚Äôanalyse. De plus, les statistiques WAL y ont √©t√© d√©plac√©es depuis &lt;code&gt;pg_stat_wal&lt;/code&gt;, offrant ainsi une vue unique et compl√®te.&lt;/p&gt;&#xA;&lt;h3 id=&#34;mises-a-jour&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#mises-a-jour&#34;&gt;Mises √† jour&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.org/docs/18/pgupgrade.html&#34; rel=&#34;noopener&#34;&gt;pg_upgrade&lt;/a&gt; est d√©sormais capable de conserver les statistiques de l‚Äôoptimiseur, supprimant la n√©cessit√© de relancer un &lt;code&gt;ANALYZE&lt;/code&gt; complet pour obtenir de bons plans de requ√™tes apr√®s une mont√©e de version: une avanc√©e tr√®s attendue pour les grandes bases!&lt;/p&gt;&#xA;&lt;p&gt;Attention toutefois: les statistiques personnalis√©es ajout√©es par une extension ainsi que celles cr√©√©es avec &lt;a href=&#34;https://www.postgresql.org/docs/18/sql-createstatistics.html&#34; rel=&#34;noopener&#34;&gt;CREATE STATISTICS&lt;/a&gt; ne sont pas conserv√©es.&lt;/p&gt;&#xA;&lt;p&gt;Vous voudrez s√ªrement examiner les nouvelles options de &lt;a href=&#34;https://www.postgresql.org/docs/18/app-vacuumdb.html&#34; rel=&#34;noopener&#34;&gt;vacuumdb&lt;/a&gt; (&lt;code&gt;--missing-stats-only&lt;/code&gt;) pour n‚Äôanalyser que ce qui est n√©cessaire.&lt;/p&gt;&#xA;&lt;p&gt;Dans la m√™me veine, l‚Äôoption &lt;code&gt;--[no-]statistics&lt;/code&gt; a √©t√© ajout√©e √† &lt;a href=&#34;https://www.postgresql.org/docs/18/app-pgdump.html&#34; rel=&#34;noopener&#34;&gt;pg_dump&lt;/a&gt;, &lt;a href=&#34;https://www.postgresql.org/docs/18/app-pgdumpall.html&#34; rel=&#34;noopener&#34;&gt;pg_dumpall&lt;/a&gt;, et &lt;a href=&#34;https://www.postgresql.org/docs/18/app-pgrestore.html&#34; rel=&#34;noopener&#34;&gt;pg_restore&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;maintenance&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#maintenance&#34;&gt;Maintenance&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Il est d√©sormais plus simple d‚Äô√©valuer l‚Äôeffort de maintenance sur les objets, puisque le temps total pass√© dans les op√©rations VACUUM et ANALYZE (y compris&lt;br&gt;&#xA;automatiques) est rapport√© dans &lt;a href=&#34;https://www.postgresql.org/docs/18/monitoring-stats.html#MONITORING-PG-STAT-ALL-TABLES-VIEW&#34; rel=&#34;noopener&#34;&gt;pg_stat_all_tables&lt;/a&gt; et ses variantes.&lt;/p&gt;&#xA;&lt;p&gt;Un nouveau GUC √† ne pas oublier: &lt;a href=&#34;https://www.postgresql.org/docs/18/runtime-config-statistics.html#GUC-TRACK-COST-DELAY-TIMING&#34; rel=&#34;noopener&#34;&gt;track_cost_delay_timing&lt;/a&gt;. Il collecte le temps pass√© √† dormir (suite aux op√©rations retard√©es) pour &lt;code&gt;VACUUM&lt;/code&gt; et &lt;code&gt;ANALYZE&lt;/code&gt;. Tr√®s int√©ressant, mais comme les autres GUC &lt;code&gt;track_io*&lt;/code&gt;, il multiplie les appels √† l‚Äôhorloge syst√®me, ce qui peut provoquer un impact s√©v√®re sur certaines plateformes. Toujours v√©rifier avec un outil comme &lt;a href=&#34;https://www.postgresql.org/docs/18/pgtesttiming.html&#34; rel=&#34;noopener&#34;&gt;pg_test_timing&lt;/a&gt; pour s‚Äôassurer que votre syst√®me peut le supporter!&lt;/p&gt;&#xA;&lt;p&gt;Plus de questions sur l‚Äôactivit√© du checkpointer gr√¢ce √† &lt;a href=&#34;https://www.postgresql.org/docs/18/monitoring-stats.html#MONITORING-PG-STAT-CHECKPOINTER-VIEW&#34; rel=&#34;noopener&#34;&gt;pg_stat_checkpointer&lt;/a&gt;. Le nouvel attribut &lt;code&gt;num_done&lt;/code&gt; indique le nombre de checkpoints &lt;strong&gt;termin√©s&lt;/strong&gt;. Vous pouvez aussi savoir quel type de buffers a √©t√© √©crit gr√¢ce √† &lt;code&gt;slru_written&lt;/code&gt;, et &lt;code&gt;buffers_written&lt;/code&gt; qui ne concerne d√©sormais que &lt;code&gt;shared_buffers&lt;/code&gt;: auparavant, journal et vue n‚Äôaffichaient pas les m√™mes totaux, car un compteur &lt;code&gt;SLRU&lt;/code&gt; &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=17cc5f666&#34; rel=&#34;noopener&#34;&gt;existait dans un cas mais pas dans l‚Äôautre&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;analyse&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#analyse&#34;&gt;Analyse&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Envie d‚Äôen savoir plus sur l‚ÄôI/O trait√© par un backend (PID) ? Appelez &lt;a href=&#34;https://www.postgresql.org/docs/18/monitoring-stats.html#PG-STAT-GET-BACKEND-IO&#34; rel=&#34;noopener&#34;&gt;pg_stat_get_backend_io(int)&lt;/a&gt; et vous obtiendrez une sortie similaire √† la vue &lt;code&gt;pg_stat_io&lt;/code&gt;, mais pour ce processus. Pour les stats WAL de ce PID: utilisez &lt;a href=&#34;https://www.postgresql.org/docs/18/monitoring-stats.html#PG-STAT-GET-BACKEND-WAL&#34; rel=&#34;noopener&#34;&gt;pg_stat_get_backend_wal(int)&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;De nouveaux attributs &lt;code&gt;parallel_workers_to_launch&lt;/code&gt; et &lt;code&gt;parallel_workers_launched&lt;/code&gt; apparaissent dans &lt;a href=&#34;https://www.postgresql.org/docs/18/monitoring-stats.html#MONITORING-PG-STAT-DATABASE-VIEW&#34; rel=&#34;noopener&#34;&gt;pg_stat_database&lt;/a&gt;. Le ratio permet de savoir si nous avons assez de slots pour les workers parall√®les.&lt;/p&gt;&#xA;&lt;p&gt;Changements int√©ressants dans &lt;a href=&#34;https://www.postgresql.org/docs/18/pgstatstatements.html&#34; rel=&#34;noopener&#34;&gt;pg_stat_statements&lt;/a&gt;: plus de requ√™tes seront regroup√©es sous le m√™me identifiant. Par exemple, les&lt;br&gt;&#xA;motifs &lt;code&gt;IN (1,2,3, ...)&lt;/code&gt; n‚Äôutiliseront que la premi√®re et la derni√®re constante. Un changement plus contre-intuitif concerne le nom de table utilis√© dans une requ√™te: seul le nom est pris en compte, pas le sch√©ma ni l‚ÄôOID de relation. Cela permet de suivre les tables supprim√©es ou recr√©√©es, mais cela peut aussi regrouper les stats de tables sans lien ayant simplement le m√™me nom. Pour s√©parer les stats de tables homonymes, il faudra les aliaser dans les requ√™tes (&lt;code&gt;FROM my.table mt, other.table ot&lt;/code&gt;)‚Ä¶&lt;/p&gt;&#xA;&lt;p&gt;Enfin, ajouts √† &lt;a href=&#34;https://www.postgresql.org/docs/18/view-pg-backend-memory-contexts.html&#34; rel=&#34;noopener&#34;&gt;pg_backend_memory_contexts&lt;/a&gt; avec &lt;code&gt;path&lt;/code&gt; (pour r√©cup√©rer parent/enfant) et &lt;code&gt;type&lt;/code&gt; pour distinguer les contextes &lt;code&gt;AllocSet&lt;/code&gt;, &lt;code&gt;Generation&lt;/code&gt;, &lt;code&gt;Slab&lt;/code&gt; et &lt;code&gt;Bump&lt;/code&gt;‚Ä¶ Et au fait, que sont &lt;code&gt;Slab&lt;/code&gt; et &lt;code&gt;Bump&lt;/code&gt; ? Pas document√©s ; il faut &lt;a href=&#34;https://github.com/postgres/postgres/tree/master/src/backend/utils/mmgr&#34; rel=&#34;noopener&#34;&gt;lire les en-t√™tes des fichiers C ici&lt;/a&gt;. Ils existent pour optimiser l‚Äôallocation, la r√©allocation et la r√©initialisation m√©moire selon les usages attendus. Par exemple, &lt;code&gt;Slab&lt;/code&gt; est d√©fini comme un ¬´MemoryContext implementation designed for cases where large numbers of equally-sized objects can be allocated and freed efficiently with minimal memory wastage and fragmentation¬ª.&lt;/p&gt;&#xA;&lt;p&gt;Ah, non, encore une derni√®re: &lt;code&gt;wal_buffers_full&lt;/code&gt; a √©t√© ajout√© √† &lt;code&gt;pg_stat_statements&lt;/code&gt; pour permettre un meilleur r√©glage de &lt;code&gt;wal_buffers&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;replication&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#replication&#34;&gt;R√©plication&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;De meilleures informations apparaissent d√©sormais pour la gestion des conflits en r√©plication logique gr√¢ce √† de nouveaux attributs dans &lt;a href=&#34;https://www.postgresql.org/docs/18/monitoring-stats.html#MONITORING-PG-STAT-SUBSCRIPTION-STATS&#34; rel=&#34;noopener&#34;&gt;pg_stat_subscription_stats&lt;/a&gt;. En r√©f√©rence, cet extrait du &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=6c2b5edec&#34; rel=&#34;noopener&#34;&gt;commit&lt;/a&gt; liste les attributs introduits:&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;confl_insert_exists&lt;/code&gt;: nombre de fois o√π une insertion de ligne a viol√© une contrainte unique NOT DEFERRABLE.&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;confl_update_origin_differs&lt;/code&gt;: nombre de fois o√π une mise √† jour a √©t√© faite sur une ligne d√©j√† modifi√©e par une autre origine.&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;confl_update_exists&lt;/code&gt;: nombre de fois o√π la valeur mise √† jour d‚Äôune ligne viole une contrainte unique NOT DEFERRABLE.&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;confl_update_missing&lt;/code&gt;: nombre de fois o√π le tuple √† mettre √† jour est manquant.&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;confl_delete_origin_differs&lt;/code&gt;: nombre de fois o√π une suppression a √©t√© effectu√©e sur une ligne d√©j√† modifi√©e par une autre origine.&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;confl_delete_missing&lt;/code&gt;: nombre de fois o√π le tuple √† supprimer est manquant.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 id=&#34;avance&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#avance&#34;&gt;Avanc√©&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Un &lt;a href=&#34;https://www.postgresql.org/docs/18/functions-admin.html#FUNCTIONS-ADMIN-STATSMOD&#34; rel=&#34;noopener&#34;&gt;nouveau jeu de fonctions&lt;/a&gt; permet d√©sormais de g√©rer les statistiques de relations et d‚Äôattributs (&lt;code&gt;relpages&lt;/code&gt;, &lt;code&gt;avg_width&lt;/code&gt;, etc.). Cela offre la possibilit√© d‚Äôexporter, importer et ajuster les stats √† volont√©, afin de r√©pliquer le comportement du planificateur hors production, de maintenir des stats corrig√©es, et plus encore.&lt;/p&gt;&#xA;&lt;h3 id=&#34;mon-prefere-pour-les-auteurs-dextensions-la-nouvelle-api-c-de-stats&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#mon-prefere-pour-les-auteurs-dextensions-la-nouvelle-api-c-de-stats&#34;&gt;Mon pr√©f√©r√© pour les auteurs d‚Äôextensions: la nouvelle API C de stats&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;L‚Äôune des √©volutions les plus enthousiasmantes est ce que PostgreSQL 18 &lt;em&gt;ouvre&lt;/em&gt; aux auteurs d‚Äôextensions.&lt;/p&gt;&#xA;&lt;p&gt;Cette petite ligne au bas de la section &lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html#RELEASE-18-MODULES&#34; rel=&#34;noopener&#34;&gt;E.1.3.9 Modules&lt;/a&gt; est celle qui nous int√©resse :&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Allow extensions to use the server‚Äôs cumulative statistics API (Michael Paquier)&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;Jusqu‚Äôici, la manipulation des statistiques √©tait r√©serv√©e √† l‚Äôinterne ; d√©sormais, une API officielle et structur√©e est disponible pour construire (ou envelopper) autour.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=7949d9594&#34; rel=&#34;noopener&#34;&gt;message de commit&lt;/a&gt; est bien r√©dig√© et couvre l‚Äôessentiel des nouveaut√©s. Un sous-ensemble des options est &lt;a href=&#34;https://www.postgresql.org/docs/18/xfunc-c.html#XFUNC-ADDIN-CUSTOM-CUMULATIVE-STATISTICS&#34; rel=&#34;noopener&#34;&gt;d√©taill√© dans la documentation&lt;/a&gt;. Cependant, il faut encore plonger dans le code source pour en savoir plus ; en particulier, il vaut la peine de regarder l‚Äôextension &lt;code&gt;injection points&lt;/code&gt; (fournie avec PostgreSQL) qui utilise cette nouvelle API.&lt;/p&gt;&#xA;&lt;p&gt;Pour aller plus loin sur la mani√®re dont une extension peut exploiter ces nouvelles capacit√©s, vous pourrez bient√¥t d√©couvrir &lt;strong&gt;PACS (PostgreSQL Advanced Cumulative Statistics)&lt;/strong&gt; sur Codeberg : mon projet qui propose une biblioth√®que de wrappers et des utilitaires autour des nouvelles APIs de statistiques de PostgreSQL 18.&lt;/p&gt;&#xA;&lt;p&gt;En attendant, la pr√©sentation que j‚Äôai donn√©e √† &lt;a href=&#34;https://archive.fosdem.org/2025/schedule/event/fosdem-2025-4496-stats-roll-baby-stats-roll-/&#34; rel=&#34;noopener&#34;&gt;FOSDEM 2025&lt;/a&gt; explore ce sujet plus en d√©tail.&lt;/p&gt;&#xA; </content>
    <link href="http://localhost:8080/fr/blog/statistiques-cumulatives-dans-postgresql-18/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Gr√©gory Tiram</name>
    </author>
  </entry>
  <entry>
    <title>Base de donn√©es la plus d√©sir√©e trois ann√©es cons√©cutives : L&#39;attrait de PostgreSQL pour les d√©veloppeurs</title>
    <updated>2025-08-09T00:00:00Z</updated>
    <id>tag:localhost:8080,2025-08-09:/fr/blog/base-de-donnees-la-plus-desiree-trois-annees-consecutives/</id>
    <content type="html"> &lt;p&gt;PostgreSQL vit plus qu‚Äôun simple moment de gloire‚Äîelle √©tablit un sch√©ma clair d‚Äôexcellence soutenue. Pour la troisi√®me ann√©e cons√©cutive, cette base de donn√©es pilot√©e par la communaut√© a revendiqu√© la premi√®re place dans les r√©sultats 2025 de l‚Äôenqu√™te annuelle des d√©veloppeurs de Stack Overflow, et les r√©sultats r√©v√®lent √† la fois ce que les d√©veloppeurs valorisent aujourd‚Äôhui et o√π se dirige le paysage des bases de donn√©es.&lt;/p&gt;&#xA;&lt;p&gt;Les r√©sultats de l‚Äôenqu√™te montrent que PostgreSQL est class√©e au plus haut rang parmi toutes les technologies de bases de donn√©es pour les d√©veloppeurs qui veulent l‚Äôutiliser dans la prochaine ann√©e (47%) ou l‚Äôont utilis√©e cette ann√©e et veulent continuer √† l‚Äôutiliser l‚Äôann√©e prochaine (66%) pour la troisi√®me ann√©e d‚Äôaffil√©e.&lt;/p&gt;&#xA;&lt;h2 id=&#34;les-chiffres-racontent-une-histoire-convaincante&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#les-chiffres-racontent-une-histoire-convaincante&#34;&gt;Les chiffres racontent une histoire convaincante&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Les donn√©es de l‚Äôenqu√™te de plus de 49 000 d√©veloppeurs √† travers 177 pays fournissent une preuve claire de l‚Äôattrait soutenu de PostgreSQL. Depuis 2023, PostgreSQL s‚Äôest constamment class√©e comme la technologie de base de donn√©es la plus d√©sir√©e et la plus admir√©e parmi les d√©veloppeurs.&lt;/p&gt;&#xA;&lt;p&gt;En regardant les mesures sp√©cifiques des visualisations de l‚Äôenqu√™te, PostgreSQL m√®ne avec 46,5% des d√©veloppeurs voulant travailler avec elle dans l‚Äôann√©e √† venir, tandis qu‚Äôun impressionnant 65,5% de ceux qui l‚Äôont utilis√©e veulent continuer √† le faire. Ce ne sont pas seulement des chiffres impressionnants‚Äîils repr√©sentent une coh√©rence qui est rare dans le paysage technologique en rapide √©volution.&lt;/p&gt;&#xA;&lt;p&gt;Les donn√©es de l‚Äôenqu√™te r√©v√®lent √©galement un sch√©ma int√©ressant parmi les d√©veloppeurs utilisant actuellement d‚Äôautres technologies de bases de donn√©es. Les d√©veloppeurs travaillant avec MongoDB et Redis montrent un d√©sir particuli√®rement fort d‚Äôajouter PostgreSQL √† leur bo√Æte √† outils l‚Äôann√©e prochaine, voyant la valeur d‚Äôajouter des comp√©tences en bases de donn√©es relationnelles √† leur r√©pertoire.&lt;/p&gt;&#xA;&lt;h2 id=&#34;lavantage-communautaire-en-action&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#lavantage-communautaire-en-action&#34;&gt;L‚Äôavantage communautaire en action&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Pourquoi PostgreSQL a-t-elle atteint ce niveau de succ√®s soutenu ? La r√©ponse r√©side dans son mod√®le de d√©veloppement pilot√© par la communaut√©. En tant que projet open source, PostgreSQL b√©n√©ficie d‚Äôun d√©veloppement collaboratif qui est √† la fois transparent et r√©actif aux besoins du monde r√©el.&lt;/p&gt;&#xA;&lt;p&gt;Le projet PostgreSQL repr√©sente le meilleur de ce que le d√©veloppement pilot√© par la communaut√© peut accomplir. Avec plus de 400 contributeurs de code √† travers plus de 140 entreprises de soutien, le projet se vante de plus de 55 000 commits et plus de 1,6 million de lignes de code soigneusement √©labor√©. Cette approche diverse et globalement distribu√©e du d√©veloppement r√©sulte en des tests plus approfondis, des corrections de bogues plus rapides, et des fonctionnalit√©s plus innovantes que les mod√®les de d√©veloppement commercial traditionnels n‚Äôatteignent typiquement.&lt;/p&gt;&#xA;&lt;p&gt;Les versions majeures sont publi√©es annuellement avec approximativement 180 fonctionnalit√©s par version, compl√©t√©es par des versions mineures trimestrielles qui incluent de nombreuses am√©liorations et corrections. Cette cadence r√©guli√®re d‚Äôinnovation constamment contribu√©e par des individus partout dans le monde assure que PostgreSQL ne fait pas que suivre le rythme des besoins des d√©veloppeurs‚Äîelle les anticipe. Plus que cela, chaque individu a la capacit√© de contribuer au projet pour s‚Äôassurer que partout o√π le logiciel prend du retard, la fonctionnalit√© change pour r√©pondre aux demandes modernes.&lt;/p&gt;&#xA;&lt;h2 id=&#34;plus-quune-simple-base-de-donnees-relationnelle&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#plus-quune-simple-base-de-donnees-relationnelle&#34;&gt;Plus qu‚Äôune simple base de donn√©es relationnelle&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Un facteur cl√© dans l‚Äôattrait large de PostgreSQL est qu‚Äôelle n‚Äôest pas limit√©e √† √™tre juste un syst√®me de base de donn√©es relationnelle. PostgreSQL est objet-relationnelle par conception, capable de g√©rer des types de donn√©es diverses incluant JSON/JSONB, XML, Cl√©-Valeur, g√©om√©triques, g√©ospatiales, UUID natif, et donn√©es de s√©ries temporelles. Cette polyvalence explique pourquoi les d√©veloppeurs de milieux NoSQL trouvent PostgreSQL attractive‚Äîelle offre la fiabilit√© relationnelle tout en maintenant la flexibilit√© √† laquelle ils sont habitu√©s.&lt;/p&gt;&#xA;&lt;p&gt;Le soutien √©tendu pour diff√©rents types de donn√©es, combin√© avec les caract√©ristiques ACID (Atomicit√©, Coh√©rence, Isolation, Durabilit√©), permet une gestion de donn√©es optimis√©e, performante, et fiable ind√©pendamment des exigences sp√©cifiques en place. De plus, l‚Äô√©norme r√©seau d‚Äôextensions pilot√© par la communaut√© de PostgreSQL s‚Äôappuie sur son extensibilit√© native, fournissant des solutions pour la gestion g√©ospatiale, la r√©cup√©ration apr√®s sinistre, l‚Äôinfrastructure de haute disponibilit√©, la surveillance, l‚Äôaudit, et bien plus.&lt;/p&gt;&#xA;&lt;h2 id=&#34;le-paysage-plus-large-des-bases-de-donnees&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#le-paysage-plus-large-des-bases-de-donnees&#34;&gt;Le paysage plus large des bases de donn√©es&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Tandis que PostgreSQL domine les positions de t√™te, l‚Äôenqu√™te r√©v√®le un √©cosyst√®me de bases de donn√©es sain et comp√©titif. Les classements complets montrent :&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Bases de donn√©es les plus d√©sir√©es :&lt;/strong&gt;&lt;br&gt;&#xA;‚Ä¢ PostgreSQL : 46,5%&lt;br&gt;&#xA;‚Ä¢ SQLite : 28,3%&lt;br&gt;&#xA;‚Ä¢ Redis : 23,5%&lt;br&gt;&#xA;‚Ä¢ MySQL : 20,5%&lt;br&gt;&#xA;‚Ä¢ MongoDB : 17,6%&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Bases de donn√©es les plus admir√©es :&lt;/strong&gt;&lt;br&gt;&#xA;‚Ä¢ PostgreSQL : 65,5%&lt;br&gt;&#xA;‚Ä¢ SQLite : 59%&lt;br&gt;&#xA;‚Ä¢ Redis : 54,9%&lt;br&gt;&#xA;‚Ä¢ MongoDB : 45,7%&lt;br&gt;&#xA;‚Ä¢ MySQL : 43,2%&lt;/p&gt;&#xA;&lt;p&gt;Ces chiffres refl√®tent un √©cosyst√®me diversifi√© o√π diff√©rentes bases de donn√©es servent des objectifs sp√©cifiques. La forte performance de SQLite souligne l‚Äôimportance continue des solutions l√©g√®res et int√©gr√©es. Redis maintient sa position comme une base de donn√©es sp√©cialis√©e hautement consid√©r√©e pour la mise en cache et les applications temps r√©el. Les bases de donn√©es traditionnelles comme MySQL et Microsoft SQL Server continuent de d√©tenir des positions significatives, tandis que les nouvelles technologies comme DuckDB montrent des scores d‚Äôadmiration impressionnants malgr√© des taux d‚Äôutilisation plus faibles.&lt;/p&gt;&#xA;&lt;h2 id=&#34;la-fondation-du-succes-durable-de-postgresql&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#la-fondation-du-succes-durable-de-postgresql&#34;&gt;La fondation du succ√®s durable de PostgreSQL&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Trois ann√©es cons√©cutives au sommet des pr√©f√©rences des d√©veloppeurs n‚Äôarrive pas par accident. La domination soutenue de PostgreSQL d√©coule de forces fondamentales qui continuent de bien servir les d√©veloppeurs alors que les paysages technologiques changent. La r√©silience int√©gr√©e dans PostgreSQL √† travers son mod√®le de d√©veloppement pilot√© par la communaut√© signifie qu‚Äôelle s‚Äôadapte sans perdre la stabilit√©. Son extensibilit√© la distingue de mani√®res pratiques‚Äîplut√¥t que d‚Äôattendre les feuilles de route des fournisseurs ou de s‚Äôinqui√©ter des lacunes de fonctionnalit√©s, les d√©veloppeurs peuvent construire ce dont ils ont besoin ou tirer parti de l‚Äô√©cosyst√®me √©tendu d‚Äôextensions communautaires. La nature open source assure que PostgreSQL reste focalis√©e sur les besoins des d√©veloppeurs plut√¥t que sur les mod√®les d‚Äôaffaires, avec des corrections de bogues qui se produisent rapidement et des fonctionnalit√©s qui se d√©veloppent bas√©es sur des cas d‚Äôusage du monde r√©el.&lt;/p&gt;&#xA;&lt;p&gt;Apr√®s 35 ans de d√©veloppement actif et trois ann√©es cons√©cutives comme la technologie de base de donn√©es la plus d√©sir√©e, PostgreSQL a prouv√© que le d√©veloppement open source pilot√© par la communaut√© peut livrer √† la fois une utilit√© imm√©diate et une valeur √† long terme. Pour les d√©veloppeurs et organisations regardant leurs choix de bases de donn√©es, PostgreSQL offre quelque chose d‚Äôincreasingly rare : une technologie qui s‚Äôam√©liore avec le temps sans laisser ses utilisateurs derri√®re.&lt;/p&gt;&#xA; </content>
    <link href="http://localhost:8080/fr/blog/base-de-donnees-la-plus-desiree-trois-annees-consecutives/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Gr√©gory Tiram</name>
    </author>
  </entry>
  <entry>
    <title>Retour de HOW2025</title>
    <updated>2025-07-14T00:00:00Z</updated>
    <id>tag:localhost:8080,2025-07-14:/fr/blog/retour-de-how2025/</id>
    <content type="html"> &lt;p&gt;Les 27 et 28 juin se tenaient les conf√©rences Highgo Open World, consacr√©es √† l‚Äô√©cosyst√®me PostgreSQL et au projet IvorySQL. C√¥t√© chiffres, le succ√®s est notable‚ÄØ: pr√®s de 1‚ÄØ000 participants sur place, jusqu‚Äô√† 8‚ÄØ000 connexions simultan√©es sur les streams, et environ 25‚ÄØ000 spectateurs au total.&lt;/p&gt;&#xA;&lt;p&gt;Le programme comptait 101 conf√©rences techniques anim√©es par 105 intervenants. La majorit√© des sessions √©taient en mandarin, avec un track anglophone propos√© en traduction simultan√©e. Vous pouvez consulter le programme complet sur &lt;a href=&#34;https://ivorysql.io/schedule/&#34; rel=&#34;noopener&#34;&gt;IvorySQL.io&lt;/a&gt; et retrouver les replays sur Weibo via &lt;a href=&#34;https://ivorysql.io/2025/06/27/live-access-june27/&#34; rel=&#34;noopener&#34;&gt;ce lien.&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Nous √©tions un petit groupe de la communaut√© internationale pr√©sents, dont &lt;a href=&#34;https://postgresql.life/post/grant_zhou/&#34; rel=&#34;noopener&#34;&gt;Grant Zhou&lt;/a&gt; qui assure entre autre la liaison et la collaboration avec l‚Äôassociation PostgreSQL en Chine et dans le reste du monde.&lt;/p&gt;&#xA;&lt;p&gt;Sur le plan technique, le contenu √©tait dense et particuli√®rement int√©ressant. J‚Äôai retenu notamment‚ÄØ:&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;La pr√©sentation d‚ÄôAlena Rybakina sur le planificateur de requ√™tes PostgreSQL et les strat√©gies pour contourner certaines limites.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Un focus clair et concret sur Patroni (Haute-Disponibilit√©) par Alexander Kukushkin et Polina Bungina.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Florentz Tselai a pr√©sent√© 2 sujets en appliquant ses pr√©ceptes: simplicit√© efficacit√©, sur l‚Äôutilisation de ¬´l‚ÄôIA¬ª avec PostgreSQL et la gestion des donn√©es avec comme support Sun Tzu et les 36 stratag√®mes.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;√âgalement une tr√®s bonne introduction √† Bazel et son utilisation pour Monogres (√† d√©couvrir bient√¥t) pr√©sent√© avec √©nergie par Alvaro Hernandez.&lt;/p&gt;&#xA;&lt;p&gt;Monogres est une initiative tr√®s int√©ressante qui doit permettre de renforcer le contr√¥le de la supply chain logicielle, un th√®me  majeur dans l‚ÄôIT de nos jours. Et j‚Äôy ai aussi vu une tr√®s belle occasion d‚Äôoffrir une vitrine a des variations de PostgreSQL avec des fonctionnalit√©s et des correctifs dont l‚Äôinclusion dans PostgreSQL lui-m√™me m√™me ou le backport dans des version majeures pr√©c√©dentes n‚Äôest pas toujours possible.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Michael Meskes avait l‚Äôhonneur d‚Äôune conf√©rence pl√©ni√®re pour un sujet qui le m√©rite largement: ¬´ From Code to Commerce: Open Source Business Models Today ¬ª, une keynote sur l‚Äôopen-source et les logiciels libres, appliqu√©s √† l‚Äô√©cosyst√®me PostgreSQL.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Mon coll√®gue Andrea a pr√©sent√© les √©volutions et les tendances des entreprises pour transiter vers IvorySQL et PostgreSQL&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Pour ma part, j‚Äôai pr√©sent√© linux PSI dans le contexte PostgreSQL.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Comme tout est en streaming, je vous encourage √† aller explorer et visionner les sujets qui vous int√©ressent. Il y a ausi des conf√©rences en anglais pr√©-enregistr√©es mais j‚Äôavoue avoir profit√© des cr√©neaux pour √©changer avec des participants.&lt;/p&gt;&#xA;&lt;p&gt;En appart√© des conf√©rences, j‚Äôai eu la chance de rencontrer plusieurs membres de la communaut√© PostgreSQL chinoise tr√®s r√©put√©s pour leur implication dans le succ√®s de PostgreSQL localement. J‚Äôai eu aussi l‚Äôoccasion d‚Äôen apprendre d‚Äôavantage sur Cloudberry, en remplacement de Greenplum, merci Dianjin Wang!&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;Pour Data Bene s‚Äô√©tait √©galement un moment pr√©vu pour rencontrer l‚Äô√©quipe en charge d‚ÄôIvorySQL, bas√©e en grande partie dans le Shandong, la province o√π se trouve Jinan, ville h√¥te des conf√©rences. Ivory est un projet auquel nous participons activement et qui permet aux entreprises de s‚Äôaffranchir d‚ÄôOracle ¬´en douceur¬ª. C‚Äôest un sujet important pour nos clients et qui occupe un place pr√©pond√©rante dans notre partenariat avec Highgo: ils portent ce projet depuis plusieurs ann√©es d√©j√† et nous voulons permettre aux entreprises europ√©enes d‚Äôen profiter avec un accompagnement et expertise adapt√©e.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;Les conf√©rences √©taient tr√®s bien organis√©es et l‚Äôacceuil formidable, le ¬´Social Event¬ª au ¬´beer garden¬ª local parfaitement adapt√© √† la chaleur de Jinan fin juin!&lt;/p&gt;&#xA;&lt;p&gt;Vu le programme des conf√©rences j‚Äôai am√®rement regret√© de ne rien comprendre (Il y avait 1 track en Anglais et 5 en Mandarin) ‚Ä¶ mais il se dit d√©j√† que l‚Äôan prochain les conf√©rences en Mandarin pourraient peut √™tre √™tre traduites (en anglais), et la date avanc√©e en Mai pour profiter d‚Äôun climat plus doux.&lt;/p&gt;&#xA;&lt;p&gt;Il y a tellement √† y apprendre que j‚Äôy retournerai avec grand plaisir.&lt;/p&gt;&#xA; </content>
    <link href="http://localhost:8080/fr/blog/retour-de-how2025/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Gr√©gory Tiram</name>
    </author>
  </entry>
  <entry>
    <title>Suivons le P√®re No√´l avec PostGIS ‚Äì v2</title>
    <updated>2025-12-10T10:23:08Z</updated>
    <id>tag:blog.arthurbazin.com,2025-12-10:/programmation/sql/suivons-le-pere-noel-avec-postgis</id>
    <content type="html">&#xA;&lt;p&gt;Depuis quelques ann√©es, je d√©veloppe un syst√®me de suivi du P√®re No√´l. Comme j&amp;rsquo;ai ¬´¬†quelques notions¬†¬ª de SQL et de d√©veloppement web SIG, j&amp;rsquo;ai tous les outils n√©cessaires √† une telle application sous la main.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;J&amp;rsquo;avais d√©j√† con√ßu une premi√®re version d√©taill√©e dans &lt;a href=&#34;https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis&#34; data-type=&#34;post&#34; data-id=&#34;2420&#34;&gt;cet article d√©di√©&lt;/a&gt;, nous voila reparti pour un nouveau No√´l avec un suivi am√©lior√©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;hr class=&#34;wp-block-separator has-alpha-channel-opacity is-style-default&#34;/&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le suivi, j&amp;rsquo;ai un peu √©tudier la chose et il s&amp;rsquo;av√®re qu&amp;rsquo;un traineau magique, √ßa n‚Äôapparait pas sur les radars. Il est donc compliqu√© de suivre le bonhomme. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Malgr√© mes nombreux courriers, le P√®re No√´l refuse √©galement de m&amp;rsquo;envoyer son itin√©raire d√©taill√©, un petit GPX aurait pourtant bien fait mon affaire mais il semble qu&amp;rsquo;il n&amp;rsquo;utilise pas de GPS&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut donc un peu ruser pour suivre Santa √† la trace et voici comment j&amp;rsquo;ai proc√©d√©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le principe est de partir d&amp;rsquo;une liste de destinations que le P√®re No√´l va visiter. On calcule ensuite le trajet pour rejoindre toutes ces destinations en tenant compte du fait que le passage doit s&amp;rsquo;effectuer durant la nuit du 24 au 25 d√©cembre, et entre minuit et 1h du matin en tenant compte de chaque fuseau horaire. Plus facile √† dire qu&amp;rsquo;a faire mais essayons.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;application repose sur PostgreSQL 15 + PostGIS 3.5.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;iframe id=&#34;santa_app&#34;&#xA;  title=&#34;Application de suivi du P√®re No√´l&#34;&#xA;  width=&#34;100%&#34;&#xA;  height=&#34;800px&#34;&#xA;  src=&#34;https://santa.arxit.com/&#34;&gt;&#xA;&lt;/iframe&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-16018d1d wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://santa.arxit.com/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Voir l&amp;rsquo;application en pleine page&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;hr class=&#34;wp-block-separator has-alpha-channel-opacity is-style-default&#34;/&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que cet article s‚Äôint√©resse √† la partie donn√©e (PostgreSQL + PostGIS) et non √† la partie conception de l&amp;rsquo;application web SIG.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Destinations&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A priori, le P√®re No√´l visite toutes les maisons du monde. Ceci dit, ¬´¬†toutes les maisons du monde¬†¬ª c&amp;rsquo;est complexe √† cartographier : un igloo doit il √™tre consid√©r√© comme une maison m√™me s&amp;rsquo;il n&amp;rsquo;a pas de chemin√©e ? &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Alors simplifions un peu la chose et basons nous sur l&amp;rsquo;ensemble des villes du monde. Bon l√† aussi c&amp;rsquo;est complexe car il y a vraiment beaucoup de villes et √ßa risque d&amp;rsquo;√™tre difficile de suivre tous les d√©placements. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Simplifions encore et prenons environ 1000 destinations parmi les plus connues dans le monde (avec peut √™tre une sur repr√©sentation des villes de l‚Äôhexagone ;-).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour r√©cup√©rer ces donn√©es, une petite recherche sur internet et nous voila avec &lt;a rel=&#34;noreferrer noopener nofollow&#34; href=&#34;https://public.opendatasoft.com/explore/dataset/geonames-all-cities-with-a-population-1000/&#34; target=&#34;_blank&#34;&gt;un magnifique jeu de donn√©es&lt;/a&gt; du monde entier dont la population est sup√©rieure √† 1000 habitants.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quelques traitements plus tard (rien de bien sorcier, juste des formules magiques pour r√©cup√©rer les villes qui m&amp;rsquo;int√©ressent) nous voici avec la table suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE IF NOT EXISTS santa.destination (&#xA;&#x9;-- Un identifiant num√©rique&#xA;&#x9;id_destination int8 PRIMARY KEY,&#xA;&#x9;-- Le pays de la destination&#xA;&#x9;pays text,&#xA;&#x9;-- La r√©gion de la destination&#xA;&#x9;region text,&#xA;&#x9;-- Le nom de la destination&#xA;&#x9;ville text,&#xA;&#x9;-- Le nombre d&#39;habitant dans cette destination&#xA;&#x9;population int8,&#xA;&#x9;-- L&#39;interval de temps entre le fuseau horaire de la destination et GMT&#xA;&#x9;utc_offset interval,&#xA;&#x9;-- Nom de la timezone&#xA;&#x9;timezone text,&#xA;&#x9;-- L&#39;emplacement de la destination&#xA;&#x9;geom public.geometry(point, 4326)&#xA;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Probl√®me, cette table ne poss√®de pas l&amp;#8217;emplacement du P√®re No√´l&amp;#8230; Nous allons rus√© pour cela.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Quelques variables&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour les diff√©rents calculs que nous allons mener, je vais avoir besoin de d√©finir certains param√®tres. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Parmi ces variables les √©l√©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La population totale&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le nombre de cadeaux par personne&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le pourcentage de personnes recevant un cadeau (et oui, tout le monde n&amp;rsquo;est pas sage&amp;#8230;)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;#8217;emplacement du P√®re No√´l&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La date et l&amp;rsquo;heure du d√©but de la tourn√©e : le 25 d√©cembre √† minuit dans le premier fuseau horaire (GMT +13)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;instant pr√©sent : &lt;code&gt;transaction_timestamp()&lt;/code&gt;, cela permet d&amp;rsquo;effectuer des test en faisant varier cette valeur.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour stocker des param√®tres, j&amp;rsquo;utilise souvent une vue effectuant un simple &lt;code&gt;SELECT&lt;/code&gt; que j&amp;rsquo;utilise ensuite dans mes diff√©rentes requ√™tes via un &lt;code&gt;CROSS JOIN&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_variable as (&#xA;&#x9;SELECT &#xA;&#x9;&#x9;-- Population&#xA;&#x9;&#x9;-- Le nombre total d&#39;√™tre humain sur Terre&#xA;&#x9;&#x9;8142000000 as pop_total,&#xA;&#x9;&#x9;-- Le pourcentage de personne recevant des cadeaux (oui, certains ont √©t√© m√©chants cette ann√©e)&#xA;&#x9;&#x9;0.95 as cadeau_par_pop,&#xA;&#x9;&#x9;-- Le nombre de cadeau par personnes&#xA;&#x9;&#x9;1 as cadeau_par_pers,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;-- Autres donn√©es&#xA;&#x9;&#x9;-- Le pourcentage de temps total pass√© √† voler de maison en maison (ici 40% de temps de vol donc 60% du temps pass√© dans les maisons)&#xA;&#x9;&#x9;40::numeric as pourcent_temps_de_vol,&#xA;&#x9;&#x9;-- Les informations sur l&#39;emplacement de la maison du P√®re No√´l&#xA;&#x9;&#x9;jsonb_build_object(&#xA;&#x9;&#x9;&#x9;&#39;id&#39;, 0,&#xA;&#x9;&#x9;&#x9;&#39;pays&#39;, &#39;Svalbard&#39;,&#xA;&#x9;&#x9;&#x9;&#39;region&#39;, &#39;Longyearbyen&#39;,&#xA;&#x9;&#x9;&#x9;&#39;ville&#39;, &#39;Maison de la famille No√´l&#39;,&#xA;&#x9;&#x9;&#x9;&#39;population&#39;, 2,&#xA;&#x9;&#x9;&#x9;&#39;timezone&#39;, &#39;Europe/Paris&#39;,&#xA;&#x9;&#x9;&#x9;&#39;utc_offset&#39;, &#39;01:00:00&#39;,&#xA;&#x9;&#x9;&#x9;&#39;geom_4326&#39;, &#39;SRID=4326;POINT(24 80)&#39;&#xA;&#x9;&#x9;) as maison_pere_noel,&#xA;&#xA;&#x9;&#x9;-- Paroles du P√®re No√´l&#xA;&#x9;&#x9;$${&#xA;&#x9;&#x9;&#x9;&#34;Pr√©paratifs&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Vive le vent d&#39;hiver !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum ?!&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Quel beau camion !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Ah, une belle poup√©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Vive le vent d&#39;hiver !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum ?!&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Quel beau camion !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Ah, une belle poup√©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;D√©marrage tourn√©e&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux No√´l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez com√®te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux No√´l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez com√®te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Trajet&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux No√´l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez com√®te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux No√´l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez com√®te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Distribution&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh hisse !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Serr√©e cette chemin√©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Chut, pas un bruit !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum un petit biscuit...&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh hisse !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Serr√©e cette chemin√©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Chut, pas un bruit !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum un petit biscuit...&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Fin tourn√©e&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux No√´l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez com√®te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux No√´l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez com√®te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Repos&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;RONFFFFFFFLE&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;RONFFFFFFFLE&#34;&#xA;&#x9;&#x9;&#x9;]&#xA;&#x9;&#x9;}$$::jsonb as parole_pere_noel,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;-- Dates et horaire&#xA;&#x9;&#x9;-- Les dates contiennent toujours les heures&#xA;&#x9;&#x9;-- L&#39;heure exacte du d√©but de la distribution (le 25 d√©cembre √† minuit sur le premier fuseau horaire)&#xA;&#x9;&#x9;-- Le P√®re No√´l met 1h pour distribuer les cadeau par fuseau horaire sauf si un fuseau interm√©diaire existe&#xA;&#x9;&#x9;(extract(year from now()) || &#39;-12-25 00:00:00 +13&#39;)::timestamp with time zone as debut_distrib,&#xA;&#xA;&#x9;&#x9;-- Dur√©e du trajet pour rejoindre la premi√®re destination depuis la maison du P√®re No√´l&#xA;&#x9;&#x9;-- Dur√©e √©galement pour rejoindre la maison du P√®re No√´l depuis la derni√®re maison&#xA;&#x9;&#x9;&#39;2 minutes&#39;::interval as delai_dest_santa_house,&#xA;&#xA;&#x9;&#x9;-- Heure du d√©but de la transaction&#xA;&#x9;&#x9;transaction_timestamp() as &#34;now&#34;&#x9;-- Maintenant&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Trajet&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous devons maintenant calculer le trajet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce trajet doit r√©pondre aux crit√®res suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Passer par toutes les destinations&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;D√©marrer et finir par la maison du P√®re No√´l&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Chaque destination doit √™tre entre minuit et 1h du matin pour le fuseau horaire consid√©r√©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons donc devoir d√©couper la Terre en zones de passage dans lesquelles le P√®re No√´l aura un timing bien sp√©cifique √† respecter. Le principe est de d√©terminer l&amp;rsquo;intervalle de temps pendant lequel le P√®re No√´l effectue sa tourn√©e puis de diviser cet intervalle par le nombre de zones de passage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour calculer le trajet et pouvoir relancer le calcul facilement, je vais me baser sur plusieurs vues.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Calcul des zones horaires&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le principe est d&amp;rsquo;attribuer √† chaque destination un num√©ro de rang et une dur√©e de passage en fonction de son fuseau horaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela on se base sur la valeur de la colonne utc_offset qui contient le d√©calage horaire avec GMT ainsi que plusieurs fonction de fen√™trage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_destination_zone_horaire as (&#xA;&#x9;-- Clause CTE pour r√©cup√©rer une liste d&#39;offset UTC accompagn√© de l&#39;offset suivant&#xA;&#x9;WITH utc_offset_list AS (&#xA;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;dest.utc_offset,&#xA;&#x9;&#x9;&#x9;-- R√©cup√©ration de l&#39;offset suivant&#xA;&#x9;&#x9;&#x9;lead(utc_offset) OVER (ORDER BY utc_offset) AS next_utc_offset&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa.destination as dest&#xA;&#x9;&#x9;GROUP BY &#xA;&#x9;&#x9;&#x9;dest.utc_offset&#xA;&#x9;)&#xA;&#x9;SELECT &#xA;&#x9;&#x9;dense_rank() OVER zone_globale as rang_zone_horaire,&#xA;&#x9;&#x9;dest.pays,&#xA;&#x9;&#x9;dest.region,&#xA;&#x9;&#x9;dest.ville,&#xA;&#x9;&#x9;dest.timezone,&#xA;&#x9;&#x9;dest.utc_offset,&#xA;&#x9;&#x9;-- Dur√©e de passage dans la zone par soustraction de la valeur de l&#39;offset suivant&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;WHEN uol.next_utc_offset IS NULL THEN &#39;01:00:00&#39;::INTERVAL&#xA;&#x9;&#x9;&#x9;ELSE uol.next_utc_offset - dest.utc_offset&#xA;&#x9;&#x9;END duree_zone,&#xA;&#x9;&#x9;-- Valeur par d√©faut pour la population&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;WHEN dest.population IS NULL OR dest.population &amp;lt; 10 THEN 10&#xA;&#x9;&#x9;&#x9;ELSE dest.population&#xA;&#x9;&#x9;END as population,&#xA;&#x9;&#x9;-- Nombre de destination dans la zone horaire&#xA;&#x9;&#x9;count(id_destination) OVER zone_horaire as nb_dest_zone_horaire,&#xA;&#x9;&#x9;-- Coordnn√©es Y minimum et maximum de chaque pays (pour l&#39;ordonnancement)&#xA;&#x9;&#x9;first_value(ST_Y(dest.geom)) OVER pays as miny_pays,&#xA;&#x9;&#x9;last_value(ST_Y(dest.geom)) OVER pays as maxy_pays,&#xA;&#x9;&#x9;geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.destination as dest&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;LEFT JOIN &#xA;&#x9;&#x9;utc_offset_list AS uol&#xA;&#x9;&#x9;ON uol.utc_offset = dest.utc_offset &#xA;&#x9;WINDOW &#xA;&#x9;&#x9;zone_globale AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;dest.utc_offset DESC&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;zone_horaire AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;&#x9;dest.utc_offset&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;dest.utc_offset DESC&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;pays AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;&#x9;dest.utc_offset,&#xA;&#x9;&#x9;&#x9;&#x9;dest.pays&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;ST_Y(dest.geom)&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;&#x9;)&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Ordonnancement par latitude&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Au sein de chaque zone horaire, les destinations sont ordonnanc√©es afin d&amp;rsquo;avoir un trajet coh√©rent allant du nord au sud dans une zone puis du sud au nord dans la zone suivante dans un mouvement √† l&amp;rsquo;effet ¬´¬†yoyo¬†¬ª. Les destinations sont √©galement regroup√©es par pays : on commence par le pays le plus Nord puis celui juste apr√®s&amp;#8230; &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La g√©n√©ration d&amp;rsquo;un identifiant sp√©cifique permettra d‚Äôordonnancer les destination.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_destination_ordonnees as (&#xA;&#x9;SELECT &#xA;&#x9;&#x9;-- R√©cup√©ration du rang de chaque destination au sein de sa zone de longitude&#xA;&#x9;&#x9;-- Le rang est d√©termin√© par la latitude de l&#39;objet&#xA;&#x9;&#x9;-- Pour faire un effet &#34;yoyo&#34;, on inverse l&#39;ordonnancement des latitudes une zone horaire sur deux&#xA;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#39;-&#39;,&#xA;&#x9;&#x9;&#x9;lpad((vdzh.rang_zone_horaire)::text, 2, &#39;0&#39;),&#xA;&#x9;&#x9;&#x9;lpad((row_number() OVER zone_horaire)::text, 3, &#39;0&#39;)&#xA;&#x9;&#x9;) as id,&#xA;&#x9;&#x9;vdzh.pays,&#xA;&#x9;&#x9;vdzh.region,&#xA;&#x9;&#x9;vdzh.ville,&#xA;&#x9;&#x9;vdzh.timezone,&#xA;&#x9;&#x9;vdzh.utc_offset,&#xA;&#x9;&#x9;vdzh.duree_zone,&#xA;&#x9;&#x9;vdzh.population,&#xA;&#x9;&#x9;-- Cr√©ation d&#39;une valeur de population fictive&#xA;&#x9;&#x9;-- pour qu&#39;une fois toutes destination visit√©es, le P√®re No√´l ait vu toute la population mondiale&#xA;&#x9;&#x9;round( &#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(vdzh.population / sum(vdzh.population) OVER ()) &#xA;&#x9;&#x9;&#x9;&#x9;* var.pop_total::NUMERIC&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;0 &#xA;&#x9;&#x9;) as pop_fictive,&#xA;&#x9;&#x9;vdzh.nb_dest_zone_horaire,&#xA;&#x9;&#x9;ST_Transform(vdzh.geom, 3857) as geom&#xA;&#x9;FROM&#xA;&#x9;&#x9;santa.v_destination_zone_horaire as vdzh&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;WINDOW&#xA;&#x9;&#x9;zone_horaire AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;&#x9;vdzh.utc_offset&#xA;&#x9;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN rang_zone_horaire % 2 = 0 THEN miny_pays&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE -maxy_pays&#xA;&#x9;&#x9;&#x9;&#x9;END,&#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN rang_zone_horaire % 2 = 0 THEN ST_Y(vdzh.geom)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE -ST_Y(vdzh.geom)&#xA;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Consolidation des destinations&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque destination, on va calculer plusieurs valeurs, notamment les valeurs des destinations suivantes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette vue est une sorte de version am√©lior√©e de la table &lt;code&gt;destination&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_destination_globale as (&#xA;&#x9;SELECT &#xA;&#x9;&#x9;vdo.id,&#xA;&#x9;&#x9;vdo.pays,&#xA;&#x9;&#x9;vdo.region,&#xA;&#x9;&#x9;vdo.ville,&#xA;&#x9;&#x9;-- Le fen√™trage permet de r√©cup√©rer la prochaine destination&#xA;&#x9;&#x9;lead (vdo.pays) OVER all_etape as pays_next,&#xA;&#x9;&#x9;lead (vdo.region) OVER all_etape as region_next,&#xA;&#x9;&#x9;lead (vdo.ville) OVER all_etape as ville_next,&#xA;&#x9;&#x9;vdo.timezone,&#xA;&#x9;&#x9;vdo.utc_offset,&#xA;&#x9;&#x9;lead (vdo.utc_offset) OVER all_etape as utc_offset_next,&#xA;&#x9;&#x9;vdo.duree_zone,&#xA;&#x9;&#x9;(vdo.duree_zone / vdo.nb_dest_zone_horaire) AS duree_destination,&#xA;&#x9;&#x9;vdo.population,&#xA;&#x9;&#x9;vdo.pop_fictive,&#xA;&#x9;&#x9;vdo.nb_dest_zone_horaire,&#xA;&#x9;&#x9;vdo.geom,&#xA;&#x9;&#x9;-- Le fen√™trage permet de r√©cup√©rer la g√©om√©trie de la prochaine destination&#xA;&#x9;&#x9;lead(vdo.geom) OVER all_etape as geom_next&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.v_destination_ordonnees as vdo&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;all_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;vdo.id&#xA;&#x9;&#x9;)&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;√âtapes de distribution&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A partir des donn√©es des destination, on g√©n√®re des √©tapes de distribution des cadeaux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pendant ces √©tapes, le P√®re No√´l s&amp;rsquo;arr√™te dans la destination et distribue les pr√©sents.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_etape_distribution as (&#xA;&#x9;SELECT &#xA;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#39;-&#39;,&#xA;&#x9;&#x9;&#x9;vdg.id,&#xA;&#x9;&#x9;&#x9;&#39;d&#39;&#xA;&#x9;&#x9;) as id,&#xA;&#x9;&#x9;&#39;Distribution&#39; as type_etape,&#xA;&#x9;&#x9;vdg.pays,&#xA;&#x9;&#x9;vdg.region,&#xA;&#x9;&#x9;vdg.ville,&#xA;&#x9;&#x9;-- S&#39;il n&#39;y a pas de prochaine destination, alors on retourne chez le P√®re No√´l&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;vdg.pays_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;pays&#39;&#xA;&#x9;&#x9;) as pays_next,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;vdg.region_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39;&#xA;&#x9;&#x9;) as region_next,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;vdg.ville_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39;&#xA;&#x9;&#x9;) as ville_next,&#xA;&#x9;&#x9;vdg.timezone,&#xA;&#x9;&#x9;vdg.utc_offset,&#xA;&#x9;&#x9;vdg.utc_offset_next,&#xA;&#x9;&#x9;vdg.duree_destination,&#xA;&#x9;&#x9;vdg.duree_destination * (1 - (var.pourcent_temps_de_vol / 100)) AS duree_etape,&#xA;&#x9;&#x9;vdg.population,&#xA;&#x9;&#x9;vdg.pop_fictive,&#xA;&#x9;&#x9;-- Nombre de cadeaux distribu√©s&#xA;&#x9;&#x9;round( var.cadeau_par_pop * vdg.pop_fictive::numeric * var.cadeau_par_pers, 0) AS cadeau_distribue,&#xA;&#x9;&#x9;vdg.geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.v_destination_globale as vdg&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;√âtapes de trajet&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A partir des donn√©es des destination, on g√©n√®re √©galement des √©tapes de trajet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pendant ces √©tapes, le P√®re No√´l vol √† bord de son traineau de destination en destination.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_etape_trajet as (&#xA;&#x9;SELECT &#xA;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#39;-&#39;,&#xA;&#x9;&#x9;&#x9;vdg.id,&#xA;&#x9;&#x9;&#x9;&#39;t&#39;&#xA;&#x9;&#x9;) as id,&#xA;&#x9;&#x9;&#39;Trajet&#39; as type_etape,&#xA;&#x9;&#x9;vdg.pays,&#xA;&#x9;&#x9;vdg.region,&#xA;&#x9;&#x9;vdg.ville,&#xA;&#x9;&#x9;vdg.pays_next,&#xA;&#x9;&#x9;vdg.region_next,&#xA;&#x9;&#x9;vdg.ville_next,&#xA;&#x9;&#x9;vdg.timezone,&#xA;&#x9;&#x9;vdg.utc_offset,&#xA;&#x9;&#x9;vdg.utc_offset_next,&#xA;&#x9;&#x9;vdg.duree_destination,&#xA;&#x9;&#x9;-- La dur√©e du vol d√©pend de la distance entre la destination et la suivante&#xA;&#x9;&#x9;-- ainsi, la vitesse de vol est constante dans une zone horaire&#xA;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;vdg.duree_zone &#xA;&#x9;&#x9;&#x9;* (var.pourcent_temps_de_vol / 100) &#xA;&#x9;&#x9;&#x9;* (&#xA;&#x9;&#x9;&#x9;&#x9;ST_Length(ST_MakeLine(vdg.geom, vdg.geom_next)) &#xA;&#x9;&#x9;&#x9;&#x9;/ sum(ST_Length(ST_MakeLine(vdg.geom, vdg.geom_next))) OVER zone_horaire&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9; ) as duree_etape,&#xA;&#x9;&#x9;ST_Length(ST_MakeLine(vdg.geom, vdg.geom_next)) as distance,&#xA;&#x9;&#x9;-- Trajet effectu√©&#xA;&#x9;&#x9;ST_MakeLine(vdg.geom, vdg.geom_next) as geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.v_destination_globale as vdg&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;WHERE &#xA;&#x9;&#x9;vdg.ville_next IS NOT NULL&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;zone_horaire AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;&#x9;vdg.utc_offset&#xA;&#x9;&#x9;)&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;√âtapes sp√©cifiques au P√®re No√´l&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le P√®re No√´l poss√®de des √©tapes sp√©cifiques ne d√©pendant pas des destinations : lorsqu&amp;rsquo;il fabrique les cadeaux, lorsqu&amp;rsquo;il d√©marre sa tourn√©e pour rejoindre la premi√®re destination&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela on effectue plusieurs requ√™te que l&amp;rsquo;on va unir avec un &lt;code&gt;UNION ALL&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_etape_santa as (&#xA;&#x9;-- Pr√©paratifs&#xA;&#x9;SELECT &#xA;&#x9;&#x9;&#39;1&#39; as id,&#xA;&#x9;&#x9;&#39;Pr√©paratifs&#39; as type_etape,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;pays&#39; as pays,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; as region,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; as ville,&#xA;&#x9;&#x9;vdg.pays as pays_next,&#xA;&#x9;&#x9;vdg.region as region_next,&#xA;&#x9;&#x9;vdg.ville as ville_next,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;timezone&#39; as timezone,&#xA;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval as utc_offset,&#xA;&#x9;&#x9;vdg.utc_offset as utc_offset_next,&#xA;&#x9;&#x9;-- Dur√©e : 1er janvier au 25 d√©cembre minuit dans le premier fuseau horaire moins 2 minutes de trajet pour rejoindre la premi√®re destination&#xA;&#x9;&#x9;var.debut_distrib - (extract(year from now()) || &#39;-01-01 00:00:00 +1&#39;)::timestamp with time zone - var.delai_dest_santa_house as duree_etape,&#xA;&#x9;&#x9;-- Nombre de cadeaux fabriqu√©s&#xA;&#x9;&#x9;var.pop_total * var.cadeau_par_pop * var.cadeau_par_pers AS cadeau_fabrique,&#xA;&#x9;&#x9;0 as distance,&#xA;&#x9;&#x9;-- Emplacement&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;) as geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.v_destination_globale as vdg&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;WHERE &#xA;&#x9;&#x9;-- Premi√®re √©tape&#xA;&#x9;&#x9;vdg.id = &#39;01-001&#39;&#xA;&#x9;&#xA;&#x9;UNION ALL&#xA;&#x9;-- Voyage vers 1√®re destination&#xA;&#x9;SELECT &#xA;&#x9;&#x9;&#39;2&#39; as id,&#xA;&#x9;&#x9;&#39;D√©marrage tourn√©e&#39; as type_etape,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;pays&#39; as pays,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; as region,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; as ville,&#xA;&#x9;&#x9;vdg.pays as pays_next,&#xA;&#x9;&#x9;vdg.region as region_next,&#xA;&#x9;&#x9;vdg.ville as ville_next,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;timezone&#39; as timezone,&#xA;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval as utc_offset,&#xA;&#x9;&#x9;vdg.utc_offset as utc_offset_next,&#xA;&#x9;&#x9;var.delai_dest_santa_house as duree_etape,&#xA;&#x9;&#x9;0 as cadeau_fabrique,&#xA;&#x9;&#x9;ST_Length(ST_MakeLine(&#xA;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;vdg.geom&#xA;&#x9;&#x9;)) as distance,&#xA;&#x9;&#x9;-- Trajet effectu√©&#xA;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;vdg.geom&#xA;&#x9;&#x9;) as geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.v_destination_globale as vdg&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;WHERE &#xA;&#x9;&#x9;-- Premi√®re √©tape&#xA;&#x9;&#x9;vdg.id = &#39;01-001&#39;&#xA;&#xA;&#x9;UNION ALL&#xA;&#x9;-- Voyage retour derni√®re destination&#xA;&#x9;SELECT &#xA;&#x9;&#x9;&#39;4&#39; as id,&#xA;&#x9;&#x9;&#39;Fin tourn√©e&#39; as type_etape,&#xA;&#x9;&#x9;vdg.pays,&#xA;&#x9;&#x9;vdg.region,&#xA;&#x9;&#x9;vdg.ville,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;pays&#39; as pays_next,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; as region_next,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; as ville_next,&#xA;&#x9;&#x9;vdg.timezone,&#xA;&#x9;&#x9;vdg.utc_offset,&#xA;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval as utc_offset_next,&#xA;&#x9;&#x9;var.delai_dest_santa_house as duree_etape,&#xA;&#x9;&#x9;0 as cadeau_fabrique,&#xA;&#x9;&#x9;ST_Length(ST_MakeLine(&#xA;&#x9;&#x9;&#x9;vdg.geom,&#xA;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;)) as distance,&#xA;&#x9;&#x9;-- Trajet effectu√©&#xA;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;vdg.geom,&#xA;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;) as geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.v_destination_globale as vdg&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;WHERE &#xA;&#x9;&#x9;-- Derni√®re √©tape&#xA;&#x9;&#x9;vdg.ville_next IS NULL&#xA;&#xA;&#x9;UNION ALL&#xA;&#x9;-- Repos&#xA;&#x9;SELECT &#xA;&#x9;&#x9;&#39;5&#39; as id,&#xA;&#x9;&#x9;&#39;Repos&#39; as type_etape,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;pays&#39; as pays,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; as region,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; as ville,&#xA;&#x9;&#x9;NULL as pays_next,&#xA;&#x9;&#x9;NULL as region_next,&#xA;&#x9;&#x9;NULL as ville_next,&#xA;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;timezone&#39; as timezone,&#xA;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval as utc_offset,&#xA;&#x9;&#x9;NULL::interval as utc_offset_next,&#xA;&#x9;&#x9;-- Dur√©e : 1er janvier au 25 d√©cembre minuit dans le premier fuseau horaire moins 2 minutes de trajet pour rejoindre la premi√®re destination&#xA;&#x9;&#x9;(extract(year from now()) || &#39;-12-31 23:59:59 +1&#39;)::timestamp with time zone - (extract(year from now()) || &#39;-12-25 01:00:00 -12&#39;)::timestamp with time zone - var.delai_dest_santa_house as duree_etape,&#xA;&#x9;&#x9;0 AS cadeau_fabrique,&#xA;&#x9;&#x9;0 as distance,&#xA;&#x9;&#x9;-- Emplacement&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;) as geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa.v_variable as var&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Construction du voyage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cr√©er le voyage, les √©tapes suivantes sont associ√©es (via des &lt;code&gt;UNION ALL&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les √©tapes de distribution des cadeaux.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les √©tapes de trajet entre destinations.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les √©tapes sp√©cifiques au P√®re No√´l.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les √©l√©ments sont ensuite r√©agenc√©s selon l&amp;rsquo;ordre de passage afin de pouvoir calculer certains cumuls (population visit√©e, cadeaux distribu√©s, distance parcourue&amp;#8230;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donn√©es du voyage sont fix√©es dans une vue mat√©rialis√©e pour am√©liorer les performance lors de la consultation :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE MATERIALIZED VIEW santa.vm_voyage as (&#xA;&#x9;WITH voyage_complet as (&#xA;&#x9;&#x9;-- Etapes de distribution&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;&#39;-&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;3&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;id&#xA;&#x9;&#x9;&#x9;) as id_voyage,&#xA;&#x9;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;&#x9;pays,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;pays_next,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;&#x9;cadeau_distribue,&#xA;&#x9;&#x9;&#x9;0 as cadeau_fabrique,&#xA;&#x9;&#x9;&#x9;0 as distance,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa.v_etape_distribution&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;UNION ALL &#xA;&#x9;&#x9;-- Etapes de trajet&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;&#39;-&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;3&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;id&#xA;&#x9;&#x9;&#x9;) as id_voyage,&#xA;&#x9;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;&#x9;pays,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;pays_next,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;&#x9;0 as population,&#xA;&#x9;&#x9;&#x9;0 as pop_fictive,&#xA;&#x9;&#x9;&#x9;0 as cadeau_distribue,&#xA;&#x9;&#x9;&#x9;0 as cadeau_fabrique,&#xA;&#x9;&#x9;&#x9;distance,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa.v_etape_trajet&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;UNION ALL &#xA;&#x9;&#x9;-- Etapes sp√©cifiques au P√®re No√´l&#xA;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;id as id_voyage, &#xA;&#x9;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;&#x9;pays,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;pays_next,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;&#x9;0 as population,&#xA;&#x9;&#x9;&#x9;0 as pop_fictive,&#xA;&#x9;&#x9;&#x9;0 as cadeau_distribue,&#xA;&#x9;&#x9;&#x9;cadeau_fabrique,&#xA;&#x9;&#x9;&#x9;distance,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa.v_etape_santa&#xA;&#x9;)&#xA;&#x9;SELECT&#xA;&#x9;&#x9;id_voyage, &#xA;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;pays,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;pays_next,&#xA;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;-- Calcul de l&#39;horaire du d√©but :&#xA;&#x9;&#x9;-- 01/01 de l&#39;ann√©e en cours + dur√©e des √©tapes pr√©c√©dentes&#xA;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +1&#39;)::timestamp with time zone&#xA;&#x9;&#x9;+ coalesce(sum(duree_etape) OVER all_etape, &#39;0&#39;)) as horaire_debut,&#xA;&#x9;&#x9;to_char(&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +1&#39;)::timestamp with time zone&#xA;&#x9;&#x9;&#x9;+ coalesce(sum(duree_etape) OVER all_etape, &#39;0&#39;))&#xA;&#x9;&#x9;&#x9;AT TIME ZONE utc_offset,&#xA;&#x9;&#x9;&#x9;&#39;DD TMmon YYYY&#39;&#xA;&#x9;&#x9;) AS date_debut_local,&#xA;&#x9;&#x9;to_char(&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +1&#39;)::timestamp with time zone&#xA;&#x9;&#x9;&#x9;+ coalesce(sum(duree_etape) OVER all_etape, &#39;0&#39;))&#xA;&#x9;&#x9;&#x9;AT TIME ZONE utc_offset,&#xA;&#x9;&#x9;&#x9;&#39;HH24:MI:SS&#39;&#xA;&#x9;&#x9;) AS heure_debut_local,&#xA;&#x9;&#x9;-- Calcul de l&#39;horaire de fin :&#xA;&#x9;&#x9;-- 01/01 de l&#39;ann√©e en cours + dur√©e des √©tapes pr√©c√©dentes + dur√©e de l&#39;√©tape&#xA;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +1&#39;)::timestamp with time zone&#xA;&#x9;&#x9;+ coalesce(sum(duree_etape) OVER all_etape, &#39;0&#39;)&#xA;&#x9;&#x9;+ duree_etape) as horaire_fin,&#xA;&#x9;&#x9;to_char(&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +1&#39;)::timestamp with time zone&#xA;&#x9;&#x9;&#x9;+ coalesce(sum(duree_etape) OVER all_etape, &#39;0&#39;)&#xA;&#x9;&#x9;&#x9;+ duree_etape) &#xA;&#x9;&#x9;&#x9;AT TIME ZONE utc_offset_next,&#xA;&#x9;&#x9;&#x9;&#39;DD TMmon YYYY&#39;&#xA;&#x9;&#x9;) AS date_fin_local,&#xA;&#x9;&#x9;to_char(&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +1&#39;)::timestamp with time zone&#xA;&#x9;&#x9;&#x9;+ coalesce(sum(duree_etape) OVER all_etape, &#39;0&#39;)&#xA;&#x9;&#x9;&#x9;+ duree_etape) &#xA;&#x9;&#x9;&#x9;AT TIME ZONE utc_offset_next,&#xA;&#x9;&#x9;&#x9;&#39;HH24:MI:SS&#39;&#xA;&#x9;&#x9;) AS heure_fin_local,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;coalesce(sum(pop_fictive) OVER all_etape, 0) as pop_fictive_cumul,&#xA;&#x9;&#x9;cadeau_distribue,&#xA;&#x9;&#x9;coalesce(sum(cadeau_distribue) OVER all_etape, 0) as cadeau_distribue_cumul,&#xA;&#x9;&#x9;cadeau_fabrique,&#xA;&#x9;&#x9;distance,&#xA;&#x9;&#x9;coalesce(sum(distance) OVER all_etape, 0) as distance_cumul,&#xA;&#x9;&#x9;(distance) / (EXTRACT(EPOCH FROM duree_etape)) as vitesse_ms,&#xA;&#x9;&#x9;-- Vitesse en km/h&#xA;&#x9;&#x9;trim(to_char(((distance) / (EXTRACT(EPOCH FROM duree_etape)))/3.6, &#39;999 999 km/h&#39;)) AS vitesse,&#xA;&#x9;&#x9;-- Azimuth du symbole sur la carte&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;WHEN GeometryType(geom) = &#39;LINESTRING&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;Degrees(ST_Azimuth(ST_StartPoint(geom),ST_EndPoint(geom)))&#xA;&#x9;&#x9;&#x9;ELSE 0&#xA;&#x9;&#x9;END as azimuth,&#xA;&#x9;&#x9;-- Orientation du symbole sur la carte&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;WHEN GeometryType(geom) = &#39;LINESTRING&#39; AND Degrees(ST_Azimuth(ST_StartPoint(geom),ST_EndPoint(geom))) &amp;lt; 180 THEN &#39;Est&#39; &#xA;&#x9;&#x9;&#x9;WHEN GeometryType(geom) = &#39;LINESTRING&#39; AND Degrees(ST_Azimuth(ST_StartPoint(geom),ST_EndPoint(geom))) &gt; 180 THEN &#39;Ouest&#39;&#xA;&#x9;&#x9;&#x9;ELSE &#39;-&#39;&#xA;&#x9;&#x9;END as orientation,&#xA;&#x9;&#x9;GeometryType(geom) as type_geom,&#xA;&#x9;&#x9;geom&#xA;&#x9;FROM voyage_complet&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;all_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;id_voyage&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On oublie pas de calculer quelques index :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE UNIQUE INDEX unique_idx_vm_voyage ON santa.vm_voyage USING BTREE (id_voyage);&#xA;CREATE UNIQUE INDEX horaire_debut_idx_vm_voyage ON santa.vm_voyage (horaire_debut);&#xA;CREATE UNIQUE INDEX horaire_fin_idx_vm_voyage ON santa.vm_voyage (horaire_fin);&#xA;CREATE INDEX geom_idx_vm_voyage ON santa.vm_voyage USING GIST (geom);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons maintenant un trajet qui ressemble a ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;img fetchpriority=&#34;high&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;636&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/itineraire_pere_noel-1024x636.png&#34; alt=&#34;&#34; class=&#34;wp-image-3556&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/itineraire_pere_noel-1024x636.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/itineraire_pere_noel-300x186.png 300w, https://blog.arthurbazin.com/wp-content/uploads/itineraire_pere_noel-768x477.png 768w, https://blog.arthurbazin.com/wp-content/uploads/itineraire_pere_noel-1536x953.png 1536w, https://blog.arthurbazin.com/wp-content/uploads/itineraire_pere_noel.png 1951w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Suivi en live&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Avoir un trajet c&amp;rsquo;est bien mais connaitre toutes les infos sur le trajet √† un ¬´¬†instant t¬†¬ª, c&amp;rsquo;est mieux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, nous allons utiliser une vue se basant sur la vue mat√©rialis√©e pr√©c√©dente et qui ne va extraire qu&amp;rsquo;une seule ligne correspondant √† l&amp;rsquo;√©tape du voyage lors de l&amp;rsquo;instant pr√©sent. Nous allons √©galement utiliser diverses astuces pour g√©n√©rer des paroles prononc√©es par le P√®re No√´l ainsi que du HTML pour mettre en forme le rendu final.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On va utiliser une requ√™te CTE pour calculer les valeurs dont nous avons besoin, puis pour g√©n√©rer le HTML.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_suivi_santa_live as (&#xA;&#x9;WITH &#xA;&#x9;&#x9;info_suivi as (&#xA;&#x9;&#x9;&#x9;SELECT&#xA;&#x9;&#x9;&#x9;&#x9;id_voyage, &#xA;&#x9;&#x9;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;&#x9;&#x9;-- On g√©n√®re des paroles du P√®re No√´l.&#xA;&#x9;&#x9;&#x9;&#x9;-- Le texte varie selon le moment de l&#39;ann√©e et change toutes les 10 secondes&#xA;&#x9;&#x9;&#x9;&#x9;jsonb_extract_path_text(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;parole_pere_noel,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;FLOOR(EXTRACT(second from var.now) / 5)::text&#xA;&#x9;&#x9;&#x9;&#x9;) as parole,&#xA;&#x9;&#x9;&#x9;&#x9;-- G√©n√©ration d&#39;un titre&#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Pr√©paratifs&#39; THEN &#39;Le P√®re No√´l pr√©pare les cadeaux&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;D√©marrage tourn√©e&#39; THEN &#39;Le P√®re No√´l est parti vers son premier lieu de distribution&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Trajet&#39; THEN &#39;Le P√®re No√´l voyage vers un nouveau lieu de distribution&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Distribution&#39; THEN &#39;Le P√®re No√´l est en cours de distribution&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Fin tourn√©e&#39; THEN &#39;Le P√®re No√´l a fini sa tourn√©e et rentre chez lui&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Repos&#39; THEN &#39;Le P√®re No√´l a termin√© et prend un repos bien m√©rit√©&#39;&#xA;&#x9;&#x9;&#x9;&#x9;END AS titre,&#xA;&#x9;&#x9;&#x9;&#x9;pays,&#xA;&#x9;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;&#x9;pays_next,&#xA;&#x9;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;&#x9;duree_etape::text,&#xA;&#x9;&#x9;&#x9;&#x9;EXTRACT(EPOCH FROM duree_etape) as duree_etape_seconde,&#xA;&#x9;&#x9;&#x9;&#x9;horaire_debut,&#xA;&#x9;&#x9;&#x9;&#x9;horaire_fin,&#xA;&#x9;&#x9;&#x9;&#x9;-- Timer pour connaitre le prochain d√©part&#xA;&#x9;&#x9;&#x9;&#x9;concat(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;NULLIF(extract(day from (horaire_fin - var.now)), 0) || &#39; jours, &#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;NULLIF(extract(hour from (horaire_fin - var.now)), 0) || &#39; heures, &#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;NULLIF(extract(minute from (horaire_fin - var.now)), 0) || &#39; minutes et &#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;round(extract(second from (horaire_fin - var.now))::numeric, 0) || &#39; secondes&#39;&#xA;&#x9;&#x9;&#x9;&#x9;) AS timer,&#xA;&#x9;&#x9;&#x9;&#x9;date_debut_local,&#xA;&#x9;&#x9;&#x9;&#x9;heure_debut_local,&#xA;&#x9;&#x9;&#x9;&#x9;date_fin_local,&#xA;&#x9;&#x9;&#x9;&#x9;heure_fin_local,&#xA;&#x9;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;&#x9;-- Variation de la population durant l&#39;√©tape&#xA;&#x9;&#x9;&#x9;&#x9;trim(to_char( &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Distribution&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temps_passe_etape.pourcent * population&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END + pop_fictive_cumul,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;999 999 999 999&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)) AS pop_cumul,&#xA;&#x9;&#x9;&#x9;&#x9;cadeau_distribue,&#xA;&#x9;&#x9;&#x9;&#x9;-- Variation du nombre de cadeau distribu√©s durant l&#39;√©tape&#xA;&#x9;&#x9;&#x9;&#x9;trim(to_char( &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Distribution&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temps_passe_etape.pourcent * cadeau_distribue&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;END + cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;999 999 999 999&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)) AS cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;&#x9;trim(to_char(cadeau_fabrique, &#39;999 999 999 999&#39;)) as cadeau_fabrique,&#xA;&#x9;&#x9;&#x9;&#x9;-- Variation du nombre de cadeau fabriqu√© durant l&#39;√©tape (uniquement lors de la fabrication)&#xA;&#x9;&#x9;&#x9;&#x9;trim(to_char(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;round(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temps_passe_etape.pourcent * cadeau_fabrique,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;999 999 999 999&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)) as cadeau_fabrique_cumul,&#xA;&#x9;&#x9;&#x9;&#x9;-- Distance parcourue depuis le d√©but&#xA;&#x9;&#x9;&#x9;&#x9;-- il faut tenir compte des √©tapes de distribution qui sont des points&#xA;&#x9;&#x9;&#x9;&#x9;trim(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;to_char(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_geom = &#39;LINESTRING&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ST_Length(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ST_LineSubstring(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;geom,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;0,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temps_passe_etape.pourcent&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END +&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;distance_cumul&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;/1000&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;999 999 999 999 km&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;) AS distance_cumul,&#xA;&#x9;&#x9;&#x9;&#x9;vitesse_ms,&#xA;&#x9;&#x9;&#x9;&#x9;vitesse,&#xA;&#x9;&#x9;&#x9;&#x9;azimuth,&#xA;&#x9;&#x9;&#x9;&#x9;orientation,&#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN type_geom = &#39;LINESTRING&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;-- Calcul de l&#39;emplacement&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ST_LineInterpolatePoint(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;geom,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temps_passe_etape.pourcent&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE geom&#xA;&#x9;&#x9;&#x9;&#x9;END::geometry(point,3857) as geom&#xA;&#x9;&#x9;&#x9;FROM vm_voyage&#xA;&#x9;&#x9;&#x9;CROSS JOIN &#xA;&#x9;&#x9;&#x9;&#x9;santa.v_variable as var&#xA;&#x9;&#x9;&#x9;-- Calcul du pourcentage de temps pass√© depuis le d√©but de l&#39;√©tape &#xA;&#x9;&#x9;&#x9;CROSS JOIN LATERAL (&#xA;&#x9;&#x9;&#x9;&#x9;SELECT EXTRACT(EPOCH FROM (var.now - horaire_debut)) / EXTRACT(EPOCH FROM (horaire_fin - horaire_debut)) as pourcent&#xA;&#x9;&#x9;&#x9;) as temps_passe_etape&#xA;&#x9;&#x9;&#x9;-- On ne r√©cup√®re que l&#39;√©tape en cours &#xA;&#x9;&#x9;&#x9;WHERE horaire_debut &amp;lt;= var.now&#xA;&#x9;&#x9;&#x9;AND horaire_fin &gt; var.now&#xA;&#x9;&#x9;)&#xA;&#x9;-- G√©n√©ration du HTML final&#xA;&#x9;SELECT &#xA;&#x9;&#x9;*,&#xA;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Pr√©paratifs&#39; THEN&#xA;&#x9;&#x9;&#x9;&#x9;concat(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;p class=&#34;titre&#34;&gt;&#39;, titre, &#39;&amp;lt;/p&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;div&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;...&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;/div&gt;&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;WHEN type_etape IN (&#39;Trajet&#39;, &#39;D√©marrage tourn√©e&#39;, &#39;Fin tourn√©e&#39;) THEN &#xA;&#x9;&#x9;&#x9;&#x9;concat(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;p class=&#34;titre&#34;&gt;&#39;, titre, &#39;&amp;lt;/p&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;div&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;...&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;/div&gt;&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Distribution&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;concat(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;p class=&#34;titre&#34;&gt;&#39;, titre, &#39;&amp;lt;/p&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;div&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;...&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;/div&gt;&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Repos&#39; THEN&#xA;&#x9;&#x9;&#x9;&#x9;concat(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;p class=&#34;titre&#34;&gt;&#39;, titre, &#39;&amp;lt;/p&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;div&gt;&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;...&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;/div&gt;&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;END ||&#xA;&#x9;&#x9;&#39;&amp;lt;/div&gt;&#39; as informations&#xA;&#x9;FROM info_suivi&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voila un exemple de r√©ponse :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-columns is-layout-flex wp-container-core-columns-is-layout-9d6595d7 wp-block-columns-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&#xA;&lt;p class=&#34;has-text-align-center&#34;&gt;&lt;strong&gt;Le P√®re No√´l est en cours de distribution&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Petit mot du P√®re No√´l : Oh hisse !&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Emplacement actuel : Anadyr (Russie)&lt;br&gt;Arriv√© sur place le 24 d√©c. 2023 √† 08:00:00&lt;br&gt;(24 d√©c. 2023 √† 19:00:00 heure locale)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prochaine destination : Majuro Atoll (√éles Marshall)&lt;br&gt;D√©part dans 36 secondes&lt;br&gt;Le 24 d√©c. 2023 √† 08:00:37&lt;br&gt;(24 d√©c. 2023 √† 19:00:37 heure locale)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cadeaux distribu√©s : 7 222&lt;br&gt;Population visit√©e : 7 602&lt;br&gt;Distance parcourue : 18 108 km&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;L&amp;rsquo;√©tat des lieux&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque destination, il est possible de voir en temps r√©el si le P√®re No√´l est pass√© ou non. Pour cela nous allons nous appuyer sur la table des destinations ainsi que la vue mat√©rialis√©e &lt;code&gt;vm_voyage&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE MATERIALIZED VIEW santa.vm_info_destination as (&#xA;&#x9;SELECT&#xA;&#x9;&#x9;min(id_voyage) as id_voyage,&#xA;&#x9;&#x9;pays,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;max(utc_offset_next) as utc_offset_next,&#xA;&#x9;&#x9;max(horaire_debut) as horaire_debut,&#xA;&#x9;&#x9;to_char(max(horaire_debut) AT TIME ZONE utc_offset,&#39;DD TMmon YYYY&#39;) AS date_debut_local,&#xA;&#x9;&#x9;to_char(max(horaire_debut) AT TIME ZONE utc_offset,&#39;HH24:MI:SS&#39;) AS heure_debut_local,&#xA;&#x9;&#x9;min(horaire_fin) as horaire_fin,&#xA;&#x9;&#x9;to_char(min(horaire_fin) AT TIME ZONE utc_offset_next,&#39;DD TMmon YYYY&#39;) AS date_fin_local,&#xA;&#x9;&#x9;to_char(min(horaire_fin) AT TIME ZONE utc_offset_next,&#39;HH24:MI:SS&#39;) AS heure_fin_local,&#xA;&#x9;&#x9;trim(to_char(population, &#39;999 999 999 999&#39;)) AS population,&#xA;&#x9;&#x9;geom::geometry(point,3857) as geom&#xA;&#x9;FROM vm_voyage&#xA;&#x9;WHERE type_geom = &#39;POINT&#39;&#xA;&#x9;GROUP BY &#xA;&#x9;&#x9;pays,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;geom&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A partir de ces informations, il est possible de calculer diff√©rente informations en temps r√©elle :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE VIEW santa.v_suivi_destination_live as (&#xA;&#x9;SELECT&#xA;&#x9;&#x9;id_voyage,&#xA;&#x9;&#x9;pays,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;timezone,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;horaire_debut,&#xA;&#x9;&#x9;horaire_fin,&#xA;&#x9;&#x9;concat(&#xA;&#x9;&#x9;&#x9;NULLIF(extract(day from (horaire_fin - var.now)), 0) || &#39; jours, &#39;,&#xA;&#x9;&#x9;&#x9;NULLIF(extract(hour from (horaire_fin - var.now)), 0) || &#39; heures, &#39;,&#xA;&#x9;&#x9;&#x9;NULLIF(extract(minute from (horaire_fin - var.now)), 0) || &#39; minutes et &#39;,&#xA;&#x9;&#x9;&#x9;round(extract(second from (horaire_fin - var.now))::numeric, 0) || &#39; secondes&#39;&#xA;&#x9;&#x9;) AS timer,&#xA;&#x9;&#x9;date_debut_local,&#xA;&#x9;&#x9;heure_debut_local,&#xA;&#x9;&#x9;date_fin_local,&#xA;&#x9;&#x9;heure_fin_local,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;-- G√©n√©ration d&#39;un message d&#39;information sur l&#39;√©tat de passage&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;-- Pour la maison du P√®re No√´l&#xA;&#x9;&#x9;&#x9;WHEN id_voyage = &#39;1&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; horaire_fin THEN &#39;Le P√®re No√´l pr√©pare les cadeaux&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; horaire_debut THEN &#39;Le P√®re No√´l est absent&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE &#39;Le P√®re No√´l se repose&#39;&#xA;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;-- Sinon on d√©termine si la visite est r√©alis√©e en fonction de l&#39;heure de passage&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; horaire_debut  THEN &#39;Attend la visite du P√®re No√´l&#39;&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &gt; horaire_fin  THEN &#39;A re√ßu la visite du P√®re No√´l&#39;&#xA;&#x9;&#x9;&#x9;ELSE &#39;Le P√®re No√´l est ici !&#39;&#xA;&#x9;&#x9;END AS etat,&#xA;&#x9;&#x9;-- Quelques d√©tails suppl√©mentaires&#xA;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;WHEN id_voyage = &#39;1&#39; THEN &#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; horaire_fin THEN &#39;&amp;lt;p&gt;Le P√®re No√´l est ici, vous le trouverez dans sa remise&amp;lt;/p&gt;&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; horaire_debut THEN &#39;&amp;lt;p&gt;Le P√®re No√´l est en tourn√©e&amp;lt;/p&gt;&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE &#39;&amp;lt;p&gt;Le P√®re No√´l est ici, vous le trouverez dans son lit&amp;lt;/p&gt;&#39;&#xA;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &gt; horaire_fin THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;p&gt;Le P√®re No√´l est d√©j√† pass√© &lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f609.png&#34; alt=&#34;üòâ&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&amp;lt;/p&gt;&#39;&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; horaire_debut THEN&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;p&gt;Le P√®re No√´l arrive dans &#39; || &#xA;&#x9;&#x9;&#x9;&#x9;concat(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;NULLIF(extract(day from (horaire_fin - var.now)), 0) || &#39; jours, &#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;NULLIF(extract(hour from (horaire_fin - var.now)), 0) || &#39; heures, &#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;NULLIF(extract(minute from (horaire_fin - var.now)), 0) || &#39; minutes et &#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;round(extract(second from (horaire_fin - var.now))::numeric, 0) || &#39; secondes&#39;&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;|| &#39;&amp;lt;/p&gt;&#39;&#xA;&#x9;&#x9;&#x9;ELSE&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&amp;lt;p&gt;Le P√®re No√´l est en cours de distribution vas dans ton lit !&amp;lt;/p&gt;&#39;&#xA;&#x9;&#x9;END as informations,&#xA;&#x9;&#x9;geom::geometry(point,3857) as geom&#xA;&#x9;FROM vm_info_destination&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa.v_variable as var&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;hr class=&#34;wp-block-separator has-alpha-channel-opacity&#34;/&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center&#34;&gt;Voila ! J&amp;rsquo;esp√®re que √ßa vous a plu.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center has-rouge-color has-text-color has-large-font-size&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f384.png&#34; alt=&#34;üéÑ&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; &lt;strong&gt;Joyeux No√´l !!&lt;/strong&gt; &lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f384.png&#34; alt=&#34;üéÑ&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/p&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/programmation/sql/suivons-le-pere-noel-avec-postgis" rel="alternate"></link>
    <summary type="html">D√©couvrez ce qui se cache derri√®re une application de suivi du P√®re No√´l. Une liste de destination, quelques requ√™tes SQL et le tour est jou√© ? Ce n&#39;est pas aussi simple que √ßa, vous allez le voir...</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL‚Ä¶ Python‚Ä¶ √ßa fait PL/Python !</title>
    <updated>2025-02-15T19:00:00Z</updated>
    <id>tag:blog.arthurbazin.com,2025-02-15:/programmation/postgresql-python-ca-fait-pl-python</id>
    <content type="html">&#xA;&lt;p&gt;Imaginez, vous utilisez PostgreSQL au quotidien pour stocker et traiter vos donn√©es. Comme vous √™tes curieux, vous avez essay√© Python pour faire quelques traitements et vous vous √™tes rendus compte que c&amp;rsquo;√©tait pas mal quand m√™me&amp;#8230; Malheureusement vos scripts sont compl√®tement dissoci√©s de la base de donn√©es et vous vous dites qu&amp;rsquo;il serait pratique que ces scripts soient directement pilot√©s depuis PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Et bien vous pouvez m√©langer les deux technologies gr√¢ce au PL/Python. ¬´¬†Sorcellerie¬†¬ª me direz-vous&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;blockquote class=&#34;wp-block-quote is-layout-flow wp-block-quote-is-layout-flow&#34;&gt;&#xA;&lt;p&gt;Si, si, c&amp;rsquo;est possible !&lt;/p&gt;&#xA;&lt;cite&gt;Hassan Cehef &amp;#8211; Les Nuls&lt;/cite&gt;&lt;/blockquote&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le PL/Python est un langage de PostgreSQL permettant d&amp;rsquo;√©crire des fonctions en langage Python directement au sein d&amp;rsquo;une base de donn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;il s&amp;rsquo;agit d&amp;rsquo;une langage dit ¬´¬†untrusted¬†¬ª (¬´¬†sans confiance¬†¬ª) car il permet de faire tout et n&amp;rsquo;importe quoi (comme modifier des fichiers sur le serveur par exemple). C&amp;rsquo;est pour cela que seul un superutilisateur peut cr√©er des fonctions avec ce langage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Introduction&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cet article pr√©suppose que vous avez d√©j√† utilis√© Python et PostgreSQL et que vous poss√©dez une version de Python sur votre machine en parall√®le d&amp;rsquo;une installation de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devez par ailleurs avoir des notions sur les variables d&amp;rsquo;environnement et le fonctionnement des services.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Installation du langage&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Linux, il faut installer le package en lien avec l&amp;rsquo;extension : &lt;code&gt;postgresql-plpythonY-Z&lt;/code&gt; (avec &lt;code&gt;Y&lt;/code&gt; = 3 pour Python 3.X et &lt;code&gt;Z&lt;/code&gt; = version de PostgreSQL). Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bash&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo apt install postgresql-plpython3-16&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, le PL/Python est pr√©install√© avec PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de lancer la requ√™te suivante pour l&amp;rsquo;activer :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE EXTENSION plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant utiliser le PL/Python pour vos fonctions et proc√©dures. Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DO &#xA;$function$&#xA;&#xA;&#x9;import sys&#xA;&#x9;plpy.notice(sys.version)&#xA;&#xA;$function$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce bloc de code anonyme (oui, il n&amp;rsquo;est pas encapsul√© dans une fonction ou un proc√©dure) ne retourne rien mais un message contenant la version de Python utilis√© est renvoy√© dans la sortie console.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Fonctionnement&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si l&amp;rsquo;√©tape pr√©c√©dente a fonctionn√© du premier coup, f√©licitation ! Sinon, cette partie devrait vous aider.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Version de Python&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, PostgreSQL est compatible avec une version sp√©cifique de Python qui est d√©finie lors de sa compilation. Cette information est disponible dans les notes d&amp;rsquo;installations pr√©sentes dans &lt;em&gt;C:\Emplacement\de\PostgreSQL\XX\doc\installation-notes.html&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un tableau r√©sumant la compatibilit√© avec l&amp;rsquo;installeur PostgreSQL fournit par EDB.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Version de PostgreSQL&lt;/th&gt;&lt;th&gt;Version de Python compatible&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 17&lt;/td&gt;&lt;td&gt;Python 3.13.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 16&lt;/td&gt;&lt;td&gt;Python 3.12.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 15&lt;/td&gt;&lt;td&gt;Python 3.11.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 14&lt;/td&gt;&lt;td&gt;Python 3.9.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 13&lt;/td&gt;&lt;td&gt;Python 3.8.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 12 et avant&lt;/td&gt;&lt;td&gt;Python 2.7&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Tableau issu du site : &lt;a href=&#34;https://postgresapp.com/documentation/plpython.html&#34; data-type=&#34;link&#34; data-id=&#34;https://postgresapp.com/documentation/plpython.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;postgresapp.com&lt;/a&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Linux, je n&amp;rsquo;ai pas explicitement trouv√© l&amp;rsquo;information mais il semble que le tableau pr√©c√©dent soit valable (en tout cas d&amp;rsquo;apr√®s mes quelques tests c&amp;rsquo;est le cas).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si vous n&amp;rsquo;utilisez pas la bonne version de Python, PostgreSQL vous renverra un message d&amp;rsquo;erreur de ce type lors de l‚Äôex√©cution d&amp;rsquo;une proc√©dure Python :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SQL Error [58P01]: ERREUR: n&#39;a pas pu charger la biblioth√®que ¬´ C:/Program Files/PostgreSQL/16/lib/plpython3.dll ¬ª : The specified module could not be found.&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Choix de l&amp;rsquo;interpr√©teur&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;ex√©cution du code Python se fait au travers d&amp;rsquo;un interpr√©teur. Pour cela, PostgreSQL utilise l&amp;rsquo;interpr√©teur disponible ¬´¬†par d√©faut¬†¬ª sur la machine et donc celui disponible √† travers la variable d&amp;rsquo;environnement &lt;code&gt;PATH&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D√©finir un autre interpr√©teur n&amp;rsquo;est pas simple&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur Linux, c&amp;rsquo;est l&amp;rsquo;installation d&amp;rsquo;une version de Python autre que celle fourni par d√©faut, qui est complexe ; il faut en g√©n√©ral compiler l&amp;rsquo;interpr√©teur. En revanche il est relativement simple de red√©finir la variable &lt;code&gt;PATH&lt;/code&gt; directement dans la configuration du service (&lt;a href=&#34;https://serverfault.com/a/413408&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;d√©crit ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, c&amp;rsquo;est l&amp;rsquo;inverse&amp;#8230; Diff√©rentes versions de Python peuvent √™tre install√©es tr√®s facilement mais la red√©finition de la variable &lt;code&gt;PATH&lt;/code&gt; pour un service sp√©cifique est relativement complexe (mais &lt;a href=&#34;https://serverfault.com/a/1103091&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;d√©crite ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En lien avec le sujet, voici &lt;a href=&#34;https://stackoverflow.com/questions/67852675/postgresql-13-python-3-7-9-plpython3u-psql-server-closed-the-connection-u&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;un thread stackoverflow&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation de modules et environnements&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous aurez tr√®s probablement besoin d&amp;rsquo;installer des modules. Il est peu recommand√© de le faire directement dans l&amp;rsquo;environnement Python de base et il vaut mieux utiliser des environnements sp√©cifiques √† chaque projet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il en est de m√™me pour PostgreSQL, vous pouvez cr√©er et utiliser des environnements pour vos projets.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela il faut utiliser le module &lt;code&gt;virtualenv&lt;/code&gt; car l&amp;rsquo;activation d&amp;rsquo;un environnement peut √™tre fait directement depuis Python avec cet outil :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bash&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;pip install virtualenv&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devez ensuite cr√©er votre environnement dans un dossier sp√©cifique. Vous pouvez cr√©er un r√©pertoire sp√©cifique dans l&amp;rsquo;installation de PostgreSQL par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;virtualenv &#34;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ensuite acc√©der √† cet environnement et y installer tous les modules souhait√©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement\Scripts\activate.bat&#34;&#xA;pip install geopandas&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme ce n&amp;rsquo;est pas vous mais le service qui contr√¥le le d√©marrage de PostgreSQL, il ne vous ai pas possible de d√©marrer l&amp;rsquo;environnement avant PostgreSQL (encore que en modifiant le service mais ce n&amp;rsquo;est pas des plus simple). Nous allons donc cr√©er une fonction en PL/Python permettant de d√©marrer l&amp;rsquo;environnement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE PROCEDURE py_activate_venv(venv text)&#xA;RETURNS boolean AS&#xA;$BODY$&#xA;&#x9;import os&#xA;&#x9;import sys&#xA;&#xA;&#x9;if sys.platform in (&#39;win32&#39;, &#39;win64&#39;, &#39;cygwin&#39;):&#xA;&#x9;&#x9;activate_this = os.path.join(venv, &#39;Scripts&#39;, &#39;activate_this.py&#39;)&#xA;&#x9;else:&#xA;&#x9;&#x9;activate_this = os.path.join(venv, &#39;bin&#39;, &#39;activate_this.py&#39;)&#xA;&#xA;&#x9;try:&#xA;&#x9;&#x9;exec(open(activate_this).read(), dict(__file__=activate_this))&#xA;&#x9;except FileNotFoundError:&#xA;&#x9;&#x9;plpy.error(&#39;Virtual environment {} does not exist.&#39;.format(name))&#xA;&#x9;&#xA;&#x9;return True&#xA;$BODY$&#xA;LANGUAGE plpython3u&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour activer l&amp;rsquo;environnement, il suffit de lancer la requ√™te suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT py_activate_venv(&#39;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour aller plus loin, vous pouvez utiliser ce superbe projet GitHub qui automatise toute la gestion des environnements sous Python :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-16018d1d wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/dpage/plpy_venv&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;GitHub &amp;#8211; plpy_venv&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Module plpy&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le langage PL/Python apporte un module python automatiquement charg√© : &lt;code&gt;plpy&lt;/code&gt; qui apporte quelques fonctions utiles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fonctions&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour retourner des message, utilisez les fonctions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;plpy.debug(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.log(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.info(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.notice(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.warning(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.error(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.fatal(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les arguments suivants peuvent √™tre utilis√©s pour ajouter des informations de contexte au message renvoy√© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;detail&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;hint&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;sqlstate&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;schema_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;table_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;column_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;datatype_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;constraint_name&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour ex√©cuter une requ√™te SQL au sein de la base de donn√©es, utilisez &lt;code&gt;plpy.execute(&#34;query&#34; [, limit])&lt;/code&gt; avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;query&lt;/code&gt; : la requ√™te.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;limit&lt;/code&gt; : un entier permettant de limiter le nombre de r√©sultat.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;objet r√©sultant est une liste (les lignes) de dictionnaires (ensemble de colonnes). Par exemple pour renvoyer une colonne de la 4√®me ligne :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;result = plpy.execute(&#34;SELECT * FROM ma_table&#34;, 25)&#xA;return result[4][&#34;ma_colonne&#34;]&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe trois fonctions √©quivalentes √† leurs homonyme au sein de PostgreSQL : &lt;code&gt;plpy.quote_literal(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt;, &lt;code&gt;plpy.quote_nullable(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt; et &lt;code&gt;plpy.quote_ident(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Gestion des erreurs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions &lt;code&gt;plpy.execute&lt;/code&gt; et &lt;code&gt;plpy.cursor&lt;/code&gt; (non d√©crite dans cet article), renvoient une exception dans le cas o√π la requ√™te SQL pass√©e en argument √©choue. L&amp;rsquo;exception est une instance de la classe &lt;code&gt;plpy.SPIError&lt;/code&gt; qui peut √™tre r√©cup√©r√©e via la construction &lt;code&gt;try&lt;/code&gt;/&lt;code&gt;except&lt;/code&gt;. Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE FUNCTION test_plpython() &#xA;RETURNS text AS &#xA;$BODY$&#xA;&#xA;    try:&#xA;        plpy.execute(&#34;UPDATE ma_table SET &#34;ma_colonne&#34; = 12&#34;)&#xA;&#xA;    except plpy.SPIError:&#xA;        return &#34;La mise √† jour a √©chou√©e&#34;&#xA;&#xA;    else:&#xA;        return &#34;La mise √† jour a fonctionn√©e&#34;&#xA;&#xA;$BODY$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible de cibler une erreur sp√©cifique retourn√©e par PostgreSQL. Pour cela, vous pouvez v√©rifier la valeur de l&amp;rsquo;attribut &lt;code&gt;sqlstate&lt;/code&gt; de la classe &lt;code&gt;SPIError&lt;/code&gt; ou utiliser le module &lt;code&gt;plpy.spiexceptions&lt;/code&gt; qui d√©finit une classe d&amp;rsquo;exception pour chaque condition PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour sp√©cifier une erreur avec &lt;code&gt;spiexception&lt;/code&gt;, il suffit de se r√©f√©rer √† &lt;a href=&#34;https://www.postgresql.org/docs/current/errcodes-appendix.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;la liste des erreurs de PostgreSQL&lt;/a&gt; et de convertir le nom de l&amp;rsquo;erreur comme suivant : retirer les soulign√©s (¬´¬†_¬†¬ª) + mettre en majuscule la premi√®re lettre de chaque mot. Ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;privilege_not_granted&lt;/code&gt; devient &lt;code&gt;PrivilegeNotGranted&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;data_exception&lt;/code&gt; devient &lt;code&gt;DataException&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;division_by_zero&lt;/code&gt; devient &lt;code&gt;DivisionByZero&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour attraper une erreur sp√©cifique il suffit d&amp;rsquo;utiliser la syntaxe suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE FUNCTION test_plpython() &#xA;RETURNS text AS &#xA;$BODY$&#xA;&#xA;    try:&#xA;        plpy.execute(&#34;UPDATE ma_table SET &#34;ma_colonne&#34; = 12&#34;)&#xA;&#xA;    except plpy.spiexceptions.UniqueViolation:&#xA;        return &#34;La mise √† jour a √©chou√©e en raison d&#39;une erreur d&#39;unicit√©&#34;&#xA;&#xA;    except plpy.SPIError as e:&#xA;        return &#34;Une erreur s&#39;est produite : SQLSTATE %s&#34; % e.sqlstate&#xA;&#xA;    else:&#xA;        return &#34;La mise √† jour a fonctionn√©e&#34;&#xA;&#xA;$BODY$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Gestion des transactions&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L‚Äôex√©cution d&amp;rsquo;une fonction en PL/Python se fait toujours au sein d&amp;rsquo;une transaction. Ainsi, lorsqu&amp;rsquo;une requ√™te est ex√©cut√©e via &lt;code&gt;plpy.execute&lt;/code&gt;, une sous-transaction est automatiquement d√©marr√©e. Il devient alors possible de contr√¥ler l&amp;rsquo;issue de cette sous-transaction via les fonctions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;plpy.commit()&lt;/code&gt; : valider la sous-transaction&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.rollback()&lt;/code&gt; : annuler la sous-transaction&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Apr√®s la fin d&amp;rsquo;une sous-transaction, une nouvelle sous-transaction est automatiquement d√©marr√©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas o√π plusieurs requ√™tes doivent √™tre ex√©cut√©es et que l&amp;rsquo;int√©gralit√© de ces requ√™tes doivent √™tre valid√©es ou non, il est possible de d√©marrer une sous-transaction gr√¢ce √†  &lt;code&gt;plpy.subtransaction()&lt;/code&gt;. Pour cela, il faudra l&amp;rsquo;utiliser de la fa√ßon suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;with plpy.subtransaction():&#xA;  plpy.execute(&#34;DELETE FROM ma_table WHERE colonne = &#39;xxx&#39;&#34;)&#xA;  plpy.execute(&#34;INSERT INTO autre_table (col_1, col_2) VALUES (&#39;valeur1&#39;, &#39;valeur2&#39;)&#34;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;une erreur lors de l&amp;rsquo;une des requ√™te entraine donc l&amp;rsquo;annulation de l&amp;rsquo;ensemble des requ√™tes de la sous-transaction mais engendre √©galement une exception qui stoppera l‚Äôex√©cution de la fonction et annulera la transaction en cours. Pour limiter la propagation de l&amp;rsquo;exception, il est possible d&amp;rsquo;encapsuler le tout au sein d&amp;rsquo;un &lt;code&gt;try&lt;/code&gt;/&lt;code&gt;catch&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;try:&#xA;  with plpy.subtransaction():&#xA;    plpy.execute(&#34;DELETE FROM ma_table WHERE colonne = &#39;xxx&#39;&#34;)&#xA;    plpy.execute(&#34;INSERT INTO autre_table (col_1, col_2) VALUES (&#39;valeur1&#39;, &#39;valeur2&#39;)&#34;)&#xA;except plpy.SPIError as e:&#xA;  result = &#34;Erreur de requ√™te : %s&#34; % e.args&#xA;else:&#xA;  result = &#34;Op√©ration effectu√©e&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour allez plus loin&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lq &lt;a href=&#34;https://www.postgresql.org/docs/current/plpython.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentation de PostgreSQL sur le langage PL/Python&lt;/a&gt; vous permettra d&amp;rsquo;approfondir le sujet maintenant que vous avez les √©l√©ments cl√©s en main.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/programmation/postgresql-python-ca-fait-pl-python" rel="alternate"></link>
    <summary type="html">Imaginez, vous utilisez PostgreSQL au quotidien pour stocker et traiter vos donn√©es. Comme vous √™tes curieux, vous avez essay√© Python pour faire quelques traitements et vous vous √™tes rendus compte que c&amp;#8217;√©tait pas mal quand m√™me&amp;#8230; Malheureusement vos scripts sont compl√®tement dissoci√©s de la base de donn√©es et vous vous dites qu&amp;#8217;il serait pratique que [&amp;#8230;]</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Soyons pr√©cis avec PostGIS</title>
    <updated>2025-02-09T20:26:53Z</updated>
    <id>tag:blog.arthurbazin.com,2025-02-09:/bdd/postgresql/soyons-precis-avec-postgis</id>
    <content type="html">&#xA;&lt;p&gt;Vous √™tes vous d√©j√† demand√© quelle √©tait la pr√©cision de PostGIS ? Moi oui&amp;#8230; Alors √©tudions cela ensemble.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La documentation de PostGIS n&amp;rsquo;est pas tr√®s claire sur la question de la pr√©cision mais il faut savoir que toutes les coordonn√©es sont stock√©es sous forme d&amp;rsquo;entiers √† virgule flottante en double pr√©cision. La pr√©cision de PostGIS est donc li√©e √† ce format de stockage des num√©riques.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Virgule flottante et double pr√©cision&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce paragraphe est une simplification de la norme IEEE 754 pour vous aidez √† comprendre le fonctionnement des nombres √† virgules flottantes en double precision. Des impr√©cisions sont donc volontairement pr√©sentes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La &lt;strong&gt;virgule flottante&lt;/strong&gt; est une m√©thode de repr√©sentation d&amp;rsquo;un nombre en informatique qui s&amp;rsquo;apparente √† la notation scientifique (par exemple &lt;code&gt;1,234 * 10&lt;sup&gt;123&lt;/sup&gt;&lt;/code&gt;). Elle repose ainsi sur les √©l√©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;un signe : + ou -.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une mantisse : une valeur binaire qui d√©finie une fraction entre 0 et 1.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une base : un nombre entier (par exemple 2 ou 10).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un exposant : un nombre entier.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On obtient la valeur finale gr√¢ce √† l&amp;rsquo;op√©ration suivante : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;signe * 1,mantisse * base&lt;sup&gt;exposant&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quand on parle de &lt;strong&gt;double pr√©cision&lt;/strong&gt;, on fait alors r√©f√©rence √† un format particulier de nombre √† virgule flottante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;encodage se fait sur 64 bits :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1 bit pour le signe (&lt;code&gt;0&lt;/code&gt; = &lt;code&gt;+&lt;/code&gt; et &lt;code&gt;1&lt;/code&gt; = &lt;code&gt;-&lt;/code&gt;)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;11 bits pour l&amp;rsquo;exposant&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;53 bits pour la mantisse dont :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1 bit pour le d√©calage (voir le paragraphe sur la d√©normalisation)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;52 bits pour la valeur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La base est 2 car le stockage se fait sous forme binaire.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;exposant est d√©cal√©, par convention on ajoute 1023 a sa valeur r√©elle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le calcul d&amp;rsquo;un nombre en double pr√©cision est alors le suivant :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (1 + mantisse) * 2&lt;sup&gt;exposant-1023&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Dans le cas d&amp;rsquo;un nombre d√©normalis√© (voir le paragraphe d√©di√©), le calcul est le suivant :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (0 + mantisse) * 2&lt;sup&gt;1-1023&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * 0,mantisse * 2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Exposant&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;exposant est cod√© sur 11 bits ce qui permet les valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;0&lt;/code&gt; : &lt;code&gt;00000000000&lt;/code&gt; : valeur minimum&lt;br&gt;Valeur sp√©cifique r√©serv√©e pour repr√©senter le 0 ou un nombre d√©normalis√© (voir plus bas).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;1&lt;/code&gt; : &lt;code&gt;00000000001&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2046&lt;/code&gt; : &lt;code&gt;11111111110&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2047&lt;/code&gt; : &lt;code&gt;11111111111&lt;/code&gt; : valeur maximum&lt;br&gt;Valeur sp√©cifique r√©serv√©e pour repr√©sent√© les valeurs &lt;code&gt;infini&lt;/code&gt; ou &lt;code&gt;NaN&lt;/code&gt; (Not A Number : pas un nombre)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette valeur d&amp;rsquo;exposant est non sign√©e. Afin de permettre le stockage d&amp;rsquo;exposants n√©gatifs, un d√©calage est introduit. Dans le cas du double pr√©cision, ce d√©calage est de &lt;code&gt;1023&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, avec un exposant d√©cal√© de 1023, la plage d&amp;rsquo;exposants utilisables est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;De &lt;code&gt;0 - 1023&lt;/code&gt; = &lt;code&gt;-1022&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;√Ä &lt;code&gt;2046 - 1023&lt;/code&gt; = &lt;code&gt;1023&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Mantisse&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La mantisse est cod√©e sur 52 bits et repr√©sente une fraction comprise entre 0 et 1 sous la forme d&amp;rsquo;un nombre binaire. La mantisse peut ainsi avoir 2&lt;sup&gt;52&lt;/sup&gt; (4 503 599 627 370 496 = 4,503599627370496 √ó 10&lt;sup&gt;15&lt;/sup&gt;) valeurs diff√©rentes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le calcul de la valeur d√©cimale de la mantisse √† partir de la valeur binaire se fait comme suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Valeur binaire : &lt;code&gt;10100...00101&lt;/code&gt; (la partie tronqu√©e n&amp;rsquo;est compos√©e que de z√©ros).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur d√©cimale est √©gale √† la somme des puissances de deux multipli√©es par la valeur du bit correspondant :&lt;br&gt;&lt;code&gt;(&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-1&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-2&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-3&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-4&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-5&lt;/sup&gt;) + ... + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-48&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-49&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-50&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-51&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-52&lt;/sup&gt;)&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le r√©sultat pour notre exemple est ainsi &lt;code&gt;0,6250000000000011102230246251565404236316680908203125&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Combinaison exposant + mantisse&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une explication plus simple du fonctionnement de l&amp;rsquo;exposant combin√©e √† la mantisse est de parler de fen√™tres et de paliers. Imaginez que l&amp;rsquo;amplitude maximum permise par le type double pr√©cision soit d√©coup√©e en fen√™tres elles m√™mes sous d√©coup√©es en paliers avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;2045&lt;/code&gt; fen√™tres : 2047 exposants disponibles moins les exposants 0 et 2047 qui sont r√©serv√©s.&lt;br&gt;Une fen√™tre est donc born√©e entre deux puissances de 2 : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La premi√®re fen√™tre (exposant 1) d√©bute √† 2&lt;sup&gt;-1022&lt;/sup&gt; (2&lt;sup&gt;1-1023&lt;/sup&gt;) et s&amp;rsquo;√©tend jusqu‚Äô√† 2&lt;sup&gt;-1021&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La derni√®re fen√™tre (exposant 2046) d√©bute √† 2&lt;sup&gt;1023&lt;/sup&gt; (2&lt;sup&gt;2046-1023&lt;/sup&gt;) et s&amp;rsquo;√©tend jusqu&amp;rsquo;√† 2&lt;sup&gt;1024&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; paliers (&lt;code&gt;4 503 599 627 370 496&lt;/code&gt;) par fen√™tre : le nombre de valeurs de mantisse disponibles.&lt;br&gt;Pour chaque fen√™tre, un nombre de valeurs limit√© est ainsi disponible, la valeur d&amp;rsquo;incr√©mentation du palier (et donc la pr√©cision) d√©pend de la fen√™tre √† laquelle il se rattache.&lt;br&gt;Le calcul de la pr√©cision est le suivant : &lt;code&gt;(Taille de la fen√™tre)/(nombre de valeurs de la mantisse)&lt;/code&gt;&lt;br&gt;Par exemple &lt;code&gt;(2&lt;sup&gt;-1021&lt;/sup&gt; - 2&lt;sup&gt;-1022&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; pour la premi√®re fen√™tre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Calcul de la mantisse et de l&amp;rsquo;exposant depuis une valeur r√©elle&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible de calculer la mantisse et l&amp;rsquo;exposant d&amp;rsquo;une valeur r√©elle en suivant les √©tapes suivantes. la valeur d&amp;rsquo;exemple sera 1234,56789.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;√âtape 1 &amp;#8211; Convertir le nombre en binaire :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; Diviser la partie enti√®re par 2 puis noter le reste (0 ou 1), r√©p√©ter l&amp;rsquo;op√©ration jusqu‚Äô√† ce que l&amp;rsquo;op√©ration soit √©gale √† 0.&lt;br&gt;Le reste est not√© en commen√ßant par la droite.&lt;br&gt;Dans notre exemple, divisons successivement 1234 par 2‚ÄØen r√©cup√©rant le reste :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1234 √∑ 2 = 617‚Äâreste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;617 √∑ 2 = 308‚Äâreste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;308 √∑ 2 = 154‚Äâreste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;154 √∑ 2 = 77‚Äâreste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;77 √∑ 2 = 38‚Äâreste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;38 √∑ 2 = 19‚Äâreste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;19 √∑ 2 = 9‚Äâreste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;9 √∑ 2 = 4‚Äâreste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;4 √∑ 2 = 2‚Äâreste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2 √∑ 2 = 1‚Äâreste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1 √∑ 2 = 0‚Äâreste&amp;nbsp;1&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Donc, &lt;code&gt;1234&lt;sub&gt;10&lt;/sub&gt; ‚Äã= 10011010010&lt;sub&gt;2&lt;/sub&gt;‚Äã&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; Multiplier la partie d√©cimale par 2 puis noter la partie enti√®re (0 ou 1), r√©p√©ter l&amp;rsquo;op√©ration un grand nombre de fois (voir l&amp;rsquo;√©tape 2 pour d√©terminer ce nombre).&lt;br&gt;La partie enti√®re est not√©e en commen√ßant par la gauche.&lt;br&gt;Dans notre exemple, multiplions successivement 0,56789 par 2, en prenant la partie enti√®re de chaque produit‚ÄØ:&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt; 0,56789 √ó 2 = 1,13578 (partie&amp;nbsp;enti√®re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,13578 √ó 2 = 0,27156 (partie&amp;nbsp;enti√®re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,27156 √ó 2 = 0,54312 (partie&amp;nbsp;enti√®re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,54312 √ó 2 = 1,08624 (partie&amp;nbsp;enti√®re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,08624 √ó 2 = 0,17248 (partie&amp;nbsp;enti√®re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,17248 √ó 2 = 0,34496 (partie&amp;nbsp;enti√®re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,34496 √ó 2 = 0,68992 (partie&amp;nbsp;enti√®re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,68992 √ó 2 = 1,37984 (partie&amp;nbsp;enti√®re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&amp;#8230; on r√©p√®te l&amp;rsquo;op√©ration un nombre important de fois&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En continuant, &lt;code&gt;0,56789&lt;sub&gt;10&lt;/sub&gt;‚Äã = 100100010110000100111101001100011011100111...&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt; (il s&amp;rsquo;agit d&amp;rsquo;une approximation)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur totale approxim√©e est ainsi : &lt;code&gt;10011010010,100100010110000100111101001100011011100111&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;√âtape 2 &amp;#8211; Normaliser le nombre&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Normaliser le nombre sous la forme &lt;code&gt;1,xyz x 2&lt;sup&gt;abc&lt;/sup&gt;&lt;/code&gt;&lt;br&gt;Si le nombre d√©bute par &lt;code&gt;0,x&lt;/code&gt;, il faudra alors utiliser une puissance n√©gative.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur normalis√©e doit avoir 52 d√©cimales car la mantisse poss√®de 52 bits. Il vous faudra ajuster le nombre de calculs n√©cessaires √† l&amp;rsquo;√©tape 2. S&amp;rsquo;il ne vous est pas possible d&amp;rsquo;effectuer autant de calculs, compl√©tez la mantisse par la valeur 0 (des bits nuls).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour notre exemple :&lt;br&gt;&lt;code&gt;10011010010,100100010110000100111101001100011011100111&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt; = &lt;code&gt;1,0011010010100100010110000100111101001100011011100111 x 2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas du nombre &lt;code&gt;0,0003&lt;/code&gt;, la valeur binaire est &lt;code&gt;0,000000000000001010001101101110001011101011000111000100001100101101&lt;/code&gt;. &lt;br&gt;La valeur normalis√©e est donc &lt;code&gt;1,010001101101110001011101011000111000100001100101101 x 2&lt;sup&gt;-14&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si votre valeur normalis√©e n&amp;rsquo;a pas 52 d√©cimales, compl√©tez avec des 0 : &lt;code&gt;1,010011&lt;em&gt;0000000000000000000000000000000000000000000000&lt;/em&gt; x 2&lt;sup&gt;y&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;√âtape 3 &amp;#8211; Extraire les informations&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les informations sont disponibles presque imm√©diatement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;exposant vous est donn√© par l&amp;rsquo;exposant de la valeur normalis√©e. &lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La mantisse est constitu√©e de l&amp;rsquo;ensemble des valeurs suivant le ¬´¬†1.¬†¬ª.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans notre exemple : &lt;code&gt;1,0011010010100100010110000100111101001100011011100111 x 2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;exposant est &lt;code&gt;10&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;exposant d√©cal√© est &lt;code&gt;1033&lt;/code&gt; (&lt;code&gt;10 + 1023&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La fen√™tre d&amp;rsquo;exposant est &lt;code&gt;2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt; √† &lt;code&gt;2&lt;sup&gt;11&lt;/sup&gt;&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La valeur d&amp;rsquo;incr√©mentation et donc la pr√©cision est &lt;code&gt;(2&lt;sup&gt;11&lt;/sup&gt; - 2&lt;sup&gt;10&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;2,27373675443232059478759765625 √ó 10&lt;sup&gt;-13&lt;/sup&gt;&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La mantisse est : &lt;code&gt;0011010010100100010110000100111101001100011011100111&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La valeur approch√©e stock√©e est &lt;code&gt;1234,567890000000033978722058236598968505859375&lt;/code&gt; (calcul fait sur &lt;a href=&#34;https://www.wolframalpha.com/input?i=1.0011010010100100010110000100111101001100011011100111+base+2+x+2%5E10&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfram Alpha&lt;/a&gt;).&lt;br&gt;La valeur n&amp;rsquo;est pr√©cise qu&amp;rsquo;a &lt;code&gt;2,27 x 10&lt;sup&gt;-13&lt;/sup&gt;&lt;/code&gt; donc peut √™tre arrondie √† &lt;code&gt;1234,5678900000000&lt;/code&gt; soit &lt;code&gt;1234,56789&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Valeurs sp√©cifiques&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La combinaison de valeurs sp√©cifiques de la mantisse et de l&amp;rsquo;exposant permet de repr√©senter certaines valeurs :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 0&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse = 0&lt;/code&gt; : la valeur est &lt;code&gt;0&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 0&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse != 0&lt;/code&gt; : la valeur est d√©normalis√©&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 2047&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse = 0&lt;/code&gt; : la valeur est &lt;code&gt;infini&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 2047&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse != 0&lt;/code&gt; : &lt;code&gt;NaN&lt;/code&gt;, la valeur n&amp;rsquo;est pas un nombre&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;D√©normalisation&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La d√©normalisation permet de stocker des nombres plus petits que &lt;code&gt;2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt; (exposant le plus petit disponible). Pour cela, la m√©thode permettant de calculer la valeur finale change comme expos√© plus haut :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un nombre normalis√© se calcule de la fa√ßon suivante :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (1 + mantisse) * 2&lt;sup&gt;exposant-1023&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Alors qu&amp;rsquo;un nombre d√©normalis√© se calcule comme suivant : &lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (0 + mantisse) * 2&lt;sup&gt;1-1023&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * 0,mantisse * 2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sans entrer dans les d√©tails, le principe est de dire que dans ce mode de calcul, la valeur la plus haute de la mantisse (&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt;) est alors √©gale √† la valeur imm√©diatement avant la plus petite valeur en mode normalis√©. Il devient ainsi possible d&amp;rsquo;augmenter l&amp;rsquo;amplitude.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D&amp;rsquo;un point de vue technique, le bit de d√©calage de la mantisse est alors d√©fini √† 0 et les programmes traitent la valeur de la mantisse comme d√©normalis√©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Amplitude de valeurs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La combinaison de la mantisse et de l&amp;rsquo;exposant permet ainsi de calculer un ensemble de nombres avec une certaine pr√©cision. Cependant il n&amp;rsquo;est pas possible de repr√©senter la totalit√© des nombres r√©els.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une explication plus simple du fonctionnement est de parler de fen√™tres et de paliers. La plage de valeurs utilisables est d√©coup√©e en fen√™tres elles m√™mes sous d√©coup√©es en paliers avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;2045&lt;/code&gt; fen√™tres : 2047 exposants disponibles moins les exposants 0 et 2047 r√©serv√©s.&lt;br&gt;Une fen√™tre est donc born√©e entre deux puissances de 2 :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La premi√®re fen√™tre (exposant 1) d√©bute √† 2&lt;sup&gt;-1022&lt;/sup&gt; (2&lt;sup&gt;1-1023&lt;/sup&gt;) et s&amp;rsquo;√©tend jusqu‚Äô√† 2&lt;sup&gt;-1021&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La derni√®re fen√™tre (exposant 2046) d√©bute √† 2&lt;sup&gt;1023&lt;/sup&gt; (2&lt;sup&gt;2046-1023&lt;/sup&gt;) et s&amp;rsquo;√©tend jusqu&amp;rsquo;√† 2&lt;sup&gt;1024&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; paliers (&lt;code&gt;4 503 599 627 370 496&lt;/code&gt;) par fen√™tre : le nombre de valeurs de mantisses disponibles.&lt;br&gt;Pour chaque fen√™tre, un nombre de valeurs limit√© est ainsi disponible, la valeur d&amp;rsquo;incr√©mentation du palier (et donc la pr√©cision) d√©pend de la fen√™tre auquel le palier se rattache.&lt;br&gt;Le calcul de la pr√©cision est le suivant : &lt;code&gt;(Taille de la fen√™tre)/(nombre de valeurs de la mantisse)&lt;/code&gt;&lt;br&gt;Par exemple &lt;code&gt;(2&lt;sup&gt;-1021&lt;/sup&gt; - 2&lt;sup&gt;-1022&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; pour la premi√®re fen√™tre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Partant de ce constat, voici un tableau de plusieurs valeurs int√©ressantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fen√™tre d&amp;rsquo;exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur d&amp;rsquo;incr√©mentation d&amp;rsquo;un palier&lt;br&gt;= &lt;strong&gt;Pr√©cision&lt;/strong&gt;&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Mantisse&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur approch√©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;-1022&lt;/sup&gt; √† 2&lt;sup&gt;-1021&lt;/sup&gt; : &lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 x 10&lt;sup&gt;‚àí324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072013 x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus petit nombre normalis√©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;-1022&lt;/sup&gt; √† 2&lt;sup&gt;-1021&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 x 10&lt;sup&gt;‚àí324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072018 x 10&lt;sup&gt;‚àí308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre imm√©diatement apr√®s le pr√©c√©dent&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; √† 2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 √ó 10&lt;sup&gt;‚àí16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,0&lt;/td&gt;&lt;td&gt;Valeur 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; √† 2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 √ó 10&lt;sup&gt;‚àí16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,0000000000000002220446&lt;/td&gt;&lt;td&gt;Nombre imm√©diatement apr√®s le pr√©c√©dent&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; √† 2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 √ó 10&lt;sup&gt;‚àí16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;450 359 962 737 050&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,10000000000000008881784197001&lt;/td&gt;&lt;td&gt;Plus proche palier de 1.1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1074&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;51&lt;/sup&gt; √† 2&lt;sup&gt;52&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0,5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1075&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;52&lt;/sup&gt; √† 2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4 503 599 627 370 496&lt;/td&gt;&lt;td&gt;Le nombre suivant sera l&amp;rsquo;entier suivant&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1076&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;53&lt;/sup&gt; √† 2&lt;sup&gt;54&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2046&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;1023&lt;/sup&gt; √† 2&lt;sup&gt;1024&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,99584030953 √ó 10&lt;sup&gt;292&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,79769313486231550856 x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre imm√©diatement avant le plus grand nombre normalis√©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2046&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;1023&lt;/sup&gt; √† 2&lt;sup&gt;1024&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,99584030953 √ó 10&lt;sup&gt;292&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1 + (1 ‚àí 2&lt;sup&gt;‚àí52&lt;/sup&gt;))&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,79769313486231570814 x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus grand nombre normalis√©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce tableau nous permet de voir plusieurs √©l√©ments :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;tous les nombres ne peuvent √™tre repr√©sent√©s exactement, c&amp;rsquo;est le cas de 1,1 qui est approxim√© √† 1,100 000 000 000 000 088 817 841 970 01. &lt;br&gt;Si un calcul est r√©alis√© et qu&amp;rsquo;une valeur interm√©diaire est trouv√©e, alors la valeur sera arrondie au palier le plus proche (voir la partie sur la pr√©cision).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le passage d&amp;rsquo;une valeur √† celle imm√©diatement apr√®s n&amp;rsquo;est pas r√©gulier et d√©pend de l&amp;rsquo;ordre de grandeur d&amp;rsquo;un nombre.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le point pr√©c√©dent implique que la pr√©cision d&amp;rsquo;un nombre d√©pend de son ordre de grandeur et peut aller de plusieurs centaines de chiffres apr√®s la virgule √† plusieurs centaines de milliers en passant par un.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les valeurs √©tant extr√™mes, vous pouvez effectuer le calcul sur le site &lt;a href=&#34;https://www.wolframalpha.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfram Alpha&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un tableau de quelques nombres d√©normalis√©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Mantisse&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur d&amp;rsquo;incr√©mentation d&amp;rsquo;un palier&lt;br&gt;= &lt;strong&gt;Pr√©cision&lt;/strong&gt;&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur approch√©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 √ó 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 √ó 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus petit nombre d√©normalis√©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 √ó 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9,881 x 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre d√©normalis√© suivant&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 √ó 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072008 x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus grand nombre d√©normalis√©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce tableau nous permet de voir que :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;la valeur d&amp;rsquo;incr√©mentation des nombres d√©normalis√©s est la m√™me que le premier palier des nombres normalis√© car le calcul se base sur le m√™me exposant (la m√™me fen√™tre) : &lt;code&gt;-1022&lt;/code&gt; et la mantisse poss√®de toujours le m√™me nombre de valeurs (m√™me nombre de paliers)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le plus grand nombre d√©normalis√© est imm√©diatement avant la plus petite valeur normalis√©e ce qui permet une continuit√© des valeurs.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici enfin un dernier tableau pr√©sentant certains nombres sp√©cifiques :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th&gt;Mantisse&lt;/th&gt;&lt;th&gt;Valeur approch√©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;0,0&lt;/td&gt;&lt;td&gt;Z√©ro&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;Infini&lt;/td&gt;&lt;td&gt;Infini&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;&lt;em&gt;NaN&lt;/em&gt;&lt;/td&gt;&lt;td&gt;Premi√®re valeur de NaN&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;&lt;em&gt;NaN&lt;/em&gt;&lt;/td&gt;&lt;td&gt;Derni√®re valeur de NaN&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pr√©cision et chiffres significatifs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La pr√©cision repr√©sente la plus petite diff√©rence pouvant √™tre calcul√©e entre deux valeurs cons√©cutives. Cette pr√©cision varie selon l&amp;rsquo;ordre de grandeur de la valeur d&amp;rsquo;o√π le terme de ¬´¬†nombre √† virgule flottante¬†¬ª.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Chaque valeur √©tant li√©e √† une plage d&amp;rsquo;exposant (une fen√™tre) et chaque plage d&amp;rsquo;exposant pouvant √™tre d√©coup√©e par 2&lt;sup&gt;52&lt;/sup&gt; valeurs de mantisse (les paliers), la pr√©cision de chaque plage peut √™tre estim√©e par l&amp;rsquo;approximation suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;pr√©cision&lt;/code&gt; &lt;strong&gt;‚âÉ&lt;/strong&gt; &lt;code&gt;(valeur / 2&lt;sup&gt;52&lt;/sup&gt;)&lt;/code&gt; &lt;strong&gt;‚âÉ&lt;/strong&gt; &lt;code&gt;(valeur / (4,5 x 10&lt;sup&gt;15&lt;/sup&gt;))&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques ordres de grandeur de pr√©cision :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Plus petit nombre normalis√© : 2,225 x 10&lt;sup&gt;-308&lt;/sup&gt; : &lt;code&gt;10&lt;sup&gt;-324&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 : &lt;code&gt;10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 x 10&lt;sup&gt;16&lt;/sup&gt; : &lt;code&gt;1&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Plus grand nombre normalis√© : 1,798 x 10&lt;sup&gt;308&lt;/sup&gt; : &lt;code&gt;10&lt;sup&gt;292&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le terme de ¬´¬†nombre de chiffres significatifs¬†¬ª est √©galement utilis√© et repr√©sente le nombre de chiffre maximum qu&amp;rsquo;il faut pour percevoir une diff√©rence entre deux nombres en notation scientifique. Le nombre de chiffres significatifs est ici entre 15 et 16 car il faut au maximum 16 chiffres pour percevoir une diff√©rence entre deux nombres :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Plus petit nombre normalis√© : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;2,225 073 858 507 201 &lt;strong&gt;3&lt;/strong&gt; x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2,225 073 858 507 201 &lt;strong&gt;8&lt;/strong&gt; x 10&lt;sup&gt;‚àí308&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1,000 000 000 000 000 &lt;strong&gt;0&lt;/strong&gt; x 10&lt;sup&gt;0&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1,000 000 000 000 000 &lt;strong&gt;2&lt;/strong&gt; x 10&lt;sup&gt;0&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur dont l&amp;rsquo;incr√©mentation est de 1 √† chaque palier :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;4,503 599 627 370 49&lt;strong&gt;6&lt;/strong&gt; x 10&lt;sup&gt;15&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;4,503 599 627 370 49&lt;strong&gt;7&lt;/strong&gt; x 10&lt;sup&gt;16&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Plus grand nombre normalis√© : 1,798 x 10&lt;sup&gt;308&lt;/sup&gt; :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1,797 693 134 862 315 &lt;strong&gt;5&lt;/strong&gt; x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1,797 693 134 862 315 &lt;strong&gt;7&lt;/strong&gt; x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas de PostgreSQL (et d&amp;rsquo;autres programmes) la valeur exacte stock√©e est arrondie selon la pr√©cision permise pour celle-ci (gr√¢ce √† &lt;a href=&#34;https://github.com/postgres/postgres/blob/master/src/common/d2s.c#L346&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;cette fonction dans le code source&lt;/a&gt;). &lt;br&gt;Ainsi, pour la valeur &lt;code&gt;1,1&lt;/code&gt;, le stockage en double pr√©cision donne la valeur exacte &lt;code&gt;1,10000000000000008881784197001&lt;/code&gt; ce qui est pr√©cis √† 10&lt;sup&gt;-29&lt;/sup&gt;. Comme la pr√©cision permise pour l&amp;rsquo;ordre de grandeur de la valeur est de &lt;code&gt;2,22 x 10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt; pr√®s, la valeur renvoy√©e est arrondie selon cette pr√©cision donc &lt;code&gt;1,1000000000000000&lt;/code&gt; soit &lt;code&gt;1,1&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques ressources pour aller plus loin :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Des calculateurs de valeur en double pr√©cision :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.omnicalculator.com/other/floating-point&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.omnicalculator.com/other/floating-point&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.binaryconvert.com/result_double.html?hexadecimal=0000000000000000&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.binaryconvert.com/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un outil de calcul surpuissant pour rapidement convertir des donn√©es : &lt;a href=&#34;https://www.wolframalpha.com/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfra Alpha&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;article Wikip√©dia sur les nombre √† virgule flottante : &lt;a href=&#34;https://fr.wikipedia.org/wiki/Virgule_flottante&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://fr.wikipedia.org/wiki/Virgule_flottante&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un article int√©ressant sur les nombres √† virgule flottante : &lt;a href=&#34;https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;What Every Computer Scientist Should Know About Floating-Point Arithmetic&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La documentation de PostgreSQL sur les nombres √† virgule flottante : &lt;a href=&#34;https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-FLOAT&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-FLOAT&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pr√©cision sous PostGIS&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pr√©cision globale&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les coordonn√©es sous PostGIS sont stock√©es en utilisant le type double pr√©cision de PostgreSQL. La pr√©cision des valeurs d√©pend donc de l&amp;rsquo;ordre de grandeur et varie selon :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;le syst√®me de projection.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;la valeur de la coordonn√©e (et donc la position).&lt;br&gt;En r√®gle g√©n√©rale, il est possible d&amp;rsquo;appliquer la formule suivante pour avoir une id√©e de la pr√©cision possible : &lt;code&gt;10&lt;sup&gt;-16&lt;/sup&gt; x la valeur&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques √©l√©ments de pr√©cision en lien avec diff√©rents syst√®mes de coordonn√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;WGS84 (EPSG:4326) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Coordonn√©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -180 √† 180&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pr√©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; √† 10&lt;sup&gt;-14&lt;/sup&gt; (sauf pour les coordonn√©es entre -1 et 1 qui peuvent atteindre une pr√©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Coordonn√©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de -90 √† 90&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pr√©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; √† 10&lt;sup&gt;-14&lt;/sup&gt; (sauf pour les coordonn√©es entre -1 et 1 qui peuvent atteindre une pr√©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;WGS 84 / Pseudo-Mercator (EPSG:3857) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Coordonn√©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -20037508,34 √† 20037508,34&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pr√©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; √† 10&lt;sup&gt;-9&lt;/sup&gt; (sauf pour les coordonn√©es entre -1 et 1 qui peuvent atteindre une pr√©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Coordonn√©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de -20048966,1 √† 20048966,1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pr√©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; √† 10&lt;sup&gt;-9&lt;/sup&gt; (sauf pour les coordonn√©es entre -1 et 1 qui peuvent atteindre une pr√©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Lambert 93 (EPSG:2154) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Coordonn√©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -378305,81 √† 1320649,57 (entre environ 100 000 et 1 100 000 pour la France m√©tropolitaine)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pr√©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; √† 10&lt;sup&gt;-10&lt;/sup&gt; (sauf pour les coordonn√©es entre -1 et 1 qui peuvent atteindre une pr√©cision de 10&lt;sup&gt;-324&lt;/sup&gt; mais qui ne sont presque jamais utilis√©es).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Coordonn√©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de 6005281,2 √† 7235612,72  (entre environ 6 033 000 et 7 130 000 pour la France m√©tropolitaine)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pr√©cision : 10&lt;sup&gt;-10&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le Lambert 93, la pr√©cision est entre 10&lt;sup&gt;-10&lt;/sup&gt; soit 0,1 nanom√®tres (1 √•ngstr√∂m, la taille d&amp;rsquo;une mol√©cule) et 10&lt;sup&gt;-16&lt;/sup&gt; soit 0,1 femtom√®tre (la taille d&amp;rsquo;un nucl√©on : proton ou neutron) ce qui suffit largement √† positionner n&amp;rsquo;importe quoi&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour mieux visualiser la pr√©cision, il est possible de tester quelques requ√™tes dans PostGIS. Dirigeons nous vers Chamonix en Haute Savoie o√π se trouve un point poss√©dant les coordonn√©es suivantes en Lambert 93 : X = 1000000 et Y = 6543210. Il s&amp;rsquo;agit de la terrasse d&amp;rsquo;un h√¥tel.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_text,&#xA;&#x9;ST_AsText(geom_text::geometry(point, 2154)) AS geom&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000.0000000001 6543210.000000001)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000.00000000001 6543210.0000000001)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000.00000000008 6543210.0000000008)&#39;)&#xA;) AS t (id, geom_text)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le r√©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;POINT (1000000 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;POINT (1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000008 6543210.0000000008)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce que l&amp;rsquo;on observe c&amp;rsquo;est que lorsqu&amp;rsquo;une coordonn√©e dont la pr√©cision est sup√©rieure √† ce qui est permis par le type double pr√©cision, alors celle-ci est automatiquement arrondie :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Dans le cas de la ligne 2, la valeur des coordonn√©es est permise par le type double pr√©cision, les coordonn√©es sont conserv√©es telles quelles avec une pr√©cision ¬´¬†√† la mol√©cule pr√®s¬†¬ª.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Dans le cas de la ligne 3, les coordonn√©es X et Y poss√®dent une valeur dont l&amp;rsquo;ordre de grandeur est 10&lt;sup&gt;6&lt;/sup&gt;. La pr√©cision maximum est donc de 10&lt;sup&gt;-10&lt;/sup&gt; (&lt;code&gt;10&lt;sup&gt;6&lt;/sup&gt; x 10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt;). Les valeurs sont donc arrondies √† 10&lt;sup&gt;-10&lt;/sup&gt;. Notez que pour la valeur de Y, la valeur de la partie enti√®re impose un arrondi √† 10&lt;sup&gt;-9&lt;/sup&gt; plut√¥t que 10&lt;sup&gt;-10&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pour la ligne 4, le principe est le m√™me mais l&amp;rsquo;arrondi se faisant au plus proche, nous r√©cup√©rons la valeur au dessus.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que la transformation des coordonn√©es dans le syst√®me WGS 84 (EPSG:4326) permet d&amp;rsquo;utiliser plus de d√©cimales car les valeurs poss√®dent un ordre de grandeur plus faible :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;ST_AsText(&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#39;POINT (1000000 6543210)&#39;::geometry(point, 2154), &#xA;&#x9;&#x9;&#x9;4326&#xA;&#x9;&#x9;)&#xA;&#x9;) AS geom&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le r√©sultat est &lt;code&gt;POINT(6.87241320435217 45.92236395248839)&lt;/code&gt; : la pr√©cision est de 10&lt;sup&gt;-14&lt;/sup&gt; pour les coordonn√©es X et Y. Ici aussi vous pouvez voir que selon la valeur de la partie enti√®re, la pr√©cision autoris√©e oscille entre 10&lt;sup&gt;-16&lt;/sup&gt; et 10&lt;sup&gt;-15&lt;/sup&gt; multipli√©e par l&amp;rsquo;ordre de grandeur.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pr√©cision lors des calculs&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les calculs sous PostGIS sont r√©alis√©s en double pr√©cision et donc avec la pr√©cision d√©taill√©e pr√©c√©demment. Par exemple, une distance entre deux objets aura une pr√©cision qui d√©pendra de l&amp;rsquo;ordre de grandeur de la valeur elle-m√™me.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;il s&amp;rsquo;agit de comparer des g√©om√©tries, le cas est plus complexe. Nous allons √©tudier la fonction &lt;code&gt;ST_Intersects&lt;/code&gt; mais le principe est le m√™me pour les autres fonctions de relation spatiale.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Relation sommet √† sommet : il s&amp;rsquo;agit simplement de comparer les coordonn√©es entres-elles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_text,&#xA;&#x9;ST_AsText(geom_text::geometry(point, 2154)) AS geom,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_text::geometry(point, 2154),&#xA;&#x9;&#x9;&#39;POINT(1000000 6543210)&#39;::geometry(geometry, 2154)&#xA;&#x9;) AS st_intersects&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000.0000000001 6543210)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000.00000000001 6543210)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000.00000000008 6543210)&#39;),&#xA;&#x9;(5, &#39;POINT (999999.99999999990 6543210)&#39;),&#xA;&#x9;(6, &#39;POINT (999999.99999999997 6543210)&#39;)&#xA;) AS t (id, geom_text)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;POINT (1000000 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;POINT (1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000008 6543210.0000000008)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td&gt;POINT (999999.99999999990 6543210)&lt;/td&gt;&lt;td&gt;POINT(999999.9999999999 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td&gt;POINT (999999.99999999997 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, la requ√™te pr√©c√©dente permet de visualiser que la correspondance doit √™tre exacte. Lorsqu&amp;rsquo;une coordonn√©es est ¬´¬†trop pr√©cise¬†¬ª, elle est simplement arrondie afin de pouvoir √™tre trait√©e puis compar√©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que dans le cas du type &lt;code&gt;geography&lt;/code&gt;, deux g√©om√©tries s&amp;rsquo;intersectent si elles sont distantes de moins de 0,00001 m√®tre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Relation sommet √† segment : ce cas est plus complexe car il faut calculer la distance entre un sommet r√©el et un point virtuel situ√© sur le segment. Pour faire cela, plusieurs calculs sont r√©alis√©s, tous en double pr√©cision. Ainsi, la distance doit √™tre inf√©rieur √† la pr√©cision permise par les coordonn√©es des objets compar√©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ces op√©rations peuvent d&amp;rsquo;ailleurs entrainer des erreurs en raison de la nature impr√©cise des nombre en double pr√©cision. Il est donc possible d&amp;rsquo;avoir de faux n√©gatifs : deux objets consid√©r√©s comme ne s&amp;rsquo;intersectant pas alors qu&amp;rsquo;ils le sont ou inversement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requ√™te qui compare un point avec des lignes tr√®s proches de celui-ci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_line AS geom_text,&#xA;&#x9;ST_AsText(geom_line::geometry(linestring, 2154)),&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_distance,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.0000000001)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.000000001)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.00000001)&#39;)&#xA;) AS t (id, geom_pt, geom_line)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les objets sont align√©s selon un axe globalement Est-Ouest. La variation de la coordonn√©e Y du sommet le plus √† l&amp;rsquo;Est de la ligne permet de d√©caler l√©g√®rement celle-ci par rapport au point test√© pour v√©rifier l&amp;rsquo;intersection des deux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le r√©sultat est le suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.00000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210.00000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0000000055879354&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne 1 est une intersection parfaite. Vous pouvez observer que les g√©om√©tries trop pr√©cises dans le cas de la ligne 2 sont ici aussi arrondies. En revanche, la ligne 3 met en valeur le fait que les arrondis de calcul entrainent une distance nulle alors que les objets ne s&amp;rsquo;intersectent pas ; en r√©alit√©, la distance est infinit√©simale et est donc arrondie √† 0. La ligne 4 montre un √©cart tr√®s petit.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dernier exemple int√©ressant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_line AS geom_text,&#xA;&#x9;ST_AsText(geom_line::geometry(linestring, 2154)) AS geom_line,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_distance,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) * 1e100 AS st_distance_xe100,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) * 1e308 AS st_distance_xe308,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects,&#xA;&#x9;st_astext(&#xA;&#x9;&#x9;ST_LineInterpolatePoint(&#xA;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;ST_LineLocatePoint(&#xA;&#x9;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;&#x9;geom_pt::geometry(point, 2154)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;)&#xA;&#x9;) AS geom_point_proj,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;ST_LineInterpolatePoint(&#xA;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;ST_LineLocatePoint(&#xA;&#x9;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;&#x9;geom_pt::geometry(point, 2154)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects_proj&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-100)&#39;),&#xA;&#x9;(2, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-323)&#39;),&#xA;&#x9;(3, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-324)&#39;)&#xA;) AS t (id, geom_pt, geom_line)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;J&amp;rsquo;ai repris l&amp;rsquo;exemple d&amp;rsquo;une ligne avec un point mais l&amp;rsquo;ai amplifi√© : une ligne qui d√©bute en X = 0 et finie en X = 10 est compar√©e √† un point positionn√© en X = 2. Pour d√©caler la ligne du point, la fin de la ligne est d√©plac√©e selon l&amp;rsquo;axe Y d&amp;rsquo;une distance tr√®s petite (en limite du type double pr√©cision).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je calcule la distance, ainsi que la distance multipli√©e par 10&lt;sup&gt;100&lt;/sup&gt; et 10&lt;sup&gt;300&lt;/sup&gt; pour √©viter de passer sous la tol√©rance d&amp;rsquo;affichage des double pr√©cision de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je d√©termine √©galement un point projet√© sur la ligne √† partir du point test√©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom_line&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance_xe100&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance_xe300&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;th&gt;geom_point_proj&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects_proj&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 0)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-100)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 1e-100)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;sup&gt;99&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;td&gt;POINT(1 1e-101)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-323)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 1e-323)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-324)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que le point projet√© n&amp;rsquo;intersecte la ligne sur laquelle il est cens√© √™tre positionn√© que dans le premier cas. Dans le cas d&amp;rsquo;un d√©calage, m√™me infinit√©simale (dans le cas de la ligne 2, la distance entre la ligne et le point projet√© est tellement infime qu&amp;rsquo;il n&amp;rsquo;est pas calculable avec PostGIS), il n&amp;rsquo;y a pas intersection.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez essayer avec des d√©calages plus importants (de l&amp;rsquo;ordre de 1 m par exemple) mais tr√®s souvent il n&amp;rsquo;y aura pas d&amp;rsquo;intersection car un point projet√© sur un segment de ligne n&amp;rsquo;est qu&amp;rsquo;une approximation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Pour avoir une intersection fiable, il doit y avoir une correspondance topologique : un sommet avec un sommet.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;R√©duire la pr√©cision&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme avoir une coh√©rence topologique ne vous int√©resse pas&amp;#8230; vous voulez r√©duire la pr√©cision. Soit !&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il n&amp;rsquo;est pas possible de sp√©cifier une pr√©cision √† utiliser pour une base de donn√©es avec PostGIS. D&amp;rsquo;ailleurs le simple fait de vouloir contraindre la pr√©cision des coordonn√©es doit amener √† r√©fl√©chir sur les propositions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Il ne faut pas confondre pr√©cision de la mesure et pr√©cision des coordonn√©es : une mesure effectu√©e avec un GPS ayant une pr√©cision de ¬± 10 m√®tres doit √™tre stock√©e telle que mesur√©e. &lt;br&gt;Par exemple X = 33,5 m, alors la valeur r√©elle est comprise entre 23,5 et 43,5 m, r√©duire la pr√©cision √† 10 m√®tres pr√®s entrainerait alors une perte d&amp;rsquo;information.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Lorsque les coordonn√©es d&amp;rsquo;un point sont calcul√©es par interpolation, la valeur peut avoir plus de d√©cimales que les valeurs utilis√©es dans l&amp;rsquo;interpolation. &lt;br&gt;Par exemple, deux points distants dont les coordonn√©es sont au m√®tre pr√®s (pas de d√©cimales) peuvent entrainer le calcul d&amp;rsquo;un point m√©dian avec des coordonn√©es √† d√©cimales.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La r√©duction de la pr√©cision au niveau des coordonn√©es implique une perte de pr√©cision des valeurs issues de calculs √† partir des coordonn√©es (aire, p√©rim√®tre&amp;#8230;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La reprojection des coordonn√©es peut impliquer un changement du nombre de d√©cimales. &lt;br&gt;Par exemple, les coordonn√©es en WGS 84 (en degr√©s) impliquent un nombre plus important de d√©cimales que les coordonn√©es en Lambert 93 (en m√®tres).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe cependant plusieurs m√©thodes pour r√©duire la pr√©cision des coordonn√©es ou des calculs associ√©s aux coordonn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Pr√©cision des coordonn√©es&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_SnapToGrid.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_SnapToGrid&lt;/a&gt;&lt;/code&gt; : d√©place les sommets de g√©om√©tries en entr√©e sur une grille dont le pas est d√©fini. Les points cons√©cutifs d√©plac√©s au m√™me endroit ainsi que les g√©om√©tries nulles sont supprim√©s. Attention, des g√©om√©tries invalides peuvent √™tre cr√©√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_ReducePrecision.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_ReducePrecision&lt;/a&gt;&lt;/code&gt; : r√©duit la pr√©cision des coordonn√©es en les arrondissant selon la pr√©cision choisie. Les g√©om√©tries cr√©√©es sont toutes valides.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_QuantizeCoordinates.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_QuantizeCoordinates&lt;/a&gt;&lt;/code&gt; : r√©duit la pr√©cision des coordonn√©es tout en op√©rant un traitement sp√©cifique sur leur stockage afin d&amp;rsquo;en augmenter la compressibilit√©. Pour cela, les valeurs des bits non significatifs de la mantisse sont d√©finies √† z√©ro. Il s&amp;rsquo;agit de la meilleure m√©thode pour r√©duire le poids d&amp;rsquo;une g√©om√©trie.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Pr√©cision des calculs&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la pr√©cision des calculs, c&amp;rsquo;est diff√©rents. En effet, PostGIS utilise toujours la pr√©cision permise par le type double pr√©cision et seules quelques fonctions permettent d&amp;rsquo;utiliser une tol√©rance. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les fonctions qui permettent de sp√©cifier une tol√©rance (le param√®tre gridsize) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;ST_Union&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_UnaryUnion&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Difference&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Intersection&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_SymDifference&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Subdivide&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cependant, dans la plupart des cas c&amp;rsquo;est la m√©thode qu&amp;rsquo;il faut adapter. Il s&amp;rsquo;agit ainsi d&amp;rsquo;utiliser une fonction r√©duisant la pr√©cision des coordonn√©es en conjonction d&amp;rsquo;une fonction classique ou d&amp;rsquo;utiliser une autre m√©thode que celle habituelle. Voici quelques cas et adaptations possibles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Intersects&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour tester si deux g√©om√©tries s&amp;rsquo;intersectent avec une certaine tol√©rance, il faut utiliser la fonction &lt;code&gt;ST_DWithin()&lt;/code&gt; qui permet de d√©terminer si deux g√©om√©tries sont situ√©es √† une certaine distance l&amp;rsquo;une de l&amp;rsquo;autre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Covers&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour tester le recouvrement de deux g√©om√©tries, vous pouvez appliquer une zone tampon √† la g√©om√©trie ¬´¬†englobante¬†¬ª avec la fonction &lt;code&gt;ST_Buffer()&lt;/code&gt;. Par exemple, une zone tampon de 5 m√®tres permet de savoir si une g√©om√©trie englobe une autre √† 5 m√®tres pr√®s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Touches&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Deux g√©om√©tries se touchent si elle s&amp;rsquo;intersectent mais pas leurs ¬´¬†int√©rieurs¬†¬ª. Introduire une tol√©rance implique alors d&amp;rsquo;autoriser un l√©ger chevauchement des int√©rieurs. Il faudra alors utiliser la fonction &lt;code&gt;ST_DWithin&lt;/code&gt; pour valider que les g√©om√©tries soient proches l&amp;rsquo;une de l‚Äôautre. Il faut ensuite valider que l&amp;rsquo;intersection des deux g√©om√©tries soit minime en calculant l&amp;rsquo;aire d&amp;rsquo;intersection avec &lt;code&gt;ST_Area(ST_Intersection())&lt;/code&gt; et en la comparant √† l&amp;rsquo;aire de chacune des g√©om√©tries. Il conviendra de d√©finir un pourcentage maximum (par exemple ¬´¬†moins de 1% d&amp;rsquo;intersection¬†¬ª).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Relation topologique : cas g√©n√©ral&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le calcul des relations topologiques de mani√®re g√©n√©rale, tout va d√©pendre du r√©sultat voulu. Selon les cas, il faudra r√©duire la pr√©cision des coordonn√©es avant d&amp;rsquo;utiliser la fonction ou encore combiner plusieurs autres fonctions permettant de d√©terminer la relation voulue.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Distance&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le calcul d&amp;rsquo;une distance n&amp;rsquo;est pas √† proprement parl√© li√© √† une tol√©rance mais la pr√©cision du r√©sultat peut √™tre modifi√© avec la fonction &lt;code&gt;round()&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques liens pour approfondir le sujet :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un excellent article de Lo√Øc Bartoletti sur Geotribu sur le sujet de la tol√©rance dans PostGIS : &lt;a href=&#34;https://geotribu.fr/articles/2024/2024-07-16_de-la-tolerance-en-sig-geometrie-00-annonce/&#34;&gt;https://geotribu.fr/articles/2024/2024-07-16_de-la-tolerance-en-sig-geometrie-00-annonce/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le type PostGIS &lt;code&gt;geometry&lt;/code&gt; : &lt;a href=&#34;https://postgis.net/docs/using_postgis_dbmanagement.html#PostGIS_Geometry&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://postgis.net/docs/using_postgis_dbmanagement.html#PostGIS_Geometry&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Discussion sur l&amp;rsquo;impl√©mentation (future) d&amp;rsquo;une tol√©rance dans PostGIS : &lt;a href=&#34;https://trac.osgeo.org/postgis/wiki/ToleranceDiscussion#no1&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://trac.osgeo.org/postgis/wiki/ToleranceDiscussion#no1&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un article sur l&amp;rsquo;origine de &lt;code&gt;ST_QuantizeCoordinates()&lt;/code&gt; : &lt;a href=&#34;http://www.danbaston.com/posts/2018/02/15/optimizing-postgis-geometries.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;http://www.danbaston.com/posts/2018/02/15/optimizing-postgis-geometries.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la possibilit√© de d√©finir une r√©solution spatiale : &lt;a href=&#34;https://gis.stackexchange.com/questions/424798/is-it-possible-to-define-a-spatial-resolution-for-a-geometry-column-in-postgis&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://gis.stackexchange.com/questions/424798/is-it-possible-to-define-a-spatial-resolution-for-a-geometry-column-in-postgis&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la pr√©cision des fonctions dans PostGIS : &lt;a href=&#34;https://stackoverflow.com/questions/70258656/postgis-precision-of-functions&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://stackoverflow.com/questions/70258656/postgis-precision-of-functions&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la mailing list PostGIS √† propos de la pr√©cision du WKT : &lt;a href=&#34;https://lists.osgeo.org/pipermail/postgis-users/2008-May/019606.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://lists.osgeo.org/pipermail/postgis-users/2008-May/019606.html&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/soyons-precis-avec-postgis" rel="alternate"></link>
    <summary type="html">Vous √™tes vous d√©j√† demand√© quelle √©tait la pr√©cision de PostGIS ? Moi oui... Alors √©tudions cela ensemble.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Monitorer PostgreSQL avec Prometheus et Grafana</title>
    <updated>2024-05-21T19:35:50Z</updated>
    <id>tag:blog.arthurbazin.com,2024-05-21:/it/monitorer-postgresql-avec-prometheus-et-grafana</id>
    <content type="html">&#xA;&lt;p&gt;Plus une instance PostgreSQL est utilis√©e et plus il devient crucial de la monitorer. De nombreuses solutions existent, je vais vous en pr√©senter une que j&amp;rsquo;utilise r√©guli√®rement et qui repose sur Prometheus et Grafana et qui permet de faire de beaux tableaux de bord.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-3303&#34; style=&#34;width:768px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-300x159.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-768x407.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1536x813.png 1536w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1.png 1611w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Voila un tr√®s beau tableau de bord &lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f609.png&#34; alt=&#34;üòâ&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Pourquoi cette solution ? Car il est possible de monitorer d&amp;rsquo;autres programmes ainsi que des serveurs. Il s&amp;rsquo;agit donc d&amp;rsquo;une solution tr√®s modulaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Grafana&lt;/strong&gt; est un logiciel libre de visualisation de donn√©es. Il permet notamment la r√©alisation de tableaux de bord et s&amp;rsquo;interface parfaitement avec Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Prometheus &lt;/strong&gt;est un logiciel libre d‚Äôenregistrement de m√©triques en temps r√©el. Il permet l&amp;rsquo;interrogation des donn√©es √† l&amp;rsquo;aide d&amp;rsquo;un langage simple (PromQL) et de g√©n√©rer des alertes si besoin.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Exporters&lt;/strong&gt; : il s&amp;rsquo;agit de petits logiciels qui permettent de r√©cup√©rer des donn√©es en temps r√©el dans un format compr√©hensible par Prometheus. Il en existe de toutes sortes dont celui pour PostgreSQL : &lt;strong&gt;Postgres Exporter&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Exporters&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Postgres Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Postgres Exporter est l&amp;rsquo;outil qui va interroger votre instance PostgreSQL est r√©cup√©rer les m√©triques n√©cessaires. Il est en g√©n√©ral install√© sur le serveur sur lequel se trouve l&amp;rsquo;instance PostgreSQL mais il peut √™tre installer ailleurs, il doit simplement pouvoir acc√©der √† la base de donn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que Postgres Exporter g√®re le multi-instance mais ce n&amp;rsquo;est pour l&amp;rsquo;instant pas recommand√© de l&amp;rsquo;utiliser. Il faudra donc autant de processus que d&amp;rsquo;instance PostgreSQL (pour rappel, une instance de PostgreSQL peut poss√©der plusieurs bases de donn√©es).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, il n&amp;rsquo;est pas possible de s√©curiser l&amp;rsquo;acc√®s aux donn√©es export√©es par Postgres Exporter directement. L&amp;rsquo;outil ne g√®re pas l&amp;rsquo;authentification, il faut donc utiliser des r√®gle de pare-feu ou un serveur web frontal pour √©viter que n&amp;rsquo;importe qui puisse voir les donn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par t√©l√©charger le logiciel depuis &lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le projet GitHub&lt;/a&gt; (dans les Releases).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le d√©zipper puis de la placer l√† o√π vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cr√©ez ensuite un fichier &lt;code&gt;start_127.0.0.1_5432.bat&lt;/code&gt; dans le r√©pertoire de Postgres Exporter avec le contenu suivant (en rempla√ßant l&amp;rsquo;url d&amp;rsquo;acc√®s √† votre base de donn√©es dans le fichier et dans son nom) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;@echo off&#xA;&#xA;REM D√©claration d&#39;une variable pour identifier la source de donn√©es&#xA;set DATA_SOURCE_NAME=postgresql://postgres:postgres@127.0.0.1:5432/postgres?sslmode=disable&#xA;&#xA;REM Lancement du processus postgres_exporter.exe avec diff√©rentes options&#xA;postgres_exporter.exe ^&#xA;  --web.listen-address=:9187 \&#xA;  --collector.database_wraparound ^&#xA;  --collector.locks ^&#xA;  --collector.long_running_transactions ^&#xA;  --collector.postmaster ^&#xA;  --collector.stat_activity_autovacuum ^&#xA;  --collector.stat_bgwriter ^&#xA;  --collector.stat_database ^&#xA;  --collector.stat_statements ^&#xA;  --collector.stat_user_tables ^&#xA;  --collector.statio_user_indexes ^&#xA;  --collector.statio_user_tables ^&#xA;  --collector.wal&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce script permet deux choses :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;de g√©rer la variable &lt;code&gt;DATA_SOURCE_NAME&lt;/code&gt; qui permet de d√©clarer la base de donn√©es √† surveiller.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;de d√©clarer et √©ventuellement modifier facilement les options de surveillance (&lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter?tab=readme-ov-file#flags&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;d√©taill√©es ici&lt;/a&gt;).&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9187&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donn√©es pourront √™tre r√©cup√©r√©es via HTTP.&lt;br&gt;9187 est le port par d√©faut mais vous pouvez en attribuer un autre si celui-ci est d√©j√† utilis√© ou si vous avez plusieurs instances √† surveiller.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La surveillance peut ensuite d√©marrer en lan√ßant le fichier &lt;code&gt;bat&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en r√©cup√©rant les donn√©es collect√©es en vous rendant √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9187&lt;/code&gt;, vous devriez r√©cup√©rer quelques chose qui ressemble √† ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005124&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.00158&#xA;go_gc_duration_seconds_sum 8.0821208&#xA;go_gc_duration_seconds_count 30800&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 16&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi √™tre cr√©√© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de cr√©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM, si vous avez pr√©vu d&amp;rsquo;installer Grafana, vous pouvez attendre de l&amp;rsquo;avoir fait plut√¥t que de t√©l√©charger NSSM.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois r√©cup√©rer, vous pourrez cr√©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Prometheus - Postgres Exporter - 127.0.0.1:5432&#34; &#34;C:\chemin\vers\start_127.0.0.1_5432.bat&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Prometheus - Postgres Exporter - 127.0.0.1:5432&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) d√©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Cr√©ation d&#39;un utilisateur d√©di√© (si vous avez d√©j√† PostgreSQL install√© il est probable que l&#39;utilisateur existe d√©j√†)&#xA;sudo useradd postgres --shell /bin/bash&#xA;&#xA;# Cr√©ation d&#39;un r√©pertoire d√©di√©&#xA;sudo mkdir /opt/postgres_exporter&#xA;&#xA;# T√©l√©chargement de Postgres_exporter&#xA;# Attention √† la verion, dans le doute RDV sur le projet GitHub : https://github.com/prometheus-community/postgres_exporter&#xA;sudo wget -P /opt/postgres_exporter https://github.com/prometheus-community/postgres_exporter/releases/download/v0.15.0/postgres_exporter-0.15.0.linux-amd64.tar.gz&#xA;&#xA;# D√©crompression&#xA;sudo tar xvzf /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64.tar.gz -C /opt/postgres_exporter&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du r√©pertoire&#xA;sudo mv /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64 /opt/postgres_exporter/postgres_exporter&#xA;&#xA;# Gestion du propri√©taire des fichiers&#xA;sudo chown postgres:postgres -R /opt/postgres_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cr√©ons le fichier de configuration des variables d&amp;rsquo;environnement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/postgres_exporter/postgres_exporter_127.0.0.1_5432.env&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez alors la configuration suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# BDD √† monitorer&#xA;DATA_SOURCE_NAME=&#34;postgresql://postgres:postgres@127.0.0.1:5432/?sslmode=disable&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui g√®rera Postgres Exporter. Ajoutez une information sur l&amp;rsquo;instance monitor√©e car postgres_exporter ne g√®re pas correctement le multi-instance.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/postgres_exporter_127.0.0.1_5432.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les √©l√©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus exporter for Postgresql&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=postgres&#xA;Group=postgres&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;&#xA;WorkingDirectory=/opt/postgres_exporter&#xA;EnvironmentFile=/opt/postgres_exporter/postgres_exporter_127.0.0.1_5432.env&#xA;ExecStart=/opt/postgres_exporter/postgres_exporter/postgres_exporter \&#xA;    --web.listen-address=:9187 \&#xA;    --collector.database_wraparound \&#xA;    --collector.locks \&#xA;    --collector.long_running_transactions \&#xA;    --collector.postmaster \&#xA;    --collector.stat_activity_autovacuum \&#xA;    --collector.stat_bgwriter \&#xA;    --collector.stat_database \&#xA;    --collector.stat_statements \&#xA;    --collector.stat_user_tables \&#xA;    --collector.statio_user_indexes \&#xA;    --collector.statio_user_tables \&#xA;    --collector.wal&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous int√©grons dans la ligne de commande diff√©rentes options de surveillance (&lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter?tab=readme-ov-file#flags&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;d√©taill√©es ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34; id=&#34;block-013a31d6-fbb5-4dd0-8c9a-f05ee7df2cad&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9187&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donn√©es pourront √™tre r√©cup√©r√©es via HTTP.&lt;br&gt;9187 est le port par d√©faut mais vous pouvez en attribuer un autre si celui-ci est d√©j√† utilis√© ou si vous avez plusieurs instances √† surveiller.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour cr√©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les param√®tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au d√©marrage&#xA;sudo systemctl enable postgres_exporter_127.0.0.1_5432.service&#xA;&#xA;# D√©marrer le service&#xA;sudo systemctl start postgres_exporter_127.0.0.1_5432&#xA;&#xA;# Tester le d√©marrage du service&#xA;sudo systemctl status postgres_exporter_127.0.0.1_5432&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u postgres_exporter_127.0.0.1_5432.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en r√©cup√©rant les donn√©es collect√©es en vous rendant √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9187&lt;/code&gt;. Vous devriez r√©cup√©rer quelques chose qui ressemble √† ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005124&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.00158&#xA;go_gc_duration_seconds_sum 8.0821208&#xA;go_gc_duration_seconds_count 30800&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 16&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Node Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Node Exporter est l&amp;rsquo;outil qui va collecter les m√©triques du syst√®me Linux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, il n&amp;rsquo;est pas possible de s√©curiser l&amp;rsquo;acc√®s aux donn√©es export√©es par Node Exporter directement. L&amp;rsquo;outil ne g√®re pas l&amp;rsquo;authentification, il faut donc utiliser des r√®gle de pare-feu ou un serveur web frontal pour √©viter que n&amp;rsquo;importe qui puisse voir les donn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) d√©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Cr√©ation d&#39;un utilisateur d√©di√©&#xA;sudo useradd node_exporter --shell /bin/bash&#xA;&#xA;# Cr√©ation d&#39;un r√©pertoire d√©di√©&#xA;sudo mkdir /opt/node_exporter&#xA;&#xA;# T√©l√©chargement de Node_exporter&#xA;# Attention √† la verion, dans le doute RDV sur le site de Prometheus : https://prometheus.io/download/#node_exporter&#xA;sudo wget -P /opt/node_exporter https://github.com/prometheus/node_exporter/releases/download/v1.8.1/node_exporter-1.8.1.linux-amd64.tar.gz&#xA;&#xA;# D√©crompression&#xA;sudo tar xvzf /opt/node_exporter/node_exporter-1.8.1.linux-amd64.tar.gz -C /opt/node_exporter&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/node_exporter/node_exporter-1.8.1.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du r√©pertoire&#xA;sudo mv /opt/node_exporter/node_exporter-1.8.1.linux-amd64 /opt/node_exporter/node_exporter&#xA;&#xA;# Gestion du propri√©taire des fichiers&#xA;sudo chown node_exporter:node_exporter -R /opt/node_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui g√®rera Node Exporter. Ajoutez une information sur l&amp;rsquo;instance monitor√©e car postgres_exporter ne g√®re pas correctement le multi-instance.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/node_exporter.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les √©l√©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus exporter for Linux&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=node_exporter&#xA;Group=node_exporter&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;&#xA;WorkingDirectory=/opt/node_exporter&#xA;ExecStart=/opt/node_exporter/node_exporter/node_exporter \&#xA;    --web.listen-address=:9100 &#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous pouvons int√©grer dans la ligne de commande diff√©rentes options de surveillance (&lt;a href=&#34;https://github.com/prometheus/node_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;d√©taill√©es ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34; id=&#34;block-013a31d6-fbb5-4dd0-8c9a-f05ee7df2cad&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9100&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donn√©es pourront √™tre r√©cup√©r√©es via HTTP.&lt;br&gt;9100 est le port par d√©faut mais vous pouvez en attribuer un autre si celui-ci est d√©j√† utilis√©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour cr√©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les param√®tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au d√©marrage&#xA;sudo systemctl enable node_exporter.service&#xA;&#xA;# D√©marrer le service&#xA;sudo systemctl start node_exporter&#xA;&#xA;# Tester le d√©marrage du service&#xA;sudo systemctl status node_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u node_exporter.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en r√©cup√©rant les donn√©es collect√©es en vous rendant √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9100&lt;/code&gt;. Vous devriez r√©cup√©rer quelques chose qui ressemble √† ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0&#xA;go_gc_duration_seconds_sum 0&#xA;go_gc_duration_seconds_count 0&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 7&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.22.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Windows Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Windows Exporter est l&amp;rsquo;outil qui va collecter les m√©triques du syst√®me Windows.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La proc√©dure d&amp;rsquo;installation de cet exporter est bien d√©taill√©e sur la page du projet GitHub. Je ne la d√©taillerai donc pas enti√®rement ici.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-vertical is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-9a7cdcfd wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/prometheus-community/windows_exporter?tab=readme-ov-file#installation&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Proc√©dure d&amp;rsquo;installation de Windows Exporter&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/prometheus-community/windows_exporter/releases&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;T√©l√©chargement de Windows Exporter&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la ligne de commande utilis√©e pour installer l&amp;rsquo;exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;msiexec /i &#34;C:\chemin_vers\windows_exporter-0.25.1-amd64.msi&#34; LISTEN_PORT=9182 EXTRA_FLAGS=&#34;--config.file=&#34;&#34;C:\Program Files\windows_exporter\config.yml&#34;&#34;&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cela permet de configurer Windows Exporter avec un fichier de configuration afin de pouvoir facilement modifier certains param√®tres si besoin (il suffit ensuite de relancer le service pour prendre en compte le nouveau param√©trage).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en r√©cup√©rant les donn√©es collect√©es en vous rendant √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9182&lt;/code&gt;. Vous devriez r√©cup√©rer quelques chose qui ressemble √† ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005129&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.0005364&#xA;go_gc_duration_seconds_sum 0.0058283&#xA;go_gc_duration_seconds_count 37&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 15&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.5&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Prometheus&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prometheus est l&amp;rsquo;outil qui va stocker les donn√©es r√©cup√©r√©es par Postgres Exporter. Pour cela, il doit pouvoir contacter Postgres Exporter via HTTP.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prometheus g√®re l&amp;rsquo;authentification basique, il faut pour cela suivre la proc√©dure indiqu√©e sur le site officiel : &lt;a href=&#34;https://prometheus.io/docs/guides/basic-auth&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://prometheus.io/docs/guides/basic-auth&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par t√©l√©charger le logiciel depuis &lt;a href=&#34;https://prometheus.io/download/&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Prometheus&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le d√©zipper puis de la placer l√† o√π vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La configuration de Prometheus se fait au travers d&amp;rsquo;un fichier YAML. Un fichier de configuration de base est fournit, ouvrez le et compl√©tez le avec les informations suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Configuration globale&#xA;global:&#xA;  # Interval global de r√©cup√©ration (d√©faut 1 min)&#xA;  scrape_interval: 15s&#xA;  # Interval global d&#39;√©valuation des r√®gles (d√©faut 1 min)&#xA;  evaluation_interval: 15s&#xA;  # Interval global de timeout (d√©faut 10s)&#xA;  scrape_timeout: 10s&#xA;&#xA;# Gestionnaire d&#39;alertes&#xA;alerting:&#xA;  alertmanagers:&#xA;    - static_configs:&#xA;        - targets:&#xA;          # - alertmanager:9093&#xA;&#xA;# R√®gles&#xA;rule_files:&#xA;  # - &#34;first_rules.yml&#34;&#xA;  # - &#34;second_rules.yml&#34;&#xA;&#xA;# Configuration des data scraper (r√©cup√©rateurs de donn√©es)&#xA;scrape_configs:&#xA;  # Prometheus lui-m√™me&#xA;  # &#34;job_name&#34; est ajout√© √† chaque donn√©e r√©cup√©r√©e via cette configuration&#xA;  - job_name: &#34;Prometheus - Local&#34;&#xA;    static_configs:&#xA;      # Cible √† atteindre&#xA;      - targets: [&#34;localhost:9090&#34;]&#xA;&#xA;    # Identifiant et mot de passe pour acc√©der √† Prometheus&#xA;    basic_auth:&#xA;      username: identifiant&#xA;      password: mdp&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons ensuite s√©curiser l&amp;rsquo;acc√®s √† Prometheus. Cr√©ez un fichier web.yml avec les √©l√©ments suivants (pensez √† utiliser les m√™mes identifiant/mdp dans le fichier pr√©c√©dent : Prometheus doit pouvoir acc√©der √† lui-m√™me pour s&amp;rsquo;auto-monitorer) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;basic_auth_users:&#xA;  # Utilisateur 1 : identifiant: mdp_encrypt√©&#xA;  identifiant: $2a$12$P63ADVOo///fo4HiMm4sYuogjceHfzT3vfShmgAYvEw8v28Bt4GBq&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant d&amp;rsquo;utilisateurs que vous le souhaitez. Le mot de passe doit √™tre sp√©cifi√© de fa√ßon crypt√© avec bcrypt. Vous pouvez utiliser un crypteur sur le web &lt;a href=&#34;https://bcrypt-generator.com/&#34;&gt;comme celui-ci&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cr√©ez ensuite un fichier &lt;code&gt;start.bat&lt;/code&gt; dans le r√©pertoire de Prometheus avec le contenu suivant (en rempla√ßant l&amp;rsquo;url d&amp;rsquo;acc√®s √† votre base de donn√©es dans le fichier et dans son nom) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;@echo off&#xA;&#xA;REM Lancement du processus prometheus.exe avec diff√©rentes options&#xA;prometheus.exe ^&#xA;  --web.listen-address=:9090 ^&#xA;  --web.config.file=web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce script permet de d√©clarer et √©ventuellement modifier facilement les options de Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;option &lt;code&gt;web.listen-adress=:9090&lt;/code&gt; permet de d√©finir le port d&amp;rsquo;√©coute. &lt;br&gt;La valeur 9090 est la valeur par d√©faut, cette option n&amp;rsquo;est donc pas indispensable dans notre cas.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;option &lt;code&gt;web.config.file=web.yml&lt;/code&gt; permet d&amp;rsquo;activer l&amp;rsquo;authentification.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La surveillance peut ensuite d√©marrer en lan√ßant le fichier &lt;code&gt;bat&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Prometheus √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9090&lt;/code&gt;. Vous devriez obtenir la page suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;440&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png&#34; alt=&#34;&#34; class=&#34;wp-image-3323&#34; style=&#34;width:696px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-300x129.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-768x330.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil.png 1041w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi √™tre cr√©√© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de cr√©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM, si vous avez pr√©vu d&amp;rsquo;installer Grafana, vous pouvez attendre de l&amp;rsquo;avoir fait plut√¥t que de t√©l√©charger NSSM.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois r√©cup√©rer, vous pourrez cr√©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Prometheus&#34; &#34;C:\chemin\vers\start.exe&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Prometheus&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) d√©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Cr√©ation d&#39;un utilisateur d√©di√©&#xA;sudo useradd prometheus --shell /bin/bash&#xA;&#xA;# Cr√©ation d&#39;un r√©pertoire d√©di√© et d&#39;un r√©pertoire pour stocker les donn√©es&#xA;sudo mkdir /opt/prometheus&#xA;sudo mkdir /opt/prometheus/data&#xA;&#xA;# T√©l√©chargement de Prometheus&#xA;# Attention √† la version qu&#39;il vous faudra adapter&#xA;sudo wget -P /opt/prometheus https://github.com/prometheus/prometheus/releases/download/v2.51.1/prometheus-2.51.1.linux-amd64.tar.gz&#xA;&#xA;# D√©crompression&#xA;sudo tar xvzf /opt/prometheus/prometheus-2.51.1.linux-amd64.tar.gz -C /opt/prometheus&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/prometheus/prometheus-2.51.1.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du r√©pertoire&#xA;sudo mv /opt/prometheus/prometheus-2.51.1.linux-amd64 /opt/prometheus/prometheus&#xA;&#xA;# Gestion du propri√©taire des fichiers&#xA;sudo chown prometheus:prometheus -R /opt/prometheus&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La configuration de Prometheus se fait au travers d&amp;rsquo;un fichier YAML. Un fichier de configuration de base est fournit, ouvrez le :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/prometheus/prometheus/prometheus.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Configuration globale&#xA;global:&#xA;  # Interval global de r√©cup√©ration (d√©faut 1 min)&#xA;  scrape_interval: 15s&#xA;  # Interval global d&#39;√©valuation des r√®gles (d√©faut 1 min)&#xA;  evaluation_interval: 15s&#xA;  # Interval global de timeout (d√©faut 10s)&#xA;  scrape_timeout: 10s&#xA;&#xA;# Gestionnaire d&#39;alertes&#xA;alerting:&#xA;  alertmanagers:&#xA;    - static_configs:&#xA;        - targets:&#xA;          # - alertmanager:9093&#xA;&#xA;# R√®gles&#xA;rule_files:&#xA;  # - &#34;first_rules.yml&#34;&#xA;  # - &#34;second_rules.yml&#34;&#xA;&#xA;# Configuration des data scraper (r√©cup√©rateurs de donn√©es)&#xA;scrape_configs:&#xA;  # Prometheus lui-m√™me&#xA;  # &#34;job_name&#34; est ajout√© √† chaque donn√©e r√©cup√©r√©e via cette configuration&#xA;  - job_name: &#34;Prometheus - Local&#34;&#xA;    static_configs:&#xA;      # Cible √† atteindre&#xA;      - targets: [&#34;localhost:9090&#34;]&#xA;&#xA;    # Identifiant et mot de passe pour acc√©der √† Prometheus&#xA;    basic_auth:&#xA;      username: identifiant&#xA;      password: mdp&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons ensuite s√©curiser l&amp;rsquo;acc√®s √† Prometheus. Cr√©ez un fichier web.yml avec les √©l√©ments suivants (pensez √† utiliser les m√™mes identifiant/mdp dans le fichier pr√©c√©dent : Prometheus doit pouvoir acc√©der √† lui-m√™me pour s&amp;rsquo;auto-monitorer) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/prometheus/prometheus/web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;basic_auth_users:&#xA;  # Utilisateur 1 : identifiant: mdp_encrypt√©&#xA;  identifiant: $2a$12$P63ADVOo///fo4HiMm4sYuogjceHfzT3vfShmgAYvEw8v28Bt4GBq&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant d&amp;rsquo;utilisateurs que vous le souhaitez. Le mot de passe doit √™tre sp√©cifi√© de fa√ßon crypt√© avec bcrypt. Vous pouvez utiliser un crypteur sur le web &lt;a href=&#34;https://bcrypt-generator.com/&#34;&gt;comme celui-ci&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La r√©cup√©ration des donn√©es peut ensuite d√©marrer en lan√ßant le programme Prometheus via la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;/opt/prometheus/prometheus/prometheus --config.file=prometheus.yml --web.config.file=web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Prometheus √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9090&lt;/code&gt;. Vous devriez obtenir la page suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;440&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png&#34; alt=&#34;&#34; class=&#34;wp-image-3323&#34; style=&#34;width:696px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-300x129.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-768x330.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil.png 1041w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Prometheus est disponible peut √™tre modifier avec l&amp;rsquo;argument &lt;code&gt;--web.listen-address&lt;/code&gt; a ajouter lors du d√©marrage du programme (comme avec Postgres Exporter).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui g√®rera Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/prometheus.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les √©l√©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus &#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=prometheus &#xA;Group=prometheus &#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;ExecStart=/opt/prometheus/prometheus/prometheus \&#xA;    --config.file=/opt/prometheus/prometheus/prometheus.yml \&#xA;    --web.config.file=/opt/prometheus/prometheus/web.yml \&#xA;    --web.listen-address=:9090 \&#xA;    --storage.tsdb.path=/opt/prometheus/data \&#xA;    --storage.tsdb.retention.time=30d&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour cr√©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les param√®tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au d√©marrage&#xA;sudo systemctl enable prometheus.service&#xA;&#xA;# D√©marrer le service&#xA;sudo systemctl start prometheus&#xA;&#xA;# Tester le d√©marrage du service&#xA;sudo systemctl status prometheus&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u prometheus.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Liaison Prometheus &amp;#8211; Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour que Prometheus r√©cup√®re les donn√©es d&amp;rsquo;un Exporter que vous avez install√©, il vous faut √©diter le fichier de configuration YAML.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez un nouveau ¬´¬†job¬†¬ª dans la partie &lt;code&gt;scrape_configs&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour PostgreSQL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;  # PostgreSQL Monitoring avec postgres_exporter&#xA;  - job_name: &#39;PostgreSQL Exporter&#39;&#xA;    scrape_interval: 5s&#xA;    static_configs:&#xA;      # Cible √† atteindre&#xA;      - targets: [&#39;127.0.0.1:9187&#39;]&#xA;        labels:&#xA;          # &#34;instance&#34; est ajout√© √† chaque donn√©e r√©cup√©r√©e et prend la valeur du param√®tre &amp;lt;targets&gt;, comme on sait qu&#39;il n&#39;y a qu&#39;un PG derri√®re, on renomme l&#39;instance&#xA;          &#34;instance&#34;: &#34;127.0.0.1:5431&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour Node Exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt; # Linux Monitoring with node_exporter&#xA;  - job_name: &#39;Node Exporter&#39;&#xA;    scrape_interval: 15s&#xA;    static_configs:&#xA;      - targets: [&#39;127.0.0.1:9100&#39;]&#xA;        labels:&#xA;          &#34;instance&#34;: &#34;Mon serveur XYZ&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour Windows Exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt; # Windows Monitoring with windows_exporter&#xA;  - job_name: &#39;Windows Exporter&#39;&#xA;    scrape_interval: 15s&#xA;    static_configs:&#xA;      - targets: [&#39;127.0.0.1:9182&#39;]&#xA;        labels:&#xA;          &#34;instance&#34;: &#34;Mon serveur ABC&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant de job que n√©cessaire, afin que votre Prometheus r√©cup√®re des donn√©es de divers services.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Red√©marrez le service de Prometheus et rendez-vous dans la page ¬´¬†Status¬†¬ª =&amp;gt; ¬´¬†Target¬†¬ª de l&amp;rsquo;interface, vous devriez voir la connexion avec Postgres Exporter et Node Exporter&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;520&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-1024x520.png&#34; alt=&#34;&#34; class=&#34;wp-image-3324&#34; style=&#34;width:757px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-1024x520.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-300x152.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-768x390.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target.png 1036w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Grafana&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par t√©l√©charger le logiciel depuis &lt;a href=&#34;https://grafana.com/grafana/download?platform=windows&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Grafana&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le d√©zipper puis de la placer l√† o√π vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le logiciel se lance simplement en d√©marrant le programme &lt;code&gt;grafana-server.exe&lt;/code&gt; situ√© dans le r√©pertoire &lt;code&gt;bin&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Grafana √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Grafana est disponible peut √™tre modifier dans le fichier de configuration &lt;code&gt;conf/defaults.ini&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi √™tre cr√©√© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de cr√©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM dans le r√©pertoire &lt;code&gt;svc-x&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois r√©cup√©rer, vous pourrez cr√©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Grafana&#34; &#34;C:\chemin\vers\grafana-server.exe&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Grafana&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe une multitude de fa√ßon d&amp;rsquo;installer Grafana sur Linux (Ubuntu/Debian).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux d√©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Cr√©ation d&#39;un utilisateur d√©di√©&#xA;sudo useradd grafana --shell /bin/bash&#xA;&#xA;# Cr√©ation d&#39;un r√©pertoire d√©di√©&#xA;sudo mkdir /opt/grafana&#xA;&#xA;# T√©l√©chargement de Prometheus&#xA;# Attention √† la version qu&#39;il vous faudra adapter&#xA;sudo wget -P /opt/grafana https://dl.grafana.com/enterprise/release/grafana-enterprise-11.0.0.linux-amd64.tar.gz&#xA;&#xA;# D√©crompression&#xA;sudo tar xvzf /opt/grafana/grafana-enterprise-11.0.0.linux-amd64.tar.gz -C /opt/grafana&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/grafana/grafana-enterprise-11.0.0.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du r√©pertoire&#xA;sudo mv /opt/grafana/grafana-v11.0.0 /opt/grafana/grafana&#xA;&#xA;# Gestion du propri√©taire des fichiers&#xA;sudo chown grafana:grafana -R /opt/grafana&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le logiciel se lance simplement en d√©marrant le programme &lt;code&gt;grafana&lt;/code&gt; situ√© dans le r√©pertoire &lt;code&gt;bin&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;grafana server&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Grafana √† l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Grafana est disponible peut √™tre modifier dans le fichier de configuration &lt;code&gt;conf/defaults.ini&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui g√®rera Grafana.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/grafana.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les √©l√©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Grafana&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=grafana&#xA;Group=grafana&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;WorkingDirectory=/opt/grafana/grafana&#xA;ExecStart=/opt/grafana/grafana/bin/grafana server&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour cr√©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les param√®tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au d√©marrage&#xA;sudo systemctl enable grafana.service&#xA;&#xA;# D√©marrer le service&#xA;sudo systemctl start grafana&#xA;&#xA;# Tester le d√©marrage du service&#xA;sudo systemctl status grafana&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u grafana.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Param√©trages&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant acc√©der √† Grafana sur l&amp;rsquo;adresse &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le premier √©cran vous demande de vous connecter, utilisez l&amp;rsquo;identifiant &lt;code&gt;admin&lt;/code&gt; avec &lt;code&gt;admin&lt;/code&gt; pour mot de passe. L&amp;rsquo;√©crans suivant vous demandera de d√©finir un nouveau mot de passe.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;594&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-1024x594.png&#34; alt=&#34;&#34; class=&#34;wp-image-3293&#34; style=&#34;width:604px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-1024x594.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-300x174.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-768x446.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in.png 1034w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Dans l&amp;rsquo;interface suivante, cliquer sur l&amp;rsquo;icone pour ouvrir le menu de gauche puis sur ¬´¬†Add new connection¬†¬ª :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;772&#34; height=&#34;462&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion.png&#34; alt=&#34;&#34; class=&#34;wp-image-3294&#34; style=&#34;width:590px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion.png 772w, https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion-300x180.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion-768x460.png 768w&#34; sizes=&#34;auto, (max-width: 772px) 100vw, 772px&#34; /&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant ajouter une connexion vers Prometheus en renseignant son url d&amp;rsquo;acc√®s &lt;code&gt;http://serveur:9090&lt;/code&gt; puis en choisissant le type d&amp;rsquo;authentification ¬´¬†basique¬†¬ª.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il ne vous reste plus qu&amp;rsquo;a cr√©er votre tableau de bord ou en r√©cup√©rer un d√©j√† cr√©√© depuis &lt;a href=&#34;https://grafana.com/grafana/dashboards/&#34; data-type=&#34;link&#34; data-id=&#34;https://grafana.com/grafana/dashboards/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Grafana&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple de tableau de bord :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-3303&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-300x159.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-768x407.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1536x813.png 1536w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1.png 1611w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici le code json √† t√©l√©charger pour importer ce tableau de bord dans votre Grafana : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-16018d1d wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/wp-content/uploads/tdb_postgresql.zip&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Tableau de bord PostgreSQL &amp;#8211; 7ko&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;M√©triques importantes&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quelles sont les m√©triques importantes √† surveiller ? &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Tout d√©pends des usages mais en voici quelques unes que j&amp;rsquo;ai pu choisir pour PostgreSQL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_up&lt;/code&gt; : l&amp;rsquo;√©tat actif ou non de l&amp;rsquo;instance.&lt;br&gt;C&amp;rsquo;est un peu la base de tout le monitoring&amp;#8230;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;process_start_time_seconds&lt;/code&gt; : le d√©lais d&amp;rsquo;activit√© (depuis quand la base est-elle d√©marr√©e ?)&lt;br&gt;Cela permet de rep√©rer les red√©marrages de la base.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_activity_count&lt;/code&gt; et &lt;code&gt;pg_settings_max_connections&lt;/code&gt; : le nombre de connexions par rapport au nombre total de connexions possibles.&lt;br&gt;Pour savoir s&amp;rsquo;il faut augmenter le pool de connexions disponibles.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_database_size_bytes&lt;/code&gt; : la taille totale des bases de l&amp;rsquo;instance&lt;br&gt;Pour identifier celle qui pourrait poser probl√®me et/ou anticiper une augmentation de la capacit√© du serveur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_xact_commit&lt;/code&gt; et &lt;code&gt;pg_stat_database_xact_rollback&lt;/code&gt; : le taux de COMMIT et de ROLLBACK.&lt;br&gt;S&amp;rsquo;il y a beaucoup de ROLLBACK, il y a peut √™tre un probl√®me avec certaines requ√™tes.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;process_resident_memory_bytes&lt;/code&gt; et &lt;code&gt;process_cpu_seconds_total&lt;/code&gt; : les consommations RAM et CPU.&lt;br&gt;Il s&amp;rsquo;agit plus de valeur indicatives de la charge de la base, il n&amp;rsquo;y a pas de mise en rapport avec la puissance du serveur et donc pas d&amp;rsquo;information sur l&amp;rsquo;√©tat de charge de la machine.&lt;br&gt;Il faudra plutot surveiller le serveur en lui-m√™me.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_tup_fetched&lt;/code&gt; et &lt;code&gt;pg_stat_database_tup_returned&lt;/code&gt; : le rapport entre le nombre de tuples lus directement dans le stockage (returned) par rapport au nombre de tuples r√©ellement n√©cessaires (fetched). Cela permet de d√©celer un manque d&amp;rsquo;indexation.&lt;br&gt;Par exemple, sur une table de 1000 lignes sans index, une requ√™te avec une clause ne renvoyant que 100 lignes aura un nombre de tuples ¬´¬†returned¬†¬ª de 1000 et un nombre de tuples ¬´¬†fetched¬†¬ª de 100 car il aura fallu scanner toutes les lignes pour r√©cup√©rer le r√©sultat. Avec un index, la valeur de returned aurait √©t√© bien moindre (probablement l√©g√®rement sup√©rieur √† 100).&lt;br&gt;Attention, le nombre de tuples ¬´¬†fetched¬†¬ª ne correspond pas forc√©ment au nombre de tuples retourn√©s au clients ce qui est interessant ici c&amp;rsquo;est bien le rapport entre les deux valeurs.&lt;br&gt;Attention, la valeur porte sur la base enti√®re, il conviendra ensuite d&amp;rsquo;auditer les requ√™tes pour identifier l&amp;rsquo;origine du manque d&amp;rsquo;indexation.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_blks_hit&lt;/code&gt; et &lt;code&gt;pg_stat_database_blks_read&lt;/code&gt; : le nombre de blocs lu sur le disque (read) par rapport au nombre de bloc lu dans la m√©moire tampon (hit).&lt;br&gt;Cela permet de d√©tecter un √©ventuel manque de ressources pour la m√©moire tampon (param√®tre shared buffer).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_user_tables_n_dead_tup&lt;/code&gt; : le nombre de tuples mort (dead tuple).&lt;br&gt;Cela permet de surveiller le bon fonctionnement du processus de VACUUM.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, Postgres Exporter se focalise sur une seule base de donn√©es et ne permet donc pas d&amp;rsquo;avoir certaines m√©triques en ¬´¬†multibase¬†¬ª, sur l&amp;rsquo;instance compl√®te (en fait si mais ¬´¬†c&amp;rsquo;est compliqu√©¬†¬ª et non recommand√©). Il faudrait ainsi avoir plusieurs Postgres Exporter en parall√®le, un pour chaque base d&amp;rsquo;une instance&amp;#8230; Je compl√®terai cet article lorsque j&amp;rsquo;aurai identifi√© une solution (sous peu j&amp;rsquo;esp√®re)&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D&amp;rsquo;autres m√©triques sont int√©ressantes, notamment si vous avez mis en place de la r√©plication. Voici quelques ressources utiles :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Une liste d√©taill√©e de m√©triques : &lt;a href=&#34;https://www.datadoghq.com/blog/postgresql-monitoring&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.datadoghq.com/blog/postgresql-monitoring&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une autre liste de m√©triques : &lt;a href=&#34;https://sysdig.com/blog/postgresql-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://sysdig.com/blog/postgresql-monitoring/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des exemples de tableaux de bord : &lt;a href=&#34;https://promcat.io/apps/postgresql/latest&#34;&gt;https://promcat.io/apps/postgresql/latest&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les tableau de bord pr√©construits pour Grafana : &lt;a href=&#34;https://grafana.com/grafana/dashboards/?search=postgresql&#34;&gt;https://grafana.com/grafana/dashboards/?search=postgresql&lt;/a&gt;&lt;br&gt;On y trouve beaucoup d&amp;rsquo;exemples et de bonnes id√©es.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Retrouvez √©galement quelques √©l√©ments dans l&amp;rsquo;article suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-embed is-type-wp-embed is-provider-bazinga-039-s wp-block-embed-bazinga-039-s&#34;&gt;&lt;div class=&#34;wp-block-embed__wrapper&#34;&gt;&#xA;&lt;blockquote class=&#34;wp-embedded-content&#34; data-secret=&#34;2qLbf2cgdB&#34;&gt;&lt;a href=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-7&#34;&gt;PostgreSQL &amp;#8211; Vade-mecum SQL &amp;#8211; 7/8 &amp;#8211; Administration serveur&lt;/a&gt;&lt;/blockquote&gt;&lt;iframe loading=&#34;lazy&#34; class=&#34;wp-embedded-content&#34; sandbox=&#34;allow-scripts&#34; security=&#34;restricted&#34;  title=&#34;¬´¬†PostgreSQL &amp;#8211; Vade-mecum SQL &amp;#8211; 7/8 &amp;#8211; Administration serveur¬†¬ª &amp;#8212; BazinGa&amp;#039;s&#34; src=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-7/embed#?secret=hIDLWEJ0Nz#?secret=2qLbf2cgdB&#34; data-secret=&#34;2qLbf2cgdB&#34; width=&#34;600&#34; height=&#34;338&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34;&gt;&lt;/iframe&gt;&#xA;&lt;/div&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour les serveurs Windows et Linux, cela d√©pendra √©galement ce que vous faites avec ceux-ci. Voici ce que je surveille √† minima :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La charge CPU&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La consommation de m√©moire RAM&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La consommation d&amp;rsquo;espace disque&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La quantit√© d&amp;rsquo;√©criture et de lecture sur le disque et leur rapidit√© (i/o).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Eventuellement le nombre d&amp;rsquo;utilisateur connect√©s pour un Windows.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/it/monitorer-postgresql-avec-prometheus-et-grafana" rel="alternate"></link>
    <summary type="html">Monitorez votre instance PostgreSQL avec Postgres Exporter, Prometheus et Grafana.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Stockage physique, gestion des donn√©es et VACUUM</title>
    <updated>2024-02-03T13:32:02Z</updated>
    <id>tag:blog.arthurbazin.com,2024-02-03:/bdd/postgresql/stockage-physique-gestion-des-donnees-et-vacuum</id>
    <content type="html">&#xA;&lt;p&gt;En SIG, on oppose souvent le stockage sous forme de fichiers plats au stockage en base de donn√©es. Mais comment fait PostgreSQL pour stocker r√©ellement les donn√©es ? Et bien il utilise des fichiers plats&amp;#8230; (le serpent se mort la queue). Nous allons donc d√©mystifier un peu ce fonctionnement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre question que j&amp;rsquo;ai pu avoir en lien avec le stockage : pourquoi apr√®s avoir fait du nettoyage dans une base de donn√©es, l&amp;rsquo;espace disque n&amp;rsquo;avait pas franchement diminu√©, y compris apr√®s avoir utilis√© la commande &lt;code&gt;VACUUM&lt;/code&gt; ? Nous allons voir d&amp;rsquo;o√π provient ce comportement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que je prendrais parfois quelques raccourcis pour pour simplifier les explications. Nous ne parlerons √©galement que des tables et non des index.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Fonctions personnalis√©es&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour nous aider dans notre qu√™te, nous allons avoir besoin d&amp;rsquo;extensions sp√©cifiques et de fonctions cr√©√©es pour l&amp;rsquo;occasion. Les voici, vous pourrez les d√©cortiquer une fois que vous aurez lu l&amp;rsquo;article :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;extension&#34; data-enlighter-group=&#34;install&#34;&gt;-- Ajout des extensions&#xA;CREATE EXTENSION pgstattuple;&#xA;CREATE EXTENSION pageinspect;&#xA;CREATE EXTENSION pg_freespacemap;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;table_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de r√©cup√©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_table_info(relname TEXT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_table_info(relname TEXT)&#xA;RETURNS TABLE(&#xA;  &#34;schema&#34; text,&#xA;  &#34;table&#34; text,&#xA;  &#34;tablespace&#34; text,&#xA;  oid_table oid,&#xA;  numero_heap_file oid,&#xA;  heap_file_segment_0_location text,&#xA;  nb_page bigint,&#xA;  tuple_count bigint,&#xA;  dead_tuple_count bigint,&#xA;  table_length bigint,&#xA;  table_length_human text,&#xA;  tuple_length bigint,&#xA;  tuple_percent numeric,&#xA;  dead_tuple_length bigint,&#xA;  dead_tuple_percent numeric,&#xA;  free_space_length bigint,&#xA;  free_space_percent numeric,&#xA;  max_frozen_txid xid,&#xA;  n_tup_ins bigint,&#xA;  n_tup_upd bigint,&#xA;  n_tup_del bigint,&#xA;  n_mod_since_analyze bigint,&#xA;  n_ins_since_vacuum bigint,&#xA;  last_vacuum timestamp with time zone, &#xA;  last_autovacuum timestamp with time zone, &#xA;  last_analyze timestamp with time zone,&#xA;  last_autoanalyze timestamp with time zone,&#xA;  toast_oid oid,&#xA;  toast_table text,&#xA;  toast_heap_file_segment_0_location text,&#xA;  toast_nb_page bigint,&#xA;  toast_nb_tuple bigint,&#xA;  toast_length bigint,&#xA;  toast_length_human text&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION table_info(relname TEXT)&#xA; * Renvoi diff√©rentes informations sur une table et son stockage&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : objet √† analyser au choix :&#xA; *    - &#39;schema.Table&#39; : pour analyser une table en particulier.&#xA; *    - &#39;schema&#39; : pour analyser toutes les tables d&#39;un sch√©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;√™tre quot√©s.&#xA; * &#xA; */&#xA;DECLARE &#xA;  var_requete TEXT;&#xA;  schemaname TEXT;&#xA;  table_schema record;&#xA;  schema_check boolean DEFAULT FALSE;&#xA;  where_clause TEXT;&#xA;&#xA;BEGIN&#xA;  &#xA;  -- Nettoyage du nom d&#39;objet&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  &#xA;&#xA;&#xA;  -- L&#39;analyse porte-elle sur un sch√©ma ?&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      TRUE&#xA;    FROM &#xA;      information_schema.schemata&#xA;    WHERE &#xA;      schema_name = $a$ || quote_literal(relname)&#xA;  ;&#xA;&#xA;  EXECUTE &#xA;    var_requete&#xA;  INTO &#xA;    schema_check&#xA;  ;&#xA;  &#xA;&#xA;  &#xA;  -- Action selon si schema/table&#xA;  IF schema_check THEN&#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for schema&#39;;&#xA;    &#xA;    -- Clause de r√©cup√©ration des donn√©es d&#39;un sch√©ma&#xA;    where_clause := &#xA;      $a$pgc.relnamespace = $a$ || quote_literal(relname) || $a$::regnamespace $a$&#xA;    ;&#xA;  &#xA;    -- Boucle sur toutes les tables d&#39;un schema&#xA;    var_requete := &#xA;      $a$SELECT&#xA;        pgc.relname::TEXT AS &#34;table&#34;&#xA;      FROM&#xA;        pg_class AS pgc&#xA;      WHERE &#xA;        $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;  &#xA;    FOR table_schema IN EXECUTE var_requete&#xA;        &#xA;    LOOP&#xA;      &#xA;      var_requete := &#xA;        $a$ANALYZE $a$ || quote_ident(relname) || &#39;.&#39; || quote_ident(table_schema.&#34;table&#34;)&#xA;      ;&#xA;      &#xA;      --RAISE NOTICE USING MESSAGE = var_requete;&#xA;&#xA;        -- Analyse de la table&#xA;      EXECUTE &#xA;        var_requete&#xA;      ;&#xA;      &#xA;      &#xA;    END LOOP;&#xA;    &#xA;  &#xA;  ELSE &#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for table&#39;;&#xA;  &#xA;    -- Quotation du schema.table&#xA;    relname := &#xA;      quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;      &#39;.&#39; || &#xA;      quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;    ;&#xA;  &#xA;    -- Clause de r√©cu√©pration d&#39;une table&#xA;    where_clause :=&#xA;      $a$pgc.oid = $a$ || quote_literal(relname) || $a$::regclass $a$&#xA;    ;&#xA;&#xA;    -- Analyse de la table&#xA;    EXECUTE &#xA;      $a$ANALYZE $a$ || relname&#xA;    ;&#xA;  &#xA;  END IF;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      pgc.relnamespace::regnamespace::text AS &#34;schema&#34;,&#xA;      pgc.relname::text AS &#34;table&#34;,&#xA;      COALESCE (pgt.spcname, &#39;pg_default&#39;)::TEXT AS &#34;tablespace&#34;,&#xA;      pgc.oid AS oid_table,&#xA;      pg_relation_filenode(pgc.oid) AS numero_heap_file,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgc.oid) AS &#34;heap_file_segment_0_location&#34;,&#xA;      pgc.relpages::int AS nb_page,&#xA;      pst.tuple_count::bigint,&#xA;      pst.dead_tuple_count::bigint,&#xA;      pst.table_len::bigint AS table_length,&#xA;      pg_size_pretty(pst.table_len) AS table_length_human,&#xA;      pst.tuple_len::bigint AS tuple_length,&#xA;      pst.tuple_percent::numeric,&#xA;      pst.dead_tuple_len::bigint AS dead_tuple_length,&#xA;      pst.dead_tuple_percent::numeric,&#xA;      pst.free_space::bigint AS free_space_length,&#xA;      pst.free_percent::NUMERIC AS free_space_percent,&#xA;      pgc.relfrozenxid AS max_frozen_txid,&#xA;      psut.n_tup_ins::bigint,&#xA;      psut.n_tup_upd::bigint,&#xA;      psut.n_tup_del::bigint,&#xA;      psut.n_mod_since_analyze::bigint,&#xA;      psut.n_ins_since_vacuum::bigint,&#xA;      psut.last_vacuum, &#xA;      psut.last_autovacuum, &#xA;      psut.last_analyze,&#xA;      psut.last_autoanalyze,&#xA;      pgc.reltoastrelid AS toast_oid,&#xA;      pgct.relname::text AS toast_table,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgct.oid) AS &#34;toast_heap_file_segment_0_location&#34;,&#xA;      pgct.relpages::int AS toast_nb_page,&#xA;      pgct.reltuples::int AS toast_nb_tuple,&#xA;      pg_relation_size(pgc.reltoastrelid)::bigint AS toast_length,&#xA;      pg_size_pretty(pg_relation_size(pgc.reltoastrelid))::text AS toast_length_human&#xA;    FROM &#xA;      pg_class AS pgc&#xA;    LEFT JOIN &#xA;      pg_tablespace AS pgt &#xA;      ON pgt.oid = pgc.reltablespace &#xA;    LEFT JOIN &#xA;      pg_class AS pgct &#xA;      ON pgct.oid = pgc.reltoastrelid&#xA;    LEFT JOIN&#xA;      pg_stat_user_tables AS psut&#xA;      ON psut.relid = pgc.oid&#xA;    LEFT JOIN LATERAL&#xA;      pgstattuple(pgc.oid::regclass::text) AS pst&#xA;      ON TRUE&#xA;    WHERE &#xA;      $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;    &#xA;    RETURN QUERY EXECUTE &#xA;      var_requete&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;table_info() (PG &lt; 12)&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de r√©cup√©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_table_info(relname TEXT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_table_info(relname TEXT)&#xA;RETURNS TABLE(&#xA;  &#34;schema&#34; text,&#xA;  &#34;table&#34; text,&#xA;  &#34;tablespace&#34; text,&#xA;  oid_table oid,&#xA;  numero_heap_file oid,&#xA;  heap_file_segment_0_location text,&#xA;  nb_page bigint,&#xA;  tuple_count bigint,&#xA;  dead_tuple_count bigint,&#xA;  table_length bigint,&#xA;  table_length_human text,&#xA;  tuple_length bigint,&#xA;  tuple_percent numeric,&#xA;  dead_tuple_length bigint,&#xA;  dead_tuple_percent numeric,&#xA;  free_space_length bigint,&#xA;  free_space_percent numeric,&#xA;  max_frozen_txid xid,&#xA;  n_tup_ins bigint,&#xA;  n_tup_upd bigint,&#xA;  n_tup_del bigint,&#xA;  n_mod_since_analyze bigint,&#xA;  last_vacuum timestamp with time zone, &#xA;  last_autovacuum timestamp with time zone, &#xA;  last_analyze timestamp with time zone,&#xA;  last_autoanalyze timestamp with time zone,&#xA;  toast_oid oid,&#xA;  toast_table text,&#xA;  toast_heap_file_segment_0_location text,&#xA;  toast_nb_page bigint,&#xA;  toast_nb_tuple bigint,&#xA;  toast_length bigint,&#xA;  toast_length_human text&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION table_info(relname TEXT)&#xA; * Renvoi diff√©rentes informations sur une table et son stockage&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : objet √† analyser au choix :&#xA; *    - &#39;schema.Table&#39; : pour analyser une table en particulier.&#xA; *    - &#39;schema&#39; : pour analyser toutes les tables d&#39;un sch√©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;√™tre quot√©s.&#xA; * &#xA; */&#xA;DECLARE &#xA;  var_requete TEXT;&#xA;  schemaname TEXT;&#xA;  table_schema record;&#xA;  schema_check boolean DEFAULT FALSE;&#xA;  where_clause TEXT;&#xA;&#xA;BEGIN&#xA;  &#xA;  -- Nettoyage du nom d&#39;objet&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  &#xA;&#xA;&#xA;  -- L&#39;analyse porte-elle sur un sch√©ma ?&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      TRUE&#xA;    FROM &#xA;      information_schema.schemata&#xA;    WHERE &#xA;      schema_name = $a$ || quote_literal(relname)&#xA;  ;&#xA;&#xA;  EXECUTE &#xA;    var_requete&#xA;  INTO &#xA;    schema_check&#xA;  ;&#xA;  &#xA;&#xA;  &#xA;  -- Action selon si schema/table&#xA;  IF schema_check THEN&#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for schema&#39;;&#xA;    &#xA;    -- Clause de r√©cup√©ration des donn√©es d&#39;un sch√©ma&#xA;    where_clause := &#xA;      $a$pgc.relnamespace = $a$ || quote_literal(relname) || $a$::regnamespace $a$&#xA;    ;&#xA;  &#xA;    -- Boucle sur toutes les tables d&#39;un schema&#xA;    var_requete := &#xA;      $a$SELECT&#xA;        pgc.relname::TEXT AS &#34;table&#34;&#xA;      FROM&#xA;        pg_class AS pgc&#xA;      WHERE &#xA;        $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;  &#xA;    FOR table_schema IN EXECUTE var_requete&#xA;        &#xA;    LOOP&#xA;      &#xA;      var_requete := &#xA;        $a$ANALYZE $a$ || quote_ident(relname) || &#39;.&#39; || quote_ident(table_schema.&#34;table&#34;)&#xA;      ;&#xA;      &#xA;      --RAISE NOTICE USING MESSAGE = var_requete;&#xA;&#xA;        -- Analyse de la table&#xA;      EXECUTE &#xA;        var_requete&#xA;      ;&#xA;      &#xA;      &#xA;    END LOOP;&#xA;    &#xA;  &#xA;  ELSE &#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for table&#39;;&#xA;  &#xA;    -- Quotation du schema.table&#xA;    relname := &#xA;      quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;      &#39;.&#39; || &#xA;      quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;    ;&#xA;  &#xA;    -- Clause de r√©cu√©pration d&#39;une table&#xA;    where_clause :=&#xA;      $a$pgc.oid = $a$ || quote_literal(relname) || $a$::regclass $a$&#xA;    ;&#xA;&#xA;    -- Analyse de la table&#xA;    EXECUTE &#xA;      $a$ANALYZE $a$ || relname&#xA;    ;&#xA;  &#xA;  END IF;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      pgc.relnamespace::regnamespace::text AS &#34;schema&#34;,&#xA;      pgc.relname::text AS &#34;table&#34;,&#xA;      COALESCE (pgt.spcname, &#39;pg_default&#39;)::TEXT AS &#34;tablespace&#34;,&#xA;      pgc.oid AS oid_table,&#xA;      pg_relation_filenode(pgc.oid) AS numero_heap_file,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgc.oid) AS &#34;heap_file_segment_0_location&#34;,&#xA;      pgc.relpages::int AS nb_page,&#xA;      pst.tuple_count::bigint,&#xA;      pst.dead_tuple_count::bigint,&#xA;      pst.table_len::bigint AS table_length,&#xA;      pg_size_pretty(pst.table_len) AS table_length_human,&#xA;      pst.tuple_len::bigint AS tuple_length,&#xA;      pst.tuple_percent::numeric,&#xA;      pst.dead_tuple_len::bigint AS dead_tuple_length,&#xA;      pst.dead_tuple_percent::numeric,&#xA;      pst.free_space::bigint AS free_space_length,&#xA;      pst.free_percent::NUMERIC AS free_space_percent,&#xA;      pgc.relfrozenxid AS max_frozen_txid,&#xA;      psut.n_tup_ins::bigint,&#xA;      psut.n_tup_upd::bigint,&#xA;      psut.n_tup_del::bigint,&#xA;      psut.n_mod_since_analyze::bigint,&#xA;      psut.last_vacuum, &#xA;      psut.last_autovacuum, &#xA;      psut.last_analyze,&#xA;      psut.last_autoanalyze,&#xA;      pgc.reltoastrelid AS toast_oid,&#xA;      pgct.relname::text AS toast_table,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgct.oid) AS &#34;toast_heap_file_segment_0_location&#34;,&#xA;      pgct.relpages::int AS toast_nb_page,&#xA;      pgct.reltuples::int AS toast_nb_tuple,&#xA;      pg_relation_size(pgc.reltoastrelid)::bigint AS toast_length,&#xA;      pg_size_pretty(pg_relation_size(pgc.reltoastrelid))::text AS toast_length_human&#xA;    FROM &#xA;      pg_class AS pgc&#xA;    LEFT JOIN &#xA;      pg_tablespace AS pgt &#xA;      ON pgt.oid = pgc.reltablespace &#xA;    LEFT JOIN &#xA;      pg_class AS pgct &#xA;      ON pgct.oid = pgc.reltoastrelid&#xA;    LEFT JOIN&#xA;      pg_stat_user_tables AS psut&#xA;      ON psut.relid = pgc.oid&#xA;    LEFT JOIN LATERAL&#xA;      pgstattuple(pgc.oid::regclass::text) AS pst&#xA;      ON TRUE&#xA;    WHERE &#xA;      $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;    &#xA;    RETURN QUERY EXECUTE &#xA;      var_requete&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;heap_page_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de r√©cup√©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_heap_page_info(relname TEXT, page_number INT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_heap_page_info(relname TEXT, page_number INT DEFAULT -1)&#xA;RETURNS TABLE(&#xA;  page_num int,&#xA;  lsn pg_lsn, &#xA;  nb_pointer int,&#xA;  nb_tuple int,&#xA;  nb_tuple_visible int,&#xA;  length_header int,&#xA;  length_pointer int,&#xA;  length_free_space int,&#xA;  length_tuple int,&#xA;  length_meta int,&#xA;  length_data int,&#xA;  length_empty int,&#xA;  length_special int,&#xA;  offset_pointer int,&#xA;  offset_free_space int,&#xA;  offset_data int,&#xA;  offset_special int,&#xA;  offset_page_end int,&#xA;  unused_line_pointer bool,&#xA;  no_free_space bool,&#xA;  all_visible bool&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION heap_page_info(relname TEXT, page_number INT)&#xA; * Renvoi diff√©rentes informations sur les pages d&#39;une table&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : table √† analyser pr√©fix√©e par son sch√©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;√™tre quot√©s.&#xA; *  page_number INT : (facultatif) num√©ro de page √† analyser.&#xA; *    Sans ce param√®tre, toutes les pages sont remont√©es&#xA; * &#xA; */&#xA;BEGIN&#xA;  -- Quotation du schema.table&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  relname := &#xA;    quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;    &#39;.&#39; || &#xA;    quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;  ;&#xA;  &#xA;  &#xA;  -- Analyse de la table&#xA;  EXECUTE &#xA;    $a$ANALYZE $a$ || relname ;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  RETURN QUERY EXECUTE &#xA;    $a$SELECT&#xA;      pages.page_num,&#xA;      -- Identifiant xlog de la derni√®re op√©ration effectu√©e sur la page.&#xA;      ph.lsn,&#xA;      tm.count_pointer::int AS nb_pointer,&#xA;      tm.count_tuple::int AS nb_tuple,&#xA;      tm.count_tuple_visible::int AS nb_tuple_visible,&#xA;      24::int AS length_header,&#xA;      (ph.lower - 24)::int AS length_pointer,&#xA;      (ph.upper - ph.lower)::int AS length_free_space,&#xA;      (ph.special - ph.upper)::int AS length_tuple,&#xA;      (tm.length_meta)::int,&#xA;      (tm.length_data)::int,&#xA;      (tm.length_empty)::int,&#xA;      (ph.pagesize - ph.special)::int AS length_special,&#xA;      24::int AS offset_pointer,&#xA;      (ph.lower)::int AS offset_free_space,&#xA;      (ph.upper)::int AS offset_data,&#xA;      (ph.special)::int AS offset_special,&#xA;      (ph.pagesize)::int AS offset_page_end,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0001&#39;) = (x&#39;0001&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS unused_line_pointer,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0002&#39;) = (x&#39;0002&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS no_free_space,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0004&#39;) = (x&#39;0004&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS all_visible&#xA;    FROM &#xA;      pg_catalog.pg_class AS pgc&#xA;    LEFT JOIN LATERAL &#xA;        generate_series(0, pgc.relpages - 1) AS pages(page_num)&#xA;        ON TRUE&#xA;    LEFT JOIN LATERAL&#xA;        page_header(&#xA;          get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;        ) AS ph&#xA;        ON TRUE&#xA;    LEFT JOIN LATERAL (&#xA;        SELECT&#xA;          -- Nombre de pointeur&#xA;          count(1) AS count_pointer,&#xA;          -- Nombre de tuples&#xA;          count(&#xA;            CASE &#xA;              WHEN hpi.lp_len &gt; 0 THEN 1&#xA;            END&#xA;          ) AS count_tuple,&#xA;          -- Nombre de tuples visibles&#xA;          count(&#xA;            CASE &#xA;              WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39;)  &#xA;              OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0800&#39;)&#xA;              OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0200&#39; | x&#39;0800&#39;)&#xA;                THEN 1&#xA;            END&#xA;          ) AS count_tuple_visible,&#xA;          -- Longueur des m√©tadonn√©es&#xA;          sum(hpi.t_hoff::int) AS length_meta,&#xA;          -- Longueur des donn√©es&#xA;          sum((hpi.lp_len - hpi.t_hoff)::int) AS length_data,&#xA;          -- Longueur des espaces vides&#xA;          sum(((ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8) - (hpi.lp_off + hpi.lp_len))::int) AS length_empty&#xA;        FROM&#xA;          heap_page_items(&#xA;            get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;          ) AS hpi &#xA;        ) AS tm&#xA;        ON TRUE&#xA;    WHERE &#xA;      pgc.oid = $a$ || quote_literal(relname) || $a$::regclass &#xA;    AND (&#xA;      (&#xA;        $a$ || page_number || $a$ &amp;lt;&gt; -1&#xA;        AND&#xA;        $a$ || page_number || $a$ = pages.page_num&#xA;      )OR &#xA;      $a$ || page_number || $a$ = - 1&#xA;    ) $a$&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;heap_tuple_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de r√©cup√©ration des informations sur les tuples&#xA;DROP FUNCTION IF EXISTS public.get_heap_tuple_info(relname text);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_heap_tuple_info(relname TEXT, page_number INT DEFAULT -1)&#xA;RETURNS TABLE(&#xA;  ctid tid, &#xA;  page_num int,&#xA;  page_index int, &#xA;  offset_start int,&#xA;  offset_end int,&#xA;  offset_next int,&#xA;  length_tuple int,&#xA;  length_meta int,&#xA;  length_data int,&#xA;  length_empty int,&#xA;  xmin text, &#xA;  xmax text, &#xA;  state text,&#xA;  visible bool,&#xA;  &#34;update&#34; bool,&#xA;  direction text,&#xA;  hot bool,&#xA;  &#34;delete&#34; bool, &#xA;  &#34;freeze&#34; bool,&#xA;  info text[]&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION heap_tuple_info(relname TEXT, page_number INT)&#xA; * Renvoi diff√©rentes informations sur les tuples pr√©sents dans les pages d&#39;une table&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : table √† analyser pr√©fix√©e par son sch√©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;√™tre quot√©s.&#xA; *  page_number INT : (facultatif) num√©ro de page √† analyser.&#xA; *    Sans ce param√®tre, tous les tuples de toutes les pages sont remont√©s&#xA; * &#xA; */&#xA;BEGIN&#xA;  -- Quotation du schema.table&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  relname := &#xA;    quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;    &#39;.&#39; || &#xA;    quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;  ;&#xA;  &#xA;  -- Analyse de la table&#xA;  EXECUTE &#xA;    $a$ANALYZE $a$ || relname ;&#xA;  &#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  RETURN QUERY EXECUTE &#xA;    $a$SELECT&#xA;      -- Indentifiant du tuple&#xA;      hpi.t_ctid AS ctid,&#xA;      -- Num√©ro de page&#xA;      pages.page_num,&#xA;      -- Index dans la page&#xA;      hpi.lp::int AS page_index,&#xA;      -- D√©but du tuple dans la page&#xA;      hpi.lp_off::int AS offset_start,&#xA;      -- Fin du tuple dans la page&#xA;      (hpi.lp_off + hpi.lp_len)::int AS offset_end,&#xA;      -- D√©but du tuple suivant dans la page&#xA;      (ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8)::int AS offset_next,&#xA;      -- Longueur du tuple&#xA;      hpi.lp_len::int AS length_tuple,&#xA;      -- Longueur des m√©tadonn√©es&#xA;      hpi.t_hoff::int AS length_meta,&#xA;      -- Longueur des donn√©es&#xA;      (hpi.lp_len - hpi.t_hoff)::int AS length_data,&#xA;      -- Longueur de l&#39;espacement avant le tuple suivant&#xA;      ((ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8) - (hpi.lp_off + hpi.lp_len))::int AS length_empty,&#xA;      -- ID de transaction de d√©but de vie&#xA;      --    c : transaction commit√©e&#xA;      --    a : transaction annul√©e&#xA;      concat(&#xA;        hpi.t_xmin,&#xA;        CASE &#xA;          WHEN ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) &amp;amp; (x&#39;0100&#39; | x&#39;0200&#39;)) = (x&#39;0100&#39; | x&#39;0200&#39;) THEN &#39; - f&#39;&#xA;          WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0100&#39;) = x&#39;0100&#39; THEN &#39; - c&#39;&#xA;          WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0200&#39;) = x&#39;0200&#39; THEN &#39; - a&#39;&#xA;        END&#xA;      ) AS xmin,&#xA;      -- ID de transaction de fin de vie&#xA;      --    c : transaction commit√©e&#xA;      --    a : transaction annul√©e&#xA;      NULLIF(&#xA;        concat(&#xA;          hpi.t_xmax,&#xA;          CASE &#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0400&#39;) = x&#39;0400&#39; THEN &#39; - c&#39;&#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0800&#39;) = x&#39;0800&#39; THEN &#39; - a&#39;&#xA;          END&#xA;        ),&#xA;        &#39;0 - a&#39;&#xA;      ) AS xmax,&#xA;      -- Etat de la ligne&#xA;      CASE lp_flags&#xA;        WHEN 0 THEN &#39;unused&#39;&#xA;        WHEN 1 THEN &#39;normal&#39;&#xA;        WHEN 2 THEN &#39;redirect to &#39;||lp_off&#xA;        WHEN 3 THEN &#39;dead&#39;&#xA;      END AS state,&#xA;      -- Visibilit√© actuelle du tuple&#xA;      CASE &#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39;)  &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0800&#39;)&#xA;          THEN TRUE&#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0200&#39;) &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0200&#39; | x&#39;0800&#39;)  &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0000&#39;) &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0400&#39;) &#xA;          THEN FALSE&#xA;        ELSE FALSE&#xA;      END AS visible,&#xA;      -- Tuple concern√© par un UPDATE&#xA;      CASE &#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;)&#xA;        OR t_infomask IS NULL &#xA;        OR ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;4000&#39;)) = (x&#39;4000&#39;)&#xA;        OR ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0400&#39;) AND NOT (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;))&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS &#34;update&#34;,&#xA;      -- Si concern√© par un UPDATE, tuple initial (to) ou final (from)&#xA;      NULLIF(&#xA;        concat_ws(&#xA;          &#39; and &#39;,&#xA;          CASE &#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;)&#xA;              THEN &#39;from&#39;&#xA;          END,&#xA;          CASE &#xA;            WHEN t_infomask IS NULL &#xA;            OR ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;4000&#39;)) = (x&#39;4000&#39;)&#xA;              THEN &#39;to&#39;&#xA;          END&#xA;        ),&#xA;        &#39;&#39;&#xA;      ) || &#39; another line&#39; AS direction,&#xA;      -- Tuple hot updated &#xA;      --    le tuple actuel et son ancienne version sont sur la m√™me page&#xA;      CASE &#xA;        WHEN (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;4000&#39;)&#xA;        OR (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;8000&#39;)&#xA;        OR (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;4000&#39; | x&#39;8000&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS hot,&#xA;      -- Tuple supprim√© (ou attribut cl√© mis √† jour)&#xA;      CASE &#xA;        WHEN ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;2000&#39;)) = (x&#39;2000&#39;)&#xA;          THEN TRUE &#xA;        ELSE FALSE&#xA;      END AS &#34;delete&#34;,&#xA;      -- Identifiant de transaction xmin gel√©&#xA;      CASE &#xA;        WHEN ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) &amp;amp; (x&#39;0100&#39; | x&#39;0200&#39;)) = (x&#39;0100&#39; | x&#39;0200&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE &#xA;      END AS &#34;freeze&#34;,&#xA;      -- Drapeaux d&#39;information&#xA;      ARRAY(&#xA;        SELECT&#xA;          array_to_string(&#xA;            regexp_matches(&#xA;              heap_tuple_infomask_flags(t_infomask, t_infomask2)::TEXT,&#xA;              &#39;[A-Za-z0-9_\-]+&#39;,&#xA;              &#39;g&#39;&#xA;            ),&#xA;            &#39;&#39;&#xA;          )&#xA;      )::text[] AS info&#xA;    FROM &#xA;      pg_catalog.pg_class AS pgc,&#xA;      LATERAL &#xA;        generate_series(0, pgc.relpages - 1) AS pages(page_num),&#xA;      LATERAL&#xA;        heap_page_items(&#xA;          get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;        ) AS hpi&#xA;    WHERE &#xA;      pgc.oid = $a$ || quote_literal(relname) || $a$::regclass &#xA;    AND (&#xA;      (&#xA;        $a$ || page_number || $a$ &amp;lt;&gt; -1&#xA;        AND&#xA;        $a$ || page_number || $a$ = pages.page_num&#xA;      )OR &#xA;      $a$ || page_number || $a$ = - 1&#xA;    ) $a$&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Stockage physique&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;C√¥t√© base, les donn√©es sont structur√©es de la fa√ßon suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Base de donn√©es&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Sch√©ma&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Table&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Ligne&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Attribut&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Mais dans le syst√®me de fichiers, les donn√©es sont structur√©es diff√©remment :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un r√©pertoire racine par tablespace.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un r√©pertoire par base de donn√©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des fichiers sp√©cifiques pour chaque table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Tablespace&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le lien entre les donn√©es et le syst√®me de fichier se mat√©rialise en base via le tablespace. Cet objet permet aux administrateurs de d√©finir l&amp;#8217;emplacement des donn√©es. Par d√©faut deux tablespaces existent et pointent vers le r√©pertoire &lt;code&gt;$PGDATA/base&lt;/code&gt; du r√©pertoire (sur Windows, il s&amp;rsquo;agit par d√©faut de ¬´¬†C:\Program Files\PostgreSQL\16\data\base¬†¬ª). Il s&amp;rsquo;se nomment :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_default&lt;/code&gt; : emplacement de stockage par d√©faut.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_global&lt;/code&gt; : emplacement de stockage des objets contenant le &lt;a href=&#34;https://www.postgresql.org/docs/current/catalogs.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;catalogue syst√®me&lt;/a&gt; (donn√©es sur le cluster).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible cr√©er un nouveau tablespace pour stocker des donn√©es sur un stockage sp√©cifique (un disque dur plus rapide par exemple) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLESPACE pgraster_data&#xA;&#x9;OWNER postgres&#xA;&#x9;LOCATION &#39;C:\mon_repertoire\de_stockage&#39;&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un tablespace est li√© √† une instance PostgreSQL et ne peut pas √™tre ouvert par une instance autre que celle qui l&amp;rsquo;a cr√©√©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un tablespace non trouvable (d√©faillance du disque dur, d√©placement&amp;#8230;) peut emp√™cher le d√©marrage de l&amp;rsquo;instance PostgreSQL.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;un tablespace peut √™tre utilis√© par n&amp;rsquo;importe qu&amp;rsquo;elle base de donn√©e de l&amp;rsquo;instance √† laquelle il appartient.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;un tablespace ne peut √™tre supprim√© tant qu&amp;rsquo;un objet est stock√© dedans.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque vous cr√©ez un tablespace, un lien symbolique est cr√©√© dans le r√©pertoire &lt;code&gt;$PGDATE/pg_tblspc&lt;/code&gt; et pointe vers le r√©pertoire d√©finit pour stocker les donn√©es du tablespace.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez lister les diff√©rents tablespaces ainsi que leurs emplacements de stockage gr√¢ce √† la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  pt.spcname AS nom,&#xA;  pa.rolname AS proprietaire,&#xA;  pg_tablespace_location(pt.oid) AS emplacement,&#xA;  pg_size_pretty(pg_tablespace_size(pt.oid)) AS poids&#xA;FROM &#xA;  pg_tablespace AS pt&#xA;LEFT JOIN&#xA;  pg_authid AS pa&#xA;  ON pa.oid = pt.spcowner&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fichiers&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le syst√®me de fichier, les donn√©es sont stock√©es dans le r√©pertoire du tablespace et s&amp;rsquo;organise assez simplement : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un r√©pertoire par base de donn√©es, dont le nom correspond √† l&amp;rsquo;OID de la base au sein de l&amp;rsquo;instance PostgreSQL.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un ensemble de fichiers par table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque table il existe un ou plusieurs fichiers dont le nom d√©bute toujours par un num√©ro nomm√© &lt;em&gt;filenode&lt;/em&gt; qui correspond souvent √† l&amp;rsquo;OID de la table (mais pas toujours, par exemple lorsqu&amp;rsquo;une table est r√©√©crite, un nouveau fichier est cr√©√© avec un nouveau num√©ro ; voir &lt;a href=&#34;#vacuum&#34;&gt;la partir sur les VACUUM&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez trouver les fichiers suivants pour chaque table (exemple pour un filenode = 112233 ) : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le &lt;strong&gt;heap file&lt;/strong&gt; : ensemble de fichiers contenant les donn√©es.&lt;br&gt;Chaque fichier du &lt;em&gt;heap file&lt;/em&gt; est appel√© segment et ne peut ex√©der 1 Go, il y a donc un nombre de segments diff√©rent selon la taille de la table.&lt;br&gt;Le premier segment est nomm√© &lt;code&gt;filenode&lt;/code&gt; sans extension (&lt;code&gt;112233&lt;/code&gt; dans notre exemple), le second se voit ajouter l&amp;rsquo;extension ¬´¬†1¬†¬ª (&lt;code&gt;112233.1&lt;/code&gt;), le troisi√®me l&amp;rsquo;extension ¬´¬†2¬†¬ª (&lt;code&gt;11223.2&lt;/code&gt;) et ainsi de suite&amp;#8230;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La &lt;strong&gt;free space map&lt;/strong&gt; : liste l&amp;rsquo;espace disponible dans chaque page.&lt;br&gt;Le fichier est nomm√©  &lt;code&gt;filenode_fsm&lt;/code&gt; (&lt;code&gt;112233_fsm&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La &lt;strong&gt;visibility map&lt;/strong&gt; : liste indiquant pour chaque page si toutes les lignes sont visibles pour toutes les transactions et si tous les tuples sont gel√©s. Cela permet au VACUUM de ne pas avoir √† scanner ces pages afin d&amp;rsquo;aller plus vite.&lt;br&gt;Le fichier est nomm√© &lt;code&gt;filenode_vm&lt;/code&gt; (&lt;code&gt;112233_vm&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;M√™me si c&amp;rsquo;est tr√®s rare, les fichiers fsm et vm peuvent se voir attribuer des extensions ¬´¬†1¬†¬ª, ¬´¬†2¬†¬ª&amp;#8230; s&amp;rsquo;ils d√©passent 1 Go et que d&amp;rsquo;autres fichiers doivent √™tre cr√©√©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un graphique pour vous repr√©senter la r√©partition des donn√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_filesystem.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3002&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Exemple d&amp;rsquo;une carte de visibilit√© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Num√©ro de page&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Only visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Only frozen&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La premi√®re page ne contient que des tuples visibles, en revanche, les pages d&amp;rsquo;apr√®s contiennent des tuples non visibles : il s&amp;rsquo;agit de tuples supprim√©s qui sont encore pr√©sents dans la base et en attente de suppression par le &lt;code&gt;VACUUM&lt;/code&gt;. Ce dernier n&amp;rsquo;a donc pas besoin de travailler sur la premi√®re page pour le nettoyage. Nous allons voir dans le paragraphe suivant ce qu&amp;rsquo;est un tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Page&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour faciliter la gestion des donn√©es, leur stockage au sein des segments du &lt;em&gt;heap file&lt;/em&gt; se fait sous la forme de paquets de 8 ko de donn√©es (param√©trable mais par d√©faut 8 ko). Un paquet de donn√©es est appel√© &lt;strong&gt;page&lt;/strong&gt; (ou bloc). Un segment peut donc contenir plusieurs pages.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3007&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Les pages sont toujours structur√©es de la m√™me fa√ßon :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;diff√©rentes m√©tadonn√©es sur la page (24 octets).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Les pointeurs :&lt;/strong&gt; il s&amp;rsquo;agit de donn√©es contenant l&amp;#8217;emplacement de chaque tuple stock√© dans la page (4 octets chacun).&lt;br&gt;Les index r√©f√©rencent ces pointeurs.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;espace restant disponible dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Les tuples :&lt;/strong&gt; un tuple √©quivaut √† une ligne dans la table. &lt;br&gt;Il s&amp;rsquo;agit d&amp;rsquo;un ensemble de m√©tadonn√©es associ√©es aux valeurs des attributs de la ligne les unes √† la suite des autres.&lt;br&gt;Les √©l√©ments sont positionn√©s dans l&amp;rsquo;ordre inverse : du dernier au premier et accol√©s √† la fin de la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des donn√©es sp√©cifiques (uniquement pour les table d&amp;rsquo;index).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3097&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;La page est consid√©r√©e comme compl√®te lorsque l&amp;rsquo;espace disponible vient √† manquer : au fur et √† mesure du remplissage, les pointeurs rejoignent les tuples et l&amp;rsquo;espace entre les deux devient insuffisant pour stocker un nouvel √©l√©ment.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que les tuples sont toujours plac√©s de fa√ßon √† √™tre align√©s sur des multiples de 8 octets. Ce positionnement entraine la pr√©sence d&amp;rsquo;espace entre les tuples lorsque ceux-ci ne poss√®dent pas une longueur multiple de 8.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Avec une telle structure, vous pouvez donc voir que lorsque PostgreSQL cr√©√© une nouvelle page, celle-ci occupe imm√©diatement 8 ko, m√™me si elle est presque vide car il s&amp;rsquo;agit d&amp;rsquo;un conteneur de taille fixe. Ainsi, une base PostgreSQL grossit par multiple de 8 ko.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la lecture des donn√©es, il y a deux cas :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le scan s√©quentiel : lors d&amp;rsquo;un parcours complet de la table, PostgreSQL lit chaque pointeur ce qui lui permet ensuite d&amp;rsquo;aller lire chaque tuple.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le scan index√© : lors d&amp;rsquo;un parcours via un index, ce dernier contient le num√©ro de page ainsi que l&amp;#8217;emplacement du pointeur de chaque donn√©e index√©e. &lt;br&gt;PostgreSQL n&amp;rsquo;a plus qu&amp;rsquo;a parcourir les pointeurs pour r√©cup√©rer la donn√©e sans avoir √† lire tous les tuples (scan s√©quentiel). &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Tuple&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donn√©es de toutes les colonnes d&amp;rsquo;une ligne sont stock√©es au sein d&amp;rsquo;un tuple (en fran√ßais ¬´¬†uplet¬†¬ª). Pour faire simple, il s&amp;rsquo;agit d&amp;rsquo;une liste de donn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les tuples sont organis√©s de la fa√ßon suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un en-t√™te contenant l&amp;rsquo;identifiant du tuple (ctid), des donn√©es de visibilit√© de transaction (t_xmin et t_xmax) et d&amp;rsquo;autres √©l√©ments que nous verrons plus tard.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une carte des valeurs &lt;code&gt;NULL&lt;/code&gt; au sein de la ligne. &lt;br&gt;Cette carte n&amp;rsquo;est pr√©sente que si la ligne contient des valeurs &lt;code&gt;NULL&lt;/code&gt;.&lt;br&gt;Il s&amp;rsquo;agit d&amp;rsquo;une suite de valeurs bool√©enne repr√©sentant chaque colonne (dans l&amp;rsquo;ordre donc) avec ¬´¬†1¬†¬ª indiquant la pr√©sence d&amp;rsquo;une valeur &lt;code&gt;NULL&lt;/code&gt;, ¬´¬†0¬†¬ª dans le cas contraire.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les donn√©es les unes √† la suite des autres.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;en-t√™te d&amp;rsquo;un tuple mesurant 23 octets, il y a donc 1 octet ajout√© pour l&amp;rsquo;alignement si aucune carte de valeurs &lt;code&gt;NULL&lt;/code&gt; n&amp;rsquo;existe : c&amp;rsquo;est la taille minimum d&amp;rsquo;un tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le placement des donn√©es au sein du tuple se fait dans l&amp;rsquo;ordre de d√©finition des colonnes en respectant deux r√®gles : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;espace occup√© d√©pend du type :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;espace peut √™tre fixe (smallint, integer, bigint&amp;#8230;)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;espace peut √™tre variable et d√©pend donc de la donn√©e (varchar, text&amp;#8230;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;#8217;emplacement d&amp;rsquo;une donn√©e par rapport √† la pr√©c√©dente d√©pend du type :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;#8217;emplacement peut √™tre align√© (smallint, integer, bigint&amp;#8230;) (m√™me principe que l&amp;rsquo;alignement des tuples dans la page sauf qu&amp;rsquo;ici la longueur est variable).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;#8217;emplacement peut √™tre non align√© (bool√©en, varchar&amp;#8230;)&lt;br&gt;Si ce type de donn√©e est en premi√®re position et qu&amp;rsquo;aucune carte de valeurs NULL n&amp;rsquo;est pr√©sente, un alignement sur le 24&lt;sup&gt;√®me&lt;/sup&gt; octet est tout de m√™me r√©alis√©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques cas de figure pour les types les plus utilis√©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;Bool√©en :&lt;/strong&gt;&lt;br&gt;Pas d&amp;rsquo;alignement : se place directement apr√®s la donn√©e de la colonne pr√©c√©dente.&lt;br&gt;Espace occup√© de 1 octet.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Smallint &amp;#8211; int2 :&lt;/strong&gt; &lt;br&gt;Alignement sur un multiple de 2 octets.&lt;br&gt;Espace occup√© de 2 octets.&lt;br&gt;Attention √† ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occup√© qui sont les m√™mes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Integer &amp;#8211; int4 :&lt;/strong&gt;  &lt;br&gt;Alignement sur un multiple de 4 octets.&lt;br&gt;Espace occup√© de 4 octets.&lt;br&gt;Attention √† ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occup√© qui sont les m√™mes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Biginteger &amp;#8211; int8 :&lt;/strong&gt;&lt;br&gt;Alignement sur un multiple de 8 octets.&lt;br&gt;Espace occup√© de 8 octets.&lt;br&gt;Attention √† ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occup√© qui sont les m√™mes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Text, Varchar :&lt;/strong&gt;&lt;br&gt;Alignement variable : aucun alignement en dessous d&amp;rsquo;une certaine taille ; au dela, les donn√©es peuvent √™tre compress√©e et/ou TOAST√©es et un header align√© sur un multiple de 4 octets est ajout√©.&lt;br&gt;Espace occup√© variable : 1 octet de header plus les donn√©es en dessous d&amp;rsquo;une certaine taille ; au dela, 4 octets de header plus les donn√©es.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requ√™te permettant de connaitre la taille fix√©e pour les types de donn√©es (pour les types variables, l&amp;rsquo;alignement se fait pour le header √©ventuellement pr√©sent) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;typname AS type,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typcategory,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typcategory&#xA;&#x9;&#x9;&#x9;WHEN &#39;A&#39; THEN &#39;Array types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;B&#39; THEN &#39;Boolean types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;C&#39; THEN &#39;Composite types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;D&#39; THEN &#39;Date/time types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;E&#39; THEN &#39;Enum types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;G&#39; THEN &#39;Geometric types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;I&#39; THEN &#39;Network address types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;N&#39; THEN &#39;Numeric types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;P&#39; THEN &#39;Pseudo-types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;R&#39; THEN &#39;Range types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;S&#39; THEN &#39;String types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;T&#39; THEN &#39;Timespan types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;U&#39; THEN &#39;User-defined types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;V&#39; THEN &#39;Bit-string types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;X&#39; THEN &#39;unknown type&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;Z&#39; THEN &#39;Internal-use types&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS category,&#xA;&#x9;CASE &#xA;&#x9;&#x9;WHEN typlen = -1 THEN &#39;variable&#39;&#xA;&#x9;&#x9;ELSE typlen::text&#xA;&#x9;END AS longueur,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typalign,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typalign&#xA;&#x9;&#x9;&#x9;WHEN &#39;c&#39; THEN &#39;char alignment, i.e., no alignment needed&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;s&#39; THEN &#39;short alignment (2 bytes on most machines)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;i&#39; THEN &#39;int alignment (4 bytes on most machines)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;d&#39; THEN &#39;double alignment (8 bytes on many machines, but by no means all)&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS alignement,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typstorage,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typstorage&#xA;&#x9;&#x9;&#x9;WHEN &#39;p&#39; THEN &#39;plain: Values must always be stored plain (non-varlena types always use this value)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;e&#39; THEN &#39;external: Values can be stored in a secondary ‚ÄúTOAST‚Äù relation&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;m&#39; THEN &#39;main: Values can be compressed and stored inline&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;x&#39; THEN &#39;extended: Values can be compressed and/or moved to a secondary relation&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS stockage&#xA;FROM &#xA;&#x9;pg_type&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette valeur d&amp;rsquo;alignement implique donc une potentielle perte d&amp;rsquo;espace entre les valeurs de chaque colonne. Ainsi, l&amp;rsquo;ordre des colonnes a une forte incidence sur le poids d&amp;rsquo;une table. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple concret pour mieux situer le probl√®me. Voila deux tables avec les m√™mes colonnes mais des agencements diff√©rents et l&amp;rsquo;impact que cela a :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.test_non_optimise (&#xA;  a int2,&#xA;  b int8,&#xA;  c int2,&#xA;  d int8&#xA;)&#xA;;&#xA;&#xA;INSERT INTO public.test_non_optimise&#xA;VALUES (1, 1, 1, 1)&#xA;;&#xA;&#xA;SELECT &#xA;  pg_column_size(test_non_optimise.*) &#xA;FROM &#xA;  public.test_non_optimise&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne ins√©r√©e p√®se 56 octets que l&amp;rsquo;on peut d√©composer ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;position &amp;#8211; longueur : commentaire&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;0  - 23 o&lt;/code&gt; : M√©tadonn√©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;23 -  1 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;24 -  2 o&lt;/code&gt; : Donn√©es integer (align√©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;26 -  6 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;32 -  8 o&lt;/code&gt; : Donn√©es biginteger (align√©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;40 -  2 o&lt;/code&gt; : Donn√©es integer (align√©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;42 -  6 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;48 -  8 o&lt;/code&gt; : Donn√©es biginteger (align√©e sur un multiple de 8).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On note beaucoup d&amp;rsquo;octets d&amp;rsquo;espacement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.test_optimise (&#xA;  b int8,&#xA;  d int8,&#xA;  a int2,&#xA;  c int2&#xA;)&#xA;;&#xA;&#xA;INSERT INTO public.test_optimise &#xA;VALUES (1, 1, 1, 1)&#xA;;&#xA;&#xA;SELECT &#xA;  pg_column_size(test_optimise.*) &#xA;FROM &#xA;  public.test_optimise&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne ins√©r√©e p√®se 44 octets que l&amp;rsquo;on peut d√©composer ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;position &amp;#8211; longueur : commentaire&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;0  - 23 o&lt;/code&gt; : M√©tadonn√©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;23 -  1 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;24 -  8 o&lt;/code&gt; : Donn√©es biginteger (align√©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;32 -  8 o&lt;/code&gt; : Donn√©es biginteger (align√©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;40 -  2 o&lt;/code&gt; : Donn√©es integer (align√©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;42 -  2 o&lt;/code&gt; : Donn√©es integer (align√©e sur un multiple de 2).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;optimisation du placement des colonnes permet de gagner 22% d&amp;rsquo;espace disque : c&amp;rsquo;est non n√©gligeable sur des tables de grande taille.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Toast&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donn√©es d&amp;rsquo;un tuple ne peuvent d√©passer une page. Ainsi, pour contourner cette limite avec des donn√©es lourdes, un m√©canisme sp√©cifique appel√© TOAST est utilis√©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;TOAST signifie ¬´¬†The Oversized-Attribute Storage Technique¬†¬ª et se d√©clenche de fa√ßon automatis√©e et totalement transparente pour l&amp;rsquo;utilisateur lorsqu&amp;rsquo;une ligne est trop lourde pour le stockage ¬´¬†standard¬†¬ª.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fonctionnement est le suivant : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Jusqu‚Äô√† 2 ko (par d√©faut, d√©finit via la variable &lt;code&gt;TOAST_TUPLE_THRESHOLD&lt;/code&gt;), un tuple est stock√© normalement, directement dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;A partir de 2 ko, le syst√®me compresse le tuple, puis deux cas de figures se pr√©sentent :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le poids du tuple compress√© est inf√©rieur √† 2 ko (par d√©faut, d√©finit via la variable &lt;code&gt;TOAST_TUPLE_TARGET&lt;/code&gt;), alors ce dernier est stock√© compress√© dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le poids du tuple compress√© est sup√©rieur √† 2 ko, alors le syst√®me transfert les donn√©es colonne par colonne dans une table annexe appel√©e table TOAST.&lt;br&gt;Le transfert commence par les colonnes les plus lourdes et s&amp;rsquo;arr√™te lorsque les colonnes restantes peuvent √™tre stock√©es dans la page (lorsqu&amp;rsquo;il reste moins de 2 ko).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_toast_diagram-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3183&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Les tables TOAST sont stock√©es dans le sch√©ma syst√®me &lt;code&gt;pg_toast&lt;/code&gt; et sont nomm√©es d&amp;rsquo;apr√®s l&amp;rsquo;OID de la table d&amp;rsquo;origine sous la forme &lt;code&gt;pg_toast_oidorigine&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il s&amp;rsquo;agit de tables standards (et donc qui peuvent √™tre lues via un simple &lt;code&gt;SELECT&lt;/code&gt;) √† la structure suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;chunk_id&lt;/code&gt; : identifiant de bloc (permettant la correspondance avec un tuple sp√©cifique de la table source).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;chunk_seq&lt;/code&gt; : num√©ro d&amp;rsquo;ordre du bloc (une donn√©e importante peut √™tre d√©coup√©e en plusieurs blocs qu&amp;rsquo;il faut pouvoir ordonnancer).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;chunk_data&lt;/code&gt; : donn√©e au format binaire.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donn√©es y sont stock√©es √† raison d&amp;rsquo;un bloc par ligne, chaque bloc √©tant un morceau de 2 ko (par d√©faut, d√©finit via la variable &lt;code&gt;TOAST_MAX_CHUNK_SIZE&lt;/code&gt;) de la donn√©e d&amp;rsquo;origine qui a donc √©t√© d√©coup√©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette division permet de r√©partir le poids des donn√©es et de les stocker de fa√ßon classique (dans un &lt;em&gt;heap file&lt;/em&gt;), sans d√©passer la taille limite d‚Äôune page. Voici un exemple sch√©matis√© du contenu de deux pages d&amp;rsquo;une table TOAST :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_toast_page.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3186&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Notez que lorsque vous requ√™tez une table, la r√©cup√©ration des donn√©es TOAST√©es poss√®de un certain co√ªt car PostgreSQL doit lire la table TOAST, r√©cup√©rer les morceaux de donn√©es, les assembler puis retourner la donn√©es consolid√©e. C&amp;rsquo;est une des raisons pour lesquelles le s√©lecteur &lt;code&gt;*&lt;/code&gt; est souvent d√©conseill√©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre point, depuis PostgreSQL 14, vous pouvez choisir l&amp;rsquo;algorithme de compression via la variable &lt;code&gt;default_toast_compression&lt;/code&gt; qui permet de choisir entre &lt;em&gt;pglz&lt;/em&gt; (format compression par d√©faut) et &lt;em&gt;lz4 (nouveau format jusqu‚Äô√†&lt;/em&gt; 80% plus rapide pour un taux de compression similaire).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Quelques requ√™tes&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques requ√™tes pour r√©cup√©rer des informations sur vos tables et mieux appr√©hender la structure des pages.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par cr√©er une table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant r√©cup√©rer quelques donn√©es gr√¢ce √† la premi√®re fonction &lt;code&gt;get_table_info()&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats (tronqu√©, je n&amp;rsquo;ai pas mis toutes les colonnes) avec en gras les valeurs qui m‚Äôint√©ressent :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Param√®tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;schema&lt;/td&gt;&lt;td&gt;public&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table&lt;/td&gt;&lt;td&gt;table_test&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tablespace&lt;/td&gt;&lt;td&gt;pg_default&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;oid_table&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;numero_heap_file&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;Le num√©ro du fichier peut √™tre diff√©rent de l&amp;rsquo;oid de la table&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;heap_file_segment_0_location&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;C:/&amp;#8230;/PG16-data/base/246510/350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;nb_page&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table vient d&amp;rsquo;√™tre cr√©√©e et ne contient aucune donn√©e donc aucune page n&amp;rsquo;a √©t√© cr√©√©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;tuple_count&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;Aucune donn√©es.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;table_length&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table venant d&amp;rsquo;√™tre cr√©√©e, elle ne p√®se encore rien&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;table_length_human&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0 bytes&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;dead_tuple_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;free_space_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;toast_oid&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350937&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table TOAST est d√©j√† cr√©√©e dans le SGBD bien qu&amp;rsquo;il n&amp;rsquo;y ait pas encore eu besoin du syst√®me TOAST..&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;toast_table&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;pg_toast_350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_heap_file_segment_0_location&lt;/td&gt;&lt;td&gt;C:/&amp;#8230;/PG16-data/base/246510/350937&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_nb_page&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_nb_tuple&lt;/td&gt;&lt;td&gt;-1&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_length_human&lt;/td&gt;&lt;td&gt;0 bytes&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez une ligne de donn√©es puis recalculez les statistiques :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Insertion de la donn√©e&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment tr√®s tr√®s tr√®s long&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats (tronqu√©s) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Param√®tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;nb_page&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;Une page a √©t√© cr√©√©e&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_count&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table_length_human&lt;/td&gt;&lt;td&gt;8192 bytes&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_length&lt;/td&gt;&lt;td&gt;2113&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;free_space_length&lt;/td&gt;&lt;td&gt;6036&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est int√©ressant de constater que les donn√©es p√®sent 2113 octets (tuple_length) et que la page p√®se 8,192 ko. En effet, les pages font toujours la m√™me taille.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir qu&amp;rsquo;il reste 6036 octets d&amp;rsquo;espace disponible dans la page avant la cr√©ation d&amp;rsquo;une seconde.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez maintenant un peu plus en d√©tail le stockage des donn√©es gr√¢ce √† cette seconde fonction &lt;code&gt;get_heap_page_info()&lt;/code&gt; qui remonte des statistiques sur le contenu des pages d&amp;rsquo;une table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Param√®tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;page_num&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;Num√©ro de page&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;lsn&lt;/td&gt;&lt;td&gt;4/1D111198&lt;/td&gt;&lt;td&gt;Identifiant xlog de la derni√®re op√©ration effectu√©e sur la page.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_pointer&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_tuple&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de tuple.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_tuple_visible&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_header&lt;/td&gt;&lt;td&gt;24&lt;/td&gt;&lt;td&gt;Taille des m√©tadonn√©es de la page.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_pointer&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;td&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_free_space&lt;/td&gt;&lt;td&gt;6036&lt;/td&gt;&lt;td&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_tuple&lt;/td&gt;&lt;td&gt;2120&lt;/td&gt;&lt;td&gt;Taille occup√©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_meta&lt;/td&gt;&lt;td&gt;48&lt;/td&gt;&lt;td&gt;Taille des m√©tadonn√©es des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_data&lt;/td&gt;&lt;td&gt;2065&lt;/td&gt;&lt;td&gt;Taille des donn√©es des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_empty&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;td&gt;Taille des espaces laiss√©s par l&amp;rsquo;alignement des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_special&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;Taille des donn√©es sp√©cifiques.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_pointer&lt;/td&gt;&lt;td&gt;24&lt;/td&gt;&lt;td&gt;Positionnement du d√©but des pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_free_space&lt;/td&gt;&lt;td&gt;32&lt;/td&gt;&lt;td&gt;Positionnement du d√©but de l&amp;rsquo;espace disponible.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_data&lt;/td&gt;&lt;td&gt;6072&lt;/td&gt;&lt;td&gt;Positionnement du d√©but des donn√©es.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_special&lt;/td&gt;&lt;td&gt;8192&lt;/td&gt;&lt;td&gt;Positionnement du d√©but des donn√©es sp√©cifique.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_page_end&lt;/td&gt;&lt;td&gt;8192&lt;/td&gt;&lt;td&gt;Positionnement de la fin de la page.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un sch√©ma de l&amp;rsquo;√©tat actuel de la page, vous remarquerez qu&amp;rsquo;il n&amp;rsquo;y a pas de bloc sp√©cifique car il s&amp;rsquo;agit d&amp;rsquo;une table classique et non pas d&amp;rsquo;une table d&amp;rsquo;index :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_test-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3099&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Bon nous voyons d√©j√† pas mal de chose mais nous ne savons pas comment se r√©partissent les tuples, leurs m√©tadonn√©es ainsi que les espaces vides. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Allez donc un peu plus loin (puisque vous √™tes l√† pour √ßa), gr√¢ce √† une troisi√®me fonction &lt;code&gt;get_heap_tuple_info()&lt;/code&gt; qui permet de r√©cup√©rer toutes les informations disponibles sur les tuples pr√©sents dans la page.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats (attention, j&amp;rsquo;ai plusieurs lignes donc mon tableau est maintenant dans l&amp;rsquo;autre sens).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_end&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_next&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_meta&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_data&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_empty&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : num√©ro de page, num√©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du d√©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position de la fin du tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position du d√©but du tuple pr√©c√©dent.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur des m√©tadonn√©es du tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur des donn√©es en elle-m√™me&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Espace vide&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8192&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2002&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1978&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6183&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;111&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;87&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la repr√©sentation exacte de la page (avec en jaune l&amp;rsquo;espace perdu √† cause de l&amp;rsquo;alignement) :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_test_accurate-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3101&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que le premier tuple poss√®de un peu moins de 2000 octets de donn√©es : c&amp;rsquo;est √† cause du champ &lt;code&gt;commentaire_2&lt;/code&gt;. En effet, le type de donn√©es &lt;code&gt;char(2000)&lt;/code&gt; limite les donn√©es √† 2000 caract√®res maximum. Cependant, ce type de donn√©es est en fait le type &lt;code&gt;bpchar(2000)&lt;/code&gt; comme &lt;em&gt;blank padded caract√®re&lt;/em&gt; : PostgreSQL ajoute des espaces au texte jusqu‚Äô√† ce qu&amp;rsquo;il atteigne 2000 caract√®res ce qui force la ligne √† prendre plus de place que n√©cessaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre √©l√©ment, le second tuple ne poss√®de que 87 octets de donn√©es. C&amp;rsquo;est √† cause du syst√®me TOAST qui s&amp;rsquo;est d√©clench√© car les donn√©es pesaient plus que 2 ko, elles ont donc √©t√© compress√©es. Comme le r√©sultat p√®se moins de 2 ko, aucune colonne n&amp;rsquo;a √©t√© transf√©r√©e dans la table TOAST.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez √©galement que les pointeurs renseignent sur l&amp;#8217;emplacement des tuples.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez encore des donn√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_end&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : num√©ro de page, num√©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du d√©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position de la fin du tuple.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6183&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6066&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2056&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4058&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;48&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2050&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une page suppl√©mentaire a √©t√© cr√©√©e, la table p√®se maintenant 2 x 8 ko : 16 ko (vous pouvez le v√©rifier avec &lt;code&gt;get_table_info()&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Gestion des donn√©es&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Colonnes syst√®me&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Des colonnes syst√®me sont pr√©sentes dans chacune des tables. Il suffit de les sp√©cifier dans vos requ√™tes pour y acc√©der, les voici :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;tableoid&lt;/code&gt; : l&amp;rsquo;OID de la table, utilisez &lt;code&gt;tableoid::regclass&lt;/code&gt; pour obtenir le nom de la table.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;ctid&lt;/code&gt; : emplacement physique de la ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;xmin&lt;/code&gt; : identifiant de la transaction d&amp;rsquo;insertion.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;cmin&lt;/code&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/ddl-system-columns.html#DDL-SYSTEM-COLUMNS-CMIN&#34;&gt;&lt;/a&gt; : identifiant de commande au sein de la transaction d&amp;rsquo;insertion.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;xmax&lt;/code&gt; : identifiant de la transaction de supression.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;cmax&lt;/code&gt; : identifiant de commande au sein de la transaction de suppression.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple avec notre table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  tableoid::regclass,&#xA;  tableoid,&#xA;  ctid,&#xA;  xmin,&#xA;  xmax,&#xA;  *&#xA;FROM &#xA;  public.table_test&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le r√©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;tableoid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;tableoid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;commentaire_1&lt;/th&gt;&lt;th&gt;commentaire_2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td&gt;un commentaire vraiment tr√®s tr√®s tr√®s long&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;E&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;F&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si besoin, n&amp;rsquo;h√©sitez pas √† utiliser cette requ√™te pour voir √† quelles lignes correspondent les tuples que nous allons analyser.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fonctionnement&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Maintenant que nous connaissons un peu mieux la fa√ßon dont les donn√©es sont stock√©es physiquement, regardons comment les mouvements sont g√©r√©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans une base PostgreSQL, l&amp;rsquo;acc√®s aux donn√©es peut se faire de fa√ßon concurrentielle (en m√™me temps) depuis diff√©rents clients. Il faut donc g√©rer correctement l&amp;rsquo;ordonnancement des transactions. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, il existe le MVCC : Multiversion Concurrency Control ou contr√¥le d&amp;rsquo;acc√®s simultan√©, il s&amp;rsquo;agit d&amp;rsquo;un syst√®me permettant la conservation des diff√©rents √©tats de la donn√©e afin de permettre √† chaque transaction de travailler sur un instantan√© de la base. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fonctionnement repose sur le principe suivant : chaque transaction poss√®de un identifiant unique et incr√©mentale, lorsqu&amp;rsquo;elle effectue une op√©ration, les lignes modifi√©es se voient attribuer son identifiant ce qui permet de ressituer l&amp;rsquo;√©tat des donn√©es par rapport √† toute autre transaction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Horaire&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 1&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h00&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D√©marrage transaction&lt;br&gt;D√©but UPDATE sur la table X&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D√©marrage transaction&lt;br&gt;D√©but INSERT sur la table Y&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h06&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin INSERT sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h08&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin UPDATE sur la table X&lt;br&gt;D√©but UPDATE sur la table Y&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin UPDATE sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque la transaction 1 effectue sa seconde op√©ration, l&amp;rsquo;√©tat des donn√©es doit √™tre celui qui existait lors du d√©marrage de la transaction. Cependant, pour √©viter de bloquer tous les utilisateurs, PostgreSQL a d√©j√† effectu√© l&amp;rsquo;INSERT de la transaction 2. Ainsi, pour conserver l&amp;rsquo;isolation de chaque transaction, une version de la table telle qu&amp;rsquo;elle √©tait lors de d√©marrage de la transaction 1 existe toujours apr√®s la finalisation de la transaction 2, le temps que la transaction 1 puisse se terminer.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que si la transaction 2 avait effectu√© une op√©ration modifiant des donn√©es de la table Y concern√©es par la transaction 1, PostgreSQL aurait attendu la fin de la transaction gr√¢ce √† un syst√®me de verrous plac√©s sur les lignes concern√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que selon le niveau d&amp;rsquo;isolation, il est possible pour une transaction de ¬´¬†voir¬†¬ª les lignes modifi√©es par d&amp;rsquo;autres transactions. Il s&amp;rsquo;agit du r√©glage de la variable &lt;code&gt;default_transaction_isolation&lt;/code&gt; qui peut prendre l&amp;rsquo;une des valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;READ COMMITTED&lt;/code&gt; : une requ√™te n&amp;rsquo;a acc√®s qu&amp;rsquo;aux lignes commit√©es avant qu&amp;rsquo;elle ne commence, c&amp;rsquo;est donc le d√©marrage de la requ√™te qui fait foi. &lt;br&gt;Ainsi, les derni√®res requ√™tes d&amp;rsquo;une transaction peuvent op√©rer sur des donn√©es ayant √©t√© modifi√©es par d&amp;rsquo;autres transactions par rapport aux premi√®res requ√™tes.&lt;br&gt;Il s&amp;rsquo;agit de la valeur par d√©faut.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;REPEATABLE READ&lt;/code&gt; : une transaction ne peut voir que les lignes commit√©es avant que la premi√®re requ√™te de la transaction ne soit ex√©cut√©e.&lt;br&gt;Deux transactions concurrentes peuvent modifier des donn√©es diff√©rentes mais appartenant √† la m√™me table ce qui peut conduire √† des donn√©es inconsistantes (car calcul√©es sur une base qui n&amp;rsquo;existe plus par exemple).&lt;br&gt;En revanche, si une seconde transaction modifie les m√™mes donn√©es que la premi√®re, une erreur &lt;code&gt;serialization_failure&lt;/code&gt; est remont√©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;SERIALIZABLE&lt;/code&gt; : une transaction ne peut voir que les lignes commit√©es avant que la premi√®re requ√™te de la transaction ne soit ex√©cut√©e. &lt;br&gt;Si deux transactions concurrentes modifient les m√™mes donn√©es, la premi√®re transaction √† commiter ¬´¬†gagne¬†¬ª et la seconde est annul√©e (&lt;code&gt;ROLLBACK&lt;/code&gt;) et une erreur &lt;code&gt;serialization_failure&lt;/code&gt; est remont√©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Mais comment cela fonctionne en d√©tail ? Pour voir cela, nous allons devoir utiliser un exemple concret.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;INSERT &amp;#8211; UPDATE &amp;#8211; DELETE&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour d√©marrer nos test, nous allons repartir de la table pr√©c√©dente (disponible dans l&amp;rsquo;onglet ¬´¬†initialisation¬†¬ª).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D√©marrez une transaction et affichez son identifiant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW gestion_data_insert_delete_udpate&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;txid_current()&#34; data-enlighter-group=&#34;gestion_data_insert_delete_udpate&#34;&gt;BEGIN;&#xA;&#xA;SELECT txid_current();&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;gestion_data_insert_delete_udpate&#34;&gt;-- !!!&#xA;-- Attention √† bien ex√©cuter chaque requ√™te dans une transaction sp√©cifique&#xA;-- Ce que permet le COMMIT √† la suite de chaque requ√™te si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- Cr√©ation d&#39;une table de test&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donn√©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment tr√®s tr√®s tr√®s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donn√©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ma transaction porte le num√©ro d&amp;rsquo;identifiant &lt;strong&gt;4440&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Modifiez des donn√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Mise √† jour de la ligne 3&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Validez la transaction :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Tant qu&amp;rsquo;a faire, faites la suppression suivante suivit d&amp;rsquo;une insertion :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez les donn√©es : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : num√©ro de page, num√©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction √† partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au del√† de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;√âtat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Visibilit√© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il √©t√© mis √† jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprim√©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gel√©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4442 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4440 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;br&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous d√©couvrez les colonnes &lt;code&gt;xmin&lt;/code&gt; et &lt;code&gt;xmax&lt;/code&gt; qui indiquent ¬´¬†√† partir de¬†¬ª et ¬´¬†jusqu‚Äô√†¬†¬ª quelle transaction un tuple est visible. J&amp;rsquo;ai ajout√© un petit drapeau √† c√¥t√© de chaque valeur :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;c : la transaction a √©t√© valid√©e (&lt;code&gt;COMMIT&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;a : la transaction a √©t√© annul√©e (&lt;code&gt;ROLLBACK&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous noterez donc que PostgreSQL garde en m√©moire les donn√©es qui ont √©t√© modifi√©es lors des transactions abandonn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir plusieurs √©l√©ments :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les lignes visibles ne poss√®dent pas de &lt;em&gt;xmax&lt;/em&gt; (en vrai il est √©gal √† 0).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;id = 3&lt;/code&gt; a √©t√© mise √† jour.&lt;br&gt;Son ancien emplacement avec les donn√©es d&amp;rsquo;origine est toujours pr√©sent et correspond √† la troisi√®me ligne. Elle est identifi√©e comme ¬´¬†morte¬†¬ª et devra √™tre nettoy√©e.&lt;br&gt;La nouvelle version est pr√©sente √† la derni√®re ligne (&lt;code&gt;ctid = (1,2)&lt;/code&gt;).&lt;br&gt;PostgreSQL a r√©alis√© un &lt;code&gt;INSERT&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;ctid = (0,4)&lt;/code&gt; correspond √† la ligne &lt;code&gt;id = 4&lt;/code&gt; que nous avons supprim√©e.&lt;br&gt;Ici aussi la donn√©e n&amp;rsquo;est pas supprim√©e mais simplement ¬´¬†taggu√©e¬†¬ª comme non visible.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;ctid = (1,3)&lt;/code&gt; correspond √† la ligne que nous venons d&amp;rsquo;ajouter : elle est situ√©e en derni√®re position.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un &lt;code&gt;UPDATE&lt;/code&gt; est en r√©alit√© la m√™me op√©ration qu&amp;rsquo;un &lt;code&gt;DELETE&lt;/code&gt; suivi d&amp;rsquo;un &lt;code&gt;INSERT&lt;/code&gt;, d&amp;rsquo;ailleurs son co√ªt est assez similaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce fonctionnement nous montre √©galement pourquoi les lignes peuvent paraitre d√©sordonn√©es lors d&amp;rsquo;un &lt;code&gt;SELECT&lt;/code&gt;. En effet, PostgreSQL remonte les lignes dans l&amp;rsquo;ordre dans lequel elles sont stock√©es. Dans notre cas, un simple &lt;code&gt;SELECT&lt;/code&gt; sur la table nous aurait donn√© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;initialement 1, 2, 3, 4, 5, 6.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Apr√®s l&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; 1, 2, 4, 5, 6, 3.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Apr√®s le &lt;code&gt;DELETE&lt;/code&gt; 1, 2, 5, 6, 3.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;HOT UPDATE&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le Heap Only Tuple UPDATE (ou simplement &lt;code&gt;HOT UPDATE&lt;/code&gt;) un processus particulier de PostgreSQL qui se produit lorsqu&amp;rsquo;il reste suffisamment de place dans une page pour que l&amp;rsquo;ancienne et la nouvelle version d&amp;rsquo;un tuple y soient stock√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lancez maintenant la requ√™te suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Mise √† jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez les donn√©es de la deuxi√®me page :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;, 1);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : num√©ro de page, num√©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du d√©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction √† partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au del√† de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;√âtat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Visibilit√© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il √©t√© mis √† jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprim√©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gel√©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4440 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from and to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;160&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette fois-ci vous pouvez voir :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;&lt;code&gt;INSERT&lt;/code&gt; est fait en fin de donn√©es (&lt;code&gt;ctid = (1,2)&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; de la ligne &lt;code&gt;id = 3&lt;/code&gt; est ici un &lt;code&gt;HOT UPDATE&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le processus en image :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_1-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3104&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Voici la table dans son √©tat initial&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3106&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;&lt;br&gt;Premi√®re √©tape du HOT UPDATE&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;La nouvelle version du tuple est ins√©r√©e en derni√®re position avec le &lt;code&gt;ctid = (1,4)&lt;/code&gt; et porte de tag ¬´¬†HOT UPDATE¬†¬ª.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;ancienne version est ¬´¬†d√©sactiv√©e¬†¬ª : son &lt;code&gt;ctid&lt;/code&gt; devient &lt;code&gt;(1,4)&lt;/code&gt; et les tags ¬´¬†HOT UPDATE¬†¬ª et ¬´¬†HEAP ONLY TUPLE¬†¬ª sont ajout√©s. Ceci permet √† PostgreSQL de comprendre, lors de la lecture du tuple 2, qu&amp;rsquo;il doit aller lire le tuple 4.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le &lt;code&gt;HOT UPDATE&lt;/code&gt; n&amp;rsquo;est en r√©alit√© pas termin√©, une seconde op√©ration va √™tre men√©e par la base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Faites la requ√™te SELECT suivante puis r√©analysez la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- SELECT&#xA;SELECT * FROM public.table_test;&#xA;&#xA;-- Analyse&#xA;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;, 1);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les donn√©es de la 2√®me page : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : num√©ro de page, num√©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du d√©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction √† partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au del√† de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;√âtat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Visibilit√© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il √©t√© mis √† jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprim√©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gel√©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;redirect to 4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from and to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le tuple 2, qui contient l&amp;rsquo;ancienne version de la ligne &lt;code&gt;id = 3&lt;/code&gt;, a √©t√© ¬´¬†nettoy√©e¬†¬ª et sont pointeur redirige vers le pointeur 4. L&amp;rsquo;offset des tuples a √©t√© modifi√© √† cause d&amp;rsquo;une d√©fragmentation de la page : c&amp;rsquo;est la seconde op√©ration du &lt;code&gt;HOT UPDATE&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le processus imag√© :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_3-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3107&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Pruning : mise √† jour du pointeur ce qui tue le tuple 2&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Lors de la premi√®re requ√™te qui suit l&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; et qui lit les donn√©es de la table (un &lt;code&gt;SELECT&lt;/code&gt; par exemple), PostgreSQL op√®re un processus de pruning :&lt;br&gt;il met √† jour le pointeur du tuple 2 et remplace la valeur de position du tuple 2 par celle du pointeur de la nouvelle version (ici le pointeur 4).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, lors d&amp;rsquo;une lecture de la donn√©e, c&amp;rsquo;est toujours le pointeur 2 qui sera lu en premier mais PostgreSQL est directement redirig√© vers le nouveau pointeur (le 4) qui l&amp;rsquo;envoi ainsi vers le nouveau tuple (le 4 donc). Ceci permet de ne pas avoir √† modifier les index dans ce type de situation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que dans le cas d&amp;rsquo;une lecture s√©quentiel, cette op√©ration (de redirection) est similaire en temps et en co√ªt que de lire directement le pointeur 4.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_4-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3108&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;PostgreSQL effectue ensuite une d√©fragmentation de la page en supprimant physiquement le tuple 2 (ce qui entraine un ¬´¬†d√©calage¬†¬ª des tuples pour combler l&amp;rsquo;espace vide). Cette d√©fragmentation ne concerne pas les pointeurs, le 2&lt;sup&gt;√®me&lt;/sup&gt; reste donc pr√©sent, r√©f√©ren√ßant toujours le pointeur 4 (toujours pour ne pas avoir √† toucher aux index).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le processus de lecture est donc identique √† l&amp;rsquo;√©tape pr√©c√©dente mais de l&amp;rsquo;espace est rendu disponible.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que si un second &lt;code&gt;HOT UPDATE&lt;/code&gt; est r√©alis√© sur le m√™me tuple et ceci juste apr√®s le premier &lt;code&gt;HOT UPDATE&lt;/code&gt;, la nouvelle version est ins√©r√©e dans l&amp;rsquo;espace qui aurait du √™tre nettoy√© par la d√©fragmentation, le pointeur qui redirigeait vers un autre pointeur (pt&lt;sub&gt;1-2&lt;/sub&gt; dans notre exemple) est alors r√©tabli. La d√©fragmentation nettoiera alors le tuple interm√©diaire ainsi que son pointeur (pt&lt;sub&gt;1-4&lt;/sub&gt;, tuple 4).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le &lt;code&gt;HOT UPDATE&lt;/code&gt; est ainsi plus rapide √† executer qu&amp;rsquo;un &lt;code&gt;UPDATE&lt;/code&gt; classique et permet de lib√©rer de l&amp;rsquo;espace en √©vitant de conserver l&amp;rsquo;ancien tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous savez maintenant plus pr√©cis√©ment comment fonctionne le stockage physique. Vous voyez ainsi que lorsque beaucoup d&amp;rsquo;op√©rations sont faites, des lignes mortes ainsi que des pointeurs suppl√©mentaires sont pr√©sents dans vos tables ce qui entraine une grande perte d&amp;rsquo;espace.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Heureusement, un outil sp√©cifique existe pour nettoyer tout cela : le &lt;code&gt;VACUUM&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34; id=&#34;vacuum&#34;&gt;VACUUM&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Passons l&amp;rsquo;aspirateur ! Ce n&amp;rsquo;est pas pour rien que le mot &lt;em&gt;VACUUM&lt;/em&gt; a √©t√© choisi pour cette op√©ration&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM consiste en le nettoyage d&amp;rsquo;une table afin d&amp;rsquo;en retirer tous les √©l√©ments qui ne sont plus utiles (lignes mortes) ainsi que de r√©arranger les √©l√©ments pour gagner de la place.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Deux types de VACUUM existent :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le Plain VACUUM (standard) : nettoyage rapide et d√©fragmentation partielle de la table.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le VACUUM FULL (complet) : nettoyage et d√©fragmentation complets de la table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;op√©ration de VACUUM est lanc√©e automatiquement par PostgreSQL via l&amp;rsquo;autovacuum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;VACUUM standard&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM standard (ou VACUUM concurrentiel ou Plain VACUUM) peut √™tre ex√©cuter sans verrouiller la table sur laquelle il porte.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il op√®re les actions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Analyse des pages pour identifier les tuples morts (issus d&amp;rsquo;un &lt;code&gt;UPDATE&lt;/code&gt;, d&amp;rsquo;un &lt;code&gt;DELETE&lt;/code&gt; ou d&amp;rsquo;une transaction abandonn√©e).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;FREEZE des tuples si n√©cessaire (voir le chapitre VACUUM FREEZE)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Suppression des entr√©es des index correspondant √† des tuples morts.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pour chaque page :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Suppression des tuples morts&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;D√©fragmentation de la page pour r√©cup√©rer l&amp;rsquo;espace des tuples morts.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Mise √† jour de la &lt;em&gt;free space map&lt;/em&gt; et de la &lt;em&gt;visibility map&lt;/em&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Suppression de la derni√®re page si possible (si aucun tuple vivant dedans).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Mise √† jour des statistiques de la table dans les tables syst√®me.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;√©tape 1 commence par un listing des tuples mort, cette lsite est cr√©√©e en m√©moire. C&amp;rsquo;est pour cette √©tape que la variable de configuration &lt;code&gt;maintenance_work_mem&lt;/code&gt; est importante. En effet, si sa valeur est trop faible, PostgreSQL devra it√©rer plusieurs fois sur la table jusqu‚Äô√† ce qu&amp;rsquo;il ne trouve plus de tuple mort.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;√©tape 2 est un FREEZE des valeurs &lt;em&gt;xmin&lt;/em&gt; des tuples. Cette op√©ration est d√©taill√©e dans le chapitre &lt;a href=&#34;#vacuum_freeze&#34;&gt;VACUUM FREEZE&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;√©tape 4 se d√©roule de la fa√ßon suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3114&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;√âtat initial : un tuple est consid√©r√© comme mort&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3115&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Les donn√©es sont effac√©es et le pointeur du tuple est r√©initialis√©&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_3.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3117&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;La d√©fragmentation r√©organise les donn√©es mais conserve le pointeur 2&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple, repartez de notre table d&amp;rsquo;exemple utilis√©e pr√©c√©demment (disponible dans l&amp;rsquo;onglet ¬´¬†initialisation¬†¬ª) puis supprimez quelques lignes et analysezla :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;get_heap_tuple_info()&#34; data-enlighter-group=&#34;start_vacuum_plain&#34;&gt;DELETE FROM public.table_test&#xA;WHERE id IN (6, 3)&#xA;;&#xA;&#xA;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;start_vacuum_plain&#34;&gt;-- !!!&#xA;-- Attention √† bien ex√©cuter chaque requ√™te dans une transaction sp√©cifique&#xA;-- Ce que permet le COMMIT √† la suite de chaque requ√™te si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- Cr√©ation de la table&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donn√©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment tr√®s tr√®s tr√®s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donn√©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise √† jour de la ligne 2&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Suppression de la ligne 4&#xA;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise √† jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- S√©lection des donn√©es pour finalisation HOT UPDATE&#xA;SELECT * FROM public.table_test&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devriez avoir la structure suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : num√©ro de page, num√©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du d√©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction √† partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au del√† de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;√âtat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Visibilit√© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il √©t√© mis √† jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprim√©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gel√©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4530 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2056&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4533 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;redirect to 4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4531 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4532 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4533 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez la diff√©rence entre les tuples non visibles qui ont √©t√© mis √† jour et les tuples non visibles qui ont √©t√© supprim√©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les premiers ont d√©j√† √©t√© nettoy√©s des tables, leurs pointeurs sont toujours pr√©sents mais ne pointent vers rien ou redirigent vers un autre pointeur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les seconds en revanche sont toujours pr√©sents mais simplement non visibles.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez √©galement le r√©sultat de la requ√™te suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple_visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Num√©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille occup√©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2012&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6136&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2128&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6024&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lancez un VACUUM puis analysez les donn√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;VACUUM public.table_test;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : num√©ro de page, num√©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Num√©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du d√©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction √† partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au del√† de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;√âtat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Visibilit√© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il √©t√© mis √† jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprim√©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gel√©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4531 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que les tuples vivants ont √©t√© r√©organis√©s (modification des offsets), quand aux morts, ils ont √©t√© supprim√©s mais leurs pointeurs sont toujours pr√©sents dans un √©tat ¬´¬†inutilis√©¬†¬ª.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez les statistiques au niveau de chaque page :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple_visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Num√©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille occup√©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4020&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4128&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6148&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2008&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir imm√©diatement que l&amp;rsquo;espace pr√©c√©demment occup√© par les tuples morts a pu √™tre r√©cup√©r√©. Les prochaines insertions se feront alors d&amp;rsquo;abord dans la premi√®re page puis dans la seconde avant de cr√©er une √©ventuelle troisi√®me page.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En revanche, vous pouvez voir que les pointeurs n&amp;rsquo;ont pas disparus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez √©galement que les donn√©es pr√©sentes dans la page 2 pourraient tout √† fait √™tre transf√©r√©es dans la page 1 maintenant qu&amp;rsquo;il y a suffisamment de place., c&amp;rsquo;est le &lt;code&gt;VACUUM FULL&lt;/code&gt; qui permet de faire cela.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;VACUUM FULL&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM FULL permet d&amp;rsquo;aller au del√† du VACUUM standard. En effet, ce dernier ne permet pas de r√©duire la taille des tables.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM FULL r√©√©crit compl√®tement le &lt;em&gt;heap file&lt;/em&gt; afin de r√©organiser les tuples et d&amp;rsquo;√©liminer les pages en trop. L&amp;rsquo;avantage est un gain de place qui peut √™tre cons√©quent.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;inconv√©nient est que pendant la r√©√©criture, la table n&amp;rsquo;est plus accessible. Un autre inconv√©nient est que deux versions de la table seront pr√©sentes sur le disque lors de la phase de r√©√©criture ce qui peut entrainer des probl√®mes d&amp;rsquo;espace disque si les donn√©es sont tr√®s volumineuses.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Reprenez notre exemple (disponible dans l&amp;rsquo;onglet ¬´¬†initialisation¬†¬ª) et analysez la table avec la fonction &lt;code&gt;get_heap_page_info()&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;get_heap_tuple_info()&#34; data-enlighter-group=&#34;start_vacuum_full&#34;&gt;-- Quelques statistiques&#xA;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;start_vacuum_full&#34;&gt;-- !!!&#xA;-- Attention √† bien ex√©cuter chaque requ√™te dans une transaction sp√©cifique&#xA;-- Ce que permet le COMMIT √† la suite de chaque requ√™te si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- Cr√©ation de la table&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donn√©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment tr√®s tr√®s tr√®s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donn√©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise √† jour de la ligne 2&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Suppression de la ligne 4&#xA;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise √† jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- S√©lection des donn√©es pour finalisation HOT UPDATE&#xA;SELECT * FROM public.table_test&#xA;;&#xA;COMMIT;&#xA;&#xA;-- VACUUM Standard&#xA;VACUUM public.table_test&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les r√©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused_line_pointer&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Num√©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Pr√©sence de pointeurs non utilis√©s.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4020&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6148&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Maintenant, r√©alisez un VACUUM FULL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- VACUUM FULL&#xA;VACUUM FULL public.table_test&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;R√©analysons la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le retour :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused_line_pointer&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Num√©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Pr√©sence de pointeurs non utilis√©s.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2016&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les tuples ont √©t√© r√©organis√©s sur la premi√®re page du nouveau fichier. D&amp;rsquo;ailleurs dans l&amp;rsquo;exemple, mon filenode √©tait &lt;strong&gt;350934&lt;/strong&gt; (l&amp;rsquo;OID de la table). Gr√¢ce √† la fonction &lt;code&gt;get_table_info()&lt;/code&gt; je vois maintenant qu&amp;rsquo;il est √©gal √† &lt;strong&gt;351418&lt;/strong&gt; : le fichier heap a bien √©t√© r√©√©crit.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le VACUUM FULL r√©√©crit √©galement les index, la visibility map ainsi que la free space map.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34; id=&#34;vacuum_freeze&#34;&gt;FREEZE des donn√©es&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM poss√®de une option : &lt;code&gt;FREEZE&lt;/code&gt; qui permet de geler les donn√©es. Mais √† quoi √ßa sert ?&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ID de transaction&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme vous l&amp;rsquo;avez vu, le syst√®me de contr√¥le d&amp;rsquo;acc√®s simultan√© (MVCC) utilise l&amp;rsquo;identifiant des transactions pour d√©terminer la visibilit√© des tuples. Cet identifiant est nomm√© &lt;strong&gt;txid&lt;/strong&gt; et est assign√© par le gestionnaire de transaction. Il s&amp;rsquo;agit d&amp;rsquo;un nombre entier non sign√© de 32 bit (soit 2&lt;sup&gt;32&lt;/sup&gt; = 4 294 967 295 valeurs diff√©rentes).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, lorsqu&amp;rsquo;une transaction est en cours, tous les √©l√©ments portant un &lt;em&gt;txid&lt;/em&gt; inf√©rieur √† celui de la transaction sont consid√©r√©s comme dans le pass√© et donc modifiables par la transaction. Tous ceux qui ont un &lt;em&gt;txid&lt;/em&gt; sup√©rieur, sont dans le futur et donc non modifiables par la transaction (cela d√©pend du mode de transaction utilis√© mais ne compliquons pas les choses).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;une seule transaction peut contenir plusieurs instructions SQL, chaque instruction se voit alors assigner un identifiant de commande (&lt;strong&gt;cid&lt;/strong&gt;), nombre entier non sign√© de 32 bits √©galement ; permettant de comparer les r√©sultats des instructions les uns par rapport aux autres, exactement comme avec les &lt;em&gt;txid&lt;/em&gt;, au sein de la transaction. Ceci contraint d&amp;rsquo;ailleurs le syst√®me √† ne pouvoir ex√©cuter ¬´¬†que¬†¬ª 4,2 milliard d&amp;rsquo;instructions SQL par transaction (on est large&amp;#8230;)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les &lt;em&gt;txid&lt;/em&gt; suivants sont sp√©ciaux :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;0 : &lt;em&gt;txid&lt;/em&gt; invalide.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1 : &lt;em&gt;txid&lt;/em&gt; d&amp;rsquo;initialisation du cluster.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2 : avant PG 9.4, il s&amp;rsquo;agit de la valeur &lt;em&gt;xmin&lt;/em&gt; gel√©e, maintenant c&amp;rsquo;est un drapeau qui est ajout√© au tuple.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;assignement du &lt;em&gt;txid&lt;/em&gt; se produit lorsque la transaction commence √† √©crire et n&amp;rsquo;indique donc pas l&amp;rsquo;ordre de d√©marrage des transactions. Ceci implique qu&amp;rsquo;une transaction peut ¬´¬†doubler¬†¬ª une autre. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Horaire&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 1&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h00&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D√©marrage transaction&lt;br&gt;D√©but &lt;code&gt;SELECT&lt;/code&gt; sur la table X&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D√©marrage transaction&lt;br&gt;D√©but &lt;code&gt;INSERT&lt;/code&gt; sur la table Y&lt;br&gt;&lt;strong&gt;=&amp;gt; Assignation d&amp;rsquo;un txid&lt;/strong&gt; : 1000&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h06&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;INSERT&lt;/code&gt; sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h08&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;SELECT&lt;/code&gt; sur la table X&lt;br&gt;D√©but &lt;code&gt;UPDATE&lt;/code&gt; sur la table Y&lt;br&gt;&lt;strong&gt;=&amp;gt; Assignation d&amp;rsquo;un txid&lt;/strong&gt; : 1001&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;UPDATE&lt;/code&gt; sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Les actions de la transaction 1 sont consid√©r√©es comme ayant √©t√© r√©alis√©es apr√®s la transaction 2 bien que cette derni√®re ait d√©marr√©e apr√®s&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Bouclage ou wraparound&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le probl√®me, c&amp;rsquo;est que 4,2 milliards de valeurs ce n&amp;rsquo;est pas forc√©ment assez dans la vie d&amp;rsquo;une base de donn√©es. Lorsqu&amp;rsquo;il y a plusieurs milliers de transactions par minutes, le compteur peut √™tre d√©pass√© en moins de 8 ans (ok on est large mais une base avec plusieurs millions de transactions par jour cela peut arriver).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour r√©soudre ceci, PostgreSQL utilise le bouclage (wraparround) : lorsque les 4,2 milliards de valeurs sont atteintes, le compteur red√©marre √† 0. Le probl√®me c&amp;rsquo;est qu&amp;rsquo;au moment du bouclage, la transaction portant le &lt;code&gt;txid = 4,1 milliards&lt;/code&gt; qui √©tait dans le pass√© se retrouve alors dans le futur (le &lt;em&gt;txid&lt;/em&gt; courant √©tant maintenant inf√©rieur). Pour √©viter ce ph√©nom√®ne, PostgreSQL consid√®re que les 2,1 milliards de transactions pr√©c√©dentes sont dans le pass√© et les 2,1 milliards suivantes dans le futur en tenant compte de ce bouclage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple, ma transaction porte le &lt;code&gt;txid = 1000&lt;/code&gt;, la ¬´¬†boucle du temps¬†¬ª serait la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table is-style-regular&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;txid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Temporalit√©&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- Pass√©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;999&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- Pass√©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;mark style=&#34;background-color:rgba(0, 0, 0, 0)&#34; class=&#34;has-inline-color has-bleu-dodger-color&#34;&gt;&lt;strong&gt;1000&lt;/strong&gt;&lt;/mark&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;mark style=&#34;background-color:rgba(0, 0, 0, 0)&#34; class=&#34;has-inline-color has-bleu-dodger-color&#34;&gt;&lt;strong&gt;Pr√©sent&lt;/strong&gt;&lt;/mark&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1001&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Futur -&amp;gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;31&lt;/sup&gt; + 999&lt;br&gt;2 147 484 647&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Futur -&amp;gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;31&lt;/sup&gt; + 1000&lt;br&gt;2 147 484 648&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- Pass√©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;32&lt;/sup&gt;&lt;br&gt;4 294 967 295&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- Pass√©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_freeze_wraparround-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3132&#34;/&gt;&lt;/figure&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requ√™te pour connaitre les limites de votre pass√© et de votre futur :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  txid_current() AS &#34;txid_current&#34;,&#xA;  CASE &#xA;    WHEN txid_current() &amp;lt; 2^31 THEN txid_current() + 2^31 - 1&#xA;    ELSE txid_current() + 2^31 - 2^32 - 1&#xA;  END AS &#34;limite_futur&#34;,&#xA;  CASE &#xA;    WHEN txid_current() &gt; 2^31 THEN txid_current() - 2^31&#xA;    ELSE txid_current() - 2^31 + 2^32&#xA;  END AS &#34;limite_pass√©&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Gel des donn√©es : Freeze&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le probl√®me qui peut survenir c&amp;rsquo;est que lorsqu&amp;rsquo;il y a eu plus de 2,1 (exactement 2&lt;sup&gt;21&lt;/sup&gt;) milliards de transactions, PostgreSQL va consid√©rer d&amp;rsquo;anciennes transactions comme √©tant dans le futur. Pas tr√®s pratique&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;C&amp;rsquo;est pour r√©soudre ce probl√®me que le FREEZE a √©t√© invent√©. Il permet d&amp;rsquo;ajouter un drapeau sur un tuple indiquant que son &lt;em&gt;xmin &lt;/em&gt;est ¬´¬†gel√©¬†¬ª, c&amp;rsquo;est √† dire que peu importe la valeur du &lt;em&gt;xmin&lt;/em&gt;, il doit √™tre consid√©r√© comme inf√©rieur au &lt;em&gt;txid&lt;/em&gt; actuel, m√™me si ce n&amp;rsquo;est pas le cas.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, le VACUUM se charge de geler les lignes ad√©quates selon les cas suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM standard :&lt;/strong&gt; tous les tuples dont le &lt;em&gt;xmin&lt;/em&gt; est inf√©rieur de la valeur √† : &lt;code&gt;oldest_current_txid&lt;/code&gt; &amp;#8211; &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt;&lt;br&gt;Le FREEZE n&amp;rsquo;est op√©r√© que sur les pages pour lesquelles le VACUUM op√®re : les pages contenant des tuples morts. On parle alors de lazy FREEZE (FREEZE paresseux).&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La valeur de &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt; est d√©finie dans le fichier &lt;em&gt;postgresql.com&lt;/em&gt; et est fix√©e par d√©faut fix√©e √† 50 000 000.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;oldest_current_txid&lt;/code&gt; correspond au plus vieux txid des transaction en cours.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM FREEZE :&lt;/strong&gt; tous les tuples dont le &lt;em&gt;xmin&lt;/em&gt; est inf√©rieur √† &lt;code&gt;oldest_current_txid&lt;/code&gt;.&lt;br&gt;Le FREEZE est op√©r√© sur toutes les pages de la table. On parle de FREEZE aggressif.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM FULL :&lt;/strong&gt; √©quivalent du VACUUM FREEZE, les op√©rations de nettoyage sont diff√©rentes mais les op√©rations de FREEZE int√©gr√©e sont √©quivalentes.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si l&amp;rsquo;age de la table (age du plus vieux tuple) d√©passe la valeur de la variable &lt;code&gt;vacuum_freeze_table_age&lt;/code&gt; (par d√©faut 150 000 000) alors le prochain VACUUM lanc√© s&amp;rsquo;accompagnera d&amp;rsquo;un FREEZE aggressif.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention car le gel des tuples d&amp;rsquo;une page implique de r√©√©crire enti√®rement cette derni√®re et a donc un co√ªt important. Si le VACUUM prend trop de temps, il est possible de le stopper, le travail d√©j√† accompli en sera pas perdu (notamment sur le gel des donn√©es).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A la fin du VACUUM, des statistiques sont calcul√©es et les valeurs suivantes renseign√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; : &lt;em&gt;txid&lt;/em&gt; le plus r√©cent ayant √©t√© gel√© dans la table.&lt;br&gt;Il s&amp;rsquo;agit de la valeur ayant √©t√© utilis√©e pour geler les tuples (&lt;code&gt;txid&lt;/code&gt; ou &lt;code&gt;txid&lt;/code&gt; &amp;#8211; &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt;), pas forc√©ment du &lt;em&gt;txid&lt;/em&gt; gel√© le plus r√©cent ; ce dernier est en effet plus ancien ou √©gal √† cette valeur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_catalog.pg_database.datfrozenxid&lt;/code&gt; : &lt;em&gt;txid&lt;/em&gt; le plus r√©cent ayant √©t√© gel√© dans toute la base.&lt;br&gt;Il s&amp;rsquo;agit du &lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; le plus ancien.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas de notre exemple, la colonne &lt;code&gt;max_frozen_txid&lt;/code&gt; de la fonction &lt;code&gt;get_table_info()&lt;/code&gt; vaut &lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;AUTOVACUUM&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;blockquote class=&#34;wp-block-quote is-layout-flow wp-block-quote-is-layout-flow&#34;&gt;&#xA;&lt;p&gt;Vacuuming is like exercising. If it hurts, you‚Äôre not doing it enough!&lt;/p&gt;&#xA;&lt;cite&gt;Robert Haas, PGConf.EU 2023, Prague, 13 d√©cembre 2023&lt;/cite&gt;&lt;/blockquote&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un VACUUM cela peut √™tre tr√®s rapide mais cela peut aussi √™tre tr√®s lourd et c&amp;rsquo;est pour cela qu&amp;rsquo;il faut le lancer r√©guli√®rement. C&amp;rsquo;est justement le r√¥le de l&amp;rsquo;autovacuum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Toutes les minutes (interval param√©trable via le param√®tre &lt;code&gt;autovacuum_naptime&lt;/code&gt;), l&amp;rsquo;autovacuum se lance, analyse les donn√©es de la vue &lt;code&gt;pg_stat_all_tables&lt;/code&gt; afin de d√©terminer s&amp;rsquo;il doit lancer un &lt;code&gt;VACUUM&lt;/code&gt; et ou un &lt;code&gt;ANALYSE&lt;/code&gt; sur les diff√©rentes tables de la base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Plusieurs tables peuvent √™tre nettoy√©es en m√™me temps : un processus de VACUUM sur une table utilise un worker et par d√©faut jusqu‚Äô√† trois peuvent √™tre lanc√©s (variable &lt;code&gt;autovacuum_max_workers&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le d√©clenchement de l&amp;rsquo;autovacuum sur une table se fait si au moins l&amp;rsquo;une des conditions suivantes est remplie :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt; Le &lt;em&gt;txid&lt;/em&gt; courant est plus r√©cent que :&lt;br&gt;&lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; + &lt;code&gt;autovacuum_freeze_max_age&lt;/code&gt;&lt;br&gt;Le tuple le plus vieux de la table est plus ancien que la valeur de la variable &lt;code&gt;autovacuum_freeze_max_age&lt;/code&gt; (par d√©faut 200 000 000).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le nombre de tuples morts est plus important que :&lt;br&gt;&lt;code&gt;autovacuum_vacuum_threshold&lt;/code&gt; + ( &lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; √ó &lt;code&gt;nombre_tuples_relation&lt;/code&gt; )&lt;br&gt;Avec les valeurs par d√©faut cela correspond √† 250 tuples morts pour 1000 tuples dans la table ou 2050 pour 10 000.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le nombre de tuples ins√©r√©s est plus important que :&lt;br&gt;&lt;code&gt;autovacuum_vacuum_insert_threshold&lt;/code&gt; + ( &lt;code&gt;autovacuum_vacuum_insert_scale_factor&lt;/code&gt; √ó &lt;code&gt;nombre_tuples_relation&lt;/code&gt; )&lt;br&gt;Avec les valeurs par d√©faut cela correspond √† 3000 tuples ins√©r√©s pour 10 000 tuples dans la table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur par d√©faut de &lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; est trop importante pour les grosses tables. Par exemple, une table qui contient 1 000 000 d&amp;rsquo;enregistrements ne se verra nettoy√©e qu&amp;rsquo;apr√®s 200 050 mouvements ce qui est tr√®s important. D&amp;rsquo;autant plus que le VACUUM qui sera d√©clench√© risque d&amp;rsquo;√™tre tr√®s lourds en raison de la taille importante de la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les param√®tres suivants sont int√©ressants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;maintenance_work_mem&lt;/code&gt; / &lt;code&gt;autovacuum_work_mem&lt;/code&gt; : quantit√© de m√©moire allou√©e pour les processus de maintenance. N&amp;rsquo;h√©sitez pas √† le pousser jusqu‚Äô√† 1 Go (au del√†, le VACUUM n&amp;rsquo;en a pas l&amp;rsquo;utilit√©).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; : pourcentage de tuples modifi√©s au del√† duquel l&amp;rsquo;autovacuum se lance. Il est int√©ressant de le d√©finir sp√©cifiquement pour les tables de grande taille.&lt;br&gt;Par exemple pour le passer √† 5% : &lt;code&gt;ALTER TABLE table_name SET (autovacuum_vacuum_scale_factor = 0.05);&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_vacuum_insert_scale_factor&lt;/code&gt; : pourcentage de tuples ins√©r√©s au del√† duquel l&amp;rsquo;autovacuum se lance. Il est int√©ressant de le d√©finir sp√©cifiquement pour les tables de grande taille.&lt;br&gt;Par exemple pour le passer √† 5% : &lt;code&gt;ALTER TABLE table_name SET (autovacuum_vacuum_insert_scale_factor = 0.05);&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_max_workers&lt;/code&gt; : nombre de workers pouvant √™tre lanc√©s simultan√©ment durant le processus d&amp;rsquo;autovacuum.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les statistiques que nous avons actuellement pour la table de notre exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Param√®tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;schema&lt;/td&gt;&lt;td&gt;public&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table&lt;/td&gt;&lt;td&gt;table_test&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_page&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_count&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;dead_tuple_count&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;max_frozen_txid&lt;/td&gt;&lt;td&gt;4644&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_ins&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_upd&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_del&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_mod_since_analyze&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_ins_since_vacuum&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_vacuum&lt;/td&gt;&lt;td&gt;2024-01-01 01:01:01.000 +0100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_autovacuum&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_analyze&lt;/td&gt;&lt;td&gt;2024-01-01 01:01:01.000 +0100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_autoanalyze&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour en savoir plus&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voila un tr√®s gros r√©sum√© de comment PostgreSQL g√®re les donn√©es physiquement. Vous pouvez pousser le sujet en consultant les ressources suivantes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le stockage physique :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage-page-layout.htm&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage-page-layout.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/pageinspect.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/pageinspect.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/pgstattuple.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/pgstattuple.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/ddl-system-columns.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/ddl-system-columns.html&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le syst√®me de contr√¥le concurrentiel :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/transaction-id.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/transaction-id.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql05.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql05.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.thenile.dev/blog/transaction-isolation-postgres&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.thenile.dev/blog/transaction-isolation-postgres&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://medium.com/quadcode-life/structure-of-heap-table-in-postgresql-d44c94332052&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://medium.com/quadcode-life/structure-of-heap-table-in-postgresql-d44c94332052&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://postgrespro.com/blog/pgsql/5967892&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://postgrespro.com/blog/pgsql/5967892&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://idrawone.github.io/2020/10/09/Heap-Page-in-details/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://idrawone.github.io/2020/10/09/Heap-Page-in-details/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur les TOAST :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage-toast.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage-toast.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.anayrat.info/en/2022/02/14/postgresql-toast-compression-and-toast_tuple_target/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://blog.anayrat.info/en/2022/02/14/postgresql-toast-compression-and-toast_tuple_target/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le VACUUM :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/maintenance.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/maintenance.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql05/10.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql05/10.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql06.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql06.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://public.dalibo.com/exports/formation/manuels/modules/m5/m5.handout.html#param%C3%A9trage-de-vacuum-autovacuum&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://public.dalibo.com/exports/formation/manuels/modules/m5/m5.handout.html#param%C3%A9trage-de-vacuum-autovacuum&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://pankajconnect.medium.com/vacuum-and-vacuum-full-postgresql-4c9da30a1500&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://pankajconnect.medium.com/vacuum-and-vacuum-full-postgresql-4c9da30a1500&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/stockage-physique-gestion-des-donnees-et-vacuum" rel="alternate"></link>
    <summary type="html">Base de donn√©es ou fichiers plats ? Saviez-vous que PostgreSQL stockait les donn√©es dans des fichiers plats ? D√©mystifions un peu ce fonctionnement.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Ouvrez les fen√™tres de PostgreSQL ‚Äì Guide complet sur le fen√™trage</title>
    <updated>2024-01-04T16:39:54Z</updated>
    <id>tag:blog.arthurbazin.com,2024-01-04:/bdd/postgresql/ouvrez-les-fenetres-de-postgresql-guide-complet-sur-le-fenetrage</id>
    <content type="html">&#xA;&lt;p&gt;Sous PostgreSQL, il est possible d&amp;rsquo;effectuer des op√©rations de statistique (de type agr√©gat) sur un ensemble de lignes sans avoir √† les agr√©ger gr√¢ce aux fonctions de fen√™trage. Il devient ainsi possible de calculer des valeurs cumul√©es ou encore des sommes par unit√© de temps (dans le cas de donn√©es dat√©es)&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fen√™trage permet en outre de d√©finir la port√© de la fonction, c&amp;rsquo;est √† dire de sp√©cifier les limites des regroupements de lignes utilis√©s dans la fonction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple de ce qu&amp;rsquo;il est possible de calculer : les deux derni√®res colonnes se basent sur des fonctions de fen√™trage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Cumul&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Moyenne par mois&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;27&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;47&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;E&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;23&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;70&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;F&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;90&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;G&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;H&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;113&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;I&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;123&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Syntaxe&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Clause WINDOW&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La syntaxe est relativement simple : il suffit d&amp;rsquo;utiliser une fonction de fen√™trage dans la clause &lt;code&gt;SELECT&lt;/code&gt; puis d√©finir la fen√™tre √† utiliser dans la clause &lt;code&gt;WINDOW&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;colonne_1,&#xA;&#x9;colonne_2,&#xA;&#x9;fonction_fenetre(colonne_3) OVER ma_fenetre&#xA;FROM&#xA;&#x9;mon_schema.ma_table&#xA;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;--definition&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;il est possible de d√©finir la fen√™tre directement apr√®s la fonction de fen√™trage :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;colonne_1,&#xA;&#x9;colonne_2,&#xA;&#x9;fonction_fenetre(colonne_3) OVER (&#xA;&#x9;&#x9;--definition&#xA;&#x9;)&#xA;FROM&#xA;&#x9;mon_schema.ma_table&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est tout √† fait possible de d√©finir plusieurs fen√™tres dans la clause &lt;code&gt;WINDOW&lt;/code&gt; afin d&amp;rsquo;utiliser des port√©es diff√©rentes dans chaque fonction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention les lignes vues par la fen√™tre d√©pendent des clauses pr√©sentes dans votre requ√™te :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La clause &lt;code&gt;WHERE&lt;/code&gt; restreint le nombre de lignes dans le r√©sultat de la requ√™te mais √©galement dans la fen√™tre.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Avec la clause &lt;code&gt;GROUP BY&lt;/code&gt;, les lignes vues par la fen√™tre sont les lignes regroup√©es et non les lignes d&amp;rsquo;origines.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La clause &lt;code&gt;HAVING&lt;/code&gt; restreint le nombre de lignes group√©es visibles par la fen√™tre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;D√©finition&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La d√©finition d&amp;rsquo;une fen√™tre peut faire appel √† diff√©rents √©l√©ments, tous optionnels :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La clause &lt;code&gt;PARTITION BY&lt;/code&gt; : comment regrouper les lignes ?&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La clause &lt;code&gt;ORDER BY&lt;/code&gt; : comment ordonnancer les lignes ?&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de la fen√™tre : quelles lignes du groupe faut-il utiliser ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;-- Regroupement&#xA;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;ma_colonne_1&#xA;&#x9;&#x9;-- Ordonnancement&#xA;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;ma_colonne_2&#xA;&#x9;&#x9;-- Limites&#xA;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;PARTITION BY : regroupement&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La clause de regroupement &lt;code&gt;PARTITION BY&lt;/code&gt; permet de grouper les lignes issues de la requ√™tes en partitions. Chacune de ces partitions est trait√©e individuellement par la fonction de fen√™trage. Ainsi, chaque ligne se voit attribuer une valeur calcul√©e par la fonction de fen√™trage en fonction de la partition √† laquelle elle appartient. Par exemple la somme ou encore la valeur moyenne de toutes les valeurs d&amp;rsquo;une partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette clause attend une expression pouvant contenir une ou plusieurs colonnes ainsi que des expressions SQL (fonction, calcul&amp;#8230;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si cette clause n&amp;rsquo;est pas sp√©cifi√©e alors toutes les lignes de la requ√™te sont consid√©r√©es comme faisant partie de la m√™me partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici deux exemples de regroupement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pays&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe calcul√© par &lt;code&gt;PARTITION BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;France&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;France&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Suisse&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Suisse&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;france&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 3&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Regroupement bas√© sur une colonne : &lt;code&gt;PARTITION BY pays&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ma_colonne_date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe calcul√© par &lt;code&gt;PARTITION BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;08/04/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;15/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Regroupement bas√© sur une expression : &lt;code&gt;PARTITION BY extract(MONTH FROM ma_colonne_date)&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le regroupement des valeurs entraine un ordonnancement de celles-ci qui influe sur l&amp;rsquo;ordre des lignes dans les r√©sultats de la requ√™te. Il pourra √™tre n√©cessaire d&amp;rsquo;utiliser la clause &lt;code&gt;ORDER BY&lt;/code&gt; (dans la requ√™te, pas le &lt;code&gt;ORDER BY&lt;/code&gt; de la fen√™tre) pour sp√©cifier un ordre particulier des r√©sultats.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;ORDER BY : l&amp;rsquo;ordonnancement&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Selon le calcul r√©alis√©, il peut √™tre int√©ressant d&amp;rsquo;ordonnancer les valeurs de la fen√™tre. Par exemple dans le cas d&amp;rsquo;une somme cumul√©e (croissante ou d√©croissante), il est important que les valeurs au sein d&amp;rsquo;une partition soient tri√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette clause attend une expression permettant d&amp;rsquo;ordonnancer les lignes, cela peut √™tre une ou plusieurs colonnes ainsi que des expressions SQL (fonction, calcul‚Ä¶).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ma_colonne_date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Rang calcul√© par &lt;code&gt;ORDER BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;15/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Ordonnancement bas√© sur une colonne, &lt;code&gt;ma_colonne_date&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les options suivantes peuvent √™tre utilis√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ASC&lt;/code&gt; ou &lt;code&gt;DESC&lt;/code&gt; : pour sp√©cifier un tri ascendant ou descendant.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;NULLS { FIRST | LAST }&lt;/code&gt;  pour g√©rer l&amp;rsquo;ordre des valeurs nulles (en premier ou en dernier).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque plusieurs fonctions de fen√™trage sont utilis√©es, les valeurs peuvent √™tre tri√©es plusieurs fois de suites.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les fen√™tre ayant des clauses &lt;code&gt;PARTITION BY&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; √©quivalente seront √©valu√©es en m√™me temps et auront donc exactement le m√™me ordre de tri (m√™me si &lt;code&gt;ORDER BY&lt;/code&gt; ne d√©finit pas une fa√ßon unique de trier les lignes).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les fen√™tres ayant des clauses &lt;code&gt;PARTITION BY&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; diff√©rentes seront √©valu√©es s√©par√©ment. Il en r√©sulte un tri potentiellement diff√©rent entre deux fen√™tres ayant des partions diff√©rentes mais un ordre de tri identique (lorsque &lt;code&gt;ORDER BY&lt;/code&gt; ne d√©finit pas une fa√ßon unique de trier les lignes).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que l&amp;rsquo;ordonnancement des valeurs influe sur l&amp;rsquo;ordre des lignes dans les r√©sultats de la requ√™te. Il pourra √™tre n√©cessaire d&amp;rsquo;utiliser la clause &lt;code&gt;ORDER BY&lt;/code&gt; (dans la requ√™te, pas le &lt;code&gt;ORDER BY&lt;/code&gt; de la fen√™tre) pour sp√©cifier un ordre particulier des r√©sultats.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Clause de port√©e : les limites de la fen√™tre&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions ne portent pas directement sur toutes les ligne de la partition qu&amp;rsquo;elles sont en train de traiter. En fait, leur calcul est d√©pendant de la ligne en cour de traitement. En effet, chaque fen√™tre poss√®de un port√©e limit√©e au sein de la partition d√©finie (par &lt;code&gt;PARTITION BY&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par d√©faut, cette limite s&amp;rsquo;√©tend √† toute la partition sauf dans le cas o√π une clause &lt;code&gt;ORDER BY&lt;/code&gt; est d√©finie pour la fen√™tre. Dans ce dernier cas, la limite est comprise entre ¬´¬†toutes les lignes pr√©c√©dentes¬†¬ª et ¬´¬†la ligne actuelle¬†¬ª. Donc la fonction ne ¬´¬†voient¬†¬ª pas les lignes qui ¬´¬†suivent¬†¬ª au sein de la m√™me partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les limites se d√©finissent de la fa√ßon suivante : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le mode de d√©finition&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de d√©but&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de fin&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les exclusions&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;{ROWS | RANGE | GROUPS}&#xA;BETWEEN&#xA;&#x9;{UNBOUNDED PRECEDING | n PRECEDING | CURRENT ROW | n FOLLOWING}&#xA;AND&#xA;&#x9;{n PRECEDING | CURRENT ROW | n FOLLOWING | UNBOUNDED FOLLOWING}&#xA;EXCLUDE &#xA;&#x9;{CURRENT ROW | EXCLUDE GROUP | EXCLUDE TIES | EXCLUDE NO OTHERS}&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe trois modes de d√©finition des limites :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : que je traduis par ligne.&lt;br&gt;On d√©finit un nombre sp√©cifique de lignes avant ou apr√®s la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : que je traduis par rang.&lt;br&gt;On d√©finit un nombre de rangs s√©parant la limite de la ligne courante.&lt;br&gt;Le rang de chaque ligne est d√©finit avec la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Plusieurs lignes peuvent avoir le m√™me rang, on parle alors de ¬´¬†groupe de lignes √©quivalentes¬†¬ª dans le tri ce qui √©quivaut √† ¬´¬†groupe de ligne ayant le m√™me rang¬†¬ª dans le tri.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : (mode par d√©faut) que je traduis par intervalle.&lt;br&gt;On d√©finit un intervalle d&amp;rsquo;√©cart entre la ligne courante et la limite&lt;br&gt;L&amp;rsquo;intervalle est calcul√© sur une colonne unique d√©finie dans la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Le type de l&amp;rsquo;intervalle d√©pend de la colonne sp√©cifi√©e (num√©rique, date&amp;#8230;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La d√©finition des limites peut utiliser les √©l√©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;UNBOUNDED PRECEDING&lt;/code&gt; : toutes les lignes pr√©c√©dentes (limite inf√©rieur par d√©faut)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;n PRECEDING&lt;/code&gt; : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : n = nombre de ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : n = nombre de rang/groupe.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : n = intervalle avec la ligne actuelle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;CURRENT ROW&lt;/code&gt; : (limite sup√©rieur par d√©faut)&lt;br&gt;√âquivalent √† &lt;code&gt;0 PRECEDING&lt;/code&gt; ou &lt;code&gt;0 FOLLOWING&lt;/code&gt;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : la ligne courante ainsi que toutes les lignes ayant le m√™me rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;En d√©but de port√©e, la ligne utilis√©e sera la premi√®re ligne retourn√©e ayant un rang √©quivalent √† la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;En fin de port√©e, la ligne utilis√©e sera la derni√®re ligne retourn√©e ayant un rang √©quivalent √† la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : la ligne courante ainsi que toutes les lignes ayant le m√™me rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;En d√©but de port√©e, la ligne utilis√©e sera la premi√®re ligne retourn√©e ayant un rang √©quivalent √† la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;En fin de port√©e, la ligne utilis√©e sera la derni√®re ligne retourn√©e ayant un rang √©quivalent √† la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;n FOLLOWING&lt;/code&gt; :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : n = nombre de ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : n = nombre de rang/groupe.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : n = intervalle avec la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;UNDOUNDED FOLLOWING&lt;/code&gt; : toutes les lignes suivantes.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention aux restrictions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;le d√©but de la port√©e ne peut valoir &lt;code&gt;UNBOUNDED FOLLOWING&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La fin de la port√©e ne peut valoir &lt;code&gt;UNBOUNDED PRECEDING&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le d√©but de la port√©e doit toujours √™tre inf√©rieur √† la fin de la port√©e (&lt;code&gt;ROWS BETWEEN 7 PRECEDING AND 8 PRECEDING&lt;/code&gt; ne donne aucune ligne et &lt;code&gt;RANGE BETWEEN CURRENT ROW AND &lt;em&gt;n&lt;/em&gt; PRECEDING&lt;/code&gt; renvoie une erreur).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que lorsque la clause &lt;code&gt;ORDER BY&lt;/code&gt; n&amp;rsquo;est pas sp√©cifi√©e, toutes les lignes sont consid√©r√©es comme ayant le m√™me rang. Ainsi, il est important de tenir compte de cet √©l√©ment dans les modes &lt;code&gt;GROUPS&lt;/code&gt; et &lt;code&gt;RANGE&lt;/code&gt; et par cons√©quent avec la limite par d√©faut qui est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;RANGE BETWEEN&#xA;&#x9;UNBOUNDED PRECEDING&#xA;AND&#xA;&#x9;CURRENT ROW&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En effet, avec la limite par d√©faut, toutes les lignes entre la premi√®re de la partition et la ligne courante incluant les lignes de m√™me rang sont utilis√©es. Ainsi, deux cas de figure se pr√©sentes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Une clause &lt;code&gt;ORDER BY&lt;/code&gt; est sp√©cifi√©e : une partie seulement des lignes de la partition est utilis√©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Aucune clause &lt;code&gt;ORDER BY&lt;/code&gt; n&amp;rsquo;est sp√©cifi√©e : toutes les lignes poss√®dent le m√™me rang, ainsi elles sont toutes incluses dans la fen√™tre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans tous les cas, la distance jusqu&amp;rsquo;√† la fin de la port√©e est limit√©e par la distance jusqu&amp;rsquo;√† la fin de la partition. Si la limite d√©passe la fin de la partition, alors la derni√®re ligne est la derni√®re de la partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est enfin possible de d√©finir un ensemble de lignes √† exclure de la fen√™tre avec la clause &lt;code&gt;EXCLUDE&lt;/code&gt; qui peut prendre les valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE NO OTHERS&lt;/code&gt; : ne rien exclure (comportement par d√©faut).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;CURRENT ROW&lt;/code&gt; : exclure la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE GROUP&lt;/code&gt; : exclure la ligne courante ainsi que toutes les lignes de m√™me rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE TIES&lt;/code&gt; : conserver la ligne courante mais exclure toutes les lignes de m√™me rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fen√™tres de fen√™tre&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;une fen√™tre est d√©finie sans clause de port√©e, il est possible d&amp;rsquo;en d√©finir une seconde √† partir de celle-ci.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans ce cas :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La seconde reprend le partitionnement de la fen√™tre source.&lt;br&gt;Il est impossible de sp√©cifier une clause &lt;code&gt;PARTITION BY&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La seconde reprend l&amp;rsquo;ordonnancement de la fen√™tre source si la clause &lt;code&gt;ORDER BY&lt;/code&gt; existe.&lt;br&gt;Dans ce cas, il est impossible de sp√©cifier une clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Sinon, la seconde peut se voir d√©finir un clause &lt;code&gt;ORDER BY&lt;/code&gt; qui lui sera sp√©cifique.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La seconde peut avoir ses propres limites de fen√™tre via sa propre clause de port√©e.&lt;br&gt;Si les limites ne sont pas d√©finies, les limites par d√©faut s&amp;rsquo;appliquent (&lt;code&gt;RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;-- Regroupement&#xA;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;ma_colonne_1&#xA;&#x9;),&#xA;&#xA;&#x9;ma_seconde_fenetre as (&#xA;&#x9;&#x9;-- Fen√™tre source&#xA;&#x9;&#x9;ma_fenetre&#xA;&#x9;&#x9;-- Ordonnancement (car la fen√™tre source ne sp√©cifie pas de clause ORDER BY)&#xA;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;ma_colonne_2&#xA;&#x9;&#x9;-- Limites sp√©cifiques&#xA;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Les fonctions&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions de fen√™trage peuvent √™tre utilis√©es dans les clauses &lt;code&gt;SELECT&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; uniquement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ces fonctions regroupent √† la fois les fonctions sp√©cifiques au fen√™trage (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-window.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;document√©es ici&lt;/a&gt;) ainsi que certaines fonctions d&amp;rsquo;agr√©gation : celles √† but g√©n√©ral (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;document√©es ici&lt;/a&gt;) et celles √† but statistique (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;document√©es ici&lt;/a&gt;) mais pas les autres.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La syntaxe est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;fonction_fenetre(colonne) OVER ma_fenetre&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lors de l&amp;rsquo;utilisation de fonctions d&amp;rsquo;agr√©gation avec une fen√™tre, il n&amp;rsquo;est pas possible d&amp;rsquo;utiliser les clauses &lt;code&gt;DISTINCT&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; dans les arguments de la fonction comme habituellement avec les fonctions d&amp;rsquo;agr√©gation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En revanche, ces fonctions d&amp;rsquo;agr√©gation autorisent le filtrage des lignes utilis√©es par celles-ci gr√¢ce √† la clause &lt;code&gt;FILTER&lt;/code&gt; de la fa√ßon suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;fonction_fenetre(colonne) FILTER ( WHERE ma_clause_where ) OVER ma_fenetre&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est ainsi possible d&amp;rsquo;utiliser n&amp;rsquo;importe quelle condition qui sera test√©e sur chaque ligne de la fen√™tre avant de fournir celles-ci √† la fonction. Les lignes ne satisfaisant pas la conditions seront ignor√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les principales fonctions de fen√™trage :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table alignwide has-fixed-layout is-style-stripes&#34;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Fonction&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;row_number()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Num√©ro de ligne&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang de l&amp;rsquo;objet avec trou. &lt;br&gt;Comme row_number() mais deux objets peuvent avoir le m√™me rang.&lt;br&gt;Par exemple : &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;6&lt;/code&gt;, &lt;code&gt;7&lt;/code&gt;, &lt;code&gt;7&lt;/code&gt;, &lt;code&gt;9&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;dense_rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang de l&amp;rsquo;objet sans trou. &lt;br&gt;Comme rank() mais si plusieurs objets ont le m√™me rang, l&amp;rsquo;objet d&amp;rsquo;apr√®s poss√®de le rang suivant.&lt;br&gt;Par exemple : &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;3&lt;/code&gt;, &lt;code&gt;4&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;6&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;percent_rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang en pourcentage (de 0% √† 100%) : (rang -1) / (nb_ligne_total &amp;#8211; 1).&lt;br&gt;Par exemple (pour 4 valeurs) : &lt;code&gt;0%&lt;/code&gt;, &lt;code&gt;33%&lt;/code&gt;, &lt;code&gt;66%&lt;/code&gt;, &lt;code&gt;100%&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;cume_dist()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang en pourcentage (de n% √† 100%) : (nb_lignes_pr√©c√©dentes + nb_ligne_m√™me_rang + 1) / (nb_ligne_total).&lt;br&gt;Par exemple (pour 4 valeurs) : &lt;code&gt;25%&lt;/code&gt;, &lt;code&gt;50%&lt;/code&gt;, &lt;code&gt;75%&lt;/code&gt;, &lt;code&gt;100%&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;first_value(colonne_1)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Premi√®re valeur issue de la fen√™tre pour la colonne indiqu√©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;last_value(colonne_1)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Derni√®re valeur issue de la fen√™tre pour la colonne indiqu√©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;nth_value(colonne_1,n)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur &amp;lsquo;n&amp;rsquo; issue de la fen√™tre pour la colonne indiqu√©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;lag(colonne_1,n,&#39;text&#39;)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur issue de la fen√™tre pour la colonne indiqu√©e situ√©e n lignes (defaut = &lt;code&gt;1&lt;/code&gt;) avant la ligne √©valu√©e. &lt;br&gt;Si aucune valeur n&amp;rsquo;existe, &amp;lsquo;text&amp;rsquo; (d√©faut = &lt;code&gt;NULL&lt;/code&gt;) est renvoy√©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;lead(colonne_1,n,&#39;text&#39;)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur issue de la fen√™tre pour la colonne indiqu√©e situ√©e n lignes (defaut = &lt;code&gt;1&lt;/code&gt;) apr√®s la ligne √©valu√©e. &lt;br&gt;Si aucune valeur n&amp;rsquo;existe, &amp;lsquo;text&amp;rsquo; (d√©faut = &lt;code&gt;NULL&lt;/code&gt;) est renvoy√©e.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Exemples&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Exemple basique&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Donn√©es d&amp;rsquo;exemple&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour r√©aliser nos exemples, nous allons utiliser les donn√©es suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;valeur&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;13&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;23&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;30&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;31&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;32&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;33&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la requ√™te qui permet de cr√©er une table contenant ces donn√©es, notez que les lignes sont dans le d√©sordre (pour mieux appr√©cier le fonctionnement des fen√™tres) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- DROP TABLE public.test_fenetrage;&#xA;&#xA;CREATE TABLE public.test_fenetrage AS &#xA;SELECT&#xA;&#x9;*&#xA;FROM (&#xA;&#x9;VALUES&#xA;&#x9;&#x9;(&#39;C-3&#39;, &#39;C&#39;, 2, 32),&#xA;&#x9;&#x9;(&#39;A-1&#39;, &#39;A&#39;, 1, 10),&#xA;&#x9;&#x9;(&#39;C-1&#39;, &#39;C&#39;, 4, 30),&#xA;&#x9;&#x9;(&#39;B-4&#39;, &#39;B&#39;, 3, 23),&#xA;&#x9;&#x9;(&#39;B-3&#39;, &#39;B&#39;, 2, 22),&#xA;&#x9;&#x9;(&#39;A-2&#39;, &#39;A&#39;, 2, 11),&#xA;&#x9;&#x9;(&#39;C-4&#39;, &#39;C&#39;, 1, 33),&#xA;&#x9;&#x9;(&#39;B-1&#39;, &#39;B&#39;, 1, 20),&#xA;&#x9;&#x9;(&#39;C-2&#39;, &#39;C&#39;, 3, 31),&#xA;&#x9;&#x9;(&#39;A-3&#39;, &#39;A&#39;, 3, 12),&#xA;&#x9;&#x9;(&#39;A-4&#39;, &#39;A&#39;, 4, 13),&#xA;&#x9;&#x9;(&#39;B-2&#39;, &#39;B&#39;, 2, 21)&#xA;) as t1 (identifiant, groupe, ordre, valeur)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Fen√™tre par d√©faut&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un premier test avec la fen√™tre par d√©faut :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le r√©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons le num√©ro de ligne (&lt;code&gt;row_number&lt;/code&gt;) qui correspond au num√©ro d&amp;rsquo;ordre des lignes dans la fen√™tre. Cette derni√®re n&amp;rsquo;ayant pas de clause &lt;code&gt;ORDER BY&lt;/code&gt;, il s&amp;rsquo;agit du num√©ro d&amp;rsquo;ordre dans la table (dans le stockage physique).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous pouvons voir que toutes les lignes poss√®dent le m√™me rang (&lt;code&gt;rank&lt;/code&gt;) car nous n&amp;rsquo;avons pas utilis√© la clause &lt;code&gt;ORDER BY&lt;/code&gt; dans la fen√™tre. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons √©galement une information sur les valeurs imm√©diatement pr√©c√©dentes (&lt;code&gt;lag&lt;/code&gt;) et suivantes (&lt;code&gt;lead&lt;/code&gt;) de chaque ligne ainsi que la premi√®re (&lt;code&gt;first_value&lt;/code&gt;) et la derni√®re (&lt;code&gt;last_value&lt;/code&gt;) valeur de la partition (et donc de la table).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons utiliser la m√™me fen√™tre mais avec une clause &lt;code&gt;ORDER BY&lt;/code&gt; au niveau de la requ√™te :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;ORDER BY&#xA;&#x9;identifiant&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devriez avoir les r√©sultats suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons exactement les m√™mes donn√©es que pr√©c√©demment mais l&amp;rsquo;ordre des lignes n&amp;rsquo;est pas le m√™me. Ceci d√©montre que le fen√™trage permet de calculer des donn√©es sur des ensembles bien sp√©cifiques avec un ordre bien sp√©cifique.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Fonctionnement du CURRENT ROW&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Testez la requ√™te suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER fenetre_range,&#xA;&#x9;rank() OVER fenetre_range,&#xA;&#x9;first_value(identifiant) OVER fenetre_range as first_value_range,&#xA;&#x9;last_value(identifiant) OVER fenetre_range as last_value_range,&#xA;&#x9;first_value(identifiant) OVER fenetre_row as first_value_row,&#xA;&#x9;last_value(identifiant) OVER fenetre_row as last_value_row&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;fenetre_range AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;),&#xA;&#x9;fenetre_row AS (&#xA;&#x9;&#x9;ROWS&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Elle renvoie ces r√©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value_range&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value_range&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value_row&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value_row&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voyez la diff√©rence entre les modes &lt;code&gt;RANGE&lt;/code&gt; (ou &lt;code&gt;GROUPS&lt;/code&gt;) et &lt;code&gt;ROWS&lt;/code&gt;. Avec les deux premiers modes, &lt;code&gt;CURRENT ROW&lt;/code&gt; inclut toutes les lignes de m√™me rang que la ligne courante. La premi√®re ligne correspond alors √† la premi√®re ligne de m√™me rang que la ligne courante remont√©e par la requ√™te. C&amp;rsquo;est la m√™me chose pour la derni√®re ligne.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme il n&amp;rsquo;y a pas de sous ordre d√©finit au sein d&amp;rsquo;un m√™me rang, c&amp;rsquo;est l&amp;rsquo;ordre de stockage des lignes qui est utilis√©. Ainsi, la premi√®re ligne d&amp;rsquo;un rang donn√© correspond √† la premi√®re ligne de ce rang rencontr√© lors du parcours de la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Fen√™tre partitionn√©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisons maintenant les partitions avec &lt;code&gt;PARTITION BY&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;groupe,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;PARTITION BY&#xA;&#x9;&#x9;&#x9;groupe&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le r√©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/th&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les calculs sont maintenant effectu√©s ¬´¬†par partition¬†¬ª.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est int√©ressant de constater que les lignes ont √©t√© r√©ordonn√©es, c&amp;rsquo;est √† cause du &lt;code&gt;PARTITION BY&lt;/code&gt; qui implique une r√©organisation des lignes lors du calcul. Notez cependant que les lignes conservent leur positionnement d&amp;rsquo;origine au sein de chaque partition (A-4 est avant A-2 qui est avant A-1 qui est avant A-3 comme dans la table d&amp;rsquo;origine).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Fen√™tre ordonnanc√©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Rempla√ßons les partitions par &lt;code&gt;ORDER BY&lt;/code&gt; afin d‚Äôordonnancer nos valeurs :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;ordre,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;dense_rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;ordre ASC&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donn√©es suivantes sont renvoy√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dense_rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La partition s&amp;rsquo;√©tend maintenant √† toute la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est int√©ressant de constater que les lignes ont ici aussi √©t√© r√©ordonn√©es, c&amp;rsquo;est √† cause du &lt;code&gt;ORDER BY&lt;/code&gt; qui implique une r√©organisation des lignes lors du calcul.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Int√©ressons nous aux colonnes &lt;code&gt;row_number&lt;/code&gt;, &lt;code&gt;rank&lt;/code&gt; et &lt;code&gt;dense_rank&lt;/code&gt;. Nous pouvons maintenant voir la diff√©rence entre ces fonctions :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;row_number&lt;/code&gt; indique le num√©ro de ligne apr√®s le r√©ordonnancement effectu√© par la fen√™tre. &lt;br&gt;A-1, B-1 et C-4 poss√®de le num√©ro d&amp;rsquo;ordre 1, il est donc logique de les retrouver en 1&lt;sup&gt;√®re&lt;/sup&gt;, 2&lt;sup&gt;√®me&lt;/sup&gt; et 3&lt;sup&gt;√®me&lt;/sup&gt; place.&lt;br&gt;Notez que C-4 est avant A-1 qui est avant B-1 ce qui correspond √† leurs positionnements dans la table d&amp;rsquo;origine.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;rank&lt;/code&gt; permet de d√©finir le rang de chaque ligne. &lt;br&gt;A-1, B-1 et C-4 poss√®de le num√©ro d&amp;rsquo;ordre 1, il poss√®dent donc tous les trois le rang 1. A-2, B-2, B-3 et C-3 poss√®de la valeur d&amp;rsquo;ordre 2, il sont donc au rang suivant : 4. &lt;br&gt;Le num√©ro de rang correspond au premier num√©ro de ligne (&lt;code&gt;row_number&lt;/code&gt;) du groupe de lignes √©quivalentes.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;dense_rank&lt;/code&gt; permet de d√©finir le rang de chaque ligne mais sans trous.&lt;br&gt;A-1, B-1 et C-4 sont au rang 1 puis A-2, B-2, B-3 et C-3 sont au rang 2.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Fen√™tre partitionn√©e et ordonnanc√©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Combinons le &lt;code&gt;PARTITION BY&lt;/code&gt; avec le &lt;code&gt;ORDER BY&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;groupe,&#xA;&#x9;ordre,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;dense_rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;PARTITION BY&#xA;&#x9;&#x9;&#x9;groupe&#xA;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;ordre ASC&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le r√©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dense_rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons maintenant des donn√©es calcul√©es pour chaque partition en utilisant un ordre d&amp;rsquo;affichage sp√©cifique.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Statistiques sur mon dernier voyage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons maintenant voir un cas l√©g√®rement plus concret. Il s&amp;rsquo;agit d&amp;rsquo;un petit tour que j&amp;rsquo;ai fait en Europe et dont j&amp;rsquo;aimerais calculer quelques statistiques.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-bleu-dodger-color has-text-color has-link-color wp-elements-3c6d8cfd14dcc1cdeb3ec9c6ac006d7c&#34;&gt;Notez que vous aurez besoin de PostGIS pour cet exemple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les donn√©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- DROP TABLE public.voyage_fenetrage;&#xA;&#xA;CREATE TABLE public.voyage_fenetrage AS &#xA;SELECT&#xA;  *&#xA;FROM (&#xA;  VALUES&#xA;    (&#39;2023-07-01&#39;::date, &#39;Maison&#39;, &#39;Maison&#39;, &#39;SRID=4326;POINT(6.3183 46.19)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-01&#39;::date, &#39;Suisse&#39;, &#39;Gen√®ve&#39;, &#39;SRID=4326;POINT(6.14 46.20)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-03&#39;::date, &#39;Suisse&#39;, &#39;Berne&#39;, &#39;SRID=4326;POINT(7.44 46.95)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-07&#39;::date, &#39;Suisse&#39;, &#39;Zurich&#39;, &#39;SRID=4326;POINT(8.54 47.37)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-10&#39;::date, &#39;Autriche&#39;, &#39;Innsbruck&#39;, &#39;SRID=4326;POINT(11.39 47.26)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-12&#39;::date, &#39;Allemagne&#39;, &#39;Munich&#39;, &#39;SRID=4326;POINT(11.58 48.14)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-17&#39;::date, &#39;Allemagne&#39;, &#39;Francfort&#39;, &#39;SRID=4326;POINT(8.68 50.11)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-21&#39;::date, &#39;Allemagne&#39;, &#39;Berlin&#39;, &#39;SRID=4326;POINT(13.41 52.52)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-25&#39;::date, &#39;Allemagne&#39;, &#39;Hambourg&#39;, &#39;SRID=4326;POINT(9.99 53.55)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-29&#39;::date, &#39;Danemark&#39;, &#39;Copenhague&#39;, &#39;SRID=4326;POINT(12.58 55.68)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-01&#39;::date, &#39;Royaume-Uni&#39;, &#39;√âdimbourg&#39;, &#39;SRID=4326;POINT(-3.20 55.95)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-05&#39;::date, &#39;Royaume-Uni&#39;, &#39;Glasgow&#39;, &#39;SRID=4326;POINT(-4.25 55.86)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-09&#39;::date, &#39;Royaume-Uni&#39;, &#39;Manchester&#39;, &#39;SRID=4326;POINT(-2.24 53.48)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-13&#39;::date, &#39;Royaume-Uni&#39;, &#39;Londres&#39;, &#39;SRID=4326;POINT(0 51.51)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-16&#39;::date, &#39;France&#39;, &#39;Paris&#39;, &#39;SRID=4326;POINT(2.35 48.85)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-20&#39;::date, &#39;France&#39;, &#39;Nantes&#39;, &#39;SRID=4326;POINT(-1.55 47.21)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-22&#39;::date, &#39;France&#39;, &#39;Toulouse&#39;, &#39;SRID=4326;POINT(1.44 43.60)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-25&#39;::date, &#39;France&#39;, &#39;Marseille&#39;, &#39;SRID=4326;POINT(5.37 43.29)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-28&#39;::date, &#39;France&#39;, &#39;Annecy&#39;, &#39;SRID=4326;POINT(6.13 45.90)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-31&#39;::date, &#39;Maison&#39;, &#39;Maison&#39;, &#39;SRID=4326;POINT(6.3183 46.19)&#39;::geometry(point, 4326))&#xA;) as t1 (date_arrive, pays, ville, geom)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je consid√®re que la date d&amp;rsquo;arriv√©e quelque part correspond √† la date d&amp;rsquo;arriv√©e √† l&amp;rsquo;√©tape suivante.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le but est d&amp;rsquo;avoir des informations tout au long du trajet : distance parcourue, pourcentage d&amp;rsquo;avancement, avancement par pays&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons utiliser plusieurs fen√™tres en parall√®le afin de calculer ce dont nous avons besoin.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;  -- Localisation √©tape&#xA;  concat(ville, &#39; (&#39;, pays, &#39;)&#39;) AS etape,&#xA;  -- Date d&#39;arriv√©e&#xA;  date_arrive,&#xA;  -- Date de d√©part : date d&#39;arriv√©e de la ligne suivante&#xA;  lead(date_arrive, 1) OVER toutes_lignes AS date_depart,&#xA;  -- Dur√©e de l&#39;√©tape&#xA;  lead(date_arrive, 1) OVER toutes_lignes - date_arrive AS duree_etape,&#xA;  -- Dur√©e totale du voyage trajet depuis la premi√®re localisation&#xA;  -- Fonction first_value permettant de r√©cup√©rer la premi√®re ligne de la fen√™tre&#xA;  date_arrive - first_value(date_arrive) OVER toutes_lignes AS duree_voyage,&#xA;  -- Distance parcourue depuis la localisation pr√©c√©dente&#xA;  -- Fonction lag permettant de r√©cup√©rer la ligne pr√©c√©dente&#xA;  -- ST_DistanceSpheroid pour obtenir la distance entre deux coordonn√©es en WGS84&#xA;  ST_DistanceSpheroid(&#xA;    geom, &#xA;    lag(geom, 1) OVER toutes_lignes,&#xA;    &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;  )::integer/1000 AS distance_depuis_loc_precedente,&#xA;  -- Distance totale parcourue depuis la premi√®re localisation&#xA;  -- Fonction ST_MakeLine permettant de cr√©er une ligne constitu√©e de l&#39;ensemble des points de la fen√™tre&#xA;  -- L&#39;ordre des point est assur√© par la fen√™tre&#xA;  -- ST_DistanceSpheroid pour obtenir la longueur d&#39;une ligne en WGS84&#xA;  ST_LengthSpheroid(&#xA;    ST_MakeLine(geom) OVER lignes_precedentes,&#xA;    &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;  )::integer/1000 AS distance_parcourue,&#xA;  -- Calcul d&#39;un pourcentage de parcours en comparant les valeurs issues de calculs sur deux fen√™tres diff√©rentes&#xA;  round(&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER lignes_precedentes,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric /&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER toutes_lignes,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric *&#xA;    100,&#xA;    2&#xA;  ) AS pourcentage_trajet,&#xA;  -- Calcul d&#39;un pourcentage de parcours par pays en comparant les valeurs issues de calculs sur deux fen√™tres diff√©rentes&#xA;  -- La fonction nullif permet d&#39;√©liminer les divisions par 0&#xA;  round(&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER lignes_precedentes_pays,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric /&#xA;    nullif(ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER toutes_lignes_pays,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric,0) *&#xA;    100,&#xA;    2&#xA;  ) AS pourcentage_trajet_pays&#xA;FROM &#xA;  public.voyage_fenetrage&#xA;WINDOW&#xA;  toutes_lignes AS (&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        UNBOUNDED FOLLOWING&#xA;  ),&#xA;  lignes_precedentes AS (&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        CURRENT ROW&#xA;  ),&#xA;  toutes_lignes_pays AS (&#xA;    PARTITION BY &#xA;      pays&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        UNBOUNDED FOLLOWING&#xA;  ),&#xA;  lignes_precedentes_pays AS (&#xA;    PARTITION BY &#xA;      pays&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        CURRENT ROW&#xA;  )&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le r√©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;etape&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;date_arrive&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;date_depart&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;duree_etape&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;duree_voyage&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;distance_depuis_loc_precedente&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;distance_parcourue&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pourcentage_trajet&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pourcentage_trajet_pays&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Maison (Maison)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Gen√®ve (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-03&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0,28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Berne (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-03&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-07&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;129&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;144&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,76&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;57,61&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Zurich (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-07&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;95&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;240&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Innsbruck (Autriche)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;215&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;456&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8,69&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Munich (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;98&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;554&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10,58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Francfort (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-21&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;304&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;859&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16,38&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;30,89&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Berlin (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-21&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;424&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1‚ÄØ284&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24,48&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;73,99&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Hambourg (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-29&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;256&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1‚ÄØ540&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;29,37&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Copenhague (Danemark)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-29&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;290&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1‚ÄØ830&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;34,9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;√âdimbourg (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;987&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2‚ÄØ818&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;53,72&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Glasgow (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;35&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;66&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2‚ÄØ884&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;54,99&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10,58&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Manchester (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;39&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;294&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3‚ÄØ179&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;60,61&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;57,53&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Londres (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;43&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;266&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3‚ÄØ446&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;65,7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Paris (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;46&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;340&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3‚ÄØ786&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;72,18&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Nantes (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-22&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;50&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;343&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4‚ÄØ130&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;78,72&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24,11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Toulouse (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-22&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;52&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;464&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4‚ÄØ594&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;87,57&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;56,72&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Marseille (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;55&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;319&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4‚ÄØ914&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;93,67&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;79,19&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Annecy (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;296&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5‚ÄØ210&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;99,32&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Maison (Maison)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;61&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;35&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5‚ÄØ246&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous voyez qu&amp;rsquo;avec le fen√™trage il devient simple de r√©aliser tout un tas de calculs divers et vari√©s sur vos donn√©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un excellent exemple est √©galement fournit dans l&amp;rsquo;article suivant o√π je me sers du fen√™trage pour d√©terminer le parcours du P√®re No√´l dans la nuit du 24 au 25.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-embed aligncenter is-type-wp-embed is-provider-bazinga-039-s wp-block-embed-bazinga-039-s&#34;&gt;&lt;div class=&#34;wp-block-embed__wrapper&#34;&gt;&#xA;&lt;blockquote class=&#34;wp-embedded-content&#34; data-secret=&#34;1XkVFCGu98&#34;&gt;&lt;a href=&#34;https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis&#34;&gt;Suivons le P√®re No√´l avec PostGIS (Nouvelle version)&lt;/a&gt;&lt;/blockquote&gt;&lt;iframe loading=&#34;lazy&#34; class=&#34;wp-embedded-content&#34; sandbox=&#34;allow-scripts&#34; security=&#34;restricted&#34;  title=&#34;¬´¬†Suivons le P√®re No√´l avec PostGIS (Nouvelle version)¬†¬ª &amp;#8212; BazinGa&amp;#039;s&#34; src=&#34;https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis/embed#?secret=31T1XinWsi#?secret=1XkVFCGu98&#34; data-secret=&#34;1XkVFCGu98&#34; width=&#34;600&#34; height=&#34;338&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34;&gt;&lt;/iframe&gt;&#xA;&lt;/div&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cet article fait parti du cours sur PostgreSQL, parties 3 et 4 du Vade-mecum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-vertical is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-9a7cdcfd wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/sql/postgresql-tout-comprendre-1&#34;&gt;Cours sur PostgreSQL&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/sql/postgresql-vade-mecum-3#le_fenetrage&#34;&gt;Vade-mecum &amp;#8211; 3 &amp;#8211; G√©rer la donn√©e&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-4#fonction_de_fenetrage&#34;&gt;Vade-mecum &amp;#8211; 4 &amp;#8211; Fonctions et op√©rateurs&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/ouvrez-les-fenetres-de-postgresql-guide-complet-sur-le-fenetrage" rel="alternate"></link>
    <summary type="html">Voici un guide complet sur l&#39;utilisation du fen√™trage sous PostgreSQL. Ces fonctionnalit√©s sont particuli√®rement pratique lors de l&#39;analyse de donn√©es continues.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Supervision des instances PostgreSQL avec pglift</title>
    <updated>2025-12-04T06:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-12-04://2025/12/04/supervision_pglift.html</id>
    <link href="https://blog.dalibo.com//2025/12/04/supervision_pglift.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Vaur√©al, le 4 d√©cembre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cet article est dans la continuit√© de la s√©rie sur l‚Äôindustrialisation de PostgreSQL.&#xA;Nous allons voir dans celui-ci comment mettre en place la supervision de nos instances&#xA;PostgreSQL √† l‚Äôaide de &lt;strong&gt;pglift&lt;/strong&gt;, en int√©grant &lt;strong&gt;Prometheus&lt;/strong&gt;, &lt;strong&gt;Grafana&lt;/strong&gt; et &#xA;&lt;strong&gt;Alertmanager&lt;/strong&gt; pour un monitoring complet et efficace.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h1 id=&#34;pourquoi-superviser-postgresql-&#34;&gt;Pourquoi superviser PostgreSQL ?&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;La supervision des instances PostgreSQL est essentielle pour assurer leur performance,&#xA;leur disponibilit√© et leur fiabilit√© dans un environnement de production. Elle permet&#xA;de d√©tecter les anomalies, les goulots d‚Äô√©tranglement et les d√©faillances avant qu‚Äôelles&#xA;n‚Äôimpactent les applications qui en d√©pendent.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec &lt;strong&gt;pglift&lt;/strong&gt;, la supervision est int√©gr√©e directement dans le processus de d√©ploiement&#xA;des instances, facilitant ainsi l‚Äôadoption de bonnes pratiques d√®s la cr√©ation de&#xA;l‚Äôenvironnement.&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;int√©gration-de-la-supervision-dans-pglift&#34;&gt;Int√©gration de la supervision dans pglift&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Lors du d√©ploiement d‚Äôune instance avec &lt;strong&gt;pglift&lt;/strong&gt;, il est possible de cr√©er un r√¥le d√©di√©&#xA;√† la supervision, membre du r√¥le syst√®me &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_monitor&lt;/code&gt;, qui permet d‚Äôacc√©der aux vues&#xA;et fonctions de monitoring de PostgreSQL sans droits excessifs. De plus, &lt;strong&gt;pglift&lt;/strong&gt; d√©ploie&#xA;automatiquement une configuration pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres_exporter&lt;/code&gt;, un exporter Prometheus&#xA;qui collecte les m√©triques de l‚Äôinstance et les expose sur un port d√©di√©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple de configuration &lt;strong&gt;pglift&lt;/strong&gt; incluant la section &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;prometheus&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;postgresql:&#xA;  replrole: &#39;replication&#39;&#xA;  auth:&#xA;  host: scram-sha-256&#xA;  backuprole:&#xA;  name: backup&#xA;  pgpass: true&#xA;pgbackrest:&#xA;  configpath: &#39;/etc/pgbackrest&#39;&#xA;  repository:&#xA;      path: /var/lib/pgsql/backups&#xA;      mode: path&#xA;systemd: {}&#xA;prometheus:&#xA;  execpath: /usr/bin/postgres_exporter&#xA;  configpath: /etc/prometheus/postgres_exporter-{name}.conf&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette configuration indique le chemin vers l‚Äôex√©cutable de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres_exporter&lt;/code&gt; &#xA;ainsi que le chemin pour les fichiers de configuration, qui seront g√©n√©r√©s automatiquement&#xA;par &lt;strong&gt;pglift&lt;/strong&gt; pour chaque instance.&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;d√©ploiement-avec-ansible&#34;&gt;D√©ploiement avec Ansible&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Pour d√©ployer une instance avec supervision activ√©e, voici un exemple de playbook&#xA;Ansible utilisant le module &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift.instance&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;- name: Create Instances&#xA;  hosts: srv-pg1&#xA;  become_user: postgres&#xA;  become: true&#xA;  tasks:&#xA;      - name: Managing instances&#xA;      dalibo.pglift.instance:&#xA;          name: main&#xA;          state: started&#xA;          version: 17&#xA;          port: 5432&#xA;          surole_password: &#34;Passw0rd&#34;&#xA;          replrole_password: &#34;Passw0rd&#34;&#xA;          pgbackrest:&#xA;            password: &#34;Passw0rd&#34;&#xA;            stanza: main-stz&#xA;          settings:&#xA;            listen_addresses: &#39;*&#39;&#xA;          prometheus:&#xA;            password: &#34;Passw0rd&#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Dans ce playbook, la section &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;prometheus&lt;/code&gt; permet de d√©finir le mot de passe pour le&#xA;r√¥le de supervision. pglift cr√©era alors automatiquement le r√¥le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;prometheus&lt;/code&gt; (membre&#xA;de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_monitor&lt;/code&gt;) et configurera &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres_exporter&lt;/code&gt; pour qu‚Äôil se lance au d√©marrage&#xA;de l‚Äôinstance, exposant les m√©triques sur le port 9187 par d√©faut.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois l‚Äôinstance d√©ploy√©e par &lt;strong&gt;pglift&lt;/strong&gt;, il est possible de voir le statut de&#xA;l‚Äôexporter ainsi :&lt;/p&gt;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;$ pglift instance status &#xA;PostgreSQL: running&#xA;prometheus: running&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La ligne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;prometheus: running&lt;/code&gt; indique que l‚Äôexporter est en cours d‚Äôex√©cution.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La commande suivante permet d‚Äôafficher les m√©triques PostgreSQL expos√©es par l‚Äôexporter&#xA;postgres-exporter, afin de les consulter directement au sein du terminal :&lt;/p&gt;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;$ curl http://localhost:9187/metrics&#xA;[...]&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;accessexclusivelock&#34;} 0&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;accesssharelock&#34;} 1&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;exclusivelock&#34;} 0&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;rowexclusivelock&#34;} 0&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;rowsharelock&#34;} 0&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;sharelock&#34;} 0&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;sharerowexclusivelock&#34;} 0&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;shareupdateexclusivelock&#34;} 0&#xA;pg_locks_count{datname=&#34;postgres&#34;,mode=&#34;sireadlock&#34;} 0&#xA;# HELP pg_scrape_collector_duration_seconds postgres_exporter: Duration of a collector scrape.&#xA;# HELP pg_scrape_collector_success postgres_exporter: Whether a collector succeeded.&#xA;pg_settings_allow_alter_system{server=&#34;/run/user/1001/pglift/postgresql:5432&#34;} 1&#xA;pg_settings_allow_in_place_tablespaces{server=&#34;/run/user/1001/pglift/postgresql:5432&#34;} 0&#xA;pg_settings_allow_system_table_mods{server=&#34;/run/user/1001/pglift/postgresql:5432&#34;} 0&#xA;pg_settings_archive_timeout_seconds{server=&#34;/run/user/1001/pglift/postgresql:5432&#34;} 0&#xA;[...]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h1 id=&#34;configuration-de-prometheus&#34;&gt;Configuration de Prometheus&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Une fois l‚Äôinstance d√©ploy√©e, il faut configurer Prometheus pour scraper les m√©triques&#xA;expos√©es par &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres_exporter&lt;/code&gt;. Voici une configuration minimale &#xA;(dans &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/etc/prometheus/prometheus.yml&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;global:&#xA;  scrape_interval: 15s &#xA;  evaluation_interval: 15s&#xA;rule_files:&#xA;  - &#39;rules.d/*.yml&#39;&#xA;scrape_configs:&#xA;  - job_name: &#34;postgresql&#34;&#xA;    static_configs:&#xA;      - targets: &#xA;        - &#34;srv-pg1:9187&#34;&#xA;        - &#34;srv-pg2:9187&#34;  &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette configuration d√©finit un intervalle de scraping de 15 secondes, inclut les fichiers&#xA;de r√®gles d‚Äôalerte, et liste les cibles (instances PostgreSQL) √† surveiller. Prometheus&#xA;collectera alors automatiquement les m√©triques telles que l‚Äôutilisation du CPU, de la&#xA;m√©moire, le nombre de connexions, etc.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La section &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;scrape_configs&lt;/code&gt; d√©finit les jobs de scraping. Ici, le job nomm√© ‚Äúpostgresql‚Äù&#xA;configure Prometheus pour scraper les m√©triques expos√©es par &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres_exporter&lt;/code&gt; sur&#xA;le port 9187 des h√¥tes srv-pg1 et srv-pg2.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;r√®gles-dalerte-prometheus&#34;&gt;R√®gles d‚Äôalerte Prometheus&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Pour compl√©ter la configuration de Prometheus, il est essentiel de d√©finir des r√®gles&#xA;d‚Äôalerte bas√©es sur les m√©triques collect√©es. Un ensemble de r√®gles pr√©d√©finies pour&#xA;PostgreSQL est disponible sur GitHub :&#xA;&lt;a href=&#34;https://raw.githubusercontent.com/samber/awesome-prometheus-alerts/refs/heads/master/dist/rules/postgresql/postgres-exporter.yml&#34;&gt;postgres_exporter Rules&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour notre cas, cet exemple peut √™tre plac√© dans le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/etc/prometheus/rules.d/postgresql-rules.yml&lt;/code&gt;.&#xA;Ces r√®gles couvrent des alertes courantes telles que la disponibilit√© de l‚Äôinstance,&#xA;l‚Äôutilisation des ressources, les erreurs de connexion, etc. Elles permettront √†&#xA;Prometheus de g√©n√©rer des alertes qui seront ensuite g√©r√©es par Alertmanager.&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;visualisation-avec-grafana&#34;&gt;Visualisation avec Grafana&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Pour visualiser les m√©triques collect√©es par Prometheus, Grafana est l‚Äôoutil de&#xA;r√©f√©rence. Il permet de cr√©er des tableaux de bord interactifs et personnalisables.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un tableau de bord PostgreSQL est disponible sur le site de Grafana :&#xA;&lt;a href=&#34;https://grafana.com/grafana/dashboards/9628-postgresql-database/&#34;&gt;Dashboard Grafana&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/20251124-pglift-grafana.png&#34; alt=&#34;Dashboard Grafana&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ce dashboard fournit une vue d‚Äôensemble des performances de l‚Äôinstance, incluant&#xA;des graphiques sur les requ√™tes actives, l‚Äôutilisation des ressources, les locks,&#xA;etc. Il suffit de l‚Äôimporter dans Grafana en connectant une source de donn√©es&#xA;Prometheus.&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;alertes-avec-alertmanager&#34;&gt;Alertes avec Alertmanager&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Enfin, pour compl√©ter la supervision, Alertmanager permet de g√©rer les alertes&#xA;g√©n√©r√©es par Prometheus. Il peut envoyer des notifications par email, Slack,&#xA;PagerDuty, etc., en cas de seuils d√©pass√©s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple de configuration Alertmanager pour les alertes PostgreSQL :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;global:&#xA;  smtp_smarthost: &#39;smtp.example.com:587&#39;&#xA;  smtp_from: &#39;alertmanager@example.com&#39;&#xA;&#xA;route:&#xA;  group_by: [&#39;alertname&#39;]&#xA;  group_wait: 10s&#xA;  group_interval: 10s&#xA;  repeat_interval: 1h&#xA;  receiver: &#39;email&#39;&#xA;&#xA;receivers:&#xA;- name: &#39;email&#39;&#xA;  email_configs:&#xA;  - to: &#39;monitoring@example.com&#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette configuration envoie des emails √† l‚Äôadresse ‚Äúmonitoring@example.com‚Äù en cas &#xA;d‚Äôalertes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour un premier d√©marrage d‚ÄôAlertmanager, lancez-le avec la commande suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;alertmanager &lt;span class=&#34;nt&#34;&gt;--config&lt;/span&gt;.file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;alertmanager.yml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;O√π &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;alertmanager.yml&lt;/code&gt; est le fichier de configuration pr√©sent√© ci-dessus. Alertmanager&#xA;sera alors accessible sur le port 9093 par d√©faut.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Enfin, configurez Prometheus pour qu‚Äôil envoie les alertes √† Alertmanager en ajoutant&#xA;dans sa configuration globale :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;alerting:&#xA;  alertmanagers:&#xA;    - static_configs:&#xA;        - targets:&#xA;          - localhost:9093&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/20251124-pglift-alertmanager.png&#34; alt=&#34;Alertmanager&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;ressources&#34;&gt;Ressources&lt;/h1&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://github.com/dalibo/prometheus-pkgs/releases&#34;&gt;Paquets Prometheus, exporters et alertmanager&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://samber.github.io/awesome-prometheus-alerts/&#34;&gt;Awesome Prometheus alerts&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;La supervision est un pilier de l‚Äôexploitation des bases de donn√©es PostgreSQL en&#xA;production. Gr√¢ce √† &lt;strong&gt;pglift&lt;/strong&gt;, l‚Äôint√©gration de Prometheus, Grafana et Alertmanager&#xA;est simplifi√©e, permettant un d√©ploiement rapide et homog√®ne des outils de monitoring.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Patroni aux commandes</title>
    <updated>2025-11-04T06:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-11-04://2025/11/04/pglift-patroni-aux-commandes.html</id>
    <link href="https://blog.dalibo.com//2025/11/04/pglift-patroni-aux-commandes.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Vall√©e de Munster, 04 novembre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La haute disponibilit√© dans nos m√©tiers de l‚ÄôIT est un vaste sujet.&#xA;PostgreSQL √©tant au c≈ìur de nombreux Syst√®mes d‚ÄôInformation, il est&#xA;souvent source de nombreuses questions pour construire des architectures&#xA;robustes, redondantes et hautement disponibles.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cet article propose une br√®ve pr√©sentation de Patroni : son r√¥le, les&#xA;composants essentiels pour l‚Äôutiliser, ainsi que quelques bonnes&#xA;pratiques. Nous aborderons √©galement l‚Äôusage de notre socle technique&#xA;d‚Äôindustrialisation pour exploiter Patroni.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h2 id=&#34;patroni-de-quoi-parlons-nous-&#34;&gt;Patroni, de quoi parlons-nous ?&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Patroni est une solution de ¬´¬†template¬†¬ª pour g√©rer une ou des grappes&#xA;(&lt;strong&gt;Clusters&lt;/strong&gt;) d‚Äôinstances PostgreSQL. En fonction de la configuration&#xA;retenue, Patroni permet d‚Äôassurer la haute disponibilit√© d‚Äôun service&#xA;PostgreSQL, de maintenir l‚Äôagr√©gat en condition op√©rationnelle, de le&#xA;superviser et provoquer une bascule automatique en cas d‚Äôincident.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;composants&#34;&gt;Composants&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nous retrouvons dans le sch√©ma suivant l‚Äôensemble des composants minimum&#xA;requis pour mettre en place une grappe de serveurs PostgreSQL avec&#xA;Patroni.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/patroni_archi.png&#34; alt=&#34;architecture Patroni&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Patroni est un service √©crit en Python qui va piloter le cycle de vie&#xA;des instances PostgreSQL en se basant sur un syst√®me distribu√© (cf.&#xA;DCS ci-dessous)&lt;/li&gt;&#xA;  &lt;li&gt;un &lt;strong&gt;DCS&lt;/strong&gt; (Distributed Consensus Store ou parfois appel√© Distributed&#xA;Configuration Store), ce composant permet de partager l‚Äô√©tat des&#xA;n≈ìuds, leur configuration au sein du &lt;strong&gt;cluster&lt;/strong&gt; et de garantir&#xA;l‚Äôunicit√© du r√¥le &lt;strong&gt;leader&lt;/strong&gt;. C‚Äôest la source de v√©rit√© principale&#xA;d‚Äôun cluster Patroni. La litt√©rature et nos observations montrent&#xA;qu‚Äô&lt;a href=&#34;https://etcd.io/&#34;&gt;etcd&lt;/a&gt; est souvent adopt√© pour assurer ce r√¥le.&lt;/li&gt;&#xA;  &lt;li&gt;PostgreSQL ! Dans l‚Äôarchitecture que nous pr√©sentons, PostgreSQL&#xA;(notre SGBD de c≈ìur ‚ù§Ô∏è ) est pilot√© par Patroni. Ce dernier utilise&#xA;des fonctionnalit√©s natives de PostgreSQL (Exemple¬†: la r√©plication&#xA;physique de PostgreSQL).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;En compl√©ment de ces composants, on peut retrouver, entre autres, les&#xA;√©l√©ments optionnels¬†suivants¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Une solution de sauvegarde au fil de l‚Äôeau de type &lt;strong&gt;PITR&lt;/strong&gt; (par&#xA;exemple &lt;a href=&#34;https://pgbackrest.org/&#34;&gt;pgBackrest&lt;/a&gt;,&#xA;&lt;a href=&#34;https://pgbarman.org/&#34;&gt;Barman&lt;/a&gt;,‚Ä¶)&lt;/li&gt;&#xA;  &lt;li&gt;Un aiguilleur de connexions (par exemple&#xA;&lt;a href=&#34;https://www.haproxy.org/&#34;&gt;HAProxy&lt;/a&gt;)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h2 id=&#34;configuration-de-notre-sgbd-favori---statique-vs-dynamique&#34;&gt;Configuration de notre SGBD favori - statique vs dynamique&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Dans l‚Äôarchitecture que nous pr√©sentons, Patroni se charge de g√©rer le&#xA;cycle de vie des instances PostgreSQL. Il va initier et configurer les&#xA;instances PostgreSQL sur la base de sa configuration et de l‚Äô√©tat du&#xA;&lt;strong&gt;cluster&lt;/strong&gt;. Les utilisateur¬∑ices ont plusieurs choix possibles pour&#xA;configurer PostgreSQL :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;En utilisant une configuration dite statique de Patroni (qui&#xA;s‚Äôapplique √† un seul n≈ìud) :&lt;/p&gt;&#xA;&#xA;    &lt;ul&gt;&#xA;      &lt;li&gt;Via le fichier de configuration (YAML) de Patroni, en √©ditant la&#xA;&lt;a href=&#34;https://patroni.readthedocs.io/en/latest/yaml_configuration.html#postgresql&#34;&gt;section&#xA;postgresql&lt;/a&gt;&#xA;dudit fichier&lt;/li&gt;&#xA;      &lt;li&gt;En d√©finissant des variables d‚Äôenvironnement au d√©marrage de Patroni&#xA;(entre autres les variables&#xA;&lt;a href=&#34;https://patroni.readthedocs.io/en/latest/ENVIRONMENT.html#postgresql&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PATRONI_POSTGRESQL_*&lt;/code&gt;&lt;/a&gt;&#xA;pour alt√©rer la configuration de PostgreSQL)&lt;/li&gt;&#xA;    &lt;/ul&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;En utilisant la configuration dite dynamique de Patroni. Cette&#xA;configuration s‚Äôapplique √† l‚Äôensemble des instances de notre&#xA;&lt;strong&gt;Cluster&lt;/strong&gt; et est stock√©e dans le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DCS&lt;/code&gt;. Elle est modifiable via la&#xA;commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;patronictl edit-config&lt;/code&gt; et consultable avec&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;patronictl show-config&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;La configuration suivante, s‚Äôapplique √† l‚Äôensemble des instances&#xA;PostgreSQL de notre grappe¬†:&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;patronictl show-config&#xA;&lt;span class=&#34;go&#34;&gt;loop_wait: 10&#xA;postgresql:&#xA;  parameters:&#xA;    max_connections: 50&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;&#xA;    &lt;p&gt;et est appliqu√©e par Patroni √† l‚Äôensemble des instances PostgreSQL¬†:&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;psql&#xA;&lt;span class=&#34;go&#34;&gt;psql (17.2 (Debian 17.2-1.pgdg120+1))&#xA;Type &#34;help&#34; for help.&#xA;&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;[17/pg1] postgres@~=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;show max_connections&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt; max_connections&#xA;-----------------&#xA; 50&#xA;(1 row)&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h3 id=&#34;pi√®ges-classiques&#34;&gt;Pi√®ges classiques&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Attention, &lt;a href=&#34;https://patroni.readthedocs.io/en/latest/patroni_configuration.html#postgresql-parameters-controlled-by-patroni&#34;&gt;Certaines options sont exclusivement param√©trables&#xA;dynamiquement (au niveau&#xA;DCS)&lt;/a&gt;,&#xA;c‚Äôest le cas, entre autre, de l‚Äôoption &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;max_connections&lt;/code&gt;. Pour les&#xA;autres param√®tres, lorsqu‚Äôon utilise les deux m√©thodes de configuration&#xA;(fichier et DCS), la majorit√© des options statiques pr√©valent.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple, si l‚Äôutilisateur‚ãÖice attribue 8 Go pour le param√®tre&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/17/runtime-config-resource.html#GUC-SHARED-BUFFERS&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt;&lt;/a&gt;&#xA;dans le fichier de configuration de Patroni et utilise une autre valeur&#xA;dans la configuration dynamique (&lt;strong&gt;DCS&lt;/strong&gt;), seule la configuration&#xA;statique (d√©finie dans le fichier) sera prise en compte et appliqu√©e&#xA;&lt;strong&gt;au n≈ìud&lt;/strong&gt; (et non √† l‚Äôensemble du Cluster).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple, nous montrons ici la modification d‚Äôun param√®tre dynamique&#xA;et sa non prise en compte par Patroni / PostgreSQL¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;On positionne la valeur de l‚Äôoption &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt; √† &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;8 GB&lt;/code&gt; dans le&#xA;fichier de configuration de Patroni¬†:&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PATRONICTL_CONFIG_FILE&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;}&lt;/span&gt; | yq &lt;span class=&#34;nt&#34;&gt;-r&lt;/span&gt; .postgresql.parameters.shared_buffers&#xA;&lt;span class=&#34;go&#34;&gt;8 GB&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;On modifie ensuite la valeur du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt; dans la configuration&#xA;dynamique¬†:&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;patronictl edit-config &lt;span class=&#34;nt&#34;&gt;--force&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;4 GB&#39;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;On relance notre ou nos instances PostgreSQL¬†:&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;patronictl restart pgdemo&#xA;&lt;span class=&#34;go&#34;&gt;When should the restart take place (e.g. 2025-01-23T10:18)  [now]:&#xA;Are you sure you want to restart members pg1? [y/N]: y&#xA;Restart if the PostgreSQL version is less than provided (e.g. 9.5.2)  []: 18.0&#xA;Success: restart on member pg1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Pour, au final, observer la non prise en compte de la configuration&#xA;dynamique¬†:&lt;/p&gt;&#xA;&#xA;    &lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;psql&#xA;&lt;span class=&#34;go&#34;&gt;psql (17.2 (Debian 17.2-1.pgdg120+1))&#xA;Type &#34;help&#34; for help.&#xA;&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;[17/pg1] postgres@~=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;show shared_buffers&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt; shared_buffers&#xA;----------------&#xA; 8GB&#xA;(1 row)&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Ce comportement bien que d√©crit dans la documentation, peut √™tre source&#xA;de confusion. Il peut conduire √† une forme de disparit√© non souhaitable&#xA;au sein d‚Äôun &lt;strong&gt;Cluster&lt;/strong&gt; d‚Äôinstances PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;et-notre-socle-dans-l√©quation-&#34;&gt;Et notre Socle dans l‚Äô√©quation ?!&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Notre solution d‚Äôindustrialisation, le &lt;a href=&#34;https://www.dalibo.com/socle&#34;&gt;Socle Postgres&#xA;Dalibo&lt;/a&gt;, et son composant central&#xA;&lt;a href=&#34;https://gitlab.com/dalibo/pglift&#34;&gt;pglift&lt;/a&gt;, depuis la &lt;a href=&#34;https://pglift.readthedocs.io/en/latest/news.html#v2-5-0-2025-10-09&#34;&gt;version&#xA;2.5&lt;/a&gt;,&#xA;offrent la possibilit√© de choisir entre une configuration statique ou&#xA;dynamique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par d√©faut, pglift utilise une configuration locale, mais les&#xA;utilisateur¬∑ices peuvent modifier ce comportement en utilisant la&#xA;configuration suivante¬†:&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;patroni&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;pi&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;]&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;configuration_mode&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dynamic&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dynamic&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces options permettent de choisir de g√©rer dynamiquement les entr√©es HBA&#xA;et la configuration de PostgreSQL. Concr√®tement¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;lors de la cr√©ation d‚Äôun &lt;strong&gt;Cluster&lt;/strong&gt;, celui-ci sera initialis√© avec&#xA;les entr√©es HBA et la configuration PostgreSQL stock√©es dans le DCS¬†;&lt;/li&gt;&#xA;  &lt;li&gt;toute modification d‚Äôun param√®tre (HBA ou configuration) mettra&#xA;automatiquement √† jour les informations correspondantes dans le DCS&#xA;(via l‚ÄôAPI de Patroni).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;√Ä titre d‚Äôexemple, nous cr√©ons ici une instance g√©r√©e par Patroni via&#xA;pglift¬†:&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;pglift instance create main1 &lt;span class=&#34;nt&#34;&gt;--port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;5974 &lt;span class=&#34;nt&#34;&gt;--patroni-cluster&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;pgdemo &lt;span class=&#34;nt&#34;&gt;--patroni-node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;main1&#xA;&lt;span class=&#34;go&#34;&gt;INFO     initializing PostgreSQL&#xA;INFO     setting up Patroni service&#xA;INFO     bootstrapping PostgreSQL with Patroni&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;INFO     configuring PostgreSQL&#xA;INFO     altering role &#39;replrole&#39;&#xA;INFO     creating instance dumps directory: /srv/data/17-main1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lors de l‚Äôinitialisation, Patroni est configur√© (par pglift) de mani√®re&#xA;√† garnir le DCS en utilisant les mod√®les de configuration fournis par&#xA;pglift¬†:&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main1 &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; patronictl show-config&#xA;&lt;span class=&#34;go&#34;&gt;loop_wait: 10&#xA;postgresql:&#xA;  parameters:&#xA;    effective_cache_size: 22 GB&#xA;    shared_buffers: 8 GB&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;    ...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;  pg_hba:&#xA;  - local all postgres trust&#xA;  - local all backup trust&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;  ...&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Les utilisateur¬∑rices peuvent ensuite modifier la configuration&#xA;dynamique soit via la commande pglift (Exemple :&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift pgconf -i main1 set max_connections=&#39;30&#39;&lt;/code&gt;), soit via Ansible :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Manage primary instance&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;localhost&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Create primary instance pg1&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dalibo.pglift.instance&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;main1&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;5974&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;started&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;settings&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;max_connections&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;patroni&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;pgdemo&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;main1&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;ansible-playbook /tmp/patroni.yml&#xA;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;TASK [Manage primary instance pg1] *************&#xA;changed: [localhost]&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Peu importe l‚Äôinterface utilis√©e, pglift va appeler l‚ÄôAPI de Patroni&#xA;pour modifier la configuration distribu√©e¬†:&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main1 &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; patronictl show-config |&lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;&lt;span class=&#34;go&#34;&gt;  yq -r .postgresql.parameters.max_connections&#xA;30&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;pglift, que ce soit via sa ligne de commande ou via Ansible, permet de&#xA;faire abstraction du type d‚Äôinstance. Ainsi, une instance g√©r√©e par&#xA;Patroni, malgr√© certaines sp√©cificit√©s, peut √™tre configur√©e de mani√®re&#xA;similaire √† une instance plus simple (par exemple, une instance&#xA;&lt;em&gt;standalone&lt;/em&gt;).&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;quelques-pratiques-et-recommandations&#34;&gt;Quelques pratiques et recommandations&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Patroni offre plusieurs choix pour stocker sa configuration, mais aussi&#xA;les param√®tres sp√©cifiques pour PostgreSQL. Les deux techniques ont du&#xA;sens et le choix entre configuration dynamique ou statique va d√©pendre&#xA;de plusieurs crit√®res.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici quelques questions pertinentes pour choisir l‚Äôune ou l‚Äôautre&#xA;option¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Ma configuration est-elle globale √† l‚Äôensemble des instances&#xA;PostgreSQL d‚Äôune grappe¬†?&lt;/li&gt;&#xA;  &lt;li&gt;Dois-je appliquer un ensemble de param√®tres √† un seul n≈ìud (ou un&#xA;groupe limit√© de n≈ìuds)¬†?&lt;/li&gt;&#xA;  &lt;li&gt;Est-il possible et facile de d√©ployer la configuration avec des outils&#xA;d‚Äôautomatisation (Exemple via un Playbook Ansible) ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Lors de l‚Äôutilisation de Patroni, nous recommandons de d√©finir et suivre&#xA;une strat√©gie adapt√©e et document√©e pour configurer Patroni et&#xA;PostgreSQL. Il nous semble int√©ressant et utile de¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;S‚Äôappuyer sur des outils de d√©ploiement et d‚Äôautomatisation pour&#xA;mettre en place et maintenir votre configuration (Ansible, Puppet,&#xA;cfengine,‚Ä¶).&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;Cette approche permet de maintenir en un seul endroit (Exemple¬†: un&#xA;entrep√¥t Git) l‚Äôensemble de votre configuration. Cela facilite&#xA;grandement la gestion de vos instances (modification, audit,‚Ä¶).&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;limiter au strict minimum l‚Äôutilisation simultan√©e d‚Äôune configuration&#xA;statique (fichier de configuration) et dynamique (DCS).&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;Notamment, lorsqu‚Äôon utilise un DCS comme source de configuration, il&#xA;nous semble id√©al d‚Äôy consigner les param√®tres communs √† toutes les&#xA;instances.&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h2 id=&#34;conclusions--ressources&#34;&gt;Conclusions &amp;amp; ressources&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Patroni est une solution de haute disponibilit√© largement reconnue et&#xA;utilis√©e depuis plusieurs ann√©es, qui a progressivement int√©gr√© de&#xA;nombreuses fonctionnalit√©s pour r√©pondre aux besoins des utilisateurs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En raison de la complexit√© et des enjeux de la haute disponibilit√©,&#xA;Dalibo a investi significativement dans la R&amp;amp;D autour de Patroni, gr√¢ce&#xA;aux contributions de ses DBA et d√©veloppeur¬∑euse¬∑s ainsi qu‚Äôaux retours&#xA;r√©currents de ses clients.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les divers chantiers concernant Patroni, nous ont permis entre autres de&#xA;produire¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Une &lt;a href=&#34;https://www.dalibo.com/formation-postgresql-haute-disponibilite&#34;&gt;formation sp√©cifique d√©di√©e √†&#xA;Patroni&lt;/a&gt;&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;Une &lt;a href=&#34;https://github.com/dalibo/check_patroni&#34;&gt;sonde pour nagios (et les √©quivalents&#xA;Nagios)&lt;/a&gt;&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;L‚Äôimpl√©mentation du support de Patroni dans &lt;a href=&#34;https://www.dalibo.com/socle&#34;&gt;notre solution&#xA;d‚Äôindustrialisation&lt;/a&gt;&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;!--&#xA;    vim: spelllang=fr spell&#xA;  --&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>S√©curiser Postgres avec le mode user de systemd</title>
    <updated>2025-10-20T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-10-20://2025/10/20/securiser-postgres-avec-le-mode-user-de-systemd.html</id>
    <link href="https://blog.dalibo.com//2025/10/20/securiser-postgres-avec-le-mode-user-de-systemd.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Eymoutiers, le 20 octobre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nouvel √©pisode de notre &lt;a href=&#34;https://blog.dalibo.com/2025/06/30/industrialisation_postgresql.html&#34;&gt;s√©rie d√©di√©e √† l‚Äôindustrialisation de PostgreSQL&lt;/a&gt; :&#xA;apr√®s le &lt;a href=&#34;https://blog.dalibo.com/2025/08/28/installation_pglift.html&#34;&gt;d√©ploiement d‚Äôinstances Postgres √† grande √©chelle&lt;/a&gt; et la&#xA;&lt;a href=&#34;https://blog.dalibo.com/2025/09/11/industrialiser-les-sauvegardes-de-postgresql.html&#34;&gt;gestion homog√®ne des sauvegardes Postgres avec pglift&lt;/a&gt;, nous allons cette fois&#xA;nous pencher sur la question de la s√©curit√©.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h2 id=&#34;les-bases-de-donn√©es-sont-les-cibles-ultimes-des-attaques-informatiques&#34;&gt;Les bases de donn√©es sont les cibles ultimes des attaques informatiques&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Les bases de donn√©es contiennent les informations les plus pr√©cieuses d‚Äôune&#xA;organisation : donn√©es personnelles, informations financi√®res, secrets&#xA;commerciaux, dossiers m√©dicaux, etc.&#xA;Elles repr√©sentent donc le point n√©vralgique et un bastion √† prot√©ger au c≈ìur&#xA;de chaque syst√®me d‚Äôinformation.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;PostgreSQL propose bien s√ªr un large panel de mesures internes pour la s√©curit√© :&#xA;un controle des acc√®s tr√®s fin avec le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_hba.conf&lt;/code&gt;, le chiffrement&#xA;TLS des communications, un syst√®me de roles/permissions sophitiqu√© ou encore&#xA;les r√®gles &lt;a href=&#34;https://doc.postgresql.fr/current/ddl-rowsecurity.html&#34;&gt;RLS&lt;/a&gt; pour filtrer les lectures lignes par lignes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Mais qu‚Äôen est-il de l‚Äôenvironnement dans lequel PostgreSQL √©volue ?&#xA;En particulier, comment prot√©ger l‚Äôinstance PostgreSQL depuis l‚Äôext√©rieur ?&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/2025_pexels-nguyendesigner-241028.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;selinux-est-le-standard-de-lindustrie&#34;&gt;SELinux est le standard de l‚Äôindustrie&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SELinux&lt;/code&gt; (pour ‚ÄúSecurity-Enhanced Linux‚Äù) r√©pond √† cette question en ajoutant&#xA;une couche de s√©curit√© suppl√©mentaire au-del√† du syst√®me de permissions&#xA;traditionnel. D√©velopp√© initialement par la NSA, SELinux applique des politiques&#xA;de s√©curit√© strictes qui d√©finissent pr√©cis√©ment quels processus peuvent acc√©der&#xA;√† quelles ressources (fichiers, ports r√©seau, etc.). Chaque processus est ainsi&#xA;isol√© et confin√© dans un contexte sp√©cifique. Concr√®tement, si un utilisateur&#xA;(non privil√©gi√©) se voit accorder des privil√®ges sudo, il peut contourner ces&#xA;restrictions : le mode &lt;a href=&#34;https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/virtualization_security_guide/sect-virtualization_security_guide-svirt-mac&#34;&gt;Mandatory Access Control (MAC)&lt;/a&gt; est alors contourn√©, et&#xA;la s√©curit√© des services en cours d‚Äôex√©cution ne peut plus √™tre garantie.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Concernant PostgreSQL, bien qu‚Äôil ne soit pas lanc√© en &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;root&lt;/code&gt;, un acc√®s privil√©gi√©&#xA;(via sudo) est souvent n√©cessaire pour g√©rer (activer, d√©marrer, stopper,‚Ä¶) les&#xA;services li√©s aux instances via systemd. D√©finir une politique SELinux devient&#xA;alors complexe, surtout avec les autres composants de la stack PostgreSQL, comme&#xA;pgBackRest ou Patroni. Cela soul√®ve la question du juste √©quilibre entre permettre&#xA;aux DBA de g√©rer PostgreSQL (et les services annexes), tout en pr√©servant la s√©curit√©&#xA;globale du syst√®me.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voir notre article ci-dessous pour un exemple concret:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.dalibo.com/2014/10/06/Confiner_PostgreSQL_avec_SELinux.html&#34;&gt;https://blog.dalibo.com/2014/10/06/Confiner_PostgreSQL_avec_SELinux.html&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;ansible-augmente-la-surface-dattaque&#34;&gt;Ansible augmente la surface d‚Äôattaque&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;La difficult√© augmente √©galement lorsque l‚Äôon passe √† l‚Äô√©chelle sup√©rieure et que&#xA;l‚Äôon veut piloter un parc d‚Äôinstances avec un outil d‚Äôorchestration comme Ansible.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour g√©rer chaque instance PostgreSQL, le n≈ìud de contr√¥le Ansible va se connecter&#xA;en SSH √† chaque serveur et devra acqu√©rir les privil√®ges superutilisateur pour&#xA;certaines op√©rations, notamment pour manipuler le service Postgres.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple:&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;  &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Enabling postgresql services&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;become&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;ansible.builtin.service&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;started&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ici la ligne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;become: true&lt;/code&gt; permet de devenir &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;root&lt;/code&gt; le temps de r√©aliser la t√¢che&#xA;pour v√©rifier l‚Äô√©tat du service et de l‚Äôactiver et d√©marrer si n√©cessaire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette simple ligne semble anodine, mais implique que l‚Äôutilisateur lan√ßant le playbook&#xA;peut acqu√©rir les droits superutilisateur √† tout moment sur un n≈ìud distant.&#xA;Concr√®tement, cela signifie que l‚Äôutilisateur pilotant les playbooks Ansible est&#xA;de facto &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;root&lt;/code&gt; sur l‚Äôensemble du parc d‚Äôinstances Postgres.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/2025_ansible.drawio.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;C‚Äôest en cela qu‚ÄôAnsible peut √©largir la surface d‚Äôattaque vers PostgreSQL. En effet,&#xA;le n≈ìud de contr√¥le est une cible de choix pour les attaquants : plut√¥t que d‚Äôattaquer&#xA;directement les bases de donn√©es qui sont g√©n√©ralement les √©l√©ments les plus prot√©g√©s,&#xA;ils tenteront d‚Äôacc√©der indirectement aux instances en passant par des points d‚Äôentr√©es&#xA;moins bien s√©curis√©s et plus facile d‚Äôacc√®s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien s√ªr, il est possible de restreindre les commandes accessibles via des solutions d‚Äô√©l√©vation&#xA;de privil√®ges comme &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sudo&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;doas&lt;/code&gt; ou d‚Äôautres m√©canismes similaires, notamment en configurant&#xA;leurs fichiers de contr√¥le (par exemple &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/etc/sudoers&lt;/code&gt; pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sudo&lt;/code&gt;). Cependant, cela ajoute une&#xA;couche suppl√©mentaire de complexit√© et augmente le risque d‚Äôerreur de configuration.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;s√©parer-les-r√¥les-pour-mieux-confiner-postgres&#34;&gt;S√©parer les r√¥les pour mieux confiner Postgres&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;La solution consiste √† revenir √† la racine du probl√®me. Dans le cycle de&#xA;vie d‚Äôune instance Postgres, 2 types d‚Äôintervenant sont impliqu√©s.&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Un r√¥le ‚Äúsysadmin‚Äù charg√© de pr√©parer la machine qui h√©bergera PostgreSQL&#xA;en installant tous les paquets logiciels n√©cessaires.&lt;/li&gt;&#xA;  &lt;li&gt;Un r√¥le ‚Äúdba‚Äù charg√© de cr√©er les instances Postgres et garantir leur&#xA;bon fonctionnement.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Pour chacun de ces deux r√¥les, on assigne un et un seul utilisateur syst√®me.&#xA;Le r√¥le ‚Äúsysadmin‚Äù aura les droits de l‚Äôutilisateur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;root&lt;/code&gt;, tandis que&#xA;le r√¥le dba se limitera √† des droits restreints n√©cessaires √† la gestion des instances&#xA;PostgreSQL. Dans les exemples qui suivent, nous utiliserons l‚Äôutilisateur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Concr√®tement cela signifie que l‚Äôon veut interdire aux DBA d‚Äôacqu√©rir les&#xA;privil√®ges root via &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sudo&lt;/code&gt; et lui interdire d‚Äôutiliser &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;become: true&lt;/code&gt;&#xA;dans ses playbooks Ansible !&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;les-services-utilisateur-de-systemd--un-tr√©sor-cach√©&#34;&gt;Les services utilisateur de Systemd : un tr√©sor cach√©&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Mais cela semble impossible puisque le service Postgres est lanc√© en tant&#xA;que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;root&lt;/code&gt; via une commande du type &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sudo systemctl start postgresql&lt;/code&gt; ?&lt;/p&gt;&#xA;&#xA;&lt;p&gt;C‚Äôest ici qu‚Äôentre en jeu le ‚Äúmode user‚Äù de systemd, un mode de fonctionnement&#xA;largement m√©connu et sous-estim√©. En effet, la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;systemctl --user&lt;/code&gt;&#xA;permet √† chaque utilisateur de d√©marrer/arr√™ter/activer/d√©sactiver ses propres&#xA;services.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans le cas de PostgreSQL, on fera g√©n√©ralement tourner le service avec&#xA;l‚Äôutilisateur syst√®me &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt; mais il est possible d‚Äôutiliser n‚Äôimporte&#xA;quel autre utilisateur. On stockera les donn√©es (PGDATA) dans le dossier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;$HOME&lt;/code&gt;&#xA;de l‚Äôutilisateur plutot que dans le dossier traditionnel &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/var/lib/postgres&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Enfin il est n√©cessaire d‚Äôactiver la fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;lingering&lt;/code&gt; pour l‚Äôutilisateur,&#xA;qui permet au service de continuer √† tourner, m√™me apr√®s la d√©connexion de&#xA;l‚Äôutilisateur. Cette fonction est activ√©e par la commande ci-dessous:&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;loginctl enable-linger &amp;lt;utilisateur&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h2 id=&#34;pglift--la-s√©curit√©-par-d√©faut&#34;&gt;pglift : la s√©curit√© par d√©faut&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;En tant qu‚Äôoutil de d√©ploiement, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift&lt;/code&gt; tire pleinement partie de systemd et&#xA;de ce mode utilisateur.&#xA;Lorsque systemd est activ√©, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift&lt;/code&gt; utilise le mode utilisateur par d√©faut.&#xA;Concr√®tement la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance create&lt;/code&gt; initialise une nouvelle instance&#xA;et cr√©e une unit√© de service systemd pour l‚Äôutilisateur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;D√©sormais, l‚Äôutilisateur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt; peut manipuler son instance sans utiliser&#xA;la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sudo&lt;/code&gt;. De m√™me, il peut cr√©er une instance avec un playbook&#xA;Ansible sans utiliser &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;become: true&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Create and configure my postgresql instances&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;localhost&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Create production instance&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dalibo.pglift.instance&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;prod&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;started&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&#34;&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;settings&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;max_connections&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;1GB&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;unix_socket_directories&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/tmp&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;shared_preload_libraries&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;pg_stat_statements, passwordcheck&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Atout majeur de ce confinement du service postgres : cela rend l‚Äôactivation de&#xA;SELinux compl√®tement trivial ! Puisque le processus PostgreSQL tourne dans&#xA;le contexte de l‚Äôutilisateur syst√®me &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;, les acc√®s aux ressources sont&#xA;d√©j√† encadr√©s par les droits d‚Äôacc√®s standard.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En d‚Äôautres termes, si un attaquant arrive √† compromettre une instance&#xA;PostgreSQL cr√©√©e avec pglift, il ne pourra pas ‚Äúsortir‚Äù du r√¥le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;&#xA;et n‚Äôaura pas acc√®s √† des ressources non-autoris√©es.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette approche permet √©galement d‚Äôisoler plusieurs instances PostgreSQL ex√©cut√©es&#xA;sous des comptes utilisateurs distincts. Chaque instance dispose de son propre&#xA;r√©pertoire de donn√©es, accessible uniquement √† l‚Äôutilisateur qui l‚Äôex√©cute. Ainsi,&#xA;les donn√©es ne sont ni accessibles ni modifiables par d‚Äôautres comptes, y compris&#xA;l‚Äôutilisateur postgres. Ce cloisonnement, bas√© sur les permissions classiques&#xA;du syst√®me de fichiers, assure une s√©paration stricte et efficace des&#xA;environnements bas√©e sur des m√©canismes √©prouv√©s.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;etablir-une-politique-de-s√©curit√©-√†-grande-√©chelle&#34;&gt;Etablir une politique de s√©curit√© √† grande √©chelle&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;En r√©sum√©, pglift vous permet facilement et par d√©faut de:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;S√©parer clairement les r√¥les ‚Äúsysadmin‚Äù et ‚Äúdba‚Äù&lt;/li&gt;&#xA;  &lt;li&gt;Activer SELinux sans configuration complexe&lt;/li&gt;&#xA;  &lt;li&gt;Interdire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sudo&lt;/code&gt; √† l‚Äôutilisateur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;&lt;/li&gt;&#xA;  &lt;li&gt;√âradiquer la clause &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;become: true&lt;/code&gt; des playbooks PostgreSQL&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Il existe √©videment d‚Äôautres mesures de s√©curit√© √† mettre en place pour&#xA;compl√©ter l‚Äôarsenal de protection de vos bases de donn√©es. On peut notamment&#xA;citer :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Imposer les acc√®s nominatifs avec un annuaire externe et &lt;a href=&#34;https://ldap2pg.readthedocs.io/en/latest/&#34;&gt;ldap2pg&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;Anonymiser les donn√©es sur les environnements secondaires (dev, testing) avec&#xA;&lt;a href=&#34;https://postgresql-anonymizer.readthedocs.io/en/stable/&#34;&gt;PostgreSQL Anonymizer&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;Tracer toutes les interactions des utilisateurs avec &lt;a href=&#34;https://www.pgaudit.org/&#34;&gt;pgaudit&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;Compartimenter les processus et les ressources de PostgreSQL grace&#xA;espaces de noms (‚Äúnamespaces‚Äù) de Linux&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;De vastes sujets, que nous arborderons peut-√™tre √† l‚Äôoccasion d‚Äôun prochain&#xA;article !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cr√©dit Photo: &lt;a href=&#34;https://www.pexels.com/fr-fr/photo/signalisation-241028/&#34;&gt;Pew Nguyen&lt;/a&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>ldap2pg 6.5 pour PostgreSQL 18</title>
    <updated>2025-10-06T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-10-06://2025/10/06/ldap2pg-6.5.html</id>
    <link href="https://blog.dalibo.com//2025/10/06/ldap2pg-6.5.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Paris, le 6 octobre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dalibo vous annonce la disponibilit√© de ldap2pg 6.5.&#xA;Cette version apporte le support de PostgreSQL 18 et quelques correctifs.&#xA;Suivez la &lt;a href=&#34;https://ldap2pg.readthedocs.io/en/latest/install/&#34;&gt;documentation pour installer&lt;/a&gt; cette nouvelle version.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;https://github.com/dalibo/ldap2pg/raw/master/docs/img/logo-phrase.png&#34; alt=&#34;ldap2pg&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Depuis 2017, ldap2pg propose la meilleure solution de synchronisation automatique de r√¥les et de privil√®ges pour PostgreSQL.&#xA;Configurez l‚Äôauthentification LDAP dans le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_hba.conf&lt;/code&gt;&#xA;puis utilisez ldap2pg pour cr√©er et configurer les r√¥les depuis votre annuaire d‚Äôentreprise.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;postgresql-18&#34;&gt;PostgreSQL 18&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;PostgreSQL 18 apporte un peu plus de rigueur&#xA;et a requis quelques ajustements dans les requ√™tes d‚Äôinspection des privil√®ges.&#xA;Ces ajustements optimisent toutes les requ√™tes d‚Äôinspection des privil√®ges&#xA;pour toutes les versions de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;routines-fonctions-proc√©dures&#34;&gt;Routines, fonctions, proc√©dures&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Dans PostgreSQL,&#xA;la distinction entre proc√©dures et fonctions est tr√®s mince.&#xA;D‚Äôailleurs, la syntaxe &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CREATE PROCEDURE&lt;/code&gt; n‚Äôexiste que depuis PostgreSQL 11.&#xA;PostgreSQL utilise le mot clef &lt;em&gt;ROUTINE&lt;/em&gt; pour traiter indiff√©remment fonctions et proc√©dures.&#xA;C‚Äôest notamment le cas pour les privil√®ges par d√©faut&#xA;qui ne peuvent √™tre distingu√©s pour les proc√©dures ou les fonctions.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;ldap2pg 6.5 respecte mieux la nomenclature de PostgreSQL.&#xA;Les privil√®ges sur les routines s‚Äôappliquent aux proc√©dures comme aux fonctions.&#xA;Les requ√™tes de gestion des fonctions sont d√©sormais correctement limit√©es aux fonctions.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;√Ä partir de ldap2pg 6.5,&#xA;mieux vaut utiliser &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;__execute_on_routines__&lt;/code&gt; que l‚Äô√©quivalent pour les fonctions.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;autres-changements&#34;&gt;Autres changements&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;ldap2pg 6.5 permet de g√©rer les privil√®ges par d√©faut √† soi-m√™me,&#xA;applique la configuration utilisateur sur les r√¥les dynamiques&#xA;et accepte de g√©rer les droits d‚Äôobjets dans des bases √† acc√®s limit√©.&#xA;Enfin ldap2pg est disponible dans les d√©p√¥ts Ubuntu 24.04 de Dalibo Labs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus d‚Äôinformations, consultez la &lt;a href=&#34;https://ldap2pg.readthedocs.io/en/latest/changelog/#ldap2pg-65&#34;&gt;documentation des changements&lt;/a&gt;.&#xA;Pour mettre √† jour en toute s√©curit√©,&#xA;d√©sactivez les t√¢ches planifi√©es ldap2pg,&#xA;testez la synchronisation manuellement avec la nouvelle version&#xA;et validez les changements que peuvent apporter cette nouvelle version.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Retrouvez la documentation en anglais, des proc√©dures et le support communautaire √† ces adresses :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Documentation en ligne¬†: &lt;a href=&#34;http://ldap2pg.rtfd.io/en/latest/&#34;&gt;http://ldap2pg.rtfd.io/en/latest/&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;Le projet sur GitHub¬†: &lt;a href=&#34;https://github.com/dalibo/ldap2pg&#34;&gt;https://github.com/dalibo/ldap2pg&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;hr /&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;√âtienne BERSAC et Pierre-Louis GONON d√©veloppent ldap2pg,&#xA;un projet du &lt;a href=&#34;https://labs.dalibo.com/&#34;&gt;Dalibo Labs&lt;/a&gt;.&#xA;Pour toutes questions techniques,&#xA;l‚Äô√©quipe recommande d‚Äôutiliser la page de &lt;a href=&#34;https://github.com/dalibo/ldap2pg/discussions&#34;&gt;ldap2pg sur GitHub&lt;/a&gt;.&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Industrialiser les sauvegardes de PostgreSQL</title>
    <updated>2025-09-11T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-09-11://2025/09/11/industrialiser-les-sauvegardes-de-postgresql.html</id>
    <link href="https://blog.dalibo.com//2025/09/11/industrialiser-les-sauvegardes-de-postgresql.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Nantes, le 11 Septembre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous avons vu dans un pr√©c√©dent article comment faciliter l‚Äôindustrialisation du d√©ploiement d‚Äôinstances PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans ce nouvel article, nous allons approfondir sur le d√©ploiement des sauvegardes, qui sont un aspect important &#xA;√† prendre en compte pour que les instances d√©ploy√©es automatiquement soient pr√™tes pour la production. Nous verrons&#xA;comment l‚Äôoutil &lt;em&gt;pglift&lt;/em&gt; peut aider dans cette d√©marche.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h2 id=&#34;types-de-sauvegarde&#34;&gt;Types de sauvegarde&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Pour les sauvegardes de PostgreSQL, on distingue deux strat√©gies distinctes mais compl√©mentaires, les sauvegardes &#xA;physiques et les sauvegardes logiques.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sauvegardes-physiques-locale&#34;&gt;Sauvegardes physiques locale&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une sauvegarde physique est une copie du r√©pertoire donn√©es de l‚Äôinstance. Si cette op√©ration est r√©alis√©e ¬´ √† froid ¬ª, c‚Äôest √† dire lorsque l‚Äôinstance est arr√™t√©e, la restauration se fait par simple copie des fichiers sauvegard√©s vers le r√©pertoire de &#xA;donn√©es. Si la sauvegarde est r√©alis√©e ¬´ √† chaud ¬ª, cette derni√®re est alors compos√©e de donn√©es incoh√©rentes. Il faut &#xA;alors, en plus de la sauvegarde des fichiers de donn√©es, sauvegarder les archives des journaux de transactions (WAL). &#xA;Lors du red√©marrage, PostgreSQL rejoue les WAL sur les fichiers de donn√©es afin de retrouver un √©tat coh√©rent. Souvent, on &#xA;utilise un outil de sauvegarde pour g√©rer les op√©rations de sauvegarde et restauration, ainsi que la gestion de &#xA;l‚Äôarchivage des WAL. Dans cet article, nous allons nous pencher sur l‚Äôutilisation de pgBackRest au travers de pglift&#xA;pour automatiser le d√©ploiement d‚Äôune sauvegarde dans un d√©p√¥t local.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec pglift, il est possible d‚Äôindustrialiser la configuration de pgBackRest pour nos instances.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple simple d‚Äôune configuration de pglift qui le permet :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;systemd&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;pi&#34;&gt;{}&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;postgresql&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;scram-sha-256&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;peer&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;datadir&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/pgsql_data/{version}/{name}/data&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;pgbackrest&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;repository&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;path&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/pgsql_backups/pgbackrest&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lorsqu‚Äôune instance PostgreSQL est d√©ploy√©e avec cette configuration de site, &#xA;et qu‚Äôun nom de stanza pgBackRest est sp√©cifi√© lors de la cr√©ation &#xA;d‚Äôinstance, pgBackRest est configur√© lors du d√©ploiement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance create main &lt;span class=&#34;nt&#34;&gt;--pgbackrest-stanza&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my_app&#xA;INFO     initializing PostgreSQL         &#xA;INFO     configuring PostgreSQL authentication&#xA;INFO     configuring PostgreSQL&#xA;INFO     enabling systemd unit pglift-postgresql@14-main.service&#xA;INFO     starting PostgreSQL 14/main&#xA;INFO     starting systemd unit pglift-postgresql@14-main.service&#xA;INFO     creating role &lt;span class=&#34;s1&#34;&gt;&#39;backup&#39;&lt;/span&gt;&#xA;INFO     configuring pgBackRest stanza &lt;span class=&#34;s1&#34;&gt;&#39;my_app&#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;pg1-path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/pgsql_data/14/main/data&#xA;INFO     creating pgBackRest stanza &lt;span class=&#34;s1&#34;&gt;&#39;my_app&#39;&lt;/span&gt;&#xA;INFO     checking pgBackRest configuration &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;stanza &lt;span class=&#34;s1&#34;&gt;&#39;my_app&#39;&lt;/span&gt;&#xA;INFO     enabling systemd unit pglift-backup@14-main.timer&#xA;INFO     creating instance dumps directory: /home/postgres/.local/share/pglift/srv/dumps/14-main&#xA;INFO     starting systemd unit pglift-backup@14-main.timer&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;pglift g√©n√®re un fichier de configuration pour pgBackRest :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ~/.local/share/pglift/etc/pgbackrest/pgbackrest.conf &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;global]&#xA;lock-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /run/user/1001/pglift/pgbackrest/lock&#xA;log-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /home/postgres/.local/share/pglift/log/pgbackrest&#xA;spool-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /home/postgres/.local/share/pglift/srv/pgbackrest/spool&#xA;repo1-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /pgsql_backups/pgbackrest&#xA;repo1-retention-archive &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 2&#xA;repo1-retention-diff &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 3&#xA;repo1-retention-full &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 2&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Il ajoute une stanza pour l‚Äôinstance dans &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;conf.d&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ~/.local/share/pglift/etc/pgbackrest/conf.d/my_app.conf &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;my_app]&#xA;pg1-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /pgsql_data/14/main/data&#xA;pg1-port &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 5432&#xA;pg1-user &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; backup&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Enfin, il prend √©galement en charge la configuration du param√®tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;archive_command&lt;/code&gt; pour &#xA;archiver les WAL vers le d√©p√¥t de sauvegarde via la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest archive-push&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;show archive_command&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;                                                                     archive_command                               &#xA;                                      &#xA;&lt;span class=&#34;nt&#34;&gt;-------------------------------------------------------------------------------------------------------------------&lt;/span&gt;&#xA;&lt;span class=&#34;nt&#34;&gt;--------------------------------------&lt;/span&gt;&#xA; /usr/bin/pgbackrest &lt;span class=&#34;nt&#34;&gt;--config-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/home/postgres/.local/share/pglift/etc/pgbackrest &lt;span class=&#34;nt&#34;&gt;--stanza&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my_app &lt;span class=&#34;nt&#34;&gt;--pg1-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/pg&#xA;sql_data/14/main/data archive-push %p&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1 row&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Par cons√©quent, d√®s le d√©ploiement, les WAL sont archiv√©s dans le d√©p√¥t de sauvegarde&#xA;de pgBackRest et la sauvegarde de l‚Äôinstance est alors possible. Pour cela, on utilise &#xA;la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance backup&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance backup&#xA;INFO     backing up instance 17/main with pgBackRest    &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour lister les sauvegardes pr√©sentes dans le d√©p√¥t, on utilise la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance backups&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance backups&#xA;                                       Available backups &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;instance 14/main                                        &#xA;‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì&#xA;‚îÉ label            ‚îÉ size    ‚îÉ repo_size ‚îÉ date_start                ‚îÉ date_stop                 ‚îÉ &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; ‚îÉ databases ‚îÉ&#xA;‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©&#xA;‚îÇ 20250826-121904F ‚îÇ 26.5 MB ‚îÇ 3.3 MB    ‚îÇ 2025-08-26 12:19:04+02:00 ‚îÇ 2025-08-26 12:19:10+02:00 ‚îÇ full ‚îÇ postgres  ‚îÇ&#xA;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&#xA;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Sinon, la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest info&lt;/code&gt;, ex√©cut√©e au travers de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance exec&lt;/code&gt;&#xA;permet aussi d‚Äôobtenir les informations sur les sauvegardes, cette fois directement &#xA;depuis pgBackRest :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; pgbackrest info&#xA;stanza: my_app&#xA;    status: ok&#xA;    cipher: none&#xA;&#xA;    db &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;current&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;        wal archive min/max &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;14&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;: 000000010000000000000001/000000010000000000000003&#xA;&#xA;        full backup: 20250826-121904F&#xA;            timestamp start/stop: 2025-08-26 12:19:04+02 / 2025-08-26 12:19:10+02&#xA;            wal start/stop: 000000010000000000000003 / 000000010000000000000003&#xA;            database size: 25.3MB, database backup size: 25.3MB&#xA;            repo1: backup &lt;span class=&#34;nb&#34;&gt;set &lt;/span&gt;size: 3.2MB, backup size: 3.2MB&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour v√©rifier le bon fonctionnement, on peut cr√©er une table dans une nouvelle base de donn√©es, pour y ins√©rer quelques lignes :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database create db1&#xA;INFO     creating &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; database &lt;span class=&#34;k&#34;&gt;in &lt;/span&gt;17/main      &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;CREATE TABLE t1 (id INT); INSERT INTO t1 VALUES (1),(2),(3);&#34;&lt;/span&gt;&#xA;CREATE TABLE&#xA;INSERT 0 3&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Noter ensuite la date et l‚Äôheure actuelle :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;select now();&#34;&lt;/span&gt;&#xA;              now              &#xA;&lt;span class=&#34;nt&#34;&gt;-------------------------------&lt;/span&gt;&#xA; 2025-08-26 12:20:18.968157+02&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1 row&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Puis supprimer la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;DROP TABLE t1&#34;&lt;/span&gt;&#xA;DROP TABLE&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt;, d√©sormais manquante, n‚Äô√©tait pas pr√©sente au moment de la sauvegarde, &#xA;ni m√™me la base de donn√©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;db1&lt;/code&gt; qui la contient. On pourrait donc croire que les &#xA;donn√©es sont perdues. Cependant, les actions menant √† la cr√©ation de la base de &#xA;donn√©es et de la table on √©t√© enregistr√©es dans les journaux de transaction (WAL), &#xA;il est donc tout √† fait possible de retrouver les donn√©es en restaurant la &#xA;sauvegarde qui pr√©c√®de l‚Äôexistence de la table, puis en laissant PostgreSQL &#xA;rejouer les WAL sur ses fichiers de donn√©es pendant la phase de recover.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les WAL sont archiv√©s dans le d√©p√¥t de sauvegarde de pgBackRest, et PostgreSQL &#xA;est capable d‚Äôacc√©der √† ces archives via le param√®tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;restore_command&lt;/code&gt;, qui &#xA;est √©galement configur√© automatiquement par pglift lors du d√©ploiement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;postgres=# show restore_command ;&#xA;                                                     restore_command                                                     &#xA;-------------------------------------------------------------------------------------------------------------------------&#xA; /usr/bin/pgbackrest --config-path=/home/postgres/.local/share/pglift/etc/pgbackrest --stanza=my_app archive-get %f &#34;%p&#34;&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le rejeu des WAL est ex√©cut√© lors du premier d√©marrage qui suit la restauration. &#xA;Pour restaurer notre table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt;, pglift va donc ex√©cuter une restauration de &#xA;l‚Äôinstance via pgBackRest. Ce dernier va alors configurer PostgreSQL pour rejouer &#xA;les WAL jusqu‚Äô√† la date et heure demand√©e, c‚Äôest √† dire celle que nous avons not√©&#xA;plus t√¥t.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;L‚Äôinstance est arr√™t√©e, puis restaur√©e avec la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance restore&lt;/code&gt;. &#xA;On sp√©cifie la date au format &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;YYYY-MM-JJ HH:MM:SS&lt;/code&gt; avec l‚Äôoption &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--date&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance stop&#xA;INFO     stopping PostgreSQL 17/main&#xA;INFO     stopping systemd unit pglift-postgresql@17-main.&#xA;INFO     stopping systemd unit pglift-backup@17-main.timer&#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance restore &lt;span class=&#34;nt&#34;&gt;--date&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;2025-08-26 12:20:18&#34;&lt;/span&gt;&#xA;INFO     restoring instance 17/main with pgBackRest &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;D√©marrer l‚Äôinstance. PostgreSQL effectue alors le recover jusqu‚Äô√† la date et heure cible :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance start&#xA;INFO     starting PostgreSQL 14/main                                                                               &#xA;INFO     starting systemd unit pglift-postgresql@14-main.service                                                   &#xA;INFO     starting systemd unit pglift-backup@14-main.timer     &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La trace lors du d√©marrage nous indique bien que le recovery s‚Äôest arr√™t√© avant la &#xA;transaction ex√©cut√©e √† 12:20:35, ce qui correspond √† la suppression de la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;13-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;6-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  restored log file &lt;span class=&#34;s2&#34;&gt;&#34;000000010000000000000004&#34;&lt;/span&gt; from archive&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;14-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;7-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  recovery stopping before commit of transaction 736, &lt;span class=&#34;nb&#34;&gt;time &lt;/span&gt;2025-08-26 12:20:35.654705+02&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;15-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;8-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  redo &lt;span class=&#34;k&#34;&gt;done &lt;/span&gt;at 0/40188D8 system usage: CPU: user: 0.00 s, system: 0.03 s, elapsed: 0.14 s&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;16-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;9-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  last completed transaction was at log &lt;span class=&#34;nb&#34;&gt;time &lt;/span&gt;2025-08-26 12:20:14.593246+02&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;17-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;10-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  selected new timeline ID: 2&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;18-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;11-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  archive recovery &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La table est donc bien de nouveau consultable dans la base de donn√©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;db1&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;SELECT * FROM t1&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;nb&#34;&gt;id&lt;/span&gt; &#xA;&lt;span class=&#34;nt&#34;&gt;----&lt;/span&gt;&#xA;  1&#xA;  2&#xA;  3&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;3 rows&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h4 id=&#34;sauvegarde-physique-√†-distance&#34;&gt;Sauvegarde physique √† distance&lt;/h4&gt;&#xA;&#xA;&lt;p&gt;Nous avons d√©crit le fonctionnement de la sauvegarde physique locale, mais&#xA;pgBackRest peut √©galement fonctionner sur un mod√®le client-serveur, dans lequel&#xA;un serveur pgBackRest regroupe les sauvegardes provenant de plusieurs instances &#xA;PostgreSQL dans un d√©p√¥t unique et centralise leurs planifications. Ce mode &#xA;de fonctionnement ne sera pas d√©velopp√© en d√©tail dans cet article, mais il est &#xA;√©galement support√© par pglift.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;https://pglift.readthedocs.io/en/latest/user/setup/pgbackrest.html#remote-repository-mode&#34;&gt;Voir la documentation associ√©e&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sauvegardes-logiques&#34;&gt;Sauvegardes logiques&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Les sauvegardes logiques fonctionnent selon un principe diff√©rent. Dans ce &#xA;mode de sauvegarde, les donn√©es de l‚Äôinstance sont export√©es dans un ou plusieurs &#xA;fichiers.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un dump est une sauvegarde qui correspond au r√©sultat d‚Äôune lecture coh√©rente de &#xA;la base de donn√©es, telle qu‚Äôelle √©tait au moment du d√©but de la sauvegarde, et &#xA;quelque soit la dur√©e d‚Äôexport des donn√©es. Cela est rendu possible par le &#xA;m√©canisme MVCC de PostgreSQL, qui permet d‚Äôacc√©der aux versions pr√©c√©dentes des &#xA;donn√©es qui pourraient avoir √©t√© modifi√©es pendant que la sauvegarde est effectu√©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le dump peut √™tre import√© sur son instance d‚Äôorigine pour restaurer une base de &#xA;donn√©es √† un √©tat pr√©c√©dent. Il peut aussi √™tre utile pour des besoins de &#xA;migration, ou pour porter des donn√©es sur une instance de test par exemple.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;L‚Äôoutil standard &lt;em&gt;pg_dump&lt;/em&gt; permet de r√©aliser ces sauvegardes, et il peut √™tre &#xA;pilot√© par &lt;em&gt;pglift&lt;/em&gt; pour r√©aliser les dumps sur les instances qu‚Äôil d√©ploie.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;pglift&lt;/em&gt; effectue l‚Äôexport des donn√©es via la commande sp√©cifi√©e dans la &#xA;cl√© &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql.dump_commands&lt;/code&gt; de sa configuration. La valeur par d√©faut est la &#xA;suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;dump_commands&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;{bindir}/pg_dump&#39;&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;-Fc&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;-f&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;{path}/{dbname}_{date}.dump&#39;&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;-d&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;{conninfo}&#39;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On voit ici que &lt;em&gt;pg_dump&lt;/em&gt; sera utilis√© pour r√©aliser un dump au format&#xA;&lt;em&gt;custom&lt;/em&gt; (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;-Fc&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;L‚Äôemplacement du dump (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;{path}&lt;/code&gt;) correspond au param√®tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dumps_directory&lt;/code&gt;,&#xA;qui est par d√©faut d√©duit du r√©pertoire de donn√©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;dumps_directory&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/pgsql_data/backups/dumps/{version}-{name}&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Sur notre instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;main&lt;/code&gt;, nous pouvons donc faire une sauvegarde de la base&#xA;de donn√©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;db1&lt;/code&gt; avec la commande suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database dump db1&#xA;INFO     backing up database &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; on instance 14/main &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On retrouve bien le dump √† l‚Äôemplacement pr√©vu :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ls&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-l&lt;/span&gt; /pgsql_data/backups/dumps/14-main/&#xA;total 4&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;.&lt;/span&gt; 1 postgres &lt;span class=&#34;nb&#34;&gt;users &lt;/span&gt;1176 Sep  1 14:35 db1_2025-09-01T14:35:30+00:00.dump&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Et &lt;em&gt;pglift&lt;/em&gt; peut √©galement lister les dumps pr√©sents dans ce r√©pertoire :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;[postgres@srv-pg1 ~]$ pglift database dumps&#xA;                                                   Dumps for all databases                                                    &#xA;‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì&#xA;‚îÉ id             ‚îÉ dbname ‚îÉ date                      ‚îÉ path                                                                 ‚îÉ&#xA;‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©&#xA;‚îÇ db1_665a78398d ‚îÇ db1    ‚îÇ 2025-09-01 14:35:30+00:00 ‚îÇ /pgsql_data/backups/dumps/14-main/db1_2025-09-01T14:35:30+00:00.dump ‚îÇ&#xA;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Supprimer √† nouveau la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;DROP TABLE t1&#34;&lt;/span&gt;&#xA;DROP TABLE&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour retrouver nos donn√©es √† partir de la sauvegarde, il convient de supprimer &#xA;la base de donn√©es, puis de restaurer via le dump, en sp√©cifiant son identifiant :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database drop db1&#xA;INFO     dropping &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; database    &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database restore db1_665a78398d&#xA;INFO     restoring dump &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; on instance 14/main    &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Les donn√©es sont bien restaur√©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;SELECT * FROM t1&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;nb&#34;&gt;id&lt;/span&gt; &#xA;&lt;span class=&#34;nt&#34;&gt;----&lt;/span&gt;&#xA;  1&#xA;  2&#xA;  3&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;3 rows&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h1 id=&#34;pour-conclure&#34;&gt;Pour conclure&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Pour industrialiser PostgreSQL sans risque pour la s√©curit√© des donn√©es, il &#xA;est important de pr√©voir au plus t√¥t comment celles-ci seront sauvegard√©es.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous avons vu comment l‚Äôoutil &lt;em&gt;pglift&lt;/em&gt; nous permettait d‚Äôindustrialiser le d√©ploiement&#xA;de nos sauvegardes, physiques ou logiques, de telle sorte que toute nouvelle instance&#xA;est pr√™te √† √™tre sauvegard√©es d√®s son initialisation. Le d√©ploiement de la&#xA;sauvegarde √©tant alors industriel, on r√©duit les risques d‚Äôerreurs lors de sa&#xA;mise en place.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #9 - L&#39;ajout dynamique d&#39;extensions</title>
    <updated>2025-09-09T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-09-09://2025/09/09/cnpg-9.html</id>
    <link href="https://blog.dalibo.com//2025/09/09/cnpg-9.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 9 septembre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;CloudNativePG&lt;/strong&gt; ou comment embarquer un √©l√©phant sur un porte-conteneurs !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les extensions font partie des nombreux avantages de PostgreSQL. Elles&#xA;permettent de rajouter des fonctionnalit√©s √† nos bases de donn√©es en chargeant des&#xA;modules compl√©mentaires comme &lt;a href=&#34;https://postgis.net/&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PostGIS&lt;/code&gt;&lt;/a&gt; ou&#xA;encore &lt;a href=&#34;https://postgresql-anonymizer.readthedocs.io/en/stable/&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PostgreSQL Anonymizer&lt;/code&gt;&lt;/a&gt;.&#xA;CloudNativePG embarque d√©j√† quelques extensions. Mais si l‚Äôon veut en rajouter&#xA;une, comment cela se passe-t-il ü§î ?&lt;/p&gt;&#xA;&#xA;&lt;p&gt;C‚Äôest ce que nous allons voir avec une nouvelle fonctionnalit√© de la version&#xA;1.27 de l‚Äôop√©rateur et de l‚Äôutilisation du nouveau param√®tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt; de la version 18 de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;les-extensions-disponibles&#34;&gt;Les extensions disponibles&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Au moment de la r√©daction de ce post, une quarantaine d‚Äôextensions sont&#xA;disponibles dans une instance PostgreSQL d√©ploy√©e avec CloudNativePG. Cela peut&#xA;facilement √™tre vu avec la commande suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_available_extensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;-------&lt;/span&gt;&#xA;    &lt;span class=&#34;mi&#34;&gt;46&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces extensions-l√† sont disponibles, car elles se trouvent √™tre ajout√©es √† l‚Äôimage&#xA;lors de sa construction. Certains op√©rateurs en embarquent plus, d‚Äôautres&#xA;beaucoup moins. Il est donc int√©ressant de v√©rifier celles qui sont d√©j√†&#xA;d√©ploy√©es et dans quelles versions est disponibles.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Jusqu‚Äô√† pr√©sent, si nous souhaitions utiliser une extension qui ne faisait pas&#xA;partie de cette liste, il √©tait n√©cessaire de modifier l‚Äôimage utilis√©e pour&#xA;l‚Äôint√©grer. Bien que tout √† fait faisable, cela n‚Äô√©tait pas tr√®s flexible.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La version 18 de PostgreSQL apporte une nouveaut√© avec le param√®tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt; qui permet d‚Äôindiquer d‚Äôautres emplacements o√π peuvent&#xA;√™tre trouv√©es des extensions. L‚Äôid√©e des d√©veloppeurs de CloudNativePG est de&#xA;mettre √† jour ce param√®tre en fonction des nouvelles extensions que nous&#xA;ajoutons pour prendre en compte dynamiquement les ajouts. Nous verrons plus tard&#xA;sur quel m√©canisme de Kubernetes se repose cette fonctionnalit√©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;L‚Äôid√©e est de pr√©senter notre nouvelle extension via un nouveau conteneur √†&#xA;notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt;. Et qui dit conteneur, dit image üì¶.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;cr√©ation-dune-extension&#34;&gt;Cr√©ation d‚Äôune extension&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bon pour commencer, il nous faut une extension. Pour les plus curieux, vous&#xA;pouvez trouver des explications sur comment faire dans cette suite d‚Äô&lt;a href=&#34;https://blog.dalibo.com/2023/06/08/hackingpg1.html&#34;&gt;articles&lt;/a&gt;.&#xA;Je me suis clairement inspir√© de celui-ci, et ai donc deux fichiers dans un&#xA;dossier¬†&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/share/&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ./share/monextension--1.0.sql &#xA;&lt;span class=&#34;se&#34;&gt;\e&lt;/span&gt;cho Ne pas ex√©cuter ce script, mais passer par CREATE EXTENSION&#xA;&#xA;CREATE OR REPLACE FUNCTION incremente&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;int&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;RETURNS int&#xA;LANGUAGE sql&#xA;AS &lt;span class=&#34;s1&#34;&gt;&#39;SELECT $1+1&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ./share/monextension.control &#xA;comment &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;Mon extension&#39;&lt;/span&gt;&#xA;default_version &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;1.0&#39;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lorsque cette extension sera install√©e dans la base de donn√©es, la&#xA;fonction¬†&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;incremente()&lt;/code&gt; sera disponible.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;cr√©ation-de-limage&#34;&gt;Cr√©ation de l‚Äôimage&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Les fichiers de l‚Äôextension seront ajout√©s au &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; PostgreSQL via le m√©canisme&#xA;d‚Äô&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ImageVolume&lt;/code&gt; de Kubernetes. Cette fonctionnalit√© doit √™tre activ√©e sur votre&#xA;cluster. Elle est toujours en version&#xA;&lt;a href=&#34;https://kubernetes.io/blog/2025/04/29/kubernetes-v1-33-image-volume-beta/&#34;&gt;&lt;em&gt;beta&lt;/em&gt;&lt;/a&gt;&#xA;dans la version 1.33 de Kubernetes et notez que tous les &lt;em&gt;container runtime&lt;/em&gt; ne&#xA;supportent pas encore cela. Elle permet d‚Äôattacher un volume √† partir du contenu&#xA;d‚Äôune image sans devoir modifier l‚Äôimage principale. Ici, nous allons empaqueter&#xA;nos fichiers d‚Äôextensions.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Dockerfile&lt;/code&gt; de notre exemple est ultra simpliste :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-dockerfile highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; debian:bookworm&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;RUN &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /share/extension&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; ./share /share/extension&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;L‚Äôimage se repose sur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;debian:bookworm&lt;/code&gt; et ne fait que cr√©er un dossier&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/share/extension&lt;/code&gt; en y incluant les fichiers de notre extension. Le dossier&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/share/extension&lt;/code&gt; est un pr√©-requis que doit respecter notre image.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;docker build -t monextension:1.0&lt;/code&gt; permet de cr√©er notre image&#xA;localement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;docker build &lt;span class=&#34;nt&#34;&gt;-t&lt;/span&gt; monextension:1.0 &lt;span class=&#34;nb&#34;&gt;.&lt;/span&gt;              &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+] Building 1.6s &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;8/8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; FINISHED                                                                        docker:default&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load build definition from Dockerfile                                                              0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; transferring dockerfile: 120B                                                                              0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load metadata &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;docker.io/library/debian:bookworm                                                1.5s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load .dockerignore                                                                                 0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; transferring context: 2B                                                                                   0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;1/3] FROM docker.io/library/debian:bookworm@sha256:731dd1380d6a8d170a695dbeb17fe0eade0e1c29f654cf0a3a07f372  0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load build context                                                                                 0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; transferring context: 119B                                                                                 0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; CACHED &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2/3] RUN &lt;span class=&#34;nb&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /share/extension                                                                    0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; CACHED &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;3/3] COPY ./share /share/extension                                                                    0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; exporting to image                                                                                            0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; exporting layers                                                                                           0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; writing image sha256:f267ee02248f74f371a68ebd37287f4727639342f5b4305e5d21670149195b72                      0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; naming to docker.io/library/monextension:1.0                                                               0.0s&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Il nous reste √† rendre cette image disponible pour notre cluster Kubernetes.&#xA;Vous pouvez passer par une &lt;em&gt;registry&lt;/em&gt; publique. Ici, pour faire beaucoup plus&#xA;simple, et comme &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kind&lt;/code&gt; est utilis√©, nous poussons l‚Äôimage sur le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Node&lt;/code&gt; avec :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;kind load docker-image monextension:1.0&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Maintenant que l‚Äôimage est pr√™te, voyons comment la rajouter √† notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;&#xA;PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;d√©finition-du-cluster&#34;&gt;D√©finition du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;La d√©finition du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; est la suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:18beta2&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;1Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;postgresql&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;extensions&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;monextension&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;reference&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;monextension:1.0&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La fin de ce fichier nous int√©resse particuli√®rement avec la partie&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.postgresql.extensions&lt;/code&gt; qui liste les extensions √† rajouter et les images&#xA;associ√©es. Ici, l‚Äôextension¬†&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;monextension&lt;/code&gt; dans sa version 1.0 va √™tre rajout√©e&#xA;en m√™me temps que le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; sera cr√©√©.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;kubectl apply &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; cluster.yaml&#xA;cluster.postgresql.cnpg.io/postgresql created&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;√Ä la cr√©ation, trois images seront d√©sormais r√©cup√©r√©es : deux pour le&#xA;fonctionnement de PostgreSQL avec CloudNativePG et la troisi√®me correspondant √†&#xA;l‚Äôextension.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;kubectl describe pod postgresql-1 | &lt;span class=&#34;nb&#34;&gt;grep &lt;/span&gt;image    &#xA;  Normal  Pulled     29s                kubelet            Container image &lt;span class=&#34;s2&#34;&gt;&#34;ghcr.io/cloudnative-pg/cloudnative-pg:1.27.0&#34;&lt;/span&gt; already present on machine&#xA;  Normal  Pulled     28s                kubelet            Container image &lt;span class=&#34;s2&#34;&gt;&#34;ghcr.io/cloudnative-pg/postgresql:18beta2&#34;&lt;/span&gt; already present on machine&#xA;  Normal  Pulled     28s                kubelet            Container image &lt;span class=&#34;s2&#34;&gt;&#34;monextension:1.0&#34;&lt;/span&gt; already present on machine&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;L‚Äôextension est d√©sormais bien disponible dans notre instance :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;kubectl cnpg psql postgresql            &#xA;psql &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;18beta2 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Debian 18~beta2-1.pgdg110+1&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;&#xA;Type &lt;span class=&#34;s2&#34;&gt;&#34;help&#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;help.&#xA;&#xA;&lt;span class=&#34;nv&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# SELECT * FROM pg_available_extensions WHERE name = &#39;monextension&#39;;&lt;/span&gt;&#xA;     name     | default_version | installed_version |    comment    &#xA;&lt;span class=&#34;nt&#34;&gt;--------------&lt;/span&gt;+-----------------+-------------------+---------------&#xA; monextension | 1.0             |                   | Mon extension&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1 row&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;L‚Äôordre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CREATE EXTENSION&lt;/code&gt; peut √™tre pass√© pour l‚Äôinstaller et retrouver notre&#xA;fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;incremente&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;monextension&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;incremente&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;41&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;incremente&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;------------&lt;/span&gt;&#xA;         &lt;span class=&#34;mi&#34;&gt;42&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;CloudNativePG a proc√©d√© √† la modification du param√®tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt;&#xA;pour que l‚Äôinstance puisse trouver la nouvelle extension dans le volume qui&#xA;vient d‚Äô√™tre mont√©.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;show&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;extension_control_path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;         &lt;span class=&#34;n&#34;&gt;extension_control_path&lt;/span&gt;         &#xA;&lt;span class=&#34;c1&#34;&gt;----------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;extensions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;monextension&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;share&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette nouvelle fonctionnalit√© est tr√®s int√©ressante et les quelques √©tapes&#xA;ci-dessus montrent comment parvenir √† l‚Äôexploiter. L‚Äôexemple est rudimentaire&#xA;certes, mais bien fonctionnel et permet √©galement d‚Äôaborder certaines choses qui&#xA;f√¢chent üòÜ.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;quelques-limites-tout-de-m√™me&#34;&gt;Quelques limites tout de m√™me&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;L‚Äôajout d‚Äôextension de mani√®re d√©clarative dans Kubernetes a des avantages.&#xA;L‚Äôavantage majeur est de ne pas devoir modifier l‚Äôimage principale. Elle a √©galement&#xA;certaines limites. Celles-ci ne discr√©ditent pas cette nouvelle fonctionnalit√©,&#xA;mais il faut en avoir conscience !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La premi√®re des choses est la taille de l‚Äôimage. Pour cet exemple, l‚Äôid√©e √©tait&#xA;d‚Äôaller au plus simple et de ne pas trop se pr√©occuper de cette notion. Mais&#xA;avouez qu‚Äôutiliser une image d‚Äôenviron 120 Mo pour ajouter deux fichiers de&#xA;quelques centaines octets‚Ä¶ üå± √©cologiquement ce n‚Äôest pas terrible. √âvidemment,&#xA;la clause &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;FROM&lt;/code&gt; du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Dockerfile&lt;/code&gt; peut √™tre adapt√©e pour partir d‚Äôune image &#xA;plus l√©g√®re et, soyons honn√™tes il sera difficile de faire pire comme exemple&#xA;avec uniquement deux fichiers texte. √Ä garder en t√™te tout de m√™me.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Plus subtile cette fois-ci, je vous laisse essayer de rajouter une extension √†&#xA;un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; d√©j√† en fonctionnement. La commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl apply -f cluster.yaml&lt;/code&gt;&#xA;renvoie bien le message &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;cluster.postgresql.cnpg.io/postgresql configured&lt;/code&gt;.&#xA;Notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; est donc mis √† jour, l‚Äôextension est disponible. Au passage,&#xA;vous aurez remarqu√© que l‚Äôinstance a √©t√© red√©marr√©e üí•. Et oui, un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Rolling Update&lt;/code&gt;&#xA;de tous les &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pods&lt;/code&gt; li√©s au &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; est d√©clench√© pour que le nouveau volume&#xA;puisse √™tre mont√© sur les &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pods&lt;/code&gt;. C‚Äôest une petite diff√©rence avec la mani√®re de faire sur&#xA;un environnement virtuel ou physique. Assurez-vous que l‚Äôajout d‚Äôune extension&#xA;fonctionne bien sur un environnement de test avant de le faire en production.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Avec la derni√®re version de CloudNativePG, vous pouvez ajouter dynamiquement, au&#xA;d√©marrage des instances, de nouvelles extensions. Cette nouveaut√©, rendue&#xA;possible par le nouveau param√®tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt; de la version 18 de&#xA;PostgreSQL et le concept d‚Äô&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ImageVolume&lt;/code&gt; de Kubernetes, ravira les utilisateurs&#xA;qui n‚Äôauront pas √† modifier l‚Äôimage principale du conteneur.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette nouvelle mani√®re de faire rendra l‚Äôusage d‚Äôinstance PostgreSQL dans&#xA;Kubernetes plus flexible en ce qui concerne la gestion des extensions. Reste √†&#xA;attendre que toutes fonctionnalit√©s deviennent stables, mais l‚Äô√©volution est&#xA;tr√®s int√©ressante ‚ú®.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[Commentaire-Blog] CloudNativePG&#34;&gt;√âcrivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 18 : des IO asynchrones performantes !</title>
    <updated>2025-11-19T09:10:27Z</updated>
    <id>tag:blog.capdata.fr,2025-11-19:/index.php/postgresql-18-des-io-asynchrones-performantes/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10742&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10742&amp;#038;title=PostgreSQL%2018%20%3A%20des%20IO%20asynchrones%20performantes%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2018%20%3A%20des%20IO%20asynchrones%20performantes%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10742&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10743&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/7346573-300x300.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;300&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/7346573-300x300.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/11/7346573-150x150.png 150w, https://blog.capdata.fr/wp-content/uploads/2025/11/7346573-144x144.png 144w, https://blog.capdata.fr/wp-content/uploads/2025/11/7346573-50x50.png 50w, https://blog.capdata.fr/wp-content/uploads/2025/11/7346573.png 512w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le 25 septembre dernier, PostgreSQL sortait sa toute derni√®re version, PostgreSQL 18.&lt;br /&gt;&#xA;Cette version apporte de nombreux correctifs mais aussi des nouveaut√©s et des am√©liorations sur les performances globales.&lt;/p&gt;&#xA;&lt;p&gt;Une nouveaut√© est particuli√®rement pertinente pour cette version. Il s&amp;#8217;agit des &amp;#8220;asynchronous IO&amp;#8221; (AIO).&lt;/p&gt;&#xA;&lt;h2&gt;Pr√©sentation&lt;/h2&gt;&#xA;&lt;p&gt;Une lecture en mode synchrone se fait lorsque PostgreSQL demande au kernel l&amp;#8217;acc√®s √† une page disque. PostgreSQL attend alors sa mise √† disposition pour √™tre trait√©e et mont√©e en m√©moire partag√©e.&lt;br /&gt;&#xA;L&amp;#8217;OS √©coute la requ√™te de la part de PostgreSQL et ne peut anticiper les √©ventuelles demandes.&lt;br /&gt;&#xA;Dans ce contexte, PostgreSQL est tr√®s d√©pendant des performances disques avec d&amp;#8217;√©ventuels &amp;#8220;bottlenecks&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Avec le mode asynchrone IO, l&amp;#8217;OS est capable de traiter en parall√®le les demandes faites par PostgreSQL et peut donc facilement travailler sur plusieurs requ√™tes en lecture.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Synchronous IO¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† Asynchronous IO&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone wp-image-10744&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/synch_IO.jpg&#34; alt=&#34;&#34; width=&#34;474&#34; height=&#34;222&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/synch_IO.jpg 827w, https://blog.capdata.fr/wp-content/uploads/2025/11/synch_IO-300x140.jpg 300w, https://blog.capdata.fr/wp-content/uploads/2025/11/synch_IO-768x359.jpg 768w&#34; sizes=&#34;auto, (max-width: 474px) 100vw, 474px&#34; /&gt;¬† ¬†&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone wp-image-10745&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/asynch_IO.jpg&#34; alt=&#34;&#34; width=&#34;459&#34; height=&#34;187&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/asynch_IO.jpg 818w, https://blog.capdata.fr/wp-content/uploads/2025/11/asynch_IO-300x122.jpg 300w, https://blog.capdata.fr/wp-content/uploads/2025/11/asynch_IO-768x314.jpg 768w&#34; sizes=&#34;auto, (max-width: 459px) 100vw, 459px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Un premier travail avait √©t√© fait avec les versions r√©centes de PostgreSQL afin de faire du &amp;#8220;prefetch&amp;#8221; de donn√©es via la m√©thode syst√®me &amp;#8220;&lt;a href=&#34;http://manpagesfr.free.fr/man/man2/posix_fadvise.2.html&#34;&gt;posix_fadvise&lt;/a&gt;&amp;#8220;, ceci permettait d&amp;#8217;anticiper les d√©clarations d&amp;#8217;acc√®s √† certaines donn√©es ou pages de fichiers en d√©clarant un offset de d√©part et une longueur d√©fini. Ceci √©vite des allers-retours sur le m√™me fichier traitant des pages contigu√´s.&lt;br /&gt;&#xA;Malheureusement, avec PostgreSQL, ce m√©canisme ne permet pas de monter les pages dans le &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;, mais s&amp;#8217;appuie sur le cache disque.&lt;/p&gt;&#xA;&lt;p&gt;Avec les asynchronous IO, PostgreSQL est particuli√®rement performant lors des lectures s√©quentielles (seq scans, bitmap heap scan).&lt;br /&gt;&#xA;Un parall√®le peut √™tre fait avec le m√©canisme d&amp;#8217;offloading fait par Oracle Exadata et les &amp;#8220;smart scans&amp;#8221; mont√©s directement vers la PGA.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Param√©trage&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Avec la version 18, PostgreSQL met l&amp;#8217;accent sur les lectures asynchrones avec de nouveaux param√®tres.&lt;/p&gt;&#xA;&lt;p&gt;&lt;b&gt;io_method&lt;/b&gt; qui peut prendre 3 valeurs diff√©rentes&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;sync&lt;/span&gt; : ex√©cute les IO en mode synchrone comme pour les versions PostgreSQL ant√©rieures&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;worker&lt;/span&gt; : valeur par d√©faut. Les lectures se font via des processus en parall√®les lanc√©s par la requ√™te parente (3 par d√©faut). Ces processus font des appels aupr√®s du kernel et montent les donn√©es dans le &amp;#8220;shared_buffers&amp;#8221; pour √™tre trait√©es.&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;io_uring&lt;/span&gt; : utilisation de la m√©thode &amp;#8220;&lt;a href=&#34;https://en.wikipedia.org/wiki/Io_uring&#34;&gt;io_uring&lt;/a&gt;&amp;#8221; qui consiste, depuis la version 5.1 du kernel Linux, √† utiliser des &amp;#8220;shared ring buffers&amp;#8221;. Ce proc√©d√© utilise des &amp;#8220;queue rings&amp;#8221; entre PostgreSQL et le kernel , avec &amp;#8220;completion queue&amp;#8221; pour la partie kernel et &amp;#8220;submission queue&amp;#8221; g√©r√© pour les demandes PostgreSQL.&lt;br /&gt;&#xA;Je vous invite √† lire &lt;a href=&#34;https://www.phoronix.com/news/Linux-io_uring-Fast-Efficient&#34;&gt;cet article&lt;/a&gt; pour plus de pr√©cisions sur ce m√©canisme.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;io_worker&lt;/strong&gt; repr√©sentant le nombre de process en parall√®le qui vont traiter les demandes de mise en cache des pages.&lt;br /&gt;&#xA;Par d√©faut, le nombre est de 3, mais nous pouvons monter au-del√†.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;effective_io_concurrency&lt;/strong&gt; est d√©j√† pr√©sent sur les anciennes versions de PostgreSQL. Cependant, dans le cas des IO asychrones (io_method=worker ou io_methode=io_uring), les IO se font en concurrence directement dans PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;io_combine_limit&lt;/strong&gt; est la taille maximale d&amp;#8217;IO.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;&lt;span style=&#34;color: #ff6600;&#34;&gt;Syst√®me&lt;/span&gt;&lt;/h4&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;V√©rifier que votre serveur Linux est compatible avec la m√©thode &amp;#8220;io_uring&amp;#8221;. Pour cela ex√©cuter cette commande, qui doit vous renvoyer 0&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;$ cat /proc/sys/kernel/io_uring_disabled&#xD;&#xA;0&lt;/pre&gt;&#xA;&lt;p&gt;Sinon, forcer la valeur √† 0, sous &amp;#8220;root&amp;#8221;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;# echo 0 &amp;gt; /proc/sys/kernel/io_uring_disabled&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;La validation peut se faire √©galement sur la configuration du kernel au d√©marrage&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; # cat /boot/config-6.12.48+deb13-cloud-amd64 | grep -i io_uring&#xD;&#xA;CONFIG_IO_URING=y&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;&lt;span style=&#34;color: #ff6600;&#34;&gt;PostgreSQL&lt;/span&gt;&lt;/h4&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour utiliser le mode &amp;#8220;&lt;strong&gt;io_method=&lt;span style=&#34;color: #3366ff;&#34;&gt;io_uring&lt;/span&gt;&lt;/strong&gt;&amp;#8220;, il faudra compiler PostgreSQL 18 avec ce mode -&amp;gt; &lt;strong&gt;with-liburing&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il faut donc r√©cup√©rer les sources depuis le site officiel &lt;a href=&#34;https://www.postgresql.org/ftp/source/v18.1/&#34;&gt;PostgreSQL&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Puis configurer avec l&amp;#8217;option suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;# ./configure --with-liburing&#xD;&#xA;# make&#xD;&#xA;# make install&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Benchmark&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour nos tests, nous utilisons l&amp;#8217;outil &amp;#8220;pgbench&amp;#8221;.&lt;br /&gt;&#xA;Nous allons cr√©er un jeu de test avec un facteur de 500 sur le nombre de lignes cr√©√©es par d√©faut dans les tables. Notre plus grosse table &amp;#8220;pgbench_accounts&amp;#8221; devrait donc d√©passer les 50M de lignes.&lt;/p&gt;&#xA;&lt;p&gt;Attention, chaque test se fait avec donn√©es &amp;#8220;√† froid&amp;#8221;. Le cache est vid√© √† chaque interrogation. C&amp;#8217;est √† la premi√®re ex√©cution que le test est le plus repr√©sentatif car PostgreSQL n&amp;#8217;a pas de pages dans son cache et doit donc solliciter le kernel.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;$ pgbench -i pgbench -s 500&#xD;&#xA;dropping old tables...&#xD;&#xA;NOTICE: table &amp;quot;pgbench_accounts&amp;quot; does not exist, skipping&#xD;&#xA;NOTICE: table &amp;quot;pgbench_branches&amp;quot; does not exist, skipping&#xD;&#xA;NOTICE: table &amp;quot;pgbench_history&amp;quot; does not exist, skipping&#xD;&#xA;NOTICE: table &amp;quot;pgbench_tellers&amp;quot; does not exist, skipping&#xD;&#xA;creating tables...&#xD;&#xA;generating data (client-side)...&#xD;&#xA;vacuuming...&#xD;&#xA;creating primary keys...&#xD;&#xA;done in 42.40 s (drop tables 0.00 s, create tables 0.01 s, client-side generate 25.13 s, vacuum 3.35 s, primary keys 13.92 s).&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;La suite consiste √† lancer un &amp;#8220;SELECT COUNT&amp;#8221; sur la table &amp;#8220;pgbench_accounts&amp;#8221; et relever les temps d&amp;#8217;ex√©cution entre les diff√©rentes versions de PostgreSQL et les diff√©rentes m√©thodes de lectures asynchrones.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;PostgreSQL 17&lt;/h4&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;$  select count(abalance) from &amp;quot;pgbench_accounts&amp;quot;;&#xD;&#xA;count&#xD;&#xA;----------&#xD;&#xA;50000000&#xD;&#xA;(1 row)&#xD;&#xA;&#xD;&#xA;Time: 48937.120 ms (00:48.937)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous mettons un peu plus de 49 secondes pour compter les 50M de lignes de la table.&lt;/p&gt;&#xA;&lt;p&gt;le plan d&amp;#8217;ex√©cution est le suivant&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;$  explain (analyze, buffers) select count(abalance) from &amp;quot;pgbench_accounts&amp;quot;;&#xD;&#xA;QUERY PLAN&#xD;&#xA;-------------------------------------------------------------------------------------------------------------------------------------------------------------&#xD;&#xA;Finalize Aggregate (cost=1081089.88..1081089.89 rows=1 width=8) (actual time=69053.114..69053.219 rows=1 loops=1)&#xD;&#xA;Buffers: shared hit=2518 read=817155&#xD;&#xA;- Gather (cost=1081089.67..1081089.88 rows=2 width=8) (actual time=69051.505..69053.209 rows=3 loops=1)&#xD;&#xA;Workers Planned: 2&#xD;&#xA;Workers Launched: 2&#xD;&#xA;Buffers: shared hit=2518 read=817155&#xD;&#xA;- Partial Aggregate (cost=1080089.67..1080089.68 rows=1 width=8) (actual time=69021.569..69021.571 rows=1 loops=3)&#xD;&#xA;Buffers: shared hit=2518 read=817155&#xD;&#xA;- Parallel Seq Scan on pgbench_accounts (cost=0.00..1028006.33 rows=20833333 width=4) (actual time=4.259..41669.680 rows=16666667 loops=3)&#xD;&#xA;Buffers: shared hit=2518 read=817155&#xD;&#xA;Planning Time: 0.056 ms&#xD;&#xA;Execution Time: 69053.251 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le &amp;#8220;parallel seq scan&amp;#8221; sur &amp;#8220;pgbench_accounts&amp;#8221; est fait avec 2 workers en parall√®le.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;PostgreSQL 18&lt;/h4&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Avec la valeur &amp;#8220;&lt;strong&gt;io_methode=sync&lt;/strong&gt;&amp;#8220;, nous retrouvons √† peu pr√®s le m√™me temps, m√™me si notre serveur sur PostgreSQL 18 est peu plus puissant et dispose de plus de RAM.Le &amp;#8220;shared_buffer&amp;#8221; a √©t√© taill√© en cons√©quence.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;pgbench=# select count(abalance) from &amp;quot;pgbench_accounts&amp;quot;;&#xD;&#xA;count&#xD;&#xA;----------&#xD;&#xA;10000000&#xD;&#xA;(1 row)&#xD;&#xA;&#xD;&#xA;Time: 49704.009 ms (00:49.704)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;le plan est √† peu pr√®s le m√™me avec nos 2 workers effectuant du &amp;#8220;parallel seq scan&amp;#8221; sur &amp;#8220;pgbench_accounts&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;  - Parallel Seq Scan on public.pgbench_accounts (cost=0.00..205601.67 rows=4166667 width=4) (actual time=0.838..42937.512 rows=3333333.33 loops=3)&#xD;&#xA;Output: aid, bid, abalance, filler&#xD;&#xA;Buffers: shared read=163935&#xD;&#xA;Buffers: shared read=54826&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Avec &amp;#8220;&lt;strong&gt;io_method=worker&lt;/strong&gt;&amp;#8221; = 3, l√†, nous gagnons d√©j√† quelques secondes en terme de temps d&amp;#8217;ex√©cution puisque notre requ√™te est proche des 40 sec.&lt;/p&gt;&#xA;&lt;p&gt;Puis avec &amp;#8220;&lt;strong&gt;io_method=io_uring&lt;/strong&gt;&amp;#8220;, c&amp;#8217;est l√† que nous sommes le plus performant puisque nous descendons √† moins de 25 secondes.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous obtenons les r√©sultats suivants&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone wp-image-10753 size-full&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/temps-2.jpg&#34; alt=&#34;&#34; width=&#34;629&#34; height=&#34;368&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/11/temps-2.jpg 629w, https://blog.capdata.fr/wp-content/uploads/2025/11/temps-2-300x176.jpg 300w&#34; sizes=&#34;auto, (max-width: 629px) 100vw, 629px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A noter que pendant des op√©rations de lectures asynchrones, nous pouvons suivre l&amp;#8217;√©volution de celles ci via la vue &amp;#8216;&lt;strong&gt;pg_aios&lt;/strong&gt;&amp;#8221; mise √† disposition par PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;$  select * from pg_aios;&#xD;&#xA;pid | io_id | io_generation | state | operation | off | length | target | handle_data_len | raw_result | result | target_desc | f_sync | f_localmem | f_buffered&#xD;&#xA;-------+-------+---------------+-----------+-----------+-----------+--------+--------+-----------------+------------+---------+--------------------------------------------------+--------+------------+------------&#xD;&#xA;41329 | 192 | 9233 | SUBMITTED | readv | 570818560 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200752..200767 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 193 | 9290 | SUBMITTED | readv | 570556416 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200720..200735 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 194 | 9239 | SUBMITTED | readv | 570949632 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200768..200783 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 195 | 9229 | SUBMITTED | readv | 570687488 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200736..200751 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 197 | 9225 | SUBMITTED | readv | 571473920 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200832..200847 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 198 | 6372 | SUBMITTED | readv | 569638912 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200608..200623 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 200 | 6420 | SUBMITTED | readv | 571080704 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200784..200799 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 201 | 9247 | SUBMITTED | readv | 571211776 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200800..200815 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 202 | 9248 | SUBMITTED | readv | 571604992 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200848..200863 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 203 | 9221 | SUBMITTED | readv | 569769984 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200624..200639 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 207 | 9223 | SUBMITTED | readv | 569507840 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200592..200607 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 208 | 9226 | SUBMITTED | readv | 571736064 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200864..200879 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;41329 | 210 | 282085 | SUBMITTED | readv | 571342848 | 131072 | smgr | 16 | NULL | UNKNOWN | blocks 200816..200831 in file &amp;quot;base/16440/16456&amp;quot; | f | f | t&#xD;&#xA;(13 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Cette vue est aliment√©e via la fonction &amp;#8216;&lt;strong&gt;pg_get_aios&amp;#8221;&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Nous pouvons voir l&amp;#8217;offset de la page sur laquelle la lecture pointe ainsi que la longueur de l&amp;#8217;op√©ration IO en cours.&lt;/p&gt;&#xA;&lt;h2&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;Pour profiter de l&amp;#8217;efficacit√© des lectures asynchrones, ne pas oublier de configurer la valeur de &amp;#8220;&lt;strong&gt;io_method&lt;/strong&gt;&amp;#8221; √† &amp;#8220;&lt;strong&gt;worker&lt;/strong&gt;&amp;#8221; ou &amp;#8220;&lt;strong&gt;io_uring¬†&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;A volumes √©quivalents, les plans d&amp;#8217;ex√©cutions nous permettent de voir que l&amp;#8217;on traite un nombre de &amp;#8220;shared read&amp;#8221; similaire entre PostgreSQL 18 qu&amp;#8217;avec PostgreSQL 17 mais avec un temps plus faible pour PostgreSQL 18.&lt;/p&gt;&#xA;&lt;p&gt;Attention cependant, les gains sont effectifs sur les op√©rations de type &amp;#8220;seq scan&amp;#8221; ou &amp;#8220;bitmap heap scan&amp;#8221;. Pas de gain possible sur des op√©rations d&amp;#8217;√©critures.&lt;/p&gt;&#xA;&lt;p&gt;En d&amp;#8217;autres termes, la configuration Asynchrones IO sera parfaitement adapt√©e pour des requ√™tes d√©cisionnelles avec datawarehouse volumineux.&lt;/p&gt;&#xA;&lt;p&gt;Autre point √† savoir, il a √©t√© relev√© √©galement des risques en terme de s√©curit√© avec le mode &lt;strong&gt;io_uring&lt;/strong&gt; configur√© dans le kernel.&lt;br /&gt;&#xA;Certains sites comme &lt;a href=&#34;https://www.upwind.io/feed/io_uring-linux-performance-boost-or-security-headache&#34;&gt;celui-ci&lt;/a&gt; font √©tats de potentiels processus de type &amp;#8220;malwares&amp;#8221; qui pourraient s&amp;#8217;attaquer au kernel et mettre en p√©ril la s√©curit√© du serveur.&lt;/p&gt;&#xA;&lt;p&gt;Sur l&amp;#8217;&lt;a href=&#34;https://en.wikipedia.org/wiki/Io_uring&#34;&gt;article Wikip√©dia&lt;/a&gt; d√©di√© √† &amp;#8220;&lt;strong&gt;io_uring&lt;/strong&gt;&amp;#8220;, il est d&amp;#8217;ailleurs not√© -&amp;gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;&amp;#8220;In June 2023, Google&amp;#8217;s security team reported that 60% of the¬†&lt;a title=&#34;Exploit (computer security)&#34; href=&#34;https://en.wikipedia.org/wiki/Exploit_(computer_security)&#34;&gt;exploits&lt;/a&gt;¬†submitted to their¬†&lt;a title=&#34;Bug bounty program&#34; href=&#34;https://en.wikipedia.org/wiki/Bug_bounty_program&#34;&gt;bug bounty program&lt;/a&gt;¬†in 2022 were exploits of the Linux kernel&amp;#8217;s io_uring vulnerabilities. As a result,¬†&lt;code&gt;io_uring&lt;/code&gt;¬†was disabled for apps in¬†&lt;a title=&#34;Android (operating system)&#34; href=&#34;https://en.wikipedia.org/wiki/Android_(operating_system)&#34;&gt;Android&lt;/a&gt;, and disabled entirely in¬†&lt;a title=&#34;ChromeOS&#34; href=&#34;https://en.wikipedia.org/wiki/ChromeOS&#34;&gt;ChromeOS&lt;/a&gt;¬†as well as Google servers.&lt;sup id=&#34;cite_ref-12&#34; class=&#34;reference&#34;&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Io_uring#cite_note-12&#34;&gt;&lt;span class=&#34;cite-bracket&#34;&gt;[&lt;/span&gt;11&lt;span class=&#34;cite-bracket&#34;&gt;]&lt;/span&gt;&lt;/a&gt;&lt;/sup&gt;¬†&lt;a title=&#34;Docker (software)&#34; href=&#34;https://en.wikipedia.org/wiki/Docker_(software)&#34;&gt;Docker&lt;/a&gt;¬†also consequently disabled io_uring from their default¬†&lt;a title=&#34;Seccomp&#34; href=&#34;https://en.wikipedia.org/wiki/Seccomp&#34;&gt;seccomp&lt;/a&gt; profile&amp;#8221;&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonne fin de journ√©e !&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : pr√©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 d√©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien √©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; rel=&#34;bookmark&#34; title=&#34;26 f√©vrier 2025&#34;&gt;PostgreSQL : optimiser vos op√©rations vacuum et analyze !&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-pg_stat_statements-avec-postgresql-15/&#34; rel=&#34;bookmark&#34; title=&#34;16 mars 2023&#34;&gt;Nouveaut√©s pg_stat_statements avec PostgreSQL 15&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34; rel=&#34;bookmark&#34; title=&#34;13 mai 2025&#34;&gt;PostgreSQL Basics : lire un plan d&amp;#8217;ex√©cution comme un¬∑e pro (ou presque)&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.258 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10742&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10742&amp;#038;title=PostgreSQL%2018%20%3A%20des%20IO%20asynchrones%20performantes%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2018%20%3A%20des%20IO%20asynchrones%20performantes%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10742&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-18-des-io-asynchrones-performantes/&#34;&gt;PostgreSQL 18 : des IO asynchrones performantes !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-18-des-io-asynchrones-performantes/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&amp;#160; Le 25 septembre dernier, PostgreSQL sortait sa toute derni√®re version, PostgreSQL 18. Cette version apporte de nombreux correctifs mais aussi des nouveaut√©s et des am√©liorations sur les performances globales. Une nouveaut√© est particuli√®rement pertinente pour cette version. Il s&amp;#8217;agit&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-18-des-io-asynchrones-performantes/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-18-des-io-asynchrones-performantes/&#34;&gt;PostgreSQL 18 : des IO asynchrones performantes !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Basics : lire un plan d‚Äôex√©cution comme un¬∑e pro (ou presque)</title>
    <updated>2025-05-13T15:20:05Z</updated>
    <id>tag:blog.capdata.fr,2025-05-13:/index.php/postgresql-basics-lire-un-plan-dexecution/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;title=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h1&gt;Introduction :&lt;/h1&gt;&#xA;&lt;p&gt;Quand une requ√™te PostgreSQL est consid√©r√©e comme lente ou que ses performances se d√©gradent soudainement, il y a un r√©flexe √† toujours avoir : utiliser les plans d&amp;#8217;ex√©cution. Je n‚Äôapprends certainement rien √† la majorit√© des personnes qui liront cet article, mais si cela permet de garder vigilants les d√©butants et de leur enseigner quelques ficelles, alors cet article vaut le coup.&lt;/p&gt;&#xA;&lt;p&gt;Si vous avez d√©j√† √©t√© dans le cas de figure o√π un plan d&amp;#8217;ex√©cution est trop gros pour que vous sachiez par quel bout le prendre, ou si vous avez l&amp;#8217;impression qu&amp;#8217;on vous parle chinois quand on √©voque les index scan ou les &amp;#8220;cost&amp;#8221; d&amp;#8217;une requ√™te, alors vous √™tes au bon endroit.&lt;/p&gt;&#xA;&lt;p&gt;Dans cet article, premier d&amp;#8217;une s√©rie sur les bases de PostgreSQL, nous allons d√©mystifier l&amp;#8217;optimisation des requ√™tes en utilisant EXPLAIN comme point de d√©part, et les plans d&amp;#8217;ex√©cution g√©n√©r√©s comme fil conducteur.&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôobjectif : vous aider √† identifier rapidement les informations cl√©s, rep√©rer les goulots d‚Äô√©tranglement, et gagner en autonomie pour diagnostiquer les performances de vos requ√™tes.&lt;/p&gt;&#xA;&lt;p&gt;C‚Äôest parti !&lt;/p&gt;&#xA;&lt;h2&gt;EXPLAIN ANALYZE : c‚Äôest quoi exactement et pourquoi l‚Äôutiliser ?&lt;/h2&gt;&#xA;&lt;p&gt;Pour commencer, il faut savoir qu&amp;#8217;un moteur de base de donn√©es, que ce soit PostgreSQL ou un autre ne &amp;#8220;lit&amp;#8221; pas une requ√™te comme un humain pourrait la lire, de gauche √† droite. Il √©labore plut√¥t un plan d&amp;#8217;ex√©cution : il cr√©√© un ensemble d&amp;#8217;√©tape qui se veulent le plus optimis√©es possible pour aller chercher les donn√©es que vous lui demander de la fa√ßon la plus efficace possible.&lt;/p&gt;&#xA;&lt;p&gt;Il y a un moyen simple de voir ce plan d&amp;#8217;ex√©cution, c&amp;#8217;est d&amp;#8217;utiliser la commande EXPLAIN ANALYZE. Elle nous permet en plus de comprendre de quelle fa√ßon le moteur √† r√©ellement ex√©cut√© notre ordre SQL (et pas seulement comment il pensait le faire). C&amp;#8217;est un peu comme lire un journal de bord de l&amp;#8217;ex√©cution de la requ√™te.&lt;/p&gt;&#xA;&lt;h3&gt;Prenons un exemple simple :&lt;/h3&gt;&#xA;&lt;p&gt;Imaginons que nous avons une table users, constitu√©e comme tel :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;CREATE TABLE users (&#xD;&#xA;id integer PRIMARY KEY,&#xD;&#xA;name vachar(30),&#xD;&#xA;age integer,&#xD;&#xA;email varchar(80) );&lt;/pre&gt;&#xA;&lt;p&gt;Et que nous souhaitons utiliser la requ√™te suivante dans notre application :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;SELECT * FROM users WHERE email = &#39;foo@example.com&#39;;&lt;/pre&gt;&#xA;&lt;p&gt;Sur cette table, nous n&amp;#8217;avons pas d&amp;#8217;index. Voici donc ce √† quoi pourrait ressembler notre plan d&amp;#8217;√©xecution si nous utilisons la commande :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;EXPLAIN ANALYZE SELECT * FROM users WHERE email = &#39;foo@example.com&#39;;&#xD;&#xA;&#xD;&#xA;Seq Scan on users (cost=0.00..35.50 rows=1 width=100)&#xD;&#xA;Filter: (email = &#39;foo@example.com&#39;)&#xD;&#xA;Rows Removed by Filter: 999&#xD;&#xA;Actual time=0.010..0.420 rows=1 loops=1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Les termes du plan d&amp;#8217;ex√©cution :&lt;/h3&gt;&#xA;&lt;p&gt;A premi√®re vue, il n&amp;#8217;est pas √©vident de comprendre tout les termes que l&amp;#8217;on voit dans le plan d&amp;#8217;ex√©cution g√©n√©r√©.&lt;/p&gt;&#xA;&lt;p&gt;Voici un r√©capitulatif des principaux :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Seq Scan / Index Scan :&lt;/strong&gt; Le type de parcours utilis√© (s√©quentiel ou via un index)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;cost=‚Ä¶ :&lt;/strong&gt; Estimation du &amp;#8220;co√ªt&amp;#8221; total de l‚Äôop√©ration, selon PostgreSQL. Le co√ªt n&amp;#8217;est pas exprim√© dans une unit√© particuli√®re, c&amp;#8217;est juste un indicatif. Plus il est √©lev√©, plus l&amp;#8217;op√©ration est &amp;#8220;co√ªteuse&amp;#8221;, notre but √©tant d&amp;#8217;√©viter les co√ªts √©normes pour que tout soit plus simple.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;rows=‚Ä¶ :&lt;/strong&gt; Estimation du nombre de lignes que l&amp;#8217;√©tape va retourner&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;actual time=‚Ä¶ :&lt;/strong&gt; Le temps r√©el que cette √©tape a pris (en millisecondes)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Rows Removed by Filter :&lt;/strong&gt; Nombre de lignes lues mais √©limin√©es par un filtre&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;loops=1 :&lt;/strong&gt; Nombre de fois que cette √©tape a √©t√© ex√©cut√©e (ex. dans une boucle)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3&gt;Puis un exemple plus compliqu√© :&lt;/h3&gt;&#xA;&lt;p&gt;Attention, tout les plans d&amp;#8217;ex√©cution de requ√™te ne sont pas aussi simples que celui que je viens de vous pr√©senter. Bien souvent ils se pr√©sentent sous la forme de plusieurs n≈ìuds indent√©s¬† qu&amp;#8217;il faut lire dans le bon ordre. Imaginons une nouvelle table orders qui r√©pertorie les commandes pass√©es par un user :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;CREATE TABLE orders (&#xD;&#xA;id_orders integer PRIMARY KEY,&#xD;&#xA;created_at timestamp,&#xD;&#xA;total numeric,&#xD;&#xA;status text,&#xD;&#xA;user_id integer references users(id));&lt;/pre&gt;&#xA;&lt;p&gt;Nous pouvons alors imaginer la requ√™te suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;SELECT u.name, o.total, o.created_at&#xD;&#xA;FROM users u&#xD;&#xA;JOIN orders o ON u.id = o.user_id&#xD;&#xA;WHERE o.status = &#39;completed&#39;&#xD;&#xA;ORDER BY o.created_at DESC&#xD;&#xA;LIMIT 10;&lt;/pre&gt;&#xA;&lt;p&gt;Qui remonte les dix premi√®res commandes,¬† avec le nom de l&amp;#8217;acheteur, le total de la commande et sa date, pour les 10 premi√®res commandes dans l&amp;#8217;ordre des dates dont le statut est &amp;#8220;completed&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Si on execute un explain analyze sur cette requ√™te, on obtient un plan d&amp;#8217;execution de cet ordre :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; Limit (cost=123.45..123.48 rows=10 width=40) (actual time=1.234..1.239 rows=10 loops=1)&#xD;&#xA;   -&amp;amp;gt; Sort (cost=123.45..130.00 rows=2620 width=40) (actual time=1.234..1.236 rows=10 loops=1)&#xD;&#xA;      Sort Key: o.created_at DESC&#xD;&#xA;      Sort Method: top-N heapsort Memory: 25kB&#xD;&#xA;       -&amp;amp;gt; Nested Loop (cost=0.42..100.00 rows=2620 width=40) (actual time=0.045..0.980 rows=200 loops=1)&#xD;&#xA;            -&amp;amp;gt; Index Scan using idx_orders_created_at on orders o (cost=0.29..45.00 rows=2620 width=24) (actual time=0.030..0.340 rows=200 loops=1)&#xD;&#xA;                 Filter: (status = &#39;completed&#39;)&#xD;&#xA;                 Rows Removed by Filter: 50&#xD;&#xA;            -&amp;amp;gt; Index Scan using users_pkey on users u (cost=0.13..0.20 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=200)&#xD;&#xA;                 Index Cond: (id = o.user_id)&lt;/pre&gt;&#xA;&lt;p&gt;Si on devait visualiser ce plan d&amp;#8217;ex√©cution de mani√®re graphique pour qu&amp;#8217;il soit plus simple √† lire, √ßa donnerait √ßa :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX.png&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone wp-image-10701&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-300x170.png&#34; alt=&#34;&#34; width=&#34;508&#34; height=&#34;288&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-300x170.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-768x434.png 768w, https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX.png 853w&#34; sizes=&#34;auto, (max-width: 508px) 100vw, 508px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3&gt;Comment lire un plan d&amp;#8217;ex√©cution :&lt;/h3&gt;&#xA;&lt;p&gt;Pour lire un plan d&amp;#8217;ex√©cution, on part toujours du n≈ìud le plus indent√©, puis on remonte vers les n≈ìuds sup√©rieur. Dans notre cas, on partirais des deux index scan pour remonter ensuite sur le Nested Loop, puis sur le Sort, et enfin sur le Limit.&lt;br /&gt;&#xA;La raison est simple : le plan d‚Äôex√©cution refl√®te l‚Äôordre r√©el d‚Äôex√©cution de la requ√™te par PostgreSQL.&lt;br /&gt;&#xA;Chaque √©tape du plan consomme les r√©sultats produits par les √©tapes pr√©c√©dentes. Autrement dit : PostgreSQL commence par les op√©rations de lecture (acc√®s aux tables, scans d‚Äôindex&amp;#8230;), puis applique les jointures, les filtres, les tris, etc. en remontant vers le haut du plan.&lt;br /&gt;&#xA;Le n≈ìud le plus &amp;#8220;haut&amp;#8221; du plan (celui avec le moins d‚Äôindentation) correspond √† l‚Äôop√©ration finale, celle qui retourne les r√©sultats √† l‚Äôutilisateur. Les blocs en dessous (plus indent√©s) sont les d√©pendances n√©cessaires pour y arriver.&lt;br /&gt;&#xA;C‚Äôest donc une logique de pipeline de traitement :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;Lire les donn√©es&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les filtrer&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les combiner&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les trier / agr√©ger&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les retourner&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Lire un plan d‚Äôex√©cution &amp;#8220;du plus profond vers le haut&amp;#8221;, c‚Äôest suivre le chemin de vie d‚Äôune ligne de r√©sultat depuis le disque jusqu‚Äô√† votre terminal.&lt;/p&gt;&#xA;&lt;h3&gt;Petite encyclop√©die des n≈ìuds les plus courants dans un plan d‚Äôex√©cution&lt;/h3&gt;&#xA;&lt;p&gt;Voici une s√©lection des n≈ìuds que vous croiserez r√©guli√®rement dans les plans d‚Äôex√©cution PostgreSQL, avec une explication simple et directe pour chacun :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;251&#34; data-end=&#34;420&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;253&#34; data-end=&#34;420&#34;&gt;&lt;strong data-start=&#34;253&#34; data-end=&#34;265&#34;&gt;Seq Scan&lt;/strong&gt;&lt;br data-start=&#34;265&#34; data-end=&#34;268&#34; /&gt;Lecture s√©quentielle de toute la table.&lt;br data-start=&#34;309&#34; data-end=&#34;312&#34; /&gt;&lt;em data-start=&#34;317&#34; data-end=&#34;331&#34;&gt;√Ä surveiller&lt;/em&gt; : Normal sur petites tables, mais sur les grosses, cela peut indiquer un index manquant.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;422&#34; data-end=&#34;607&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;424&#34; data-end=&#34;607&#34;&gt;&lt;strong data-start=&#34;424&#34; data-end=&#34;438&#34;&gt;Index Scan&lt;/strong&gt;&lt;br data-start=&#34;438&#34; data-end=&#34;441&#34; /&gt;Parcours d‚Äôun index pour chercher les lignes correspondantes.&lt;br data-start=&#34;504&#34; data-end=&#34;507&#34; /&gt;&lt;em data-start=&#34;512&#34; data-end=&#34;526&#34;&gt;√Ä surveiller&lt;/em&gt; : Rapide si l‚Äôindex est bien choisi. Peut devenir lent avec beaucoup de &lt;em data-start=&#34;599&#34; data-end=&#34;606&#34;&gt;loops&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;609&#34; data-end=&#34;804&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;611&#34; data-end=&#34;804&#34;&gt;&lt;strong data-start=&#34;611&#34; data-end=&#34;630&#34;&gt;Index Only Scan&lt;/strong&gt;&lt;br data-start=&#34;630&#34; data-end=&#34;633&#34; /&gt;Comme un Index Scan, mais sans lire la table si toutes les colonnes n√©cessaires sont d√©j√† dans l‚Äôindex.&lt;br data-start=&#34;740&#34; data-end=&#34;743&#34; /&gt;&lt;em data-start=&#34;748&#34; data-end=&#34;762&#34;&gt;√Ä surveiller&lt;/em&gt; : Ultra-performant ! √Ä viser si possible.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;806&#34; data-end=&#34;1031&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;808&#34; data-end=&#34;1031&#34;&gt;&lt;strong data-start=&#34;808&#34; data-end=&#34;829&#34;&gt;Bitmap Index Scan&lt;/strong&gt; + &lt;strong data-start=&#34;832&#34; data-end=&#34;852&#34;&gt;Bitmap Heap Scan&lt;/strong&gt;&lt;br data-start=&#34;852&#34; data-end=&#34;855&#34; /&gt;PostgreSQL construit une &amp;#8220;carte&amp;#8221; des lignes √† lire, puis les r√©cup√®re en une seule passe.&lt;br data-start=&#34;946&#34; data-end=&#34;949&#34; /&gt;&lt;em data-start=&#34;954&#34; data-end=&#34;968&#34;&gt;√Ä surveiller&lt;/em&gt; : Tr√®s performant pour des filtres avec beaucoup de r√©sultats.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1033&#34; data-end=&#34;1244&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1035&#34; data-end=&#34;1244&#34;&gt;&lt;strong data-start=&#34;1035&#34; data-end=&#34;1050&#34;&gt;Nested Loop&lt;/strong&gt;&lt;br data-start=&#34;1050&#34; data-end=&#34;1053&#34; /&gt;Pour chaque ligne de la premi√®re table, PostgreSQL cherche dans la seconde.&lt;br data-start=&#34;1130&#34; data-end=&#34;1133&#34; /&gt;&lt;em data-start=&#34;1138&#34; data-end=&#34;1152&#34;&gt;√Ä surveiller&lt;/em&gt; : Bien sur de petits volumes, mais peut exploser sur de grandes tables (effet quadratique).&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1246&#34; data-end=&#34;1445&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1248&#34; data-end=&#34;1445&#34;&gt;&lt;strong data-start=&#34;1248&#34; data-end=&#34;1261&#34;&gt;Hash Join&lt;/strong&gt;&lt;br data-start=&#34;1261&#34; data-end=&#34;1264&#34; /&gt;PostgreSQL construit une table de hachage en m√©moire pour faire la jointure.&lt;br data-start=&#34;1342&#34; data-end=&#34;1345&#34; /&gt;&lt;em data-start=&#34;1350&#34; data-end=&#34;1364&#34;&gt;√Ä surveiller&lt;/em&gt; : Performant si la m√©moire le permet. Attention √† la taille des jeux de donn√©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1447&#34; data-end=&#34;1621&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1449&#34; data-end=&#34;1621&#34;&gt;&lt;strong data-start=&#34;1449&#34; data-end=&#34;1463&#34;&gt;Merge Join&lt;/strong&gt;&lt;br data-start=&#34;1463&#34; data-end=&#34;1466&#34; /&gt;Jointure optimis√©e entre deux sources d√©j√† tri√©es.&lt;br data-start=&#34;1518&#34; data-end=&#34;1521&#34; /&gt;&lt;em data-start=&#34;1526&#34; data-end=&#34;1540&#34;&gt;√Ä surveiller&lt;/em&gt; : Excellent en perfs si les colonnes jointes sont index√©es ou tri√©es √† l‚Äôavance.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1623&#34; data-end=&#34;1794&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1625&#34; data-end=&#34;1794&#34;&gt;&lt;strong data-start=&#34;1625&#34; data-end=&#34;1638&#34;&gt;Aggregate&lt;/strong&gt;&lt;br data-start=&#34;1638&#34; data-end=&#34;1641&#34; /&gt;Calcule une agr√©gation (COUNT, SUM, AVG, &amp;#8230;).&lt;br data-start=&#34;1696&#34; data-end=&#34;1699&#34; data-is-only-node=&#34;&#34; /&gt;&lt;em data-start=&#34;1704&#34; data-end=&#34;1718&#34;&gt;√Ä surveiller&lt;/em&gt; : Peut √™tre co√ªteux si l‚Äôagr√©gation se fait sur de gros volumes sans index.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1796&#34; data-end=&#34;1959&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1798&#34; data-end=&#34;1959&#34;&gt;&lt;strong data-start=&#34;1798&#34; data-end=&#34;1806&#34;&gt;Sort&lt;/strong&gt;&lt;br data-start=&#34;1806&#34; data-end=&#34;1809&#34; /&gt;Trie les donn√©es selon une ou plusieurs colonnes.&lt;br data-start=&#34;1860&#34; data-end=&#34;1863&#34; /&gt;&lt;em data-start=&#34;1868&#34; data-end=&#34;1882&#34;&gt;√Ä surveiller&lt;/em&gt; : Peut consommer beaucoup de m√©moire ; un bon index peut √©viter cette √©tape.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1961&#34; data-end=&#34;2136&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1963&#34; data-end=&#34;2136&#34;&gt;&lt;strong data-start=&#34;1963&#34; data-end=&#34;1972&#34;&gt;Limit&lt;/strong&gt;&lt;br data-start=&#34;1972&#34; data-end=&#34;1975&#34; /&gt;Tronque le r√©sultat √† N lignes.&lt;br data-start=&#34;2010&#34; data-end=&#34;2013&#34; /&gt;&lt;em data-start=&#34;2018&#34; data-end=&#34;2032&#34;&gt;√Ä surveiller&lt;/em&gt; : Tr√®s utile combin√© avec ORDER BY, car PostgreSQL peut s‚Äôarr√™ter d√®s qu‚Äôil a assez de lignes tri√©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2138&#34; data-end=&#34;2327&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2140&#34; data-end=&#34;2327&#34;&gt;&lt;strong data-start=&#34;2140&#34; data-end=&#34;2152&#34;&gt;CTE Scan&lt;/strong&gt;&lt;br data-start=&#34;2152&#34; data-end=&#34;2155&#34; /&gt;Utilis√© quand vous avez une clause WITH¬†(CTE ‚Äì Common Table Expression).&lt;br data-start=&#34;2231&#34; data-end=&#34;2234&#34; /&gt;&lt;em data-start=&#34;2239&#34; data-end=&#34;2253&#34;&gt;√Ä surveiller&lt;/em&gt; : Si le CTE n‚Äôest pas mat√©rialis√©, il peut √™tre recalcul√© √† chaque appel.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Options utiles de EXPLAIN / EXPLAIN ANALYZE&lt;/h2&gt;&#xA;&lt;p&gt;La commande EXPLAIN (et sa variante EXPLAIN ANALYZE) peut √™tre enrichie avec plusieurs options facultatives pour mieux comprendre ce que PostgreSQL fait avec vos requ√™tes. Voici une pr√©sentation des principales.&lt;/p&gt;&#xA;&lt;h4&gt;ANALYZE : ex√©cuter la requ√™te pour de vrai&lt;/h4&gt;&#xA;&lt;p&gt;Cette option (souvent appel√©e ‚ÄúEXPLAIN ANALYZE‚Äù) &lt;strong&gt;ex√©cute r√©ellement la requ√™te&lt;/strong&gt; et mesure les temps d&amp;#8217;ex√©cution.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN ANALYZE SELECT * FROM users WHERE email = &#39;foo@example.com&#39;; &lt;/pre&gt;&#xA;&lt;p&gt;Sans cette option, PostgreSQL ne fait qu‚Äôestimer le plan, il ne l‚Äôex√©cute pas r√©ellement.&lt;/p&gt;&#xA;&lt;h4&gt;VERBOSE: plus de d√©tails sur les colonnes et les expressions&lt;/h4&gt;&#xA;&lt;p&gt;Affiche le nom exact des colonnes internes et les expressions utilis√©es dans chaque √©tape du plan.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, VERBOSE) SELECT name FROM users WHERE age &amp;amp;gt; 30; &lt;/pre&gt;&#xA;&lt;p&gt;Tr√®s utile quand on travaille avec des fonctions, des agr√©gats ou des vues complexes.&lt;/p&gt;&#xA;&lt;h4&gt;BUFFERS : d√©tail des lectures m√©moire et disque&lt;/h4&gt;&#xA;&lt;p&gt;Montre combien de blocs de donn√©es ont √©t√© lus en m√©moire (cache partag√©) et depuis le disque.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM orders WHERE status = &#39;completed&#39;; &lt;/pre&gt;&#xA;&lt;p&gt;Id√©al pour identifier si une requ√™te est ralentie par des acc√®s disques trop nombreux.&lt;/p&gt;&#xA;&lt;h4&gt;WAL : suivi des √©critures dans le journal de transactions&lt;/h4&gt;&#xA;&lt;p&gt;Affiche l‚Äôimpact de la requ√™te sur le WAL (Write-Ahead Logging), c‚Äôest-√†-dire les √©critures n√©cessaires √† la durabilit√©.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, WAL) INSERT INTO logs SELECT * FROM events; &lt;/pre&gt;&#xA;&lt;p&gt;Surtout utile pour comprendre le co√ªt cach√© des requ√™tes d‚Äô√©criture.&lt;/p&gt;&#xA;&lt;h4&gt;COSTS : afficher ou masquer les co√ªts estim√©s&lt;/h4&gt;&#xA;&lt;p&gt;Permet de d√©sactiver les lignes cost=&amp;#8230; si on veut se concentrer uniquement sur les temps r√©els (actual time).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, COSTS OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Pratique pour all√©ger la lecture d‚Äôun plan quand on n‚Äôa pas besoin des estimations.&lt;/p&gt;&#xA;&lt;h4&gt;SETTINGS : voir les param√®tres ayant influenc√© le plan&lt;/h4&gt;&#xA;&lt;p&gt;Affiche les param√®tres de configuration de PostgreSQL qui ont eu un impact sur la g√©n√©ration du plan.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, SETTINGS) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Tr√®s utile pour le debug avanc√©, ou si certains param√®tres sont modifi√©s via SET.&lt;/p&gt;&#xA;&lt;h4&gt;SUMMARY : afficher ou non les temps globaux&lt;/h4&gt;&#xA;&lt;p&gt;Contr√¥le l‚Äôaffichage du r√©sum√© final (Planning Time, Execution Time).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, SUMMARY OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Par d√©faut activ√©, mais vous pouvez le d√©sactiver si vous ne souhaitez pas ces infos √† la fin du plan.&lt;/p&gt;&#xA;&lt;h4&gt;TIMING : activer ou d√©sactiver la mesure des temps internes&lt;/h4&gt;&#xA;&lt;p&gt;PostgreSQL mesure le actual time pour chaque n≈ìud du plan. Cette option permet de d√©sactiver ces mesures (utile pour les tr√®s petites requ√™tes ou les benchmarks massifs).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, TIMING OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;D√©sactive les mesures fines, ce qui peut l√©g√®rement am√©liorer les performances du plan d‚Äôanalyse lui-m√™me.&lt;/p&gt;&#xA;&lt;h4&gt;FORMAT : changer la sortie (TEXT, JSON, YAML)&lt;/h4&gt;&#xA;&lt;p&gt;Permet d‚Äôobtenir un plan dans un format structur√© (parfait pour les outils externes comme explain.dalibo.com).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, FORMAT JSON) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Pratique pour g√©n√©rer un plan visuel, l‚Äôanalyser en script, ou l‚Äôint√©grer dans des outils de perf.&lt;/p&gt;&#xA;&lt;h2&gt;OK super, mais une fois qu&amp;#8217;on sait √ßa, on en fait quoi ?&lt;/h2&gt;&#xA;&lt;p data-start=&#34;260&#34; data-end=&#34;525&#34;&gt;On pourrait passer des heures √† d√©cortiquer les diff√©rentes lignes d&amp;#8217;un plan d&amp;#8217;ex√©cution sans pour autant avancer plus que √ßa. L&amp;#8217;important est maintenant de savoir quoi en faire. Parce que c&amp;#8217;est bien beau de l&amp;#8217;afficher, encore faut-il savoir quoi y chercher.&lt;/p&gt;&#xA;&lt;p data-start=&#34;260&#34; data-end=&#34;525&#34;&gt;Voici une petite liste non exhaustive des indices √† rep√©rer dans un plan d&amp;#8217;ex√©cution qui pourraient vous mener √† une raison pour la lenteur de votre requ√™te :&lt;/p&gt;&#xA;&lt;h3&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f50e.png&#34; alt=&#34;üîé&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Une lecture s√©quentielle sur une grosse table :&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;659&#34; data-end=&#34;678&#34;&gt;&lt;strong data-start=&#34;659&#34; data-end=&#34;674&#34;&gt;Sympt√¥me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Seq Scan on users  (rows=100000)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;725&#34; data-end=&#34;755&#34;&gt;Pourquoi c‚Äôest un souci&lt;/strong&gt;&lt;br data-start=&#34;755&#34; data-end=&#34;758&#34; /&gt;PostgreSQL lit toute la table ligne par ligne. C‚Äôest tr√®s lent et parfaitement inutile, surtout si vous ne voulez que quelques lignes de cette table.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;861&#34; data-end=&#34;887&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;890&#34; data-end=&#34;992&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;890&#34; data-end=&#34;914&#34;&gt;On note la pr√©sence d&amp;#8217;un n≈ìud SEQ SCAN dans notre plan d&amp;#8217;ex√©cution&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;915&#34; data-end=&#34;992&#34;&gt;Nombre de lignes parcourues tr√®s √©lev√© (puce rows ou pr√©sence de row removed by filter)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;994&#34; data-end=&#34;1010&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1011&#34; data-end=&#34;1184&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1011&#34; data-end=&#34;1085&#34;&gt;Ajouter un index sur la colonne filtr√©e peut souvent aider dans ce genre de cas.&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1086&#34; data-end=&#34;1184&#34;&gt;R√©√©crire la requ√™te pour qu‚Äôelle utilise une clause mieux optimis√©e (exclusion, inclusion&amp;#8230;)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f50e.png&#34; alt=&#34;üîé&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Trop de Loop&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1242&#34; data-end=&#34;1261&#34;&gt;&lt;strong data-start=&#34;1242&#34; data-end=&#34;1257&#34;&gt;Sympt√¥me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Index Scan using users_pkey on users  (loops=10000)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1327&#34; data-end=&#34;1489&#34;&gt;&lt;strong data-start=&#34;1327&#34; data-end=&#34;1357&#34;&gt;Pourquoi c‚Äôest un souci&lt;/strong&gt;&lt;br data-start=&#34;1357&#34; data-end=&#34;1360&#34; /&gt;Une op√©ration lente est r√©p√©t√©e pour chaque ligne de l‚Äôop√©ration ext√©rieure, souvent dans une jointure en boucle (Nested Loop).&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1491&#34; data-end=&#34;1519&#34;&gt;&lt;strong data-start=&#34;1491&#34; data-end=&#34;1517&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1520&#34; data-end=&#34;1575&#34;&gt;&#xA;&lt;li data-start=&#34;1520&#34; data-end=&#34;1535&#34;&gt;Nombre de loop tr√®s √©lev√©s&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1520&#34; data-end=&#34;1535&#34;&gt;Souvent pr√©c√©d√© d&amp;#8217;un Nested Loop plus haut dans le plan d&amp;#8217;ex√©cution&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1577&#34; data-end=&#34;1593&#34;&gt;&lt;strong data-start=&#34;1577&#34; data-end=&#34;1593&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1594&#34; data-end=&#34;1764&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1594&#34; data-end=&#34;1657&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1596&#34; data-end=&#34;1657&#34;&gt;Changer le type de jointure pour quelque chose de plus simple a traiter (hash join ou merge join)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1658&#34; data-end=&#34;1715&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1660&#34; data-end=&#34;1715&#34;&gt;R√©√©crire la requ√™te pour faire moins de &amp;#8220;aller-retours&amp;#8221;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1716&#34; data-end=&#34;1764&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1718&#34; data-end=&#34;1764&#34;&gt;Ajouter des index pour faciliter les jointures&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;1718&#34; data-end=&#34;1764&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f50e.png&#34; alt=&#34;üîé&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Des estimations loin de la r√©alit√©&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1826&#34; data-end=&#34;1845&#34;&gt;&lt;strong data-start=&#34;1826&#34; data-end=&#34;1841&#34;&gt;Sympt√¥me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;rows=10   actual rows=10000&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1887&#34; data-end=&#34;2017&#34;&gt;&lt;strong data-start=&#34;1887&#34; data-end=&#34;1917&#34;&gt;Pourquoi c‚Äôest un souci&lt;/strong&gt;&lt;br data-start=&#34;1917&#34; data-end=&#34;1920&#34; /&gt;PostgreSQL s‚Äôest tromp√© dans son estimation, ce qui l‚Äôa peut-√™tre men√© √† choisir un mauvais plan.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2019&#34; data-end=&#34;2179&#34;&gt;&lt;strong data-start=&#34;2019&#34; data-end=&#34;2045&#34;&gt;Comment le voir&lt;/strong&gt;&lt;br data-start=&#34;2045&#34; data-end=&#34;2048&#34; /&gt;Comparez le nombre de rows (estimation) avec les actual rows. Si l‚Äô√©cart est tr√®s important, les statistiques sont probablement obsol√®tes.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2181&#34; data-end=&#34;2197&#34;&gt;&lt;strong data-start=&#34;2181&#34; data-end=&#34;2197&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2198&#34; data-end=&#34;2421&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2198&#34; data-end=&#34;2259&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2200&#34; data-end=&#34;2259&#34;&gt;Rafraichir les statistiques dans ce cas ne peut pas faire de mal : Analyze ou vaccuum analyze si n√©cessaire.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2260&#34; data-end=&#34;2352&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2262&#34; data-end=&#34;2352&#34;&gt;Ajuster les statistiques&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2353&#34; data-end=&#34;2421&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2355&#34; data-end=&#34;2421&#34;&gt;√âviter les expressions trop complexes qui biaisent les estimations&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;2355&#34; data-end=&#34;2421&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f50e.png&#34; alt=&#34;üîé&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Un tri qui consomme trop&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2494&#34; data-end=&#34;2513&#34;&gt;&lt;strong data-start=&#34;2494&#34; data-end=&#34;2509&#34;&gt;Sympt√¥me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Sort  (Sort Method: quicksort / external merge, Memory: 100MB)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2590&#34; data-end=&#34;2723&#34;&gt;&lt;strong data-start=&#34;2590&#34; data-end=&#34;2620&#34;&gt;Pourquoi c‚Äôest un souci&lt;/strong&gt;&lt;br data-start=&#34;2620&#34; data-end=&#34;2623&#34; /&gt;Le tri est trop gros, PostgreSQL n‚Äôarrive plus √† le faire en RAM ‚Üí il passe sur disque ‚Üí c‚Äôest lent.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2725&#34; data-end=&#34;2753&#34;&gt;&lt;strong data-start=&#34;2725&#34; data-end=&#34;2751&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2754&#34; data-end=&#34;2879&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2754&#34; data-end=&#34;2813&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2756&#34; data-end=&#34;2813&#34;&gt;N≈ìud SORT avec un SORT METHOD lent (EXTERNAL MERGE)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2814&#34; data-end=&#34;2843&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2816&#34; data-end=&#34;2843&#34;&gt;Consommation m√©moire √©lev√©e&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2844&#34; data-end=&#34;2879&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2846&#34; data-end=&#34;2879&#34;&gt;√âtape qui prend beaucoup de temps&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2881&#34; data-end=&#34;2897&#34;&gt;&lt;strong data-start=&#34;2881&#34; data-end=&#34;2897&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2898&#34; data-end=&#34;3077&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2898&#34; data-end=&#34;2962&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2900&#34; data-end=&#34;2962&#34;&gt;Ajouter un index sur les colonnes utilis√©es dans le ORDER BY&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2963&#34; data-end=&#34;3027&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2965&#34; data-end=&#34;3027&#34;&gt;R√©duire la quantit√© de lignes √† trier avec un LIMIT¬†en amont&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3028&#34; data-end=&#34;3077&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3030&#34; data-end=&#34;3077&#34;&gt;√âviter les sous-requ√™tes non filtr√©es avant tri&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;3030&#34; data-end=&#34;3077&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f50e.png&#34; alt=&#34;üîé&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Une clause Limit inefficace&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3164&#34; data-end=&#34;3183&#34;&gt;&lt;strong data-start=&#34;3164&#34; data-end=&#34;3179&#34;&gt;Sympt√¥me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Sort ‚Üí Limit&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3210&#34; data-end=&#34;3355&#34;&gt;&lt;strong data-start=&#34;3210&#34; data-end=&#34;3240&#34;&gt;Pourquoi c‚Äôest un souci&lt;/strong&gt;&lt;br data-start=&#34;3240&#34; data-end=&#34;3243&#34; /&gt;PostgreSQL trie &lt;em data-start=&#34;3259&#34; data-end=&#34;3266&#34;&gt;toute&lt;/em&gt; la table avant d‚Äôen extraire 10 lignes. S‚Äôil y a 1 million de lignes, c‚Äôest pas optimal.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3357&#34; data-end=&#34;3385&#34;&gt;&lt;strong data-start=&#34;3357&#34; data-end=&#34;3383&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3386&#34; data-end=&#34;3479&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3386&#34; data-end=&#34;3422&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3388&#34; data-end=&#34;3422&#34;&gt;Le SORT est au-dessus du LIMIT&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3423&#34; data-end=&#34;3479&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3425&#34; data-end=&#34;3479&#34;&gt;Le tri prend beaucoup de temps m√™me pour un LIMIT 10&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3481&#34; data-end=&#34;3497&#34;&gt;&lt;strong data-start=&#34;3481&#34; data-end=&#34;3497&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3498&#34; data-end=&#34;3678&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3498&#34; data-end=&#34;3588&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3500&#34; data-end=&#34;3588&#34;&gt;Utiliser un index qui permet de lire d√©j√† tri√© (ORDER BY created_at DESC¬†‚Üí index DESC)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3589&#34; data-end=&#34;3678&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3591&#34; data-end=&#34;3678&#34;&gt;Repenser la requ√™te pour √©viter le tri global (ex : pr√©filtrage ou pagination efficace)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;3591&#34; data-end=&#34;3678&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f50e.png&#34; alt=&#34;üîé&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Des filtres appliqu√©s trop tard&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3744&#34; data-end=&#34;3763&#34;&gt;&lt;strong data-start=&#34;3744&#34; data-end=&#34;3759&#34;&gt;Sympt√¥me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Rows Removed by Filter: 999000&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3808&#34; data-end=&#34;3948&#34;&gt;&lt;strong data-start=&#34;3808&#34; data-end=&#34;3838&#34;&gt;Pourquoi c‚Äôest un souci&lt;/strong&gt;&lt;br data-start=&#34;3838&#34; data-end=&#34;3841&#34; /&gt;Le filtre est appliqu√© apr√®s avoir lu la majorit√© des lignes ‚Üí PostgreSQL fait beaucoup de travail inutile.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3950&#34; data-end=&#34;3978&#34;&gt;&lt;strong data-start=&#34;3950&#34; data-end=&#34;3976&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3979&#34; data-end=&#34;4071&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3979&#34; data-end=&#34;4023&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3981&#34; data-end=&#34;4023&#34;&gt;Pr√©sence de FILTER (&amp;#8230;) en bas de plan&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4024&#34; data-end=&#34;4071&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4026&#34; data-end=&#34;4071&#34;&gt;Tr√®s grand nombre de ROWS REMOVED BY FILTER&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4073&#34; data-end=&#34;4089&#34;&gt;&lt;strong data-start=&#34;4073&#34; data-end=&#34;4089&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;4090&#34; data-end=&#34;4311&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4090&#34; data-end=&#34;4120&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4092&#34; data-end=&#34;4120&#34;&gt;Indexer la colonne du filtre&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4121&#34; data-end=&#34;4203&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4123&#34; data-end=&#34;4203&#34;&gt;R√©√©crire la requ√™te pour que le filtre soit pris en compte plus t√¥t dans le plan&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4204&#34; data-end=&#34;4311&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4206&#34; data-end=&#34;4311&#34;&gt;√âviter les fonctions non indexables dans le WHERE (ex : LOWER(email)¬†‚Üí pr√©f√©rer un index fonctionnel)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h1&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;313&#34; data-end=&#34;605&#34;&gt;Comme souvent avec PostgreSQL, il est difficile ‚Äî voire impossible ‚Äî de tout couvrir en un seul article. Chaque plan d&amp;#8217;ex√©cution est unique, chaque requ√™te a ses subtilit√©s, et chaque base de donn√©es a ses petites surprises. Il n‚Äôexiste pas de recette miracle qui marcherait √† tous les coups.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;607&#34; data-end=&#34;813&#34;&gt;Mais avec les bons r√©flexes, quelques outils et un peu de m√©thode, on peut rapidement progresser : rep√©rer les sympt√¥mes, lire les signes, poser les bonnes questions‚Ä¶ et surtout, tester, encore et toujours.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;607&#34; data-end=&#34;813&#34;&gt;EXPLAIN ANALYZE n‚Äôest pas r√©serv√© aux DBA ou aux experts en perfs. C‚Äôest un compagnon de route pour toute personne qui √©crit des requ√™tes, et qui veut comprendre ce qui se passe sous le capot.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1011&#34; data-end=&#34;1213&#34;&gt;Et si vous vous sentez encore un peu perdu¬∑e face √† un plan trop verbeux : pas de panique. Avec l‚Äôhabitude, √ßa devient un langage qu‚Äôon apprend √† lire presque instinctivement. Et √ßa commence maintenant.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 d√©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien √©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : pr√©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-pg_stat_statements-avec-postgresql-15/&#34; rel=&#34;bookmark&#34; title=&#34;16 mars 2023&#34;&gt;Nouveaut√©s pg_stat_statements avec PostgreSQL 15&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-18-des-io-asynchrones-performantes/&#34; rel=&#34;bookmark&#34; title=&#34;19 novembre 2025&#34;&gt;PostgreSQL 18 : des IO asynchrones performantes !&lt;/a&gt; (Emmanuel RAMI) [Non class√©PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; rel=&#34;bookmark&#34; title=&#34;26 f√©vrier 2025&#34;&gt;PostgreSQL : optimiser vos op√©rations vacuum et analyze !&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.183 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;title=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34;&gt;PostgreSQL Basics : lire un plan d&amp;#8217;ex√©cution comme un¬∑e pro (ou presque)&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Introduction : Quand une requ√™te PostgreSQL est consid√©r√©e comme lente ou que ses performances se d√©gradent soudainement, il y a un r√©flexe √† toujours avoir : utiliser les plans d&amp;#8217;ex√©cution. Je n‚Äôapprends certainement rien √† la majorit√© des personnes qui&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34;&gt;PostgreSQL Basics : lire un plan d&amp;#8217;ex√©cution comme un¬∑e pro (ou presque)&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL : optimiser vos op√©rations vacuum et analyze !</title>
    <updated>2025-02-26T11:00:21Z</updated>
    <id>tag:blog.capdata.fr,2025-02-26:/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10677&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;200&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-768x513.png 768w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum.png 800w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Hello&lt;/p&gt;&#xA;&lt;p&gt;pour commencer cette ann√©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous pr√©sente comment optimiser les op√©rations de maintenance que sont les VACUUM et les ANALYZE.&lt;/p&gt;&#xA;&lt;p&gt;Ces 2 op√©rations sont essentielles pour conserver des performances optimales pour notre instance et garantir au planner de construire des plans d&amp;#8217;ex√©cutions optimis√©s.&lt;/p&gt;&#xA;&lt;p&gt;les op√©rations VACUUM et/ou ANALYZE peuvent √™tre longues et sources de nombreuses √©critures dans les WALs sur des tables volumineuses.&lt;br /&gt;&#xA;C&amp;#8217;est pourquoi, et ce depuis la version &lt;strong&gt;PostgreSQL 16&lt;/strong&gt;, il est possible de modifier le comportement de ces op√©rations en affectant une taille de buffer. Il s&amp;#8217;agit du &amp;#8220;&lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-VACUUM-BUFFER-USAGE-LIMIT&#34;&gt;buffer_usage_limit&lt;/a&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Principe de fonctionnement.&lt;/h2&gt;&#xA;&lt;p&gt;Ce proc√©d√© s&amp;#8217;appuie sur le principe de &amp;#8220;ring buffer&amp;#8221; configur√© pour PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Attention, √† ne pas confondre, √©videment, avec les &amp;#8220;rings buffer&amp;#8221; de SQL Server !!&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, PostgreSQL utilise cette strat√©gie de &amp;#8220;ring buffer&amp;#8221; afin de d√©dier un espace m√©moire pour les op√©rations lourdes , telles, la lecture s√©quentielle sur une table volumineuse, un CREATE TABLE AS SELECT, un COPY&amp;#8230;. mais aussi un VACUUM !&lt;/p&gt;&#xA;&lt;p&gt;En fait, cet espace est utilis√© pour √©viter de &amp;#8220;flusher&amp;#8221; sur disque de mani√®re trop brutale les pages en m√©moire mont√©es dans le &amp;#8220;&lt;strong&gt;shared buffer&lt;/strong&gt;&amp;#8220;. Cela p√©naliserait en grande partie toute op√©ration concurrente √† notre traitement actif puisqu&amp;#8217;elle n&amp;#8217;aurait plus d&amp;#8217;espace pour mettre ses propres pages en m√©moire.&lt;/p&gt;&#xA;&lt;p&gt;Jusqu&amp;#8217;√† la version PostgreSQL 16, cet espace m√©moire √©tait d√©fini √†&lt;strong&gt;¬†256Ko&lt;/strong&gt;. Ainsi, au cours d&amp;#8217;une lecture s√©quentielle, chaque page¬† de &lt;strong&gt;8Ko&lt;/strong&gt; par d√©faut, est mont√©e en m√©moire dans cet espace si le nombre de pages totales √† traiter pour la table, d√©passe 1/4 du param√®tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Il en est de m√™me pour une op√©ration VACUUM ou ANALYZE qui utilise √©galement ce ring buffer et permet d&amp;#8217;optimiser cette op√©ration.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Nouveaut√©s PostgreSQL 16 et PostgreSQL 17&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la version PostgreSQL 16, il est possible de configurer la taille du buffer de fa√ßon unitaire. Par exemple, lors d&amp;#8217;un VACUUM, il est tout √† fait possible de choisir une valeur pour &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Depuis le version PostgreSQL 17, la valeur par d√©faut affect√©e √† &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; est de &lt;strong&gt;2Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il vous est possible de param√©trer la valeur de &lt;strong&gt;128Ko&lt;/strong&gt; jusqu&amp;#8217;√† &lt;strong&gt;16Go&lt;/strong&gt;. Attention, cependant, cette valeur ne peux exc√©der &lt;strong&gt;1/8&lt;/strong&gt; du param√®tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Si vous faites le calcul, pour un serveur comportant &lt;strong&gt;32Go de RAM&lt;/strong&gt;, vous ne pourrez obtenir, au plus, &lt;strong&gt;1Go&lt;/strong&gt; pour votre ring buffer.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un VACUUM&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur une instance PostgreSQL 13, nous lan√ßons un VACUUM simple sur une table de 2,5Go. Nous utilisons une base exemple cr√©√©e via &amp;#8220;pgbench&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Nous avons utilis√© les options &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221; pour analyser, dans un premier temps, tous les blocs de notre table et ne pas sur baser sur les informations de la visibility_map.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:797&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 20000000 nonremovable row versions in 327869 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196215&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 1.34 s, system: 0.67 s, elapsed: 18.90 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18920.292 ms (00:18.920)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le temps pass√© pour cette op√©ration est d&amp;#8217;un peu plus de 18 secondes en temps CPU pour analyser les 327869 blocs de notre table. Soit une taille de 2.5Go.&lt;/p&gt;&#xA;&lt;p&gt;Nous effectuons la m√™me op√©ration sur cette m√™me table, mais sur un moteur &lt;strong&gt;PostgreSQL 17&lt;/strong&gt;. Nous positionnons le param√®tre &lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;¬† √† &lt;strong&gt;8Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:475&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 327869 scanned (100.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;new relfrozenxid: 208163, which is 5 XIDs ahead of previous value&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 134.208 MB/s, avg write rate: 0.034 MB/s&#xD;&#xA;buffer usage: 330350 hits, 325508 misses, 83 dirtied&#xD;&#xA;WAL usage: 84 records, 83 full page images, 684232 bytes&#xD;&#xA;system usage: CPU: user: 1.41 s, system: 0.64 s, elapsed: 18.94 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18955.006 ms (00:18.955)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est¬† √† peu de chose pr√®s, dans le m√™me temps d&amp;#8217;ex√©cution. soir 18 secondes.&lt;/p&gt;&#xA;&lt;p&gt;La suite consiste √† red√©marrer l&amp;#8217;instance PostgreSQL 17 et constater les temps d&amp;#8217;ex√©cution pour chaque occurrence de lancement.&lt;br /&gt;&#xA;Nous ex√©cutons donc, les m√™mes ordres VACUUM, mais sans l&amp;#8217;option &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 13, nous voyons qu&amp;#8217;√† la premi√®re ex√©cution, juste apr√®s red√©marrage, nous sommes √† 32 millisecondes. Et √† chaque ex√©cution suivante, nous ne descendons pas en dessous de 15 millisecondes&amp;#8230;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 32.149 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.001 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.295 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;En version PostgreSQL 17, nous faisons √©galement un &amp;#8220;flush&amp;#8221; des pages dans le buffer cache √† chaque ex√©cution, tout en modifiant la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18.098 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 6.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;16MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 4.333 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le constat est simple, plus nous augmentons le &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, et plus le temps d&amp;#8217;ex√©cution du VACUUM diminue.&lt;/p&gt;&#xA;&lt;p&gt;Nous comprendrons donc que sur une table de plus de 100Go, le gain peut √™tre assez important.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un ANALYZE&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour l&amp;#8217;instance PostgreSQL 13, nous ex√©cutons le calcul de statistiques sur cette m√™me table&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (analyze,verbose) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:802&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 52 nonremovable row versions in 1 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196278&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:336&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1190&#xD;&#xA;VACUUM&#xD;&#xA;Time: 29526.404 ms (00:29.526)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous sommes autour de 29 secondes pour analyser 30000 pages sur les 32769 que composent cette table.&lt;br /&gt;&#xA;Le sample est choisi en fonction de la valeur de &amp;#8220;&lt;strong&gt;default_statistics_target&lt;/strong&gt;&amp;#8220;, par d√©faut √† 100, avec 30000 lignes analys√©es par d√©faut.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 17, les r√©sultats sont les suivants&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,verbose,BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:480&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 1 scanned (0.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 46.211 MB/s, avg write rate: 0.000 MB/s&#xD;&#xA;buffer usage: 37 hits, 100 misses, 0 dirtied&#xD;&#xA;WAL usage: 0 records, 0 full page images, 0 bytes&#xD;&#xA;system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.01 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:321&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1301&#xD;&#xA;VACUUM&#xD;&#xA;Time: 8151.201 ms (00:08.151)&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 7282.546 ms (00:07.283)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Les diff√©rences de gains sont moins impressionnantes que sur un simple VACUUM √† chaque changement de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, mais on voit qu&amp;#8217;en version PostgreSQL 17, nous sommes tout de m√™me 4 fois plus rapide qu&amp;#8217;en version PostgreSQL 13.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;Remarques&lt;/h4&gt;&#xA;&lt;p&gt;Gardez √† l&amp;#8217;esprit que la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&amp;#8221;&lt;/strong&gt; est plafonn√©e √† &lt;strong&gt;1/8 &lt;/strong&gt;de&lt;strong&gt; &amp;#8220;shared_buffer&amp;#8221;&lt;/strong&gt;. Inutile donc de mettre √† 1024Mo, si vous ne poss√©dez que 8Go de RAM.&lt;/p&gt;&#xA;&lt;p&gt;Attention si vous mettez une valeur trop grande, les transactions concurrentes effectuant des lectures s√©quentielles seront p√©nalis√©es par les op√©rations VACUUM. D&amp;#8217;ailleurs, il est possible de mettre &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; √† 0, mais ceci n&amp;#8217;est pas conseill√© lors d&amp;#8217;une activit√© transactionnelle en cours.&lt;/p&gt;&#xA;&lt;p&gt;Pour aller plus loin dans l&amp;#8217;optimisation d&amp;#8217;une op√©ration de vacuum, vous pouvez √©galement passer le param√®tre &amp;#8220;&lt;strong&gt;INDEX_CLEANUP&lt;/strong&gt;&amp;#8221; √† &lt;strong&gt;off&lt;/strong&gt;. Ceci aura pour effet de ne pas s&amp;#8217;occuper de traiter les entr√©es des index qui pointent sur les lignes mortes de la table.&lt;br /&gt;&#xA;Un &amp;#8220;&lt;strong&gt;REINDEX&lt;/strong&gt;&amp;#8221; sera alors n√©cessaire √† la fin du VACUUM sur les index de la table.&lt;/p&gt;&#xA;&lt;p&gt;De plus, il est possible de positionner l&amp;#8217;option &amp;#8220;&lt;strong&gt;SKIP_DATABASE_STATS&lt;/strong&gt;&amp;#8221; afin d&amp;#8217;indiquer √† l&amp;#8217;ordre VACUUM de ne pas rechercher l&amp;#8217;ID de transaction le plus ancien pour l&amp;#8217;ensemble des tables de la base et de geler celui-ci (datfrozenid).&lt;/p&gt;&#xA;&lt;p&gt;Les op√©rations VACUUM sur les grosses tables seront bien entendu optimis√©es mais attention aux plages de maintenance choisies !!&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonne journ√©e √† vous.&lt;/p&gt;&#xA;&lt;p&gt;Emmanuel Rami&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-18-des-io-asynchrones-performantes/&#34; rel=&#34;bookmark&#34; title=&#34;19 novembre 2025&#34;&gt;PostgreSQL 18 : des IO asynchrones performantes !&lt;/a&gt; (Emmanuel RAMI) [Non class√©PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : pr√©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 d√©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien √©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/requetes-consommatrices-sous-postgresql-episode-1/&#34; rel=&#34;bookmark&#34; title=&#34;24 mai 2016&#34;&gt;Requ√™tes consommatrices sous PostgreSQL (√©pisode 1)&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-mysql-8-0-les-histogrammes/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;Nouveaut√©s MySQL 8.0 : Les Histogrammes&lt;/a&gt; (Capdata team) [MySQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.795 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos op√©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Hello pour commencer cette ann√©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous pr√©sente comment optimiser les op√©rations de maintenance que sont les VACUUM et les ANALYZE. Ces 2 op√©rations sont essentielles pour conserver des performances optimales pour&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos op√©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>La mont√©e de version en zero-downtime : merci la r√©plication !</title>
    <updated>2024-12-19T10:28:41Z</updated>
    <id>tag:blog.capdata.fr,2024-12-19:/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h1&gt;Introduction :&lt;/h1&gt;&#xA;&lt;p&gt;Dans le monde des bases de donn√©es, garantir une disponibilit√© continue est une exigence incontournable, surtout pour les syst√®mes critiques o√π chaque minute d&amp;#8217;arr√™t peut entra√Æner des pertes significatives. Lorsqu‚Äôil s‚Äôagit de migrer une base de donn√©es vers une nouvelle version, ce d√©fi prend une toute autre dimension. Comment mettre √† jour votre syst√®me sans interrompre les services, tout en pr√©servant l‚Äôint√©grit√© des donn√©es ?&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL offre une solution √©l√©gante : la r√©plication logique. Cet outil permet de transf√©rer des donn√©es de mani√®re fluide entre diff√©rentes versions de PostgreSQL, tout en maintenant la base de donn√©es source op√©rationnelle. Dans cet article, nous allons explorer √©tape par √©tape comment utiliser cette fonctionnalit√© pour r√©aliser une mont√©e de version sans temps d&amp;#8217;arr√™t, du d√©ploiement initial √† la bascule finale vers la nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Que vous soyez en train de planifier une migration ou simplement curieux de d√©couvrir les possibilit√©s offertes par PostgreSQL, suivez ce guide pratique qui vous permettra de transformer un d√©fi complexe en une op√©ration ma√Ætris√©e et efficace.&lt;/p&gt;&#xA;&lt;h1&gt;Le test :&lt;/h1&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h3&gt;Pr√©paration&lt;/h3&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pour tester cette nouvelle m√©thode, nous aurons besoin de deux instances PostgreSQL. Pour cet article j&amp;#8217;ai choisit de d√©montrer la technique en migrant d&amp;#8217;une version 14 √† une version 17 de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Je commence donc par installer les versions sur deux machines diff√©rentes pouvant communiquer entre elles (c&amp;#8217;est important) :&lt;/p&gt;&#xA;&lt;p&gt;Sur les deux machines nous pouvons ex√©cuter les commandes suivantes :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt update sudo apt upgrade -y&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y install gnupg2 wget vim&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo sh -c &#39;echo &amp;quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&amp;quot; &amp;amp;gt; /etc/apt/sources.list.d/pgdg.list&#39;&#xD;&#xA;root@ip-192-1-1-246:~# curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc|sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y update&#xD;&#xA;Get:1 file:/etc/apt/mirrors/debian.list Mirrorlist [38 B]&#xD;&#xA;Get:2 file:/etc/apt/mirrors/debian-security.list Mirrorlist [47 B]&#xD;&#xA;Hit:3 https://cdn-aws.deb.debian.org/debian bookworm InRelease&#xD;&#xA;Hit:4 https://cdn-aws.deb.debian.org/debian bookworm-updates InRelease&#xD;&#xA;Hit:5 https://cdn-aws.deb.debian.org/debian bookworm-backports InRelease&#xD;&#xA;Hit:6 https://cdn-aws.deb.debian.org/debian-security bookworm-security InRelease&#xD;&#xA;Get:7 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg InRelease [129 kB]&#xD;&#xA;Get:8 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg/main amd64 Packages [359 kB]&#xD;&#xA;Fetched 489 kB in 1s (348 kB/s)&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;All packages are up to date.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur notre premi√®re machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt install postgresql-14&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-14 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl status postgresql@14-main.service&#xD;&#xA;‚óè postgresql@14-main.service - PostgreSQL Cluster 14-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime;&amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:43:55 UTC; 2min 55s ago&#xD;&#xA;Process: 15248 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect &amp;amp;gt;&#xD;&#xA;Main PID: 15253 (postgres)&#xD;&#xA;Tasks: 7 (limit: 4633)&#xD;&#xA;Memory: 17.3M&#xD;&#xA;CPU: 239ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@14-main.service&#xD;&#xA;‚îú‚îÄ15253 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresq&amp;amp;gt;&#xD;&#xA;‚îú‚îÄ15255 &amp;quot;postgres: 14/main: checkpointer &amp;quot;&#xD;&#xA;‚îú‚îÄ15256 &amp;quot;postgres: 14/main: background writer &amp;quot;&#xD;&#xA;‚îú‚îÄ15257 &amp;quot;postgres: 14/main: walwriter &amp;quot;&#xD;&#xA;‚îú‚îÄ15258 &amp;quot;postgres: 14/main: autovacuum launcher &amp;quot;&#xD;&#xA;‚îú‚îÄ15259 &amp;quot;postgres: 14/main: stats collector &amp;quot;&#xD;&#xA;‚îî‚îÄ15260 &amp;quot;postgres: 14/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:43:53 ip-192-1-1-246 systemd[1]: Starting postgresql@14-main.service&amp;amp;gt;&#xD;&#xA;Dec 04 09:43:55 ip-192-1-1-246 systemd[1]: Started postgresql@14-main.service &amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur la deuxi√®me machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;admin@ip-192-1-1-89:~$ sudo apt install postgresql-17&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-17 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;admin@ip-192-1-1-89:~$ systemctl status postgresql@17-main.service&#xD;&#xA;‚óè postgresql@17-main.service - PostgreSQL Cluster 17-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime; &amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:52:33 UTC; 2min 13s ago&#xD;&#xA;Process: 15235 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect 1&amp;amp;gt;&#xD;&#xA;Main PID: 15240 (postgres)&#xD;&#xA;Tasks: 6 (limit: 4633)&#xD;&#xA;Memory: 20.5M&#xD;&#xA;CPU: 332ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@17-main.service&#xD;&#xA;‚îú‚îÄ15240 /usr/lib/postgresql/17/bin/postgres -D /var/lib/postgresql&amp;amp;gt;&#xD;&#xA;‚îú‚îÄ15241 &amp;quot;postgres: 17/main: checkpointer &amp;quot;&#xD;&#xA;‚îú‚îÄ15242 &amp;quot;postgres: 17/main: background writer &amp;quot;&#xD;&#xA;‚îú‚îÄ15244 &amp;quot;postgres: 17/main: walwriter &amp;quot;&#xD;&#xA;‚îú‚îÄ15245 &amp;quot;postgres: 17/main: autovacuum launcher &amp;quot;&#xD;&#xA;‚îî‚îÄ15246 &amp;quot;postgres: 17/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:52:31 ip-192-1-1-89 systemd[1]: Starting postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;Dec 04 09:52:33 ip-192-1-1-89 systemd[1]: Started postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos deux instances sont maintenant install√©es. Sur notre premi√®re base de donn√©es, nous allons cr√©er une base, avec deux tables, et quelques lignes.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE TABLE customers (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;name TEXT NOT NULL,&#xD;&#xA;email TEXT UNIQUE,&#xD;&#xA;created_at TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# CREATE TABLE orders (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;customer_id INT REFERENCES customers(id),&#xD;&#xA;amount NUMERIC(10,2) NOT NULL,&#xD;&#xA;order_date TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES&#xD;&#xA;(&#39;Alice&#39;, &#39;alice@example.com&#39;),&#xD;&#xA;(&#39;Bob&#39;, &#39;bob@example.com&#39;),&#xD;&#xA;(&#39;Charlie&#39;, &#39;charlie@example.com&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;mydb=# INSERT INTO orders (customer_id, amount) VALUES&#xD;&#xA;(1, 50.75),&#xD;&#xA;(2, 20.00),&#xD;&#xA;(1, 75.00);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;2. Configurer la base de donn√©es source&lt;/h3&gt;&#xA;&lt;p&gt;Sur notre premi√®re machine, nous allons modifier les param√®tres du fichier de configuration de PostgreSQL pour permettre de pouvoir cr√©er la r√©plication :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-246:~$ cd /etc/postgresql/14/main&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il s&amp;#8217;agit de modifier les param√®tres suivants :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Nous modifierons ensuite le pg_hba pour rajouter l&amp;#8217;autorisation de connexion entre les deux machines :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il suffira de rajouter une ligne :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Il ne faut pas oublier de red√©marrer le serveur PostgreSQL une fois ces modifications effectu√©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;3. Configurer la base de donn√©e de destination&lt;/h3&gt;&#xA;&lt;p&gt;Apr√®s avoir configur√© notre base de donn√©e depuis laquelle nous allons faire notre migration, il nous faut a pr√©sent configurer celle qui va recevoir la nouvelle base de donn√©e migr√©e.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela, nous allons r√©p√©ter les √©tapes de configuration de la base de donn√©e source, en les adaptant sur notre base de donn√©e de destination : modifier le postgresql.conf, puis le pg_hba.conf, red√©marrer ensuite la base de donn√©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ cd /etc/postgresql/17/main/&#xD;&#xA;postgres@ip-192-1-1-89:/etc/postgresql/17/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il ne faudra pas oublier de cr√©er la base de donn√©e ainsi que toutes les structures de tables et autres objets dans notre base cible pour qu&amp;#8217;elle puisse recevoir les donn√©es. Pour avoir les scripts de cr√©ation de la base de donn√©es, vous pouvez faire un pg_dump avec l&amp;#8217;option&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ psql&#xD;&#xA;psql (17.2 (Debian 17.2-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;N&amp;#8217;oubliez pas de donner tout les droits √† votre utilisateur de replication pour qu&amp;#8217;il puisse lire, √©crire&amp;#8230; Sur votre base de donn√©es repliqu√©e, sur la source, comme sur la destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# GRANT ALL PRIVILEGES ON DATABASE &amp;quot;mydb&amp;quot; to replication;&#xD;&#xA;GRANT&#xD;&#xA;&#xD;&#xA;mydb=# GRANT ALL PRIVILEGES ON all tables in schema public to replication;&#xD;&#xA;GRANT&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;4. Mise en place de la r√©plication logique&lt;/h3&gt;&#xA;&lt;p&gt;Maintenant que nos deux environnement sont bien en place, nous sommes pr√™ts √† mettre en route le processus de r√©plication logique pour commencer √† transf√©rer les donn√©es. Les √©tapes du dessous ont demand√© une premi√®re intervention hors horaire de prod, notamment pour red√©marrer le service postgreSQL, mais le but d&amp;#8217;une migration avec r√©plication logique, c&amp;#8217;est de pouvoir ensuite n&amp;#8217;avoir rien √† toucher jusqu&amp;#8217;au moment de basculer les applicatifs d&amp;#8217;une ip a une autre.&lt;/p&gt;&#xA;&lt;p&gt;Sur notre machine source, on cr√©√© la publication qui va nous servir √† transf√©rer nos tables :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE PUBLICATION my_pub FOR ALL TABLES;&#xD;&#xA;CREATE PUBLICATION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On va ensuite cr√©√© la souscription sur la base de donn√©es cible de notre migration :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# create subscription my_sub connection &#39;host=192.1.1.246 port=5432 dbname=mydb user=replication password=replication&#39;publication my_pub;&#xD;&#xA;NOTICE: created replication slot &amp;quot;my_sub&amp;quot; on publisher&#xD;&#xA;CREATE SUBSCRIPTION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Maintenant que la subscription est en place, on peut v√©rifier qu&amp;#8217;elle fonctionne. Pendant ce temps, la vrai production, sur la version 14, peut continuer √† fonctionner, elle sera automatiquement repliqu√©e sur la nouvelle version 17.&lt;/p&gt;&#xA;&lt;p&gt;On peut v√©rifier ou en est notre replication avec la commande &lt;span class=&#34;hljs-keyword&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;FROM&lt;/span&gt; pg_stat_subscription;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# SELECT * FROM pg_stat_subscription;&#xD;&#xA;-[ RECORD 1 ]---------+------------------------------&#xD;&#xA;subid | 16422&#xD;&#xA;subname | my_sub&#xD;&#xA;worker_type | apply&#xD;&#xA;pid | 16076&#xD;&#xA;leader_pid |&#xD;&#xA;relid |&#xD;&#xA;received_lsn | 0/1733988&#xD;&#xA;last_msg_send_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;last_msg_receipt_time | 2024-12-04 14:23:59.872357+00&#xD;&#xA;latest_end_lsn | 0/1733988&#xD;&#xA;latest_end_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;5. Test de replication, bascule, et nettoyage&lt;/h3&gt;&#xA;&lt;p&gt;Une fois que la synchronisation de votre replication logique est termin√©e, ce qui peut prendre un certain temps si vous avez beaucoup de donn√©es, vous pouvez constater de vous m√™me sur les lignes que vous ajoutez, modifiez ou supprimez sur votre instance source sont repliqu√©es sur l&amp;#8217;instance de destination.&lt;/p&gt;&#xA;&lt;p&gt;Par exemple, ajoutons un nouveau customer sur notre base source :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES (&#39;Diana&#39;, &#39;diana@example.com&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Si nous allons requ√™ter sur notre instance de destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# select * from customers where name=&#39;Diana&#39;;&#xD;&#xA;id | name | email | created_at&#xD;&#xA;----+-------+-------------------+----------------------------&#xD;&#xA;4 | Diana | diana@example.com | 2024-12-04 14:31:05.708031&#xD;&#xA;(1 row)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Quand vous vous √™tes bien assur√© que tout fonctionne, vous pouvez alors rediriger les drivers odbc de vos applications vers le nouveau serveur et non plus l&amp;#8217;ancien.&lt;/p&gt;&#xA;&lt;p&gt;Une fois que cela est fait, vous pouvez alors supprimer le lien de replication, puisque l&amp;#8217;ancienne instance ne sera plus aliment√©e, et m√™me supprimer l&amp;#8217;ancienne version si vous n&amp;#8217;en avez plus l&amp;#8217;utilit√©.&lt;/p&gt;&#xA;&lt;p&gt;Sur la destination, notre nouveau serveur de prod :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP SUBSCRIPTION my_sub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Sur la source, ancien serveur qui va √™tre supprim√© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP PUBLICATION my_pub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h1&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;La r√©plication logique se distingue comme l‚Äôune des meilleures solutions pour minimiser le temps d‚Äôarr√™t lors d‚Äôune migration de version PostgreSQL. En permettant une synchronisation continue des donn√©es entre deux instances, elle garantit une transition en douceur sans jamais interrompre les services en cours. Cela en fait un choix id√©al pour les environnements critiques o√π la disponibilit√© est primordiale.&lt;/p&gt;&#xA;&lt;h3&gt;Avantages :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;Z√©ro downtime :&lt;/strong&gt; la source reste op√©rationnelle pendant toute la migration.&lt;br /&gt;&#xA;&lt;strong&gt;Flexibilit√© :&lt;/strong&gt; possibilit√© de migrer vers une infrastructure diff√©rente (nouveau mat√©riel, cloud, etc.).&lt;br /&gt;&#xA;&lt;strong&gt;Granularit√© :&lt;/strong&gt; la r√©plication logique peut se limiter √† certaines tables si n√©cessaire.&lt;/p&gt;&#xA;&lt;h3&gt;Inconv√©nients :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;Complexit√© initiale :&lt;/strong&gt; la configuration et les tests n√©cessitent une bonne ma√Ætrise des param√®tres de PostgreSQL.&lt;br /&gt;&#xA;&lt;strong&gt;Impact sur les performances :&lt;/strong&gt; la charge de r√©plication peut l√©g√®rement affecter les performances de la base source, surtout avec un grand volume de donn√©es.&lt;br /&gt;&#xA;&lt;strong&gt;Non pris en charge pour certains types de donn√©es :&lt;/strong&gt; les types sp√©cifiques ou les extensions non standards ne sont pas toujours compatibles avec la r√©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Si la r√©plication logique est souvent la m√©thode privil√©gi√©e pour des mises √† jour critiques, elle n‚Äôest pas la seule option. Des alternatives comme les outils de sauvegarde et restauration ou la r√©plication physique peuvent r√©pondre √† d‚Äôautres besoins sp√©cifiques, notamment pour des bases de donn√©es tr√®s volumineuses ou des sc√©narios n√©cessitant une r√©plication compl√®te du syst√®me.&lt;/p&gt;&#xA;&lt;p&gt;Dans tous les cas, le choix de la m√©thode d√©pendra de votre contexte, de vos contraintes techniques et de vos objectifs m√©tier. Prenez le temps d‚Äô√©valuer les diff√©rentes options pour garantir une migration r√©ussie et sans surprise.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/replication-logique-avec-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;23 janvier 2020&#34;&gt;R√©plication logique avec PostgreSQL&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migration-postgresql-via-slony-i-ou-comment-reduire-le-temps-de-coupure/&#34; rel=&#34;bookmark&#34; title=&#34;27 janvier 2020&#34;&gt;Migration PostgreSQL via SLONY-I ou comment r√©duire le temps de coupure&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migrer-dun-cluster-galera-mariadb-10-3-vers-mariadb-10-5-avec-la-replication-logique/&#34; rel=&#34;bookmark&#34; title=&#34;25 f√©vrier 2022&#34;&gt;Migrer d&amp;#8217;un cluster Galera MariaDB 10.3 vers MariaDB 10.5 avec la r√©plication logique&lt;/a&gt; (David Baffaleuf) [ContainerMySQLNon class√©]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/comparatif-des-gestionnaires-de-vip-dans-un-cluster-patroni-episode-1-keepalived/&#34; rel=&#34;bookmark&#34; title=&#34;6 mars 2022&#34;&gt;Comparatif des gestionnaires de VIP dans un cluster Patroni : √©pisode 1 (KEEPALIVED)&lt;/a&gt; (David Baffaleuf) [ContainerPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des sch√©mas de base de donn√©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.141 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La mont√©e de version en zero-downtime : merci la r√©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Introduction : Dans le monde des bases de donn√©es, garantir une disponibilit√© continue est une exigence incontournable, surtout pour les syst√®mes critiques o√π chaque minute d&amp;#8217;arr√™t peut entra√Æner des pertes significatives. Lorsqu‚Äôil s‚Äôagit de migrer une base de donn√©es vers&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La mont√©e de version en zero-downtime : merci la r√©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>pg_vector : l‚ÄôIA et PostgreSQL</title>
    <updated>2024-12-03T07:22:34Z</updated>
    <id>tag:blog.capdata.fr,2024-12-03:/index.php/pg_vector-lia-et-postgresql/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h2&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le r√¥le des bases de donn√©es&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle (IA) conna√Æt une popularit√© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies fonctionnent, elles ont besoin de donn√©es, souvent en grande quantit√©. C‚Äôest l√† qu‚Äôinterviennent les bases de donn√©es : elles stockent, g√®rent et permettent d&amp;#8217;acc√©der √† ces donn√©es de mani√®re efficace.&lt;/p&gt;&#xA;&lt;p&gt;Les bases de donn√©es, comme PostgreSQL, ont donc un r√¥le cl√© dans l‚ÄôIA. Mais l&amp;#8217;IA ne traite pas toujours des informations simples comme des noms ou des chiffres ; souvent, elle doit manipuler des informations complexes, comme des repr√©sentations num√©riques d&amp;#8217;images, de sons, ou de textes. Pour g√©rer ces donn√©es sp√©cifiques, il faut des outils adapt√©s, et c&amp;#8217;est l√† que l&amp;#8217;extension pg_vector de PostgreSQL entre en jeu.&lt;/p&gt;&#xA;&lt;h2&gt;2. Les vecteurs en informatique et dans pg_vector&lt;/h2&gt;&#xA;&lt;p&gt;Dans le cadre de l‚Äôinformatique, un vecteur est simplement une liste de nombres. Ces nombres peuvent repr√©senter n‚Äôimporte quoi : les caract√©ristiques d‚Äôun produit, les mots d‚Äôun texte ou m√™me une image. Par exemple, pour un document texte, chaque mot peut √™tre transform√© en une s√©rie de nombres qui capture son sens dans un certain contexte.&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôextension pg_vector permet √† PostgreSQL de stocker et de manipuler ces vecteurs. Elle offre un moyen simple de les utiliser directement dans une base de donn√©es. Imaginons que nous avons des centaines de documents et que nous souhaitions rechercher les plus similaires √† un texte donn√© : en stockant les repr√©sentations num√©riques (ou embeddings) de ces documents sous forme de vecteurs, nous pouvons facilement comparer leur similarit√© gr√¢ce √† pg_vector.&lt;/p&gt;&#xA;&lt;h2&gt;3. Le lien entre l&amp;#8217;IA et les vecteurs&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle repose sur la capacit√© √† comprendre et traiter des informations complexes. Par exemple, quand une IA doit reconna√Ætre une image, elle ne &amp;#8220;voit&amp;#8221; pas comme nous. Au lieu de cela, l&amp;#8217;image est transform√©e en une s√©rie de nombres, un vecteur, qui repr√©sente ses caract√©ristiques (couleurs, formes, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Le m√™me principe s‚Äôapplique au texte. Les mod√®les de traitement du langage, comme ceux utilis√©s par les moteurs de recherche ou les chatbots, transforment chaque mot ou phrase en vecteur. Ces vecteurs capturent le sens des mots et permettent √† l&amp;#8217;IA de manipuler des informations complexes sans &amp;#8220;comprendre&amp;#8221; le langage humain.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est ici que les embeddings entrent en jeu. Un embedding est un vecteur qui repr√©sente des donn√©es sous une forme que l‚ÄôIA peut utiliser. Par exemple, dans un syst√®me de recommandation, chaque produit est converti en un embedding, et les produits les plus proches de celui que nous venons de consulter (en termes de vecteur) nous seront recommand√©s. Gr√¢ce √† pg_vector, ces embeddings peuvent √™tre stock√©s et compar√©s directement dans une base de donn√©es.&lt;/p&gt;&#xA;&lt;h2&gt;4. Pourquoi est-ce utile ?&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector est tr√®s utile pour des applications qui n√©cessitent la recherche par similarit√©. Par exemple, dans un moteur de recherche, si nous voulons trouver les documents les plus proches d&amp;#8217;un texte donn√©, pg_vector permet de comparer les vecteurs (ou embeddings) de chaque document pour voir lesquels sont les plus similaires.&lt;/p&gt;&#xA;&lt;p&gt;Autre exemple, dans une plateforme de streaming musical, chaque chanson peut √™tre convertie en vecteur qui repr√©sente ses caract√©ristiques (comme le tempo, la tonalit√©, etc.). Gr√¢ce √† pg_vector, on peut facilement recommander des chansons similaires √† celles que nous √©coutons.&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôavantage de pg_vector, c‚Äôest qu‚Äôil permet de g√©rer ces vecteurs directement dans la base de donn√©es, ce qui √©vite de passer par des syst√®mes externes plus complexes. Cela simplifie le d√©veloppement et am√©liore la performance, car tout est g√©r√© au m√™me endroit.&lt;/p&gt;&#xA;&lt;h2&gt;5. Le test&lt;/h2&gt;&#xA;&lt;p&gt;Pour d√©montrer le fonctionnement de l&amp;#8217;extension, rien de tel qu&amp;#8217;un petit test pour √©prouver les fonctionnalit√©s qu&amp;#8217;elle propose. Le test sera plut√¥t simple et succinct pour √™tre accessible. Le pr√©requi est d&amp;#8217;avoir une version PostgreSQL 14 ou plus r√©cente d&amp;#8217;install√©e.&lt;/p&gt;&#xA;&lt;h3&gt;Etape 1 :&lt;/h3&gt;&#xA;&lt;p&gt;On commence par installer l&amp;#8217;extension pg_vector. Pour cela, nous allons avoir besoin d&amp;#8217;un certain nombre d&amp;#8217;outils pour le faire fonctionner. Une partie de ces outils sont disponible dans la distribution dev de PostgreSQL&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# sudo apt install postgresql-server-dev-14&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nous aurons √©galement besoin de gcc et make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# apt install make&#xD;&#xA;root@ip-192-1-1-201:~# apt-get install gcc&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On effectue ensuite un git clone du projet :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# git clone https://github.com/pgvector/pgvector.git&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et une fois que c&amp;#8217;est fait, on l&amp;#8217;installe avec make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# cd pgvector&#xD;&#xA;root@ip-192-1-1-201:~# make &amp;amp;amp;&amp;amp;amp; sudo make install&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 2 :&lt;/h3&gt;&#xA;&lt;p&gt;On se connecte √† PostgreSQL pour cr√©er l&amp;#8217;extension. Au passage, on cr√©√© aussi une base de donn√©es pour faire nos test.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-201:~$ psql&#xD;&#xA;psql (14.13 (Ubuntu 14.13-0ubuntu0.22.04.1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# create database test_vector;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c test_vector&#xD;&#xA;You are now connected to database &amp;quot;test_vector&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;test_vector=# CREATE EXTENSION vector;&#xD;&#xA;CREATE EXTENSION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et dans la foul√©e, on cr√©e une table qui contient les vecteurs sur lesquels nous allons faire les test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# CREATE TABLE documents (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;title TEXT,&#xD;&#xA;embedding vector(3) -- vecteur de dimension 3 pour cet exemple&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Insertion des donn√©es d&amp;#8217;exemple :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# INSERT INTO documents (title, embedding) VALUES&#xD;&#xA;(&#39;Document 1&#39;, &#39;[0.1, 0.2, 0.3]&#39;),&#xD;&#xA;(&#39;Document 2&#39;, &#39;[0.4, 0.5, 0.6]&#39;),&#xD;&#xA;(&#39;Document 3&#39;, &#39;[0.9, 0.8, 0.7]&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 3 :&lt;/h3&gt;&#xA;&lt;p&gt;Nous avons deux types de choses √† tester pour montrer l&amp;#8217;efficacit√© de notre extension. En effet, pour rechercher un vecteur, deux modes s&amp;#8217;offrent √† nous :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h4&gt;La distance cosinus&lt;/h4&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;La distance cosinus mesure non pas combien deux vecteurs sont √©loign√©s, mais l&amp;#8217;angle entre eux. C‚Äôest un peu comme comparer la direction dans laquelle pointent deux vecteurs plut√¥t que la distance r√©elle entre eux.&lt;/p&gt;&#xA;&lt;p&gt;Imaginons que nous sommes en train de lancer deux fl√®ches. La distance cosinus nous dira si les deux fl√®ches pointent dans la m√™me direction (sont similaires) ou si elles pointent dans des directions tr√®s diff√©rentes (sont moins similaires).&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre de l‚ÄôIA, cette mesure est souvent utilis√©e pour comparer des embeddings (repr√©sentations num√©riques complexes), car elle se concentre sur la relation entre les √©l√©ments, ind√©pendamment de leur taille exacte.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Prenons les deux films :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Film A : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Film B : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance cosinus ne va pas se soucier de la diff√©rence de valeur entre chaque composant, mais va regarder si les deux films ont des proportions similaires. Autrement dit, est-ce que leur &amp;#8220;profil&amp;#8221; g√©n√©ral est proche ou √©loign√© ?&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette distance, dans notre pg vector, on utilise la m√©thode suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+---------------------&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.05582537807240784&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.07142855242198809&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 0.09815280896106982&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Le symbole &amp;lt;=&amp;gt; repr√©sente une distance cosinus.&lt;/p&gt;&#xA;&lt;h4&gt;2. La distance Euclidienne&lt;/h4&gt;&#xA;&lt;p&gt;Imaginons que nous sommes sur une carte avec deux points : le point A et le point B. La distance euclidienne, c&amp;#8217;est la fa√ßon la plus intuitive de mesurer la distance entre ces deux points, comme si nous tracions une ligne droite entre eux. Pour parler en terme simple, c‚Äôest la &amp;#8220;distance √† vol d&amp;#8217;oiseau&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des vecteurs, la distance euclidienne mesure la diff√©rence entre deux vecteurs, un peu comme si chaque vecteur √©tait un point sur une carte en plusieurs dimensions. Plus cette distance est petite, plus les deux vecteurs (et donc les objets qu‚Äôils repr√©sentent) sont similaires.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Imaginons deux films repr√©sent√©s par les vecteurs suivants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film A&lt;/strong&gt; : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film B&lt;/strong&gt; : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance euclidienne va calculer la diff√©rence entre chaque nombre des deux vecteurs et d√©terminer √† quel point ces films sont proches en termes de caract√©ristiques (genre, nombre d‚Äôacteurs, budget, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Dans pg_vector on peut le tester ainsi :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+--------------------&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.1414213612422477&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.5385165006363984&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 1.0677078185041473&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Elle est repr√©sent√©e par le cigle &amp;lt;-&amp;gt; dans pg_vector.&lt;/p&gt;&#xA;&lt;h4&gt;3. Quand choisir l&amp;#8217;une ou l&amp;#8217;autre des distances ?&lt;/h4&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La distance euclidienne est utile quand tu veux mesurer la diff√©rence globale entre deux objets. Elle est facile √† comprendre et √† utiliser pour des comparaisons directes.&lt;/li&gt;&#xA;&lt;li&gt;La distance cosinus est utile quand tu veux savoir si deux objets sont globalement similaires dans leur profil, ind√©pendamment de leur taille ou de leur √©chelle. Elle est souvent utilis√©e pour comparer des documents textuels ou des donn√©es complexes en IA&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector apporte une fonctionnalit√© puissante √† PostgreSQL, permettant de manipuler des donn√©es complexes sous forme de vecteurs. Que ce soit pour des syst√®mes de recommandation, des moteurs de recherche ou toute autre application li√©e √† l‚Äôintelligence artificielle, elle offre un moyen simple et efficace d&amp;#8217;int√©grer l&amp;#8217;IA dans les bases de donn√©es. Et tout cela, sans avoir besoin de comprendre des math√©matiques avanc√©es : il suffit de savoir que ces vecteurs permettent de traiter des informations complexes de mani√®re tr√®s efficace.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/&#34; rel=&#34;bookmark&#34; title=&#34;3 avril 2024&#34;&gt;pg_recursively_delete : Simplifier les suppressions r√©cursives&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des sch√©mas de base de donn√©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-planifier-une-tache-avec-pg_cron/&#34; rel=&#34;bookmark&#34; title=&#34;24 septembre 2019&#34;&gt;PostgreSQL : planifier une t√¢che avec pg_cron&lt;/a&gt; (Emmanuel RAMI) [Non class√©PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/transparent-data-encryption-pour-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;13 mai 2022&#34;&gt;Transparent Data Encryption pour PostgreSQL&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pg_dirtyread-ou-comment-reparer-facilement-un-delete-sauvage/&#34; rel=&#34;bookmark&#34; title=&#34;27 mars 2024&#34;&gt;pg_dirtyread o√π comment r√©parer facilement un delete sauvage&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.264 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le r√¥le des bases de donn√©es L&amp;#8217;intelligence artificielle (IA) conna√Æt une popularit√© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17 : des sauvegardes incr√©mentales avec pg_basebackup</title>
    <updated>2024-07-16T11:24:05Z</updated>
    <id>tag:blog.capdata.fr,2024-07-16:/index.php/postgresql-17-sauvegardes-incrementales/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-10592&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/07/SalesGrowth.jpg&#34; alt=&#34;&#34; width=&#34;279&#34; height=&#34;180&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonjour&lt;/p&gt;&#xA;&lt;p&gt;Les 11 et 12 juin derniers, nous √©tions aux journ√©es PGDAY √† Lille pour d√©couvrir les nouveaut√©s autour de PostgreSQL.&lt;br /&gt;&#xA;Cette conf√©rence regroupe diff√©rents professionnels, de la communaut√© francophone, qui agissent en contribuant sur des sujets techniques mais aussi sur les bonnes pratiques afin d&amp;#8217;utiliser PostgreSQL dans les meilleurs conditions.&lt;/p&gt;&#xA;&lt;p&gt;Un article m&amp;#8217;a particuli√®rement int√©ress√© cette ann√©e, c&amp;#8217;est celui de &lt;a href=&#34;https://www.linkedin.com/in/stefan-fercot/?originalSubdomain=be&#34;&gt;Stefan Fercot&lt;/a&gt; Senior DBA PostgreSQL qui vit en Belgique, et travaille pour une soci√©t√© allemande experte dans les solutions PostgreSQL. Sa pr√©sentation portait sur le sujet &amp;#8220;d√©mystifier les sauvegardes incr√©mentales sous PostgreSQL&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;#8217;ai √©cout√© sa conf√©rence tout en ayant h√¢te de tester sa mise en place d√®s mon retour de Lille.&lt;/p&gt;&#xA;&lt;p&gt;Je tiens √† remercier Stefan pour son travail sur ce sujet sauvegardes PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Tout d&amp;#8217;abord, il faut savoir que les sujets sauvegardes incr√©mentales ont √©t√© d√©j√† abord√©s avec des outils comme &lt;strong&gt;Barman&lt;/strong&gt; ou &lt;strong&gt;Pg_BackRest&lt;/strong&gt;, et que certaines instances PostgreSQL de production sont sauvegard√©es via ces m√©canismes depuis quelques ann√©es maintenant.&lt;/p&gt;&#xA;&lt;p&gt;Ici, nous parlons de la solution &amp;#8220;backup incremental&amp;#8221; inclu nativement dans le moteur PostgreSQL, et disponible avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8220;. C&amp;#8217;est d&amp;#8217;ailleurs ce point que Stefan a soulign√© durant la journ√©e PGDAY du 11 juin dernier.&lt;/p&gt;&#xA;&lt;p&gt;Cette nouvelle fonctionnalit√© fait partie de la version &lt;strong&gt;PostgreSQL 17&lt;/strong&gt; qui est pour le moment, en version&lt;strong&gt; Beta 2&lt;/strong&gt;.&lt;br /&gt;&#xA;Celle ci devrait sortir, comme √† l&amp;#8217;accoutum√©, au cour de l&amp;#8217;automne prochain.&lt;/p&gt;&#xA;&lt;p&gt;Preuve que PostgreSQL est en perp√©tuel √©volution, et rejoint la liste des SGBD √©tant capable, comme peuvent le faire Oracle et SQL Server, de proposer nativement des sauvegardes incr√©mentales.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Installation de PostgreSQL 17&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette fonctionnalit√©, nous devons installer la toute derni√®re version de PostgreSQL , la 17 beta 2. Attention, celle ci n&amp;#8217;√©tant pas disponible dans les d√©p√¥ts PGDG, nous devons nous charger d&amp;#8217;installer cette version via le site postgresql.org&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&#34;&gt;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Nous disposons d&amp;#8217;un serveur Linux fork Red Hat 8 (Rocky Linux). Il nous faut donc t√©l√©charger les &amp;#8220;rpm&amp;#8221; li√©s √† cette version.&lt;/p&gt;&#xA;&lt;p&gt;Les packages dont nous avons besoin sont les suivants&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;# ls -lrt postgresql1* | awk &#39;{print$9}&#39;&#xD;&#xA;postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous les installons avec le compte &lt;strong&gt;root&lt;/strong&gt; de notre serveur.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[root@ tmp]# rpm -i postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous sommes sur un environnement &amp;#8220;Red Hat like&amp;#8221;, la cr√©ation d&amp;#8217;une premi√®re instance via &amp;#8220;initdb&amp;#8221; est n√©cessaire.&lt;br /&gt;&#xA;Surtout, ne pas oublier d&amp;#8217;activer les &amp;#8220;data checksums&amp;#8221; (option -k), nous verrons pourquoi dans la suite de cet article. La suite est √† faire avec le compte &lt;strong&gt;postgres&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ initdb -D /data/postgres/17/pg_data -k&#xD;&#xA;The files belonging to this database system will be owned by user &amp;quot;postgres&amp;quot;.&#xD;&#xA;This user must also own the server process.&#xD;&#xA;&#xD;&#xA;The database cluster will be initialized with locale &amp;quot;en_US.UTF-8&amp;quot;.&#xD;&#xA;The default database encoding has accordingly been set to &amp;quot;UTF8&amp;quot;.&#xD;&#xA;The default text search configuration will be set to &amp;quot;english&amp;quot;.&#xD;&#xA;&#xD;&#xA;Data page checksums are enabled.&#xD;&#xA;&#xD;&#xA;creating directory /data/postgres/17/pg_data ... ok&#xD;&#xA;creating subdirectories ... ok&#xD;&#xA;selecting dynamic shared memory implementation ... posix&#xD;&#xA;selecting default &amp;quot;max_connections&amp;quot; ... 100&#xD;&#xA;selecting default &amp;quot;shared_buffers&amp;quot; ... 128MB&#xD;&#xA;selecting default time zone ... UTC&#xD;&#xA;creating configuration files ... ok&#xD;&#xA;running bootstrap script ... ok&#xD;&#xA;performing post-bootstrap initialization ... ok&#xD;&#xA;syncing data to disk ... ok&#xD;&#xA;&#xD;&#xA;initdb: warning: enabling &amp;quot;trust&amp;quot; authentication for local connections&#xD;&#xA;initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.&#xD;&#xA;&#xD;&#xA;Success. You can now start the database server using:&#xD;&#xA;&#xD;&#xA;pg_ctl -D /data/postgres/17/pg_data -l logfile start&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;D√©marrer cette instance pour s&amp;#8217;assurer que tout fonctionne&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data -l logfile start&#xD;&#xA;waiting for server to start.... done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Notre version enregistr√©e est bien une Beta 2. Version qui ne doit pas √™tre mise sur un environnement de production comme le rappelle le site de la communaut√© PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ psql&#xD;&#xA;(postgres@[local]:5437) [postgres] &amp;gt; select * from version();&#xD;&#xA;version&#xD;&#xA;------------------------------------------------------------------------------------------------------------&#xD;&#xA;PostgreSQL 17beta2 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-22), 64-bit&#xD;&#xA;(1 row)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Upgrade de version&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous disposions deja d&amp;#8217;une version PostgreSQL15 sur ce serveur, nous passons par un upgrade via l&amp;#8217;outil &amp;#8220;pg_upgrade&amp;#8221; toujours disponible dans cette nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Lancer pg_upgrade en mode check&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -c -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&#xD;&#xA;.....&#xD;&#xA;.....&#xD;&#xA;&#xD;&#xA;*Clusters are compatible*&#xD;&#xA;&amp;quot;/usr/pgsql-17/bin/pg_ctl&amp;quot; -w -D &amp;quot;/data/postgres/17/pg_data&amp;quot; -o &amp;quot;&amp;quot; -m smart stop  &amp;quot;/data/postgres/17/pg_data/pg_upgrade_output.d/20240708T085906.955/log/pg_upgrade_server.log&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;la log est g√©n√©r√©e dans le $PGDATA de la version 17.&lt;/p&gt;&#xA;&lt;p&gt;Puis lancer l&amp;#8217;ex√©cution de pg_upgrade&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Effectuer une sauvegarde&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Pr√©requis&lt;/h3&gt;&#xA;&lt;p&gt;Avant de pouvoir effectuer une premi√®re sauvegarde avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221; natif, il est primordial de respecter certains pr√©requis important.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;L&amp;#8217;instance PostgreSQL doit √™tre cr√©√©e avec les &amp;#8216;data checksums&amp;#8217; activ√©s. Si ce n&amp;#8217;est pas le cas, utiliser l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_checksums&lt;/strong&gt;&amp;#8221; avec l&amp;#8217;option &amp;#8220;&lt;strong&gt;-e&lt;/strong&gt;&amp;#8220;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Si vous lancez une sauvegarde full puis une incr√©mentale imm√©diatement, vous avez toutes les chances de tomber sur cette erreur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: incremental backups cannot be taken unless WAL summarization is enabled&lt;/pre&gt;&#xA;&lt;p&gt;En effet, pour avoir toutes les informations concernant les blocks modifi√©s, PostgreSQL a besoin de tracer dans les WALs toutes les modifications sur les objets en base.&lt;br /&gt;&#xA;Pour les DBA Oracle, le &amp;#8220;block change tracking&amp;#8221; de la version Enterprise Edition vous parlera tr√®s certainement&amp;#8230;.&lt;br /&gt;&#xA;Il s&amp;#8217;agit ici de la m√™me fonctionnalit√©, c&amp;#8217;est √† dire, tracer les modifications effectu√©es dans les blocks de donn√©es.&lt;br /&gt;&#xA;Cette option est le &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Pour activer l&amp;#8217;option, nous aurons 2 param√®tres √† modifier, soit via un ALTER SYSTEM directement sous psql, ou bien dans le fichier &amp;#8220;postgresql.conf&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres backup]$ vi $PGDATA/postgresql.conf&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;# - WAL Summarization -&#xD;&#xA;&#xD;&#xA;#summarize_wal = off # run WAL summarizer process?&#xD;&#xA;#wal_summary_keep_time = &#39;10d&#39; # when to remove old summary files, 0 = never&lt;/pre&gt;&#xA;&lt;p&gt;Le premier param√®tre permet d&amp;#8217;activer cette option.&lt;br /&gt;&#xA;Le second d√©finit un temps de conservation des informations concernant les blocks modifi√©s entre une sauvegarde FULL et un incr√©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous activons donc l&amp;#8217;option &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8221; et la passons √† &lt;strong&gt;ON&lt;/strong&gt; et laissons √† 10 jours le &amp;#8220;&lt;strong&gt;wal_summary_keep_time&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Attention, activez ces deux param√®tres avant votre premi√®re sauvegarde FULL. Si vous le faites apr√®s, vous risquez de rencontrer l&amp;#8217;erreur suivante&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: WAL summaries are required on timeline 1 from 1/AA000028 to 1/AC000060, but the summaries for that timeline and LSN range are incomplete&#xD;&#xA;DETAIL: The first unsummarized LSN in this range is 1/AA000028.&lt;/pre&gt;&#xA;&lt;p&gt;Le LSN pris lors de la premi√®re sauvegarde FULL n&amp;#8217;est pas reconnu, et donc la sauvegarde incr√©mentale ne peut s&amp;#8217;appuyer dessus.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Red√©marrer l&amp;#8217;instance une fois les modifications effectu√©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data/ restart&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Lancer une sauvegarde FULL&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Voici la nouvelle option pr√©sente pour l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup --help&#xD;&#xA;pg_basebackup takes a base backup of a running PostgreSQL server.&#xD;&#xA;&#xD;&#xA;Usage:&#xD;&#xA;pg_basebackup [OPTION]...&#xD;&#xA;&#xD;&#xA;Options controlling the output:&#xD;&#xA;-D, --pgdata=DIRECTORY receive base backup into directory&#xD;&#xA;-F, --format=p|t output format (plain (default), tar)&#xD;&#xA;-i, --incremental=OLDMANIFEST&#xD;&#xA;take incremental backup&#xD;&#xA;-r, --max-rate=RATE maximum transfer rate to transfer data directory&#xD;&#xA;(in kB/s, or use suffix &amp;quot;k&amp;quot; or &amp;quot;M&amp;quot;)&#xD;&#xA;&#xD;&#xA;.... &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34;&gt;version 13&lt;/a&gt; de PostgreSQL, nous disposons pour chaque sauvegarde, d&amp;#8217;un fichier nomm√© &amp;#8220;backup_manifest&amp;#8221;. Il s&amp;#8217;agit d&amp;#8217;un fichier json qui recense enti√®rement les objets bases de donn√©es sauvegard√©s avec leur emplacement, leur taille, leur date de modification et leur &amp;#8220;checksum&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Celui ci est essentiel pour v√©rifier l&amp;#8217;int√©grit√© de notre sauvegarde avec &amp;#8220;&lt;strong&gt;pg_verifybackup&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Nous pouvons √† pr√©sent faire une premi√®re sauvegarde FULL de notre instance PG17.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17 -F p -l &amp;quot;Full Backup PG17&amp;quot; -P -v&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AD000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8048&amp;quot;&#xD;&#xA;3097788/3097788 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AD000158&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on effectue quelques transactions : cr√©ation d&amp;#8217;une table et insertions de donn√©es sur cette table de test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [manu] $ &amp;gt; create table backup (nom varchar(20), type varchar(20), date_backup date);&#xD;&#xA;CREATE TABLE&#xD;&#xA;Time: 3.344 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;FULL&#39;,&#39;2024-07-08 12:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 3.612 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental&#39;,&#39;2024-07-08 13:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Rep√©rer le fichier &amp;#8220;backup_manifest&amp;#8221; de la sauvegarde FULL r√©alis√©e dans le dossier &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres PG17]$ ls -lrt backup*&#xD;&#xA;-rw-------. 1 postgres postgres 218 Jul 8 09:19 backup_label&#xD;&#xA;-rw-------. 1 postgres postgres 433295 Jul 8 09:20 backup_manifest&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Effectuer une sauvegarde incr√©mentale&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A partir de l√†, lancer une sauvegarde incr√©mentale. Nous utilisons l&amp;#8217;option &amp;#8220;&lt;strong&gt;-i&lt;/strong&gt;&amp;#8221; pour indiquer √† &lt;strong&gt;pg_basebackup&lt;/strong&gt; ou est situ√© le &amp;#8220;backup_manifest&amp;#8221; de la derni√®re sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr -l &amp;quot;Incremental Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AF000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8139&amp;quot;&#xD;&#xA;12485/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AF000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;S&amp;#8217;il l&amp;#8217;on compare les deux r√©pertoires de sauvegardes &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221; et &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8220;, nous voyons que les tailles sont bien diff√©rentes&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;......&#xD;&#xA;3.0G /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;&#xD;&#xA;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17_incr&#xD;&#xA;......&#xD;&#xA;35M /data/postgres/backup/pg_basebackup/PG17_incr&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Un volume de 3Go pour la sauvegarde FULL de l&amp;#8217;instance contre 35Mo pour l&amp;#8217;incr√©mentale.&lt;br /&gt;&#xA;La taille occup√©e par les objets dans chacune des bases est bien plus faible dans la sauvegarde incr√©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous continuons √† ins√©rer des donn√©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; [postgres - ]$ psql -d manu&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&#xD;&#xA;&#xD;&#xA;Time: 0.614 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental 2&#39;,&#39;2024-07-08 14:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.436 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;(3 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on lance une seconde sauvegarde incr√©mentale :&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr_2 -l &amp;quot;Incremental 2 Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17_incr/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/B1000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8313&amp;quot;&#xD;&#xA;12260/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/B1000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous remarquons l&amp;#8217;appel au &amp;#8220;backup manifest&amp;#8221; de la derni√®re sauvegarde incr√©mentale pr√©sente dans le r√©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on regarde la taille de ce nouveau backup&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres pg_basebackup]$ du -h PG17_incr_2&#xD;&#xA;.......&#xD;&#xA;35M PG17_incr_2&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A nouveau 35 Mo, mais vu le peu de modifications effectu√©es, la taille n&amp;#8217;est pas tr√®s repr√©sentative.&lt;/p&gt;&#xA;&lt;p&gt;Ce qu&amp;#8217;il faut retenir, c&amp;#8217;est qu&amp;#8217;en fonction du fichier &amp;#8220;backup manifest&amp;#8221; pris lors de l&amp;#8217;appel √† &lt;strong&gt;pg_basebackup&lt;/strong&gt;, vous pourrez faire soit&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde incr√©mentale qui prendra les derni√®res modifications depuis la derni√®re sauvegarde incr√©mentale effectu√©e.&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde diff√©rentielle qui prendra les modifications faites depuis la derni√®re sauvegarde FULL si vous vous appuyez toujours sur le &amp;#8220;backup manifest&amp;#8221; de votre sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est donc ce fichier json &amp;#8220;backup manifest&amp;#8221; qui a un r√¥le essentiel dans l&amp;#8217;√©laboration de votre strat√©gie de sauvegarde au fur et √† mesure du temps.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Et la restauration , comment ca se passe ?&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on souhaite restaurer tous ces jeux de sauvegardes, nous utilisons un nouvel outil qui est &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Cet outil permet de &amp;#8220;merger&amp;#8221; les diff√©rentes sauvegardes dans un et un seul dossier que l&amp;#8217;on restaurera par la suite.&lt;/p&gt;&#xA;&lt;p&gt;Dans notre exemple, nous avons fait 1 sauvegarde FULL puis 2 incr√©mentales.&lt;br /&gt;&#xA;Nous allons donc restaurer ces 3 jeux de sauvegardes afin de retrouver les donn√©es. A noter qu&amp;#8217;il existe une option &amp;#8220;&amp;#8211;dry-run&amp;#8221; pour tester la commande&lt;/p&gt;&#xA;&lt;p&gt;Ex√©cuter la commande en prenant en param√®tre les dossiers de sauvegardes dans l&amp;#8217;ordre chronologique.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -n -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;Si aucune erreur en sortie, on ex√©cute sans l&amp;#8217;option &amp;#8220;dry run&amp;#8221;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; [postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le r√©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_ALL&lt;/strong&gt;&amp;#8221; ainsi g√©n√©r√©, doit avoir une taille tr√®s l√©g√®rement sup√©rieure au dossier de la sauvegarde FULL.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h PG17_ALL&#xD;&#xA;....&#xD;&#xA;3.0G PG17_ALL&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Derni√®re √©tape, nous passons √† la restauration des donn√©es.&lt;/p&gt;&#xA;&lt;p&gt;Nous arr√™tons l&amp;#8217;instance PG17&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ stop&#xD;&#xA;waiting for server to shut down.... done&#xD;&#xA;server stopped&lt;/pre&gt;&#xA;&lt;p&gt;Nous supprimons les donn√©es dans $PGDATA&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ rm -rf /data/postgres/17/pg_data/* &lt;/pre&gt;&#xA;&lt;p&gt;Puis nous restaurons ce jeu complet de donn√©es avec une simple copie.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ cp -r /data/postgres/backup/pg_basebackup/PG17_ALL/* /data/postgres/17/pg_data/ &lt;/pre&gt;&#xA;&lt;p&gt;Enfin red√©marrons l&amp;#8217;instance&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ start&#xD;&#xA;waiting for server to start....2024-07-08 10:51:45.671 UTC [8909] LOG: redirecting log output to logging collector process&#xD;&#xA;2024-07-08 10:51:45.671 UTC [8909] HINT: Future log output will appear in directory &amp;quot;log&amp;quot;.&#xD;&#xA;done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis contr√¥ler que nous r√©cup√©rons bien toutes les lignes de notre table &amp;#8220;backup&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres@ip-172-44-2-96 pg_basebackup]$ psql -d manu&#xD;&#xA;(postgres@[local]:5437) [manu] primaire $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;Remarques&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Attention, toujours v√©rifier les sauvegardes √† chaque √©tape avec l&amp;#8217;outil &lt;strong&gt;pg_verifybackup &lt;/strong&gt;car rien ne garantit qu&amp;#8217;au moment de l&amp;#8217;appel √† &lt;strong&gt;pg_combinebackup&lt;/strong&gt; les diff√©rents jeux de sauvegardes FULL et/ou incr√©mentales ne soient pas corrompus.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Assurez vous d&amp;#8217;√™tre en mode &amp;#8220;data_checksum&amp;#8221; activ√© et ne pas changer de mode entre les jeux de backup. Le &amp;#8220;backup manifest&amp;#8221; s&amp;#8217;appuie sur ce param√©trage pour valider les checksums de chaque fichier.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le mode TAR pour &lt;strong&gt;pg_basebackup&lt;/strong&gt; n&amp;#8217;est pas compatible pour les sauvegardes full et incr√©mentales m√™me si celui ci est possible. Mais c&amp;#8217;est √† vous de d√©tarer les fichiers &amp;#8220;&lt;strong&gt;base.tar.gz&lt;/strong&gt;&amp;#8221; Et au moment de la restauration¬† avec &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;, une possible corruption est rencontr√©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_all_tar /data/postgres/backup/pg_basebackup/PG17_TAR /data/postgres/backup/pg_basebackup/PG17_incr_TAR&#xD;&#xA;pg_combinebackup: error: could not write to file &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar/base/25284/25332&amp;quot;, offset 122470400: wrote 380928 of 409600&#xD;&#xA;pg_combinebackup: removing output directory &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;La compression a potentiellement ajout√©e une corruption ne rendant pas possible l&amp;#8217;op√©ration de &amp;#8220;merge&amp;#8221; des donn√©es.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La restauration PITR est possible bien entendu. N&amp;#8217;oubliez pas de cr√©er le &amp;#8220;&lt;strong&gt;recovery.signal&lt;/strong&gt;&amp;#8221; dans $PGDATA et de d√©finir dans le fichier &amp;#8220;postgresql.conf&amp;#8221; les quelques param√®tres suivants&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_name¬†&lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_time &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_xid &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_lsn &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_inclusive = off ou on&lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_timeline = &amp;#8216;latest&amp;#8217; &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_action = &amp;#8216;pause&amp;#8217;¬†&lt;/span&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f642.png&#34; alt=&#34;üôÇ&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-la-streaming-replication-en-12/&#34; rel=&#34;bookmark&#34; title=&#34;19 novembre 2019&#34;&gt;PostgreSQL : la streaming replication en 12.&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : pr√©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/oracle-rds-effectuer-des-backup-rman-en-mode-paas/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;Oracle RDS : effectuer des backup RMAN en mode PaaS.&lt;/a&gt; (Emmanuel RAMI) [AWSNon class√©Oracle]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-comparatif-entre-barman-et-pgbackrest/&#34; rel=&#34;bookmark&#34; title=&#34;4 f√©vrier 2020&#34;&gt;PostgreSQL : Comparatif entre Barman et pgBackRest&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/haute-disponibilite-de-postgresql-avec-patroni/&#34; rel=&#34;bookmark&#34; title=&#34;2 f√©vrier 2022&#34;&gt;Haute disponibilit√© de PostgreSQL avec Patroni&lt;/a&gt; (Ludovic AUGEREAU) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.332 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incr√©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&amp;#160; Bonjour Les 11 et 12 juin derniers, nous √©tions aux journ√©es PGDAY √† Lille pour d√©couvrir les nouveaut√©s autour de PostgreSQL. Cette conf√©rence regroupe diff√©rents professionnels, de la communaut√© francophone, qui agissent en contribuant sur des sujets techniques mais&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôarticle &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incr√©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Emmanuel RAMI</name>
    </author>
  </entry>
  <entry>
    <title>Retour sur le DevFest Toulouse 2025</title>
    <updated>2025-11-14T14:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-11-14:/post/devfest-toulouse-2025/</id>
    <link href="http://www.loxodata.com/post/devfest-toulouse-2025/" rel="alternate"></link>
    <summary type="html">&lt;h1 id=&#34;retour-sur-le-devfest-toulouse-2025&#34;&gt;Retour sur le DevFest Toulouse 2025&lt;/h1&gt;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://devfesttoulouse.fr/&#34;&gt;DevFest Toulouse 2025&lt;/a&gt;, organis√© par le &lt;a href=&#34;https://gdg.community.dev/gdg-toulouse/&#34;&gt;GDG Toulouse&lt;/a&gt;,&#xA;s&amp;rsquo;est tenu le jeudi 13 novembre au centre de congr√®s Diagora √† Lab√®ge, dans l&amp;rsquo;Est Toulousain.&lt;/p&gt;&#xA;&lt;p&gt;Il y avait six salles en parall√®le pour offrir des conf√©rences sur des sujets techniques vari√©s allant des langages de programmation, aux m√©thodes de&#xA;d√©veloppement, √† l&amp;rsquo;infrastructure, au frontend et l&amp;rsquo;IA.&lt;/p&gt;&#xA;&lt;p&gt;Une salle d√©di√©e aux sponsors permettait d&amp;rsquo;√©changer avec les √©quipes autour d&amp;rsquo;animations et de caf√©s.&lt;/p&gt;&#xA;&lt;h2 id=&#34;les-conf√©rences&#34;&gt;Les conf√©rences&lt;/h2&gt;&#xA;&lt;p&gt;Au vu du nombre de conf√©rences, il faut faire des choix. Je vous pr√©sente donc ici les conf√©rences auxquelles j&amp;rsquo;ai pu participer durant la journ√©e.&lt;/p&gt;&#xA;&lt;p&gt;Vous pouvez consulter l&amp;rsquo;&lt;a href=&#34;https://devfesttoulouse.fr/agenda-2025/&#34;&gt;agenda complet&lt;/a&gt; pour visualiser la liste compl√®te des conf√©rences.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;http://www.loxodata.com/images/post/devfest-toulouse-2025/dev-fest-toulouse-anotherworld.jpg&#34; alt=&#34;DevFest Toulouse intro&#34;&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;Another World, une belle le√ßon d‚Äôarchitecture logicielle&lt;/em&gt;, Olivier Poncet : la conf√©rence d&amp;rsquo;ouverture permet de revenir sur l&amp;rsquo;architecture du c√©l√®bre jeu &lt;code&gt;Another World&lt;/code&gt;&#xA;cr√©√© par √âric Chahi et de son &lt;a href=&#34;https://github.com/ponceto/another-world-interpreter&#34;&gt;portage&lt;/a&gt; par Olivier pour le faire tourner dans un navigateur avec WebAssembly.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;Docker Bake, √©l√©gance et standardisation pour le build de vos images Docker&lt;/em&gt;, Mazlum Tosun : Mazlum nous pr√©sente l&amp;rsquo;outil &lt;a href=&#34;https://docs.docker.com/build/bake/&#34;&gt;Docker Bake&lt;/a&gt; bas√© sur Docker Buildx&#xA;pour construire vos images Docker de mani√®re d√©clarative avec le format HCL, et de mani√®re concurrente.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;Toute ma stack est dans ma BDD : Postgres et quelques &amp;ldquo;power tools&amp;rdquo; pour mon backend&lt;/em&gt;, Mathieu Passenau et Lo√Øc des Rochettes : Mathieu et Lo√Øc de chez &lt;a href=&#34;https://please-open.it/&#34;&gt;Please-open.it&lt;/a&gt; nous pr√©sentent leur id√©e d&amp;rsquo;utiliser PostgreSQL pour&#xA;toute la pile logiciel, en passant par le stockage, l&amp;rsquo;authentification via Keycloak, l&amp;rsquo;utilisation de fonctions pour la partie contr√¥leur et les APIs via PostgREST.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;Conception de logiciels : le match humains vs AI&lt;/em&gt;, Olivier Azeau : Olivier nous propose de participer √† un quiz sur la conception logiciel et de comparer nos r√©sultats avec ceux obtenus avec l&amp;rsquo;aide de l&amp;rsquo;IA.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;Renovate √† la rescousse : Automatisez la dette technique de votre infra Kubernetes&lt;/em&gt;, Paul Vulliemin : Paul nous propose de d√©couvrir l&amp;rsquo;outil &lt;a href=&#34;https://github.com/renovatebot/renovate&#34;&gt;Renovate&lt;/a&gt; pour la&#xA;mise √† jour des d√©pendances d&amp;rsquo;outils dans le cadre de l&amp;rsquo;Infrastructure as code/Continous delivery avec un cluster Kubernetes.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;Metal-As-A-Service : G√©rer votre bare-metal en MaaS, comme si c&amp;rsquo;√©tait une machine virtuelle !&lt;/em&gt;, Julien Briault : Julien nous pr√©sente le &lt;code&gt;cloud du coeur&lt;/code&gt; mis en place aux restos du coeur et l&amp;rsquo;utilisation&#xA;d&amp;rsquo;un outil open source pour g√©rer ses serveurs physiques aussi simplement qu&amp;rsquo;une machine virtuelle afin de r√©duire les co√ªts d&amp;rsquo;exploitation du mat√©riel.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;REX: une approche moderne de gestion de clusters Kubernetes&lt;/em&gt; : Alexandre Dias et Thomas Martin de chez Qonto nous pr√©sentent leur retour d&amp;rsquo;exp√©rience sur l&amp;rsquo;administration de leurs clusters Kubernetes dans&#xA;une optique de r√©duction des co√ªts, de facilit√© de gestion et de r√©silience de la production.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;em&gt;Beyond agile : Dans les coulisses des licornes g√©antes de la Tech !&lt;/em&gt;, Rachel Dubois : Rachel nous propose une conf√©rence sur les bonnes pratiques utilis√©es par des grandes soci√©t√©s de la tech dans l&amp;rsquo;agilit√©&#xA;afin d&amp;rsquo;innover, et comment √©chouer leur permet de livrer des exp√©riences utilisateurs toujours plus app√©tentes.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;Cette √©dition du DevFest Toulouse montre √† quel point les communaut√©s de d√©veloppeuses et d√©veloppeurs sont dynamiques un peu partout en France.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Conference Europe 2025</title>
    <updated>2025-11-05T10:10:00Z</updated>
    <id>tag:www.loxodata.com,2025-11-05:/post/pgconf-eu-2025-report/</id>
    <link href="http://www.loxodata.com/post/pgconf-eu-2025-report/" rel="alternate"></link>
    <summary type="html">&lt;h1 id=&#34;retour-sur-la-postgresql-conference-europe-2025&#34;&gt;Retour sur la PostgreSQL Conference Europe 2025&lt;/h1&gt;&#xA;&lt;p&gt;Cette ann√©e, la PostgreSQL Conference Europe 2025 s&amp;rsquo;est d√©roul√©e √†&#xA;Riga, en Lettonie. Cet √©v√®nement autour de PostgreSQL rassemble le&#xA;plus grand nombre de participants en Europe.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;http://www.loxodata.com/images/post/pgconf-eu-2025/monument-liberte.jpg&#34; alt=&#34;Le monument de la libert√© √† Riga&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;La liste des conf√©rences est disponible sur le site de&#xA;l&amp;rsquo;√©v√®nement¬†: &lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/&#34;&gt;https://2025.pgconf.eu/&lt;/a&gt;.&#xA;Les supports de pr√©sentations, ainsi que les enregistrements vid√©os sont&#xA;√©galement mis √† disposition dans la mesure du possible.&lt;/p&gt;&#xA;&lt;h2 id=&#34;community-events-day&#34;&gt;Community events day&lt;/h2&gt;&#xA;&lt;p&gt;Le mardi, pour la premi√®re fois cette ann√©e, √©tait consacr√© √† la communaut√©.&lt;/p&gt;&#xA;&lt;p&gt;La journ√©e √©tait d√©coup√©e en ateliers d&amp;rsquo;une demi-journ√©e. Les ateliers √©taient&#xA;aussi divers qu&amp;rsquo;int√©ressants.&lt;/p&gt;&#xA;&lt;p&gt;Le nombre de places √©tait limit√©, ce qui a engendr√© un peu de frustration.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/7150-postgresql-on-kubernetes-summit/&#34;&gt;PostgreSQL on Kubernetes Summit&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;De nombreuses interventions d&amp;rsquo;une dizaine de minutes devaient permettre de&#xA;dresser un √©tat des lieux des op√©rateurs autour de PostgreSQL. Malheureusement,&#xA;la plupart des pr√©sentations ont √©t√© consacr√©es √† l&amp;rsquo;op√©rateur CloudNativePG.&lt;/p&gt;&#xA;&lt;p&gt;Celui-ci pr√©sente toutefois un r√©el int√©r√™t, puisqu&amp;rsquo;il est d√©sormais&#xA;compl√®tement libre.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/7151-community-organizers-conf/&#34;&gt;Community Organizers Conf&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Un atelier √† destination des organisateurs de conf√©rences communautaires, avec&#xA;des conseils int√©ressants, et des retours d&amp;rsquo;exp√©rience.&lt;/p&gt;&#xA;&lt;p&gt;Encore une preuve, s&amp;rsquo;il en fallait que la communaut√© est active et accueillante.&lt;/p&gt;&#xA;&lt;h2 id=&#34;la-conf√©rence&#34;&gt;La conf√©rence&lt;/h2&gt;&#xA;&lt;p&gt;Lors de la premi√®re intervention de la journ√©e, Magnus Hagander a √©voqu√© le&#xA;nombre de 650 participants. Encore une tr√®s nombreuse audience cette ann√©e.&lt;/p&gt;&#xA;&lt;p&gt;La &lt;a href=&#34;https://buff.ly/4b483Ff&#34;&gt;conf√©rence d&amp;rsquo;ouverture&lt;/a&gt; est donn√©e par&#xA;Karen Sandler, de la &lt;a href=&#34;https://sfconservancy.org/&#34;&gt;Software Freedom Conservancy&lt;/a&gt;.&#xA;Le sujet abord√© est celui de l&amp;rsquo;importance des logiciels libres dans le monde actuel.&lt;/p&gt;&#xA;&lt;p&gt;Les conf√©rences sont ensuite r√©parties dans diff√©rentes salles, avec 4&#xA;conf√©rences simultan√©es, dont une r√©serv√©e aux sponsors. Nous r√©sumons&#xA;ici nos notes √† propos des pr√©sentations auxquelles nous avons&#xA;assist√©.&lt;/p&gt;&#xA;&lt;h2 id=&#34;performance&#34;&gt;Performance&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/6952-improved-freezing-in-postgres-vacuum-from-idea-to-commit/&#34;&gt;Improved Freezing in Postgres Vacuum: From Idea to Commit&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;oratrice Melanie Plageman √©voque les travaux entrepris depuis des&#xA;ann√©es pour am√©liorer le freeze des tuples visibles¬†: de nombreuses&#xA;tentatives ont √©t√© abandonn√©es, car les solutions exp√©riment√©es ne sont pas&#xA;toujours meilleures que la situation actuelle.&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, le freeze d&amp;rsquo;un tuple visible consiste √† oublier la&#xA;transaction ayant rendu visible la ligne, permettant ainsi le cycle&#xA;des identifiants de transaction. Un des inconv√©nients de ces t√¢ches de&#xA;maintenance est l&amp;rsquo;amplification en √©criture¬†: une m√™me page de&#xA;donn√©es est √©crite plusieurs fois si n√©cessaire, √† chaque it√©ration&#xA;des maintenances.&lt;/p&gt;&#xA;&lt;p&gt;Finalement, la solution retenue, et livr√©e avec la version 18 de&#xA;PostgreSQL, est de freezer autant que possible les lignes pendant un&#xA;vacuum r√©gulier, diminuant l&amp;rsquo;amplification en √©criture.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://anarazel.de/talks/2025-10-23-pgconf-eu-aio-in-PG-18-and-beyond/aio-in-PG-18-and-beyond.pdf&#34;&gt;AIO in PG 18 and beyond&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Andres Freund est l&amp;rsquo;auteur principal d&amp;rsquo;une nouvelle&#xA;fonctionnalit√© de PostgreSQL 18¬†: les entr√©es-sorties asynchrones.&lt;/p&gt;&#xA;&lt;p&gt;Apr√®s un rappel des enjeux et des possibilit√©s de cette&#xA;fonctionnalit√©, il nous montre les gains potentiels, en int√©grant dans&#xA;le test les travaux en cours pour les futures versions de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;En effet, si la fonctionnalit√© actuelle est limit√©e aux lectures&#xA;s√©quentielles et aux lectures ¬´ bitmap ¬ª des index, les lectures&#xA;index√©es et les √©critures sont pr√©vues pour les versions 19, 20 ou 21&#xA;de PostgreSQL.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/6891/slides/759/fast-path-locking-pg18-pgconfeu-2025.pdf&#34;&gt;Fast-path locking improvements in PG18&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Tomas Vondra est un d√©veloppeur habituel de PostgreSQL et&#xA;s&amp;rsquo;est trouv√© confront√© √† un probl√®me de performance d&amp;rsquo;une requ√™te&#xA;utilisant un grand nombre de partitions. Cela l&amp;rsquo;a amen√© √† se pencher&#xA;sur la fa√ßon dont les verrous sont obtenus lors de l&amp;rsquo;ex√©cution d&amp;rsquo;une&#xA;requ√™te, et en particulier le ¬´ fast-path locking ¬ª. Apparue dans la&#xA;version 9.2 de PostgreSQL, cette fonctionnalit√© permet d&amp;rsquo;avoir un&#xA;cache local de la table des verrous, mais seulement pour 16 objets, ce&#xA;qui pose un probl√®me lorsqu&amp;rsquo;il y a un grand nombre de partitions¬†: les&#xA;verrous sont alors not√©s dans la m√©moire partag√©e, ce qui est plus lent.&lt;/p&gt;&#xA;&lt;p&gt;Tomas Vondra travaille alors pour proposer une solution permettant de&#xA;noter un plus grand nombre de verrous dans ce cache local¬†: la&#xA;proposition, pr√©sente dans PostgreSQL 18, consiste √† utiliser un&#xA;¬´ &lt;a href=&#34;https://en.algorithmica.org/hpc/cpu-cache/associativity/&#34;&gt;set-associative&#xA;cache&lt;/a&gt; ¬ª&#xA;afin d&amp;rsquo;augmenter le nombre d&amp;rsquo;entr√©es possibles avec le m√™me niveau de&#xA;performance.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur constate alors le gain de performance, tr√®s visible dans les&#xA;Flame Graphs pr√©sent√©s. Pour terminer, outre la liste de toutes les&#xA;possibilit√©s que cela ouvre pour les prochaines versions de&#xA;PostgreSQL, Tomas Vondra remercie l&amp;rsquo;auteur original de la&#xA;fonctionnalit√©, Robert Haas, qui a livr√© un code de qualit√©,&#xA;facilitant les am√©liorations propos√©es par la suite, et ce d√©tail est&#xA;tr√®s important pour comprendre pourquoi PostgreSQL est un bon outil¬†:&#xA;il est bien √©crit¬†!&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://resources.pganalyze.com/pganalyze_PGConf_EU_2025_pg_stat_plans.pdf&#34;&gt;Tracking plan shapes over time with Plan IDs and the new pg_stat_plans&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Lukas Fittl explique en quoi une nouvelle fonctionnalit√© de&#xA;PostgreSQL 18 lui a permis de reprendre une id√©e d√©j√† pr√©sente, mais&#xA;en l&amp;rsquo;am√©liorant pour la rendre utilisable.&lt;/p&gt;&#xA;&lt;p&gt;La nouveaut√© de PostgreSQL 18 est la possibilit√© pour une extension de&#xA;stocker un identifiant de plan d&amp;rsquo;ex√©cution, ce qui permet de suivre un&#xA;m√™me plan au cours de l&amp;rsquo;ex√©cution d&amp;rsquo;une requ√™te, √† travers les&#xA;diff√©rents ¬´ hooks ¬ª de PostgreSQL. √Ä cela s&amp;rsquo;ajoute la possibilit√©&#xA;pour une extension d&amp;rsquo;utiliser des statistiques cumulatives.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;extension &lt;a href=&#34;https://github.com/pganalyze/pg_stat_plans&#34;&gt;&lt;code&gt;pg_stat_plans&lt;/code&gt;&lt;/a&gt;&#xA;permet alors de suivre l&amp;rsquo;utilisation des plans d&amp;rsquo;ex√©cution par les requ√™tes&#xA;d&amp;rsquo;une instance PostgreSQL, permettant ainsi des analyses fines des&#xA;performances de nos requ√™tes, sans grever les performances de ces derni√®res.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/7010/slides/799/PgConfEU_MVCC_bmejias_ajaimini.pdf&#34;&gt;We have multiple concurrent versions of this title trying to understand MVCC&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Boriss Mejias revient sur un sujet couramment abord√© dans&#xA;les conf√©rences PostgreSQL, mais toujours n√©cessaire¬†: la gestion de&#xA;la concurrence dans PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;La pr√©sentation revient sur tous les √©l√©ments importants qui sont la&#xA;cons√©quence de l&amp;rsquo;impl√©mentation de MVCC dans PostgreSQL¬†: l&amp;rsquo;isolation&#xA;des transactions, la notion de lignes mortes, les raisons pour&#xA;lesquelles VACUUM est utile et a des cons√©quences, y compris sur la&#xA;r√©plication et le freeze des tuples visibles.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;http://www.loxodata.com/images/post/pgconf-eu-2025/riga-aldaru-iela.jpg&#34; alt=&#34;rue du centre historique de Riga&#34;&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;administration&#34;&gt;Administration&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://drive.google.com/file/d/1iq40z1SEQGUPFrJcAph8Hmw6w7g5-Mig/view?usp=sharing&#34;&gt;What implementing pg_tde taught us about PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Jan Wieremjewicz d√©taille le besoin exprim√© par de plus en&#xA;plus d&amp;rsquo;utilisateurs de PostgreSQL¬†: le chiffrement transparent des&#xA;donn√©es, ou TDE.&lt;/p&gt;&#xA;&lt;p&gt;Entre autres besoins, il nous rappelle que, pour des raisons&#xA;r√®glementaires, le chiffrement sur disque n&amp;rsquo;est plus suffisant, et que&#xA;certains utilisateurs ont maintenant besoin d&amp;rsquo;une solution de&#xA;chiffrement native dans leur base de donn√©es.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur explique alors la d√©marche de recension des besoins des&#xA;utilisateurs pour aboutir √† une solution. Un des besoins identifi√©s&#xA;est d&amp;rsquo;utiliser une solution open-source, et dont le code, √† terme, est&#xA;pr√©sent dans PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Les solutions d√©j√† existantes ne correspondant pas, Percona d√©veloppe&#xA;alors une r√©ponse aux besoins, avec comme objectif l&amp;rsquo;int√©gration dans&#xA;PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;√áa n&amp;rsquo;est pas le cas actuellement¬†: Percona propose une version&#xA;modifi√©e de PostgreSQL et une extension¬†:&#xA;&lt;a href=&#34;https://github.com/percona/pg_tde&#34;&gt;pg_tde&lt;/a&gt;. Deux patchs propos√©s,&#xA;mais pas encore int√©gr√©s sont en effet n√©cessaires pour proposer un&#xA;chiffrement des tables.&lt;/p&gt;&#xA;&lt;p&gt;La solution est donc open-source, et utilisable, dans des limites&#xA;connues, et l&amp;rsquo;objectif de l&amp;rsquo;int√©gration dans PostgreSQL reste √†&#xA;atteindre.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/7191-tde-as-an-extension-a-different-path-for-postgresql-encryption/&#34;&gt;TDE as an Extension: A Different Path for PostgreSQL Encryption&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;√Ä la suite de la pr√©sentation pr√©c√©dente, l&amp;rsquo;orateur Zsolt Parragi&#xA;d√©taille l&amp;rsquo;impl√©mentation actuelle de&#xA;&lt;a href=&#34;https://github.com/percona/pg_tde&#34;&gt;pg_tde&lt;/a&gt;¬†: quel chemin pour y&#xA;arriver, qu&amp;rsquo;est-ce qui fonctionne, que reste-t-il √† faire ?&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/6975/slides/746/pgconfeu25_Postgres_Logparsing.pdf&#34;&gt;Parsing Postgres logs the non-pgBadger way&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Kaarel Moppel pr√©sente les diff√©rentes approches possibles&#xA;pour analyser les logs d&amp;rsquo;une instance PostgreSQL¬†: d&amp;rsquo;outils Unix comme&#xA;sed/awk, en passant par pgBadger jusqu&amp;rsquo;au chargement des logs dans une&#xA;table de PostgreSQL, les possibilit√©s sont nombreuses.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur pr√©sente un nouvel outil¬†:&#xA;&lt;a href=&#34;https://github.com/kmoppel/pgweasel&#34;&gt;pgweasel&lt;/a&gt;, √©crit en GO,&#xA;permettant d&amp;rsquo;extraire des informations agr√©g√©es des fichiers de logs,&#xA;en visant de meilleures performances que les outils existants. Une&#xA;r√©√©criture en Rust permet d&amp;rsquo;ailleurs d&amp;rsquo;√™tre encore plus rapide qu&amp;rsquo;en&#xA;GO.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/7103/slides/780/Barman,%20past,%20present,%20and%20future%20of%20a%20pioneer%20community%20project.pdf&#34;&gt;Barman, past, present, and future of a pioneer community project&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Les orateurs Giulio Calacoci et Mart√≠n Marqu√©s reviennent sur&#xA;l&amp;rsquo;histoire de l&amp;rsquo;outil Barman, connu et utilis√© depuis des ann√©es par&#xA;de nombreux utilisateurs pour mettre en ≈ìuvre leurs strat√©gies de&#xA;sauvegardes et restaurations des instances PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;rsquo;activit√© de l&amp;rsquo;outil, sous-entendu, son d√©veloppement, a √©t√©&#xA;chaotique ces derni√®res ann√©es, il a √©t√© d√©cid√© de relancer, √† travers&#xA;une communaut√© d&amp;rsquo;utilisateurs, la vie de l&amp;rsquo;outil pour r√©pondre aux&#xA;besoins actuels.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/6908/slides/785/20251023_dkrautschick_PGConfEU_KafkaDebeziumForDBPeople.pdf&#34;&gt;Why PostgreSQL people should really care about Kafka and Debezium?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Dirk Krautschick explique le fonctionnement et l&amp;rsquo;utilisation&#xA;du couple Kafka/Debezium pour ¬´ consommer ¬ª les flux de donn√©es d&amp;rsquo;une&#xA;instance PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Debezium est le connecteur utilis√© par Kafka pour consommer les&#xA;donn√©es issues du d√©codage logique des journaux de transactions d&amp;rsquo;une&#xA;instance PostgreSQL. Cela permet de concevoir des architectures de&#xA;donn√©es √©vitant de devoir copier des donn√©es ou requ√™ter une base¬†:&#xA;tous les changements de donn√©es sont envoy√©s dans le flux.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur mentionne pour finir un nouvel outil¬†: &lt;a href=&#34;https://flink.apache.org/&#34;&gt;Apache&#xA;Flink&lt;/a&gt;, con√ßu tr√®s r√©cemment¬†!&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/7094/slides/772/herrera-houska-repack-2025.pdf&#34;&gt;Table repacking, done right&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Les orateurs √Ålvaro Herrera et Antonin Houska d√©taillent un besoin&#xA;tr√®s pr√©sent pour les administrateurs de bases de donn√©es¬†: devoir&#xA;r√©organiser physiquement une table. Apr√®s un historique des&#xA;diff√©rentes solutions pr√©sentes dans PostgreSQL (&lt;code&gt;VACUUM FULL&lt;/code&gt;), les&#xA;orateurs expliquent la difficult√© d&amp;rsquo;int√©grer l&amp;rsquo;outil&#xA;&lt;a href=&#34;https://github.com/cybertec-postgresql/pg_squeeze&#34;&gt;pg_squeeze&lt;/a&gt; dans&#xA;PostgreSQL, ce second outil faisant la m√™me chose que la premi√®re&#xA;commande, mais en minimisant le verrouillage de l&amp;rsquo;objet trait√©.&lt;/p&gt;&#xA;&lt;p&gt;En effet, les orateurs proposent le renommage de &lt;code&gt;VACUUM FULL&lt;/code&gt; et&#xA;l&amp;rsquo;int√©gration de &lt;code&gt;pg_squeeze&lt;/code&gt; dans une commande &lt;code&gt;REPACK&lt;/code&gt; et son option&#xA;&lt;code&gt;CONCURRENTLY&lt;/code&gt;. Le patch est en cours d&amp;rsquo;int√©gration et a besoin de&#xA;testeurs¬†!&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/6817-operational-hazards-of-managing-postgresql-dbs-over-100tb/&#34;&gt;Operational hazards of managing PostgreSQL DBs over 100TB&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;oratrice Teresa Lopes expose un certain nombre de bonnes pratiques √†&#xA;int√©grer lorsque l&amp;rsquo;on s&amp;rsquo;attaque √† des bases d√©passant les 100TB.&lt;/p&gt;&#xA;&lt;p&gt;Parmi les pistes √©voqu√©es, Teresa d√©taille les op√©rations de &lt;code&gt;VACUUM&lt;/code&gt;,&#xA;les sauvegardes, et la r√©organisation des colonnes en fonction de leur&#xA;type.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/6960-have-you-ever-wondered-how-a-cloud-platform-works/&#34;&gt;Have you ever wondered, how a cloud platform works?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Les orateurs Maximilian Stefanac et Philipp Thun pr√©sentent Cloud&#xA;Foundry, PaaS utilis√© par SAP Business Technology, et reposant sur&#xA;PostgreSQL.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/6795-explain-make-it-make-sense/&#34;&gt;EXPLAIN: make it make sense&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Aivars KalvƒÅns explique ce qu&amp;rsquo;on peut retirer comme&#xA;information d&amp;rsquo;un plan d&amp;rsquo;ex√©cution PostgreSQL.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/6825-database-in-distress-testing-and-repairing-different-types-of-database-corruption/&#34;&gt;Database in Distress: Testing and Repairing Different Types of Database Corruption&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Josef Machytka revient sur les cas de corruption qu&amp;rsquo;il a eu&#xA;√† traiter.&lt;/p&gt;&#xA;&lt;p&gt;Il pr√©sente un outil qu&amp;rsquo;il a √©crit pour g√©n√©rer des crashs de bases de donn√©es&#xA;de mani√®re √† √©tudier les solutions envisageables pour corriger les probl√®mes.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;http://www.loxodata.com/images/post/pgconf-eu-2025/fusiliers-lettons.jpg&#34; alt=&#34;Monument d√©di√© aux fusiliers lettons (1915-1920) √† Riga&#34;&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;high-availibility&#34;&gt;High availibility&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgstef.github.io/talks/en/20251022_PGConfEU_Patroni-and-pgBackRest.pdf&#34;&gt;Patroni and pgBackRest: better together&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Stefan Fercot √©voque l&amp;rsquo;int√©gration de deux outils&#xA;compl√©mentaires¬†: Patroni pour la haute disponibilit√© et pgBackRest&#xA;pour les sauvegardes et restauration des instances PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Quelles sont les diff√©rentes √©tapes o√π Patroni utilise pgBackRest¬†:&#xA;archivage, r√©initialisation d&amp;rsquo;un n≈ìud, bootstrap du cluster. On&#xA;comprend que pgBackRest intervient aux moments critiques de la gestion&#xA;des donn√©es de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Un point important not√© par Stefan¬†: pour savoir si tout se passe&#xA;bien, il est essentiel de lire les logs des trois composants impliqu√©s !&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/7134-kubernetes-from-the-database-out/&#34;&gt;Kubernetes from the Database Out&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Alastair Turner explique les points importants √† savoir&#xA;lorsqu&amp;rsquo;on souhaite utiliser PostgreSQL dans un cluster Kubernetes.&lt;/p&gt;&#xA;&lt;p&gt;Quels sont les composants et concepts utilis√©s¬†: r√©seau, stockage,&#xA;automatisation‚Ä¶&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://speakerdeck.com/hugh0capet/hazards-of-logical-decoding-in-postgresql&#34;&gt;Hazards of logical decoding in PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;oratrice Polina Bungina revient sur ce qu&amp;rsquo;implique le d√©codage&#xA;logique dans PostgreSQL, au regard de son exp√©rience chez Zalando. En&#xA;effet, cette technologie est loin d&amp;rsquo;√™tre simple et peut entrainer des&#xA;effets de bords d√©sastreux pour une instance de production.&lt;/p&gt;&#xA;&lt;p&gt;De la d√©finition d&amp;rsquo;un LSN (Log Sequence Number) √† la description d&amp;rsquo;un&#xA;slot et des diff√©rentes informations qui le constitue, on comprend au&#xA;fur et √† mesure les diff√©rents points critiques qui peuvent entrainer&#xA;de vraies difficult√©s en cas de probl√®mes.&lt;/p&gt;&#xA;&lt;p&gt;En effet, une simple commande de maintenance sur une table r√©pliqu√©e&#xA;peut entrainer le stockage d&amp;rsquo;un gros volume de donn√©es, en plus des&#xA;WALs habituels, √† cause du r√©ordonnancement des transactions&#xA;r√©pliqu√©es. Il faut alors surveiller la vue &lt;code&gt;pg_stat_replication_slots&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/7018/slides/771/patroni_talk_pgconf2025.pdf&#34;&gt;Patroni: what the blog posts don&amp;rsquo;t tell you&amp;hellip;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Cameron Murdoch souhaite ajouter quelques points importants&#xA;qu&amp;rsquo;on ne lit pas dans les blogposts habituels sur Patroni, notamment&#xA;la n√©cessit√© de s√©curiser les flux vers les diff√©rents composants d&amp;rsquo;un&#xA;cluster.&lt;/p&gt;&#xA;&lt;p&gt;Cr√©ation d&amp;rsquo;utilisateurs d√©di√©s, de certificats pour des flux s√©curis√©s,&#xA;proc√©dures de mises √† jour des diff√©rents composants¬†: autant de&#xA;points critiques qui doivent faire partie de l&amp;rsquo;int√©gration de Patroni,&#xA;et le plus t√¥t possible pour √©viter d&amp;rsquo;avoir √† corriger plus tard.&lt;/p&gt;&#xA;&lt;h2 id=&#34;autres&#34;&gt;Autres&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://speakerdeck.com/clairegiordano/behind-postgres-18-the-people-the-code-and-the-invisible-work-claire-giordano-pgconfeu-2025&#34;&gt;Behind Postgres 18: The People, the Code, &amp;amp; the Invisible Work&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;oratrice Claire Giordano fait le bilan des nombreuses contributions&#xA;n√©cessaire √† fabriquer PostgreSQL 18¬†: le code, bien s√ªr, mais pas&#xA;seulement¬†: la documentation, les √©v√®nements communautaires, les&#xA;contributions financi√®res¬†: de nombreux acteurs s&amp;rsquo;associent pour former&#xA;une communaut√© riche et diverse !&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/sessions/session/6832/slides/800/all_about_cve_pgconf_eu_2025.pdf&#34;&gt;All about Common Vulnerabilities and exposures in PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;oratrice Priyanka Chatterjee √©voque un aspect mal connu¬†: la gestion&#xA;des vuln√©rabilit√©s dans le projet PostgreSQL. Qu&amp;rsquo;est-ce qu&amp;rsquo;un CVE,&#xA;comment le projet PostgreSQL est organis√© pour r√©pondre, et qu&amp;rsquo;est-ce&#xA;qu&amp;rsquo;un utilisateur doit comprendre des informations publi√©es lors de la&#xA;publication d&amp;rsquo;un correctif de s√©curit√©.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgconfeu2025/schedule/session/7138-from-stars-to-storage-engines-migrating-big-science-workloads-beyond-greenplum/&#34;&gt;From Stars to Storage Engines: Migrating Big Science Workloads Beyond Greenplum&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;orateur Joaquim Oliveira, d√©taille les difficult√©s rencontr√©es par&#xA;l&amp;rsquo;agence spatiale europ√©enne (ESA) suite au rachat de VMware par&#xA;Broadcom, et le passage en produit commercial ferm√© de Greenplum.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;agence a √©tudi√© diff√©rentes solutions pour rester dans un monde&#xA;moins ferm√©. La d√©cision a finalement √©t√© prise de travailler avec la&#xA;solution Warehouse de EDB.&lt;/p&gt;&#xA;&lt;p&gt;Bonne nouvelle, &lt;a href=&#34;https://warehouse-pg.io&#34;&gt;WarehousePG&lt;/a&gt; sur lequel est&#xA;bas√©e l&amp;rsquo;offre d&amp;rsquo;EDB est open source.&lt;/p&gt;&#xA;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;√Ä nouveau, cette conf√©rence a apport√© aux quelques centaines de&#xA;pr√©sents de la mati√®re pour l&amp;rsquo;avenir, en plus des nombreuses&#xA;rencontres et discussions¬†: la communaut√© PostgreSQL est plus riche et&#xA;diverse que jamais !&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Plusieurs √©v√®nements sur Toulouse √† ne pas rater en Novembre</title>
    <updated>2025-10-28T15:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-10-28:/post/events-toulouse-2025/</id>
    <link href="http://www.loxodata.com/post/events-toulouse-2025/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le mois prochain se tiendra deux √©v√®nements sur Toulouse autour du logiciel libre, mais pas seulement :&#xA;j&amp;rsquo;ai nomm√© le &lt;a href=&#34;https://devfesttoulouse.fr/&#34;&gt;DevFest Toulouse&lt;/a&gt; et le &lt;a href=&#34;https://capitoledulibre.org/&#34;&gt;Capitole du Libre&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://devfesttoulouse.fr/&#34;&gt;DevFest Toulouse&lt;/a&gt; organis√© par le &lt;a href=&#34;https://gdg.community.dev/gdg-toulouse/&#34;&gt;GDG Toulouse&lt;/a&gt; qui se tiendra le jeudi 13 novembre √† Diagora (Lab√®ge), un √©v√®nement orient√© plut√¥t d√©veloppement. Un sujet autour de PostgreSQL sera propos√© sur comment constituer toute une pile logicielle avec PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://capitoledulibre.org/&#34;&gt;Capitole du Libre&lt;/a&gt; organis√© par l&amp;rsquo;&lt;a href=&#34;https://toulibre.org/&#34;&gt;association Toulibre&lt;/a&gt; qui aura lieu le weekend du 15 au 16 novembre √† l&amp;rsquo;ENSEEIHT (Toulouse), autour du logiciel libre. Vous pourrez participer par exemple √† un atelier qui pr√©sentera CloudNativePG afin d&amp;rsquo;op√©rer PostgreSQL&#xA;dans un cluster Kubernetes.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;rsquo;en profite pour vous rappeler le red√©marrage des meetups Toulousains de PostgreSQL. Si vous avez rat√© l&amp;rsquo;&lt;a href=&#34;https://www.loxodata.com/post/meetup-toulouse-2025-10/&#34;&gt;√©dition pr√©c√©dente&lt;/a&gt;, √ßa se passait chez &lt;a href=&#34;https://pictarine.com/&#34;&gt;Pictarine&lt;/a&gt; et organis√© par le Toulouse PostgreSQL User Group.&lt;/p&gt;&#xA;&lt;p&gt;Cr√©dits photo : Arthur Chauvineau&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>√âviter les chevauchements temporels</title>
    <updated>2025-10-24T00:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-10-24:/post/without_overlaps/</id>
    <link href="http://www.loxodata.com/post/without_overlaps/" rel="alternate"></link>
    <summary type="html">&lt;!-- raw HTML omitted --&gt;&#xA;&lt;p&gt;&lt;em&gt;Dans un &lt;a href=&#34;../type-range-1&#34;&gt;pr√©c√©dent&lt;/a&gt; article, nous avons pr√©sent√© les&#xA;plages de valeurs. Nous allons voir qu&amp;rsquo;avec ce type de donn√©es, il est possible, entre autres,&#xA;de mettre en place un contr√¥le sur les chevauchements de donn√©es.&#xA;Pour cela, faisons un peu de pratique avec la mise en place du mod√®le de donn√©es d&amp;rsquo;une application de location de&#xA;v√©los, n√©cessitant une gestion de chevauchement des locations et une recherche&#xA;de plages de disponibilit√©.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;Nous comparons la mise en oeuvre et les performances d&amp;rsquo;une plage de&#xA;dates et la gestion d&amp;rsquo;intervalles avec l&amp;rsquo;utilisation de dates de&#xA;d√©but et de fin utilisant les types scalaires traditionnels.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Plusieurs strat√©gies existent :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Deux colonnes : &lt;code&gt;start_datetime&lt;/code&gt; et &lt;code&gt;end_datetime&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;La forme la plus classique consiste √† stocker les bornes dans deux colonnes.&#xA;Le probl√®me : aucune contrainte SQL native n‚Äôemp√™che deux lignes de se chevaucher en combinant deux colonnes.&#xA;Il faut alors recourir √† un d√©clencheur v√©rifiant, √† l‚Äôinsertion ou la mise √† jour, qu‚Äôaucune autre r√©servation n‚Äôentre en conflit.&lt;/p&gt;&#xA;&lt;ol start=&#34;2&#34;&gt;&#xA;&lt;li&gt;Colonnes range + contrainte d‚Äôexclusion&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Une solution plus √©l√©gante, disponible depuis PostgreSQL 9.2, consiste √† utiliser un type &lt;code&gt;range&lt;/code&gt; (&lt;code&gt;tsrange&lt;/code&gt;, &lt;code&gt;tstzrange&lt;/code&gt;, &lt;code&gt;daterange&lt;/code&gt;) et une contrainte d‚Äôexclusion avec un index GiST.&lt;/p&gt;&#xA;&lt;ol start=&#34;3&#34;&gt;&#xA;&lt;li&gt;PostgreSQL 18+ : la clause &lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Depuis PostgreSQL 18, il est d√©sormais possible de d√©clarer cette logique directement dans la cl√© primaire ou une contrainte unique. Pour cela, on utilise la clause&#xA;&lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt; pour la derni√®re colonne de la contrainte d&amp;rsquo;unicit√©.&lt;/p&gt;&#xA;&lt;h2 id=&#34;et-en-pratique&#34;&gt;Et en pratique&lt;/h2&gt;&#xA;&lt;p&gt;Cr√©ons trois tables correspondant aux trois strat√©gies :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;rents_exclude&lt;/code&gt;¬†: contient des locations de v√©los utilisant le type plage de dates et la contrainte d&amp;rsquo;exclusion¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;rents_wo_overlaps&lt;/code&gt;¬†: les m√™mes locations utilisant le type plage de dates et la clause &lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt;¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;rents_2_dates&lt;/code&gt;¬†: les m√™mes locations de v√©los que dans la table &lt;code&gt;rents_exclude&lt;/code&gt; mais en utilisant deux dates.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 id=&#34;avec-deux-dates&#34;&gt;Avec deux dates&lt;/h3&gt;&#xA;&lt;p&gt;Voici comment nous pouvons g√©rer des locations avec une&#xA;date de d√©but et une date de fin utilisant des types &lt;code&gt;timestamptz&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Nous cr√©ons une table contenant l&amp;rsquo;&lt;code&gt;id&lt;/code&gt; de location, les dates et heures de d√©but de la&#xA;location, de fin de la location et l&amp;rsquo;identifiant du v√©lo.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GENERATED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IDENTITY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timestamptz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timestamptz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CONSTRAINT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date_sup_start_date_chk&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CHECK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent2dates_start_datetime_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent2dates_end_datetime_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent2dates_bike_id_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Nous utilisons une contrainte &lt;code&gt;CHECK&lt;/code&gt; pour v√©rifier que &lt;code&gt;end_datetime&lt;/code&gt;&#xA;est sup√©rieure √† &lt;code&gt;start_datetime&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Nous cr√©ons ensuite un d√©clencheur de contr√¥le sur les commandes&#xA;&lt;code&gt;INSERT&lt;/code&gt; et &lt;code&gt;UPDATE&lt;/code&gt;, et sa fonction en langage PL/pgSQL, assurant&#xA;l&amp;rsquo;int√©grit√© des donn√©es. Dans le cas pr√©sent, il s&amp;rsquo;agit d&amp;rsquo;emp√™cher le&#xA;chevauchement de p√©riodes de location pour un m√™me v√©lo¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;check_rent_datetime_validity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TRIGGER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DECLARE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counting_of_existing_rentals&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DECLARE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;number_of_rents&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INTEGER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counting_of_existing_rentals&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;    SELECT COUNT(*) AS count_rent&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        FROM rents_2_dates&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        WHERE (($1 &amp;gt;= start_datetime  AND $1 &amp;lt; end_datetime   )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;                OR ($2 &amp;gt; start_datetime AND $2 &amp;lt; end_datetime  ) )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;        AND bike_id = $3 &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TG_OP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;UPDATE&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXECUTE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counting_of_existing_rentals&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; AND id &amp;lt;&amp;gt; $4&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;number_of_rents&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ELSIF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TG_OP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;INSERT&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXECUTE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;counting_of_existing_rentals&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;number_of_rents&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;number_of_rents&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Cette plage horaire n&amp;#39;&amp;#39;est pas disponible pour bike_id % pour la p√©riode % - % &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NEW&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TRIGGER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trg_check_rent_datetime_validity&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEFORE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EACH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ROW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXECUTE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PROCEDURE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;check_rent_datetime_validity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Maintenant que le d√©clencheur de contr√¥le est pr√™t, passons √† quelques tests.&lt;/p&gt;&#xA;&lt;p&gt;Ins√©rons une location pour le v√©lo d&amp;rsquo;id 7, le 2025-09-01 de 09:00 √† 11:00 et&#xA;de 12:00 √† 18:00¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;2025-09-01&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;09 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;11 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;12 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;18 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RETURNING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Avec l&amp;rsquo;outil &lt;code&gt;psql&lt;/code&gt;, vous pouvez d√©finir des variables lors de la session avec &lt;code&gt;\set&lt;/code&gt;.&#xA;Pour les tests suivants, nous allons affecter &lt;code&gt;test_day&lt;/code&gt; avec la valeur &lt;code&gt;&#39;2025-09-01&#39;::date&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Proc√©dons alors au test d&amp;rsquo;insertion dans une plage horaire d√©j√†&#xA;occup√©e.&#xA;Tentons d&amp;rsquo;ins√©rer une location pour ce m√™me &lt;code&gt;bike_id&lt;/code&gt; de&#xA;10:00 √† 15:00¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;10 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;15 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cette&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;horaire&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;est&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pas&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;disponible&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;la&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p√©riode&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CONTEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pgSQL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;check_rent_datetime_validity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;line&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La fonction de contr√¥le remonte une erreur nous indiquant que la plage horaire n&amp;rsquo;est pas disponible&#xA;et la transaction est annul√©e.&lt;/p&gt;&#xA;&lt;p&gt;Apr√®s le test d&amp;rsquo;insertion, nous faisons un autre test, de mise √† jour cette fois, en √©largissant la p√©riode de la location &lt;code&gt;2&lt;/code&gt; (12:00 √† 18:00) √† 10:00-18:00 empi√©tant sur la location &lt;code&gt;1&lt;/code&gt; (09:00 √† 11:00).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;10 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cette&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plage&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;horaire&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;est&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pas&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;disponible&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pour&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;la&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p√©riode&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CONTEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pgSQL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;check_rent_datetime_validity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;line&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;M√™me ph√©nom√®ne que pr√©c√©demment, le contr√¥le de la contrainte g√©r√© par la fonction annule la mise √† jour et renvoie un message d&amp;rsquo;erreur avec le label d√©fini.&lt;/p&gt;&#xA;&lt;h3 id=&#34;plage-de-dates-et-contraintes-dexclusion&#34;&gt;Plage de dates et contraintes d&amp;rsquo;exclusion&lt;/h3&gt;&#xA;&lt;p&gt;Utilisant le m√™me principe, nous cr√©ons une table en rempla√ßant les deux&#xA;colonnes &lt;code&gt;date&lt;/code&gt; heure de d√©but et de fin par une colonne de type&#xA;&lt;code&gt;range&lt;/code&gt;, ici un &lt;code&gt;TSTZRANGE&lt;/code&gt;¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree_GiST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DROP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXISTS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_exclude&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_exclude&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GENERATED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IDENTITY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TSTZRANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXCLUDE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GiST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;L&amp;rsquo;index cr√©√© est le suivant¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_exclude_rent_dates_bike_id_excl&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXCLUDE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GiST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Nous avons un index multicolonne dont l&amp;rsquo;ordre est rent_dates, bike_id.&lt;/p&gt;&#xA;&lt;p&gt;Pourquoi devons-nous installer l&amp;rsquo;extension &lt;code&gt;btree_GiST&lt;/code&gt;¬†?&#xA;La liste des classes d&amp;rsquo;op√©rateurs pour un index &lt;code&gt;GiST&lt;/code&gt; est assez r√©duite¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index_method&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;opclass_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;indexed_type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------+----------------+---------------+------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;box_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;box&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;circle_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;circle&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;multirange_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;anymultirange&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;point_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;point&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;poly_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;polygon&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;range_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;anyrange&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tsquery_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tsquery&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gist&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tsvector_ops&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tsvector&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;L&amp;rsquo;extension &lt;code&gt;btree_GiST&lt;/code&gt; fournit des classes d&amp;rsquo;op√©rateurs &lt;code&gt;GiST&lt;/code&gt; suppl√©mentaires √©quivalentes √† celui du Btree pour les types de donn√©es num√©riques, temporelles et texte.&#xA;Ces op√©rateurs sont donc utilisables par les index, ce qui permet d&amp;rsquo;affiner la contrainte d&amp;rsquo;exclusion.&#xA;Dans notre cas, en plus de la contrainte de chevauchement &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt; sur la plage de date, on y rajoutera la contrainte de &lt;code&gt;bike_id&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Passons √† quelques tests d&amp;rsquo;insertion et validons le comportement d&amp;rsquo;exclusion.&#xA;Prenons le v√©lo &lt;code&gt;7&lt;/code&gt; n&amp;rsquo;ayant pas d&amp;rsquo;entr√©es dans la table &lt;code&gt;rent_exclude&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Ins√©rons deux locations¬†: une le 2025-09-01 de 09:00 √† 11:00 et une de 12:00 √† 18:00.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;2025-09-01&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_exclude&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TSTZRANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;09 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;11 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TSTZRANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;12 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;18 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RETURNING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 09:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 11:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 12:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 18:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ins√©rons une location pour le v√©lo &lt;code&gt;7&lt;/code&gt; sur une p√©riode d√©j√† occup√©e (12:00 √† 18:00)¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;2025-09-01&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_exclude&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TSTZRANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;11 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;17 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conflicting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;violates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exclusion&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;constraint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_bike_id_rent_dates_excl&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DETAIL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 11:00:00+01&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 17:00:00+01&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conflicts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;existing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 12:00:00+01&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 18:00:00+01&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Comme on le constate, une tentative d&amp;rsquo;insertion a √©chou√© dans un&#xA;cr√©neau d√©j√† occup√© pour le m√™me &lt;code&gt;bike_id&lt;/code&gt; en raison&#xA;de la contrainte d&amp;rsquo;exclusion mise en place.&lt;/p&gt;&#xA;&lt;p&gt;Apr√®s le test d&amp;rsquo;insertion, nous faisons un autre test, de mise √† jour cette fois, en √©largissant la p√©riode de la location &lt;code&gt;2&lt;/code&gt; (12:00 √† 18:00) √† 10:00-18:00 en empi√©tant sur la location &lt;code&gt;1&lt;/code&gt; (09:00 √† 11:00).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_exclude&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TSTZRANGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;10 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_day&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;18 hour&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conflicting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;violates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exclusion&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;constraint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_rent_dates_bike_id_excl&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DETAIL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 10:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 18:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conflicts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;existing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 09:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-09-01 11:00:00+02&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La transaction est annul√©e et un message d&amp;rsquo;erreur nous indique une violation de contrainte, car le cr√©neau est d√©j√† occup√© pour le m√™me &lt;code&gt;bike_id&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;plage-de-dates-et-la-clause-without-overlaps&#34;&gt;Plage de dates et la clause WITHOUT OVERLAPS&lt;/h3&gt;&#xA;&lt;p&gt;√Ä pr√©sent, utilisons la nouvelle fonctionnalit√© &lt;a href=&#34;https://doc.postgresql.fr/18/sql-createtable.html#SQL-CREATETABLE-PARMS-UNIQUE&#34;&gt;&amp;ldquo;WITHOUT OVERLAPS&amp;rdquo;&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Si cette option &lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt; est sp√©cifi√©e pour la derni√®re colonne, celle-ci est alors v√©rifi√©e pour les chevauchements plut√¥t que pour l&amp;rsquo;√©galit√©.&#xA;Dans ce cas, les autres colonnes de la contrainte autorisent les doublons, √† condition qu&amp;rsquo;ils ne se chevauchent pas dans la colonne WITHOUT OVERLAPS.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree_GiST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_wo_overlaps&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GENERATED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IDENTITY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TSTZRANGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UNIQUE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITHOUT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OVERLAPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans ce cas, l&amp;rsquo;index est le suivant¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_wo_overlaps_bike_id_rent_dates_key&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UNIQUE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITHOUT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OVERLAPS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;L&amp;rsquo;ordre des colonnes est diff√©rent de celui cr√©√© pour la table &lt;code&gt;rents_exclude&lt;/code&gt;, nous avons &lt;code&gt;bike_id&lt;/code&gt;, &lt;code&gt;rent_dates&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Comme pour la contrainte d&amp;rsquo;exclusion un index de type &lt;code&gt;GiST&lt;/code&gt; est cr√©√© avec les m√™mes types de contraintes.&#xA;Le comportement est donc le m√™me que pour la table &lt;code&gt;rents_exclude&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;performance-et-taille-sur-le-disque&#34;&gt;Performance et taille sur le disque&lt;/h2&gt;&#xA;&lt;p&gt;Dans cette partie, nous allons contr√¥ler les temps d&amp;rsquo;insertions avec des volumes cons√©quents,&#xA;le volume des index et analyser les temps d&amp;rsquo;ex√©cution des requ√™tes.&lt;/p&gt;&#xA;&lt;h3 id=&#34;performance-en-insertion&#34;&gt;Performance en insertion&lt;/h3&gt;&#xA;&lt;p&gt;La cr√©ation du jeu de donn√©es s&amp;rsquo;est effectu√©e de la fa√ßon suivante¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;insertion de 1000 v√©los de cat√©gorie al√©atoire¬†;&lt;/li&gt;&#xA;&lt;li&gt;cr√©ation de trois locations par jour pour chaque v√©lo sur deux ann√©es calendaires.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Ce qui produit une table avec 2 190 000 entr√©es.&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;Le jeu de test est produit et ins√©r√© sur un ordinateur de bureau avec la configuration par d√©faut de PostgreSQL.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Vous pouvez trouver l&amp;rsquo;ensemble du jeu de test sur notre &lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/&#34;&gt;gitlab&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Tout d&amp;rsquo;abord, comparons les vitesses d&amp;rsquo;insertions¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Insertion dans la table &lt;code&gt;rents_2_dates&lt;/code&gt;, o√π le contr√¥le d&amp;rsquo;int√©grit√© des donn√©es se fait par une fonction d√©clencheur¬†:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;track_functions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pl&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_stat_reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2190000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;244937&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;342&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;937&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&#xA;&lt;li&gt;Insertion dans la table &lt;code&gt;rents_exclude&lt;/code&gt;, o√π le contr√¥le d&amp;rsquo;int√©grit√© des donn√©es se fait par contrainte d&amp;rsquo;exclusion¬†:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_exclude&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2190000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;148393&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;870&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;28&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;394&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&#xA;&lt;li&gt;Insertion dans la table &lt;code&gt;rents_wo_overlaps&lt;/code&gt;, o√π le contr√¥le d&amp;rsquo;int√©grit√© des donn√©es se fait par contrainte d&amp;rsquo;exclusion et clause &lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt;¬†:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_wo_overlaps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2190000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;119230&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;806&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;59&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;231&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Les op√©rations d‚Äôinsertion sont plus performantes avec le type range, dans la mesure o√π le contr√¥le d‚Äôint√©grit√© est assur√© directement par la contrainte d‚Äôexclusion.&#xA;En revanche, dans la table &lt;code&gt;rents_2_date&lt;/code&gt;, ce contr√¥le est effectu√© par un d√©clencheur qui v√©rifie pour chaque ligne ins√©r√©e ou mise √† jour,&#xA;l‚Äôabsence de tout chevauchement avec les enregistrements existants.&lt;/p&gt;&#xA;&lt;p&gt;Il est possible d&amp;rsquo;obtenir certaines informations sur le temps d&amp;rsquo;ex√©cution de la fonction gr√¢ce √† la vue&#xA;&lt;code&gt;pg_stat_user_functions&lt;/code&gt;. Pour cela, il faut activer le param√®tre &lt;code&gt;track_functions&lt;/code&gt; dans la configuration de l&amp;rsquo;instance.&lt;/p&gt;&#xA;&lt;p&gt;Dans notre cas, nous avons activ√© le tra√ßage sur les fonctions &lt;code&gt;PL/pgSQL&lt;/code&gt; dans la transaction d&amp;rsquo;insertion des donn√©es via la commande¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;track_functions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pl&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Apr√®s l&amp;rsquo;import des donn√©es, voici les informations¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;funcname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;calls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;self_time&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; milliseconds&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;as&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;self_time&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_stat_user_functions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;funcname&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;calls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;self_time&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;check_rent_datetime_validity&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2190000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;03&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;51&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;925302&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îÇ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Le temps total d&amp;rsquo;insertion est de 04 min 05s. 03 min 52s sont occup√©es par&#xA;le traitement de la fonction, soit plus de 90% du temps.&lt;/p&gt;&#xA;&lt;h3 id=&#34;volume-des-index&#34;&gt;Volume des index&lt;/h3&gt;&#xA;&lt;p&gt;L&amp;rsquo;index &lt;code&gt;GiST&lt;/code&gt; est une structure arborescente √©quilibr√©e comme le &lt;code&gt;Btree&lt;/code&gt; contenant&#xA;des paires &lt;code&gt;cl√©, pointeur&lt;/code&gt;, mais les cl√©s &lt;code&gt;GiST&lt;/code&gt; sont plus complexes qu&amp;rsquo;un &lt;code&gt;Btree&lt;/code&gt;,&#xA;ce qui am√®ne un volume plus important.&lt;/p&gt;&#xA;&lt;p&gt;D&amp;rsquo;un c√¥t√©, les tables &lt;code&gt;rents_exclude&lt;/code&gt; et &lt;code&gt;rents_wo_overlaps&lt;/code&gt; disposent d&amp;rsquo;un seul index &lt;code&gt;GiST&lt;/code&gt; sp√©cifique pour le range¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_pkey&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_bike_id_rent_dates_excl&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXCLUDE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GiST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;De l&amp;rsquo;autre, la table &lt;code&gt;rents_2_dates&lt;/code&gt; avec trois index de type &lt;code&gt;Btree&lt;/code&gt;¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_2_dates_pkey&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rent2dates_end_datetime_idx&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rent2dates_start_datetime_idx&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tart_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rent2dates_bike_id_idx&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stat_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On trouve ci-dessous un tableau donnant par table le volume des donn√©es et le volume des index¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ             table_name              ‚îÇ table_size ‚îÇ indexes_size ‚îÇ total_size ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ams_rent_bike&amp;#34;&lt;/span&gt;.&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_exclude&amp;#34;&lt;/span&gt;     ‚îÇ &lt;span class=&#34;m&#34;&gt;126&lt;/span&gt; MB     ‚îÇ &lt;span class=&#34;m&#34;&gt;222&lt;/span&gt; MB       ‚îÇ &lt;span class=&#34;m&#34;&gt;348&lt;/span&gt; MB     ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ams_rent_bike&amp;#34;&lt;/span&gt;.&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_2_dates&amp;#34;&lt;/span&gt;     ‚îÇ &lt;span class=&#34;m&#34;&gt;126&lt;/span&gt; MB     ‚îÇ &lt;span class=&#34;m&#34;&gt;97&lt;/span&gt; MB        ‚îÇ &lt;span class=&#34;m&#34;&gt;223&lt;/span&gt; MB     ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ams_rent_bike&amp;#34;&lt;/span&gt;.&lt;span class=&#34;s2&#34;&gt;&amp;#34;rents_wo_overlaps&amp;#34;&lt;/span&gt; ‚îÇ &lt;span class=&#34;m&#34;&gt;126&lt;/span&gt; MB     ‚îÇ &lt;span class=&#34;m&#34;&gt;229&lt;/span&gt; MB       ‚îÇ &lt;span class=&#34;m&#34;&gt;354&lt;/span&gt; MB     ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Voyons maintenant le volume de chaque index¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ     rel_name      ‚îÇ                index_name                ‚îÇ type_index ‚îÇ  size  ‚îÇ       columns       ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ rents_wo_overlaps ‚îÇ rents_wo_overlaps_bike_id_rent_dates_key ‚îÇ GiST       ‚îÇ &lt;span class=&#34;m&#34;&gt;182&lt;/span&gt; MB ‚îÇ rent_dates, bike_id ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ rents_exclude     ‚îÇ rents_exclude_rent_dates_bike_id_excl    ‚îÇ GiST       ‚îÇ &lt;span class=&#34;m&#34;&gt;173&lt;/span&gt; MB ‚îÇ rent_dates, bike_id ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ rents_2_dates     ‚îÇ rent2dates_start_datetime_idx            ‚îÇ btree      ‚îÇ &lt;span class=&#34;m&#34;&gt;17&lt;/span&gt; MB  ‚îÇ start_datetime      ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ rents_2_dates     ‚îÇ rent2dates_end_datetime_idx              ‚îÇ btree      ‚îÇ &lt;span class=&#34;m&#34;&gt;17&lt;/span&gt; MB  ‚îÇ end_datetime        ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îÇ rents_2_dates     ‚îÇ rent2dates_bike_id_idx                   ‚îÇ btree      ‚îÇ &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; MB  ‚îÇ bike_id             ‚îÇ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans notre cas, nous comparons le volume de la somme des trois index &lt;code&gt;btree&lt;/code&gt; li√©s au stockage sur 2&#xA;colonnes avec le volume de l&amp;rsquo;index &lt;code&gt;GiST&lt;/code&gt; de la contrainte d&amp;rsquo;exclusion et avec l&amp;rsquo;index &lt;code&gt;GisT&lt;/code&gt; de la&#xA;contrainte d&amp;rsquo;unicit√© (qui utilise &lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt;).&#xA;Comme nous l&amp;rsquo;avons indiqu√© plus haut, la cl√© dans ce dernier cas contient √† la fois les donn√©es de la plage de date et le &lt;code&gt;bike_id&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le volume est diff√©rent entre les index &lt;code&gt;GiST&lt;/code&gt; car l&amp;rsquo;ordre des colonnes n&amp;rsquo;est pas le m√™me.&#xA;On s&amp;rsquo;aper√ßoit √©galement que chaque index &lt;code&gt;GiST&lt;/code&gt; est 3x plus volumineux que la somme des 3 index &lt;code&gt;Btree&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;performance-de-recherche&#34;&gt;Performance de recherche&lt;/h2&gt;&#xA;&lt;p&gt;Voyons √† pr√©sent une mise en situation. Nous souhaitons conna√Ætre les disponibilit√©s des v√©los sur une journ√©e donn√©e.&lt;/p&gt;&#xA;&lt;p&gt;Vous trouverez les requ√™tes dans les liens suivants¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/queries/available_with_range_exclude.sql&#34;&gt;available_with_range_exclude.sql&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/queries/available_with_range_without_overlaps.sql&#34;&gt;available_with_range_without_overlaps.sql&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/queries/available_with_2_dates.sql&#34;&gt;available_with_2_dates.sql&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Les structures des requ√™tes sont assez proches les unes des autres¬†; leur but est de&#xA;contr√¥ler le bon usage des index et de comparer les temps des r√©ponses.&lt;/p&gt;&#xA;&lt;p&gt;En ce qui concerne les performances, l&amp;rsquo;avantage est donn√© √† l&amp;rsquo;utilisation de deux colonnes.&lt;/p&gt;&#xA;&lt;!-- raw HTML omitted --&gt;&#xA;&lt;table&gt;&#xA;&lt;thead&gt;&#xA;&lt;tr&gt;&#xA;&lt;th&gt;Table&lt;/th&gt;&#xA;&lt;th&gt;Temps&lt;/th&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/thead&gt;&#xA;&lt;tbody&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_2_dates&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;10 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_exclude&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;15 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_wo_overlaps&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;30 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;La diff√©rence de temps entre &lt;code&gt;rents_exclude&lt;/code&gt; et &lt;code&gt;rents_wo_overlaps&lt;/code&gt; est d√ª a l&amp;rsquo;ordre des colonnes dans l&amp;rsquo;index.&lt;/p&gt;&#xA;&lt;p&gt;Vous pouvez trouver les r√©sultats des &lt;code&gt;EXPLAIN (ANALYSE, buffers)&lt;/code&gt; ici¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/explain_analyse/available_period_with_2_dates.txt&#34;&gt;available_period_with_2_dates.txt&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/explain_analyse/available_period_with_range_exclude.txt&#34;&gt;available_period_with_range_exclude.txt&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/explain_analyse/available_period_with_range_without_overlaps.txt&#34;&gt;available_period_with_range_without_overlaps.txt&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Prenons un autre exemple, la liste des r√©servations pour une liste de v√©los sur une p√©riode donn√©e¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;search_range&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TSTZRANGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;2025-09-01&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;09 hour&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;2025-09-01&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39; 20 hour&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYSE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BUFFERS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;search_range&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vstart_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;2025-09-01&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;09 hour&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vend_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;2025-09-01&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;20 hour&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYSE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BUFFERS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vstart_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vend_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vstart_datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vend_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans ce cas, la lecture des plans d&amp;rsquo;ex√©cutions nous indique que, pour l&amp;rsquo;interrogation des donn√©es dans la table &lt;code&gt;rents_2_dates&lt;/code&gt;, PostgreSQL parcourt trois index¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;rent2dates_start_datetime_idx&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;rent2dates_end_datetime_idx&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;rent2dates_bike_id_idx&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Ces informations sont visibles dans le fichier &lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/explain_analyse/rents_for_period_some_bikes_2_dates.txt?ref_type=heads&#34;&gt;rents_for_period_some_bikes_2_dates.txt&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Pour la recherche dans la table &lt;code&gt;rents_exclude&lt;/code&gt;, il n&amp;rsquo;y a qu&amp;rsquo;un parcours d&amp;rsquo;index¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;rents_bike_id_rent_dates_excl&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Ces informations sont visibles dans le fichier &lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/explain_analyse/rents_for_period_some_bikes_range_exclude.txt?ref_type=heads&#34;&gt;rents_for_period_some_bikes_range_exclude.txt&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;De plus, nous pouvons constater que moins de blocs de donn√©es sont lus.&lt;/p&gt;&#xA;&lt;p&gt;Pour la recherche dans la table &lt;code&gt;rents_wo_overlaps&lt;/code&gt;, il n&amp;rsquo;y a qu&amp;rsquo;un parcours d&amp;rsquo;index¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;rents_wo_overlaps_bike_id_rent_dates_key&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Ces informations sont visibles dans le fichier &lt;a href=&#34;https://gitlab.com/loxo-articles/without_overlaps/-/raw/main/rents_for_period_some_bikes_range_without_overlaps.txt?ref_type=heads&#34;&gt;rents_for_period_some_bikes_range_exclude.txt&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Dans notre exemple avec une clause where &lt;code&gt;bike_id &amp;lt; 100&lt;/code&gt;, le r√©sultat est le suivant¬†:&lt;/p&gt;&#xA;&lt;table&gt;&#xA;&lt;thead&gt;&#xA;&lt;tr&gt;&#xA;&lt;th&gt;Table&lt;/th&gt;&#xA;&lt;th&gt;Temps&lt;/th&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/thead&gt;&#xA;&lt;tbody&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_2_dates&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;8 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_exlude&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;0.7 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_wo_overlaps&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;4 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;En regardant de plus pr√®s le plan d&amp;rsquo;ex√©cution, une piste d&amp;rsquo;am√©lioration sur la requ√™te avec deux dates serait d&amp;rsquo;ajouter un index sur les trois colonnes &lt;code&gt;start_datetime&lt;/code&gt;, &lt;code&gt;end_datetime&lt;/code&gt;, &lt;code&gt;bike_id&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent2dates_start_end_bike_id_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_2_dates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_datetime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Effectivement le temps d&amp;rsquo;ex√©cution est am√©lior√©, car la requ√™te r√©pond en 1.7ms.&#xA;N√©anmoins, dans ce cas, l&amp;rsquo;index ajoute un volume de 85Mo.&lt;/p&gt;&#xA;&lt;p&gt;Voir le fichier &lt;a href=&#34;https://gitlab.com/loxo-articles/type-range/blob/master/explain_analyse/rents_for_period_some_bikes_2_date_optim.txt&#34;&gt;rents_for_period_some_bikes_2_date_optim.txt&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Idem pour la table &lt;code&gt;rents_wo_overlaps&lt;/code&gt; en cr√©ant un index GiST (rent_dates, bike_id).&lt;/p&gt;&#xA;&lt;p&gt;Voici le plan &lt;a href=&#34;https://gitlab.com/loxo-articles/type-range/blob/master/explain_analyse/rents_for_period_some_bikes_range_wo_overlaps_optim.txt&#34;&gt;d&amp;rsquo;execution&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_wo_overlaps_rents_date_bike_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rents_wo_overlaps&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GiST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rent_dates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bike_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Le temps d&amp;rsquo;ex√©cution est de 0.5ms contre 4ms, mais nous rajoutons un index de 112 Mo.&lt;/p&gt;&#xA;&lt;p&gt;Apr√®s l&amp;rsquo;ajout des index, nous avons les temps suivants¬†:&lt;/p&gt;&#xA;&lt;table&gt;&#xA;&lt;thead&gt;&#xA;&lt;tr&gt;&#xA;&lt;th&gt;Table&lt;/th&gt;&#xA;&lt;th&gt;Temps&lt;/th&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/thead&gt;&#xA;&lt;tbody&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_2_dates&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;1.7 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_exlude&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;0.7 ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;&lt;code&gt;rents_wo_overlaps&lt;/code&gt;&lt;/td&gt;&#xA;&lt;td&gt;&lt;strong&gt;0.5ms&lt;/strong&gt;&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;La gestion des chevauchements temporels est un sujet qui peut devenir un vrai casse-t√™te lorsqu‚Äôil s‚Äôagit de mod√©liser des r√©servations, des plannings ou des p√©riodes de validit√©.&#xA;Le type range facilite la manipulation des donn√©es.&lt;/p&gt;&#xA;&lt;p&gt;Il apporte notamment un avantage ind√©niable¬†: le contr√¥le de l&amp;rsquo;int√©grit√© des donn√©es, enti√®rement g√©r√© par la base de donn√©es.&#xA;M√™me si l&amp;rsquo;utilisation du type &lt;code&gt;TSTZRANGE&lt;/code&gt; ne semble pas naturelle de prime abord,&#xA;nous pouvons observer qu&amp;rsquo;une fois mis en place, ce type et les index &lt;code&gt;GiST&lt;/code&gt; proposent un ensemble concis et √©l√©gant √† l&amp;rsquo;utilisation.&lt;/p&gt;&#xA;&lt;p&gt;La nouvelle fonctionnalit√© &lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt; apporte une √©criture simplifi√©e mais impose que la contrainte de non-chevauchement se trouve sur la derni√®re colonne.&#xA;Dans notre cas, nous avons d√ª cr√©er un autre index composite avec une meilleure s√©lectivit√© sur les premi√®res colonnes.&lt;/p&gt;&#xA;&lt;p&gt;En ce qui concerne les tests de performance en insertion, l&amp;rsquo;avantage est en faveur du type range. La contrainte d&amp;rsquo;exclusion √©tant int√©gr√©e, elle rend l&amp;rsquo;op√©ration 2,4 fois plus rapide.&lt;/p&gt;&#xA;&lt;p&gt;Le volume sur disque d&amp;rsquo;un index GiST est deux √† trois fois plus volumineux que la somme des trois index Btree de notre exemple.&lt;/p&gt;&#xA;&lt;p&gt;Pour l&amp;rsquo;ex√©cution des requ√™tes, nous avons test√© deux profils de requ√™te¬†: un complexe (CTE, jointure, etc.) et un plus simple (un &lt;code&gt;WHERE&lt;/code&gt; dans la table de location).&#xA;On se rend compte qu&amp;rsquo;il n&amp;rsquo;y a pas de grandes diff√©rences sur les temps d&amp;rsquo;ex√©cution.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Meetups PostgreSQL √† Toulouse : c&#39;est reparti !</title>
    <updated>2025-10-10T13:11:00Z</updated>
    <id>tag:www.loxodata.com,2025-10-10:/post/meetup-toulouse-2025-10/</id>
    <link href="http://www.loxodata.com/post/meetup-toulouse-2025-10/" rel="alternate"></link>
    <summary type="html">&lt;h2 id=&#34;meetup-pg_ctl-restart--d-toulouse&#34;&gt;Meetup &lt;code&gt;pg_ctl restart -D Toulouse&lt;/code&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Par le pass√©, des meetups PostgreSQL ont eu lieu √† Toulouse.&#xA;L&amp;rsquo;initiative s&amp;rsquo;est essouffl√©e et la pand√©mie est pass√©e par l√†.&lt;/p&gt;&#xA;&lt;p&gt;Mais&#xA;en novembre 2025, au &lt;a href=&#34;../feedback-cdl-2024&#34;&gt;Capitole du Libre&lt;/a&gt;,&#xA;Geoffrey de &lt;a href=&#34;https://pictarine.com&#34;&gt;Pictarine&lt;/a&gt; est venu vers moi apr√®s&#xA;une conf√©rence en √©voquant la possibilit√© de relancer cette&#xA;initiative. J&amp;rsquo;ai dit ¬´¬†banco!¬†¬ª.&lt;/p&gt;&#xA;&lt;p&gt;En juin, Pictarine nous donnait son&#xA;feu vert pour effectuer cette rencontre dans leurs locaux √† Lab√®ge&#xA;Innopole, et nous nous sommes lanc√©s dans l&amp;rsquo;organisation de&#xA;l&amp;rsquo;√©v√©nement.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela, nous avions, Geoffrey et moi, chacun un sujet¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Geoffrey a propos√© une pr√©sentation de la migration de 10 ann√©es de&#xA;business de Datastore vers PostgreSQL. Il y explique les enjeux,&#xA;la strat√©gie et les enseignements de cet exercice qui fut un succ√®s&#xA;pour Pictarine¬†;&lt;/li&gt;&#xA;&lt;li&gt;Pour ma part, j&amp;rsquo;ai pr√©sent√© les grandes nouveaut√©s de PostgreSQL&#xA;18¬†(dont le support peut √™tre &lt;a href=&#34;http://www.loxodata.com/downloads/slides/2025-10-09-Quoi-de-neuf-dans-postgresql-18.pdf&#34;&gt;t√©l√©charg√©&#xA;ici&lt;/a&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Pour une reprise, c&amp;rsquo;est une r√©ussite : 22 fans de PostgreSQL ont&#xA;particip√© √† l&amp;rsquo;√©v√©nement !&lt;/p&gt;&#xA;&lt;p&gt;Apr√®s une br√®ve&#xA;&lt;a href=&#34;http://www.loxodata.com/downloads/slides/2025-10-09-meetup-tls-intro.pdf&#34;&gt;introduction&lt;/a&gt; sur&#xA;le d√©roulement du meetup, Geoffrey avons encha√Æn√© nos pr√©sentations.&#xA;La soir√©e s&amp;rsquo;est termin√©e par un ap√©ritif d√Ænatoire avec des&#xA;discussions sur l&amp;rsquo;utilisation de notre SGBD pr√©f√©r√©. Nous avons&#xA;√©galement parl√© de pouvoir participer au &lt;a href=&#34;https://devfesttoulouse.fr/&#34;&gt;DevFest&#xA;Toulouse&lt;/a&gt; cette ann√©e. De nombreuses&#xA;connexions se sont cr√©√©es lors de cet √©v√©nement.&lt;/p&gt;&#xA;&lt;p&gt;Je tiens √† remercier encore une fois Pictarine d&amp;rsquo;avoir rendu ce&#xA;meetup possible en nous proposant ses locaux et en sponsorisant&#xA;l&amp;rsquo;ap√©ritif d√Ænatoire.&lt;/p&gt;&#xA;&lt;p&gt;Nous nous sommes entendus pour organiser le prochain meetup dans le&#xA;courant du mois de janvier 2026.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Restauration Point-In-Time d‚Äôun cluster Patroni avec pgBackRest</title>
    <updated>2025-10-02T06:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-10-02:/post/pitr-with-patroni/</id>
    <link href="http://www.loxodata.com/post/pitr-with-patroni/" rel="alternate"></link>
    <summary type="html">&lt;h1 id=&#34;restauration-point-in-time-dun-cluster-patroni-avec-pgbackrest&#34;&gt;Restauration Point-In-Time d‚Äôun cluster Patroni avec pgBackRest&lt;/h1&gt;&#xA;&lt;p&gt;Dans un &lt;a href=&#34;../logical-replication-with-patroni/&#34;&gt;article pr√©c√©dent&lt;/a&gt;, nous avons vu comment mettre en place une r√©plication logique avec &lt;strong&gt;Patroni&lt;/strong&gt;. Nous allons voir les m√©thodes de  &lt;strong&gt;restauration √† un instant donn√©&lt;/strong&gt; (PITR - Point-In-Time Recovery) avec ce m√™me outil.&lt;/p&gt;&#xA;&lt;p&gt;Gr√¢ce √† l‚Äôint√©gration de &lt;strong&gt;pgBackRest&lt;/strong&gt; et &lt;strong&gt;Patroni&lt;/strong&gt;, il est possible de reconstruire proprement un cluster en cas de suppression ou corruption de donn√©es ‚Äî tout en remontant pr√©cis√©ment √† une date ou une transaction cible.&lt;/p&gt;&#xA;&lt;h2 id=&#34;pr√©requis-pour-la-restauration-pitr&#34;&gt;Pr√©requis pour la restauration PITR&lt;/h2&gt;&#xA;&lt;p&gt;Avant toute tentative de restauration temporelle, assurez-vous que :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;pgBackRest est correctement configur√©&lt;/strong&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;L‚Äôarchivage des WAL est activ√©&lt;/strong&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Au moins une sauvegarde compl√®te est disponible&lt;/strong&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;mise-en-situation--suppression-de-donn√©es&#34;&gt;Mise en situation : suppression de donn√©es&lt;/h2&gt;&#xA;&lt;p&gt;Cr√©ons une base de test et ins√©rons quelques lignes dans une table :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DATABASE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pitr_test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pitr_test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mytable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;payload&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inserted_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mytable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;text_&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mytable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;R√©sultat :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; id | payload |        inserted_at&#xA;----+---------+---------------------------&#xA;  0 | text_0  | 2025-07-21 09:14:15.78179&#xA;...&#xA; 10 | text_10 | 2025-07-21 09:14:15.78179&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;La transaction d‚Äôinsertion est identifiable via le champ &lt;code&gt;xmin&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;xmin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;xmax&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mytable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; xmin | xmax | id | payload | inserted_at&#xA;------+-------+----+---------+----------------------------&#xA;  752 |     0 |  0 | text_0  | 2025-07-21 09:14:15.78179&#xA;...&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Supposons qu‚Äôune action destructive intervienne :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;TRUNCATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mytable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On force ensuite l&amp;rsquo;√©criture des journaux de transaction pour garantir leur archivage :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_switch_wal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h2 id=&#34;√©tapes-de-restauration&#34;&gt;√âtapes de restauration&lt;/h2&gt;&#xA;&lt;p&gt;Nous vous proposons deux m√©thodes afin de restaurer vos instances √† la cible&#xA;voulue.&lt;/p&gt;&#xA;&lt;h3 id=&#34;m√©thode-1--restauration-manuelle-du-primaire&#34;&gt;M√©thode 1 : restauration manuelle du primaire&lt;/h3&gt;&#xA;&lt;h4 id=&#34;1-identifier-le-n≈ìud-primaire&#34;&gt;1. Identifier le n≈ìud primaire&lt;/h4&gt;&#xA;&lt;p&gt;Dans notre exemple, le primaire est &lt;code&gt;pgdeb01&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patronictl -c /etc/patroni/config.yml topology&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+ Cluster: loxodemo &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7427142939826752414&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Member    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Host        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Role    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; State     &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; TL &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Lag in MB &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+-----------+-------------+---------+-----------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; pgdeb01   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.11 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Leader  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; running   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; + pgdeb02 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.12 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Replica &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; streaming &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;         &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; + pgdeb03 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.13 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Replica &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; streaming &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;         &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+-----------+-------------+---------+-----------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;2-stopper-patroni-sur-les-r√©plicas&#34;&gt;2. Stopper Patroni sur les r√©plicas&lt;/h4&gt;&#xA;&lt;p&gt;Dans notre exemple, sur &lt;code&gt;pgdeb02&lt;/code&gt; et &lt;code&gt;pgdeb03&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl stop patroni&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;3-stopper-patroni-sur-le-primaire&#34;&gt;3. Stopper Patroni sur le primaire&lt;/h4&gt;&#xA;&lt;p&gt;Une fois arr√™t√©, le cluster doit appara√Ætre vide :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patronictl -c /etc/patroni/config.yml topology&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+ Cluster: loxodemo &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7427142939826752414&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Member &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Host &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Role &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; State &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; TL &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Lag in MB &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+--------+------+------+-------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+--------+------+------+-------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;4-restaurer-les-donn√©es-sur-le-futur-primaire&#34;&gt;4. Restaurer les donn√©es sur le futur primaire&lt;/h4&gt;&#xA;&lt;p&gt;On peut choisir n&amp;rsquo;importe quel n≈ìud du cluster patroni pour effectuer cette op√©ration.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pgbackrest --stanza&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;loxodemo --delta restore &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --target&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2025-07-21 09:14:16.78179+00&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --target-action&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;promote&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;5-lancer-postgresql-localement-sans-patroni&#34;&gt;5. Lancer PostgreSQL localement (sans Patroni)&lt;/h4&gt;&#xA;&lt;p&gt;Cette op√©ration s&amp;rsquo;effectue toujours sur le futur primaire.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;su - postgres -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/lib/postgresql/16/bin/postgres -D /data/postgres/loxodemo ...&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;6-v√©rifier-les-logs-de-postgresql&#34;&gt;6. V√©rifier les logs de PostgreSQL&lt;/h4&gt;&#xA;&lt;p&gt;Extrait typique indiquant la fin de la restauration :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;recovery stopping before commit of transaction 753&#xA;last completed transaction was at log time 2025-07-21 09:14:15.792863+00&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;7-v√©rifier-les-donn√©es-restaur√©es&#34;&gt;7. V√©rifier les donn√©es restaur√©es&lt;/h4&gt;&#xA;&lt;p&gt;Dans un autre terminal, lancez &lt;code&gt;psql&lt;/code&gt; sur la base √† v√©rifier.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;pitr_test&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mytable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;payload&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inserted_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;----+---------+---------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text_10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2025&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;07&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;78179&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Les donn√©es ins√©r√©es √† &lt;code&gt;09:14:15&lt;/code&gt; sont bien pr√©sentes, la suppression ayant eu lieu apr√®s.&lt;/p&gt;&#xA;&lt;p&gt;Forcer l‚Äô√©criture des journaux de transaction.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_switch_wal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_switch_wal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;---------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100072&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;8-stopper-postgresql-localement&#34;&gt;8. Stopper PostgreSQL localement&lt;/h4&gt;&#xA;&lt;h4 id=&#34;9-red√©marrer-patroni-sur-le-primaire-choisi&#34;&gt;9. Red√©marrer Patroni sur le primaire choisi&lt;/h4&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl start patroni&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;10-v√©rifier-la-promotion&#34;&gt;10. V√©rifier la promotion&lt;/h4&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patronictl -c /etc/patroni/config.yml topology&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+ Cluster: loxodemo &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7427142939826752414&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; -+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Member  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Host        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Role   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; State   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; TL &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Lag in MB &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+---------+-------------+--------+---------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; pgdeb01 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.11 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Leader &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; running &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+---------+-------------+--------+---------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;11-red√©marrer-patroni-sur-chaque-r√©plica&#34;&gt;11. Red√©marrer Patroni sur chaque r√©plica&lt;/h4&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl start patroni&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patronictl -c /etc/patroni/config.yml topology&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+ Cluster: loxodemo &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7427142939826752414&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Member    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Host        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Role    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; State     &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; TL &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Lag in MB &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+-----------+-------------+---------+-----------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; pgdeb01   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.11 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Leader  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; running   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; + pgdeb02 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.12 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Replica &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; streaming &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;         &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; + pgdeb03 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.13 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Replica &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; streaming &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;         &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+-----------+-------------+---------+-----------+----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h3 id=&#34;m√©thode-2--bootstrap-du-cluster-avec-patroni&#34;&gt;M√©thode 2 : Bootstrap du cluster avec Patroni&lt;/h3&gt;&#xA;&lt;p&gt;Cette m√©thode est plus lourde, mais parfois n√©cessaire (ex. : restauration compl√®te ou script√©e).&lt;/p&gt;&#xA;&lt;h4 id=&#34;1-connectez-vous-sur-une-des-machines-qui-sera-le-futur-primaire&#34;&gt;1. Connectez-vous sur une des machines qui sera le futur primaire.&lt;/h4&gt;&#xA;&lt;h4 id=&#34;2-supprimer-ou-d√©placer-le-r√©pertoire-de-donn√©es-de-postgresql&#34;&gt;2. Supprimer ou d√©placer le r√©pertoire de donn√©es de PostgreSQL&lt;/h4&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rm -rf /data/postgres/loxodemo&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ou&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv /data/postgres/loxodemo /data/postgres/loxodemo_archive&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;3-supprimer-le-cluster-dans-etcd&#34;&gt;3. Supprimer le cluster dans Etcd&lt;/h4&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patronictl -c /etc/patroni/config.yml remove loxodemo&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Confirmation obligatoire :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Please confirm the cluster name to remove: loxodemo&#xA;You are about to remove all information ... please type: &amp;#34;Yes I am aware&amp;#34;: Yes I am aware&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;4-modifier-la-configuration-de-patroni&#34;&gt;4. Modifier la configuration de Patroni&lt;/h4&gt;&#xA;&lt;p&gt;Ajoutez √† la section &lt;code&gt;bootstrap&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bootstrap:&#xA;  method: pgbackrest&#xA;  pgbackrest:&#xA;    command: &amp;#39;/usr/bin/pgbackrest --stanza=loxodemo --delta restore&amp;#39;&#xA;    keep_existing_recovery_conf: false&#xA;    no_params: true&#xA;    recovery_conf:&#xA;      recovery_target_action: promote&#xA;      recovery_target_time: &amp;#34;2025-07-21 09:14:16.78179+00&amp;#34;&#xA;      restore_command: pgbackrest --stanza=loxodemo archive-get %f %p&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;5-red√©marrer-patroni-sur-le-futur-primaire&#34;&gt;5. Red√©marrer Patroni sur le futur primaire&lt;/h4&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl start patroni&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Les logs doivent indiquer la s√©quence de bootstrap :&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2025-07-21 12:59:23 INFO: Selected new etcd server http://10.200.0.12:2379&#xA;2025-07-21 12:59:23 INFO: No PostgreSQL configuration items changed, nothing to reload.&#xA;2025-07-21 12:59:23 INFO: Lock owner: None; I am pgdeb01&#xA;2025-07-21 12:59:23 INFO: trying to bootstrap a new cluster&#xA;2025-07-21 12:59:23 INFO: Running custom bootstrap script: /usr/bin/pgbackrest --stanza=loxodemo restore&#xA;2025-07-21 12:59:24 INFO: Lock owner: None; I am pgdeb01&#xA;2025-07-21 12:59:24 INFO: not healthy enough for leader race&#xA;2025-07-21 12:59:24 INFO: bootstrap in progress&#xA;2025-07-21 12:59:25 INFO: Lock owner: None; I am pgdeb01&#xA;2025-07-21 12:59:25 INFO: not healthy enough for leader race&#xA;2025-07-21 12:59:25 INFO: bootstrap in progress&#xA;2025-07-21 12:59:26 INFO: Lock owner: None; I am pgdeb01&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Forcer l‚Äô√©criture des journaux de transaction et par cons√©quent l‚Äôarchivage.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-sql=&#34; data-lang=&#34;sql=&#34;&gt;select * from pg_switch_wal();&#xA; pg_switch_wal&#xA;---------------&#xA; 0/9004A00&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;6-red√©marrer-patroni-sur-chaque-r√©plica&#34;&gt;6. Red√©marrer Patroni sur chaque r√©plica&lt;/h4&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;systemctl start patroni&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Contr√¥ler l&amp;rsquo;√©tat du cluster:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patronictl -c /etc/patroni/config.yml topology&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+ Cluster: loxodemo &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7427142939826752414&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ------+-----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Member    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Host        &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Role    &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; State     &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  TL &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Lag in MB &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+-----------+-------------+---------+-----------+-----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; pgdeb01   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.11 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Leader  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; running   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; + pgdeb02 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.12 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Replica &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; streaming &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;         &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; + pgdeb03 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 10.200.0.13 &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Replica &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; streaming &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;         &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+-----------+-------------+---------+-----------+-----+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;quelle-m√©thode-choisir-&#34;&gt;Quelle m√©thode choisir ?&lt;/h2&gt;&#xA;&lt;table&gt;&#xA;&lt;thead&gt;&#xA;&lt;tr&gt;&#xA;&lt;th&gt;M√©thode&lt;/th&gt;&#xA;&lt;th&gt;Avantages&lt;/th&gt;&#xA;&lt;th&gt;Inconv√©nients&lt;/th&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/thead&gt;&#xA;&lt;tbody&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;Manuelle (&amp;ndash;delta)&lt;/td&gt;&#xA;&lt;td&gt;Restauration plus rapide, plus granulaire&lt;/td&gt;&#xA;&lt;td&gt;Plus de manipulation manuelle&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;Bootstrap Patroni&lt;/td&gt;&#xA;&lt;td&gt;Automatisable, plus propre dans certains cas&lt;/td&gt;&#xA;&lt;td&gt;Plus long, pas de restauration delta&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;Gr√¢ce √† &lt;strong&gt;pgBackRest&lt;/strong&gt; et &lt;strong&gt;Patroni&lt;/strong&gt;, il est possible de restaurer un cluster PostgreSQL √† un instant pr√©cis, que ce soit pour corriger une erreur humaine ou revenir √† un √©tat stable apr√®s une d√©faillance. Selon les besoins (rapidit√© vs r√©initialisation compl√®te), l‚Äôune ou l‚Äôautre des m√©thodes peut √™tre utilis√©e efficacement.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #123</title>
    <updated>2025-11-04T15:04:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-11-04:/blog/index.php/post/2025/11/04/PostgreSQL-Hebdo-123</id>
    <link href="https://sebastien.lardiere.net/blog/index.php/post/2025/11/04/PostgreSQL-Hebdo-123" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derni√®res semaines¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://explain.technical.li/postgres-indexes-beyond-b-tree/&#34;&gt;Postgres Indexes Beyond B-Tree‚ÄîGIN, GiST, BRIN, SP-GiST&lt;/a&gt; : les diff√©rents types d&#39;index et leurs utilisations¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://vondra.me/posts/how-often-is-the-query-plan-optimal/&#34;&gt;How often is the query plan optimal?&lt;/a&gt;¬†: √† propos de la m√©thode utilis√©e pour obtenir le meilleur plan d&#39;ex√©cution¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.glukhov.org/post/2025/09/postgresql-cheatsheet/&#34;&gt;PostgreSQL Cheatsheet: A Developer‚Äôs Quick Reference&lt;/a&gt;¬†: liste consistante de ce qu&#39;on peut faire avec PostgreSQL¬†: commande, param√®tre, l&#39;essentiel y est¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://vondra.me/posts/tuning-aio-in-postgresql-18/&#34;&gt;Tuning AIO in PostgreSQL 18&lt;/a&gt;¬†: comme souvent avec PostgreSQL, les valeurs par d√©faut sont conservatrices !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2025/10/29/waiting-for-postgresql-19-add-psql-prompt-variable-for-search_path/&#34;&gt;Waiting for PostgreSQL 19 ‚Äì Add psql PROMPT variable for search_path&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgfeaturediff.com/?from=17&amp;amp;to=18&#34; title=&#34;https://pgfeaturediff.com/?from=17&amp;amp;to=18&#34;&gt;https://pgfeaturediff.com/?from=17&amp;...&lt;/a&gt;¬†: matrices des fonctionnalit√©s de PostgreSQL&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgversions.com/?version=15.3&#34; title=&#34;https://pgversions.com/?version=15.3&#34;&gt;https://pgversions.com/?version=15....&lt;/a&gt;¬†: √©tat des lieux des versions de PostgreSQL&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://boringsql.com/posts/beyond-start-end-columns/&#34;&gt;Beyond Start and End: PostgreSQL Range Types&lt;/a&gt; : les types de donn√©es &#34;range&#34; sont vraiment mal connues et pas assez utilis√©, cet article est tr√®s complet √† ce sujet !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.enterprisedb.com/blog/changes-not-null-postgres-18&#34;&gt;Changes to NOT NULL in Postgres 18&lt;/a&gt;¬†: √† la fois une belle fonctionnalit√© et une aventure pour de nouveaux d√©veloppeurs de PostgreSQL¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://topicpartition.io/blog/postgres-pubsub-queue-benchmarks&#34;&gt;Kafka is fast -- I&#39;ll use Postgres&lt;/a&gt;¬†: bien utilis√©, PostgreSQL est largement suffisant, et l&#39;asynchronisme d&#39;une file de message r√©soud bien des probl√®mes.&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>S√©bastien Lardi√®re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #122</title>
    <updated>2025-09-17T14:41:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-09-17:/blog/index.php/post/2025/09/19/PostgreSQL-Hebdo-122</id>
    <link href="https://sebastien.lardiere.net/blog/index.php/post/2025/09/19/PostgreSQL-Hebdo-122" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derni√®res semaines :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/select-for-update-considered-harmful-postgresql/&#34;&gt;SELECT FOR UPDATE considered harmful in PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://dev.to/shayy/postgres-is-too-good-and-why-thats-actually-a-problem-4imc&#34;&gt;Postgres is Too Good (And Why That&#39;s Actually a Problem)&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://kmoppel.github.io/2025-08-06-no-you-dont-need-extensions-to-compact-postgres-tables/&#34;&gt;No, you don&#39;t necessarily need extensions to compact Postgres tables&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://raymondtukpe.com/sql-nulls-are-weird.html&#34;&gt;SQL NULLs are Weird! &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.thatguyfromdelhi.com/2025/05/for-key-share-optimization-and-slru-trap.html&#34;&gt;FOR KEY SHARE optimization and the SLRU Trap&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://thebuild.com/blog/2025/08/10/lies-damn-lies-and-llm-output/&#34;&gt;Lies, Damn Lies, and LLM Output&lt;/a&gt;¬†: l&#39;IA nous ment, et ceux qui s&#39;en servent nous manipulent !¬†fuyez ! (attention :¬†d&#39;autres articles que celui mentionn√© existent !)&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://sebastien.lardiere.net/blog/index.php/post/2025/09/19/&#34;&gt;Partitioned table statistics&lt;/a&gt;¬†: une bonne raison de lancer un ANALYZE hors Auto-vacuum.&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.footcow.com/app/article/postgresql-18-beta-les-revolutions-qui-nous-attendent&#34;&gt;PostgreSQL 18 Beta: The revolutions that await us&lt;/a&gt;¬†: PostgreSQL 18 arrive tr√®s bient√¥t !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.pgmustard.com/blog/enable-parameters-work-differently-in-postgres-18&#34;&gt;&#34;enable&#34; parameters will work differently in Postgres 18&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.loxodata.com/post/postgresql-18-rc1/&#34;&gt;PostgreSQL 18 en RC1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;p&gt;PostgreSQL 18¬†est attendu le 25 septembre !&lt;/p&gt;</summary>
    <author>
      <name>S√©bastien Lardi√®re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #121</title>
    <updated>2025-05-13T14:47:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-05-13:/blog/index.php/post/2025/04/13/PostgreSQL-Hebdo-121</id>
    <link href="https://sebastien.lardiere.net/blog/index.php/post/2025/04/13/PostgreSQL-Hebdo-121" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derni√®res semaines¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://kmoppel.github.io/2025-04-10-postgres-scaling-roadmap/&#34;&gt;A roadmap to scaling Postgres&lt;/a&gt;¬†: Une liste compl√®te de concepts √† utiliser pour assurer une mont√©e en charge de PostgreSQL¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://r.ena.to/blog/optimizing-postgres-table-layout-for-maximum-efficiency/&#34;&gt;Optimizing Postgres table layout for maximum efficiency&lt;/a&gt;¬†: Une explication simple et claire √† propos de l&#39;alignement des types de donn√©es¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://tselai.com/all-databases-are-just-files&#34;&gt;(All) Databases Are Just Files. Postgres Too&lt;/a&gt;¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://cedardb.com/blog/postgres_compatibility/&#34;&gt;What It Takes to Be PostgreSQL Compatible&lt;/a&gt;¬†: de nombreaux produits adoptent une compatibilit√© avec PostgreSQL¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.danslimmon.com/2025/03/14/did-u-ever-read-so-hard-u-accidentally-wrote/&#34;&gt;did u ever read so hard u accidentally wrote?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-175-169-1513-1418-and-1321-released-3072/&#34;&gt;PostgreSQL 17.5, 16.9, 15.13, 14.18, and 13.21 Released!&lt;/a&gt;¬†et en fran√ßais &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-5/&#34;&gt;PostgreSQL 17.5 et autres correctifs&lt;/a&gt;¬†¬†: √† noter la fin de vie de PostgreSQL 13 en novembre¬†;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;p&gt;√Ä¬†venir dans PostgreSQL 18¬†:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2025/05/05/waiting-for-postgresql-18-add-function-to-get-memory-context-stats-for-processes/&#34;&gt;Add function to get memory context stats for processes&lt;/a&gt;¬†: interessant de pouvoir suivre l&#39;√©tat d&#39;un processus, cela d√©voile beaucoup d&#39;informations utile¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-18-beta-1-released-3070/&#34;&gt;PostgreSQL 18 Beta 1 Released!&lt;/a&gt; et en fran√ßais &lt;a href=&#34;https://www.loxodata.com/post/postgresql-18-beta1/&#34;&gt;PostgreSQL 18 b√™ta 1&lt;/a&gt;¬†: √† vos tests !&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>S√©bastien Lardi√®re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #120</title>
    <updated>2025-02-21T15:20:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-02-21:/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120</id>
    <link href="https://sebastien.lardiere.net/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derni√®res semaines¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.octo.com/7-things-a-developer-should-know-about-databases&#34;&gt;7 things a developer should know about databases&lt;/a&gt;¬†: de pr√©cieux conseils, √† lire attentivement et √† faire circuler aupr√®s de vos √©quipes !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.dalibo.com//2025/02/10/patchs_parallelisations_2.html&#34;&gt;La suite des patchs sur la parall√©lisation &lt;/a&gt;¬†: Au-del√† du fond, qui est int√©ressant, c‚Äôest le point de vue sur le d√©veloppement de PostgreSQL¬†est mis en √©vidence, et cela permet de mieux comprendre cet aspect de la communaut√© PostgreSQL¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.loxodata.com/post/pgwatch3/&#34;&gt;pgwatch3&lt;/a&gt; : quelques explications sur la nouvelle version de l&#39;outil de supervision pgwatch¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.twilio.com/en-us/blog/sqlite-postgresql-complicated&#34;&gt;SQLite or PostgreSQL? It&#39;s Complicated!&lt;/a&gt; : comparatif de performances sur de vraies donn√©es !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/&#34;&gt;PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!&lt;/a&gt; et &lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-173-167-1511-1416-and-1319-released-3015/&#34;&gt;PostgreSQL 17.3, 16.7, 15.11, 14.16, and 13.19 Released!&lt;/a&gt; : mettez √† jour !&#xA;&lt;ul&gt;&#xA;&lt;li&gt;en fran√ßais : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-4/&#34;&gt;PostgreSQL 17.4 et autres correctifs&lt;/a&gt; et  &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-3/&#34;&gt;PostgreSQL 17.3 et autres correctifs&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/end-of-the-road-for-postgresql-streaming-replication/&#34;&gt;End of the road for PostgreSQL streaming replication?&lt;/a&gt; : pourquoi il est difficile de parall√©liser le rejeu de la r√©plication dans une instance Standby¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/enhanced-postgres-release-notes&#34;&gt;Enhanced Postgres Release Notes&lt;/a&gt; : tr√®s bonne id√©e, et gros travail : on trouve maintenant un lien vers le commit pour chacune des entr√©es des notes de publication¬†;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>S√©bastien Lardi√®re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #119</title>
    <updated>2025-01-31T16:16:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-01-31:/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119</id>
    <link href="https://sebastien.lardiere.net/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derni√®res semaines :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2024/12/01/sql-best-practices-dont-compare-count-with-0/&#34;&gt;SQL best practices ‚Äì don‚Äôt compare count(*) with 0&lt;/a&gt; : il n&#39;est pas utile de compter quelque chose alors qu&#39;on juste savoir s&#39;il existe ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://raymondtukpe.com/sql-nulls-are-weird.html&#34;&gt;SQL NULLs are Weird!&lt;/a&gt;¬†: ma√Ætriser cet aspect du SQL n&#39;est pas si √©vident, et pourtant fondamental¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://notso.boringsql.com/posts/deletes-are-difficult/&#34;&gt;DELETEs are difficult&lt;/a&gt;: tout savoir sur l&#39;op√©ration DELETE ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.pgedge.com/blog/understanding-and-reducing-postgresql-replication-lag&#34;&gt;Understanding and Reducing PostgreSQL Replication Lag&lt;/a&gt; : le retard de r√©plication peut avoir de nombreux impacts, le mesurer et le maitriser est important ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://thebuild.com/blog/2025/01/28/vacuum-index_cleanup-off-considered-harmful/&#34;&gt;VACUUM (INDEX_CLEANUP OFF) Considered Harmful&lt;/a&gt; : attention aux options de commandes qui pourraient para√Ætre int√©ressantes au premier abord¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.binwang.me/2024-12-02-PostgreSQL-High-Availability-Solutions-Part-1.html&#34;&gt;Jepsen Test on Patroni: A PostgreSQL High Availability Solution&lt;/a&gt;¬†: test tr√®s complet de Patroni¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rodoq.medium.com/are-all-your-update-useful-6b8d548085bf&#34;&gt;Are all your UPDATE useful ?&lt;/a&gt;¬†: Vos UPDATE sont-ils toujours utiles ?&lt;/li&gt;&#xA;&lt;li&gt;Le projet PostgreSQL Ecosystem est maintenant public : &lt;a href=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34; title=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34;&gt;https://www.loxodata.com/post/pg-ec...&lt;/a&gt; et &lt;a href=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34; title=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34;&gt;https://pg-ecosystem.gitlab.io/pg-e...&lt;/a&gt;¬†;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>S√©bastien Lardi√®re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #118</title>
    <updated>2024-11-22T16:09:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-11-22:/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118</id>
    <link href="https://sebastien.lardiere.net/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derni√®res semaines¬†:&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgversions.com/&#34; title=&#34;https://pgversions.com/&#34;&gt;https://pgversions.com/&lt;/a&gt;¬†: outil permettant de connaitre les diff√©rences entre une version mineure et l&#39;√©tat actuel de PostgreSQL¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgpedia.info/blog/index.html&#34; title=&#34;https://pgpedia.info/blog/index.html&#34;&gt;https://pgpedia.info/blog/index.htm...&lt;/a&gt;¬†: blog r√©sumant l&#39;activit√© de d√©veloppement de PostgreSQL¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rhaas.blogspot.com/2024/11/why-pgdump-is-amazing.html&#34;&gt;Why pg_dump Is Amazing&lt;/a&gt;¬†: oui, pg_dump est un bon outil, tr√®s utile, qu&#39;il faut maitriser¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://databaserookies.wordpress.com/2024/11/02/plpgsql-how-conditional-expressions-are-evaluated/&#34;&gt;PL/pgSQL Secrets: How Conditional Expressions Are Parsed and Evaluated Under the Hood.&lt;/a&gt;¬†: ou on comprend qu&#39;un IF est en fait un SELECT¬†;&lt;/li&gt;&#xA;&lt;li&gt;Publication de PostgreSQL 17.2¬†: &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34; title=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34;&gt;https://www.loxodata.com/post/postg...&lt;/a&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/a-change-to-relresultinfo-a-near-miss-with-postgres-17-1&#34;&gt;A change to ResultRelInfo - A Near Miss with Postgres 17.1&lt;/a&gt;¬†: retour sur un petit couac&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://challahscript.com/what_i_wish_someone_told_me_about_postgres&#34;&gt;What I Wish Someone Told Me About Postgres&lt;/a&gt;¬†: le plein de bonnes id√©es √† retenir¬†;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://stormatics.tech/blogs/scenarios-that-trigger-autovacuum-in-postgresql&#34;&gt;Scenarios That Trigger Autovacuum in PostgreSQL&lt;/a&gt;¬†: article assez complet sur le fonctionnement d&#39;autovacuum.&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>S√©bastien Lardi√®re</name>
    </author>
  </entry>
  <entry>
    <title>Sauvegardes personnelles avec Restic</title>
    <updated>2025-10-08T14:00:00Z</updated>
    <id>tag:fljd.in,2025-10-08:/2025/10/08/sauvegardes-personnelles-avec-restic/</id>
    <link href="https://fljd.in/2025/10/08/sauvegardes-personnelles-avec-restic/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Ces derniers temps, j‚Äôai mis fin √† une histoire d‚Äôamour avec Debian qui aura&#xA;dur√© pr√®s de trois ans. Pas que je n‚Äôaime plus le syst√®me, oh non, je le pr√©f√®re&#xA;toujours √† sa cousine Ubuntu. Mais voil√†, j‚Äôai un attachement particulier √†&#xA;Archlinux depuis, wouh, au moins les bancs de l‚Äô√©cole d‚Äôing√©nieur o√π nous&#xA;l‚Äôinstallions sur des machines virtuelles et o√π nous nous adonnions √† la&#xA;pratique du &lt;a href=&#34;https://github.com/fosslife/awesome-ricing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;linux ricing&lt;/a&gt; pour passer le temps.&lt;/p&gt;&#xA;&lt;p&gt;Apr√®s une exp√©rimentation de &lt;a href=&#34;https://manjaro.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Manjaro i3&lt;/a&gt; entre 2019 et 2022 sur mon poste&#xA;professionnel, je me suis convaincu qu‚Äôil me fallait retourner √† l‚Äôessentiel. Au&#xA;d√©but du mois de septembre, j‚Äôai r√©ussi le portage de ma &lt;a href=&#34;https://gitlab.com/fljdin/dotfiles/-/tree/main/sway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;config Sway&lt;/a&gt; de&#xA;Debian Trixie vers Archlinux. L‚Äôoccasion parfaite pour requestionner mes&#xA;pratiques en mati√®re de sauvegarde de poste et de remplacer &lt;a href=&#34;https://fljd.in/2021/08/24/borg-ou-la-sauvegarde-facile/&#34;&gt;BorgBackup&lt;/a&gt; par&#xA;Restic.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;prise-en-main-√©clair&#34;&gt;Prise en main √©clair&lt;/h2&gt;&#xA;&lt;p&gt;J‚Äôai lu plusieurs articles et avis au sujet de Restic. Je l‚Äôavais vite identifi√©&#xA;comme un outil √©quivalent √† BorgBackup, mais je ne m‚Äô√©tais pas press√© de le&#xA;tester. Quelle erreur‚ÄØ! J‚Äôai √©t√© d√©concert√© par la facilit√© d‚Äôutilisation, par&#xA;son interface en ligne de commande claire et compl√®te, et par sa&#xA;&lt;a href=&#34;https://restic.readthedocs.io/en/stable/010_introduction.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;documentation&lt;/a&gt; de qualit√©.&lt;/p&gt;&#xA;&lt;p&gt;Pour avoir r√©guli√®rement v√©cu des d√©g√¢ts sur des cl√©s de mauvaise qualit√© avec&#xA;ma pratique exotique sur BorgBackup, je m‚Äô√©tais pench√© sur la possibilit√© de&#xA;sauvegarder vers un dossier distant avec SSH. J‚Äôai du insist√© deux bonnes heures&#xA;√† l‚Äô√©poque sans parvenir √† quoique ce soit avec Borg.&lt;/p&gt;&#xA;&lt;p&gt;Avec Restic, ce n‚Äôest pas moins de 13‚ÄØtypes diff√©rents de d√©p√¥ts support√©s, dont&#xA;le &lt;a href=&#34;https://restic.readthedocs.io/en/stable/030_preparing_a_new_repo.html#sftp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SFTP&lt;/a&gt;. Il ne m‚Äôen fallait pas plus pour tourner le dos √† son homologue. La&#xA;mise en place d‚Äôun d√©p√¥t est simplifi√©e √† l‚Äôextr√™me‚ÄØ:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fish&#34; data-lang=&#34;fish&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;-x&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RESTIC_REPOSITORY&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sftp:&amp;lt;server&amp;gt;:&amp;lt;directory&amp;gt;&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;restic&lt;/span&gt; init&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;restic&lt;/span&gt; backup ~ &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;--dry-run&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;--exclude-file&lt;/span&gt; ~/.config/restic/excludes.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Je ne suis pas en reste avec une gestion pouss√©e des strat√©gies de r√©tention des&#xA;instantan√©s. Pour l‚Äôexemple, je maintiens une sauvegarde par semaine, pendant&#xA;trois mois.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fish&#34; data-lang=&#34;fish&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;restic&lt;/span&gt; forget &lt;span class=&#34;na&#34;&gt;--prune&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;--keep-within-weekly&lt;/span&gt; 3m&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La technique d‚Äôexploration d‚Äôun instantan√© est identique √† Borg, avec un montage&#xA;&lt;a href=&#34;https://www.kernel.org/doc/html/latest/filesystems/fuse.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FUSE&lt;/a&gt; sous Linux. Une fois encore, la &lt;a href=&#34;https://restic.readthedocs.io/en/stable/050_restore.html#restore-using-mount&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;documentation&lt;/a&gt; est limpide √† ce&#xA;sujet.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fish&#34; data-lang=&#34;fish&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;install&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;-o&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$USER&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;-g&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$USER&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;-d&lt;/span&gt; /mnt/restic&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;restic&lt;/span&gt; mount /mnt/restic&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;planification-avec-systemd&#34;&gt;Planification avec systemd&lt;/h2&gt;&#xA;&lt;p&gt;Je me suis pr√™t√© au m√™me jeu qu‚Äôavec BorgBackup sur ma pr√©c√©dente installation&#xA;Debian. En lieu et place de &lt;code&gt;cron&lt;/code&gt;, je planifie mes sauvegardes avec un &lt;em&gt;timer&lt;/em&gt;&#xA;utilisateur pour d√©clencher une t√¢che deux fois par jour sur mes journ√©es de&#xA;travail.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ~/.config/systemd/user/restic.timer&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;Description&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Daily&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Restic&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;backup&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;Documentation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;man&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;restic&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Timer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;OnCalendar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mon&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Fri&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;09&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;OnCalendar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mon&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Fri&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;Persistent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Install&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;WantedBy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;target&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La t√¢che consiste √† appeler &lt;code&gt;restic&lt;/code&gt; avec mon fichier d‚Äôexclusion, suivi d‚Äôune&#xA;purge des vieux instantan√©s pr√©sents sur le d√©p√¥t.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-toml&#34; data-lang=&#34;toml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ~/.config/systemd/user/restic.service&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;Description&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Restic&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;backup&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oneshot&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ExecStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;restic&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;backup&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;--exclude-file&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTIC_EXCLUDE_FILE&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ExecStartPost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;restic&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;forget&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;--prune&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;--keep-within-weekly&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pour la configuration, je d√©clare les variables dans un fichier d‚Äôenvironnement&#xA;pour que &lt;code&gt;restic&lt;/code&gt; sache identifier et d√©chiffrer correctement les instantan√©s.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ~/.config/environment.d/restic.conf&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;RESTIC_REPOSITORY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;sftp:&amp;lt;server&amp;gt;:&amp;lt;directory&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;RESTIC_PASSWORD_FILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;$HOME/.config/restic/pass&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;RESTIC_EXCLUDE_FILE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;$HOME/.config/restic/excludes.txt&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pour armer la planification, il suffit de recharger &lt;code&gt;systemd&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fish&#34; data-lang=&#34;fish&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;systemctl&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;--user&lt;/span&gt; daemon-reload&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;En exportant les bonnes variables dans votre shell, la consultation des&#xA;instantan√©s se fait sobrement avec la commande suivante.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fish&#34; data-lang=&#34;fish&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;restic&lt;/span&gt; snapshots&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;repository 3db74709 opened (version 2, compression level auto)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ID Time Host Tags Paths Size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-----------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;f7bb4fea 2025-09-16 11:50:18 florent-dalibo /home/florent 4.309 GiB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;5a4dbf59 2025-09-19 09:30:01 florent-dalibo /home/florent 5.639 GiB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;1012f0ab 2025-09-27 19:28:38 florent-dalibo /home/florent 5.871 GiB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;629c2687 2025-10-03 09:30:00 florent-dalibo /home/florent 6.006 GiB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;98b32adb 2025-10-08 10:00:08 florent-dalibo /home/florent 4.677 GiB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-----------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;5 snapshots&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;Restic est un bon outil. Tellement bon, que la communaut√© Gnome l‚Äôutilise √†&#xA;pr√©sent comme &lt;em&gt;backend&lt;/em&gt; pour l‚Äôinterface D√©j√† Dup dans leur derni√®re version&#xA;49.0 sortie le &lt;a href=&#34;https://discourse.gnome.org/t/deja-dup-49-0-released/31441&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mois dernier&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Pour ma part, tout se d√©roule bien depuis presque un mois. Il ne manque plus&#xA;qu‚Äô√† s√©curiser le serveur distant qui fait office de d√©p√¥t avec ses propres&#xA;sauvegardes‚ÄØ! Pour ce faire, j‚Äôenvisage de mettre en place Restic sur la plupart&#xA;des r√©pertoires d‚Äôimportances de mon serveur multim√©dia, en gardant bien en&#xA;m√©moire le principe 3-2-1 de la sauvegarde r√©ussie.&lt;/p&gt;&#xA;&lt;p&gt;Prenez soin de vos sauvegardes.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Le partitionnement par UUID v7</title>
    <updated>2025-06-17T08:45:00Z</updated>
    <id>tag:fljd.in,2025-06-17:/2025/06/17/le-partitionnement-par-uuid-v7/</id>
    <link href="https://fljd.in/2025/06/17/le-partitionnement-par-uuid-v7/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Au dernier PG Day 2025, j‚Äôai pris la parole pour pr√©senter une m√©thode de&#xA;conception que je juge mature et astucieuse‚ÄØ: le partitionnement temporel&#xA;avec le type UUID et sa version 7.&lt;/p&gt;&#xA;&lt;p&gt;Le support de pr√©sentation est disponible √† cette &lt;a href=&#34;https://fljd.in/documents/pgdayfr-2025-lightning-talk-partitionnement-uuidv7.pdf&#34;&gt;adresse&lt;/a&gt; et je reprendrais&#xA;dans cet article, les exemples en guise de d√©monstration. Je vous propose de&#xA;passer en d√©tail ce que j‚Äôai pu y dire, et ne pas y dire faute de temps.&#xA;√âgalement, je vous invite √† lire ou red√©couvrir mes recherches sur le&#xA;&lt;a href=&#34;https://fljd.in/2021/04/23/le-partitionnement-par-hachage/&#34;&gt;partitionnement par hachage&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;explorer-les-limites&#34;&gt;Explorer les limites&lt;/h2&gt;&#xA;&lt;p&gt;En premi√®re lecture de la documentation, nous pouvons prendre conscience que le&#xA;choix de la cl√© de partitionnement est crucial pour parvenir au meilleur&#xA;compromis stockage/performance. Parmi les contraintes qui s‚Äôimposent √† nous,&#xA;l‚Äôune d‚Äôentre elles est particuli√®rement fondamentale‚ÄØ:&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Pour cr√©er une contrainte d&amp;rsquo;unicit√© ou une cl√© primaire sur une table&#xA;partitionn√©e, la cl√© de partitionnement ne doit pas inclure des expressions ou&#xA;des appels de fonction, et les colonnes de la contrainte doivent inclure toutes&#xA;les colonnes de la cl√© de partitionnement. Cette limitation existe parce que les&#xA;index individuels cr√©ant la contrainte peuvent seulement forcer l&amp;rsquo;unicit√© sur&#xA;leur propre partition ; de ce fait, la structure m√™me de la partition doit&#xA;garantir qu&amp;rsquo;il n&amp;rsquo;existe pas de duplicats dans les diff√©rentes partitions.&lt;/p&gt;&#xA;&lt;p&gt;Documentation : &lt;a href=&#34;https://www.postgresql.org/docs/current/ddl-partitioning.html#DDL-PARTITIONING-DECLARATIVE-LIMITATIONS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.postgresql.org/docs/current/ddl-partitioning.html&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;En r√©sum√©, si nous souhaitons une contrainte de cl√© primaire sur notre table&#xA;partitionn√©e, il nous faut y inclure la colonne pr√©sente dans la cl√© de&#xA;partitionnement.&lt;/p&gt;&#xA;&lt;p&gt;Voyons par l‚Äôexemple l‚Äôapplication de cette r√®gle. Un des nombreux cas concern√©s&#xA;par cette limitation est le partitionnement par date, √† des fins de purges ou&#xA;d‚Äôarchivage. Une contrainte de cl√© primaire est requise pour identifier chaque&#xA;ligne et un champ &lt;code&gt;timestamp&lt;/code&gt; est utilis√© pour cat√©goriser les lignes selon leur&#xA;date de cr√©ation.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://fljd.in/img/fr/2025-06-17-partitionnement-uuidv7-01.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;varchar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;timestamp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- ERROR: unique constraint on partitioned table must include all&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- partitioning columns&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- DETAIL: PRIMARY KEY constraint on table &amp;#34;foo&amp;#34; lacks column &amp;#34;created_at&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- which is part of the partition key.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pour respecter l‚Äôunicit√© entre toutes les partitions, PostgreSQL se simplifie la&#xA;t√¢che en renfor√ßant la contrainte au moment de la distribution des lignes dans&#xA;les partitions. Ainsi, chaque partition dispose d‚Äôun index unique pour le&#xA;respect de la contrainte d‚Äôidentit√©, sans se soucier d‚Äôun risque de collision&#xA;entre deux lignes de partitions diff√©rentes.&lt;/p&gt;&#xA;&lt;p&gt;Reprenons notre exemple pour y entrevoir les d√©rives qu‚Äôapporte ce choix de&#xA;mod√©lisation. Ici, nous respecterons √† la lettre ce que PostgreSQL nous impose,&#xA;√† savoir‚ÄØ: inclure la colonne &lt;code&gt;created_at&lt;/code&gt; dans la contrainte de cl√© primaire.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://fljd.in/img/fr/2025-06-17-partitionnement-uuidv7-02.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- ALTER TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_p202506&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2025-06-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2025-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Avec ce choix, il devient possible d‚Äôins√©rer deux valeurs &lt;code&gt;id&lt;/code&gt; identiques, pour&#xA;peu que leurs dates de cr√©ation soient diff√©rentes. L‚Äôidentit√© n‚Äôest donc plus&#xA;un simple num√©ro, mais un couple &lt;code&gt;id, timestamp&lt;/code&gt; √† questionner syst√©matiquement&#xA;lors d‚Äôune consultation avec la clause &lt;code&gt;WHERE&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2025-06-04&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- INSERT 0 2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tableoid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regclass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- partname | id | created_at&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- -------------+----+---------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- foo_p202506 | 1 | 2025-06-04 00:00:00&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- foo_default | 1 | 2024-01-01 00:00:00&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Les choses empirent lorsqu‚Äôune relation de cl√© √©trang√®re s‚Äôimmisce dans le&#xA;casse-t√™te de la mod√©lisation. En effet, le maintien de l‚Äôidentit√© composite&#xA;d‚Äôune ligne se r√©v√®le acrobatique, lors de la r√©daction des requ√™tes SQL&#xA;d‚Äôinsertion et de jointure.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;timestamp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_created_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;timestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FOREIGN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_created_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;REFERENCES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;foo&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;clock_timestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RETURNING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_created_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;bar&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;clock_timestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- INSERT 0 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_created_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- id | created_at | data | id | name&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- ----+----------------------------+------+----+------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- 1 | 2025-06-16 20:12:02.101194 | bar | 2 | foo&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;L‚Äôexercice devient catastrophique lorsque la seconde table requiert d‚Äô√™tre&#xA;partitionn√©e √† son tour, et o√π le risque de mauvaise r√©daction des requ√™tes&#xA;augmente selon le degr√© de connaissance du mod√®le par les √©quipes de&#xA;d√©veloppement. Nous retiendrons que cette pratique n‚Äôa pas cours et se conclut&#xA;fr√©quemment par un retour arri√®re.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://fljd.in/img/fr/2025-06-17-partitionnement-uuidv7-03.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;la-version-7-du-type-uuid&#34;&gt;La version 7 du type UUID&lt;/h2&gt;&#xA;&lt;p&gt;La &lt;a href=&#34;https://www.rfc-editor.org/rfc/rfc9562&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC 9562&lt;/a&gt; voit le jour en mai 2024 et propose d‚Äô√©tendre le type de&#xA;donn√©es UUID de trois nouvelles versions (6, 7 et 8). Un UUID (ou &lt;em&gt;Universally&#xA;Unique IDentifier&lt;/em&gt;) est une donn√©e encod√©e sur 16 octets, garantissant une&#xA;unicit√© √† travers le temps (son heure de g√©n√©ration) et l‚Äôespace (son serveur de&#xA;g√©n√©ration). Les UUID sont redoutables dans un contexte de syst√®mes distribu√©s&#xA;o√π chaque participant peut cr√©er de la donn√©e (une ligne) sans risque de collision&#xA;avec une autre donn√©e.&lt;/p&gt;&#xA;&lt;p&gt;La structure d‚Äôun UUID‚ÄØv7 se voit dot√© d‚Äôun &lt;em&gt;timestamp UNIX&lt;/em&gt; d‚Äôune pr√©cision √† la&#xA;milliseconde, encod√© dans les 48 premiers bits de sa valeur. Cette version est&#xA;un compromis entre la randomicit√© et la praticit√©. Les b√©n√©fices vous para√Ætront&#xA;limpides √† l‚Äôissue de cet article.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://fljd.in/img/fr/2025-06-17-partitionnement-uuidv7-04.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;La version 7 √©tait unanimement attendue, car elle apporte une r√©ponse bien plus&#xA;appropri√©e pour l‚Äôindexation dans les bases de donn√©es, offrant √† la fois une&#xA;unicit√© et une sortabilit√© pour les champs. Auparavant, l‚Äôindexation sur une&#xA;donn√©e UUID v4 √©tait d√©sastreuse pour le cache et la fragmentation. Avec cet&#xA;accroissement monotone des UUID au fil du temps, la gestion interne d‚Äôun index&#xA;B-Tree se voit naturellement facilit√©e avec un √©quilibrage moins fr√©quent et une&#xA;pr√©dictibilit√© dans ses performances.&lt;/p&gt;&#xA;&lt;p&gt;Une &lt;a href=&#34;https://dev.to/umangsinha12/postgresql-uuid-performance-benchmarking-random-v4-and-time-based-v7-uuids-n9b&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;publication r√©cente&lt;/a&gt; annon√ßait des gains significatifs entre la version&#xA;4 et la version 7, sur les insertions, les consultations par index ainsi que sur&#xA;l‚Äôespace occup√© par les tables et les index. De quoi se r√©concilier avec le type&#xA;UUID‚ÄØ!&lt;/p&gt;&#xA;&lt;table&gt;&#xA;&lt;thead&gt;&#xA;&lt;tr&gt;&#xA;&lt;th&gt;Metric&lt;/th&gt;&#xA;&lt;th style=&#34;text-align: right&#34;&gt;UUIDv4&lt;/th&gt;&#xA;&lt;th style=&#34;text-align: right&#34;&gt;UUIDv7&lt;/th&gt;&#xA;&lt;th style=&#34;text-align: right&#34;&gt;Improvement&lt;/th&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/thead&gt;&#xA;&lt;tbody&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;Insert Time (10M rows)&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;5 min 35 sec&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;3 min 38 sec&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;~35% faster&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;Table Size&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;3618 MB&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;3443 MB&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;~5% smaller&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;Index Size&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;776 MB&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;602 MB&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;~22% smaller&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;Point Lookup Latency&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;0.167 ms&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;0.038 ms&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;~4x faster&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;tr&gt;&#xA;&lt;td&gt;Range Scan Latency&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;8.284 ms&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;3.791 ms&lt;/td&gt;&#xA;&lt;td style=&#34;text-align: right&#34;&gt;~2x faster&lt;/td&gt;&#xA;&lt;/tr&gt;&#xA;&lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;La communaut√© de d√©veloppement de PostgreSQL a suivi l‚Äôactualit√© de cette RFC,&#xA;en proposant un &lt;a href=&#34;https://www.postgresql.org/message-id/CAAhFRxitJv=yoGnXUgeLB_O&amp;#43;M7J2BJAmb5jqAT9gZ3bij3uLDA@mail.gmail.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;premier patch&lt;/a&gt; en f√©vrier 2023 alors que le brouillon de&#xA;l‚Äô&lt;em&gt;Internet Engineering Task Force&lt;/em&gt; (IETF) venait d‚Äô√™tre publi√©. C‚Äôest lors du&#xA;&lt;a href=&#34;https://commitfest.postgresql.org/patch/4388/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CommitFest&lt;/a&gt; de janvier 2025 que le sujet est cl√¥tur√© avec l‚Äôajout dans le&#xA;commit &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=78c5e141e9c139fc2ff36a220334e4aa25e1b0eb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;78c5e14&lt;/a&gt; de deux m√©thodes pour la version 18, annonc√©e √† l‚Äôautomne&#xA;prochain.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;author Masahiko Sawada &amp;lt;msawada@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Wed, 11 Dec 2024 23:54:41 +0000 (15:54 -0800)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;committer Masahiko Sawada &amp;lt;msawada@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Wed, 11 Dec 2024 23:54:41 +0000 (15:54 -0800)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Add UUID version 7 generation function.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;This commit introduces the uuidv7() SQL function, which generates UUID&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;version 7 as specified in RFC 9652. UUIDv7 combines a Unix timestamp&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;in milliseconds and random bits, offering both uniqueness and&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sortability.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;This commit also expands the uuid_extract_timestamp() function to&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;support UUID version 7.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Additionally, an alias uuidv4() is added for the existing&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gen_random_uuid() SQL function to maintain consistency.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Vous me voyez venir ? √Ä l‚Äôaide de cette nouvelle RFC, il devient possible de&#xA;disposer d‚Äôune colonne d‚Äôidentit√© contenant une valeur temporelle et qui devient&#xA;&lt;em&gt;de facto&lt;/em&gt;, une candidate id√©ale pour la cl√© de partitionnement. Le tout sans&#xA;surco√ªt pour le stockage, car chaque champ UUID consommera 16‚ÄØoctets, autant&#xA;qu‚Äôun &lt;code&gt;bigint&lt;/code&gt; (8‚ÄØoctets) et un &lt;code&gt;timestamp&lt;/code&gt; (8‚ÄØoctets) r√©unis !&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://fljd.in/img/fr/2025-06-partitionnement-uuidv7-05.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;partitionner-par-uuid-v7&#34;&gt;Partitionner par UUID v7&lt;/h2&gt;&#xA;&lt;p&gt;L‚Äôid√©e originale me vient d‚Äôun &lt;a href=&#34;https://postgresql.verite.pro/blog/2024/07/15/uuid-v7-pure-sql.html#partitioning-by-uuid-v7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;article&lt;/a&gt; de Daniel V√©rit√©, lu l‚Äô√©t√© dernier,&#xA;alors m√™me que la RFC venait de sortir, mais que le patch dans PostgreSQL √©tait&#xA;bloqu√© par la p√©riode de gel avant la sortie de la version 17. Il √©tait question&#xA;de pouvoir impl√©menter ses propres m√©thodes en PL/pgSQL sur les versions en&#xA;vigueur, sans attendre la version 18.&lt;/p&gt;&#xA;&lt;p&gt;La cr√©ation de la table &lt;code&gt;foo&lt;/code&gt; se r√©alise ainsi‚ÄØ:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuidv7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;varchar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_p202506&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuidv7_boundary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2025-06-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuidv7_boundary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2025-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo_default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La m√©thode &lt;code&gt;uuidv7_boundary&lt;/code&gt; est in√©dite et n‚Äôa pas d‚Äô√©quivalent dans les&#xA;versions √† venir de PostgreSQL, bien qu‚Äôelle m√©riterait amplement sa place. Sa&#xA;d√©finition est disponible sur le d√©p√¥t &lt;a href=&#34;https://github.com/dverite/postgres-uuidv7-sql/blob/main/sql/uuidv7-sql--1.0.sql#L63&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dverite/postgres-uuidv7-sql&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuidv7_boundary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timestamptz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/* uuid fields: version=0b0111, variant=0b10 */&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;encode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;overlay&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;\x00000000000070008000000000000000&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytea&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;placing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;substring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;int8send&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;floor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;extract&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;epoch&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;hex&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sql&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;strict&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parallel&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;safe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Gr√¢ce √† cette fonction, il est possible d‚Äôobtenir les bornes d‚Äôune partition en&#xA;ne conservant que la donn√©e temporelle d‚Äôun UUID et en remplissant le reste par&#xA;des z√©ros (et quelques bits fixes). Pour la table &lt;code&gt;foo&lt;/code&gt;, on se retrouve d√®s lors&#xA;avec la partition qui respecte les valeurs comprises entre juin et juillet.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Partitioned table &amp;#34;public.foo&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Column | Type | Collation | Nullable | Default&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------+-------------------+-----------+----------+----------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; id | uuid | | not null | uuidv7()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; name | character varying | | |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Partition key: RANGE (id)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Indexes:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &amp;#34;foo_pkey&amp;#34; PRIMARY KEY, btree (id)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Partitions: foo_p202506 FOR VALUES&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; FROM (&amp;#39;0197285b-e300-7000-8000-000000000000&amp;#39;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; TO (&amp;#39;0197c2da-ab00-7000-8000-000000000000&amp;#39;),&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; foo_default DEFAULT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;foo&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- INSERT 0 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tableoid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regclass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuid_extract_timestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- -[ RECORD 1 ]------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- partname | foo_p202506&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- id | 01977a44-364a-752a-b62e-c026ac2f930d&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- name | foo&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- created_at | 2025-06-16 21:43:00.17+02&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h2 id=&#34;une-pratique-en-bonne-voie&#34;&gt;Une pratique en bonne voie&lt;/h2&gt;&#xA;&lt;p&gt;Au cours de ma prise de parole, le temps m‚Äôavait manqu√© pour conclure. Les&#xA;adeptes de l‚Äôextension &lt;a href=&#34;https://github.com/pgpartman/pg_partman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pg_partman&lt;/a&gt; ne seront pas compl√®tement r√©jouis&#xA;d‚Äôapprendre que le support du partitionnement automatique pour une colonne de&#xA;type UUID est partiellement impl√©ment√©.&lt;/p&gt;&#xA;&lt;p&gt;La gestion de types &lt;code&gt;text&lt;/code&gt; et &lt;code&gt;uuid&lt;/code&gt; a √©t√© &lt;a href=&#34;https://github.com/pgpartman/pg_partman/pull/683&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;apport√©e&lt;/a&gt; en novembre 2024,&#xA;permettant ce genre de magie pour provisionner un certain nombre de partitions.&#xA;Les fonctions &lt;code&gt;partman.uuid7_time_encoder&lt;/code&gt; et &lt;code&gt;partman.uuid7_time_decoder&lt;/code&gt; sont&#xA;√©quivalentes respectivement aux fonctions pr√©c√©dentes &lt;code&gt;uuidv7_boundary&lt;/code&gt; et&#xA;&lt;code&gt;uuid_extract_timestamp&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uuidv7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;varchar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- CREATE TABLE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partman&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_parent_table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;public.foo&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_control&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1 month&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_time_encoder&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;partman.uuid7_time_encoder&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_time_decoder&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;partman.uuid7_time_decoder&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- create_parent&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- ---------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- t&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cependant, le d√©placement automatique des lignes de la partition &lt;code&gt;default&lt;/code&gt; vers&#xA;une autre au cours de la maintenance par &lt;code&gt;partition_data_time()&lt;/code&gt; provoque encore&#xA;une erreur √† l‚Äôheure de la r√©daction de cet article. La &lt;a href=&#34;https://github.com/pgpartman/pg_partman/pull/730&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PR 739&lt;/a&gt;, propos√©e&#xA;en janvier dernier, tente de corriger en grande partie les angles morts des&#xA;travaux engag√©s.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partman&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partition_data_time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_parent_table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;public.foo&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- ERROR: Cannot run on partition set without time&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- based control column or epoch flag set with&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- an id column. Found control: uuid, epoch: none&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- CONTEXT: PL/pgSQL function partman.partition_data_time()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- line 63 at RAISE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h2 id=&#34;le-mot-de-la-fin&#34;&gt;Le mot de la fin&lt;/h2&gt;&#xA;&lt;p&gt;Les articles que j‚Äôai √©nonc√©s pr√©c√©demment me conforte dans l‚Äôid√©e que le type&#xA;UUID dans sa version 7 est une belle opportunit√© pour l‚Äôadoption de PostgreSQL,&#xA;notamment pour ce cas d‚Äôusage du partitionnement par date.&lt;/p&gt;&#xA;&lt;p&gt;L‚Äôaccueil que cette rapide pr√©sentation a re√ßu m‚Äôa fait √©galement l‚Äôeffet d‚Äôun&#xA;appel d‚Äôair par l‚Äôaudience, voyant dans l‚ÄôUUID un moyen de pousser les limites&#xA;du moteur de base de donn√©es relationnel et open-source le plus avanc√© au monde.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Substituer une variable dans un script SQL</title>
    <updated>2024-11-25T08:00:00Z</updated>
    <id>tag:fljd.in,2024-11-25:/2024/11/25/substituer-une-variable-dans-un-script-sql/</id>
    <link href="https://fljd.in/2024/11/25/substituer-une-variable-dans-un-script-sql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Il est fr√©quent de vouloir automatiser une t√¢che r√©p√©titive en la scriptant&#xA;rapidement, puis √† force d&amp;rsquo;it√©rations, de l&amp;rsquo;enrichir, voire de l&amp;rsquo;int√©grer dans&#xA;la base de code d&amp;rsquo;un projet. √Ä ce jeu, les outils comme SQL*Plus et psql peuvent&#xA;√™tre de puissants alli√©s et des interpr√©teurs aussi pertinents que Bash ou&#xA;Python.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des projets de migration que je m√®ne r√©guli√®rement, il m&amp;rsquo;arrive de&#xA;tomber sur ces scripts, en grand nombre. Certains ont la particularit√© de&#xA;proposer des param√®tres d&amp;rsquo;entr√©e, trait√©s par SQL*Plus avec le m√©canisme tr√®s&#xA;confortable de substitution de variables. Dans cet article, je partage quelques&#xA;astuces pour convertir certains aspects de ces scripts gr√¢ce aux fonctionnalit√©s&#xA;√©quivalentes que l&amp;rsquo;on retrouve sur l&amp;rsquo;outil psql de PostgreSQL.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;substituer-une-variable&#34;&gt;Substituer une variable&amp;hellip;&lt;/h2&gt;&#xA;&lt;p&gt;Comme point de d√©part, penchons-nous sur la syntaxe support√©e par l&amp;rsquo;outil&#xA;d&amp;rsquo;Oracle avec un exemple fil rouge. Nous incarnons un utilisateur qui souhaite&#xA;obtenir le r√©sultat des ventes d&amp;rsquo;une soci√©t√© factice, en appliquant deux filtres&#xA;bas√©s sur un num√©ro produit et deux dates pass√©es en param√®tres.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- sqlplus-report-01.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CONNECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;2&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;3&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NVL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TO_DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;YYYY-MM-DD&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TO_DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;YYYY-MM-DD&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUIT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; sqlplus -S /nolog @sqlplus-report-01.sql &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 2024-11-01 2024-11-30&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;old 3: WHERE product_id = &amp;amp;product_id&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;new 3: WHERE product_id = 20&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;old 4: AND order_date BETWEEN TO_DATE(&amp;#39;&amp;amp;start_date&amp;#39;, &amp;#39;YYYY-MM-DD&amp;#39;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;new 4: AND order_date BETWEEN TO_DATE(&amp;#39;2024-11-01&amp;#39;, &amp;#39;YYYY-MM-DD&amp;#39;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;old 5: AND TO_DATE(&amp;#39;&amp;amp;end_date&amp;#39;, &amp;#39;YYYY-MM-DD&amp;#39;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;new 5: AND TO_DATE(&amp;#39;2024-11-30&amp;#39;, &amp;#39;YYYY-MM-DD&amp;#39;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;TOTAL_AMOUNT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1378.98&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Comme nous pouvons l&amp;rsquo;observer, la substitution s&amp;rsquo;op√®re en SQL*Plus d√®s que le&#xA;caract√®re &lt;code&gt;&amp;amp;&lt;/code&gt; est rencontr√©, que son contenu soit ou non entour√© de guillemets&#xA;simples. En d√©but de script, j&amp;rsquo;ai appliqu√© une strat√©gie simple en d√©finissant&#xA;une variable avec un nom √©vocateur, pour faciliter la lisibilit√© et la&#xA;maintenance du script et ne plus s&amp;rsquo;accommoder des variables nomm√©es selon leur&#xA;position dans la liste des arguments.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;Pour obtenir un r√©sultat √©quivalent avec psql, nous devons effectuer une&#xA;&lt;a href=&#34;https://psql-tips.org/psql_tips_all.html#tip037&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;assignation&lt;/a&gt; de variables en dehors du script, avec l&amp;rsquo;option &lt;code&gt;-v&lt;/code&gt; ou &lt;code&gt;--set&lt;/code&gt;&#xA;fournie par psql. Ces variables seront alors substitu√©es dans le script √† l&amp;rsquo;aide&#xA;du m√©canisme d&amp;rsquo;&lt;a href=&#34;https://www.postgresql.org/docs/current/app-psql.html#APP-PSQL-INTERPOLATION&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;interpolation&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- psql-report-01.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;footer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COALESCE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; psql -f psql-report-01.sql &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-01&amp;#39;&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-30&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; total_amount&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;--------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1378.98&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La reprise du script original est tout √† fait triviale, on y retrouve une&#xA;syntaxe similaire avec le caract√®re &lt;code&gt;:&lt;/code&gt; en lieu et place de &lt;code&gt;&amp;amp;&lt;/code&gt;. Toutefois, si&#xA;la variable doit √™tre comprise entre deux guillemets simples, nous constatons&#xA;que le caract√®re &lt;code&gt;:&lt;/code&gt; doit √™tre saisi √† l&amp;rsquo;ext√©rieur et non √† l&amp;rsquo;int√©rieur.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;-dans-un-bloc-anonyme&#34;&gt;&amp;hellip; dans un bloc anonyme&lt;/h2&gt;&#xA;&lt;p&gt;Les choses se g√¢tent lorsque le script devient plus complexe, et n√©cessite de&#xA;manipuler nos pr√©c√©dentes variables dans un bloc anonyme PL/SQL. Reprenons notre&#xA;script pour l&amp;rsquo;enrichir d&amp;rsquo;un message personnalis√© si le produit demand√© n&amp;rsquo;existe&#xA;pas. Une premi√®re lecture sur la table &lt;code&gt;products&lt;/code&gt; peut, √©ventuellement,&#xA;retourner l&amp;rsquo;exception &lt;code&gt;NO_DATA_FOUND&lt;/code&gt; que nous souhaitons intercepter.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- sqlplus-report-02.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CONNECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;2&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;3&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;serveroutput&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;feedback&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OFF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;verify&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OFF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DECLARE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TYPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NUMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TO_DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;YYYY-MM-DD&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TO_DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;YYYY-MM-DD&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NVL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DBMS_OUTPUT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PUT_LINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Total amount: &amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NO_DATA_FOUND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DBMS_OUTPUT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PUT_LINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Product &amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; does not exist&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUIT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; sqlplus -S /nolog @sqlplus-report-02.sql &lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; 2024-11-01 2024-11-30&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Product 120 does not exist&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;p&gt;Du c√¥t√© de notre alternative PostgreSQL et son invite de commande psql, il&#xA;appara√Æt qu&amp;rsquo;un bloc anonyme en PL/pgSQL ne permet pas de r√©aliser la&#xA;substitution comme nous le souhaitons. Si nous tentons de r√©aliser un contr√¥le&#xA;avec le renvoi d&amp;rsquo;une exception, nous obtenons une erreur de syntaxe, car la&#xA;variable n&amp;rsquo;est pas substitu√©e.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- psql-report-02-wrong.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DECLARE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TYPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;STRICT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COALESCE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOTICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Total amount: %&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;no_data_found&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOTICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Product % does not exist&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; psql -f psql-report-02-wrong.sql &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-01&amp;#39;&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-30&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;psql:psql-report-02-wrong.sql:25: ERROR: syntax error at or near &amp;#34;:&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;LINE 5: p_start date := :&amp;#39;start_date&amp;#39;::date;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; ^&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Fort heureusement, psql ne nous laisse pas sans ressource. Les m√©ta-commandes&#xA;qu&amp;rsquo;il propose peuvent nous permettre d&amp;rsquo;obtenir le m√™me r√©sultat, moyennant une&#xA;r√©√©criture plus profonde du script. Nous allons utiliser la m√©ta-commande&#xA;&lt;code&gt;\gset&lt;/code&gt; pour stocker l&amp;rsquo;√©tat du produit puis la m√©ta-commande &lt;code&gt;\if&lt;/code&gt; pour r√©aliser&#xA;le contr√¥le.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- psql-report-02.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;footer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXISTS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unknown_product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unknown_product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Product&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;does not exist&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;quit&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endif&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COALESCE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; psql -f report.sql &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-01&amp;#39;&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-30&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Product 120 does not exist&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h2 id=&#34;-√†-tout-prix&#34;&gt;&amp;hellip; √† tout prix&lt;/h2&gt;&#xA;&lt;p&gt;Il est probable que les m√©ta-commandes de psql ne viennent pas √† bout de toutes&#xA;les ing√©niosit√©s (et aberrations) que peuvent r√©server les scripts compatibles&#xA;avec SQL*Plus. Progressons encore avec une √©volution plus complexe de notre&#xA;exemple.&lt;/p&gt;&#xA;&lt;p&gt;Notre utilisateur souhaite √† pr√©sent obtenir un score de performance pour la&#xA;p√©riode de vente de son produit, en comparant avec la p√©riode pr√©c√©dente. Nous&#xA;aurions besoin ici d&amp;rsquo;un curseur pour r√©utiliser plusieurs fois la m√™me requ√™te&#xA;de calcul des ventes ainsi que d&amp;rsquo;une fonction pour calculer le score de&#xA;performance en g√©rant correctement la division possible par z√©ro.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- sqlplus-report-03.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CONNECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;2&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;3&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;serveroutput&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;feedback&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OFF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;verify&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OFF&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DECLARE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TYPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NUMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NUMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TO_DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;YYYY-MM-DD&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TO_DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;amp;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;YYYY-MM-DD&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CURSOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;DATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NUMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NUMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NUMBER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_score&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NUMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ROUND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ZERO_DIVIDE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OPEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FETCH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CLOSE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OPEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FETCH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CLOSE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DBMS_OUTPUT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PUT_LINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Total amount: &amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DBMS_OUTPUT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PUT_LINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Performance score: &amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NO_DATA_FOUND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DBMS_OUTPUT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PUT_LINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Product &amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; does not exist&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUIT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; sqlplus -S /nolog @sqlplus-report-03.sql &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 2024-11-01 2024-11-30&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Total amount: 1378.98&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Performance score: 162.99&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Bien que l&amp;rsquo;exemple soit volontairement simpliste et qu&amp;rsquo;il puisse faire appel √†&#xA;une &lt;a href=&#34;https://fljd.in/2023/02/10/le-fenetrage-a-la-rescousse/&#34;&gt;fonction de fen√™trage&lt;/a&gt;, nous allons jouer le jeu de la conversion du&#xA;script au plus proche de sa syntaxe originale. Pour cela, identifions les&#xA;faiblesses du PL/pgSQL.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;&lt;strong&gt;Les routines √©ph√©m√®res ne sont pas prises en charge&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Le langage PL/pgSQL n&amp;rsquo;autorise pas la d√©claration de fonctions ou de proc√©dures&#xA;stock√©es dont la port√©e serait exclusive au contexte d&amp;rsquo;ex√©cution. La seule&#xA;alternative est de d√©finir globalement la routine, afin qu&amp;rsquo;elle soit connue de&#xA;l&amp;rsquo;analyseur syntaxique et ex√©cut√©e correctement. Dans le cas pr√©sent, je ne&#xA;souhaite pas que la fonction persiste apr√®s l&amp;rsquo;appel de mon script. Qu&amp;rsquo;√† cela ne&#xA;tienne, nous pouvons cr√©er une fonction temporaire dans le sch√©ma &lt;code&gt;pg_temp&lt;/code&gt;¬†!&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- temp-function.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ROUND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;division_by_zero&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOTICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Score: %&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOTICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Score: %&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; psql -f temp-function.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;psql:temp-function.sql:16: NOTICE: Score: 100.00&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;psql:temp-function.sql:16: NOTICE: Score: &amp;lt;NULL&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;DO&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La fonction &lt;code&gt;pg_temp.score(numeric, numeric)&lt;/code&gt; est d√®s lors accessible dans le&#xA;reste de notre bloc anonyme, et ce, uniquement pour la dur√©e de la session. La&#xA;gestion des exceptions est conforme au besoin, il a suffit de remplacer&#xA;&lt;code&gt;ZERO_DIVIDE&lt;/code&gt; par &lt;code&gt;division_by_zero&lt;/code&gt; comme le stipule la &lt;a href=&#34;https://www.postgresql.org/docs/current/errcodes-appendix.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;documentation&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;La substitution ne s&amp;rsquo;applique pas dans un bloc anonyme&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous l&amp;rsquo;avons vu pr√©c√©demment, la substitution n&amp;rsquo;intervient pas lorsque&#xA;nous nous trouvons dans un bloc de code PL/pgSQL. Pour contourner cette&#xA;limitation, nous allons devoir utiliser les &lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-custom.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;variables de session&#xA;personnalis√©es&lt;/a&gt; mises √† disposition pour l&amp;rsquo;√©cosyst√®me d&amp;rsquo;extensions avec&#xA;PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Ces variables peuvent √™tre manipul√©es aussi bien en psql avec le mot-cl√© &lt;code&gt;SET&lt;/code&gt;&#xA;qu&amp;rsquo;en SQL ou en PL/pgSQL avec les fonctions &lt;a href=&#34;https://pgpedia.info/c/current_setting.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;current_setting&lt;/code&gt;&lt;/a&gt; et&#xA;&lt;a href=&#34;https://pgpedia.info/s/set_config.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;set_config&lt;/code&gt;&lt;/a&gt;. La seule contrainte consiste √† leur d√©finir un pr√©fixe qui&#xA;n&amp;rsquo;entre pas en conflit avec celui d&amp;rsquo;autres variables d√©j√† d√©clar√©es dans notre&#xA;instance.&lt;/p&gt;&#xA;&lt;p&gt;Pour revenir √† notre exercice de conversion, cela signifie que nos param√®tres&#xA;de script peuvent √™tre mont√©s en variables de session dans les toutes premi√®res&#xA;instructions. D√®s que nous sommes dans un bloc anonyme, il convient alors de les&#xA;rappeler dans des variables classiques comme le montre le code suivant¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DECLARE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_setting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;my.product_id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_setting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;my.start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_setting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;my.end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Conversion compl√®te&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Toutes ces astuces mises bout √† bout permet d&amp;rsquo;obtenir une nouvelle version du&#xA;script, converti de PL/SQL √† PL/pgSQL¬†:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- psql-report-03.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUIET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DECLARE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_setting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;my.product_id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TYPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_setting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;my.start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_setting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;my.end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1 day&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1 day&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CURSOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_end&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COALESCE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ROUND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;division_by_zero&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;STRICT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OPEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FETCH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CLOSE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;OPEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FETCH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CLOSE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_orders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOTICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Total amount: %&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOTICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Performance score: %&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_prev_sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXCEPTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;no_data_found&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RAISE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOTICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Product % does not exist&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; psql -f psql-report-03.sql&lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-01&amp;#39;&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-30&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;psql:psql-report-03.sql:55: NOTICE: Total amount: 1378.98&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;psql:psql-report-03.sql:55: NOTICE: Performance score: 162.99&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;Convertir un script SQL*Plus pour qu&amp;rsquo;il devienne compatible avec l&amp;rsquo;outil psql de&#xA;PostgreSQL est un exercice surmontable, pour peu que l&amp;rsquo;on connaisse les bonnes&#xA;astuces et alternatives qui r√©pondent au besoin initial. Bien s√ªr, une&#xA;traduction un pour un, en conservant la syntaxe et un semblant de lisibilit√©,&#xA;pourrait s&amp;rsquo;av√©rer plus ardue que l&amp;rsquo;exemple que j&amp;rsquo;ai concoct√©.&lt;/p&gt;&#xA;&lt;p&gt;Je reste toujours sceptique face √† celles et ceux qui souhaitent conserver ce&#xA;genre de pratiques de d√©veloppement, que je trouve obsol√®tes. Migrer vers&#xA;PostgreSQL n&amp;rsquo;est-il pas l&amp;rsquo;occasion de moderniser sa base de code, ou de&#xA;questionner son rapport √† la technologie ? Dans notre exemple, comme je l&amp;rsquo;avais&#xA;mentionn√©, il est possible d&amp;rsquo;obtenir le m√™me r√©sultat en une seule requ√™te SQL,&#xA;sans avoir √† recourir √† un bloc anonyme PL/pgSQL.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;-- psql-report-04.sql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;footer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXISTS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;products&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unknown_product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unknown_product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Product&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;does not exist&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;quit&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endif&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;end_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;days&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;days&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prev_start&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;periods&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;days&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1 day&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;prev_start&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;start_date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;days&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1 day&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amounts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COALESCE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;total_amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LAG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OVER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prev_total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;periods&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;order_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GROUP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;total_amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ROUND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prev_total_amount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prev_total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;performance_score&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;amounts&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prev_total_amount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; psql -f psql-report-04.sql&lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;product_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;start_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-01&amp;#39;&lt;/span&gt; -v &lt;span class=&#34;nv&#34;&gt;end_date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2024-11-30&amp;#39;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; total_amount | performance_score&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;--------------+-------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1378.98 | 162.99&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;message&#34;&gt;Tous les scripts de cet article, ainsi que les commandes DDL pour construire&#xA;le mod√®le de donn√©es, sont disponibles cette &lt;a href=&#34;https://gist.github.com/fljdin/45d9ece1c9aba054c85cfbede09c95fd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;adresse&lt;/a&gt;.&lt;/div&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Poissons et coquillages</title>
    <updated>2024-10-14T08:30:00Z</updated>
    <id>tag:fljd.in,2024-10-14:/2024/10/14/poissons-et-coquillages/</id>
    <link href="https://fljd.in/2024/10/14/poissons-et-coquillages/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;En tant que pur produit acad√©mique des ann√©es 2010, mon langage de script de pr√©dilection a&#xA;toujours √©t√© le Bash (&lt;em&gt;Bourne Again Shell&lt;/em&gt;). Non sans ignorer qu&amp;rsquo;il ait pu en exister d&amp;rsquo;autres, je&#xA;ne me suis jamais vraiment tourn√© vers d&amp;rsquo;autres shells pour automatiser les t√¢ches du quotidien&#xA;dans mon m√©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;Et pour cause, j&amp;rsquo;ai administr√© des centaines de serveurs de distributions tr√®s vari√©es et il&#xA;n&amp;rsquo;√©tait pas bien vu d&amp;rsquo;installer des d√©pendances syst√®mes lourdes pour enrichir des scripts Python&#xA;ou Perl. Nous apprenions donc √† √©crire des scripts portables et universels, compatibles partout&#xA;o√π nous d√©posions nos valises.&lt;/p&gt;&#xA;&lt;p&gt;Me suis-je enferm√© dans un dogme conservateur, en m&amp;rsquo;interdisant &lt;em&gt;de facto&lt;/em&gt; √† me tourner vers des&#xA;shells modernes et bien plus ais√©s √† appr√©hender¬†?&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;beurk-le-bash&#34;&gt;Beurk, le Bash&lt;/h2&gt;&#xA;&lt;p&gt;Ne faisons pas de d√©tour, le Bash c&amp;rsquo;est moche. Puissant, pratique, universel, mais moche.&lt;/p&gt;&#xA;&lt;p&gt;Vous pourriez penser que c&amp;rsquo;est un avis parfaitement subjectif, et qu&amp;rsquo;il ne faut pas juger un livre&#xA;√† sa couverture&amp;hellip; mais avouez-le, une partie de vous pense sensiblement la m√™me chose que moi.&#xA;Combien d&amp;rsquo;heures ai-je pu perdre durant ma courbe d&amp;rsquo;apprentissage du langage, √† cause d&amp;rsquo;un grand&#xA;nombre de subtilit√©s et de pi√®ges de syntaxes ?&lt;/p&gt;&#xA;&lt;p&gt;Entre les assignations sans espace autour du signe &lt;code&gt;=&lt;/code&gt;, les accolades &lt;code&gt;{}&lt;/code&gt; pour les variables&#xA;contenant un signe &lt;code&gt;_&lt;/code&gt;, les backticks &lt;code&gt;` `&lt;/code&gt; pour les commandes subshells, ou encore les doubles&#xA;crochets &lt;code&gt;[[ ... ]]&lt;/code&gt; pour les comparaisons non-POSIX, il y a de quoi s&amp;rsquo;arracher les cheveux.&lt;/p&gt;&#xA;&lt;p&gt;Certain¬∑e¬∑s y verront une forme d&amp;rsquo;esth√©tisme ou de tradition d&amp;rsquo;une culture informatique, mais&#xA;personnellement je trouve que c&amp;rsquo;est un langage qui vieillit mal, tr√®s mal. Vous ne vous offusqueriez&#xA;pas non plus si je devais vous t√©moigner mon d√©samour le Perl, n&amp;rsquo;est-ce pas ?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# une comparaison de deux variables&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$a&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$b&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# une addition et une affectation&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$((&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$y&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;))&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# une boucle for&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;seq &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; 10&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# un switch case&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$1&lt;/span&gt; in&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;un&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;deux&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; *&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;autre&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;esac&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# une cha√Æne en minuscule&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,,&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# une gestion des erreurs de commandes cha√Æn√©es&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;some_command &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; another_command&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[[&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PIPESTATUS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[0]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -ne &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;PIPESTATUS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[1]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -ne &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Une des commandes a √©chou√©&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Le &lt;a href=&#34;https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bash&lt;/a&gt; est apparu l&amp;rsquo;ann√©e de ma naissance, en 1989. Il a √©t√© con√ßu en opposition au &lt;a href=&#34;https://en.wikipedia.org/wiki/Bourne_shell&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bourne Shell&lt;/a&gt;&#xA;(&lt;code&gt;sh&lt;/code&gt;) pour apporter des fonctionnalit√©s de programmation plus avanc√©es. Il est devenu le shell par&#xA;d√©faut de la plupart des distributions Linux, et est devenu un standard pour tous les scripts √† travers&#xA;le monde entier.&lt;/p&gt;&#xA;&lt;p&gt;Fort de ses ann√©es de succ√®s, et de son emprise sur le monde Unix, le Bash s&amp;rsquo;impose parfois comme la premi√®re&#xA;porte vers la programmation pour des administrateurices syst√®me ou les √©tudiant¬∑e¬∑s en informatique. Et il&#xA;faut accepter que la qualit√© de ses premiers scripts n&amp;rsquo;est pas toujours au rendez-vous. Souvenez-vous des&#xA;longues heures pass√©es sur StackOverflow √† trouver la syntaxe la plus lisible ou la plus efficace, car les&#xA;r√©ponses se r√©v√©laient aussi vari√©es que touffues !&lt;/p&gt;&#xA;&lt;p&gt;Et c&amp;rsquo;est l&amp;rsquo;un des plus gros probl√®mes que je trouve au Bash¬†: ce langage de programmation est exigeant,&#xA;excentrique, voire &lt;a href=&#34;https://fr.wikipedia.org/wiki/Idiosyncrasie&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;idiosyncratique&lt;/a&gt;, et qui ne pardonne pas les erreurs. Un des &lt;a href=&#34;https://dev.to/taikedz/your-bash-scripts-are-rubbish-use-another-language-5dh7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;paradoxes&lt;/a&gt; que j&amp;rsquo;associe&#xA;au Bash est qu&amp;rsquo;il peut ne pas √™tre consid√©r√© comme un v√©ritable langage de programmation, r√©duisant ainsi&#xA;la volont√© et l&amp;rsquo;effort de l&amp;rsquo;apprendre en profondeur par une large communaut√© de professionnel¬∑le¬∑s.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://dev.to/taikedz/your-bash-scripts-are-rubbish-use-another-language-5dh7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Et si vos scripts Bash sont nuls, utilisez un autre langage.&lt;/a&gt;&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;lami-fish-friendly-interactive-shell&#34;&gt;L&amp;rsquo;ami Fish, Friendly Interactive Shell&lt;/h2&gt;&#xA;&lt;p&gt;Je suis tomb√© sur &lt;a href=&#34;https://fishshell.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fish&lt;/a&gt; par hasard, alors que je questionnais mon usage quotidien sur &lt;a href=&#34;https://fr.wikipedia.org/wiki/Z_Shell&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ZSH&lt;/a&gt;. Sur&#xA;mon poste personnel, j&amp;rsquo;ai √©tendu mon exp√©rience pass√©e sur le Bash avec une configuration ZSH enrichie de&#xA;&lt;a href=&#34;https://ohmyz.sh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Oh My Zsh&lt;/a&gt;. C&amp;rsquo;√©tait un peu le jour et la nuit dans l&amp;rsquo;interaction avec mes terminaux¬†: la navigation,&#xA;les suggestions, les th√®mes, les plugins, tout est plus fluide et plus agr√©able. Sa compatibilit√© avec&#xA;Bash m&amp;rsquo;avait alors √©vit√© de tout r√©apprendre.&lt;/p&gt;&#xA;&lt;p&gt;Fish r√©pond au besoin de modernit√© et de simplicit√© que je cherche sans vraiment le savoir. Contrairement&#xA;√† ZSH, un grand nombre de fonctionnalit√©s sont disponibles sans aucune configuration pr√©alable ou plugin&#xA;√† activer.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Assistance √† la commande&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Recopie la commande incompl√®te et en erreur sans besoin de naviguer dans l&amp;rsquo;historique&lt;/li&gt;&#xA;&lt;li&gt;Acc√®s √† l&amp;rsquo;historique partiel avec les touches directionnelles d√®s la premi√®re frappe au clavier&lt;/li&gt;&#xA;&lt;li&gt;Proposition de chemins avec la compl√©tion de la touche Tab, suivie des touches directionnelles&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://fljd.in/img/fr/2024-20-14-fish-01.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Auto-suggestions des chemins et des options d&amp;rsquo;une grande majorit√© des outils&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;M√©moire des pr√©c√©dents r√©pertoires parcourus&lt;/li&gt;&#xA;&lt;li&gt;Support tr√®s complet des commandes Git, notamment le &lt;code&gt;git rebase -i&lt;/code&gt; ‚ù§Ô∏è&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://fljd.in/img/fr/2024-20-14-fish-02.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Coloration plus pouss√©e des commandes&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;une couleur diff√©rente par mot selon la syntaxe employ√©e (variables, chemin, options)&lt;/li&gt;&#xA;&lt;li&gt;un rouge prononc√© pour les commandes inconnues&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;un-langage-qui-vous-veut-du-bien&#34;&gt;Un langage qui vous veut du bien&lt;/h2&gt;&#xA;&lt;p&gt;Pour revenir au sujet principal de cet article, Fish r√©volutionne notre rapport avec la r√©daction&#xA;de scripts. Fini les pi√®ges et la syntaxe qui nous ont tenu en otage durant des ann√©es. Les choses&#xA;deviennent bien plus simples et lisibles.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fish&#34; data-lang=&#34;fish&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# une comparaison de deux variables&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;test&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$a&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$b&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# une addition et une affectation&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;z&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;math&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$x&lt;/span&gt; + &lt;span class=&#34;nv&#34;&gt;$y&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# une boucle for&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;seq&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# un switch case&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$argv&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;un&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nf&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;deux&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; *&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;autre&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# une cha√Æne en minuscule&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string &lt;/span&gt;lower &lt;span class=&#34;nv&#34;&gt;$a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# une gestion des erreurs de commandes cha√Æn√©es&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;some_command&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;another_command&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;contains &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$pipestatus&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Une des commandes a √©chou√©&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;L&amp;rsquo;investissement initial pour perdre ses habitudes acquises avec Bash est mod√©r√©, notamment&#xA;le &lt;a href=&#34;https://fishshell.com/docs/current/language.html#variables-export&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;remplacement&lt;/a&gt; de &lt;code&gt;export&lt;/code&gt; ou de l&amp;rsquo;assignation &lt;code&gt;=&lt;/code&gt; par la m√©thode &lt;code&gt;set -x&lt;/code&gt; ou &lt;code&gt;set -u&lt;/code&gt;&#xA;respectivement. Mais l&amp;rsquo;enrichissement du langage par quelques nouveaux mots-cl√©s permet&#xA;d&amp;rsquo;all√©ger le script avec des syntaxes claires et lisibles (&lt;code&gt;contains&lt;/code&gt;, &lt;code&gt;math&lt;/code&gt; ou &lt;code&gt;string&lt;/code&gt;&#xA;pr√©sents dans l&amp;rsquo;exemple ci-dessus).&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;ajout de plugins communautaire n&amp;rsquo;est pas en reste, si comme moi, vous en consommiez avec&#xA;Oh-My-ZSH. L&amp;rsquo;outil &lt;a href=&#34;https://github.com/jorgebucaran/fisher&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fisher&lt;/a&gt; s&amp;rsquo;installe dans votre &lt;code&gt;~/.config/fish&lt;/code&gt; et donne acc√®s √† un&#xA;gestionnaire complet et sobre. Pour ma part, j&amp;rsquo;ai pu rapidement combler mon besoin de charger&#xA;les variables d&amp;rsquo;environnement fournies par l&amp;rsquo;agent SSH (&lt;code&gt;ssh-agent&lt;/code&gt;) lors du d√©marrage de ma&#xA;session.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; fisher install danhper/fish-ssh-agent&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;fisher install version 4.4.5&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Fetching https://api.github.com/repos/danhper/fish-ssh-agent/tarball/HEAD&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installing danhper/fish-ssh-agent&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; /home/florent/.config/fish/functions/__ssh_agent_is_started.fish&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; /home/florent/.config/fish/functions/__ssh_agent_start.fish&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; /home/florent/.config/fish/conf.d/fish-ssh-agent.fish&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Updated 1 plugin/s&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pas de myst√®re, ni d&amp;rsquo;arcanes magiques, votre environnement est enrichi de nouvelles fonctions&#xA;et de scripts de d√©marrage, d√©velopp√©s en Fish.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;osons-la-modernit√©&#34;&gt;Osons la modernit√©&lt;/h2&gt;&#xA;&lt;p&gt;La documentation du projet est tr√®s bien fournie. En plus de la page &lt;a href=&#34;https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tutorial&lt;/a&gt;, vous trouverez&#xA;une page d√©di√©e aux &lt;a href=&#34;https://fishshell.com/docs/current/fish_for_bash_users.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;utilisateurs de Bash&lt;/a&gt; pour vous aider √† r√©ussir votre transition. Pour ma&#xA;part, j&amp;rsquo;y retrouve des syntaxes bien plus proches du Python, et c&amp;rsquo;est un vrai plaisir.&lt;/p&gt;&#xA;&lt;p&gt;Le projet est vivant, avec un rythme de versions r√©gulier. Je me suis surpris moi-m√™me √† ne pas en&#xA;avoir entendu parler par d&amp;rsquo;autres coll√®gues ou aupr√®s des auteurices de blogs que je suis. Au cours des&#xA;derni√®res ann√©es, la communaut√© francophone a essaim√© quelques bons articles qui compl√®tent le&#xA;mien.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://lkdjiin.github.io/blog/2016/12/13/changer-de-shell-de-bash-a-fish/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Changer de shell, de Bash √† Fish&lt;/a&gt; (2016)&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://ubunlog.com/fr/ligne-de-commande-fish-smart/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fish, une ligne de commande intelligente et simple d&amp;rsquo;utilisation&lt;/a&gt; (2017)&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://toptips.fr/comment-passer-de-bash-a-fish-shell-sous-linux/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Comment passer de Bash √† Fish Shell sous Linux&lt;/a&gt; (2021)&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.otso.fr/2024-01-17-passer-zsh-fish-shell&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Migration de shell de zsh √† fish&lt;/a&gt; (2024)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Ces temps-ci, je fais √©voluer mon exp√©rience d&amp;rsquo;utilisateur de Linux avec une transition vers Wayland&#xA;et SwayWM (j&amp;rsquo;y reviendrais dans un autre article). Je ne le cache pas, la tentation de remplacer mes&#xA;scripts Bash qui g√®rent mes th√®mes ou les composants &lt;em&gt;swaybar&lt;/em&gt;, est forte, tr√®s forte.&lt;/p&gt;&#xA;&lt;p&gt;De quoi occuper mes prochaines longues soir√©es d&amp;rsquo;hiver.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Les types hi√©rarchiques</title>
    <updated>2024-09-19T11:20:00Z</updated>
    <id>tag:fljd.in,2024-09-19:/2024/09/19/les-types-hierarchiques/</id>
    <link href="https://fljd.in/2024/09/19/les-types-hierarchiques/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Bien que la norme SQL d√©finisse un ensemble de r√®gles pour que les syst√®mes de bases&#xA;de donn√©es puissent √™tre interchangeables, il existe de petites singularit√©s dans la&#xA;nature. √Ä ce titre, le type de donn√©es &lt;code&gt;hierarchyid&lt;/code&gt; fourni par SQL Server est un&#xA;exemple flagrant. Si vous √™tes amen√© √† basculer vers PostgreSQL, deux solutions s&amp;rsquo;offrent&#xA;√† vous.&lt;/p&gt;&#xA;&lt;p&gt;Une premi√®re et plus simple consiste √† lier chaque n≈ìud √† son parent √† l&amp;rsquo;aide d&amp;rsquo;une nouvelle&#xA;colonne &lt;code&gt;parentid&lt;/code&gt; et d&amp;rsquo;y appliquer une contrainte de cl√© √©trang√®re. Une autre approche,&#xA;plus compl√®te, consiste √† utiliser l&amp;rsquo;extension &lt;code&gt;ltree&lt;/code&gt;. Cet article traite de ce dernier&#xA;cas.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;√†-la-recherche-de-ses-descendants&#34;&gt;√Ä la recherche de ses descendants&lt;/h2&gt;&#xA;&lt;p&gt;Con√ßu pour repr√©senter une &lt;a href=&#34;https://learn.microsoft.com/en-us/sql/relational-databases/hierarchical-data-sql-server&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;relation hi√©rarchique&lt;/a&gt; sous la forme d&amp;rsquo;un arbre binaire, le&#xA;type &lt;code&gt;hierarchyid&lt;/code&gt; a la particularit√© de stocker la liste des n≈ìuds successifs jusqu&amp;rsquo;√†&#xA;la racine dans une seule colonne. Ainsi, le n≈ìud &lt;code&gt;/1/1/2/&lt;/code&gt; repr√©sente un n≈ìud de niveau&#xA;3, enfant du n≈ìud &lt;code&gt;/1/1/&lt;/code&gt;, lui-m√™me enfant du n≈ìud &lt;code&gt;/1/&lt;/code&gt;, lui-m√™me enfant de la racine &lt;code&gt;/&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Plusieurs m√©thodes sont fournies avec le langage Transact-SQL pour manipuler les donn√©es et&#xA;toutes parcourent l&amp;rsquo;arbre binaire pour en extraire rapidement l&amp;rsquo;information souhait√©e sans&#xA;avoir √† joindre les n≈ìuds de la table entre eux.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/sql/t-sql/data-types/tostring-database-engine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;ToString()&lt;/code&gt;&lt;/a&gt; : retourne la repr√©sentation textuelle du n≈ìud courant.&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/sql/t-sql/data-types/getlevel-database-engine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;GetLevel()&lt;/code&gt;&lt;/a&gt; : retourne le niveau de profondeur du n≈ìud courant.&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/sql/t-sql/data-types/getancestor-database-engine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;GetAncestor(n)&lt;/code&gt;&lt;/a&gt; : retourne le n≈ìud de niveau &lt;code&gt;n&lt;/code&gt; dans l&amp;rsquo;arbre.&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/sql/t-sql/data-types/getdescendant-database-engine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;GetDescendant(c1, c2)&lt;/code&gt;&lt;/a&gt; : retourne un nouveau n≈ìud enfant entre deux n≈ìuds.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;L&amp;rsquo;extension &lt;a href=&#34;https://www.postgresql.org/docs/current/ltree.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ltree&lt;/a&gt;, disponible depuis le paquet &lt;code&gt;contrib&lt;/code&gt; de PostgreSQL, est aussi compl√®te,&#xA;voire plus, que le type &lt;code&gt;hierarchyid&lt;/code&gt;. Elle fournit un type de donn√©es complexe, nomm√© &lt;code&gt;ltree&lt;/code&gt;,&#xA;et permet de stocker des labels de 1¬†000 caract√®res alphanum√©riques s√©par√©s par des points. Le&#xA;chemin (&lt;code&gt;path&lt;/code&gt;) ainsi constitu√©, peut lui-m√™me contenir jusqu&amp;rsquo;√† 65¬†635 labels.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ltree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ltree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locationtype&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Earth&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Planet&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Europe&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Continent&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.1.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;France&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Country&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.1.1.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Paris&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;City&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.1.2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Spain&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Country&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.1.2.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Madrid&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;City&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;South-America&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Continent&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.2.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Brazil&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Country&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.2.1.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Brasilia&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;City&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.2.2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Bahia&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;State&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.2.2.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Salvador&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;City&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.3&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Antarctica&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Continent&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1.3.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;McMurdo Station&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;City&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Obtenir le niveau de profondeur d&amp;rsquo;un n≈ìud devient trivial avec la fonction &lt;code&gt;nlevel()&lt;/code&gt;&#xA;fournie par l&amp;rsquo;extension &lt;code&gt;ltree&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locationtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nlevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; id | location | locationtype | level&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;---------+-----------------+--------------+-------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1 | Earth | Planet | 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1 | Europe | Continent | 2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.1 | France | Country | 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.1.1 | Paris | City | 4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.2 | Spain | Country | 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.2.1 | Madrid | City | 4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2 | South-America | Continent | 2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.1 | Brazil | Country | 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.1.1 | Brasilia | City | 4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.2 | Bahia | State | 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.2.1 | Salvador | City | 4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.3 | Antarctica | Continent | 2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.3.1 | McMurdo Station | City | 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 2.1.1 | unknown | State | 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(14 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Une autre m√©thode nomm√©e &lt;code&gt;subpath()&lt;/code&gt; permet de r√©cup√©rer une partie du chemin d&amp;rsquo;un n≈ìud.&#xA;Voyons comment obtenir le n≈ìud parent de chaque n≈ìud de la table.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locationtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subpath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nlevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parentid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; id | location | locationtype | parent&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;---------+-----------------+--------------+--------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1 | Earth | Planet |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1 | Europe | Continent | 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.1 | France | Country | 1.1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.1.1 | Paris | City | 1.1.1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.2 | Spain | Country | 1.1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.2.1 | Madrid | City | 1.1.2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2 | South-America | Continent | 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.1 | Brazil | Country | 1.2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.1.1 | Brasilia | City | 1.2.1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.2 | Bahia | State | 1.2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.2.2.1 | Salvador | City | 1.2.2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.3 | Antarctica | Continent | 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.3.1 | McMurdo Station | City | 1.3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 2.1.1 | unknown | State | 2.1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(14 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Enfin, la recherche des n≈ìuds enfants depuis un n≈ìud donn√© est possible gr√¢ce aux&#xA;op√©rateurs de comparaison sp√©cialis√©s. Pour favoriser les performances, il est recommand√©&#xA;de cr√©er un index GIST sur la colonne de cl√© primaire &lt;code&gt;id&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GIST&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La requ√™te suivante liste toutes les villes d&amp;rsquo;Europe.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;@&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locationtype&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;City&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Europe&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; id | location | locationtype&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;---------+----------+--------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.1.1 | Paris | City&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 1.1.2.1 | Madrid | City&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h2 id=&#34;travailler-sous-contraintes&#34;&gt;Travailler sous contraintes&lt;/h2&gt;&#xA;&lt;p&gt;La contrainte de cl√© primaire m&amp;rsquo;emp√™che actuellement d&amp;rsquo;ins√©rer un chemin d√©j√† existant.&#xA;Par contre, il est bien possible d&amp;rsquo;ajouter une nouvelle ligne dont le chemin ne pr√©sente&#xA;pas d&amp;rsquo;anc√™tre dans la table.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2.1.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Unknown&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Continent&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;INSERT 0 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;√Ä ce jeu, SQL Server et PostgreSQL n&amp;rsquo;ont plus trop de diff√©rences, il devient n√©cessaire&#xA;d&amp;rsquo;ajouter une &lt;a href=&#34;https://learn.microsoft.com/en-us/sql/relational-databases/hierarchical-data-sql-server#enforce-a-tree&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;colonne suppl√©mentaire&lt;/a&gt;, nomm√©e &lt;code&gt;parentid&lt;/code&gt; par exemple, pour ajouter la&#xA;contrainte de cl√© √©trang√®re. La requ√™te suivante r√©utilise la fonction &lt;code&gt;subpath()&lt;/code&gt; en&#xA;s&amp;rsquo;assurant qu&amp;rsquo;une valeur nulle soit ins√©r√©e s&amp;rsquo;il s&amp;rsquo;agit d&amp;rsquo;un n≈ìud racine.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;DELETE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;@&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COLUMN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parentid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ltree&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;REFERENCES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GENERATED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ALWAYS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CASE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subpath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nlevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ELSE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subpath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nlevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STORED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;√Ä pr√©sent, d√®s qu&amp;rsquo;une nouvelle ligne est ins√©r√©e, la contrainte de cl√© √©trang√®re est&#xA;automatiquement v√©rifi√©e.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2.1.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Unknown&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Continent&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ERROR: insert or update on table &amp;#34;locations&amp;#34; violates&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; foreign key constraint &amp;#34;locations_parentid_fkey&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;DETAIL: Key (parentid)=(2.1) is not present in table &amp;#34;locations&amp;#34;.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h2 id=&#34;une-solution-parmi-dautres&#34;&gt;Une solution parmi d&amp;rsquo;autres&lt;/h2&gt;&#xA;&lt;p&gt;La m√©thode de stockage des donn√©es hi√©rarchiques sous forme de chemin est une solution&#xA;ing√©nieuse et disponible facilement avec PostgreSQL. Cependant, il s&amp;rsquo;agit d&amp;rsquo;une extension&#xA;du langage SQL et chaque moteur peut proposer une impl√©mentation qui peut radicalement&#xA;changer d&amp;rsquo;un syst√®me √† l&amp;rsquo;autre.&lt;/p&gt;&#xA;&lt;p&gt;Comme je l&amp;rsquo;indiquais en introduction, la r√©ponse universelle reste la reconstruction d&amp;rsquo;une&#xA;relation hi√©riarchique √† l&amp;rsquo;aide d&amp;rsquo;une requ√™te r√©cursive et la syntaxe &lt;code&gt;WITH RECURSIVE&lt;/code&gt;. Pour&#xA;reprendre l&amp;rsquo;exemple de la table &lt;code&gt;locations&lt;/code&gt;, la liste des villes pr√©sentes en Europe pourrait&#xA;√™tre obtenue de la mani√®re suivante.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RECURSIVE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parentid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locationtype&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Europe&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UNION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parentid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locationtype&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parentid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locationtype&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;City&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; id | parentid | location | locationtype&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;----+----------+----------+--------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 4 | 3 | Paris | City&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 6 | 5 | Madrid | City&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Retour sur le PG Day France 2025</title>
    <updated>2025-06-18T07:56:12Z</updated>
    <id>tag:blog.atolcd.com,2025-06-18:/retour-sur-le-pg-day-france-2025/</id>
    <content type="html">&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;Les 3 et 4 juin derniers, la communaut√© francophone de PostgreSQL s‚Äôest retrouv√©e √† Mons, en Belgique, √† l‚Äôoccasion de l‚Äô√©dition 2025 du PG Day France. Chaque ann√©e depuis 2008, cet √©v√©nement itin√©rant investit une nouvelle ville pour faire vivre et grandir la communaut√© autour de PostgreSQL. PostgreSQL (prononc√© Post-Gress-Q-L) est un syst√®me de gestion de base de donn√©es relationnelle (SGBDR) open source. C‚Äôest l‚Äôun des SGBD les plus puissants, fiables et √©volutifs du march√©, tr√®s pris√© par les d√©veloppeurs, les entreprises et les administrations.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Apr√®s Toulouse, Lille, Toulon, Marseille, Lyon, Nantes, Montpellier ou encore Strasbourg, c‚Äô√©tait au tour de Mons d‚Äôaccueillir ateliers, conf√©rences, retours d‚Äôexp√©rience et moments de convivialit√© entre passionn√©s, utilisateurs et professionnels du monde PostgreSQL.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Nous avons pu suivre avec int√©r√™t les √©changes et les pr√©sentations qui ont rythm√© ces deux journ√©es. L‚Äô√©v√©nement a une fois de plus illustr√© la richesse de l‚Äô√©cosyst√®mePostgreSQL et les nombreuses possibilit√©s qu‚Äôil offre ‚Äì bien au-del√† du simple SGBD relationnel.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img fetchpriority=&#34;high&#34; decoding=&#34;async&#34; width=&#34;512&#34; height=&#34;483&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-days-1.jpg&#34; alt=&#34;&#34; class=&#34;wp-image-5978&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-days-1.jpg 512w, https://blog.atolcd.com/wp-content/uploads/2025/06/pg-days-1-300x283.jpg 300w&#34; sizes=&#34;(max-width: 512px) 100vw, 512px&#34; /&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Nous saluons l‚Äôorganisation et l‚Äô√©nergie des b√©n√©voles et intervenants qui font du PG Day France un rendez-vous incontournable pour toute la communaut√© PostgreSQL francophone.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Parmi les temps forts de la premi√®re journ√©e, plusieurs ateliers techniques √©taient propos√©s permettant d‚Äôassister √† un de ces ateliers parmi les 3. Nous avons opt√© pour un atelier diff√©rent chacun √† savoir :¬†&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Atelier : Industrialisez vos d√©ploiements PostgreSQL avec pglift et Ansible&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;&lt;em&gt;Par Alexandre Pereira et Julian Vanden Broeck&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Le but de cet atelier √©tait d‚Äôindustrialiser le d√©ploiement des instances, bases de donn√©es et r√¥les PostgreSQL √† l&amp;rsquo;aide de pglift et Ansible. Dalibo met √† disposition en open source sur son lab ces collections ansible [&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://labs.dalibo.com/dalibo_ansible_collections&#34; rel=&#34;noopener noreferrer&#34;&gt;https://labs.dalibo.com/dalibo_ansible_collections&lt;/a&gt;] ainsi que l‚Äôoutil pglift [&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://gitlab.com/dalibo/pglift&#34; rel=&#34;noopener noreferrer&#34;&gt;https://gitlab.com/dalibo/pglift&lt;/a&gt;]&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Malgr√© un effet d√©mo malencontreux sur les environnements mis √† disposition permettant de faire les cas pratiques, cela a permis de voir ce qu‚Äôil √©tait possible de faire avec ces collections et outils pour permettre l‚Äôindustrialisation des d√©ploiements de postgresql, des sauvegardes avec pgbackrest ou encore de la haute disponibilit√© avec patroni en utilisant pglift et Ansible.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Atelier: Are you collecting the right metrics ?&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;&lt;em&gt;Par Fr√©d√©ric Delacourt&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Les m√©triques sont des donn√©es quantifiables permettant de suivre l‚Äô√©tat de sant√© et les performances de sa base de donn√©es PostgreSQL. Leur principale utilit√© est de surveiller la base de donn√©es, afin de d√©tecter des anomalies dans le but d‚Äôalerter les DBA (DataBase Administrator) et les ops/devops d&amp;rsquo;√©ventuels probl√®mes. Bien utilis√©, on peut s‚Äôen servir pour comprendre certains comportements pour optimiser les performances et ressources de notre base.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Ces m√©triques peuvent √™tre class√©es en plusieurs cat√©gories :¬†&lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Informatives : qui permettent de suivre et comprendre l‚Äôactivit√© de la base, comme le nombre de requ√™tes par minutes, la taille des tables, la fr√©quence d‚Äôutilisation de chaque index‚Ä¶&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Importantes (pour la performance) : qui permettent de d√©tecter, anticiper et/ou corriger des lenteurs. On y retrouve par exemple le nombre de connexions ouvertes, le taux de requ√™tes lentes, le taux de bloat dans les tables‚Ä¶Critiques : qui peuvent mettre en p√©ril l‚Äô√©tat de sant√© de la base comme le nombre de transactions bloqu√©es, un disque presque plein, le nombre d&amp;rsquo;erreurs SQL, des nouvelles connexions rejet√©es‚Ä¶&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Keynote : O√π sont pass√©es les femmes de l&amp;rsquo;histoire de la tech? Par Laura Durieux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;La keynote d‚Äôouverture nous a pr√©sent√© des femmes qui ont marqu√© l‚Äôhistoire de la tech depuis son commencement, √† savoir les calculs astronomiques jusqu‚Äôau d√©veloppement de programme. On a pu en apprendre un peu sur ces femmes clefs de l‚Äôhistoire avec notamment :¬†&lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Nicole-Reine Lepaute qui calcule le retour de la Com√®te de Halley de fa√ßon assez pr√©cise pour l‚Äô√©poque (1759)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Maria Mitchell la premi√®re √† observer une ¬´ com√®te t√©lescopique ¬ª (com√®te non visible √† l‚Äô≈ìil nu)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Ada Lovelace qui a √©crit les premi√®res formes d‚Äôalgorithme¬†&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Grace Hopper qui a √©t√© la premi√®re d√©veloppeuse sur le Mark I et une des fondatrices du langage COBOL&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;ENIAC Girls √©tait un groupe de six programmeuses ayant particip√© au d√©veloppement et √† la programmation d&amp;rsquo;un des premiers ordinateurs au monde, l&amp;rsquo;ENIAC&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Hedy Lamarr qui a invent√© le FHSS, une technologie qui est toujours derri√®re le wifi et le Bluetooth&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Il y en avait encore d‚Äôautres dans la pr√©sentation que nous vous laisserons d√©couvrir si vous avez l‚Äôoccasion de voir cette conf√©rence. Cela a √©t√© aussi l‚Äôoccasion de voir ce qui a entra√Æn√© la sous-repr√©sentation des femmes dans le domaine de la tech √† travers notre soci√©t√© depuis l&amp;rsquo;arriv√©e des ordinateurs personnels dans les foyers, souvent associ√©s au p√®re et leur fils dans les publicit√©s‚Ä¶ On ne voudrait pas vous spoiler trop non plus, mais on vous conseille de la voir, d&amp;rsquo;y r√©fl√©chir et d‚Äôagir pour ouvrir le monde de la tech √† tous et toutes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Postgres sur Kubernetes pour le DBA r√©ticent Par Karen Jex&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Une pr√©sentation de Postgres sur Kubernetes qui est une √©volution des pratiques passant de serveur physique, puis de machines virtuelles et maintenant de conteneurs pour le d√©ploiement de PostgreSQL. Kubernetes a d√©j√† 10 ans, il s‚Äôagit d‚Äôune solution mature qui a montr√© ses qualit√©s pour le d√©ploiement d‚Äôapplications de fa√ßon automatis√©e et scalable mais qui entra√Æne quelques r√©ticences pour le d√©ploiement de base de donn√©es, car son principe √©tant des conteneurs stateless et √©ph√©m√®res. Mais il y a du stockage persistant qui permet de ne pas perdre ces donn√©es. De plus en plus de soci√©t√©s passent √† Kubernetes, le plus grand frein √©tant surtout la mont√©e en comp√©tence n√©cessaire sur Kubernetes mais qui permet une fois ce stade pass√© de gagner du temps pour d‚Äôautres t√¢ches n√©cessitant l‚Äôexpertise d‚Äôun DBA.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Tout savoir sur max_connections Par Guillaume Lelarge&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pr√©sentation du param√®tre de configuration ‚Äòmax_connections‚Äô, son utilisation, les diff√©rentes valeurs qu‚Äôil peut prendre et le changement de performances li√©es √† ces valeurs.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Avoir une trop grosse valeur de max_connections, permet d‚Äôavoir un fort pic d‚Äôutilisation de la base, mais la m√©moire initiale que prend PostgreSQL s‚Äôen voit augment√©e (et de mani√®re tr√®s significative, voire exponentielle quand les valeurs deviennent tr√®s grandes).&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pr√©sentation √©galement de la consommation des connexions en comparant des connexions avec pooler et sans pooler. Les avantages et inconv√©nients de chacun comme le temps de connexion √† la base (qui n‚Äôest pas n√©cessaire pour les pooler car celle-ci est r√©utilis√©e) qui peut repr√©senter un bon pourcentage du temps total de l‚Äôex√©cution de la session. La mise en place d‚Äôun pooler permet d‚Äôaugmenter grandement le nombre de transactions par seconde en minimisant ces temps de connexion.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Json in Postgres Par S√©bastien Delobel&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pr√©sentation du Type Json dans PostgreSQL et son utilisation ainsi que les bonnes pratiques √† avoir notamment entre les JSON et les JSONB.&lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Le format JSON permet de stocker la donn√©e en texte, il est pratique quand on cherche uniquement √† stocker la donn√©e sans y toucher. Attention tout de m√™me, lorsqu&amp;rsquo;un update sur ce champ, l‚Äôancien contenu est √©cras√© et remplac√© par le nouveau.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Le format JSONB quant √† lui est plut√¥t utile pour interroger et modifier les donn√©es. Il permet de stocker les informations sous format binaire, ce qui permet plus de flexibilit√©. On peut indexer un champ √† l‚Äôint√©rieur du json, faire des recherches et des filtres sur les donn√©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Lors d‚Äôune modification, on peut ajouter ou supprimer certaines cl√©s directement et sans avoir √† devoir r√©√©crire tout l‚Äôobjet pour ne perdre aucune donn√©e.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;On retiendra l‚Äôusage d‚Äôun index b-tree sur une seule valeur et l‚Äôutilisation d‚Äôun index GIN sur plusieurs valeurs composantes.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Cl√¥ture de la premi√®re journ√©e&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;La journ√©e s‚Äôest termin√©e par une pr√©sentation de la ville de Mons par Stefan Fercot qui √©tait le contact local de l‚Äô√©v√©nement, avec les diff√©rents sites incontournables de la ville : son beffroi, la grand-place, la Coll√©giale Sainte Waudru, le Doudou et son rituel et surtout le singe du Grand‚ÄôGarde qui, √† l‚Äôinstar de notre Chouette dijonnaise, porte lui aussi bonheur si on touche sa t√™te de la main gauche‚ÄØ!¬†&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Comme √† son accoutum√©e, la journ√©e s&amp;rsquo;est termin√©e par un community event dans un lieu incontournable en Belgique‚Ä¶ √† savoir une brasserie &lt;img src=&#34;https://s.w.org/images/core/emoji/17.0.2/72x72/1f609.png&#34; alt=&#34;üòâ&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; pour un moment d‚Äô√©change et de partage entre participants, speakers et organisateurs.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Apr√®s une premi√®re journ√©e bien remplie, nous voil√† pr√™ts √† attaquer de nouveau une deuxi√®me journ√©e de pr√©sentation avec au programme.¬†&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Anatomy of Table-Level Locks in PostgreSQL Par G√ºl√ßin Yƒ±ldƒ±rƒ±m Jelinek&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pr√©sentation sur les locks, acc√®s concurrents, les diff√©rents niveaux de blocage en fonction des actions, les diff√©rents niveaux d‚Äôisolation des transactions et comment faire pour √©viter qu‚Äôune transaction bloque pendant plusieurs minutes, voire heures la base de donn√©es.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Si une transaction pose un verrou celui-ci est conserv√© tant que la transaction n‚Äôest pas termin√©e, il faut donc veiller √† √©viter de faire des modifications qui pose un verrou trop important en m√™me temps qu‚Äôun gros traitement de donn√©es qui garderait un verrou potentiellement exclusif pendant un long moment et bloquerait les autres transactions.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Afin d‚Äôanalyser et limiter cela, il est possible d‚Äôutiliser la vue pg_locks et surtout la fonction pg_blocking_pids() qui permet de voir quels autres processus bloquent le processus en question ainsi que de limiter le temps de lock via le param√®tre lock_timeout, mais surtout de d√©couper les instructions en plusieurs √©tapes pour ne pas mixer les types de lock et ne pas bloquer d‚Äôautres requ√™tes.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;La pr√©sentation s‚Äôest termin√©e par l‚Äôusage de l‚Äôoutil pgroll permettant des modifications de sch√©ma PostgreSQL s√ªres, r√©versibles et sans temps d&amp;rsquo;arr√™t.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;R√©glage automatis√© de PostgreSQL : Explorer l&amp;rsquo;optimisation des param√®tres serveur Par Luigi Nardi&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pr√©sentation de DBtune qui permet d‚Äôautomatiser l‚Äôoptimisation de la configuration de base de donn√©es √† travers le machine learning afin de tester plusieurs configurations et ajuster les param√®tres pour trouver une configuration optimale pour la base en fonction de la machine, de ces m√©triques et de l‚Äôusage de celles-ci de fa√ßon dynamique.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Dans les exemples de configurations effectu√©es apr√®s plusieurs it√©rations de configuration une instance Amazon RDS permettait d‚Äôavoir des performances similaires de transactions par secondes quasi identiques entre une instance RDS m5.2xl avec DBtune et une instance de base RDS m5.4xl avec deux fois plus de ressources mat√©rielles.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Table ronde &amp;#8211; Comment contribuer √† PostgreSQL ?&lt;/h3&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;L‚Äôimportance de la traduction : certains pays o√π la documentation dans la langue locale n‚Äôest pas disponible et o√π les personnes parlent peu anglais.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;D√©couverte de bug et cr√©ation de ticket et/ou proposition de correctif.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Proposition de nouvelle feature. (plus complexe, car il faut prouver l&amp;rsquo;utilit√© de cette feature comparer √† un correctif de bug)¬†&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Propager l‚Äôexistence du r√©seau FR pour accueillir de nouveaux ‚Äúadeptes‚Äù et montrer que la communaut√© est accessible et accueillante, comme par exemple par le biais de conf√©rences ou table ronde comme celle-ci.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Lightning Talks&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Quelques courtes pr√©sentations de 5 minutes sur diff√©rents sujets avec :¬†&lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;pr√©sentation de l‚Äôoutil pgSimload par Jean-Paul Argudo¬†&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;les diff√©rents types d‚Äôindex par Thibaut Madeleine&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;le partitionnement par timestamp avec uuid v7 par Florent Jardin&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;l‚Äôextension pg_tde et Percona Server par Yoann La Cancellera&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;FOSS4G Belgium 2025 par Gael Kruwialis&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PostgreSQL Conference Europe 2025 par Marc Linster&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Agent IA et Postgres par Matt Cornillon&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Comment se d√©barrasser de Full Page Write ? Par Fabien Coelho&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pr√©sentation sur la configuration de full page write afin de ne pas avoir de baisse de performance sur le nombre de transactions par seconde au moment des √©critures, mais sa d√©sactivation peut poser d‚Äôautres questions sur l&amp;rsquo;int√©grit√© des donn√©es. Un param√®tre √† modifier avec prudence.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Voyage au centre des statistiques dans postgres Par Louise Leinweber&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pr√©sentation de multiples solutions natives de Postgres permettant d‚Äôavoir des statistiques sur les diff√©rentes donn√©es et tables utilis√©es par le planificateur de requ√™te. On peut retrouver ces donn√©es dans la vue syst√®me pg_stats qui contient par exemple pour une colonne d‚Äôune table les valeurs les plus fr√©quentes, la fr√©quence de ces donn√©es, la fr√©quence de valeur nul sur un champ‚Ä¶&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;√Ä partir de ces statistiques, le planificateur de requ√™te va opter pour le meilleur plan √† partir d‚Äôestimation li√© √† ces statistiques. Si elles sont erron√©es en nombre de lignes estim√©es par rapport √† la r√©alit√© cela peut entra√Æner de ne pas avoir utilis√© le meilleur plan d‚Äôex√©cution.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;On a pu aussi voir comment est calcul√©e la s√©lectivit√© dans diff√©rents op√©rateurs ainsi que le fonctionnement de la combinaison de s√©lectivit√© et surtout qu‚Äôil √©tait possible d‚Äôagir dessus en cr√©ant de nouvelles statistiques (&lt;code&gt;CREATE STATISTIC&lt;/code&gt; [&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://www.postgresql.org/docs/17/sql-createstatistics.html&#34; rel=&#34;noopener noreferrer&#34;&gt;https://www.postgresql.org/docs/17/sql-createstatistics.html&lt;/a&gt;]) afin d‚Äôinfluencer sur cela en fonction de cas d‚Äôusage sp√©cifique s‚Äôil y a un lien entre diff√©rentes colonnes d‚Äôune m√™me table et permettre √† PostgreSQL d‚Äôavoir une bonne estimation du nombre de lignes, et ainsi r√©pondre de fa√ßon plus rapide.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Il est possible de modifier la configuration de ces collectes de statistiques de mani√®re globale, mais aussi par colonne / table.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Comment d√©placer une base Postgres avec z√©ro downtime ? Par Naeva Mallet&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Cette conf√©rence nous montrait un retour d‚Äôexp√©rience chez ‚Äúleboncoin‚Äù, sur comment d√©placer un grand nombre de bases d‚Äôinstances individuelles vers des instances mutualis√©es afin de r√©duire les co√ªts. L&amp;rsquo;objectif √©tait d&amp;rsquo;automatiser le processus pour d√©placer les bases en quelques commandes, et surtout avec le moins de downtime possible.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pour cela la r√©plication logique a √©t√© utilis√©e en plusieurs √©tapes :&lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Copie de la structure et clef primaire de la base source&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;publication et souscription de la r√©plication logique&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;attente copie des donn√©es&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;cr√©ation des index&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;copie s√©quences et suppression de la r√©plication¬†&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Cela a aussi abouti √† la mise √† disposition en open-source de ce script (&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://github.com/leboncoin/pg-logical-replication-helper&#34; rel=&#34;noopener noreferrer&#34;&gt;https://github.com/leboncoin/pg-logical-replication-helper&lt;/a&gt;) permettant la migration logique entre deux instances de base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Cl√¥ture&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;512&#34; height=&#34;171&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-fays-2.png&#34; alt=&#34;&#34; class=&#34;wp-image-5980&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-fays-2.png 512w, https://blog.atolcd.com/wp-content/uploads/2025/06/pg-fays-2-300x100.png 300w&#34; sizes=&#34;(max-width: 512px) 100vw, 512px&#34; /&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Apr√®s ces deux jours intensifs de pr√©sentation, place aux remerciements pour les orateurs, sponsors, b√©n√©voles de l‚Äôassociation Postgresql FR, participants et graphiste de cette belle affiche. Beaucoup d‚Äôinformations emmagasin√©es, beaucoup d&amp;rsquo;√©changes enrichissants avec les organisateurs, participants et orateurs de l‚Äô√©v√©nement. C‚Äôest toujours un r√©el plaisir de pouvoir √©changer avec les membres de la communaut√© Postgres.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;Et un remerciement particulier pour les locaux de l‚Äô√©tape Stephan et Leila qui nous ont fait d√©couvrir leur magnifique ville de Mons et la Belgique.¬†&lt;/p&gt;&#xA;&#xA;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/&#34;&gt;Retour sur le PG Day France 2025&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=retour-sur-le-pg-day-france-2025" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Les 3 et 4 juin derniers, la communaut√© francophone de PostgreSQL s‚Äôest retrouv√©e √† Mons, en Belgique, √† l‚Äôoccasion de l‚Äô√©dition 2025 du PG Day France. Chaque ann√©e depuis 2008, cet √©v√©nement itin√©rant investit une nouvelle ville pour faire vivre... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/&#34;&gt;Retour sur le PG Day France 2025&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>[Infographie] PostgreSQL</title>
    <updated>2021-02-11T11:23:13Z</updated>
    <id>tag:blog.atolcd.com,2021-02-11:/infographie-postgresql/</id>
    <content type="html">&#xA;&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuli√®rement chez Atol CD ! Retrouvez dans cette infographie quelques caract√©ristiques techniques, des chiffres-cl√©, son histoire mais aussi pourquoi nous l&amp;rsquo;aimons et notre Top5 des fonctionnalit√©s c√¥t√© d√©veloppement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-gallery columns-1 is-cropped wp-block-gallery-1 is-layout-flex wp-block-gallery-is-layout-flex&#34;&gt;&lt;ul class=&#34;blocks-gallery-grid&#34;&gt;&lt;li class=&#34;blocks-gallery-item&#34;&gt;&lt;figure&gt;&lt;img decoding=&#34;async&#34; width=&#34;866&#34; height=&#34;2560&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; alt=&#34;&#34; data-id=&#34;4477&#34; data-full-url=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; data-link=&#34;https://blog.atolcd.com/infographie-postgresql/infographie_postgresql/&#34; class=&#34;wp-image-4477&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg 866w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-101x300.jpg 101w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-346x1024.jpg 346w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-768x2271.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-520x1536.jpg 520w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-693x2048.jpg 693w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-600x1774.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-945x2794.jpg 945w&#34; sizes=&#34;(max-width: 866px) 100vw, 866px&#34; /&gt;&lt;/figure&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/figure&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/infographie-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=infographie-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuli√®rement chez Atol CD ! Retrouvez dans cette infographie quelques caract√©ristiques techniques, des chiffres-cl√©, son histoire mais aussi pourquoi nous l&amp;#8217;aimons et notre Top5 des fonctionnalit√©s c√¥t√© d√©veloppement.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 13</title>
    <updated>2020-09-24T05:54:57Z</updated>
    <id>tag:blog.atolcd.com,2020-09-24:/sortie-de-postgresql-13/</id>
    <content type="html">&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-4130&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg&#34; alt=&#34;&#34; width=&#34;960&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg 960w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-300x169.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-768x432.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-600x338.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-945x532.jpg 945w&#34; sizes=&#34;auto, (max-width: 960px) 100vw, 960px&#34; /&gt;Malgr√© des actualit√©s plut√¥t moroses au Botswana concernant nos chers √©l√©phants, il y en a un qui se porte bien et est encore plus fort √† savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.¬†&lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;Apr√®s seulement 3 versions B√™ta et une RC le voil√† dans les starting blocks pour d√©barquer sur vos serveurs ! Et comme √† chaque nouvelle version son&lt;/span&gt; &lt;span style=&#34;font-weight: 400;&#34;&gt;lot de nouveaut√©s&lt;/span&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;Un petit rappel qui peut parfois √©viter bien des catastrophes, si vous avez pr√©vu de migrer vers PostgreSQL 13, vous devriez jeter un oeil sur &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html#id-1.11.6.5.4&#34;&gt;les potentielles incompatibilit√©s avec les pr√©c√©dentes versions&lt;/a&gt;¬† (et aussi sur les versions interm√©diaires si vous faite un gap de plusieurs versions d&amp;rsquo;un coup), il est toujours pr√©f√©rable d&amp;rsquo;identifier ces l√©gers changements en amont plut√¥t qu&amp;rsquo;une fois en production. Mais rassurez-vous, dans cette version pas de quoi freiner significativement une migration.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Partitionnement&lt;/h1&gt;&#xA;&lt;p&gt;Des am√©liorations sont ajout√©es sur le partitionnement de tables, tant au niveau performance avec l&amp;rsquo;ajout de cas o√π une jointure directe entre partition peut √™tre utilis√©e dans une requ√™te, mais aussi de fonctionnalit√©s telles que¬† la gestion des triggers avec le support de la clause BEFORE ou bien encore la r√©plication logique sans avoir besoin de publier chaque partition.&lt;/p&gt;&#xA;&lt;h1&gt;Index&lt;/h1&gt;&#xA;&lt;p&gt;L√† aussi des am√©liorations de performances mais aussi des gains d&amp;rsquo;espace disque sur les index B-tree surtout pour ceux contenant des doublons, mais si vous passez par un pg_upgrade il voudra passer par un reindex pour b√©n√©ficier de ces changements.&lt;/p&gt;&#xA;&lt;h1&gt;Planificateur&lt;/h1&gt;&#xA;&lt;p&gt;Le planificateur de requ√™te PostgreSQL a lui aussi eu le droit √† quelques am√©liorations notamment au niveau des statistiques ce qui peut am√©liorer les plans d&amp;rsquo;ex√©cution et donc les performances.&lt;/p&gt;&#xA;&lt;h1&gt;Performance g√©n√©rale&lt;/h1&gt;&#xA;&lt;p&gt;Les performances ne sont pas en reste dans cette nouvelle version, avec l&amp;rsquo;ajout du &lt;span style=&#34;font-weight: 400;&#34;&gt;tri incr√©mentiel ce qui acc√©l√®re le tri des donn√©es dans certains cas, ¬†sur les agr√©gations de hachage qui peuvent d√©sormais utiliser le stockage sur disque dans le cadre de grands ensembles d&amp;rsquo;agr√©gation, sur la conversion de type entier vers texte.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Vues syst√®me&lt;/h1&gt;&#xA;&lt;p&gt;De nouvelles vues syst√®me font leur apparition :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#BASEBACKUP-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_basebackup &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#ANALYZE-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_analyze &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/view-pg-shmem-allocations.html&#34;&gt;pg_shmem_allocations &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#MONITORING-PG-STAT-SLRU-VIEW&#34;&gt;pg_stat_slru&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;la vue &lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#PG-STAT-ACTIVITY-VIEW&#34;&gt;pg_stat_activity&lt;/a&gt; se voit elle ajout√©e une colonne leader_pid ce qui permet de retrouver rapidement¬†tous les processus impliqu√©s dans une requ√™te parall√®le.&lt;/p&gt;&#xA;&lt;h1&gt;Fonctionnalit√©s&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ajout de la fonctionnalit√© &lt;a href=&#34;https://www.postgresql.org/docs/13/sql-select.html#SQL-LIMIT&#34;&gt;FETCH FIRST WITH TIES&lt;/a&gt; (vous trouverez &lt;a href=&#34;http://pgphil.ovh/topn_13_beta_01.php&#34;&gt;ici&lt;/a&gt; un exemple)&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la fonction gen_random_uuid() utilisable sans activer d‚Äôextensions&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilit√© de renommer une colonne d&amp;rsquo;une vue :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;ALTER VIEW [ IF EXISTS ] name RENAME [ COLUMN ] column_name TO new_column_name&lt;/pre&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la fonction .datetime() dans les jsonpath pour convertir automatique une cha√Æne en date ou horodatage&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Client psql&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de nouvelles commandes pour afficher la description de classe d&amp;rsquo;op√©rateur et famille d&amp;rsquo;op√©rateur&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a class=&#34;link&#34; title=&#34;Meta-Commands&#34; href=&#34;https://www.postgresql.org/docs/13/app-psql.html#APP-PSQL-META-COMMANDS&#34;&gt;&lt;code class=&#34;literal&#34;&gt;\dAc&lt;/code&gt;&lt;/a&gt;,¬†&lt;code class=&#34;literal&#34;&gt;\dAf&lt;/code&gt;,¬†&lt;code class=&#34;literal&#34;&gt;\dAo&lt;/code&gt;, et &lt;code class=&#34;literal&#34;&gt;\dAp&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Ajout du statut de la transaction dans le prompt¬†&lt;br /&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;* dans une transaction&lt;/li&gt;&#xA;&lt;li&gt;! dans un √©chec de transaction&lt;/li&gt;&#xA;&lt;li&gt;? pour un √©tat ind√©termin√© de la transaction&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Administration&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la capacit√© de la commande VACUUM √† traiter des index en parall√®le&lt;/li&gt;&#xA;&lt;li&gt;la commande reindexdb peut aussi parall√©liser les t√¢ches&lt;/li&gt;&#xA;&lt;li&gt;introduction de la notion de ¬´ trusted extension ¬ª qui permet √† un super utilisateur de d√©finir les extensions qu‚Äôun utilisateur a le droit d&amp;rsquo;installer dans sa base de donn√©es en ayant le droit CREATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout pour pg_dump de l&amp;rsquo;option &amp;#8211;include-foreign-data pour inclure dans la sauvegarde les donn√©es de serveurs distants&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La liste des nouveaut√©s dans cette version est grande, toutes les nouveaut√©s n&amp;rsquo;ont pas √©t√© abord√©es mais vous pouvez bien sur les retrouver dans la &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html&#34;&gt;note de version&lt;/a&gt;. Le focus a surtout √©t√© fait sur le c√¥t√© utilisateur plut√¥t qu&amp;rsquo;administrateur de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;¬†&lt;/p&gt;&#xA;&lt;p&gt;¬†&lt;/p&gt;&#xA;&lt;p&gt;¬†&lt;/p&gt;&#xA;&lt;p&gt;¬†&lt;/p&gt;&#xA;&lt;p&gt;¬†&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-13/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-13" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Malgr√© des actualit√©s plut√¥t moroses au Botswana concernant nos chers √©l√©phants, il y en a un qui se porte bien et est encore plus fort √† savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.¬† Apr√®s... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 11</title>
    <updated>2018-10-19T13:12:39Z</updated>
    <id>tag:blog.atolcd.com,2018-10-19:/sortie-de-postgresql-11/</id>
    <content type="html">&lt;p&gt;Apr√®s seulement une release candidate (mais auparavant 4 version b√™ta), PostgreSQL 11 vient de sortir!!!! Et comme √† chaque nouvelle version son lot de nouveaut√©s que nous allons essayer de passer rapidement en revue.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-3169&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg&#34; alt=&#34;&#34; width=&#34;826&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg 826w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-300x196.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-768x502.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-600x392.jpg 600w&#34; sizes=&#34;auto, (max-width: 826px) 100vw, 826px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Am√©lioration de la parall√©lisation&lt;/h2&gt;&#xA;&lt;p&gt;Quoi de mieux que de commencer le tour des nouveaut√©s par un sujet que l&amp;rsquo;on a abord√© lors du &lt;a href=&#34;https://blog.atolcd.com/conference-la-parallelisation-au-service-de-loptimisation/&#34;&gt;PG Day France 2018&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL 11 va encore plus loin dans la parall√©lisation avec :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Cr√©ation d&amp;rsquo;index B-tree en parall√®le&lt;/li&gt;&#xA;&lt;li&gt;Parall√©lisation des UNION ALL&lt;/li&gt;&#xA;&lt;li&gt;Am√©lioration du Parallel hash join (parall√©liser le remplissage d‚Äôune seule table de hachage, partag√©e) et parallelized sequential scans&lt;/li&gt;&#xA;&lt;li&gt;Parall√©lisation sur la cr√©ation de vue mat√©rialis√©e et table √† partir des r√©sultats d&amp;rsquo;une requ√™te&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE .. AS, SELECT INTO et CREATE MATERIALIZED VIEW.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un param√®tre de configuration du serveur ¬´¬†parallel_leader_participation¬†¬ª qui permet de contr√¥ler si le processus leader participe √† l&amp;rsquo;ex√©cution des sous plans d&amp;rsquo;ex√©cution&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Am√©lioration du partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilit√© de partitionner une table par hashage de cl√© (en plus des autres)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE hash1 (col1 NUMERIC, col2 VARCHAR(10)) PARTITION BY HASH(col1);&#xD;&#xA;CREATE TABLE hash1a PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 0) ;&#xD;&#xA;CREATE TABLE hash1b PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 1) ;&#xD;&#xA;CREATE TABLE hash1c PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 2) ;&#xD;&#xA;CREATE TABLE hash1d PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 3) ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout possible d&amp;rsquo;une partition par d√©faut pour les donn√©es ne correspondant √† aucune partition&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table1d PARTITION OF table1 DEFAULT;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilit√© de cr√©er des cl√©s primaires, cl√©s √©trang√®res, index et triggers qui seront automatiquement applicables sur l&amp;rsquo;ensemble des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support du changement automatique de partition en cas de mise √† jour de la cl√© de partitionnement&lt;/li&gt;&#xA;&lt;li&gt;Am√©lioration des performances lors des SELECT sur la lecture des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support des upsert sur les tables partitionn√©es&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;INSERT  INTO  tablep1 (col1, col2) &#xD;&#xA;VALUES  (100,  &#39;update&#39;) &#xD;&#xA;ON  CONFLICT ON CONSTRAINT tablep1_pkey &#xD;&#xA;DO UPDATE SET col2=&#39;update&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Gestion des transactions dans les proc√©dures stock√©es&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit la possibilit√© de cr√©er des proc√©dures (en PL/pgSQL, PL/Perl, PL/Python, et PL/Tcl). Depuis de nombreuses ann√©es, il est possible dans PostgreSQL de cr√©er des fonctions et bien ici √ßa y ressemble fortement, sauf que l&amp;rsquo;on ne retourne pas de r√©sultats et que l&amp;rsquo;on peut g√©rer les transactions !&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PROCEDURE transaction_test1()&#xD;&#xA;LANGUAGE plpgsql&#xD;&#xA;AS $$&#xD;&#xA;BEGIN&#xD;&#xA;  FOR i IN 0..9 LOOP&#xD;&#xA;    INSERT INTO table1 (col1) VALUES (i) ;&#xD;&#xA;    IF i % 2 = 0 THEN&#xD;&#xA;      COMMIT;&#xD;&#xA;    ELSE&#xD;&#xA;      ROLLBACK;&#xD;&#xA;    END IF;&#xD;&#xA;  END LOOP;&#xD;&#xA;END;&#xD;&#xA;$$;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;ex√©cution de ces proc√©dures se fait en utilisant la commande CALL&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CALL transaction_test1();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Compilation JIT&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit le support de la compilation Just-in-Time (JIT) pour optimiser l‚Äôex√©cution de code et d‚Äôautres op√©rations. Utilisant des composants du projet LLVM, l‚Äôintroduction de JIT dans PostgreSQL acc√©l√®re les requ√™tes utilisant des expressions, listes, agr√©gats, projections, ainsi que certaines op√©rations internes.&lt;/p&gt;&#xA;&lt;p&gt;Pour pouvoir utiliser la compilation JIT, vous devrez installer la d√©pendance LLVM puis activer la compilation JIT soit dans le fichier de configuration (jit = on), soit durant votre session en ex√©cutant SET jit = on.&lt;/p&gt;&#xA;&lt;p&gt;La compilation JIT b√©n√©ficie surtout aux requ√™tes de longue dur√©e et limit√©es par le processeur. Ce seront souvent des requ√™tes analytiques (OLAP). Pour les requ√™tes courtes, le surco√ªt apport√© par la compilation JIT sera souvent sup√©rieur au temps qu&amp;rsquo;elle permet de gagner.&lt;/p&gt;&#xA;&lt;h2&gt;Am√©liorations g√©n√©rales SQL&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de toutes les clauses (SQL:2011) dans les fonctions de fen√™trage ce qui permet maintenant l‚Äôutilisation de RANGE dans des clauses PRECEDING/FOLLOWING, GROUPS ou d‚Äôexclusion&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;WINDOW window_name AS ( &#xD;&#xA;  [ PARTITION BY expression [, ...] ]&#xD;&#xA;  [ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]&#xD;&#xA;  [ frame_clause ]&#xD;&#xA;)&#xD;&#xA;&#xD;&#xA;frame_clause :&#xD;&#xA;{ RANGE | ROWS | GROUPS } frame_start [ frame_exclusion ]&#xD;&#xA;{ RANGE | ROWS | GROUPS } BETWEEN frame_start AND frame_end [ frame_exclusion ]&#xD;&#xA;&#xD;&#xA;frame_start / frame_end :&#xD;&#xA;&#xD;&#xA;UNBOUNDED PRECEDING&#xD;&#xA;offset PRECEDING&#xD;&#xA;CURRENT ROW&#xD;&#xA;offset FOLLOWING&#xD;&#xA;UNBOUNDED FOLLOWING&#xD;&#xA;&#xD;&#xA;frame_exclusion :&#xD;&#xA;&#xD;&#xA;EXCLUDE CURRENT ROW&#xD;&#xA;EXCLUDE GROUP&#xD;&#xA;EXCLUDE TIES&#xD;&#xA;EXCLUDE NO OTHERS&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de fonctions de hash sha-2 : sha224(), sha256(), sha384() et sha512()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions de recherche plein texte : json(b)_to_tsvector() et websearch_to_tsquery()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;op√©rateur ^@ identique √† LIKE &amp;lsquo;mot%&amp;rsquo; mais plus efficace sur un index b-tree&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;text ^@ text&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Am√©lioration des index avec l&amp;rsquo;ajout du mot clef INCLUDE, qui permet d&amp;rsquo;indiquer une liste de colonnes qui seront incluses dans l&amp;rsquo;index comme des colonnes non cl√©s. L&amp;rsquo;ajout de colonnes dans la cr√©ation d&amp;rsquo;index permet alors l&amp;rsquo;utilisation de parcours d&amp;rsquo;index couvrants.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE [ UNIQUE ] INDEX [ CONCURRENTLY ] [ [ IF NOT EXISTS ] nom ] ON [ ONLY ] nom_table [ USING m√©thode ]&#xD;&#xA;    ( { nom_colonne | ( expression ) } [ COLLATE collation ] [ classeop ] [ ASC | DESC ] [ NULLS { FIRST | LAST } ] [, ...] )&#xD;&#xA;    [ INCLUDE ( nom_colonne [, ...] ) ]&#xD;&#xA;    [ WITH ( parametre_stockage = valeur [, ... ] ) ]&#xD;&#xA;    [ TABLESPACE nom_espacelogique ]&#xD;&#xA;    [ WHERE pr√©dicat ]&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Am√©lioration de l‚Äôordre ALTER TABLE .. ADD COLUMN .. DEFAULT .. avec une valeur par d√©faut non NULL n‚Äôa plus besoin de r√©√©crire enti√®rement la table lors de son ex√©cution, ce qui entra√Æne une grosse am√©lioration des performances.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Authentification&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;authentification LDAP, mais celle ci n&amp;rsquo;est utilis√©e que pour valider les paires nom d&amp;rsquo;utilisateur/mot de passe. De ce fait, pour pouvoir utiliser LDAP comme m√©thode d&amp;rsquo;authentification, l&amp;rsquo;utilisateur doit pr√©alablement exister dans la base.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;psql&lt;/h2&gt;&#xA;&lt;p&gt;Le client psql √©volue lui aussi :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des commandes ¬´¬†quit¬†¬ª et ¬´¬†exit¬†¬ª dans le client psql&amp;#8230; (fini les personnes prisent de panique pour sortir de leur terminal ??? )&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://media.giphy.com/media/xTk9ZBWrma4PIC9y4E/giphy.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la commande \gdesc pour afficher les noms et types de colonnes du r√©sultat de la requ√™te&lt;/li&gt;&#xA;&lt;li&gt;Ajout de variables pour les erreurs et activit√©s des requ√™tes ERROR, SQLSTATE, ROW_COUNT, LAST_ERROR_MESSAGE, and LAST_ERROR_SQLSTATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilit√© de tester l&amp;rsquo;existence d&amp;rsquo;une variable par exemple dans un if&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;\if :{?variable_name}&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Am√©lioration de la compl√©tion dans l&amp;rsquo;√©criture de requ√™tes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;En dehors de ces nouveaut√©s en terme d&amp;rsquo;utilisation, cette nouvelle version apporte aussi des am√©liorations de performance et d&amp;rsquo;utilisation de m√©moire.&lt;/p&gt;&#xA;&lt;p&gt;Et voil√†, nous avons fini notre petit tour rapide des nouveaut√©s de postgreSQL 11, mais ne vous inqui√©tez pas une version 12 est d√©j√† en pr√©paration pour le troisi√®me trimestre 2019.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-11/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-11" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Apr√®s seulement une release candidate (mais auparavant 4 version b√™ta), PostgreSQL 11 vient de sortir!!!! Et comme √† chaque nouvelle version son lot de nouveaut√©s que nous allons essayer de passer rapidement en revue. Am√©lioration de la parall√©lisation Quoi de... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Pimp My PostgreSQL</title>
    <updated>2018-01-26T11:07:23Z</updated>
    <id>tag:blog.atolcd.com,2018-01-26:/pimp-my-postgresql/</id>
    <content type="html">&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignright wp-image-2934&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pimp-my-postgresql.png&#34; alt=&#34;&#34; width=&#34;491&#34; height=&#34;290&#34; /&gt;Une question qui se pose souvent apr√®s l&amp;rsquo;installation d&amp;rsquo;une instance postgreSQL, c&amp;rsquo;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par d√©faut, ce qui ne va pas poser vraiment de probl√®me pour une utilisation l√©g√®re. Mais si on a une instance postgreSQL avec postGIS et des millions d&amp;rsquo;enregistrements, cela va rapidement se trouver probl√©matique si on laisse les valeurs par d√©faut&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;Pour les initi√©s qui installent r√©guli√®rement de nouvelles instances postgreSQL, se plonger dans les plus de 600 lignes du fichier de configuration par d√©faut ne les effraie pas. Mais on n&amp;rsquo;installe pas forc√©ment tous les jours un nouveau serveur avec des caract√©ristiques diff√©rentes. Il faut donc soit se replonger pour une centi√®me fois dans la documentation de postgres pour se rappeler √† notre bonne m√©moire les diff√©rents param√®tres et les valeurs √† adapter en fonction de la ram, disque, cpu&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;En plus de devoir se rappeler les &lt;strong&gt;param√®tres √† modifier,&lt;/strong&gt; il faut aussi conna√Ætre les &lt;strong&gt;r√®gles de calcul &lt;/strong&gt;pour les valeurs comme par exemple le ¬´¬†effective_cache_size¬†¬ª qui est pr√©conis√© √† 75% de la ram total du serveur si celui-ci est d√©di√© √† postgres.&lt;/p&gt;&#xA;&lt;p&gt;Le but de cet article n&amp;rsquo;est pas de voir ni de d√©tailler tous les param√®tres de configuration possibles et inimaginables, mais de voir cela comme un m√©mo pour les initi√©s ou de s‚Äôinterroger sur les &lt;strong&gt;param√®tres qui seraient potentiellement √† modifier en fonction du serveur&lt;/strong&gt; (et des applications qui l&amp;rsquo;utilisent) si l&amp;rsquo;on ne connait pas l&amp;rsquo;utilisation des param√®tres de ce fichier postgresql.conf.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela un petit outil a √©t√© con√ßu par Cybertec, qui permet de renseigner quelques caract√©ristiques et de voir √©voluer en cons√©quence le fichier postgresql.conf notamment en fonction de la ram du serveur, du nombre de cpu, de la taille de la base&amp;#8230; etc.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-2925&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png&#34; alt=&#34;&#34; width=&#34;1005&#34; height=&#34;993&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png 1005w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-300x296.png 300w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-768x759.png 768w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-945x934.png 945w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-600x593.png 600w&#34; sizes=&#34;auto, (max-width: 1005px) 100vw, 1005px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cela ne remplace pas une connaissance aguerrie de postgreSQL et de sa configuration mais √ßa permet de se faire une id√©e des param√®tres √† adapter en fonction de son serveur et de ses besoins.&lt;/p&gt;&#xA;&lt;p&gt;Cet outil est disponible en ligne √† cette adresse : &lt;a href=&#34;http://pgconfigurator.cybertec.at/&#34;&gt;http://pgconfigurator.cybertec.at/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/pimp-my-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=pimp-my-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Une question qui se pose souvent apr√®s l&amp;#8217;installation d&amp;#8217;une instance postgreSQL, c&amp;#8217;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par d√©faut, ce qui ne va pas poser vraiment de probl√®me pour une... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 10</title>
    <updated>2017-10-05T13:28:32Z</updated>
    <id>tag:blog.atolcd.com,2017-10-05:/sortie-de-postgresql-10/</id>
    <content type="html">&lt;p&gt;Aujourd&amp;rsquo;hui, c&amp;rsquo;est la sortie de &lt;strong&gt;PostgreSQL 10&lt;/strong&gt;!!!! Premi√®re r√©volution, la num√©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures √† 10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des donn√©es. Une op√©ration beaucoup plus lourde que la seule mise √† jour des ex√©cutables !&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2788&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg&#34; alt=&#34;&#34; width=&#34;558&#34; height=&#34;337&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg 558w, https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10-300x181.jpg 300w&#34; sizes=&#34;auto, (max-width: 558px) 100vw, 558px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Voici quelques d√©tails sur cette&lt;strong&gt; nouvelle version 10&lt;/strong&gt; et ce qu&amp;rsquo;elle apporte :&lt;/p&gt;&#xA;&lt;h2&gt;Performance et partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Le partitionnement de table est maintenant un attribut de la table :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table_name ( ... )&#xD;&#xA;[ PARTITION BY { RANGE | LIST } ( { column_name | ( expression ) }&#xD;&#xA;&#xD;&#xA;CREATE TABLE table_name&#xD;&#xA;PARTITION OF parent_table [ (&#xD;&#xA;) ] FOR VALUES partition_bound_spec&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;PostgreSQL 10 va plus loin dans la parall√©lisation avec le parall√©lisme des Index-Only Scan, Index Scan, Bitmap Heap Scan, Merge Join / Gather Merge, Subplan-Related Improvements&lt;/li&gt;&#xA;&lt;li&gt;Am√©lioration des performances pour les agr√©gats et jointures avec &lt;code&gt;postgres_fdw&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Am√©lioration des performances de l&amp;rsquo;analyseur de requ√™te&lt;/li&gt;&#xA;&lt;li&gt;Apparition des statistiques multi-colonnes&lt;/li&gt;&#xA;&lt;li&gt;Am√©lioration du plan d‚Äôex√©cution des requ√™tes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;R√©plication et scalabilit√©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;R√©plication logique : l√©g√®re et bas√©e sur les WAL, r√©pliquant les objets individuellement via les commandes PUBLICATION (primaire) et SUBSCRIPTION (secondaire)&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PUBLICATION financials FOR TABLE ONLY loans, ONLY fines;&lt;/pre&gt;&lt;br /&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE SUBSCRIPTION financials&#xD;&#xA;CONNECTION &#39;dbname=libdata user=postgres host=172.17.0.2&#39;&#xD;&#xA;PUBLICATION financials;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;QUORUM replication : avec ANY et FIRST pour synchronous_standby_names;&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;synchronous_standby_names = ANY 2(node1,node2,node3);&#xD;&#xA;synchronous_standby_names = FIRST 2(node1,node2);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Suppression automatique √† la fin de la session des slots de r√©plication temporaires&lt;/li&gt;&#xA;&lt;li&gt;Am√©lioration de libpq permettant des connexions a de multiples syst√®mes&lt;/li&gt;&#xA;&lt;li&gt;Am√©lioration des performances de la r√©plication physique&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Administration&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de la compression pour pg_receivewal&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;informations sur les Background processes et Wait Events dans pg_stat_activity&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions qui remontent √† l&amp;rsquo;utilisateur des informations sur le status de transaction. L&amp;rsquo;usage principal de ces fonctions est de d√©terminer les transactions commit√©es entre deux snapshots.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;txid_status(bigint)&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Fonctionnalit√©s SQL et d√©veloppeurs&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Gestion de colonne Identity qui vise √† remplacer l&amp;rsquo;utilisation du type serial et qui est conforme au standard SQL&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE test_new (&#xD;&#xA;    id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,&#xD;&#xA;    payload text&#xD;&#xA;);&lt;/pre&gt;&lt;p&gt;plus d&amp;rsquo;informations sur ce sujet &lt;a href=&#34;https://blog.2ndquadrant.com/postgresql-10-identity-columns/&#34;&gt;ici par exemple&lt;/a&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Possibilit√© de renommer la valeur d&amp;rsquo;une √©num√©ration&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TYPE langage AS ENUM (&#39;SQL&#39;, &#39;JAVA&#39;, &#39;HTML&#39;) ;&#xD;&#xA;ALTER TYPE langage RENAME VALUE &#39;HTML&#39; TO &#39;HTML5&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des triggers AFTER STATEMENT qui peuvent avoir acc√®s √† l‚Äôensemble des lignes modifi√©es, avant et apr√®s changement, √† travers une pseudo-variable de type table&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TRIGGER nom_trigger AFTER DELETE ON nom_table&#xD;&#xA;REFERENCING OLD TABLE AS OLD&#xD;&#xA;FOR EACH STATEMENT&#xD;&#xA;EXECUTE PROCEDURE nom_procedure();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la fonction xmltable qui produit une table bas√©e sur la valeur XML donn√©e.&lt;/li&gt;&#xA;&lt;li&gt;Supprimer des √©l√©ments d&amp;rsquo;un JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;SELECT &#39;{&#34;a&#34;:1 , &#34;b&#34;:2, &#34;c&#34;:3}&#39;::jsonb - &#39;{a,c}&#39;::text[] ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Il est possible de cr√©er des indexes full text sur une colonne JSON ou JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE INDEX bookdata_fts ON bookdata&#xD;&#xA;USING gin (( to_tsvector(&#39;english&#39;,bookdata) ));&#xD;&#xA;&#xD;&#xA;SELECT bookdata -&amp;gt; &#39;title&#39;&#xD;&#xA;FROM bookdata&#xD;&#xA;WHERE to_tsvector(&#39;english&#39;,bookdata) @@ to_tsquery(&#39;duke&#39;);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;S√©curit√©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Authentification SCRAM plus s√©curis√©e que md5&lt;/li&gt;&#xA;&lt;li&gt;Cr√©ation de nouveau r√¥le pour le monitoring √©vitant ainsi d&amp;rsquo;√™tre super utilisateur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;pg_read_all_settings : Lit toutes les variables de configuration, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_read_all_stats : Lit toutes les vues pg_stat_* et utilise plusieurs extensions relatives aux statistiques, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_stat_scan_tables : Ex√©cute des fonctions de monitoring pouvant prendre des verrous verrous ACCESS SHARE sur les tables, potentiellement pour une longue dur√©e.&#xD;&#xA;pg_monitor : Lit et ex√©cute plusieurs vues et fonctions de monitoring. Ce r√¥le est membre de pg_read_all_settings, pg_read_all_stats et pg_stat_scan_tables.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de politiques restrictive dans les politiques de s√©curit√© pour l&amp;rsquo;acc√®s aux lignes et plus seulement de politiques permissives&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE POLICY admin_local_only ON passwd AS RESTRICTIVE TO admin&#xD;&#xA;    USING (pg_catalog.inet_client_addr() IS NULL);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Autres fonctionnalit√©s&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;file_fdw peut maintenant utiliser les programmes&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE FOREIGN TABLE&#xD;&#xA;   test(a int, b text)&#xD;&#xA;   SERVER csv&#xD;&#xA;   OPTIONS (program &#39;gunzip -c /tmp/data.czv.gz&#39;);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;support des collations ICU&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un module amcheck permettant de v√©rifier coh√©rence / corruption d&amp;rsquo;un index B-Tree&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE EXTENSION amcheck ;&#xD;&#xA;   SELECT bt_index_check(&#39;idx1_check1&#39;) ;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Modifications entrainant une incompatibilit√© ascendante&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;‚Äúxlog‚Äù et ‚Äúclog‚Äù qui deviennent respectivement ‚Äúwal‚Äù et ‚Äúxact‚Äù.&lt;/li&gt;&#xA;&lt;li&gt;fin du support du protocole client/serveur 1.0 (clients datant d‚Äôavant la version 6.3)&lt;/li&gt;&#xA;&lt;li&gt;changement de valeurs par d√©faut pour pg_basebackup&lt;/li&gt;&#xA;&lt;li&gt;fin du support des TIMESTAMP avec floating point.&lt;/li&gt;&#xA;&lt;li&gt;Le module contrib/tsearch2 a √©t√© supprim√© qui permettait une comptabilit√© avec les fonction de recherche full text avant la version 8.3&lt;/li&gt;&#xA;&lt;li&gt;fin du support de la commande pg_dump pour les bases de donn√©es plus anciennes que la version 8.0&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Et voil√†, nous avons fini notre petit tour rapide des nouveaut√©s de postgreSQL 10 mais une version 11 est d√©j√† pr√©vue pour dans 12 mois !&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-10/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-10" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Aujourd&amp;#8217;hui, c&amp;#8217;est la sortie de PostgreSQL 10!!!! Premi√®re r√©volution, la num√©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures √† 10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Index &#34;Skip Scan&#34; avec PostgreSQL 18</title>
    <updated>2025-04-06T10:30:00Z</updated>
    <id>tag:pgphil.ovh,2025-04-06:/index_composite_18_01.php</id>
    <link href="https://pgphil.ovh/index_composite_18_01.php" rel="alternate"></link>
    <summary type="html">Mise √† jour de la page sur les index composites et les requ√™tes dont la clause de filtrage comprend des colonnes de l&#39;index mais pas la premi√®re colonne. PostgreSQL 18 est √† pr√©sent capable d&#39;effectuer des &#34;skip scan&#34;, de sauter la premi√®re colonne et de tirer parti bien plus efficacement de l&#39;index composite b-tree dans certains cas.</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Mesurer facilement la latence I/O avec PostgreSQL 16</title>
    <updated>2023-09-02T16:30:00Z</updated>
    <id>tag:pgphil.ovh,2023-09-02:/traqueur_16_01.php</id>
    <link href="http://pgphil.ovh/traqueur_16_01.php" rel="alternate"></link>
    <summary type="html">D√©monstration avec le traqueur d&#39;une nouvelle fonctionnalit√© PostgreSQL 16 facilitant le suivi des performances et le diagnostic des ralentissements</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Mettre √† jour PostgreSQL pour am√©liorer les performances</title>
    <updated>2023-05-21T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-05-21:/migration_performance_14_15_01.php</id>
    <link href="http://pgphil.ovh/migration_performance_14_15_01.php" rel="alternate"></link>
    <summary type="html">Pagination, ex aequo...obtenez vos r√©sultats tri√©s bien plus rapidement avec PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL inspire les autres SGBD ?</title>
    <updated>2023-04-12T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-04-12:/oracle23c_ou_oracle23p_comme_postgresql.php</id>
    <link href="http://pgphil.ovh/oracle23c_ou_oracle23p_comme_postgresql.php" rel="alternate"></link>
    <summary type="html">Oracle 23c ou 23p comme PostgreSQL ?</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>CYCLE</title>
    <updated>2022-12-03T15:00:00Z</updated>
    <id>tag:pgphil.ovh,2022-12-03:/nocycle_15_01.php</id>
    <link href="http://pgphil.ovh/nocycle_15_01.php" rel="alternate"></link>
    <summary type="html">Nouveaut√©s autour des requ√™tes hi√©rarchiques avec PostgreSQL 14 et versions sup√©rieures</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>MERGE</title>
    <updated>2022-03-29T17:30:00Z</updated>
    <id>tag:pgphil.ovh,2022-03-29:/upsert_15_devel_01.php</id>
    <link href="http://pgphil.ovh/upsert_15_devel_01.php" rel="alternate"></link>
    <summary type="html">Introduction de la commande MERGE par PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>On analyse la nouvelle collation de PostgreSQL 17</title>
    <updated>2024-06-07T11:40:12Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-06-07:/2024/06/07/pg17-utf8-collation.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/06/07/pg17-utf8-collation.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL 17 est sorti en version b√™ta le 23 mai dernier, et dans ce billet on&#xA;va d√©tailler une de ses nouveaut√©s: une collation interne g√©rant l‚ÄôUTF-8 avec des&#xA;comparaisons de texte en binaire.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les rapports de bugs de Postgres en 2023</title>
    <updated>2024-01-24T10:23:10Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-01-24:/2024/01/24/pgsql-bugs-annee-2023.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/01/24/pgsql-bugs-annee-2023.html" rel="alternate"></link>
    <summary type="html">Une revue quantitative des rapports de bugs de Postgres en 2023</summary>
  </entry>
  <entry>
    <title>Classification des caract√®res avec ICU</title>
    <updated>2023-06-11T14:32:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2023-06-11:/2023/06/11/caracteres-icu.html</id>
    <link href="https://blog-postgresql.verite.pro/2023/06/11/caracteres-icu.html" rel="alternate"></link>
    <summary type="html">Avec PostgreSQL 16 o√π ICU devient le fournisseur de collations par d√©faut, il y a quelques diff√©rences s√©mantiques √† anticiper dans la classification des caract√®res. Cet article en d√©taille quelques-unes.</summary>
  </entry>
  <entry>
    <title>Isolation Repeatable Read avec PostgreSQL versus MySQL</title>
    <updated>2020-02-10T17:50:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-02-10:/2020/02/10/isolation-postgresql-vs-mysql.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/02/10/isolation-postgresql-vs-mysql.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Les moteurs SQL permettent aux transactions concurrentes d‚Äô√™tre&#xA;isol√©es les unes des autres pour √©viter les interf√©rences.&#xA;Cette propri√©t√© d‚Äôisolation correspond √† la lettre I de l‚Äôacronyme&#xA;bien connu &lt;a href=&#34;https://fr.wikipedia.org/wiki/Propri%C3%A9t%C3%A9s_ACID&#34;&gt;‚ÄúACID‚Äù&lt;/a&gt;,&#xA;les autres propri√©t√©s √©tant Atomicit√©, Coh√©rence&#xA;(&lt;em&gt;Consistency&lt;/em&gt; en anglais) et Durabilit√©.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Recherche et remplacement multiple avec plperl</title>
    <updated>2020-01-22T09:05:14Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-01-22:/2020/01/22/multi-replace.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/01/22/multi-replace.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Remplacer une cha√Æne par une autre dans une cha√Æne plus large est simple&#xA;en SQL, avec la fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;replace&lt;/code&gt;:&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les collations non d√©terministes</title>
    <updated>2019-10-16T16:32:15Z</updated>
    <id>tag:blog-postgresql.verite.pro,2019-10-16:/2019/10/16/collations-non-deterministes.html</id>
    <link href="https://blog-postgresql.verite.pro/2019/10/16/collations-non-deterministes.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Depuis la version 12, les collations de PostgreSQL peuvent √™tre cr√©√©es&#xA;avec un param√®tre nomm√© &lt;strong&gt;deterministic&lt;/strong&gt;, qui peut √™tre vrai&#xA;ou faux, si bien que les collations  sont maintenant&#xA;soit &lt;strong&gt;d√©terministes&lt;/strong&gt; (ce qu‚Äôelles sont par d√©faut), soit&#xA;&lt;strong&gt;non d√©terministes&lt;/strong&gt;.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity</title>
    <updated>2020-03-08T05:33:26Z</updated>
    <id>tag:rjuju.github.io,2020-03-08:/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html</id>
    <content type="html">&lt;h3 id=&#34;nouvelle-colonne-leader_pid-dans-la-vue-pg_stat_activity&#34;&gt;Nouvelle colonne leader_pid dans la vue pg_stat_activity&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;√âtonnamment, depuis que les requ√™tes parall√®les ont √©t√© ajout√©es dans&#xA;PostgreSQL 9.6, il √©tait impossible de savoir √† quel processus client √©tait li√©&#xA;un worker parall√®le.  Ainsi, comme &lt;a href=&#34;https://twitter.com/g_lelarge/status/1209486212190343168&#34;&gt;Guillaume l‚Äôa fait&#xA;remarquer&lt;/a&gt;, it makes&#xA;il est assez difficile de construire des outils simples permettant&#xA;d‚Äô√©chantillonner les √©v√©nements d‚Äôattente li√©s √† tous les processus impliqu√©s&#xA;dans une requ√™te.  Une solution simple √† ce probl√®me est d‚Äôexporter&#xA;l‚Äôinformation de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;lock group leader&lt;/code&gt; disponible dans le processus client au&#xA;niveau SQL :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit b025f32e0b5d7668daec9bfa957edf3599f4baa8&#xA;Author: Michael Paquier &amp;lt;michael@paquier.xyz&amp;gt;&#xA;Date:   Thu Feb 6 09:18:06 2020 +0900&#xA;&#xA;Add leader_pid to pg_stat_activity&#xA;&#xA;This new field tracks the PID of the group leader used with parallel&#xA;query.  For parallel workers and the leader, the value is set to the&#xA;PID of the group leader.  So, for the group leader, the value is the&#xA;same as its own PID.  Note that this reflects what PGPROC stores in&#xA;shared memory, so as leader_pid is NULL if a backend has never been&#xA;involved in parallel query.  If the backend is using parallel query or&#xA;has used it at least once, the value is set until the backend exits.&#xA;&#xA;Author: Julien Rouhaud&#xA;Reviewed-by: Sergei Kornilov, Guillaume Lelarge, Michael Paquier, Tomas&#xA;Vondra&#xA;Discussion: https://postgr.es/m/CAOBaU_Yy5bt0vTPZ2_LUM6cUcGeqmYNoJ8-Rgto+c2+w3defYA@mail.gmail.com&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Avec cette modification, il est maintenant tr√®s simple de trouver tous les&#xA;processus impliqu√©s dans une requ√™te parall√®le.  Par exemple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;array_agg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_activity&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;GROUP&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;       &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-------------------+------------+---------------&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;mi&#34;&gt;31630&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32269&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32268&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Attention toutefois, comme indiqu√© dans le message de commit, si la colonne&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;leader_pid&lt;/code&gt; √† la m√™me valeur que la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pid&lt;/code&gt;, cela ne veut pas forc√©ment&#xA;dire que le processus client est actuellement en train d‚Äôeffectuer une requ√™te&#xA;parall√®le, car une fois que le champ est positionn√© il n‚Äôest jamais&#xA;r√©initialis√©.  De plus, pour √©viter tout surco√ªt, aucun verrou suppl√©mentaire&#xA;n‚Äôest maintenu lors de l‚Äôaffichage de ces donn√©es.  Cela veut dire que chaque&#xA;ligne est trait√©e ind√©pendamment.  Ainsi, bien que cela soit fort peu probable,&#xA;vous pouvez obtenir des donn√©es incoh√©rentes dans certaines circonstances,&#xA;comme par exemple un worker paral√®lle pointant vers un pid qui est d√©j√†&#xA;d√©connect√©.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html&#34;&gt;Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on March 08, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>pg¬†qualstats 2: Suggestion d&#39;index globale</title>
    <updated>2020-01-06T12:23:29Z</updated>
    <id>tag:rjuju.github.io,2020-01-06:/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html</id>
    <content type="html">&lt;p&gt;Parvenir √† une suggestion d‚Äôindex de qualit√© peut √™tre une t√¢che complexe.&#xA;Cela n√©cessite √† la fois une connaissance des requ√™tes applicatives et des&#xA;sp√©cificit√©s de la base de donn√©es.  Avec le temps de nombreux projets ont&#xA;essay√© de r√©soudre ce probl√®me, l‚Äôun d‚Äôentre eux √©tant &lt;a href=&#34;https://powa.readthedocs.io/&#34;&gt;PoWA version&#xA;3&lt;/a&gt;, avec l‚Äôaide de &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_qualstats.html&#34;&gt;pg_qualstats&#xA;extension&lt;/a&gt;.&#xA;Cet outil donne de plut√¥t bonnes suggestions d‚Äôindex, mais il est n√©cessaire&#xA;d‚Äôinstaller et configurer PoWA, alors que certains utilisateurs aimeraient&#xA;n‚Äôavoir que la suggestion d‚Äôindex globale.  Pour r√©pondre √† ce besoin de&#xA;simplicit√©, l‚Äôalgorithme utilis√© dans PoWA est maintenant disponible dans&#xA;pg_qualstats version 2, sans avoir besoin d‚Äôutiliser des composants&#xA;additionnels.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;EDIT: La fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_qualstats_index\_advisor()&lt;/code&gt; a √©t√© chang√©e pour retourner&#xA;du &lt;strong&gt;json&lt;/strong&gt; plut√¥t que du &lt;strong&gt;jsonb&lt;/strong&gt;, afin de conserver la compatibilit√© avec PostgreSQL&#xA;9.3.  Les requ√™tes d‚Äôexemples sont donc √©galement modifi√©es pour utiliser&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;json_array_elements()&lt;/code&gt; plut√¥t que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;jsonb_array_elements()&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;quest-ce-que-pg_qualstats&#34;&gt;Qu‚Äôest-ce que pg_qualstats&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une mani√®re simple d‚Äôexpliquer ce qu‚Äôest pg_qualstats serait de dire qu‚Äôil&#xA;s‚Äôagit d‚Äôune extension similaire √†&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/pgstatstatements.html&#34;&gt;pg_stat_statements&lt;/a&gt;&#xA;mais travaillant au niveaux des pr√©dicats.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette extension sauvegarde des statistiques utiles pour les clauses &lt;strong&gt;WHERE&lt;/strong&gt;&#xA;et &lt;strong&gt;JOIN&lt;/strong&gt; : √† quelle table et quelle colonne un pr√©dicat fait r√©f√©r√©nce, le&#xA;nombre de fois qu‚Äôun pr√©dicat a √©t√© utilis√©, le nombre d‚Äôex√©cutions de&#xA;l‚Äôop√©rateur sous-jacent, si le pr√©dicat provient d‚Äôun parcours d‚Äôindex ou non,&#xA;la s√©lectivit√©, la valeur des constantes et bien plus encore.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est possible de d√©duire beaucoup de choses depuis ces informations.  Par&#xA;exemple, si vous examinez les pr√©dicats qui contiennent des r√©f√©rences √† des&#xA;tables diff√©rentes, vous pouvez trouver quelles tables sont jointes ensembles,&#xA;et √† quel point les conditions de jointures sont s√©lectives.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;suggestion-globale-&#34;&gt;Suggestion Globale ?&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Comment je l‚Äôai mentionn√©, la suggestion d‚Äôindex globale ajout√©e dans&#xA;pg_qualstats 2 utilise la m√™me approche que celle de PoWA, ainsi cet article&#xA;peut servir √† d√©crire le fonctionnement des deux outils.  La seule diff√©rence&#xA;est que vous obtiendrez probablement une suggestion de meilleure qualit√© avec&#xA;PoWA, puisque plus de pr√©dicats seront disponibles, et que vous pourrez&#xA;√©galement choisir sur quel intervalle de temps vous souhaitez effectuer une&#xA;suggestion d‚Äôindex manquants.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La chose importante √† retenir ici est qu‚Äôil s‚Äôagit d‚Äôune suggestion effectu√©e&#xA;de mani√®re &lt;strong&gt;globale&lt;/strong&gt;, c‚Äôest-√†-dire en prenant en compte tous les pr√©dicats&#xA;int√©ressant en m√™me temps.  Cette approche est diff√©rente de toutes les autres&#xA;dont j‚Äôai connaissance, qui ne prennent en compte qu‚Äôune seule requ√™te √† la&#xA;fois.  Selon moi, une approche globale est meilleure, car il est possible de&#xA;r√©duire le nombre total d‚Äôindex, en maximisant l‚Äôefficacit√© des index&#xA;multi-colonnes.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;comment-marche-la-suggestion-globale&#34;&gt;Comment marche la suggestion globale&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;La premi√®re √©tape consiste √† r√©cup√©rer tous les pr√©dicats qui pourraient&#xA;b√©n√©ficier de nouveaux index.  C‚Äôest particuli√®rement facile √† obtenir avec&#xA;pg_qualstats.  En filtrant les pr√©dicats venant d‚Äôun parcours s√©quentiel,&#xA;ex√©cut√©s de nombreuses fois et qui filtrent de nombreuses lignes (√† la fois en&#xA;nombre et en pourcentage), vous obtenez une liste parfaite de pr√©dicats qui&#xA;auraient tr√®s probablement besoin d‚Äôun index (ou alors dans certains cas une&#xA;liste des requ√™tes mal √©crites).  Voyons regardons par exemple le cas d‚Äôune&#xA;applications qui utiliserait ces 4 pr√©dicats:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_1_quals.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_1_quals.png&#34; alt=&#34;Liste de tous les pr√©dicats&#xA;trouv√©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, il faut construire l‚Äôensemble entier des chemins de toutes les&#xA;pr√©dicats joints par un AND logique, qui contiennent d‚Äôautres pr√©dicats, qui&#xA;peuvent √™tre eux-meme √©galement joints par des AND logiques.  En utilisants les&#xA;m√™me 4 pr√©dicats vus pr√©c√©demments, nous obtenons ces chemins :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_2_graphs.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_2_graphs.png&#34; alt=&#34;Construction de tous les chemins de pr√©dicats&#xA;possibles&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois tous les chemins construits, il suffit d‚Äôobtenir le meilleur chemin&#xA;pour trouver le meilleur index √† sugg√©rer.  Le classement de ces chemins est&#xA;pour le moment fait en donnant un poids √† chaque n≈ìud de chaque chemin qui&#xA;correspond au nombre de pr√©dicats simple qu‚Äôil contient, et en additionnant le&#xA;poids pour chaque chemin.  C‚Äôest une approche tr√®s simple, et qui permet de&#xA;favoriser un nombre minimal d‚Äôindex qui optimisent le plus de requ√™tes&#xA;possible.  Avec nos exemple, nous obtenons :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_3_weighted.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_3_weighted.png&#34; alt=&#34;Ajout d&#39;un poids √† tous les chemins et choix du score le plus&#xA;haut&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien √©videmment, d‚Äôautres approches de classement pourraient √™tre utilis√©e pour&#xA;prendre en compte d‚Äôautres param√®tres, et potentiellement obtenir une meilleur&#xA;suggestion.  Par exemple, en prenant en compte √©galement le nombre d‚Äôex√©cution&#xA;ou la s√©lectivit√© des pr√©dicats.  Si le ratio de lecture/√©criture pour chaque&#xA;table est connu (ce qui est disponible avec l‚Äôextension&#xA;&lt;a href=&#34;https://github.com/powa-team/powa-archivist&#34;&gt;powa-archivist&lt;/a&gt;), il serait&#xA;√©galement possible d‚Äôadapter le classement pour limiter la suggestion d‚Äôindex&#xA;pour les tables qui ne sont acc√©d√©es presque exclusivement en √©criture.  Avec&#xA;cet algorithme, ces ajustements seraient relativement simples √† faire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois que le meilleur chemin est trouv√©, on peut g√©n√©rer l‚Äôordre de cr√©ation&#xA;de l‚Äôindex !  Comme l‚Äôordre des colonnes peut √™tre important, l‚Äôordre est&#xA;g√©n√©r√© en r√©cup√©rant les colonnes de chaque n≈ìud par poids croissant.  Avec&#xA;notre exemple, l‚Äôindex suivant est g√©n√©r√© :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Une fois que l‚Äôindex est trouv√©, on supprime simplement les pr√©dicats contenus&#xA;de la liste globale de pr√©dicats et on reprendre de z√©ro jusqu‚Äô√† ce qu‚Äôil n‚Äôy&#xA;ait plus de pr√©dicats.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;un-peu-plus-de-d√©tails-et-mise-en-garde&#34;&gt;Un peu plus de d√©tails et mise en garde&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien √©videmment, il s‚Äôagit ici d‚Äôune version simplifi√©e de l‚Äôalgorithme de&#xA;suggestion, car d‚Äôautres informations sont n√©cessaires.  Par exemple, la liste&#xA;des pr√©dicats est en r√©alit√© ajust√©e avec les &lt;a href=&#34;https://www.postgresql.org/docs/current/indexes-opclass.html&#34;&gt;classes d‚Äôop√©rateurs et m√©thode&#xA;d‚Äôacces&lt;/a&gt; en&#xA;fonction du type de la colonne et de sont op√©rateur, afin de s‚Äôassurer&#xA;d‚Äôobtenir des index valides.  Si plusieurs m√©thodes d‚Äôacc√®s aux index sont&#xA;trouv√©es pour un m√™me meilleur chemin, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;btree&lt;/code&gt; sera choisi en priorit√©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cela nous am√®ne √† un autre d√©tail : cette approche est principalement pens√©e&#xA;pour les index &lt;strong&gt;btree&lt;/strong&gt;, pour lesqules l‚Äôordre des colonnes est critiques.&#xA;D‚Äôautres m√©thodes d‚Äôacc√®s ne requi√®rent pas un ordre sp√©cifique pour les&#xA;colonnes, et pour ces m√©thodes d‚Äôacc√®s il est possible qu‚Äôune suggestion plus&#xA;optimale soit possible si l‚Äôordre des colonnes n‚Äô√©tait pas pris en compte.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un autre point important est que les classes d‚Äôop√©rateurs et m√©thodes d‚Äôacc√®s&#xA;ne sont pas g√©r√©s en dur mais r√©cup√©r√©s √† l‚Äôex√©cution en utilisant les&#xA;catalogues locaux.  Par cons√©quent, vous pouvez obtenir des r√©sultats&#xA;diff√©rents (et potentiellement meilleurs) si vous faites en sorte d‚Äôavoir&#xA;toutes les classes d‚Äôop√©rateur additionelles disponibles quand vous utilisez la&#xA;suggestion d‚Äôindex globale.  Cela pourrait √™tre les extensions &lt;strong&gt;btree_gist&lt;/strong&gt;&#xA;et &lt;strong&gt;btree_gist&lt;/strong&gt;, mais √©galement d‚Äôautres m√©thodes d‚Äôacc√®s aux index.  Il est&#xA;√©galement possible que certain types / op√©rateurs n‚Äôaient pas de m√©thode&#xA;d‚Äôacc√®s associ√©e dans les catalogues.  Dans ce cas, ces pr√©dicats sont&#xA;retourn√©es s√©par√©ment dans une liste de pr√©dicats non optimisables&#xA;automatiquement, et pour lequel une analyse manuelle est n√©cessaire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Enfin, comme pg_qualstats ne traite pas les pr√©dicats compos√©s d‚Äôexpressions,&#xA;l‚Äôoutil ne peut pas sugg√©rer d‚Äôindex sur des expressions, par exemple en cas&#xA;d‚Äôutilisateur de recherche plein texte.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;exemple-dutilisation&#34;&gt;Exemple d‚Äôutilisation&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une simple fonction est fournie, avec des param√®tres facultatifs, qui retourne&#xA;une valeur de type json :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_selectivity&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;forbidden_am&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;{}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Les noms de param√®tres sont parlants :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_filter&lt;/code&gt;: combien de lignes le pr√©dicat doit-il filtrer en moyenne pour&#xA;√™tre pris en compte par la suggestion globale, par d√©faut &lt;strong&gt;1000&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_selectivity&lt;/code&gt;: quelle doit √™tre la s√©lectivit√© moyenne d‚Äôun pr√©dicat&#xA;pour qu‚Äôil soit pris en compte par la suggestion globale, par d√©faut&#xA;&lt;strong&gt;30%&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;forbidden_am&lt;/code&gt;: liste des m√©thodes d‚Äôacc√®s aux index √† ignorer.  Aucune par&#xA;d√©faut, bien que pour les version 9.6 et inf√©rieures &lt;strong&gt;les index hash sont&#xA;ignor√© en interne&lt;/strong&gt;, puisque ceux-ci ne sont sur que depuis la version 10.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple simple, tir√©s des tests de non r√©gression de pg_qualstats :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;a&#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;line &#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ILIKE&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;moh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Et voici ce que la fonction retourne :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;indexes&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;                               &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------------------------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (id1)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (val, id1, id2, id3)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.pgqs USING btree (id)&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;unoptimised&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;        &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;adv.val ~~* ?&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/&#34;&gt;version 2 de pg_qualstats&lt;/a&gt;&#xA;n‚Äôest pas encore disponible en version stable, mais n‚Äôh√©sitez pas √† la tester&#xA;et &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/issues&#34;&gt;rapporter tout probl√®me que vous pourriez&#xA;rencontrer&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html&#34;&gt;pg¬†qualstats 2: Suggestion d&#39;index globale&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on January 06, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: Nouveau daemon powa-collector</title>
    <updated>2019-12-10T18:54:17Z</updated>
    <id>tag:rjuju.github.io,2019-12-10:/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie d‚Äôune s√©rie d‚Äôarticle sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et d√©crit le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-daemon-powa-collector&#34;&gt;Nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ce daemon remplace le pr√©c√©dent &lt;em&gt;background worker&lt;/em&gt; lorsque le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;mode&#xA;remote&lt;/a&gt; est utilis√©.&#xA;Il s‚Äôagit d‚Äôun simple daemon √©crit en python, qui s‚Äôoccupera de toutes les&#xA;√©tapes n√©cessaires pour effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;.  Il est &lt;a href=&#34;https://pypi.org/project/powa-collector/&#34;&gt;disponible&#xA;sur pypi&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme je l‚Äôai expliqu√© dans mon &lt;a href=&#34;/postgresql/2019/05/17/powa-4-with-remote-mode-beta-is-available.html&#34;&gt;pr√©c√©dent article introduistant PoWA 4&lt;/a&gt;, ce&#xA;daemon est n√©cessaire  pour la configuration d‚Äôun mode remote, en gardant cette&#xA;architecture √† l‚Äôesprit :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture de PoWA 4 en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Sa configuration est tr√®s simple.  Il vous suffit tout simplement de renommer&#xA;le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa-collector.conf.sample&lt;/code&gt; fourni, et d‚Äôadapter &lt;a href=&#34;https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING&#34;&gt;l‚ÄôURI de&#xA;connexion&lt;/a&gt;&#xA;pour d√©crire comment se connecter sur votre &lt;em&gt;serveur repository&lt;/em&gt; d√©di√©, et&#xA;c‚Äôest fini.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une configuration typique devrait ressembler √† :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;{&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;repository&#34;&lt;/span&gt;: {&#xA;        &lt;span class=&#34;s2&#34;&gt;&#34;dsn&#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&#34;postgresql://powa_user@server_dns:5432/powa&#34;&lt;/span&gt;,&#xA;    },&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;debug&#34;&lt;/span&gt;: &lt;span class=&#34;n&#34;&gt;true&lt;/span&gt;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La liste des &lt;em&gt;serveur distants&lt;/em&gt;, leur configuration ainsi que tout le reste qui&#xA;est n√©cessaire pour le bon fonctionnement sera automatiquement r√©cup√©r√© depuis&#xA;le &lt;em&gt;serveur repository&lt;/em&gt; que vous ave d√©j√† configur√©.  Une fois d√©marr√©, il&#xA;d√©marrera un thread d√©di√© par &lt;em&gt;serveur distant&lt;/em&gt; d√©clar√©, et maintiendra une&#xA;&lt;strong&gt;connexion persistente&lt;/strong&gt; sur ce &lt;em&gt;serveur distant&lt;/em&gt;.  Chaque thread effectuera&#xA;un &lt;em&gt;snapshot distant&lt;/em&gt;, exportant les donn√©es sur le &lt;em&gt;serveur repository&lt;/em&gt; en&#xA;utilisant les nouvelles &lt;em&gt;fonctions sources&lt;/em&gt;.  Chaque thread ouvrira et fermera&#xA;une connexion sur le &lt;em&gt;serveur repository&lt;/em&gt; lors de l‚Äôex√©cution du &lt;em&gt;snapshot&#xA;distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien √©videmment, ce daemon a besoin de pouvoir se connecter sur tous les&#xA;&lt;em&gt;serveurs distants&lt;/em&gt; d√©clar√©s ainsi que le &lt;em&gt;serveur repository&lt;/em&gt;.  La table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;, qui stocke la liste des &lt;em&gt;serveurs distants&lt;/em&gt;, a un champ pour&#xA;stocker les nom d‚Äôutilisateur et mot de passe pour se connecter aux &lt;em&gt;serveur&#xA;distants&lt;/em&gt;.  Stocker un mot de passe en clair dans cette table est une h√©r√©sie,&#xA;si l‚Äôon consid√®re l‚Äôaspect s√©curit√©.  Ainsi, comme indiqu√© dans la&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section s√©curit√© de&#xA;PoWA&lt;/a&gt;,&#xA;vous pouve stocker un mot de passe NULL et &lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;utiliser √† la place n‚Äôimporte&#xA;laquelle des autres m√©thodes d‚Äôauthentification support√©es par la&#xA;libpq&lt;/a&gt; (fichier&#xA;.pgpass, certificat‚Ä¶).  C‚Äôest tr√®s fortement recommand√© pour toute&#xA;installation s√©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La connexion persistente sur le &lt;em&gt;serveur repository&lt;/em&gt; est utilis√©e pour&#xA;superviser la daemon :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;pour v√©rifier  que le daemon est bien d√©marr√©&lt;/li&gt;&#xA;  &lt;li&gt;pour communiquer au travers de l‚ÄôUI en utilisant un &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/protocol.html&#34;&gt;protocole simple&lt;/a&gt;&#xA;afin d‚Äôeffectuer des actions diverses (recharger la configuration, v√©rifier&#xA;le status d‚Äôun thread d√©di√© √† un &lt;em&gt;serveur distant&lt;/em&gt;‚Ä¶)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Il est √† noter que vous pouvez √©galement demander au daemon de recharger sa&#xA;configuration en envoyant un SIGHUP au processus du daemon.  Un rechargement&#xA;est n√©cessaire pour toute modification effectu√©e sur la liste des serveurs&#xA;distants (ajout ou suppression d‚Äôun &lt;em&gt;serveur distant&lt;/em&gt;, ou mise √† jour d‚Äôun&#xA;existant).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez √©galement noter que, par choix,&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&lt;/a&gt;&#xA;n‚Äôeffectuera pas de &lt;em&gt;snapshot local&lt;/em&gt;.  Si vous voulez utiliser PoWA pour le&#xA;&lt;em&gt;serveur repository&lt;/em&gt;, il vous faudra activer le &lt;em&gt;background worker&lt;/em&gt; original.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouvelle-page-de-configuration&#34;&gt;Nouvelle page de configuration&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;La page de configuration est maintenant modifi√©e pour donner toutes les&#xA;informations n√©cessaires sur le status du background worker, le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&#xA;daemon&lt;/a&gt;&#xA;(incluant tous ses threads d√©di√©s) ainsi que la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;d√©clar√©s.  Voici un exemple de cette nouvelle page racine de configuration :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_configuration_page.png&#34;&gt;&lt;img src=&#34;/images/powa_4_configuration_page.png&#34; alt=&#34;Nouvelle page de&#xA;configuration&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;est utilis√©, le status de chaque serveur distant sera r√©cup√©r√© en utilisant le&#xA;protocole de communication.  Si le collecteur rencontre des erreurs (lors de la&#xA;connexion √† un &lt;em&gt;serveur distant&lt;/em&gt;, durant un &lt;em&gt;snapshot&lt;/em&gt; par exemple), celles-ci&#xA;seront √©galement affich√©es ici.  √Ä noter √©galement que ces erreurs seront&#xA;√©galement affich√©es en haut de chaque page de toutes les pages de l‚ÄôUI, afin&#xA;d‚Äô√™tre s√ªr de ne pas les rater.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;De plus, la section configuration a maintenant une hi√©rarchie, et vous pourrez&#xA;voir la liste des extensions ainsi que la configuration actuelle de PostgreSQL&#xA;pour le serveur &lt;strong&gt;local&lt;/strong&gt; ou &lt;strong&gt;distant&lt;/strong&gt; en cliquant sur le serveur de votre&#xA;choix!&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y a √©galement un nouveau bouton &lt;strong&gt;Reload collector&lt;/strong&gt; sur le bandeau&#xA;d‚Äôen-t√™te qui, comme on pourrait s‚Äôy attendre, demandera au collecteur de&#xA;recharger sa configuration.  Cela peut √™tre utile si vous avez d√©clar√©s de&#xA;nouveaux serveurs mais n‚Äôave pas d‚Äôacc√®s au serveur sur lequel le collecteur&#xA;s‚Äôex√©cute.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette article est le dernier de la s√©urie concernant la nouvelle version de&#xA;PoWA.  Il est toujours en beta, n‚Äôh√©sitez donc pas √† le tester, &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;rapporter&#xA;tout bug rencontr√©&lt;/a&gt;&#xA;ou donner tout autre retour!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html&#34;&gt;PoWA 4: Nouveau daemon powa-collector&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on December 10, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: nouveaut√©s dans powa-archivist !</title>
    <updated>2019-06-05T14:26:17Z</updated>
    <id>tag:rjuju.github.io,2019-06-05:/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie d‚Äôune s√©rie d‚Äôarticle sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et d√©crit les changements pr√©sents dans&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/index.html&#34;&gt;powa-archivist&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus d‚Äôinformation sur cette version 4, vous pouvez consulter &lt;a href=&#34;/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;l‚Äôarticle&#xA;de pr√©sentation g√©n√©ral&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;aper√ßu-rapide&#34;&gt;Aper√ßu rapide&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Tout d‚Äôabord, il faut savoir qu‚Äôil n‚Äôy a pas d‚Äôupgrade possible depuis la v3&#xA;vers la v4, il est donc n√©cessaire d‚Äôeffectuer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DROP EXTENSION powa&lt;/code&gt; si vous&#xA;utilisiez d√©j√† PoWA sur vos serveurs.  Cela est du au fait que la v4 apporte&#xA;&lt;strong&gt;de tr√®s nombreux&lt;/strong&gt; changements dans la partie SQL de l‚Äôextension, ce qui en&#xA;fait le changement le plus significatif dans la suite PoWA pour cette nouvelle&#xA;version.  Au moment o√π j‚Äô√©cris cet article, la quantit√© de changements apport√©s&#xA;dans cette extension est :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt; CHANGELOG.md       |   14 +&#xA; powa--4.0.0dev.sql | 2075 +++++++++++++++++++++-------&#xA; powa.c             |   44 +-&#xA; 3 files changed, 1629 insertions(+), 504 deletions(-)&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;L‚Äôabsence d‚Äôupgrade ne devrait pas √™tre un probl√®me en pratique.  PoWA est un&#xA;outil pour analyser les performances, il est fait pour avoir des donn√©es avec&#xA;une grande pr√©cision mais un historique tr√®s limit√©.  Si vous cherchez une&#xA;solution de supervision g√©n√©raliste pour conserver des mois de donn√©es, PoWA&#xA;n‚Äôest d√©finitivement pas l‚Äôoutil qu‚Äôil vous faut.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;configurer-la-liste-des-serveurs-distants&#34;&gt;Configurer la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;En ce qui concerne les changements √† proprement parler, le premier petit&#xA;changement est que le &lt;a href=&#34;https://www.postgresql.org/docs/current/bgworker.html&#34;&gt;background&#xA;worker&lt;/a&gt; n‚Äôest plus&#xA;n√©cessaire pour le fonctionnement de powa-archivist, car il n‚Äôest pas utilis√©&#xA;pour le mode distant.  Cela signifie qu‚Äôun red√©marrage de PostgreSQL n‚Äôest plus&#xA;n√©cessaire pour installer PoWA.  Bien √©videmment, un red√©marrage est toujours&#xA;n√©cessaire si vous souhaitez utiliser le mode local, en utilisant le background&#xA;worker, or si vous voulez installer des extensions additionelles qui&#xA;n√©cessitent elles-m√™me un red√©marrage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, comme PoWA requiert un peu de configuration (fr√©quence des snapshot,&#xA;r√©tention des donn√©es et ainsi de suite), certaines nouvelles tables sont&#xA;ajouter pour permettre de configurer tout √ßa.  La nouvelle table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;&#xA;stocke la configuration de toutes les instances distantes dont les donn√©es&#xA;doivent √™tre stock√©es sur cette instance.  Cette &lt;em&gt;instance PoWA locale&lt;/em&gt; est&#xA;appel√©e un &lt;strong&gt;serveur repository&lt;/strong&gt; (qui devrait typiquement √™tre d√©di√©e √†&#xA;stocker des donn√©es PoWA), en opposition aux &lt;strong&gt;instances distantes&lt;/strong&gt; qui sont&#xA;les instances que vous voulez monitorer.  Le contenu de cette table est tout ce&#xA;qu‚Äôil y a de plus simple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_servers&lt;/span&gt;&#xA;                              &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_servers&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                 &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------+----------+-----------+----------+------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;            &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nextval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;powa_servers_id_seq&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regclass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;hostname&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;alias&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;dbname&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;frequency&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;powa_coalesce&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;retention&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;1 day&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Si vous avez d√©j√† utilis√© PoWA, vous devriez reconna√Ætre la plupart des options&#xA;de configuration qui sont maintenant stock√©es ici.  Les nouvelles options sont&#xA;utilis√©es pour d√©crire comment se connecter aux &lt;em&gt;instances distances&lt;/em&gt;, et&#xA;peuvent fournir un alias √† afficher sur l‚ÄôUI.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous avez √©galement probablement remarqu√© une colonne &lt;strong&gt;password&lt;/strong&gt;.  Stocker un&#xA;mot de passe en clair dans cette table est une h√©r√©sie pour n‚Äôimporte qui&#xA;d√©sirant un minimum de s√©curit√©.  Ainsi, comme mentionn√© dans la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section&#xA;s√©curit√© de la documentation de PoWA&#xA;&lt;/a&gt;,&#xA;vous pouvez stocker NULL pour le champ password et √† la place utiliser&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;n‚Äôimporte laquelle des autres m√©thodes d‚Äôauthentification support√©e par la&#xA;libpq&lt;/a&gt;&#xA;(fichier .pgpass, certificat‚Ä¶).  Une authentification plus s√©curis√©e est&#xA;chaudement recommand√©e pour toute installation s√©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une autre table, la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_snapshot_metas&lt;/code&gt;, est √©galement ajout√©e pour&#xA;stocker quelques m√©tadonn√©es concernant les informations de snapshot pour&#xA;chaque &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;                                   &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_snapshot_metas&#34;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;--------------+--------------------------+-----------+----------+---------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;                  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;coalesce_seq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;snapts&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;aggts&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;purgets&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;errors&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Il s‚Äôagit tout simplement d‚Äôun compteur pour compter le nombre de snapshots&#xA;effectu√©s, un timestamp pour chaque type d‚Äô√©v√©nement survenu (snapshot,&#xA;aggr√©gation et purge) et un tableau de cha√Æne de caract√®res pour stocker toute&#xA;erreur survenant durant le snapshot, afin que l‚ÄôUI pour l‚Äôafficher.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;api-sql-pour-configurer-les-serveurs-distants&#34;&gt;API SQL pour configurer les &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien que ces tables soient tr√®s simples, une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html#configure-powa-and-stats-extensions-on-each-remote-server&#34;&gt;API SQL basique est disponible&#xA;pour d√©clarer de nouveaux serveurs et les&#xA;configurer&lt;/a&gt;.&#xA;6 fonctions de bases sont disponibles :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_register_server()&lt;/code&gt;, pour d√©clarer un nouveau &lt;em&gt;servuer distant&lt;/em&gt;, ainsi&#xA;que la liste des extensions qui y sont disponibles&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_configure_server()&lt;/code&gt; pour mettre √† jour un des param√®tres pour le&#xA;&lt;em&gt;serveur distant&lt;/em&gt; sp√©cifi√© (en utilisant un param√®tre JSON, o√π la cl√© est&#xA;le nom du param√®tre √† changer et la valeur la nouvelle valeur √† utiliser)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_server()&lt;/code&gt; pour d√©sactiver les snapshots pour le &lt;em&gt;serveur&#xA;distant&lt;/em&gt; sp√©cifiqu√© (ce qui concr√®tement positionnera le param√®tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;frequency&lt;/code&gt; √† &lt;strong&gt;-1&lt;/strong&gt;)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_delete_and_purge_server()&lt;/code&gt; pour supprimer le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;sp√©cifi√© de la liste des serveurs et supprimer toutes les donn√©es associ√©es&#xA;aux snapshots&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_activate_extension()&lt;/code&gt;, pour d√©clarer qu‚Äôune nouvelle extension est&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; sp√©cifi√©&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_extension()&lt;/code&gt;, pour sp√©cifier qu‚Äôune extension n‚Äôest plus&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; sp√©cifi√©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Toute action plus compliqu√©e que √ßa devra √™tre effectu√©e en utilisant des&#xA;requ√™tes SQL.  Heureusement, il ne devrait pas y avoir beaucoup d‚Äôautres&#xA;besoins, et les tables sont vraiment tr√®s simple donc cela ne devrait pas poser&#xA;de soucis.  &lt;a href=&#34;https://github.com/powa-team/powa-archivist/issues&#34;&gt;N‚Äôh√©sitez cependant pas √† demander de nouvelles&#xA;fonctions&lt;/a&gt; si vous aviez&#xA;d‚Äôautres besoins.  Veuillez √©galement noter que l‚ÄôUI ne vous permet pas&#xA;d‚Äôappeler ces fonctions, puisque celle-ci est pour le moment &lt;strong&gt;enti√®rement en&#xA;lecture seule&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;effectuer-des-snapshots-distants&#34;&gt;Effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Puisque les m√©triques sont maintenant stock√©es sur une instance PostgreSQL&#xA;diff√©rente, nous avons √©norm√©ment chang√© la fa√ßon dont les &lt;em&gt;snapshots&lt;/em&gt;&#xA;(r√©cup√©rer les donn√©es fournies par une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extensions&#xA;statistique&lt;/a&gt;&#xA;et les stock√©es dans le catalogue PoWA &lt;a href=&#34;/postgresqlfr/2019/04/06/minimiser-le-surcout-de-stockage-par-ligne.html&#34;&gt;de mani√®re √† optimiser le stockage&lt;/a&gt;) sont&#xA;effectu√©s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La liste de toutes les extensions statistiques, ou &lt;em&gt;sources de donn√©es&lt;/em&gt;, qui&#xA;sont disponibles sur un &lt;strong&gt;serveur&lt;/strong&gt; (soit &lt;em&gt;distant&lt;/em&gt; soit &lt;em&gt;local&lt;/em&gt;) et pour&#xA;lesquelles un &lt;em&gt;snapshot&lt;/em&gt; devrait √™tre effectu√© est stock√©e dans une table&#xA;appel√©e &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_functions&lt;/code&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;               &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_functions&#34;&lt;/span&gt;&#xA;     &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;----------------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;operation&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;query_source&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;added_manually&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;enabled&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;priority&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Un nouveau champ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;query_source&lt;/code&gt; a √©t√© rajout√©.  Celui-ci fournit le nom de la&#xA;&lt;em&gt;fonction source&lt;/em&gt;, n√©cessaire pour la compatibilit√© d‚Äôune &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extension&#xA;statistique&lt;/a&gt;&#xA;avec les snapshots distants.  Cette fonction est utilis√©e pour exporter les&#xA;compteurs fournis par cette extension sur un serveur diff√©rent, dans une &lt;em&gt;table&#xA;transitoire&lt;/em&gt; d√©di√©e.  La fonction de &lt;em&gt;snapshot&lt;/em&gt; effectuera alors le &lt;em&gt;snapshot&lt;/em&gt;&#xA;en utilisant automatiquement ces donn√©es export√©es plut√¥t que celles fournies&#xA;par l‚Äôextension statististique locale quand le mode distant est utilis√©.  Il&#xA;est √† noter que l‚Äôexport de ces compteurs ainsi que le snapshot distant est&#xA;effectu√© automatiquement par le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;que je pr√©senterai dans un autre article.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple montant comment PoWA effectue un &lt;em&gt;snapshot distant&lt;/em&gt; d‚Äôune&#xA;liste de base donn√©es.  Comme vous allez le voir, c‚Äôest tr√®s simple ce qui&#xA;signifie qu‚Äôil est √©galement tr√®s simple d‚Äôajouter cette m√™me compatibilit√©&#xA;pour une nouvelle extension statistique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;table transitoire&lt;/em&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;   &lt;span class=&#34;n&#34;&gt;Unlogged&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_databases_src_tmp&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Pour de meilleurs performances, toutes les &lt;em&gt;tables transitoires&lt;/em&gt; sont &lt;strong&gt;non&#xA;journalis√©es (unlogged)&lt;/strong&gt;, puisque leur contenu n‚Äôest n√©cessaire que durant un&#xA;&lt;em&gt;snapshot&lt;/em&gt; et sont supprim√©es juste apr√®s.  Dans cet examlple, la &lt;em&gt;table&#xA;transitoire&lt;/em&gt; ne stocke que l‚Äôidentifiant du serveur distant correspondant √† ces&#xA;donn√©es, l‚Äôoid ainsi que le nom de chacune des bases de donn√©es pr√©sentes sur&#xA;le &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Et la &lt;em&gt;fonction source&lt;/em&gt; :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powa_databases_src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SETOF&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_database&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;ELSE&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_databases_src_tmp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Cette fonction retourne simplement le contenu de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; si les donn√©es&#xA;locales sont demand√©es (l‚Äôidentifiant de serveur &lt;strong&gt;0&lt;/strong&gt; est toujours le serveur&#xA;local), ou alors le contenu de la &lt;em&gt;table transitoire&lt;/em&gt; pour le serveur distant&#xA;sp√©cifi√©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;fonction de snapshot&lt;/em&gt; peut alors facilement effectuer n‚Äôimporte quel&#xA;traitement avec ces donn√©es pour le &lt;em&gt;serveur distant&lt;/em&gt; voulu.  Dans le cas de la&#xA;fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_databases_snapshot()&lt;/code&gt;, il s‚Äôagit simplement de synchroniser la&#xA;liste des bases de donn√©es, et de stocker le timestamp de suppression si une&#xA;base de donn√©es qui existait pr√©c√©demment n‚Äôest plus list√©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus de d√©tails, vous pouvez consulter la documentation concernant&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/development.html&#34;&gt;l‚Äôajout d‚Äôune source de donn√©es dans&#xA;PoWA&lt;/a&gt;,&#xA;qui a √©t√© mise √† jour pour les sp√©cificit√©s de la version 4.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html&#34;&gt;PoWA 4: nouveaut√©s dans powa-archivist !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on June 05, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4 apporte un mode remote, disponible en beta !</title>
    <updated>2019-05-17T11:04:17Z</updated>
    <id>tag:rjuju.github.io,2019-05-17:/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html</id>
    <content type="html">&lt;p&gt;&lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;PoWA 4&lt;/a&gt; est disponible en beta.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-mode-remote-&#34;&gt;Nouveau mode remote !&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau mode remote&lt;/a&gt;&#xA;est la plus grosse fonctionnalit√© ajout√©e dans PoWA 4, bien qu‚Äôil y ait eu&#xA;d‚Äôautres am√©liorations.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Je vais d√©crire ici ce que ce nouveau mode implique ainsi que ce qui a chang√©&#xA;sur l‚Äô&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;UI&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si de plus amples d√©tails sur le reste des changements apport√©s dans PoWA 4&#xA;vous int√©resse, je publierai bient√¥t d‚Äôautres articles sur le sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour les plus press√©s, n‚Äôh√©sitez pas √† aller directement sur la &lt;a href=&#34;https://dev-powa.anayrat.info/&#34;&gt;d√©mo v4 de&#xA;PoWA&lt;/a&gt;, tr√®s gentiment h√©berg√©e par &lt;a href=&#34;http://blog.anayrat.info/&#34;&gt;Adrien&#xA;Nayrat&lt;/a&gt;.  Aucun authentification n‚Äôest requise,&#xA;cliquez simplement sur ‚ÄúLogin‚Äù.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;pourquoi-un-mode-remote-est-il-important&#34;&gt;Pourquoi un mode remote est-il important&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette fonctionnalit√© a probablement √©t√© la plus fr√©quemment demand√©e depuis que&#xA;PoWA a √©t√© publi√©, en 2014.  Et c‚Äôest pour de bonnes raisons, car un mode local&#xA;a quelques inconv√©nients.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Tout d‚Äôabord, voyons comment se pr√©sentait l‚Äôarchitecture avec les versions 3&#xA;et ant√©rieures.  Imaginons une instance contenant 2 bases de donn√©es (db1 et&#xA;db2), ainsi qu‚Äô&lt;strong&gt;une base de donn√©es d√©di√©e √† PoWA&lt;/strong&gt;.  Cette base de donn√©es&#xA;d√©di√©e contient √† la fois les &lt;em&gt;extensions statistiques&lt;/em&gt; n√©cessaires pour&#xA;r√©cup√©rer compteurs de performances actuels ainsi que pour &lt;strong&gt;les stocker&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_local.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_local.svg&#34; alt=&#34;Architecture en mode local&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est d√©marr√© par PoWA, qui est responsable d‚Äôeffectuer des &lt;em&gt;snapshots&lt;/em&gt; et de les&#xA;stocker dans la base powa d√©di√©e √† intervalle r√©guliers.  Ensuite, en utilisant&#xA;powa-web, vous pouvez consulter l‚Äôactivit√© de n‚Äôimporte laquelle des bases de&#xA;donn√©es &lt;strong&gt;locales&lt;/strong&gt; en effectuant des requ√™tes sur les donn√©es stock√©es dans la&#xA;base d√©di√©, et potentiellement en se connectant sur l‚Äôune des autres bases de&#xA;donn√©es locales lorsque les donn√©es compl√®tes sont n√©cessaires, par exemple&#xA;lorsque l‚Äôoutil de suggestion d‚Äôindex est utilis√©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec la version 4, l‚Äôarchitecture avec une configuration distante change de&#xA;mani√®re significative:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous pouvez voir qu‚Äôune base de donn√©e powa d√©di√©e est toujours n√©cessaire,&#xA;mais &lt;strong&gt;uniquement pour les extensions statistiques&lt;/strong&gt;.  Les donn√©es sont&#xA;maintenant stock√©es sur une instance diff√©rente.  Ensuite, le &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est remplac√© par un &lt;strong&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;nouveau daemon&#xA;collecteur&lt;/a&gt;&lt;/strong&gt;,&#xA;qui lit les m√©triques de performance depuis les &lt;em&gt;serveurs distants&lt;/em&gt;, et les&#xA;stocke sur le &lt;em&gt;serveur repository&lt;/em&gt; d√©di√©.  Powa-web pourra pr√©senter les&#xA;donn√©es en se connectant sur le &lt;em&gt;serveur repository&lt;/em&gt;, ainsi que sur les&#xA;&lt;strong&gt;serveurs distants&lt;/strong&gt; lorsque des donn√©es compl√®tes sont n√©cessaires.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En r√©sum√©, avec le nouveau mode distant ajout√© dans cette version 4&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;un red√©marrage de PostgreSQL n‚Äôest plus n√©cessaire pour installer&#xA;powa-archivist&lt;/li&gt;&#xA;  &lt;li&gt;il n‚Äôy a plus de surco√ªt du au fait de stocker et requ√™ter les donn√©es sur&#xA;le m√™me serveur PostgreSQL que vos serveurs de productions (il y a toujours&#xA;certaines partie de l‚ÄôUI qui n√©cessitent d‚Äôeffectuer des requ√™tes sur le&#xA;serveur d‚Äôorigine, par exemple pour montrer des plans avec EXPLAIN, mais le&#xA;surco√ªt est n√©gligeable)&lt;/li&gt;&#xA;  &lt;li&gt;il est maintenant possible d‚Äôutiliser PoWA sur un &lt;strong&gt;serveur en&#xA;hot-standby&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;L‚ÄôUI vous accueillera donc maintenant avec une page initiale afin de choisir&#xA;lequel des serveurs stock√©s sur la base de donn√©es cible vous voulez&#xA;travailler :&#xA;&lt;a href=&#34;/images/powa_4_all_servers.png&#34;&gt;&lt;img src=&#34;/images/powa_4_all_servers.png&#34; alt=&#34;Choix des serveurs&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La principale raison pour laquelle il a fallu tellement de temps pour apporter&#xA;ce mode distant est parce que cela apporte beaucoup de complexit√©, n√©cessitant&#xA;une r√©√©criture majeure de PoWA.  Nous voulions √©galement ajouter d‚Äôabord&#xA;d‚Äôautres fonctionnalit√©s, comme la &lt;strong&gt;suggestion globale d‚Äôindex&lt;/strong&gt;, avec une&#xA;&lt;strong&gt;validation gr√¢ce √† &lt;a href=&#34;http://hypopg.readthedocs.io/&#34;&gt;hypopg&lt;/a&gt;&lt;/strong&gt; introduit avec&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/releases/v3.0.0.html&#34;&gt;PoWA 3&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;changements-dans-powa-web&#34;&gt;Changements dans &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;powa-web&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;L‚Äô&lt;em&gt;interface graphique&lt;/em&gt; est le composant qui a le plus de changements visibles&#xA;dans cette version 4.  Voici les plus changements les plus importants.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;compatibilit√©-avec-le-mode-distant&#34;&gt;Compatibilit√© avec le mode distant&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Le changement le plus important est bien √©videmment le support pour le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau&#xA;mode remote&lt;/a&gt;.  En&#xA;cons√©quence, la premi√®re page affich√©e est maintenant une page de &lt;strong&gt;s√©lection&#xA;de serveur&lt;/strong&gt;, affichant tous les &lt;em&gt;serveurs distants&lt;/em&gt; enregistr√©s.  Apr√®s avoir&#xA;choisi le &lt;em&gt;serveur distant&lt;/em&gt; voulu (ou le &lt;em&gt;serveur local&lt;/em&gt; si vous n‚Äôutilisez pas&#xA;le mode distant), toutes les autres pages seront similaires √† celles&#xA;disponibles jusqu‚Äô√† la version 3, mais afficheront les donn√©es pour un &lt;em&gt;serveur&#xA;distant&lt;/em&gt; sp√©cifique uniquement, et bien entendu en r√©cup√©rant les donn√©es&#xA;depuis la &lt;strong&gt;base de donn√©es repository&lt;/strong&gt;, avec en plus de nouvelles&#xA;informations d√©crites ci-dessous.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez notez que puisque les donn√©es sont maintenant stock√©es sur un &lt;em&gt;serveur&#xA;repository&lt;/em&gt; d√©di√© quand le mode remote est utilis√©, la majorit√© de l‚ÄôUI est&#xA;utilisable sans se connecter au &lt;em&gt;serveur distant&lt;/em&gt; s√©lectionn√©.  Toutefois,&#xA;powa-web n√©cessite toujours de pouvoir se connecter sur le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;quand les donn√©es originales sont n√©cessaires (par exemple, pour la suggestion&#xA;d‚Äôindex ou pour montrer des plans avec &lt;strong&gt;EXPLAIN&lt;/strong&gt;).  Les &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;m√™mes consid√©rations&#xA;et possibilit√©s concernant&#xA;l‚Äôauthentification&lt;/a&gt;&#xA;que pour le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&#xA;&lt;/a&gt;&#xA;(qui sera d√©crit dans un prochain article) s‚Äôappliquent ici.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;pg_track_settings-support&#34;&gt;&lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt; support&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand cette extension est correctement configur√©e, un nouveau widget timeline&#xA;appara√Ætra, plac√© entre chaque graph et son aper√ßu, affichant diff√©rents types&#xA;de changements enregistr√©s si ceux-ci ont √©t√© d√©tect√©s sur l‚Äôintervalle de&#xA;temps s√©lectionn√©.  Sur les pages par base de donn√©es et par requ√™te, la liste&#xA;sera √©galement filtr√©e en fonction de la base de donn√©es s√©lectionn√©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La m√™me timeline sera affich√©e sur chacun des graphs de chacune des pages, afin&#xA;de facilement v√©rifier si ces changements ont eu un impact visible en utilisant&#xA;les diff√©rents graphs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez noter que les d√©tails des changements sont affich√©s au survol de la&#xA;souris.  Vous pouvez √©galement cliquer sur n‚Äôimporte lequel des √©v√©nements de&#xA;la timeline pour figer l‚Äôaffichage, et tracer une ligne verticale sur le graph&#xA;associ√©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple d‚Äôun tel changement de configuration en action :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_track_settings_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_track_settings_powa4.png&#34; alt=&#34;Changements de configuration d√©tect√©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez √©galement noter qu‚Äôil est n√©cessaire d‚Äôavoir au minimum la version&#xA;2.0.0 de &lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt;, et&#xA;que l‚Äôextension doit √™tre install√©e &lt;strong&gt;√† la fois sur les &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;ainsi que sur le &lt;em&gt;serveur repository&lt;/em&gt;.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouveaux-graphs-disponibles&#34;&gt;Nouveaux graphs disponibles&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_stat_kcache.html&#34;&gt;pg_stat_kcache&lt;/a&gt;&#xA;est configur√©, ses informations n‚Äô√©taient auparavant affich√©es que sur la page&#xA;par requ√™te.  Les informations sont maintenant √©galement affich√©es sur les&#xA;pages par serveur et par base, dans deux nouveaux graphs :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;dans le graph &lt;strong&gt;Block Access&lt;/strong&gt;, o√π les m√©triques &lt;strong&gt;OS cache&lt;/strong&gt; et &lt;strong&gt;disk&#xA;read&lt;/strong&gt; remplaceront la m√©trique &lt;strong&gt;read&lt;/strong&gt;&lt;/li&gt;&#xA;  &lt;li&gt;dans un nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; (qui est √©galement ajout√© dans&#xA;la page &lt;em&gt;par requ√™te&lt;/em&gt;), montrant les &lt;a href=&#34;/postgresql/2018/07/17/pg_stat_kcache-2-1-is-out.html&#34;&gt;metrics ajout√©es dans pg_stat_kcache&#xA;2.1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un example de ce nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34; alt=&#34;Ressources syst√®me&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y avait √©galement un graph &lt;strong&gt;Wait Events&lt;/strong&gt; (disponible quand &lt;a href=&#34;https://powa.readthedocs.io/en/v4/components/stats_extensions/pg_wait_sampling.html&#34;&gt;l‚Äôextension&#xA;pg_wait_sampling&lt;/a&gt;&#xA;est configu√©e) disponible uniquement sur la page par requ√™te.  Ce graph est&#xA;maintenant disponible sur les pages par serveur et par base √©galement.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;documentation-des-m√©triques-et-liens-vers-la-documentation&#34;&gt;Documentation des m√©triques et liens vers la documentation&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certaines m√©triques affich√©es sur l‚Äôinterface sont assez parlante, mais&#xA;certaines autres peuvent √™tre un peu obscures.  Jusqu‚Äô√† maintenant, il n‚Äôy&#xA;avait malheureusement aucune documentation pour les m√©triques.  Le probl√®me est&#xA;maintenant r√©gl√©, et tous les graphs ont une &lt;em&gt;ic√¥ne d‚Äôinformation&lt;/em&gt;, qui&#xA;affichent une description des m√©triques utilis√©e dans le graph au survol de la&#xA;souris.  Certains graphs incluent √©galement un lien vers la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;documentation PoWA&#xA;de extension&#xA;statistiques&lt;/a&gt;&#xA;pour les utilisateurs qui d√©sirent en apprendre plus √† leur sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_metrics_doc.png&#34;&gt;&lt;img src=&#34;/images/powa_4_metrics_doc.png&#34; alt=&#34;Documentation des m√©triques&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;et-des-correctifs-de-bugs-divers&#34;&gt;Et des correctifs de bugs divers&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certains probl√®mes de longues dates ont √©galement √©t√© rapport√©s :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;la bo√Æte affich√©e au survol d‚Äôun graph montant les valeurs des m√©triques&#xA;avait une position verticale incorrecte&lt;/li&gt;&#xA;  &lt;li&gt;la s√©lection temporelle en utilisant l‚Äôaper√ßu des graphs ne montrait pas un&#xA;aper√ßu correct apr√®s avoir appliqu√© la s√©lection&lt;/li&gt;&#xA;  &lt;li&gt;les erreurs lors de la cr√©ation d‚Äôindex hypoth√©tiques ou dans certains cas&#xA;leur affichage n‚Äô√©tait pas correctement g√©r√©s sur plusieurs pages&lt;/li&gt;&#xA;  &lt;li&gt;les filtres des tableaux n‚Äô√©tait pas r√©appliqu√©s quand l‚Äôintervalle de&#xA;temps s√©lectionn√© √©tait chang√©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Si un de ces probl√®mes vous a un jour pos√© probl√®me, vous serez ravi&#xA;d‚Äôapprendre qu‚Äôils sont maintenant tous corrig√©s !&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette 4√®me version de PoWA repr√©sente un temps de d√©veloppement tr√®s important,&#xA;de nombreuses am√©liorations sur la documentation et beaucoup de tests.  Nous&#xA;somme maintenant assez satisfaits, mais il est possible que nous ayons rat√©s&#xA;certains bugs.  Si vous vous int√©ressez √† ce projet, j‚Äôesp√®re que vous&#xA;essaierez de tester cette beta, et si besoin n‚Äôh√©sitez pas √† &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;nous remonter un&#xA;bug&lt;/a&gt;!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;PoWA 4 apporte un mode remote, disponible en beta !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on May 17, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>Nouveaut√© pg12: Statistiques sur les erreurs de checkums</title>
    <updated>2019-04-18T11:02:26Z</updated>
    <id>tag:rjuju.github.io,2019-04-18:/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html</id>
    <content type="html">&lt;h3 id=&#34;data-checksums&#34;&gt;Data checksums&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ajout√©s dans &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=96ef3b8ff1c&#34;&gt;PostgreSQL&#xA;9.3&lt;/a&gt;,&#xA;les &lt;a href=&#34;https://www.postgresql.org/docs/current/app-initdb.html#APP-INITDB-DATA-CHECKSUMS&#34;&gt;data&#xA;checksums&lt;/a&gt;&#xA;peuvent aider √† d√©tecter les corruptions de donn√©es survenant sur votre&#xA;stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les checksums sont activ√©s si l‚Äôinstance a √©t√© initialis√©e en utilisant &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&#xA;--data-checksums&lt;/code&gt; (ce qui n‚Äôest pas le comportement par d√©faut), ou s‚Äôils ont&#xA;√©t√© activ√©s apr√®s en utilisant la nouvelle utilitaire&#xA;activated afterwards with the new&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/devel/app-pgchecksums.html&#34;&gt;pg_checksums&lt;/a&gt;&#xA;√©galement &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=ed308d783790&#34;&gt;ajout√© dans PostgreSQL&#xA;12&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Quand les checksums sont ativ√©s, ceux-ci sont √©crits √† chaque fois qu‚Äôun bloc&#xA;de donn√©es est √©crit sur disque, et v√©rifi√©s √† chaque fois qu‚Äôun bloc est lu&#xA;depuis le disque (ou depuis le cache du syst√®me d‚Äôexploitation).  Si la&#xA;v√©rification √©choue, une erreur est remont√©e dans les logs.  Si le bloc √©tait&#xA;lu par un processus client, la requ√™te associ√©e √©chouera bien √©videmment, mais&#xA;si le bloc √©tait lu par une op√©ration&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;&#xA;(tel que pg_basebackup), la commande continuera √† s‚Äôex√©cuter.  Bien que les&#xA;data checksums ne d√©tecteront qu‚Äôun sous ensemble des probl√®mes possibles, ils&#xA;ont tout de m√™me une certaine utilis√©, surtout si vous ne faites pas confiance&#xA;√† votre stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Jusqu‚Äô√† PostgreSQL 11, les erreurs de validation de checksum ne pouvaient √™tre&#xA;trouv√©es qu‚Äôen cherchant dans les logs, ce qui n‚Äôest clairement pas pratique si&#xA;vous voulez monitorer de telles erreurs.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveaux-compteurs-disponibles-dans-pg_stat_database&#34;&gt;Nouveaux compteurs disponibles dans pg_stat_database&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour rendre la supervision des erreurs de checksum plus simple, et pour aider&#xA;les utilisateurs √† r√©agir d√®s qu‚Äôun tel probl√®me survient, PostgreSQL 12 ajoute&#xA;de nouveaux compteurs dans la vue &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 6b9e875f7286d8535bff7955e5aa3602e188e436&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Sat Mar 9 10:45:17 2019 -0800&#xA;&#xA;Track block level checksum failures in pg_stat_database&#xA;&#xA;This adds a column that counts how many checksum failures have occurred&#xA;on files belonging to a specific database. Both checksum failures&#xA;during normal backend processing and those created when a base backup&#xA;detects a checksum failure are counted.&#xA;&#xA;Author: Magnus Hagander&#xA;Reviewed by: Julien Rouhaud&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;¬†&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 77bd49adba4711b4497e7e39a5ec3a9812cbd52a&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Fri Apr 12 14:04:50 2019 +0200&#xA;&#xA;    Show shared object statistics in pg_stat_database&#xA;&#xA;    This adds a row to the pg_stat_database view with datoid 0 and datname&#xA;    NULL for those objects that are not in a database. This was added&#xA;    particularly for checksums, but we were already tracking more satistics&#xA;    for these objects, just not returning it.&#xA;&#xA;    Also add a checksum_last_failure column that holds the timestamptz of&#xA;    the last checksum failure that occurred in a database (or in a&#xA;    non-dataabase file), if any.&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;¬†&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 252b707bc41cc9bf6c55c18d8cb302a6176b7e48&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Wed Apr 17 13:51:48 2019 +0200&#xA;&#xA;    Return NULL for checksum failures if checksums are not enabled&#xA;&#xA;    Returning 0 could falsely indicate that there is no problem. NULL&#xA;    correctly indicates that there is no information about potential&#xA;    problems.&#xA;&#xA;    Also return 0 as numbackends instead of NULL for shared objects (as no&#xA;    connection can be made to a shared object only).&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;    Reviewed-by: Robert Treat &amp;lt;rob@xzilla.net&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces compteurs refl√®teront les erreurs de validation de checksum √† la fois pour&#xA;les processus clients et pour l‚Äôactivit√©&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;,&#xA;par base de donn√©es.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;rjuju&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_database&lt;/span&gt;&#xA;                        &lt;span class=&#34;k&#34;&gt;View&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;pg_catalog.pg_stat_database&#34;&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------------+--------------------------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datid&lt;/span&gt;                 &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;                      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;                     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_failures&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_last_failure&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;stats_reset&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_failures&lt;/code&gt; montrera un nombre cumul√© d‚Äôerreurs, et la&#xA;colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_last_failure&lt;/code&gt; montrera l‚Äôhorodatage de la derni√®re erreur de&#xA;validation sur la base de donn√©es (NULL si aucune erreur n‚Äôest jamais&#xA;survenue).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour √©viter toute confusion (merci √† Robert Treat pour l‚Äôavoir signal√©), ces&#xA;deux colonnes retourneront toujours NULL si les data checkums ne sont pas&#xA;activ√©s, afin qu‚Äôon ne puisse pas croire que les checksums sont toujours&#xA;v√©rifi√©s avec succ√®s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme effet de bord, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt;  montrera maintenant √©galement les&#xA;statistiques disponibles pour les objets partag√©s (tels que la table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; par exemple), dans une nouvelle ligne pour laquelle &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datid&lt;/code&gt; vaut&#xA;&lt;strong&gt;0&lt;/strong&gt;, et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datname&lt;/code&gt; vaut &lt;strong&gt;NULL&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;del&gt;Une sonde d√©di√©e est √©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/issues/226&#34;&gt;d√©j√†&#xA;planifi√©e&lt;/a&gt; dans&#xA;&lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/del&gt;&#xA;Une sonde d√©di√©e est √©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/commit/0e8b516e95e4364470d4e205aebc9fe68bbcfd23&#34;&gt;d√©j√†&#xA;disponible&lt;/a&gt;&#xA;dans &lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html&#34;&gt;Nouveaut√© pg12: Statistiques sur les erreurs de checkums&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on April 18, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>Mettre en place une streaming replication avec PostgreSQL 10</title>
    <updated>2018-03-13T06:28:00Z</updated>
    <id>tag:blog.raveland.tech,2018-03-13:/post/postgresql_sr_fr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_sr_fr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Dans ce post, je vais vous expliquer comment mettre en place une &lt;em&gt;streaming replication&lt;/em&gt; avec PostgreSQL 10. Par contre, je n&amp;rsquo;expliquerais pas comment installer PostgreSQL donc je suppose que cela est d√©j√† le cas.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>OpenBSD / PostgreSQL / Authentification</title>
    <updated>2017-11-29T11:31:53Z</updated>
    <id>tag:blog.raveland.tech,2017-11-29:/post/openbsd_pg/</id>
    <link href="https://blog.raveland.tech/post/openbsd_pg/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Si vous √™tes un utilisateur d&amp;rsquo;OpenBSD et de PostgreSQL, vous pouvez utiliser l&amp;rsquo;authentification BSD pour vous authentifier sur vos bases.&#xA;Nous allons voir comment faire cela.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>Postgresql et la r√©plication logique</title>
    <updated>2017-11-27T08:32:06Z</updated>
    <id>tag:blog.raveland.tech,2017-11-27:/post/postgresql_lr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_lr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cet article va tester la nouvelle fonctionnalit√© disponible depuis PostgreSQL 10.0 : la r√©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Pour en savoir plus, l&amp;rsquo;excellente &lt;a href=&#34;https://docs.postgresql.fr/10/logical-replication.html&#34;&gt;documentation de PostgreSQL&lt;/a&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
</feed>