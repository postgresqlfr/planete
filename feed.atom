<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>PlanÃ¨te PostgreSQL</title>
  <id>https://planete.postgresql.fr/</id>
  <updated>2025-09-12T12:56:26Z</updated>
  <subtitle>L&#39;actualitÃ© de PostgreSQL de franÃ§ais</subtitle>
  <link href="https://planete.postgresql.fr/"></link>
  <author>
    <name>PostgreSQL.fr</name>
    <email>contact@postgresql.fr</email>
  </author>
  <entry>
    <title>Industrialiser les sauvegardes de PostgreSQL</title>
    <updated>2025-09-11T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-09-11://2025/09/11/industrialiser-les-sauvegardes-de-postgresql.html</id>
    <link href="https://blog.dalibo.com//2025/09/11/industrialiser-les-sauvegardes-de-postgresql.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Nantes, le 11 Septembre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous avons vu dans un prÃ©cÃ©dent article comment faciliter lâ€™industrialisation du dÃ©ploiement dâ€™instances PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans ce nouvel article, nous allons approfondir sur le dÃ©ploiement des sauvegardes, qui sont un aspect important &#xA;Ã  prendre en compte pour que les instances dÃ©ployÃ©es automatiquement soient prÃªtes pour la production. Nous verrons&#xA;comment lâ€™outil &lt;em&gt;pglift&lt;/em&gt; peut aider dans cette dÃ©marche.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h2 id=&#34;types-de-sauvegarde&#34;&gt;Types de sauvegarde&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Pour les sauvegardes de PostgreSQL, on distingue deux stratÃ©gies distinctes mais complÃ©mentaires, les sauvegardes &#xA;physiques et les sauvegardes logiques.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sauvegardes-physiques-locale&#34;&gt;Sauvegardes physiques locale&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une sauvegarde physique est une copie du rÃ©pertoire donnÃ©es de lâ€™instance. Si cette opÃ©ration est rÃ©alisÃ©e Â« Ã  froid Â», câ€™est Ã  dire lorsque lâ€™instance est arrÃªtÃ©e, la restauration se fait par simple copie des fichiers sauvegardÃ©s vers le rÃ©pertoire de &#xA;donnÃ©es. Si la sauvegarde est rÃ©alisÃ©e Â« Ã  chaud Â», cette derniÃ¨re est alors composÃ©e de donnÃ©es incohÃ©rentes. Il faut &#xA;alors, en plus de la sauvegarde des fichiers de donnÃ©es, sauvegarder les archives des journaux de transactions (WAL). &#xA;Lors du redÃ©marrage, PostgreSQL rejoue les WAL sur les fichiers de donnÃ©es afin de retrouver un Ã©tat cohÃ©rent. Souvent, on &#xA;utilise un outil de sauvegarde pour gÃ©rer les opÃ©rations de sauvegarde et restauration, ainsi que la gestion de &#xA;lâ€™archivage des WAL. Dans cet article, nous allons nous pencher sur lâ€™utilisation de pgBackRest au travers de pglift&#xA;pour automatiser le dÃ©ploiement dâ€™une sauvegarde dans un dÃ©pÃ´t local.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec pglift, il est possible dâ€™industrialiser la configuration de pgBackRest pour nos instances.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple simple dâ€™une configuration de pglift qui le permet :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;systemd&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;pi&#34;&gt;{}&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;postgresql&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;scram-sha-256&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;peer&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;datadir&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/pgsql_data/{version}/{name}/data&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;pgbackrest&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;repository&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;path&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/pgsql_backups/pgbackrest&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lorsquâ€™une instance PostgreSQL est dÃ©ployÃ©e avec cette configuration de site, &#xA;et quâ€™un nom de stanza pgBackRest est spÃ©cifiÃ© lors de la crÃ©ation &#xA;dâ€™instance, pgBackRest est configurÃ© lors du dÃ©ploiement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance create main &lt;span class=&#34;nt&#34;&gt;--pgbackrest-stanza&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my_app&#xA;INFO     initializing PostgreSQL         &#xA;INFO     configuring PostgreSQL authentication&#xA;INFO     configuring PostgreSQL&#xA;INFO     enabling systemd unit pglift-postgresql@14-main.service&#xA;INFO     starting PostgreSQL 14/main&#xA;INFO     starting systemd unit pglift-postgresql@14-main.service&#xA;INFO     creating role &lt;span class=&#34;s1&#34;&gt;&#39;backup&#39;&lt;/span&gt;&#xA;INFO     configuring pgBackRest stanza &lt;span class=&#34;s1&#34;&gt;&#39;my_app&#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;pg1-path&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/pgsql_data/14/main/data&#xA;INFO     creating pgBackRest stanza &lt;span class=&#34;s1&#34;&gt;&#39;my_app&#39;&lt;/span&gt;&#xA;INFO     checking pgBackRest configuration &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;stanza &lt;span class=&#34;s1&#34;&gt;&#39;my_app&#39;&lt;/span&gt;&#xA;INFO     enabling systemd unit pglift-backup@14-main.timer&#xA;INFO     creating instance dumps directory: /home/postgres/.local/share/pglift/srv/dumps/14-main&#xA;INFO     starting systemd unit pglift-backup@14-main.timer&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;pglift gÃ©nÃ¨re un fichier de configuration pour pgBackRest :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ~/.local/share/pglift/etc/pgbackrest/pgbackrest.conf &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;global]&#xA;lock-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /run/user/1001/pglift/pgbackrest/lock&#xA;log-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /home/postgres/.local/share/pglift/log/pgbackrest&#xA;spool-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /home/postgres/.local/share/pglift/srv/pgbackrest/spool&#xA;repo1-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /pgsql_backups/pgbackrest&#xA;repo1-retention-archive &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 2&#xA;repo1-retention-diff &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 3&#xA;repo1-retention-full &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 2&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Il ajoute une stanza pour lâ€™instance dans &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;conf.d&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ~/.local/share/pglift/etc/pgbackrest/conf.d/my_app.conf &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;my_app]&#xA;pg1-path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; /pgsql_data/14/main/data&#xA;pg1-port &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 5432&#xA;pg1-user &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; backup&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Enfin, il prend Ã©galement en charge la configuration du paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;archive_command&lt;/code&gt; pour &#xA;archiver les WAL vers le dÃ©pÃ´t de sauvegarde via la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest archive-push&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;show archive_command&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;                                                                     archive_command                               &#xA;                                      &#xA;&lt;span class=&#34;nt&#34;&gt;-------------------------------------------------------------------------------------------------------------------&lt;/span&gt;&#xA;&lt;span class=&#34;nt&#34;&gt;--------------------------------------&lt;/span&gt;&#xA; /usr/bin/pgbackrest &lt;span class=&#34;nt&#34;&gt;--config-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/home/postgres/.local/share/pglift/etc/pgbackrest &lt;span class=&#34;nt&#34;&gt;--stanza&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my_app &lt;span class=&#34;nt&#34;&gt;--pg1-path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/pg&#xA;sql_data/14/main/data archive-push %p&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1 row&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Par consÃ©quent, dÃ¨s le dÃ©ploiement, les WAL sont archivÃ©s dans le dÃ©pÃ´t de sauvegarde&#xA;de pgBackRest et la sauvegarde de lâ€™instance est alors possible. Pour cela, on utilise &#xA;la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance backup&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance backup&#xA;INFO     backing up instance 17/main with pgBackRest    &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour lister les sauvegardes prÃ©sentes dans le dÃ©pÃ´t, on utilise la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance backups&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance backups&#xA;                                       Available backups &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;instance 14/main                                        &#xA;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”“&#xA;â”ƒ label            â”ƒ size    â”ƒ repo_size â”ƒ date_start                â”ƒ date_stop                 â”ƒ &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; â”ƒ databases â”ƒ&#xA;â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”©&#xA;â”‚ 20250826-121904F â”‚ 26.5 MB â”‚ 3.3 MB    â”‚ 2025-08-26 12:19:04+02:00 â”‚ 2025-08-26 12:19:10+02:00 â”‚ full â”‚ postgres  â”‚&#xA;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xA;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Sinon, la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest info&lt;/code&gt;, exÃ©cutÃ©e au travers de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance exec&lt;/code&gt;&#xA;permet aussi dâ€™obtenir les informations sur les sauvegardes, cette fois directement &#xA;depuis pgBackRest :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; pgbackrest info&#xA;stanza: my_app&#xA;    status: ok&#xA;    cipher: none&#xA;&#xA;    db &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;current&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;        wal archive min/max &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;14&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;: 000000010000000000000001/000000010000000000000003&#xA;&#xA;        full backup: 20250826-121904F&#xA;            timestamp start/stop: 2025-08-26 12:19:04+02 / 2025-08-26 12:19:10+02&#xA;            wal start/stop: 000000010000000000000003 / 000000010000000000000003&#xA;            database size: 25.3MB, database backup size: 25.3MB&#xA;            repo1: backup &lt;span class=&#34;nb&#34;&gt;set &lt;/span&gt;size: 3.2MB, backup size: 3.2MB&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour vÃ©rifier le bon fonctionnement, on peut crÃ©er une table dans une nouvelle base de donnÃ©es, pour y insÃ©rer quelques lignes :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database create db1&#xA;INFO     creating &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; database &lt;span class=&#34;k&#34;&gt;in &lt;/span&gt;17/main      &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;CREATE TABLE t1 (id INT); INSERT INTO t1 VALUES (1),(2),(3);&#34;&lt;/span&gt;&#xA;CREATE TABLE&#xA;INSERT 0 3&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Noter ensuite la date et lâ€™heure actuelle :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;select now();&#34;&lt;/span&gt;&#xA;              now              &#xA;&lt;span class=&#34;nt&#34;&gt;-------------------------------&lt;/span&gt;&#xA; 2025-08-26 12:20:18.968157+02&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1 row&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Puis supprimer la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;DROP TABLE t1&#34;&lt;/span&gt;&#xA;DROP TABLE&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt;, dÃ©sormais manquante, nâ€™Ã©tait pas prÃ©sente au moment de la sauvegarde, &#xA;ni mÃªme la base de donnÃ©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;db1&lt;/code&gt; qui la contient. On pourrait donc croire que les &#xA;donnÃ©es sont perdues. Cependant, les actions menant Ã  la crÃ©ation de la base de &#xA;donnÃ©es et de la table on Ã©tÃ© enregistrÃ©es dans les journaux de transaction (WAL), &#xA;il est donc tout Ã  fait possible de retrouver les donnÃ©es en restaurant la &#xA;sauvegarde qui prÃ©cÃ¨de lâ€™existence de la table, puis en laissant PostgreSQL &#xA;rejouer les WAL sur ses fichiers de donnÃ©es pendant la phase de recover.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les WAL sont archivÃ©s dans le dÃ©pÃ´t de sauvegarde de pgBackRest, et PostgreSQL &#xA;est capable dâ€™accÃ©der Ã  ces archives via le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;restore_command&lt;/code&gt;, qui &#xA;est Ã©galement configurÃ© automatiquement par pglift lors du dÃ©ploiement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;postgres=# show restore_command ;&#xA;                                                     restore_command                                                     &#xA;-------------------------------------------------------------------------------------------------------------------------&#xA; /usr/bin/pgbackrest --config-path=/home/postgres/.local/share/pglift/etc/pgbackrest --stanza=my_app archive-get %f &#34;%p&#34;&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le rejeu des WAL est exÃ©cutÃ© lors du premier dÃ©marrage qui suit la restauration. &#xA;Pour restaurer notre table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt;, pglift va donc exÃ©cuter une restauration de &#xA;lâ€™instance via pgBackRest. Ce dernier va alors configurer PostgreSQL pour rejouer &#xA;les WAL jusquâ€™Ã  la date et heure demandÃ©e, câ€™est Ã  dire celle que nous avons notÃ©&#xA;plus tÃ´t.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™instance est arrÃªtÃ©e, puis restaurÃ©e avec la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift instance restore&lt;/code&gt;. &#xA;On spÃ©cifie la date au format &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;YYYY-MM-JJ HH:MM:SS&lt;/code&gt; avec lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--date&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance stop&#xA;INFO     stopping PostgreSQL 17/main&#xA;INFO     stopping systemd unit pglift-postgresql@17-main.&#xA;INFO     stopping systemd unit pglift-backup@17-main.timer&#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 pglift]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance restore &lt;span class=&#34;nt&#34;&gt;--date&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;2025-08-26 12:20:18&#34;&lt;/span&gt;&#xA;INFO     restoring instance 17/main with pgBackRest &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;DÃ©marrer lâ€™instance. PostgreSQL effectue alors le recover jusquâ€™Ã  la date et heure cible :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance start&#xA;INFO     starting PostgreSQL 14/main                                                                               &#xA;INFO     starting systemd unit pglift-postgresql@14-main.service                                                   &#xA;INFO     starting systemd unit pglift-backup@14-main.timer     &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La trace lors du dÃ©marrage nous indique bien que le recovery sâ€™est arrÃªtÃ© avant la &#xA;transaction exÃ©cutÃ©e Ã  12:20:35, ce qui correspond Ã  la suppression de la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;13-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;6-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  restored log file &lt;span class=&#34;s2&#34;&gt;&#34;000000010000000000000004&#34;&lt;/span&gt; from archive&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;14-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;7-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  recovery stopping before commit of transaction 736, &lt;span class=&#34;nb&#34;&gt;time &lt;/span&gt;2025-08-26 12:20:35.654705+02&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;15-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;8-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  redo &lt;span class=&#34;k&#34;&gt;done &lt;/span&gt;at 0/40188D8 system usage: CPU: user: 0.00 s, system: 0.03 s, elapsed: 0.14 s&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;16-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;9-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  last completed transaction was at log &lt;span class=&#34;nb&#34;&gt;time &lt;/span&gt;2025-08-26 12:20:14.593246+02&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;17-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;10-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  selected new timeline ID: 2&#xA;Aug 26 10:21:06 srv-pg1 postgresql-14-main[33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;18-1] &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;33116]: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;11-1] &lt;span class=&#34;nv&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;,client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; LOG:  archive recovery &lt;span class=&#34;nb&#34;&gt;complete&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La table est donc bien de nouveau consultable dans la base de donnÃ©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;db1&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;SELECT * FROM t1&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;nb&#34;&gt;id&lt;/span&gt; &#xA;&lt;span class=&#34;nt&#34;&gt;----&lt;/span&gt;&#xA;  1&#xA;  2&#xA;  3&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;3 rows&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h4 id=&#34;sauvegarde-physique-Ã -distance&#34;&gt;Sauvegarde physique Ã  distance&lt;/h4&gt;&#xA;&#xA;&lt;p&gt;Nous avons dÃ©crit le fonctionnement de la sauvegarde physique locale, mais&#xA;pgBackRest peut Ã©galement fonctionner sur un modÃ¨le client-serveur, dans lequel&#xA;un serveur pgBackRest regroupe les sauvegardes provenant de plusieurs instances &#xA;PostgreSQL dans un dÃ©pÃ´t unique et centralise leurs planifications. Ce mode &#xA;de fonctionnement ne sera pas dÃ©veloppÃ© en dÃ©tail dans cet article, mais il est &#xA;Ã©galement supportÃ© par pglift.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;https://pglift.readthedocs.io/en/latest/user/setup/pgbackrest.html#remote-repository-mode&#34;&gt;Voir la documentation associÃ©e&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sauvegardes-logiques&#34;&gt;Sauvegardes logiques&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Les sauvegardes logiques fonctionnent selon un principe diffÃ©rent. Dans ce &#xA;mode de sauvegarde, les donnÃ©es de lâ€™instance sont exportÃ©es dans un ou plusieurs &#xA;fichiers.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un dump est une sauvegarde qui correspond au rÃ©sultat dâ€™une lecture cohÃ©rente de &#xA;la base de donnÃ©es, telle quâ€™elle Ã©tait au moment du dÃ©but de la sauvegarde, et &#xA;quelque soit la durÃ©e dâ€™export des donnÃ©es. Cela est rendu possible par le &#xA;mÃ©canisme MVCC de PostgreSQL, qui permet dâ€™accÃ©der aux versions prÃ©cÃ©dentes des &#xA;donnÃ©es qui pourraient avoir Ã©tÃ© modifiÃ©es pendant que la sauvegarde est effectuÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le dump peut Ãªtre importÃ© sur son instance dâ€™origine pour restaurer une base de &#xA;donnÃ©es Ã  un Ã©tat prÃ©cÃ©dent. Il peut aussi Ãªtre utile pour des besoins de &#xA;migration, ou pour porter des donnÃ©es sur une instance de test par exemple.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™outil standard &lt;em&gt;pg_dump&lt;/em&gt; permet de rÃ©aliser ces sauvegardes, et il peut Ãªtre &#xA;pilotÃ© par &lt;em&gt;pglift&lt;/em&gt; pour rÃ©aliser les dumps sur les instances quâ€™il dÃ©ploie.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;pglift&lt;/em&gt; effectue lâ€™export des donnÃ©es via la commande spÃ©cifiÃ©e dans la &#xA;clÃ© &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql.dump_commands&lt;/code&gt; de sa configuration. La valeur par dÃ©faut est la &#xA;suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;dump_commands&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;{bindir}/pg_dump&#39;&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;-Fc&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;-f&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;{path}/{dbname}_{date}.dump&#39;&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;-d&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;{conninfo}&#39;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On voit ici que &lt;em&gt;pg_dump&lt;/em&gt; sera utilisÃ© pour rÃ©aliser un dump au format&#xA;&lt;em&gt;custom&lt;/em&gt; (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;-Fc&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™emplacement du dump (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;{path}&lt;/code&gt;) correspond au paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dumps_directory&lt;/code&gt;,&#xA;qui est par dÃ©faut dÃ©duit du rÃ©pertoire de donnÃ©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;dumps_directory&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/pgsql_data/backups/dumps/{version}-{name}&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Sur notre instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;main&lt;/code&gt;, nous pouvons donc faire une sauvegarde de la base&#xA;de donnÃ©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;db1&lt;/code&gt; avec la commande suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database dump db1&#xA;INFO     backing up database &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; on instance 14/main &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On retrouve bien le dump Ã  lâ€™emplacement prÃ©vu :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ls&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-l&lt;/span&gt; /pgsql_data/backups/dumps/14-main/&#xA;total 4&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-r--r--&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;.&lt;/span&gt; 1 postgres &lt;span class=&#34;nb&#34;&gt;users &lt;/span&gt;1176 Sep  1 14:35 db1_2025-09-01T14:35:30+00:00.dump&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Et &lt;em&gt;pglift&lt;/em&gt; peut Ã©galement lister les dumps prÃ©sents dans ce rÃ©pertoire :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;[postgres@srv-pg1 ~]$ pglift database dumps&#xA;                                                   Dumps for all databases                                                    &#xA;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“&#xA;â”ƒ id             â”ƒ dbname â”ƒ date                      â”ƒ path                                                                 â”ƒ&#xA;â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©&#xA;â”‚ db1_665a78398d â”‚ db1    â”‚ 2025-09-01 14:35:30+00:00 â”‚ /pgsql_data/backups/dumps/14-main/db1_2025-09-01T14:35:30+00:00.dump â”‚&#xA;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Supprimer Ã  nouveau la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t1&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;DROP TABLE t1&#34;&lt;/span&gt;&#xA;DROP TABLE&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour retrouver nos donnÃ©es Ã  partir de la sauvegarde, il convient de supprimer &#xA;la base de donnÃ©es, puis de restaurer via le dump, en spÃ©cifiant son identifiant :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database drop db1&#xA;INFO     dropping &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; database    &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database restore db1_665a78398d&#xA;INFO     restoring dump &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;db1&#39;&lt;/span&gt; on instance 14/main    &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Les donnÃ©es sont bien restaurÃ©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance &lt;span class=&#34;nb&#34;&gt;exec &lt;/span&gt;main &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; psql &lt;span class=&#34;nt&#34;&gt;-d&lt;/span&gt; db1 &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;SELECT * FROM t1&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;nb&#34;&gt;id&lt;/span&gt; &#xA;&lt;span class=&#34;nt&#34;&gt;----&lt;/span&gt;&#xA;  1&#xA;  2&#xA;  3&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;3 rows&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h1 id=&#34;pour-conclure&#34;&gt;Pour conclure&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Pour industrialiser PostgreSQL sans risque pour la sÃ©curitÃ© des donnÃ©es, il &#xA;est important de prÃ©voir au plus tÃ´t comment celles-ci seront sauvegardÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous avons vu comment lâ€™outil &lt;em&gt;pglift&lt;/em&gt; nous permettait dâ€™industrialiser le dÃ©ploiement&#xA;de nos sauvegardes, physiques ou logiques, de telle sorte que toute nouvelle instance&#xA;est prÃªte Ã  Ãªtre sauvegardÃ©es dÃ¨s son initialisation. Le dÃ©ploiement de la&#xA;sauvegarde Ã©tant alors industriel, on rÃ©duit les risques dâ€™erreurs lors de sa&#xA;mise en place.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #9 - L&#39;ajout dynamique d&#39;extensions</title>
    <updated>2025-09-09T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-09-09://2025/09/09/cnpg-9.html</id>
    <link href="https://blog.dalibo.com//2025/09/09/cnpg-9.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 9 septembre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;CloudNativePG&lt;/strong&gt; ou comment embarquer un Ã©lÃ©phant sur un porte-conteneurs !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les extensions font partie des nombreux avantages de PostgreSQL. Elles&#xA;permettent de rajouter des fonctionnalitÃ©s Ã  nos bases de donnÃ©es en chargeant des&#xA;modules complÃ©mentaires comme &lt;a href=&#34;https://postgis.net/&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PostGIS&lt;/code&gt;&lt;/a&gt; ou&#xA;encore &lt;a href=&#34;https://postgresql-anonymizer.readthedocs.io/en/stable/&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PostgreSQL Anonymizer&lt;/code&gt;&lt;/a&gt;.&#xA;CloudNativePG embarque dÃ©jÃ  quelques extensions. Mais si lâ€™on veut en rajouter&#xA;une, comment cela se passe-t-il ğŸ¤” ?&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Câ€™est ce que nous allons voir avec une nouvelle fonctionnalitÃ© de la version&#xA;1.27 de lâ€™opÃ©rateur et de lâ€™utilisation du nouveau paramÃ¨tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt; de la version 18 de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;les-extensions-disponibles&#34;&gt;Les extensions disponibles&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Au moment de la rÃ©daction de ce post, une quarantaine dâ€™extensions sont&#xA;disponibles dans une instance PostgreSQL dÃ©ployÃ©e avec CloudNativePG. Cela peut&#xA;facilement Ãªtre vu avec la commande suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_available_extensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;-------&lt;/span&gt;&#xA;    &lt;span class=&#34;mi&#34;&gt;46&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces extensions-lÃ  sont disponibles, car elles se trouvent Ãªtre ajoutÃ©es Ã  lâ€™image&#xA;lors de sa construction. Certains opÃ©rateurs en embarquent plus, dâ€™autres&#xA;beaucoup moins. Il est donc intÃ©ressant de vÃ©rifier celles qui sont dÃ©jÃ &#xA;dÃ©ployÃ©es et dans quelles versions est disponibles.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Jusquâ€™Ã  prÃ©sent, si nous souhaitions utiliser une extension qui ne faisait pas&#xA;partie de cette liste, il Ã©tait nÃ©cessaire de modifier lâ€™image utilisÃ©e pour&#xA;lâ€™intÃ©grer. Bien que tout Ã  fait faisable, cela nâ€™Ã©tait pas trÃ¨s flexible.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La version 18 de PostgreSQL apporte une nouveautÃ© avec le paramÃ¨tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt; qui permet dâ€™indiquer dâ€™autres emplacements oÃ¹ peuvent&#xA;Ãªtre trouvÃ©es des extensions. Lâ€™idÃ©e des dÃ©veloppeurs de CloudNativePG est de&#xA;mettre Ã  jour ce paramÃ¨tre en fonction des nouvelles extensions que nous&#xA;ajoutons pour prendre en compte dynamiquement les ajouts. Nous verrons plus tard&#xA;sur quel mÃ©canisme de Kubernetes se repose cette fonctionnalitÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™idÃ©e est de prÃ©senter notre nouvelle extension via un nouveau conteneur Ã &#xA;notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt;. Et qui dit conteneur, dit image ğŸ“¦.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;crÃ©ation-dune-extension&#34;&gt;CrÃ©ation dâ€™une extension&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bon pour commencer, il nous faut une extension. Pour les plus curieux, vous&#xA;pouvez trouver des explications sur comment faire dans cette suite dâ€™&lt;a href=&#34;https://blog.dalibo.com/2023/06/08/hackingpg1.html&#34;&gt;articles&lt;/a&gt;.&#xA;Je me suis clairement inspirÃ© de celui-ci, et ai donc deux fichiers dans un&#xA;dossierÂ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/share/&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ./share/monextension--1.0.sql &#xA;&lt;span class=&#34;se&#34;&gt;\e&lt;/span&gt;cho Ne pas exÃ©cuter ce script, mais passer par CREATE EXTENSION&#xA;&#xA;CREATE OR REPLACE FUNCTION incremente&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;int&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;RETURNS int&#xA;LANGUAGE sql&#xA;AS &lt;span class=&#34;s1&#34;&gt;&#39;SELECT $1+1&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat&lt;/span&gt; ./share/monextension.control &#xA;comment &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;Mon extension&#39;&lt;/span&gt;&#xA;default_version &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;1.0&#39;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lorsque cette extension sera installÃ©e dans la base de donnÃ©es, la&#xA;fonctionÂ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;incremente()&lt;/code&gt; sera disponible.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;crÃ©ation-de-limage&#34;&gt;CrÃ©ation de lâ€™image&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Les fichiers de lâ€™extension seront ajoutÃ©s au &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; PostgreSQL via le mÃ©canisme&#xA;dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ImageVolume&lt;/code&gt; de Kubernetes. Cette fonctionnalitÃ© doit Ãªtre activÃ©e sur votre&#xA;cluster. Elle est toujours en version&#xA;&lt;a href=&#34;https://kubernetes.io/blog/2025/04/29/kubernetes-v1-33-image-volume-beta/&#34;&gt;&lt;em&gt;beta&lt;/em&gt;&lt;/a&gt;&#xA;dans la version 1.33 de Kubernetes et notez que tous les &lt;em&gt;container runtime&lt;/em&gt; ne&#xA;supportent pas encore cela. Elle permet dâ€™attacher un volume Ã  partir du contenu&#xA;dâ€™une image sans devoir modifier lâ€™image principale. Ici, nous allons empaqueter&#xA;nos fichiers dâ€™extensions.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Dockerfile&lt;/code&gt; de notre exemple est ultra simpliste :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-dockerfile highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; debian:bookworm&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;RUN &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /share/extension&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; ./share /share/extension&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™image se repose sur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;debian:bookworm&lt;/code&gt; et ne fait que crÃ©er un dossier&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/share/extension&lt;/code&gt; en y incluant les fichiers de notre extension. Le dossier&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/share/extension&lt;/code&gt; est un prÃ©-requis que doit respecter notre image.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;docker build -t monextension:1.0&lt;/code&gt; permet de crÃ©er notre image&#xA;localement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;docker build &lt;span class=&#34;nt&#34;&gt;-t&lt;/span&gt; monextension:1.0 &lt;span class=&#34;nb&#34;&gt;.&lt;/span&gt;              &#xA;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+] Building 1.6s &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;8/8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; FINISHED                                                                        docker:default&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load build definition from Dockerfile                                                              0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; transferring dockerfile: 120B                                                                              0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load metadata &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;docker.io/library/debian:bookworm                                                1.5s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load .dockerignore                                                                                 0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; transferring context: 2B                                                                                   0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;1/3] FROM docker.io/library/debian:bookworm@sha256:731dd1380d6a8d170a695dbeb17fe0eade0e1c29f654cf0a3a07f372  0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;internal] load build context                                                                                 0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; transferring context: 119B                                                                                 0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; CACHED &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2/3] RUN &lt;span class=&#34;nb&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /share/extension                                                                    0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; CACHED &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;3/3] COPY ./share /share/extension                                                                    0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; exporting to image                                                                                            0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; exporting layers                                                                                           0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; writing image sha256:f267ee02248f74f371a68ebd37287f4727639342f5b4305e5d21670149195b72                      0.0s&#xA; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; naming to docker.io/library/monextension:1.0                                                               0.0s&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Il nous reste Ã  rendre cette image disponible pour notre cluster Kubernetes.&#xA;Vous pouvez passer par une &lt;em&gt;registry&lt;/em&gt; publique. Ici, pour faire beaucoup plus&#xA;simple, et comme &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kind&lt;/code&gt; est utilisÃ©, nous poussons lâ€™image sur le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Node&lt;/code&gt; avec :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;kind load docker-image monextension:1.0&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Maintenant que lâ€™image est prÃªte, voyons comment la rajouter Ã  notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;&#xA;PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;dÃ©finition-du-cluster&#34;&gt;DÃ©finition du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;La dÃ©finition du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; est la suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:18beta2&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;1Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;postgresql&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;extensions&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;monextension&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;reference&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;monextension:1.0&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La fin de ce fichier nous intÃ©resse particuliÃ¨rement avec la partie&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.postgresql.extensions&lt;/code&gt; qui liste les extensions Ã  rajouter et les images&#xA;associÃ©es. Ici, lâ€™extensionÂ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;monextension&lt;/code&gt; dans sa version 1.0 va Ãªtre rajoutÃ©e&#xA;en mÃªme temps que le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; sera crÃ©Ã©.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;kubectl apply &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; cluster.yaml&#xA;cluster.postgresql.cnpg.io/postgresql created&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ã€ la crÃ©ation, trois images seront dÃ©sormais rÃ©cupÃ©rÃ©es : deux pour le&#xA;fonctionnement de PostgreSQL avec CloudNativePG et la troisiÃ¨me correspondant Ã &#xA;lâ€™extension.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;kubectl describe pod postgresql-1 | &lt;span class=&#34;nb&#34;&gt;grep &lt;/span&gt;image    &#xA;  Normal  Pulled     29s                kubelet            Container image &lt;span class=&#34;s2&#34;&gt;&#34;ghcr.io/cloudnative-pg/cloudnative-pg:1.27.0&#34;&lt;/span&gt; already present on machine&#xA;  Normal  Pulled     28s                kubelet            Container image &lt;span class=&#34;s2&#34;&gt;&#34;ghcr.io/cloudnative-pg/postgresql:18beta2&#34;&lt;/span&gt; already present on machine&#xA;  Normal  Pulled     28s                kubelet            Container image &lt;span class=&#34;s2&#34;&gt;&#34;monextension:1.0&#34;&lt;/span&gt; already present on machine&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™extension est dÃ©sormais bien disponible dans notre instance :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;kubectl cnpg psql postgresql            &#xA;psql &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;18beta2 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Debian 18~beta2-1.pgdg110+1&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;&#xA;Type &lt;span class=&#34;s2&#34;&gt;&#34;help&#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;help.&#xA;&#xA;&lt;span class=&#34;nv&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# SELECT * FROM pg_available_extensions WHERE name = &#39;monextension&#39;;&lt;/span&gt;&#xA;     name     | default_version | installed_version |    comment    &#xA;&lt;span class=&#34;nt&#34;&gt;--------------&lt;/span&gt;+-----------------+-------------------+---------------&#xA; monextension | 1.0             |                   | Mon extension&#xA;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1 row&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™ordre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CREATE EXTENSION&lt;/code&gt; peut Ãªtre passÃ© pour lâ€™installer et retrouver notre&#xA;fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;incremente&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;monextension&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;incremente&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;41&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;incremente&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;------------&lt;/span&gt;&#xA;         &lt;span class=&#34;mi&#34;&gt;42&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;CloudNativePG a procÃ©dÃ© Ã  la modification du paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt;&#xA;pour que lâ€™instance puisse trouver la nouvelle extension dans le volume qui&#xA;vient dâ€™Ãªtre montÃ©.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;show&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;extension_control_path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;         &lt;span class=&#34;n&#34;&gt;extension_control_path&lt;/span&gt;         &#xA;&lt;span class=&#34;c1&#34;&gt;----------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;extensions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;monextension&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;share&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette nouvelle fonctionnalitÃ© est trÃ¨s intÃ©ressante et les quelques Ã©tapes&#xA;ci-dessus montrent comment parvenir Ã  lâ€™exploiter. Lâ€™exemple est rudimentaire&#xA;certes, mais bien fonctionnel et permet Ã©galement dâ€™aborder certaines choses qui&#xA;fÃ¢chent ğŸ˜†.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;quelques-limites-tout-de-mÃªme&#34;&gt;Quelques limites tout de mÃªme&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Lâ€™ajout dâ€™extension de maniÃ¨re dÃ©clarative dans Kubernetes a des avantages.&#xA;Lâ€™avantage majeur est de ne pas devoir modifier lâ€™image principale. Elle a Ã©galement&#xA;certaines limites. Celles-ci ne discrÃ©ditent pas cette nouvelle fonctionnalitÃ©,&#xA;mais il faut en avoir conscience !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La premiÃ¨re des choses est la taille de lâ€™image. Pour cet exemple, lâ€™idÃ©e Ã©tait&#xA;dâ€™aller au plus simple et de ne pas trop se prÃ©occuper de cette notion. Mais&#xA;avouez quâ€™utiliser une image dâ€™environ 120 Mo pour ajouter deux fichiers de&#xA;quelques centaines octetsâ€¦ ğŸŒ± Ã©cologiquement ce nâ€™est pas terrible. Ã‰videmment,&#xA;la clause &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;FROM&lt;/code&gt; du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Dockerfile&lt;/code&gt; peut Ãªtre adaptÃ©e pour partir dâ€™une image &#xA;plus lÃ©gÃ¨re et, soyons honnÃªtes il sera difficile de faire pire comme exemple&#xA;avec uniquement deux fichiers texte. Ã€ garder en tÃªte tout de mÃªme.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Plus subtile cette fois-ci, je vous laisse essayer de rajouter une extension Ã &#xA;un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; dÃ©jÃ  en fonctionnement. La commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl apply -f cluster.yaml&lt;/code&gt;&#xA;renvoie bien le message &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;cluster.postgresql.cnpg.io/postgresql configured&lt;/code&gt;.&#xA;Notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; est donc mis Ã  jour, lâ€™extension est disponible. Au passage,&#xA;vous aurez remarquÃ© que lâ€™instance a Ã©tÃ© redÃ©marrÃ©e ğŸ’¥. Et oui, un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Rolling Update&lt;/code&gt;&#xA;de tous les &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pods&lt;/code&gt; liÃ©s au &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; est dÃ©clenchÃ© pour que le nouveau volume&#xA;puisse Ãªtre montÃ© sur les &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pods&lt;/code&gt;. Câ€™est une petite diffÃ©rence avec la maniÃ¨re de faire sur&#xA;un environnement virtuel ou physique. Assurez-vous que lâ€™ajout dâ€™une extension&#xA;fonctionne bien sur un environnement de test avant de le faire en production.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Avec la derniÃ¨re version de CloudNativePG, vous pouvez ajouter dynamiquement, au&#xA;dÃ©marrage des instances, de nouvelles extensions. Cette nouveautÃ©, rendue&#xA;possible par le nouveau paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;extension_control_path&lt;/code&gt; de la version 18 de&#xA;PostgreSQL et le concept dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ImageVolume&lt;/code&gt; de Kubernetes, ravira les utilisateurs&#xA;qui nâ€™auront pas Ã  modifier lâ€™image principale du conteneur.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette nouvelle maniÃ¨re de faire rendra lâ€™usage dâ€™instance PostgreSQL dans&#xA;Kubernetes plus flexible en ce qui concerne la gestion des extensions. Reste Ã &#xA;attendre que toutes fonctionnalitÃ©s deviennent stables, mais lâ€™Ã©volution est&#xA;trÃ¨s intÃ©ressante âœ¨.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[Commentaire-Blog] CloudNativePG&#34;&gt;Ã‰crivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Pourquoi mettre le pg_wal sur une partition dÃ©diÃ©e ?</title>
    <updated>2025-09-03T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-09-03://2025/09/03/partition-pg_wal.html</id>
    <link href="https://blog.dalibo.com//2025/09/03/partition-pg_wal.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Brive-la-Gaillarde, le 3 septembre 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est rÃ©guliÃ¨rement recommandÃ© de mettre le rÃ©pertoire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; de PostgreSQL sur &#xA;une partition dÃ©diÃ©e, mais quelles en sont les motivations ?&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h3 id=&#34;pourquoi-&#34;&gt;Pourquoi ?&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Le rÃ©pertoire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; contient les journaux de transactions de lâ€™instance,&#xA;appelÃ©s &lt;em&gt;WAL&lt;/em&gt; (&lt;em&gt;Write-Ahead-Log&lt;/em&gt;).&#xA;Ces journaux sont Ã©crits avant dâ€™appliquer les changements sur les donnÃ©es,&#xA;afin de garantir la durabilitÃ© des transactions et de permettre la rÃ©cupÃ©ration &#xA;en cas de problÃ¨me.&#xA;Plusieurs avantages motivent la sÃ©paration du rÃ©pertoire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; sur une partition &#xA;ou un disque distinct :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;&lt;strong&gt;Meilleure organisation et maintenanceÂ :&lt;/strong&gt; avoir son &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; sur un volume &#xA;distinct facilite la gestion et Ã©vite les erreurs de manipulation. Par exemple, on rÃ©duit &#xA;le risque de supprimer accidentellement les WAL lors dâ€™interventions sur la &#xA;partition principale de donnÃ©es. Il est Ã©galement plus simple de superviser sÃ©parÃ©ment &#xA;lâ€™espace occupÃ© par les donnÃ©es et par les journaux de transactions.&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;&lt;strong&gt;Performances I/O amÃ©liorÃ©esÂ :&lt;/strong&gt; les Ã©critures de WAL sont essentiellement &#xA;sÃ©quentielles, et un disque rÃ©servÃ© Ã  ces journaux permet de lisser les I/O sans &#xA;interfÃ©rer avec les lectures/Ã©critures alÃ©atoires des fichiers de donnÃ©es. Nâ€™espÃ©rez &#xA;cependant pas de gros gains de performances avec du matÃ©riel rÃ©cent (SSD, NVMeâ€¦).&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;&lt;strong&gt;Isolation des risques de saturationÂ :&lt;/strong&gt; sÃ©parer &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; sur une partition dÃ©diÃ©e &#xA;limite lâ€™impact dâ€™une Ã©ventuelle saturation. Si la partition principale contenant &#xA;les donnÃ©es se remplit complÃ¨tement, les nouvelles Ã©critures de donnÃ©es &#xA;deviennent impossibles (erreurs Â«Â &lt;em&gt;No space left on device&lt;/em&gt;Â Â»), mais le serveur &#xA;PostgreSQL lui-mÃªme ne sâ€™arrÃªtera pas tant que les WAL sont encore&#xA;accessibles en Ã©criture. Inversement, si câ€™est le rÃ©pertoire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; qui arrive &#xA;Ã  saturation, PostgreSQL ne peut plus effectuer aucune Ã©criture. Il stoppe alors immÃ©diatement le serveur et refuse de redÃ©marrer tant que le problÃ¨me &#xA;nâ€™est pas rÃ©solu. Il reste toujours possible de remplir le rÃ©pertoire des WAL en cas de problÃ¨me &#xA;(ex: archiveur dÃ©faillant, rÃ©plication en retard, etcâ€¦ â€“ voir plus loin). &#xA;Lâ€™avantage est que ces situations nâ€™impacteront que la partition &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; et seront &#xA;plus facilement identifiables et traitables sans compromettre le reste des donnÃ©es.&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã€ noter :&lt;/strong&gt; avoir une partition dÃ©diÃ©e pour les logs est Ã©galement une bonne pratique.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;comment&#34;&gt;CommentÂ ?&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Il faudra tout dâ€™abord faire la demande auprÃ¨s de votre administrateur systÃ¨me,&#xA;voici les informations nÃ©cessaires Ã  fournir afin dâ€™Ã©viter toute ambiguÃ¯tÃ© :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Stockage SSD de prÃ©fÃ©rence, si possible diffÃ©rent de celui contenant le rÃ©pertoire&#xA;data, afin de profiter au maximum de la parallÃ©lisation des I/O.&lt;/li&gt;&#xA;  &lt;li&gt;Formatage &lt;a href=&#34;https://public.dalibo.com/exports/formation/manuels/formations/perf1/perf1.handout.html#syst%C3%A8me-dexploitation&#34;&gt;ext4 ou XFS&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Et enfin faire le montage et donner les permissions Ã  lâ€™utilisateur postgres sur&#xA;le rÃ©pertoire, par exemple ici &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/var/lib/postgresql/pg_wal/17/main/wal&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La mise en place dâ€™une partition sÃ©parÃ©e pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; peut se faire de deux maniÃ¨resÂ :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;DÃ¨s lâ€™initialisation de lâ€™instance, vous pouvez spÃ©cifier un emplacement diffÃ©rent &#xA;pour les WAL. Par exemple, la commande dâ€™initialisation suivante crÃ©e lâ€™instance tout &#xA;en plaÃ§ant &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; Ã  lâ€™emplacement dÃ©sirÃ©Â :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-iu&lt;/span&gt; postgres /usr/lib/postgresql/17/bin/initdb &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;    &lt;span class=&#34;nt&#34;&gt;--pgdata&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/postgresql/pgdata &lt;span class=&#34;se&#34;&gt;\&lt;/span&gt;&#xA;    &lt;span class=&#34;nt&#34;&gt;--waldir&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/postgresql/pg_wal/17/main/wal&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;PostgreSQL Ã©crira alors ses journaux de transactions dans ce rÃ©pertoire dÃ©diÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est Ã©galement possible de dÃ©placer le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; dâ€™une instance dÃ©jÃ  en service, mais &#xA;cela nÃ©cessite une brÃ¨ve interruption. La procÃ©dure gÃ©nÃ©rale est :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;ArrÃªt de lâ€™instance&lt;/p&gt;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c&#34;&gt;# VÃ©rification du pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ls&lt;/span&gt; /var/lib/postgresql/17/main/pg_wal/&#xA;000000010000000000000003  000000010000000000000004  000000010000000000000005  archive_status  summaries&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# ArrÃªt de l&#39;instance&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;systemctl stop postgresql&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# VÃ©rification du bon arrÃªt de l&#39;instance&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;ps &lt;span class=&#34;nt&#34;&gt;-u&lt;/span&gt; postgres &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; f&#xA;UID          PID    PPID  C STIME TTY      STAT   TIME CMD&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;PrÃ©paration du nouveau rÃ©pertoire&lt;/p&gt;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c&#34;&gt;# CrÃ©ation du rÃ©pertoire&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /var/lib/postgresql/pg_wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Montage du rÃ©pertoire pg_wal sur la partition dÃ©diÃ©e&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;mount /dev/sdc /var/lib/postgresql/pg_wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# CrÃ©ation du sous rÃ©pertoire afin d&#39;Ã©viter de mettre les WAL Ã  la racine du point de montage&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /var/lib/postgresql/pg_wal/17/main/wal&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;DÃ©placement de lâ€™intÃ©gralitÃ© du rÃ©pertoire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; vers la nouvelle partition&lt;/p&gt;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c&#34;&gt;# Copie du contenu du pg_wal vers notre pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;rsync &lt;span class=&#34;nt&#34;&gt;-av&lt;/span&gt; /var/lib/postgresql/17/main/pg_wal/ /var/lib/postgresql/pg_wal/17/main/wal/&#xA;sending incremental file list&#xA;./&#xA;000000010000000000000003&#xA;000000010000000000000004&#xA;000000010000000000000005&#xA;archive_status/&#xA;summaries/&#xA;&#xA;sent 50,344,304 bytes  received 88 bytes  100,688,784.00 bytes/sec&#xA;total size is 50,331,648  speedup is 1.00&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# VÃ©rification que les WAL sont tous prÃ©sents&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo ls&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-la&lt;/span&gt; /var/lib/postgresql/pg_wal/17/main/wal/&#xA;total 49156&#xA;drwx------ 4 postgres postgres      141 Aug 27 05:33 &lt;span class=&#34;nb&#34;&gt;.&lt;/span&gt;&#xA;drwxr-xr-x 5 postgres postgres     4096 Aug 27 05:31 ..&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:45 000000010000000000000003&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:33 000000010000000000000004&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:33 000000010000000000000005&#xA;drwx------ 2 postgres postgres        6 Aug 26 04:47 archive_status&#xA;drwx------ 2 postgres postgres        6 Aug 26 04:47 summaries&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Renommage du rÃ©pertoire pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo mv&lt;/span&gt; /var/lib/postgresql/17/main/pg_wal /var/lib/postgresql/17/main/pg_wal_old&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;CrÃ©ation du lien symbolique et ajout des permissions&lt;/p&gt;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c&#34;&gt;# CrÃ©ation du lien symbolique reliant pg_wal vers notre pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo ln&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-s&lt;/span&gt; /var/lib/postgresql/pg_wal/17/main/wal /var/lib/postgresql/17/main/pg_wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# VÃ©rification dans le pgdata que le lien symbolique a bien Ã©tÃ© crÃ©Ã©&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ls&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-l&lt;/span&gt; /var/lib/postgresql/17/main/ | &lt;span class=&#34;nb&#34;&gt;grep &lt;/span&gt;pg_wal&#xA;lrwxrwxrwx 1 root     root       25 Aug 27 05:54 pg_wal -&amp;gt; /var/lib/postgresql/pg_wal/17/main/wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Ajout des droits Ã  l&#39;utilisateur postgres sur le rÃ©pertoire pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo chown&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-R&lt;/span&gt; postgres:postgres /var/lib/postgresql/pg_wal/17/main/wal&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo chown&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-h&lt;/span&gt; postgres:postgres /var/lib/postgresql/17/main/pg_wal&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;RedÃ©marrage de lâ€™instance&lt;/p&gt;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c&#34;&gt;# RedÃ©marrage de l&#39;instance&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;systemctl start postgresql&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# VÃ©rification que les nouveaux WAL sont crÃ©Ã©s au bon endroit&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ls&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-l&lt;/span&gt; /var/lib/postgresql/pg_wal/17/main/wal/&#xA;total 360448&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:58 000000010000000000000003&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:58 000000010000000000000004&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:59 000000010000000000000005&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:59 000000010000000000000006&#xA;&lt;span class=&#34;nt&#34;&gt;-rw-------&lt;/span&gt; 1 postgres postgres 16777216 Aug 27 05:59 000000010000000000000007&#xA;drwx------ 2 postgres postgres        6 Aug 26 04:47 archive_status&#xA;drwx------ 2 postgres postgres        6 Aug 26 04:47 summaries&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Suppression de pg_wal_old une fois le bon fonctionnement validÃ©&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo rm&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-rf&lt;/span&gt; /var/lib/postgresql/17/main/pg_wal_old&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã€ noter :&lt;/strong&gt; certains outils de sauvegarde ou de rÃ©plication pourraient ne pas &#xA;conserver le lien symbolique. Par exemple, un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_basebackup&lt;/code&gt; sur le primaire ne &#xA;recrÃ©era pas automatiquement le lien symbolique sur un secondaire, Ã  moins dâ€™utiliser &#xA;lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--waldir&lt;/code&gt; lors de la sauvegarde.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;et-si-cest-trop-tard&#34;&gt;Et si câ€™est trop tardÂ ?&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Que faire si votre instance se retrouve avec le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; saturÃ© (ou sur le point de &#xA;lâ€™Ãªtre)Â ? Voici deux approches envisageables pour rÃ©agir en urgenceÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;&lt;strong&gt;Ajouter de lâ€™espace disqueÂ :&lt;/strong&gt; la solution la plus simple et sÃ»re est dâ€™augmenter &#xA;la taille de la partition qui hÃ©berge actuellement &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt;. Si votre systÃ¨me de fichiers &#xA;ou votre environnement le permet, Ã©tendez la partition saturÃ©e pour redonner de la &#xA;marge Ã  PostgreSQL.&#xA;Le serveur pourra ainsi redÃ©marrer normalement une fois quâ€™il dispose Ã  nouveau &#xA;dâ€™espace libre, donnant le temps de traiter la cause et minimisant ainsi la coupure&#xA;de production. Cette option Ã©vite de toucher aux fichiers internes, mais nâ€™est &#xA;pas toujours possible selon le contexte (partition non extensible, pas de stockage &#xA;additionnel disponible immÃ©diatement, etcâ€¦).&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;  &lt;li&gt;&#xA;    &lt;p&gt;&lt;strong&gt;DÃ©placer le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt;Â :&lt;/strong&gt; si vous ne pouvez pas agrandir lâ€™espace disque existant, &#xA;il faut alors dÃ©placer les WAL vers un emplacement plus spacieux. &#xA;La dÃ©marche est similaire Ã  celle dÃ©crite plus haut :&lt;/p&gt;&#xA;  &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c&#34;&gt;# ArrÃªt de l&#39;instance&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;systemctl stop postgresql&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# CrÃ©ation du rÃ©pertoire&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /var/lib/postgresql/pg_wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Montage du rÃ©pertoire pg_wal sur la partition dÃ©diÃ©e&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;mount /dev/sdc /var/lib/postgresql/pg_wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# CrÃ©ation du sous rÃ©pertoire&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo mkdir&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-p&lt;/span&gt; /var/lib/postgresql/pg_wal/17/main/wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Copie du contenu du pg_wal vers notre pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;rsync &lt;span class=&#34;nt&#34;&gt;-av&lt;/span&gt; /var/lib/postgresql/17/main/pg_wal/ /var/lib/postgresql/pg_wal/17/main/wal/&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Renommage du rÃ©pertoire pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo mv&lt;/span&gt; /var/lib/postgresql/17/main/pg_wal /var/lib/postgresql/17/main/pg_wal_old&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# CrÃ©ation du lien symbolique reliant pg_wal vers notre pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo ln&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-s&lt;/span&gt; /var/lib/postgresql/pg_wal/17/main/wal /var/lib/postgresql/17/main/pg_wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Ajout des droits Ã  l&#39;utilisateur postgres sur le rÃ©pertoire pg_wal&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo chown&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-R&lt;/span&gt; postgres:postgres /var/lib/postgresql/pg_wal/17/main/wal&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo chown&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-h&lt;/span&gt; postgres:postgres /var/lib/postgresql/17/main/pg_wal&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# RedÃ©marrage de l&#39;instance&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo &lt;/span&gt;systemctl start postgresql&#xA;&#xA;&lt;span class=&#34;c&#34;&gt;# Suppression de l&#39;ancien rÃ©pertoire&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;sudo rm&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-rf&lt;/span&gt; /var/lib/postgresql/17/main/pg_wal_old&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Cette manipulation permet de relancer rapidement le service afin de traiter le &#xA;problÃ¨me ensuite. Veillez Ã  ne pas perdre de WAL en route, sous peine de compromettre &#xA;la capacitÃ© de rÃ©cupÃ©ration. Nâ€™oubliez pas dans tous les cas de corriger la &#xA;cause de fond de la saturation (reprise dâ€™un archivage interrompu, nettoyage &#xA;des slots de rÃ©plication obsolÃ¨tes, etcâ€¦).&#xA;Il est prÃ©fÃ©rable de se prÃ©parer en amont afin dâ€™Ã©viter le recours Ã  ce&#xA;genre de solutions exÃ©cutÃ©es en urgence et sous pression.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;exemples-rencontrÃ©s-au-support&#34;&gt;Exemples rencontrÃ©s au support&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Enfin, voici quelques cas rÃ©els, observÃ©s au support, car Ã§a nâ€™arrive pas quâ€™aux autresÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;strong&gt;Un ordre â€œCREATE TABLE ASâ€&lt;/strong&gt; qui a gÃ©nÃ©rÃ© &lt;strong&gt;330 Go&lt;/strong&gt; de WAL. Lâ€™instance a subi &#xA;&lt;strong&gt;quatre interruptions sur la journÃ©e.&lt;/strong&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;Espace insuffisant pour VACUUM FULL&lt;/strong&gt;, il faut normalement prÃ©voir le double dâ€™espace pris&#xA;par la table concernÃ©e. Le VACUUM FULL a saturÃ© lâ€™espace disque, arrÃªtant net&#xA;lâ€™instance sans possibilitÃ© de la remettre en marche avant lâ€™ajout dâ€™espace disque&#xA;par lâ€™administrateur systÃ¨me. La recherche et la suppression des â€œfichiers orphelinsâ€&#xA;gÃ©nÃ©rÃ©s par lâ€™arrÃªt brutal du VACUUM FULL sont chronophages et risquÃ©es.&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;Processus &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;archiver&lt;/code&gt; en erreur suite Ã  une diffÃ©rence de version pgbackrest.&lt;/strong&gt; Une&#xA;mise Ã  jour avait Ã©tÃ© effectuÃ©e sur le primaire, mais pas sur le serveur dâ€™archivage,&#xA;aboutissant Ã  une accumulation de &lt;strong&gt;100 Go&lt;/strong&gt; de WAL.&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;Suite Ã  un VACUUM FREEZE non effectuÃ© aprÃ¨s une grosse restauration&lt;/strong&gt;, lâ€™autovacuum&#xA;a fini par geler de force un grand nombre de lignes, ralentissant le systÃ¨me, ce&#xA;qui a gÃ©nÃ©rÃ© un total de &lt;strong&gt;600 Go&lt;/strong&gt; de WAL.&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;Un archivage qui a dÃ©crochÃ© suite Ã  un retard impossible Ã  rattraper&lt;/strong&gt;, gÃ©nÃ©rant&#xA;&lt;strong&gt;200 Go&lt;/strong&gt; de WAL par heure. En dernier recours, arrÃªt de lâ€™archivage en passant le &#xA;paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;archive_command&lt;/code&gt; Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/bin/true&lt;/code&gt; alors quâ€™il restait 5 Go dâ€™espace disque. &#xA;Cette manipulation entraÃ®ne obligatoirement la reconstruction du secondaire.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Les exemples sont nombreux, les causes diverses : de lâ€™erreur de manipulation au&#xA;VACUUM qui rattrape un retard, en passant par le serveur dâ€™archivage injoignable.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;a-retenir&#34;&gt;A retenir&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Placer le rÃ©pertoire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; sur une partition dÃ©diÃ©e est une bonne pratique pour la &#xA;plupart des installations : cela amÃ©liore la rÃ©silience et peut apporter un gain de &#xA;performance dans certains cas. Il convient toutefois de dimensionner &#xA;correctement toutes les partitions (donnÃ©es, WAL, et logs), de surveiller leur taux &#xA;dâ€™occupation (supervision), et dâ€™anticiper les opÃ©rations lourdes. La sÃ©paration &#xA;du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_wal&lt;/code&gt; Ã©vite bien des scÃ©narios catastrophiques oÃ¹ PostgreSQL sâ€™arrÃªte &#xA;pour protÃ©ger lâ€™intÃ©gritÃ© des donnÃ©es. Avec une bonne architecture de stockage &#xA;et une supervision proactive, on se donne toutes les chances dâ€™Ã©viter ces interruptions &#xA;de service liÃ©es Ã  lâ€™espace disque.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Installer pglift et dÃ©ployer sa premiÃ¨re instance PostgreSQL</title>
    <updated>2025-08-28T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-08-28://2025/08/28/installation_pglift.html</id>
    <link href="https://blog.dalibo.com//2025/08/28/installation_pglift.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Paris, le 28 aoÃ»t 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ceci est le second article dans la sÃ©rie sur lâ€™industrialisation de PostgreSQL.&#xA;Nous allons voir dans celui-ci comment installer &lt;em&gt;pglift&lt;/em&gt; et les composants&#xA;additionnels requis. Nous allons ensuite dÃ©ployer une instance accompagnÃ©e dâ€™un&#xA;exporter &lt;em&gt;prometheus&lt;/em&gt; pour sa supervision.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;pglift&lt;/em&gt; est le composant au cÅ“ur de la plateforme, il permet le dÃ©ploiement&#xA;industriel des instances. Il peut Ãªtre manipulÃ© en ligne de commande, ou par le&#xA;biais dâ€™un module &lt;em&gt;Ansible&lt;/em&gt;, ce qui sera la mÃ©thode favorisÃ©e dans le reste de cet&#xA;article.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h1 id=&#34;installation-de-pglift-postgresql-et-ses-outils-satellites&#34;&gt;Installation de pglift, PostgreSQL et ses outils satellites&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Lâ€™outil &lt;em&gt;pglift&lt;/em&gt;, dÃ©veloppÃ© en Python, requiert une version 3.10 ou plus de Python sous &#xA;une distribution Linux. Quant Ã  PostgreSQL, la version officielle est supportÃ© sur &#xA;plusieurs distributions Linux (Debian, Red Hat/Rocky, Ubuntuâ€¦).&#xA;Lâ€™installation prÃ©sentÃ©e ici sera rÃ©alisÃ© Ã  lâ€™aide dâ€™&lt;em&gt;Ansible&lt;/em&gt; et des collections&#xA;Dalibo publiques sur une machine virtuelle &lt;em&gt;Rocky Linux 9&lt;/em&gt;. Cela nÃ©cessite donc quelques &#xA;prÃ©requis Ã  installer sur cette machine virtuelle.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;prÃ©requis&#34;&gt;PrÃ©requis&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Sur le nÅ“ud managÃ© :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Python &amp;gt;=3.10&lt;/li&gt;&#xA;  &lt;li&gt;Une connexion SSH sur un utilisateur avec les droits &lt;em&gt;sudo&lt;/em&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Sur le nÅ“ud de contrÃ´le &lt;em&gt;Ansible&lt;/em&gt; :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Ansible Core &amp;gt;=2.13.0&lt;/li&gt;&#xA;  &lt;li&gt;Python &amp;gt;=3.9&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;De plus, il est nÃ©cessaire dâ€™installer les collections &lt;em&gt;Ansible&lt;/em&gt; sur le nÅ“ud de contrÃ´le&#xA;qui seront utilisÃ©s au sein des playbooks. Pour faciliter lâ€™installation des diffÃ©rentes &#xA;collections, nous allons les consigner au sein dâ€™un fichier :&lt;/p&gt;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;$ cat requirements.yaml&#xA;collections:&#xA;  - dalibo.pglift&#xA;  - dalibo.essential&#xA;  - dalibo.extras&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Puis procÃ©der Ã  lâ€™installation avec la commande suivante :&lt;/p&gt;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;ansible-galaxy &lt;span class=&#34;nb&#34;&gt;install&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-r&lt;/span&gt; requirements.yaml &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h2 id=&#34;le-fichier-dinventaire&#34;&gt;Le fichier dâ€™inventaire&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Dans lâ€™exemple de cet article, lâ€™inventaire &lt;em&gt;Ansible&lt;/em&gt; sera relativement simple Ã©tant&#xA;donnÃ© que nous allons dÃ©ployer &lt;em&gt;pglift&lt;/em&gt; et PostgreSQL au sein dâ€™une seule machine &#xA;virtuelle :&lt;/p&gt;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;$ cat inventory &#xA;srv-pg1 ansible_host=192.168.122.19 ansible_user=ansible&#xA;&#xA;[database]&#xA;srv-pg1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous ajoutons donc notre hÃ´te &lt;em&gt;srv-pg1&lt;/em&gt; dans un groupe nommÃ© &lt;em&gt;database&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;un-playbook-simple&#34;&gt;Un playbook simple&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple de playbook simple pour la partie installation (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;setup.yaml&lt;/code&gt;):&lt;/p&gt;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Install Repos, pglift and PostgreSQL&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;database&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;gather_facts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;vars&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;postgresql_major_version&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;pglift_lingering_mode&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;pglift_configure_shell_completion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;pglift_settings_content&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;systemd&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;pi&#34;&gt;{}&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;postgresql&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;default_version&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;17&#39;&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;datadir&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;/var/lib/pgsql/{version}/{name}/data&#39;&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;waldir&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;/var/lib/pgsql/{version}/{name}/wal&#39;&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;pre_tasks&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Ensure the crb repository is enabled&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;community.general.dnf_config_manager&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;crb&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;enabled&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;roles&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo.extras.repo_epel&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo.extras.repo_dalibo_labs&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo.essential.repo_pgdg&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo.essential.postgresql&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo.essential.prometheus_postgres_exporter&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo.essential.pglift&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Avec ce playbook, le groupe dâ€™hÃ´tes &lt;em&gt;database&lt;/em&gt; est ciblÃ©. Plusieurs rÃ´les seront &#xA;alors exÃ©cutÃ©s afin dâ€™installer les dÃ©pÃ´ts de paquets nÃ©cessaires Ã  lâ€™installation &#xA;de PostgreSQL et quelques outils satellites.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par la suite, lâ€™installation de PostgreSQL et de lâ€™exporter prometheus &lt;em&gt;postgres-exporter&lt;/em&gt; &#xA;est rÃ©alisÃ©e Ã  lâ€™aide du rÃ´le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.essential.postgresql&lt;/code&gt; et &#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.essential.prometheus_postgres_exporter&lt;/code&gt;. La version de PostgreSQL est dÃ©terminÃ©e&#xA;par la variable Ansible &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql_major_version&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le rÃ´le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.essential.pglift&lt;/code&gt; se chargera dâ€™installer &lt;em&gt;pglift&lt;/em&gt;, en utilisant pip &#xA;et dâ€™appliquer une configuration initiale. Cette configuration est assurÃ©e par la variable &#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift_settings_content&lt;/code&gt;, au format &lt;em&gt;YAML&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous pouvons dÃ©sormais exÃ©cuter ce playbook avec lâ€™inventaire crÃ©Ã© prÃ©cÃ©demment :&lt;/p&gt;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;ansible-playbook &lt;span class=&#34;nt&#34;&gt;-i&lt;/span&gt; inventory setup.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ã€ la fin de cette exÃ©cution, nous pourrons alors dÃ©ployer notre premiÃ¨re instance&#xA;Ã  lâ€™aide du module &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift.instance&lt;/code&gt; de la collection &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;dÃ©ploiement-de-linstance-avec-le-module-ansible-pglift&#34;&gt;DÃ©ploiement de lâ€™instance avec le module Ansible pglift&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Maintenant que &lt;em&gt;pglift&lt;/em&gt; est installÃ© et configurÃ©, il est possible de dÃ©ployer des instances.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le dÃ©ploiement de lâ€™instance PostgreSQL peut se faire Ã  lâ€™aide dâ€™un playbook. &#xA;Celui-ci appelle le module &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift.instance&lt;/code&gt; dans une tÃ¢che Ã  destination&#xA;de notre groupe dâ€™hÃ´tes &lt;em&gt;database&lt;/em&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Deploy PostgreSQL instance&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;database&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_user&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgres&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_flags&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;-i&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Instance main&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dalibo.pglift.instance&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;main&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;5432&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;settings&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;1GB&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;roles&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;alice&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;login&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;databases&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;db1&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;alice&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Contrairement au playbook dâ€™installation qui contenait seulement une clause &#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;become: true&lt;/code&gt;, ce playbook contient Ã©galement la clause &#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;become_user: postgres&lt;/code&gt; pour spÃ©cifier que les actions sont Ã  exÃ©cuter en tant &#xA;que &lt;em&gt;postgres&lt;/em&gt; sur le serveur. On ajoute Ã©galement &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;become_flags: &#34;-i&#34;&lt;/code&gt; pour&#xA;que le &lt;em&gt;PATH&lt;/em&gt; de lâ€™utilisateur postgres soit bien chargÃ© lors de lâ€™exÃ©cution, &#xA;ce qui permet de sâ€™assurer de la disponibilitÃ© du binaire de &lt;em&gt;pglift&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le module accepte des options de configuration pour PostgreSQL. Ici, nous &#xA;configurons un cache disque (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt;) de 1GB.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est Ã©galement possible de crÃ©er des rÃ´les et bases de donnÃ©es dÃ¨s le &#xA;dÃ©ploiement de lâ€™instance en les spÃ©cifiant lors de lâ€™appel du module. La base &#xA;de donnÃ©es &lt;em&gt;db1&lt;/em&gt; et le rÃ´le &lt;em&gt;alice&lt;/em&gt; sont ainsi crÃ©Ã©s sur notre instance sans &#xA;action supplÃ©mentaire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;ExÃ©cuter le playbook pour procÃ©der au dÃ©ploiement de lâ€™instance :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;ansible-playbook &lt;span class=&#34;nt&#34;&gt;-i&lt;/span&gt; inventory instance_main.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Depuis le serveur PostgreSQL, en tant que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;, on peut vÃ©rifier la prÃ©sence&#xA;de notre nouvelle instance :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-shell highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;postgres@srv-pg1 ~]&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance list&#xA;â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”“&#xA;â”ƒ name â”ƒ version â”ƒ port â”ƒ datadir                     â”ƒ status  â”ƒ&#xA;â”¡â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”©&#xA;â”‚ main â”‚ 17      â”‚ 5432 â”‚ /var/lib/pgsql/17/main/data â”‚ running â”‚&#xA;â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;Pour obtenir une instance similaire avec lâ€™interface de ligne de commande&#xA;de &lt;em&gt;pglift&lt;/em&gt;, on aurait exÃ©cutÃ© les commandes suivantes :&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;div class=&#34;language-shell highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance create main &lt;span class=&#34;nt&#34;&gt;--port&lt;/span&gt; 5432&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift pgconf &lt;span class=&#34;nb&#34;&gt;set &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1GB&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift role create alice &lt;span class=&#34;nt&#34;&gt;--login&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database create db1 &lt;span class=&#34;nt&#34;&gt;--owner&lt;/span&gt; alice&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h1 id=&#34;administration-de-linstance-postgresql&#34;&gt;Administration de lâ€™instance PostgreSQL&lt;/h1&gt;&#xA;&#xA;&lt;h2 id=&#34;gestion-de-lÃ©tat-de-linstance&#34;&gt;Gestion de lâ€™Ã©tat de lâ€™instance&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Pour arrÃªter, dÃ©marrer, ou redÃ©marrer lâ€™instance via &lt;em&gt;Ansible&lt;/em&gt;, on peut jouer sur&#xA;la clause &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;state&lt;/code&gt; du module &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift.instance&lt;/code&gt;. Pour un Ã©tat arrÃªtÃ©,&#xA;on lui passe la valeur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;stopped&lt;/code&gt;. Pour lâ€™Ã©tat dÃ©marrÃ©, la valeur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;started&lt;/code&gt;. Enfin,&#xA;pour la redÃ©marrer, la valeur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;restarted&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ainsi, Ã  chaque exÃ©cution du playbook suivant, lâ€™instance est redÃ©marÃ©e :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Deploy PostgreSQL instance&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;database&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;gather_facts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_flags&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;-i&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_user&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgres&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Instance main&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dalibo.pglift.instance&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;main&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;5432&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;settings&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;1GB&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;roles&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;alice&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;login&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;databases&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;db1&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;alice&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;restarted&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;En ligne de commande, la gestion dâ€™Ã©tat se fait avec les commandes &lt;em&gt;pglift&lt;/em&gt; suivantes :&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;div class=&#34;language-shell highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance stop main&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance start main&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift instance restart main&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h2 id=&#34;gestion-du-paramÃ¨trage&#34;&gt;Gestion du paramÃ¨trage&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Pour faire Ã©voluer le paramÃ©trage de lâ€™instance avec &lt;em&gt;Ansible&lt;/em&gt;, il est possible de&#xA;modifier la configuration dans notre playbook, et le re-exÃ©cuter.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ainsi, le playbook suivant peut Ãªtre exÃ©cutÃ© pour modifier la valeur du cache&#xA;disque (&lt;em&gt;shared_buffers&lt;/em&gt;), tout en dÃ©finissant une valeur pour &lt;em&gt;work_mem&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Deploy PostgreSQL instance&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;database&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;gather_facts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_flags&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;-i&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_user&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgres&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Instance main&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dalibo.pglift.instance&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;main&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;5432&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;settings&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;500MB&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;work_mem&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20MB&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;roles&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;alice&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;login&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;databases&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;db1&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;alice&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;restarted&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous conservons la clause &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;state: restarted&lt;/code&gt; ajoutÃ©e Ã  lâ€™Ã©tape prÃ©cÃ©dente, ici&#xA;elle nous rend mÃªme service. En effet, le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt; nÃ©cessite un&#xA;redÃ©marrage de lâ€™instance pour Ãªtre pris en compte. Lors de lâ€™exÃ©cution de ce playbook&#xA;ainsi modifiÃ©, lâ€™instance est redÃ©marrÃ©e aprÃ¨s la mise Ã  jour des paramÃ¨tres.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;AprÃ¨s lâ€™exÃ©cution du playbook, la nouvelle valeur pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt; est donc&#xA;directement effective, en plus de celle du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;work_mem&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@~=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;show&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;shared_buffers&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;----------------&lt;/span&gt;&#xA; &lt;span class=&#34;mi&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@~=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;show&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;work_mem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;work_mem&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;----------&lt;/span&gt;&#xA; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;En ligne de commande, la modification des paramÃ¨tres se fait avec la commande&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pglift pgconf&lt;/code&gt;, de la faÃ§on suivante :&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;div class=&#34;language-shell highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift pgconf &lt;span class=&#34;nb&#34;&gt;set &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;work_mem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;20MB&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift pgconf &lt;span class=&#34;nb&#34;&gt;set &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;shared_buffers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;500MB&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;Lorsque le paramÃ¨tre modifiÃ© peut Ãªtre pris en compte Ã  chaud, la configuration&#xA;de lâ€™instance est simplement rechargÃ©e, mais lorsque le paramÃ¨tre nÃ©cessite&#xA;un redÃ©marrage, comme par exemple le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt;, la commande propose de&#xA;redÃ©marrer lâ€™instance via un prompt interactif :&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;$ pglift pgconf set shared_buffers=500MB;&#xA;INFO     configuring PostgreSQL&#xA;WARNING  instance 17/main needs restart due to parameter changes: shared_buffers&#xA;&amp;gt; PostgreSQL needs to be restarted; restart now? [y/n] (n): y&#xA;INFO     restarting systemd unit pglift-postgresql@17-main.service&#xA;shared_buffers: 1GB -&amp;gt; 500MB&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h3 id=&#34;bases-de-donnÃ©es-et-rÃ´les&#34;&gt;Bases de donnÃ©es et rÃ´les&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nous avons vu que le module &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift.instance&lt;/code&gt; Ã©tait capable&#xA;de dÃ©ployer pour nous des bases de donnÃ©es et rÃ´les lors de la crÃ©ation dâ€™instance. On&#xA;pourrait imaginer gÃ©rer ces derniers dans le playbook de crÃ©ation dâ€™instance,&#xA;mais &lt;em&gt;pglift&lt;/em&gt; fournit aussi des modules dÃ©diÃ©s Ã  la gestion des bases de donnÃ©es&#xA;(&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift.database&lt;/code&gt;) et des rÃ´les (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo.pglift.role&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est ainsi possible dâ€™Ã©xecuter le playbook suivant pour ajouter un rÃ´le &lt;em&gt;bob&lt;/em&gt;&#xA;et la base de donnÃ©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;db2&lt;/code&gt;, dont il sera propriÃ©taire, et qui sera initalisÃ©e&#xA;avec un schÃ©ma &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;s1&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Deploy role and database&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;database&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;gather_facts&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_flags&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;-i&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;become_user&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgres&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Role bob&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dalibo.pglift.role&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;bob&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;instance&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;main&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;login&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;createdb&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Database db2&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dalibo.pglift.database&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;db2&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;instance&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;main&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;bob&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;schemas&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s1&lt;/span&gt;&#xA;            &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;bob&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;En ligne de commande, il est possible de crÃ©er des rÃ´les et bases de donnÃ©es&#xA;avec les commandes suivantes :&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;div class=&#34;language-shell highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift role create bob &lt;span class=&#34;nt&#34;&gt;--login&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--createdb&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;$ &lt;/span&gt;pglift database create db2 &lt;span class=&#34;nt&#34;&gt;--owner&lt;/span&gt; bob &lt;span class=&#34;nt&#34;&gt;--schema&lt;/span&gt; s1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h1 id=&#34;ressources-utiles&#34;&gt;Ressources utiles&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Pour aller plus loin dans lâ€™utilisation de &lt;em&gt;pglift&lt;/em&gt; et des collections &lt;em&gt;Ansible&lt;/em&gt;, &#xA;voici une sÃ©lection de ressources :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://pglift.readthedocs.io/en/latest/&#34;&gt;Documentation de &lt;em&gt;pglift&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://galaxy.ansible.com/ui/namespaces/dalibo/&#34;&gt;Collections Ansible Dalibo&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://labs.dalibo.com/&#34;&gt;Dalibo Labs&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Dâ€™autres fonctionnalitÃ©s utiles de &lt;em&gt;pglift&lt;/em&gt; seront Ã©galement abordÃ©es dans cette serie&#xA;dâ€™article sur lâ€™industrialisation de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&#xA;&lt;p&gt;Avec lâ€™aide des collections &lt;em&gt;Ansible&lt;/em&gt; ainsi que du module &lt;em&gt;pglift&lt;/em&gt;, lâ€™installation &#xA;et la configuration dâ€™une instance PostgreSQL sont simplifiÃ©es et intÃ©grables dans &#xA;une dÃ©marche dâ€™industrialisation. &#xA;Avec quelques fichiers dÃ©claratifs et une commande &lt;em&gt;Ansible&lt;/em&gt;, on obtient une instance&#xA;avec ses bases de donnÃ©es et rÃ´les, fonctionnelle tout en suivant les bonnes pratiques.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ce second article est une introduction Ã  lâ€™utilisation de &lt;em&gt;pglift&lt;/em&gt;. Les prochains &#xA;articles couvriront des sujets plus avancÃ©s comme la sauvegarde logique ou physique,&#xA;la supervision ou encore la haute-disponibilitÃ©.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>La double vie de default_statistics_target</title>
    <updated>2025-07-25T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-07-25://2025/07/25/statistics-target.html</id>
    <link href="https://blog.dalibo.com//2025/07/25/statistics-target.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Mont de Marsan, le 25 juillet 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans &lt;a href=&#34;https://blog.dalibo.com/2024/12/13/10000x_plus_rapide.html&#34;&gt;un prÃ©cÃ©dent&#xA;article&lt;/a&gt;, je vous&#xA;illustrais Ã  quel point la justesse des statistiques sur les donnÃ©es Ã©tait&#xA;critique pour la performance de vos requÃªtes. IntÃ©ressons-nous aujourdâ€™hui au&#xA;paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;default_statistics_target&lt;/code&gt; et regardons comment il peut nous aider Ã &#xA;amÃ©liorer les performances de nos requÃªtes grÃ¢ce Ã  des statistiques plus&#xA;prÃ©cises.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/portrait_alain2.png&#34; alt=&#34;Alain Lesage&#34; style=&#34;float: right; padding:10px; width:120px;&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;le-principe&#34;&gt;Le principe&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour obtenir les meilleurs plans dâ€™exÃ©cution possibles, PostgreSQL a besoin de savoir&#xA;combien de blocs de donnÃ©es devront Ãªtre lus et quelle est la probabilitÃ© de trouver&#xA;les donnÃ©es en mÃ©moire dans les caches systÃ¨me et PostgreSQL (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_buffers&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;!-- Ã©lagage &#xA;Cette estimation est faite (grossiÃ¨rement) Ã &#xA;l&#39;aide du paramÃ¨tre&#xA;[`effective_cache_size`](https://postgresqlco.nf/doc/fr/param/effective_cache_size/),&#xA;qui permet d&#39;indiquer Ã  l&#39;optimiseur la taille cumulÃ©e des deux caches. &#xA;--&gt;&#xA;&#xA;&lt;p&gt;Pour connaÃ®tre la quantitÃ© de donnÃ©es concernÃ©e par chaque requÃªte, PostgreSQL&#xA;doit savoir quelle est la taille de chaque ligne et combien de lignes sont &#xA;remontÃ©es. Il est nÃ©cessaire pour cela de se rÃ©fÃ©rer au&#xA;type des colonnes â€“ un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;numeric&lt;/code&gt; pÃ¨se &lt;em&gt;a priori&lt;/em&gt; moins lourd quâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;text&lt;/code&gt; ou&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;jsonb&lt;/code&gt; â€“ ainsi quâ€™Ã  la rÃ©partition des valeurs dans les colonnes. &lt;!--, pour savoir&#xA;combien de lignes sont concernÃ©es par une clause `WHERE`. --&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;lÃ©chantillonnage&#34;&gt;Lâ€™Ã©chantillonnage&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour ce faire, nul besoin de mesurer chacune des lignes de chacune des tables.&#xA;Un Ã©chantillon assez grand pris alÃ©atoirement&#xA;est suffisamment reprÃ©sentatif de lâ€™ensemble. PostgreSQL se base sur &lt;a href=&#34;https://sigmodrecord.org/publications/sigmodRecord/9806/pdfs/276305.276343.pdf&#34;&gt;cette&#xA;publication&lt;/a&gt;&#xA;de Surajit Chaudhuri, Rajeev Motwani et Vivek Narasayya &lt;em&gt;â€œRandom sampling for&#xA;histogram construction: how much is enough?â€&lt;/em&gt; de 1998 pour dÃ©terminer combien de&#xA;lignes suffisent Ã  construire cet Ã©chantillon.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les dÃ©veloppeurs se sont appuyÃ©s sur cette Ã©tude qui montre quâ€™il suffit de&#xA;prendre environ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;300 Ã— k lignes&lt;/code&gt;, oÃ¹ &lt;em&gt;k&lt;/em&gt; est la Â« cible statistiques Â» de&#xA;la table, dÃ©finie globalement par le&#xA;paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;default_statistics_target&lt;/code&gt;. Cette valeur est codÃ©e en dur&#xA;Ã  plusieurs endroits du code source de&#xA;&lt;a href=&#34;https://github.com/postgres/postgres/blob/master/src/backend/commands/analyze.c&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;analyze.c&lt;/code&gt;&lt;/a&gt;Â :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-c highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;std_typanalyze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VacAttrStats&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;â€¦&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minrows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attstattarget&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;â€¦&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On comprend que la taille minimale de lâ€™Ã©chantillon est donc de 300 fois la&#xA;valeur de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;default_statistics_target&lt;/code&gt;.&#xA;PostgreSQL utilise donc par dÃ©faut un Ã©chantillon de &lt;strong&gt;30Â 000 lignes&lt;/strong&gt; pour&#xA;calculer ses statistiquesÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SHOW&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;default_statistics_target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;-- nous avons bien la valeur par dÃ©faut&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;default_statistics_target&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;---------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ligne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;VERBOSE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;matable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;-- confirmation de la taille de l&#39;Ã©chantillon &lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;INFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;analyzing&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.matable&#34;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;-- &#34;30000 rows in sample&#34; ci-dessous&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;INFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;&#34;matable&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scanned&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7280&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7280&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;containing&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;990000&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;live&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dead&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30000&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sample&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;990000&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;estimated&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;Temps&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;376&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;310&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h3 id=&#34;la-rÃ©solution&#34;&gt;La rÃ©solution&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Pour chaque colonne&lt;/strong&gt;, PostgreSQL calcule un certain nombre de statistiques.&#xA;Elles peuvent Ãªtre consultÃ©es dans la vue&#xA;&lt;a href=&#34;https://docs.postgresql.fr/current/view-pg-stats.html&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stats&lt;/code&gt;&lt;/a&gt;. Deux&#xA;dâ€™entre elles, la liste des &lt;strong&gt;&lt;em&gt;most common values&lt;/em&gt;&lt;/strong&gt; (MCV) et&#xA;lâ€™&lt;strong&gt;histogramme&lt;/strong&gt; de valeur sont particuliÃ¨rement importantes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple, une liste MCV pour une colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;prix&lt;/code&gt; dâ€™une table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;produit&lt;/code&gt; pourrait avoir&#xA;cette formeÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;most_common_vals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;most_common_freqs&lt;/span&gt; &#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stats&lt;/span&gt; &#xA;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;prix&#39;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gx&lt;/span&gt;&#xA;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RECORD&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-----+----------------------------------&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;most_common_vals&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;19&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;49&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;most_common_freqs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;047&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;03&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces cinq prix sont les plus frÃ©quents dans la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;prix&lt;/code&gt;. 30 % des valeurs sont&#xA;Ã©gales Ã  4,99 et 3 % Ã©gales Ã  49,99.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour illustrer la notion dâ€™histogramme, on peut considÃ©rer une colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;poids&lt;/code&gt;&#xA;dâ€™une table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;produit&lt;/code&gt;Â :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;histogram_bounds&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stats&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;poids&#39;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gx&lt;/span&gt;&#xA;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RECORD&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;----+---------------------------&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;histogram_bounds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;600&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Avec ces 6 bornes, notre histogramme dispose de 5 intervalles. Lâ€™Ã©cart entre les&#xA;bornes est ajustÃ© afin que chaque intervalle corresponde sensiblement au mÃªme&#xA;nombre de lignes. Il y a donc environ autant de produits dont le poids est&#xA;compris entre 0 et 30 g que de produits compris entre 1 et 10 kg.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Mais quelle est la bonne quantitÃ© de valeurs frÃ©quentes Ã  retenir pour la liste&#xA;MCV ? Et combien dâ€™intervalles doit comporter notre histogramme calculÃ© pour les&#xA;valeurs scalaires ? En regardant dans les fonctions &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;compute_distinct_stats()&lt;/code&gt; et&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;compute_scalar_stats()&lt;/code&gt;, nous observons ces initialisations :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-c highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c1&#34;&gt;// dans compute_distinct_stats()&lt;/span&gt;&#xA;&#x9;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&#x9;&#x9;&lt;span class=&#34;n&#34;&gt;num_mcv&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attstattarget&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;c1&#34;&gt;// dans compute_scalar_stats()&lt;/span&gt;&#xA;&#x9;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&#x9;&#x9;&lt;span class=&#34;n&#34;&gt;num_mcv&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attstattarget&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&#x9;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&#x9;&#x9;&lt;span class=&#34;n&#34;&gt;num_bins&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attstattarget&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous constatons que câ€™est de nouveau le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;default_statistics_target&lt;/code&gt;&#xA;qui est utilisÃ©. Par dÃ©faut, pour chaque colonne de chaque table, la liste MCV&#xA;comportera donc jusquâ€™Ã  100 valeurs, et lâ€™histogramme aura 100 intervalles.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;strong&gt;cible statistique&lt;/strong&gt; sert aussi et surtout Ã  indiquer une rÃ©solution pour les statistiques,&#xA;suffisamment Ã©levÃ©e pour quâ€™elles soient prÃ©cises et utiles, sans trop lâ€™Ãªtre pour&#xA;ne pas pÃ©naliser le calcul par &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;un-paramÃ¨tre-deux-fonctions&#34;&gt;Un paramÃ¨tre, deux fonctions&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nous voyons donc que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;default_statistics_target&lt;/code&gt; a deux fonctions distinctes dans&#xA;la collecte des statistiques par &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;, une pour la taille de lâ€™Ã©chantillon,&#xA;une autre pour la rÃ©solution de certaines statistiques, listes MCV et&#xA;histogrammes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les Ã©tudes nous ont montrÃ© quâ€™augmenter la taille de lâ€™Ã©chantillon nâ€™apporte que&#xA;peu dâ€™information supplÃ©mentaire Ã  partir dâ€™un certain seuil. En revanche, la&#xA;rÃ©solution des statistiques peut parfois Ãªtre insuffisante, surtout pour&#xA;lâ€™histogramme, quand on a des valeurs avec une distribution peu rÃ©guliÃ¨re, voire erratique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;GrÃ¢ce Ã  un histogramme plus fin, lâ€™optimiseur pourra se rendre compte que&#xA;certains filtres sont plus sÃ©lectifs et ajuster le plan dâ€™exÃ©cution en &#xA;consÃ©quence.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;exemple&#34;&gt;Exemple&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;ConsidÃ©rons la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;mesure&lt;/code&gt; suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;     &lt;span class=&#34;nb&#34;&gt;SERIAL&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;INT&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;idx_valeura&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;idx_valeurb&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;puis insÃ©rons quelques donnÃ©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c1&#34;&gt;-- insertion de 1000 lignes de 1 Ã  1000&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-- dans un ordre alÃ©atoire&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;c1&#34;&gt;-- insertion de 999000 lignes d&#39;entiers&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-- entre 1 et 1000 concentrÃ© autour des &lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-- multiples de 10&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;999000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&#xA;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;floor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;floor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ici, nous avons insÃ©rÃ© des nombres entiers concentrÃ©s sur les dizaines, avec trÃ¨s&#xA;peu de valeurs entre :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;floor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;  &#xA;&lt;span class=&#34;c1&#34;&gt;--------&lt;/span&gt;&#xA; &lt;span class=&#34;mi&#34;&gt;990200&lt;/span&gt;&#xA;&#xA; &lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;floor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;------&lt;/span&gt;&#xA;  &lt;span class=&#34;mi&#34;&gt;800&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ligne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous dÃ©finissons une cible statistique de 100 pour la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;valeur_a&lt;/code&gt; et de 1000 pour&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;valeur_b&lt;/code&gt;. Ceci nous permettra de voir lâ€™impact de la rÃ©solution de lâ€™histogramme entre &#xA;100 et 1000 intervalles.&lt;/p&gt;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLUMN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;STATISTICS&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLUMN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;STATISTICS&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ã€ noter que la taille dâ€™Ã©chantillon sera de &lt;strong&gt;300Â 000&lt;/strong&gt; lignes dans les deux casÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;VERBOSE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;INFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;analyzing&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.mesure&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;INFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nv&#34;&gt;&#34;mesure&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scanned&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5406&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5406&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;containing&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000000&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;live&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dead&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300000&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sample&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000000&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;estimated&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous pouvons vÃ©rifier la taille des histogrammes :&lt;/p&gt;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;n&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;array_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;histogram_bounds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stats&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;valeur_a&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;array_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;histogram_bounds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stats&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attname&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;valeur_b&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;array_length&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;--------------&lt;/span&gt;&#xA;          &lt;span class=&#34;mi&#34;&gt;101&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ligne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA; &lt;span class=&#34;n&#34;&gt;array_length&lt;/span&gt; &#xA;&lt;span class=&#34;c1&#34;&gt;--------------&lt;/span&gt;&#xA;          &lt;span class=&#34;mi&#34;&gt;252&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ligne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le premier comporte bien 100 intervalles, (101 bornes) et le second en a autant que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;&#xA;en a jugÃ© nÃ©cessaire, avec 1000 intervalles au maximum.&lt;/p&gt;&#xA;&#xA;&lt;!--&#xA;Si nous cherchons des valeurs trÃ¨s nombreuses sur une certaine plage, les estimations&#xA;sont bonnes pour les deux colonnes : &#xA;&#xA;```sql&#xA;EXPLAIN ANALYZE SELECT * FROM mesure WHERE valeur_a IN (500, 501, 502);&#xA;EXPLAIN ANALYZE SELECT * FROM mesure WHERE valeur_b IN (500, 501, 502);&#xA;```&#xA;&#xA;```sql&#xA;                               QUERY PLAN                                         &#xA;----------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on mesure  (cost=138.04..5652.55 rows=11455 width=12) &#xA;                             (actual time=3.438..35.044 rows=9866 loops=1)&#xA;   Recheck Cond: (valeur_a = ANY (&#39;{500,501,502}&#39;::integer[]))&#xA;   Heap Blocks: exact=4523&#xA;   -&gt;  Bitmap Index Scan on idx_valeura  (cost=0.00..135.18 rows=11455 width=0) &#xA;                                         (actual time=2.414..2.415 rows=9866 loops=1)&#xA;         Index Cond: (valeur_a = ANY (&#39;{500,501,502}&#39;::integer[]))&#xA; Planning Time: 0.389 ms&#xA; Execution Time: 35.611 ms&#xA;(7 lignes)&#xA;&#xA;                               QUERY PLAN                                         &#xA;----------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on mesure  (cost=127.16..5701.66 rows=10049 width=12) &#xA;                             (actual time=1.828..7.987 rows=9866 loops=1)&#xA;   Recheck Cond: (valeur_b = ANY (&#39;{500,501,502}&#39;::integer[]))&#xA;   Heap Blocks: exact=4523&#xA;   -&gt;  Bitmap Index Scan on idx_valeurb  (cost=0.00..124.65 rows=10049 width=0) &#xA;                                         (actual time=1.046..1.047 rows=9866 loops=1)&#xA;         Index Cond: (valeur_b = ANY (&#39;{500,501,502}&#39;::integer[]))&#xA; Planning Time: 0.135 ms&#xA; Execution Time: 8.460 ms&#xA;(7 lignes)&#xA;```&#xA;&#xA;Pour **9997** lignes rÃ©ellement obtenues, les estimations sont de **10643** pour `valeur_a` et **10084** pour `valeur_b`.&#xA;--&gt;&#xA;&#xA;&lt;p&gt;LanÃ§ons maintenant les requÃªtes suivantes, pour des valeurs peu frÃ©quentesÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;502&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;503&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;504&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IN&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;502&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;503&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;504&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;                               &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;                                         &#xA;&lt;span class=&#34;c1&#34;&gt;----------------------------------------------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;Bitmap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Heap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;58&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5401&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4229&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &#xA;                             &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;038&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;041&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;   &lt;span class=&#34;k&#34;&gt;Recheck&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANY&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;{502,503,504}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]))&lt;/span&gt;&#xA;   &lt;span class=&#34;n&#34;&gt;Heap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Blocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&#xA;   &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Bitmap&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;idx_valeura&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;57&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4229&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;                                         &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;021&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;         &lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANY&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;{502,503,504}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]))&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;164&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;077&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lignes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA;                               &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;                                         &#xA;&lt;span class=&#34;c1&#34;&gt;----------------------------------------------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;Bitmap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Heap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mesure&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;52&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;19&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &#xA;                             &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;022&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;032&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;   &lt;span class=&#34;k&#34;&gt;Recheck&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANY&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;{502,503,504}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]))&lt;/span&gt;&#xA;   &lt;span class=&#34;n&#34;&gt;Heap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Blocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exact&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&#xA;   &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Bitmap&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;idx_valeurb&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;34&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;                                         &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;015&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;015&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;         &lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valeur_b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ANY&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;{502,503,504}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]))&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;092&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;045&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lignes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ici, pour &lt;strong&gt;3&lt;/strong&gt; lignes rÃ©cupÃ©rÃ©es, lâ€™estimation initiale de &lt;strong&gt;10&lt;/strong&gt; est nettement &#xA;meilleure pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;valeur_b&lt;/code&gt; dont lâ€™histogramme est mieux dÃ©fini que pour &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;valeur_a&lt;/code&gt; &#xA;Ã  &lt;strong&gt;4229&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans des scÃ©narios plus complexes, cette diffÃ©rence peut influencer&#xA;les dÃ©cisions du planificateur. Il pourra choisir un parcours de table sÃ©quentiel&#xA;au lieu de passer par un index par exemple, pensant que la requÃªte nâ€™est pas &#xA;assez sÃ©lective. De la mÃªme maniÃ¨re, il pourra choisir une jointure &lt;em&gt;nested loop&lt;/em&gt; &#xA;adaptÃ©e aux petits ensembles au lieu de &lt;em&gt;hash join&lt;/em&gt; pensant pouvoir Ã©conomiser&#xA;lâ€™Ã©criture dâ€™une table de hachage.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;Ã -retenir&#34;&gt;Ã€ retenir&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Augmenter &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;default_statistics_target&lt;/code&gt; permet dâ€™obtenir des statistiques de&#xA;meilleures qualitÃ©. Lâ€™augmentation de la rÃ©solution des statistiques â€“ liste MCV&#xA;et histogramme â€“ permet dâ€™avoir une meilleure estimation du nombre de lignes&#xA;retournÃ©es pour un nÅ“ud donnÃ© dâ€™un plan dâ€™execution et potentiellement, obtenir&#xA;de meilleures performances.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour aller plus loin, je vous invite Ã  revoir la confÃ©rence &#xA;&lt;a href=&#34;https://youtu.be/HI7AIcwNI2w?si=XUTX3_gCHElIa6Tv&#34;&gt;&lt;em&gt;Voyage au centre des statistiques&lt;/em&gt;&lt;/a&gt; &#xA;de Louise Leinweber Ã  PGDay FR 2025. Nos formations &lt;a href=&#34;https://dali.bo/devpg_html&#34;&gt;DEVPG&lt;/a&gt;&#xA;et &lt;a href=&#34;https://dali.bo/perf1_html&#34;&gt;PERF1&lt;/a&gt; incluent aussi depuis cette annÃ©e un nouveau &#xA;module dÃ©diÃ© Ã  la comprÃ©hension des statistiques utilisÃ©es par le planificateur de&#xA;PostgreSQL.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Les mains dans le cambouis #5 - Emplacement physique des lignes</title>
    <updated>2025-07-01T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-07-01://2025/07/01/cambouis.html</id>
    <link href="https://blog.dalibo.com//2025/07/01/cambouis.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 1 Juillet 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La sÃ©rie des mains dans le cambouis continue malgrÃ© une pause&#xA;dâ€™une bonne annÃ©e. Pour ce nouvel article, on va se focaliser sur lâ€™emplacement&#xA;physique des lignes dâ€™une table. Et vous verrez quâ€™il peut y avoir quelques surprises.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/2024-cambouis.jpg&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Allons voir comment sont stockÃ©es nos donnÃ©es dans PostgreSQL !&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;lien-entre-table-et-fichiers&#34;&gt;Lien entre table et fichiers&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Vous le savez certainement, pour chaque relation (table ou index) dans&#xA;PostgreSQL, existent un ou plusieurs fichiers sur disque. CrÃ©ons une table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ma_table&lt;/code&gt;Â dans la base &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt; et rÃ©cupÃ©rons son emplacement dans &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;$PGDATA&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# CREATE TABLE ma_table (c1 integer);&#xA;CREATE TABLE&#xA;postgres=# SELECT pg_relation_filepath(&#39;ma_table&#39;);&#xA;-[ RECORD 1 ]--------+--------------&#xA;pg_relation_filepath | base/5/480736&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Le fichier existe bien sur disque, mais avec une taille de 0 octet. &#xA;Tant quâ€™aucune donnÃ©e nâ€™est ajoutÃ©e Ã  cette table, le fichier fera zÃ©ro octet&#xA;sur disque.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;$ ls -l base/5/480736 &#xA;-rw------- 1 postgres postgres 0 juin  24 13:53 base/5/480736&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;InsÃ©rons une ligne dans notre table et vÃ©rifions sa taille. Un entier Ã©tant codÃ©&#xA;sur 4 octets, on obtient une taille deâ€¦ 8 ko !&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT pg_size_pretty(pg_relation_size(&#39;ma_table&#39;, &#39;main&#39;));&#xA; pg_size_pretty &#xA;----------------&#xA; 8192 bytes&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;En effet, PostgreSQL ne sait travailler quâ€™avec des pages de 8 ko. Ceci est&#xA;configurÃ© via le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;block_size&lt;/code&gt; qui est dÃ©fini lors de la compilation de&#xA;PostgreSQL. Il nâ€™est pas modifiable aprÃ¨s coup. PostgreSQL crÃ©e donc une&#xA;premiÃ¨re page de 8 ko pour stocker notre entier.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;TrÃ¨s logiquement, si on ajoute quelques entiers supplÃ©mentaires dans cette&#xA;table, sa taille de 8 ko ne doit pas Ã©voluer, puisquâ€™il reste suffisamment de&#xA;place dans la premiÃ¨re page allouÃ©e Ã  cette table.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT * FROM ma_table;&#xA; c1 &#xA;----&#xA;  1&#xA;  2&#xA;  3&#xA;  4&#xA;  5&#xA;(5 rows)&#xA;&#xA;postgres=# SELECT pg_size_pretty(pg_relation_size(&#39;ma_table&#39;, &#39;main&#39;));&#xA; pg_size_pretty &#xA;----------------&#xA; 8192 bytes&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;h3 id=&#34;ordre-des-donnÃ©es&#34;&gt;Ordre des donnÃ©es&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SELECT *&lt;/code&gt; montre des donnÃ©es parfaitement triÃ©es selon la colonne&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;c1&lt;/code&gt;. Attention, cela peut porter Ã  confusion, mais les donnÃ©es ne sont PAS&#xA;automatiquement triÃ©es ! Les lignes dâ€™une tables sont lues dans lâ€™ordre&#xA;dâ€™apparition dans le fichier. Ici, on observe ce comportement car les&#xA;insertions ont Ã©tÃ© faites de maniÃ¨re incrÃ©mentale.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour sâ€™assurer de ce propos, utilisons lâ€™extension &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pageinspect&lt;/code&gt; qui permet&#xA;dâ€™avoir un aperÃ§u du contenu dâ€™un fichier de table. Les fonctions &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;get_raw_page&lt;/code&gt;&#xA;et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;heap_page_items&lt;/code&gt; sont particuliÃ¨rement intÃ©ressantes. Seule la colonne&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t_data&lt;/code&gt; correspondant Ã  la donnÃ©e sera rÃ©cupÃ©rÃ©e pour cet exemple.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# CREATE extension IF NOT EXISTS pageinspect;&#xA;CREATE EXTENSION&#xA;postgres=# SELECT t_data FROM heap_page_items(get_raw_page(&#39;ma_table&#39;, 0));&#xA;   t_data   &#xA;------------&#xA; \x01000000&#xA; \x02000000&#xA; \x03000000&#xA; \x04000000&#xA; \x05000000&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Maintenant, supprimons les trois premiÃ¨res lignes et voyons ce quâ€™il se passe au&#xA;niveau du contenu de notre page.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# DELETE FROM ma_table WHERE c1 &amp;lt; 4;&#xA;DELETE 3&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;MalgrÃ© le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DELETE&lt;/code&gt;, les donnÃ©es dans le bloc semblent rester&#xA;identiques. En effet, le processus&#xA;dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum&lt;/code&gt; nâ€™est probablement pas encore passÃ© sur la table. Les lignes ne&#xA;sont plus utilisables par les autres requÃªtes, mais sont encore prÃ©sentes dans&#xA;le fichier en attendant que le nettoyage soit fait.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT t_data FROM heap_page_items(get_raw_page(&#39;ma_table&#39;, 0));&#xA;   t_data   &#xA;------------&#xA; \x01000000&#xA; \x02000000&#xA; \x03000000&#xA; \x04000000&#xA; \x05000000&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Pour ne pas attendre son dÃ©clenchement automatique, lanÃ§ons un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;&#xA;manuellement sur la table et regardons ce qui est dÃ©sormais prÃ©sent dans la page&#xA;de 8 ko.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# VACUUM ma_table;&#xA;VACUUM&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT t_data FROM heap_page_items(get_raw_page(&#39;ma_table&#39;, 0));&#xA;   t_data   &#xA;------------&#xA;&#xA;&#xA;&#xA; \x04000000&#xA; \x05000000&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Les trois premiÃ¨res lignes ont dÃ©sormais disparu et, physiquement, il y a bien&#xA;trois emplacements disponibles. Lâ€™objectif dâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM&lt;/code&gt;, quâ€™il soit manuel ou&#xA;automatique, est de rendre lâ€™espace rÃ©utilisable pour les futures opÃ©rations de&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt; ou &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ainsi, si on insÃ¨re trois nouvelles lignes de mÃªme taille, elles se retrouveront physiquement&#xA;au dÃ©but de la page. PostgreSQL sait rÃ©utiliser lâ€™espace disponible.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# INSERT INTO ma_table VALUES (6), (7), (8);&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT t_data FROM heap_page_items(get_raw_page(&#39;ma_table&#39;, 0));&#xA;   t_data   &#xA;------------&#xA; \x06000000&#xA; \x07000000&#xA; \x08000000&#xA; \x04000000&#xA; \x05000000&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Un ordre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SELECT&lt;/code&gt; sur cette table montre bien que les donnÃ©es ne sont pas du&#xA;tout triÃ©es. Morale de lâ€™histoire : pensez bien Ã  utiliser la clause &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ORDER BY&lt;/code&gt; &#xA;si lâ€™ordre de rÃ©cupÃ©ration vous est important.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT * FROM ma_table;&#xA; c1 &#xA;----&#xA;  6&#xA;  7&#xA;  8&#xA;  4&#xA;  5&#xA;(5 rows)&#xA;&#xA;postgres=# SELECT * FROM ma_table ORDER BY 1;&#xA; c1 &#xA;----&#xA;  4&#xA;  5&#xA;  6&#xA;  7&#xA;  8&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;h3 id=&#34;la-commande-cluster&#34;&gt;La commande CLUSTER&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Par dÃ©faut donc, PostgreSQL ne fait que rÃ©utiliser lâ€™espace libre disponible,&#xA;mais se soucie peu de lâ€™ordre des donnÃ©es. Cependant la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLUSTER&lt;/code&gt; peut&#xA;vous aider.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Peu connue mais prÃ©sente depuis fort longtemps dans PostgreSQL, elle permet de&#xA;rÃ©organiser physiquement les lignes dâ€™une table. La rÃ©organisation des lignes se&#xA;fait selon un index. Il faut donc en crÃ©er un, puisquâ€™il nâ€™y en a pas pour le&#xA;moment.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# CREATE INDEX ON ma_table (c1);&#xA;CREATE INDEX&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# CLUSTER ma_table USING ma_table_c1_idx;&#xA;CLUSTER&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Les donnÃ©es sont maintenant physiquement triÃ©es selon lâ€™index renseignÃ©, ici&#xA;celui portant sur la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;c1&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT t_data FROM heap_page_items(get_raw_page(&#39;ma_table&#39;, 0));&#xA;   t_data   &#xA;------------&#xA; \x04000000&#xA; \x05000000&#xA; \x06000000&#xA; \x07000000&#xA; \x08000000&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Une opÃ©ration &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLUSTER&lt;/code&gt; sur une table est ponctuelle. Elle rÃ©organise&#xA;physiquement les lignes lors de son exÃ©cution, mais ces emplacements ne sont pas&#xA;garantis dans le futur. Selon lâ€™activitÃ© et les modifications apportÃ©es aux&#xA;lignes de la table, elles pourraient Ãªtre rÃ©Ã©crites et voir leur emplacement&#xA;physique modifiÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un intÃ©rÃªt dâ€™avoir les lignes regroupÃ©es physiquement est de limiter les accÃ¨s&#xA;disque et, &lt;em&gt;in fine&lt;/em&gt;, dâ€™accÃ©lÃ©rer les requÃªtes. En effet, si les lignes de la&#xA;table sont triÃ©es et regroupÃ©es selon un index connu, lorsque PostgreSQL&#xA;trouvera la premiÃ¨re ligne demandÃ©e, il y aura de trÃ¨s grande chance que les&#xA;suivantes physiquement fassent elles aussi partie de la rÃ©ponse. Ceci est valide&#xA;si la requÃªte utilise lâ€™index. Autrement dit, si vos requÃªtes rÃ©cupÃ¨rent des&#xA;donnÃ©es qui ne sont pas liÃ©es ou qui sont rÃ©parties dans tous les pages de la&#xA;table, utiliser &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLUSTER&lt;/code&gt; ne sera pas bÃ©nÃ©fique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLUSTER&lt;/code&gt; est une opÃ©ration lourde qui nÃ©cessite la rÃ©Ã©criture et la&#xA;rÃ©indexation des donnÃ©es. Comme pour un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VACUUM FULL&lt;/code&gt;, avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLUSTER&lt;/code&gt; la table&#xA;ciblÃ©e est verrouillÃ©e en lecture et Ã©criture le temps de cette opÃ©ration.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;le-paramÃ¨tre-fillfactor&#34;&gt;Le paramÃ¨tre fillfactor&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fillfactor&lt;/code&gt; : &lt;em&gt;fill&lt;/em&gt; : remplir et &lt;em&gt;factor&lt;/em&gt; : facteur.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il sâ€™agit dâ€™un facteur de remplissage, et si il y a bien une chose que lâ€™on&#xA;remplit avec PostgreSQL, ce sont des tables, des tables et encore des tables&#xA;(parfois, câ€™est lâ€™espace disque quâ€™on remplit avec nos WALs, qui sature, et&#xA;entraÃ®ne lâ€™arrÃªt de notre instance, mais Ã§a, câ€™est une autre histoire ğŸ˜…).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ce paramÃ¨tre est donc un pourcentage de remplissage des pages dâ€™une table. Mais que&#xA;contrÃ´le ce taux exactement ? Remplir une table consiste Ã  y ajouter des lignes.&#xA;Cette opÃ©ration dâ€™ajout se fait notamment avec des ordres &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt; par exemple.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec une valeur positionnÃ©e Ã  100 (ce qui est dâ€™ailleurs le paramÃ©trage par&#xA;dÃ©faut), les opÃ©rations dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt; peuvent utiliser la totalitÃ© de lâ€™espace&#xA;disponible dans les pages pour insÃ©rer leurs donnÃ©es. Si la page est pleine,&#xA;ou si lâ€™espace libre est trop petit pour lâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt;, une&#xA;nouvelle sera crÃ©Ã©e, ou il ira voir dans dâ€™autres blocs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Quand le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fillfactor&lt;/code&gt; est plus bas (disons 80% par exemple) et quâ€™une &#xA;opÃ©ration dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt; est effectuÃ©e, si lâ€™ajout des lignes fait dÃ©passer ce seuil&#xA;de remplissage, PostgreSQL dÃ©cidera de crÃ©er une nouvelle page de 8 ko.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Alors câ€™est trÃ¨s bien, mais que fait PostgreSQL de lâ€™espace rÃ©servÃ© par le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fillfactor&lt;/code&gt; ?&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il le rÃ©serve Ã  la mise Ã  jour des lignes de cette mÃªme page. Autrement dit, cet&#xA;espace sera utilisÃ© par des &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt; qui voudront mettre Ã  jour une ou plusieurs&#xA;lignes de cette page. Une opÃ©ration &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt; a donc plus de chance de placer sa&#xA;nouvelle version de la ligne dans la mÃªme page. Câ€™est nettement plus efficace&#xA;que de devoir la mettre dans une nouvelle page.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En plus de cela, sous certaines conditions, notamment que les colonnes modifiÃ©es ne soient pas&#xA;indexÃ©es, un autre mÃ©canisme peut rentrer en jeu : le mÃ©canisme HOT,&#xA;pour &lt;em&gt;Heap-Only Tuples&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;le-mÃ©canisme-de-heap-only-tuples&#34;&gt;Le mÃ©canisme de Heap-Only Tuples&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Regardons ce mÃ©canisme un peu plus en dÃ©tails en crÃ©ant tout dâ€™abord une nouvelle&#xA;table avec un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fillfactor&lt;/code&gt; Ã  50 (ce qui est trÃ¨s bas !). Cette table possÃ¨de&#xA;deux colonnes dont une clÃ© primaire qui sera donc indexÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# CREATE TABLE ma_table_hot (c1 integer PRIMARY KEY, c2 integer) WITH (fillfactor = 50);&#xA;CREATE TABLE&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;InsÃ©rons quelques lignes (113 exactement, nous verrons pourquoi)&#xA;avec le mÃªme contenu dans les deux colonnes :&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# INSERT INTO ma_table_hot SELECT val, val FROM generate_series(1,113) as val;&#xA;INSERT 0 113&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Regardons les cinq derniÃ¨res lignes du fichier. &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;71&lt;/code&gt; en hexadÃ©cimal correspond&#xA;bien Ã  113 en base 10. Bref, tout va bien.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT t_data FROM heap_page_items(get_raw_page(&#39;ma_table_hot&#39;, 0)) ORDER BY 1 DESC LIMIT 5;&#xA;      t_data       &#xA;------------------&#xA;\x7100000071000000&#xA;\x7000000070000000&#xA;\x6f0000006f000000&#xA;\x6e0000006e000000&#xA;\x6d0000006d000000&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Maintenant lanÃ§ons une commande dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;INSERT&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# INSERT INTO ma_table_hot VALUES (114,114);&#xA;INSERT 0 1&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Relancez la commande prÃ©cÃ©dente (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SELECT t_data FROM heap_page_itemsâ€¦&lt;/code&gt;) et&#xA;vous verrez que rien nâ€™a changÃ©. Pourquoi ? Cette nouvelle ligne nâ€™est pas&#xA;ajoutÃ©e Ã  la premiÃ¨re page de 8 ko, mais dans une nouvelle page qui vient dâ€™Ãªtre&#xA;crÃ©Ã©e. En effet, la 114áµ‰ ligne dÃ©passe le seuil de remplissage. Elle se trouve&#xA;donc insÃ©rÃ©e dans la deuxiÃ¨me page :&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# SELECT t_data FROM heap_page_items(get_raw_page(&#39;ma_table_hot&#39;, 1)) ORDER BY 1 DESC LIMIT 5;&#xA;      t_data       &#xA;------------------&#xA;\x7200000072000000&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Maintenant mettons Ã  jour la premiÃ¨re ligne de cette table. Lâ€™ordre ici est un&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt; sur la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;c2&lt;/code&gt; qui, elle, nâ€™est pas indexÃ©e. Le mÃ©canisme HOT devrait&#xA;donc rentrer en jeu. RÃ©cupÃ©rez la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;lp&lt;/code&gt; en plus de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;t_data&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-psql&#34;&gt;postgres=# UPDATE ma_table_hot SET c2 = 200 WHERE c1 = 1; &#xA;UPDATE 1&#xA;postgres=# SELECT lp, t_data FROM heap_page_items(get_raw_page(&#39;ma_table_hot&#39;, 0)) ORDER BY 1 DESC LIMIT 5;&#xA;lp        t_data       &#xA;--- ------------------&#xA;114 \x01000000c8000000&#xA;113 \x7100000071000000&#xA;112 \x7000000070000000&#xA;111 \x6f0000006f000000&#xA;110 \x6e0000006e000000&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;La nouvelle version de la ligne est bien prÃ©sente Ã  la fin de la premiÃ¨re page.&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;c8&lt;/code&gt; en hexadÃ©cimal Ã©quivaut Ã  200 en base 10. La mise Ã  jour sâ€™est bien&#xA;effectuÃ©e dans la mÃªme page.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un intÃ©rÃªt du mÃ©canisme HOT est de ne pas Ã  avoir Ã  toucher aux index lors&#xA;dâ€™une mise Ã  jour de ligne. Lâ€™index &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;c1&lt;/code&gt; nâ€™a pas Ã©tÃ© mis Ã  jour lors de cet&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt;. Pourtant ce devrait Ãªtre nÃ©cessaire puisque la ligne est passÃ©e&#xA;physiquement du premier au dernier emplacement la page.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comment PostgreSQL parvient Ã  garantir que lâ€™index ciblera toujours la bonne&#xA;donnÃ©e ? Lâ€™astuce consiste Ã  faire pointer la premiÃ¨re ligne vers la nouvelle&#xA;ligne en ajoutant un Â« pointeur de ligne Â» vers la nouvelle version de cette&#xA;ligne. Ainsi, un index ciblera la premiÃ¨re ligne, qui indiquera Ã  son tour que&#xA;la donnÃ©e se trouve Ã  un autre emplacement physique du mÃªme bloc, indiquÃ© par le Â« pointeur de&#xA;ligne Â». Il y a donc un gain en Ã©criture comme en utilisation du cache.&lt;/p&gt;&#xA;&#xA;&lt;blockquote&gt;&#xA;  &lt;p&gt;Pour les plus curieux dâ€™entre vous, regardez la premiÃ¨re ligne de la premiÃ¨re&#xA;page. Que constatez-vous ? â€¦ et oui, lâ€™ancienne valeur est toujours prÃ©sente !&#xA;Il faudra attendre un prochain article pour comprendre pourquoi. On parlera de&#xA;visibilitÃ© et dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;autovacuum&lt;/code&gt; !&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&#xA;&lt;p&gt;Noter que ce mÃ©canisme de redirection ne fonctionne quâ€™Ã  lâ€™intÃ©rieur&#xA;dâ€™un mÃªme bloc. Sans place suffisante dans le bloc, le mÃ©canisme HOT&#xA;est dÃ©sactivÃ©.&#xA;Attention, tout de mÃªme, descendre le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fillfactor&lt;/code&gt; aura dâ€™autres&#xA;impacts, comme par exemple, la taille sur disque de la table.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nos donnÃ©es sont prÃ©sentes dans des pages de 8 ko. Câ€™est une valeur fixe qui&#xA;nâ€™est pas modifiable par dÃ©faut. Vous pouvez le faire uniquement si vous&#xA;recompilez PostgreSQL. Les donnÃ©es ne suivent pas dâ€™ordre logique dans les&#xA;fichiers physiques. Elles changeront de place au fur et Ã  mesure de leur&#xA;existence en base. Pour les tables les plus souvent mises Ã  jour, le mÃ©canisme&#xA;de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;fillfactor&lt;/code&gt; permet de conserver de lâ€™espace pour les ordres &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;UPDATE&lt;/code&gt;. La&#xA;mise Ã  jour dâ€™une colonne non indexÃ©e permet en plus de dÃ©clencher le mÃ©canisme&#xA;de &lt;em&gt;Heap-Only Tuples&lt;/em&gt; permettant de limiter la recrÃ©ation de page et les&#xA;manipulations des index.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[BLOG-commentaire] les mains dans le cambouis&#34;&gt;Ã‰crivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 18 en RC1</title>
    <updated>2025-09-04T15:20:00Z</updated>
    <id>tag:www.loxodata.com,2025-09-04:/post/postgresql-18-rc1/</id>
    <link href="http://www.loxodata.com/post/postgresql-18-rc1/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le PostgreSQL Global Development Group a annoncÃ© la publication de la premiÃ¨re&#xA;Release Candidate de PostgreSQL 18. En tant que Release Candidate, la version&#xA;de PostgreSQL 18 RC1 sera quasiment identique Ã  la publication initiale de&#xA;PostgreSQL 18, cependant, des corrections pourront Ãªtre appliquÃ©es avant la&#xA;mise Ã  disposition de la version finale de PostgreSQL 18.&lt;/p&gt;&#xA;&lt;p&gt;La date de publication pour la version finale de PostgreSQL 18 est prÃ©vue au 25&#xA;septembre 2025. Consulter la section &lt;a href=&#34;#planning-des-publications&#34;&gt;Planning des publications&lt;/a&gt; pour plus de dÃ©tails.&lt;/p&gt;&#xA;&lt;h1 id=&#34;mise-Ã -jour-vers-la-rc1-de-postgresql-18&#34;&gt;Mise Ã  jour vers la RC1 de PostgreSQL 18&lt;/h1&gt;&#xA;&lt;p&gt;Pour mettre Ã  jour votre version de PostgreSQL depuis une prÃ©cÃ©dente version de&#xA;PostgreSQL, vous pouvez utiliser la mÃªme stratÃ©gie que pour mettre Ã  jour vers&#xA;toute version majeure de PostgreSQL (par exemple avec la commande &lt;code&gt;pg_upgrade&lt;/code&gt;&#xA;ou &lt;code&gt;pg_dump&lt;/code&gt;/&lt;code&gt;pg_restore&lt;/code&gt;).&lt;/p&gt;&#xA;&lt;p&gt;Pour plus d&amp;rsquo;information, consultez la section &lt;a href=&#34;https://www.postgresql.org/docs/18/upgrading.html&#34;&gt;mise Ã  jour&lt;/a&gt;&#xA;de la documentation officielleÂ : &lt;a href=&#34;https://www.postgresql.org/docs/18/upgrading.html&#34;&gt;https://www.postgresql.org/docs/18/upgrading.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;changements-depuis-la-bÃªta-3&#34;&gt;Changements depuis la bÃªta 3&lt;/h1&gt;&#xA;&lt;p&gt;Plusieurs corrections ont Ã©tÃ© apportÃ©es Ã  PostgreSQL 18 suite aux remontÃ©es&#xA;d&amp;rsquo;utilisateurs ayant testÃ© la bÃªta 3.&lt;/p&gt;&#xA;&lt;p&gt;Dont notammentÂ :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Les colonnes gÃ©nÃ©rÃ©es virtuellement sont dÃ©sormais ignorÃ©es lors d&amp;rsquo;un vacuum avec la commande &lt;code&gt;vacuumdb&lt;/code&gt; et l&amp;rsquo;option &lt;code&gt;--missing-stats-only&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;une recommandation sur quand rÃ©indexer des index de recherche full-text et &lt;code&gt;pg_trgm&lt;/code&gt; aprÃ¨s avoir utilisÃ© la commande &lt;code&gt;pg_upgrade&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Pour la liste complÃ¨te des corrections, veuillez consulter la page des&#xA;&lt;a href=&#34;https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items#resolved_before_18rc1&#34;&gt;tickets&lt;/a&gt; ouverts.&lt;/p&gt;&#xA;&lt;h1 id=&#34;planning-des-publications&#34;&gt;Planning des publications&lt;/h1&gt;&#xA;&lt;p&gt;Il s&amp;rsquo;agit de la premiÃ¨re Release Candidate de la version 18. Sauf Ã  dÃ©couvrir un&#xA;problÃ¨me imposant un nouveau dÃ©lai ou une nouvelle Release Candidate, PostgreSQL&#xA;18 devrait Ãªtre publiÃ©e le 25 septembre 2025.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus d&amp;rsquo;information, veuillez consulter la page &lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;Beta Testing&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;liens&#34;&gt;Liens&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargement&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;Information sur le BÃªta Testing&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;Note de publication de PostgreSQL 18&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items&#34;&gt;ProblÃ¨mes connus de PostgreSQL 18&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;Soumettre un bogue&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17.6 et autres correctifs</title>
    <updated>2025-08-18T10:01:00Z</updated>
    <id>tag:www.loxodata.com,2025-08-18:/post/postgresql-17-6/</id>
    <link href="http://www.loxodata.com/post/postgresql-17-6/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le PGDG (PostgreSQL Global Development Group) a publiÃ© une mise Ã  jour&#xA;de toutes les versions supportÃ©es de PostgreSQL, incluant 17.6, 16.10,&#xA;15.14, 14.19, et 13.22, ainsi que la troisiÃ¨me publication bÃªta de&#xA;PostgreSQL 18.&lt;/p&gt;&#xA;&lt;p&gt;Cette publication corrige Ã©galement 3 vulnÃ©rabilitÃ©s de sÃ©curitÃ© et&#xA;plus de 55 bogues reportÃ©s dans les mois prÃ©cÃ©dents.&lt;/p&gt;&#xA;&lt;p&gt;Si vous avez prÃ©cÃ©demment crÃ©Ã© un index BRIN utilisant la classe&#xA;d&amp;rsquo;opÃ©rateur &lt;code&gt;numeric_minmax_multi_ops&lt;/code&gt;, merci de consulter la section&#xA;Â«Â Mise Ã  jourÂ Â» pour les instructions additionnelles aprÃ¨s la mise Ã &#xA;jour de votre instance.&lt;/p&gt;&#xA;&lt;p&gt;Pour la liste complÃ¨te des changements, se rÃ©fÃ©rer Ã  la section &lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;Notes&#xA;de publication&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;fin-du-support-de-la-version-13-de-postgresql&#34;&gt;Fin du support de la version 13 de PostgreSQL&lt;/h2&gt;&#xA;&lt;p&gt;La version 13 de PostgreSQL ne recevra plus de correctifs Ã  partir du&#xA;13 novembre 2025. Il est donc recommandÃ© de mettre Ã  jour vers une&#xA;version majeure vos instances en production.&lt;/p&gt;&#xA;&lt;p&gt;Se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;note de versions&lt;/a&gt;&#xA;pour plus d&amp;rsquo;informations.&lt;/p&gt;&#xA;&lt;h2 id=&#34;problÃ¨mes-de-sÃ©curitÃ©&#34;&gt;ProblÃ¨mes de sÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-8713/&#34;&gt;CVE-2025-8713&lt;/a&gt; : l&amp;rsquo;optimiseur statistique de PostgreSQL peut exposer les Ã©chantillons de donnÃ©es d&amp;rsquo;une vue, partition ou table fille.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;CVSS v3.1 Base Score: 3.1&lt;/p&gt;&#xA;&lt;p&gt;versions vulnÃ©rables et supportÃ©es : 13 - 17.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;optimiseur statistique de PostgreSQL permet Ã  un utilisateur de lire&#xA;des Ã©chantillons de donnÃ©es dans une vue Ã  laquelle l&amp;rsquo;utilisateur n&amp;rsquo;a&#xA;pas accÃ¨s. SÃ©parÃ©ment, les statistiques permettent Ã  un utilisateur de&#xA;lire des Ã©chantillons de donnÃ©es qu&amp;rsquo;une rÃ¨gle de sÃ©curitÃ© devrait&#xA;masquer. PostgreSQL maintient des statistiques pour les tables en&#xA;Ã©chantillonnant les donnÃ©es disponibles dans les colonnesÂ ; ces&#xA;donnÃ©es sont consultÃ©es lors du processus de planification d&amp;rsquo;une&#xA;requÃªte. Avant cette publication, un utilisateur pouvant crÃ©er un&#xA;opÃ©rateur faisant fuiter les donnÃ©es en outrepassant les contrÃ´les&#xA;d&amp;rsquo;accÃ¨s (ACL) et les rÃ¨gles de sÃ©curitÃ© (RLS) dans un contexte de&#xA;partitionnement ou d&amp;rsquo;hÃ©ritage de tables. Les donnÃ©es statistiques&#xA;accessibles comprenaient notamment les histogrammes et les valeurs les&#xA;plus communes. Les correctifs des &lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2017-7484/&#34;&gt;CVE-2017-7484&lt;/a&gt;&#xA;et &lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2019-10130/&#34;&gt;CVE-2019-10130&lt;/a&gt;&#xA;avaient pour but de mettre fin Ã  ce type de vulnÃ©rabilitÃ©s sans y&#xA;parvenir. Les versions prÃ©cÃ©dant PostgreSQL 17.6, 16.10, 15.14,&#xA;14.19, and 13.22 sont affectÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Le projet PostgreSQL remercie Dean Rasheed pour avoir reportÃ© ce problÃ¨me.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-8714/&#34;&gt;CVE-2025-8714&lt;/a&gt;:&#xA;l&amp;rsquo;outil &lt;code&gt;pg_dump&lt;/code&gt; de PostgreSQL permet Ã  un super-utilisateur du&#xA;serveur d&amp;rsquo;origine d&amp;rsquo;exÃ©cuter du code dans l&amp;rsquo;outil &lt;code&gt;psql&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;CVSS v3.1 Base Score: 8.8&lt;/p&gt;&#xA;&lt;p&gt;versions vulnÃ©rables et supportÃ©es : 13 - 17.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;inclusion dans &lt;code&gt;pg_dump&lt;/code&gt; de donnÃ©es non fiables dans PostgreSQL&#xA;permet Ã  un super-utilisateur malicieux du serveur PostgreSQL&#xA;d&amp;rsquo;origine d&amp;rsquo;injecter du code arbitraire exÃ©cutable au moment de la&#xA;restauration par le compte du systÃ¨me d&amp;rsquo;exploitation exÃ©cutant &lt;code&gt;psql&lt;/code&gt;&#xA;pour restaurer le dump, via les mÃ©tacommandes de &lt;code&gt;psql&lt;/code&gt;. &lt;code&gt;pg_dumpall&lt;/code&gt;&#xA;est aussi affectÃ©. &lt;code&gt;pg_restore&lt;/code&gt; est affectÃ© lorsqu&amp;rsquo;il est utilisÃ© pour&#xA;gÃ©nÃ©rer un dump au format texte. Ceci est similaire au CVE-2024-21096&#xA;de MySQL. Les versions prÃ©cÃ©dant PostgreSQL 17.6, 16.10, 15.14,&#xA;14.19, and 13.22 sont affectÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Le projet PostgreSQL remercie Martin Rakhmanov, Matthieu Denais, et&#xA;RyotaK pour avoir reportÃ© ce problÃ¨me.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-8715/&#34;&gt;CVE-2025-8715&lt;/a&gt; :&#xA;avec l&amp;rsquo;outil &lt;code&gt;pg_dump&lt;/code&gt; de PostgreSQL, un saut de ligne dans un nom&#xA;d&amp;rsquo;objet permet l&amp;rsquo;exÃ©cution de code arbitraire dans le client &lt;code&gt;psql&lt;/code&gt; et&#xA;dans le serveur cible lors de la restauration.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;CVSS v3.1 Base Score: 8.8&lt;/p&gt;&#xA;&lt;p&gt;versions vulnÃ©rables et supportÃ©es : 13 - 17.&lt;/p&gt;&#xA;&lt;p&gt;La neutralisation impropre des sauts de lignes dans &lt;code&gt;pg_dump&lt;/code&gt; permet Ã &#xA;un utilisateur du serveur d&amp;rsquo;origine d&amp;rsquo;injecter du code arbitraire pour&#xA;le moment de la restauration, par le compte utilisateur du systÃ¨me&#xA;d&amp;rsquo;exploitation utilisant &lt;code&gt;psql&lt;/code&gt; pour restaurer le dump, via les&#xA;mÃ©tacommandes incluses dans les noms d&amp;rsquo;objets forgÃ©s. La mÃªme mÃ©thode&#xA;d&amp;rsquo;attaque permet d&amp;rsquo;injecter du code SQL en tant que super-utilisateur&#xA;Ã  la restauration dans le serveur cible. &lt;code&gt;pg_dumpall&lt;/code&gt;, &lt;code&gt;pg_restore&lt;/code&gt; et&#xA;&lt;code&gt;pg_upgrade&lt;/code&gt; sont aussi affectÃ©. Les versions prÃ©cÃ©dant PostgreSQL&#xA;17.6, 16.10, 15.14, 14.19, and 13.22 sont affectÃ©es. Les versions&#xA;avant 11.20 ne sont pas affectÃ©es. &lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2012-0868/&#34;&gt;CVE-2012-0868&lt;/a&gt;&#xA;avait corrigÃ© ce type de problÃ¨me, mais la version 11.20 l&amp;rsquo;avait&#xA;rÃ©introduit.&lt;/p&gt;&#xA;&lt;p&gt;Le projet PostgreSQL remercie Noah Misch pour avoir reportÃ© ce problÃ¨me.&lt;/p&gt;&#xA;&lt;h2 id=&#34;corrections-de-bogues-et-amÃ©liorations&#34;&gt;Corrections de bogues et amÃ©liorations&lt;/h2&gt;&#xA;&lt;p&gt;Cette mise Ã  jour corrige plus de 60 bogues ayant Ã©tÃ© signalÃ©s durant&#xA;les mois prÃ©cÃ©dents. Les problÃ¨mes ci-dessous concernent&#xA;PostgreSQL 17. Certains de ces problÃ¨mes peuvent aussi concerner&#xA;d&amp;rsquo;autres versions de PostgreSQL.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;correction pour les index BRIN utilisant la classe d&amp;rsquo;opÃ©rateur&#xA;&lt;code&gt;numeric_minmax_multi_ops operator&lt;/code&gt;. Le bogue corrigÃ© pouvait&#xA;causer de la fragmentation et de l&amp;rsquo;inefficacitÃ©. Merci de&#xA;consulter la section Â«Â Mise Ã  jourÂ Â» pour obtenir les instructions&#xA;permettant de corriger ces indexÂ ;&lt;/li&gt;&#xA;&lt;li&gt;plusieurs corrections concernant la rÃ©plication logique, incluant&#xA;des correctifs sur des Ã©checs d&amp;rsquo;allocation mÃ©moire, le rejeu de&#xA;transactions dupliquÃ©es, d&amp;rsquo;attente infinie, d&amp;rsquo;arrÃªt inattendu, et un&#xA;arrÃªt impossible d&amp;rsquo;un serveur secondaireÂ ;&lt;/li&gt;&#xA;&lt;li&gt;correction de la suppression prÃ©maturÃ©e d&amp;rsquo;anciens WAL pendant un&#xA;checkpoint, ce qui pouvait impacter le processus de rÃ©cupÃ©ration&#xA;lors de l&amp;rsquo;utilisation de slots de rÃ©plicationÂ ;&lt;/li&gt;&#xA;&lt;li&gt;annule un changement pouvant rejeter un document XML plus&#xA;volumineux que 10MBÂ ;&lt;/li&gt;&#xA;&lt;li&gt;corrige la mÃ©thode de manipulation des classes de caractÃ¨res&#xA;imbriquÃ©es (i.e. [[:alpha:]%_]) des expressions &lt;code&gt;SIMILAR TO&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;rÃ©tabli la possibilitÃ© pour les expressions PL/pgSQL d&amp;rsquo;utiliser&#xA;l&amp;rsquo;exÃ©cution en parallÃ¨leÂ ;&lt;/li&gt;&#xA;&lt;li&gt;dÃ©sactive un rare scÃ©nario dans lequel un index B-tree pourrait&#xA;modifier la mauvaise entrÃ©eÂ ;&lt;/li&gt;&#xA;&lt;li&gt;plusieurs correctifs concernant la commande &lt;code&gt;MERGE&lt;/code&gt;, incluant des&#xA;des rÃ©sultats incorrects de requÃªtes concurrentes et lors de&#xA;l&amp;rsquo;utilisation d&amp;rsquo;une table parenteÂ ;&lt;/li&gt;&#xA;&lt;li&gt;corrige un Ã©chec de dÃ©compression sur des donnÃ©es n&amp;rsquo;Ã©tant pas trÃ¨s&#xA;compressibleÂ ;&lt;/li&gt;&#xA;&lt;li&gt;prÃ©viens d&amp;rsquo;une boucle infinie dans un checkpoint sur des systÃ¨mes&#xA;ayant un rÃ©glage &lt;code&gt;shared_buffers&lt;/code&gt; trÃ¨s grandÂ ;&lt;/li&gt;&#xA;&lt;li&gt;corrige des problÃ¨mes avec l&amp;rsquo;authentification GSSAPI lors de&#xA;l&amp;rsquo;utilisation de comptes Active Directory avec beaucoup&#xA;d&amp;rsquo;appartenances Ã  des groups. Cette publication corrige aussi des&#xA;Ã©checs de connexions dÃ©pendant du temps lors de l&amp;rsquo;utilisation de&#xA;SSL ou du chiffrement GSSAPI en mode non bloquantÂ ;&lt;/li&gt;&#xA;&lt;li&gt;corrige une dÃ©faillance de la fonction &lt;code&gt;PQcancelCreate()&lt;/code&gt; de la&#xA;bibliothÃ¨que &lt;code&gt;libpq&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;corrige plusieurs fuites de ressources.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;mise-Ã -jour&#34;&gt;Mise Ã  jour&lt;/h2&gt;&#xA;&lt;p&gt;Toutes les publications de mises Ã  jour de PostgreSQL sont&#xA;cumulatives. Comme pour les autres mises Ã  jour mineures, il n&amp;rsquo;est pas&#xA;nÃ©cessaire d&amp;rsquo;extraire et de recharger les bases de donnÃ©es ni&#xA;d&amp;rsquo;utiliser &lt;code&gt;pg_upgrade&lt;/code&gt; pour appliquer cette mise Ã  jourÂ ; il&#xA;suffit simplement d&amp;rsquo;arrÃªter PostgreSQL et de mettre Ã  jour les&#xA;binaires.&lt;/p&gt;&#xA;&lt;p&gt;Si vous avez des index BRIN utilisant la classe d&amp;rsquo;opÃ©rateur&#xA;&lt;code&gt;numeric_minmax_multi_ops&lt;/code&gt;, il est recommandÃ© de les rÃ©indexer aprÃ¨s&#xA;la mise Ã  jour pour corriger la potentielle fragmentation et&#xA;inefficacitÃ©&lt;/p&gt;&#xA;&lt;p&gt;Les utilisateurs ayant sautÃ© une ou plusieurs mises Ã  jour peuvent&#xA;avoir besoin d&amp;rsquo;Ã©tapes additionnelles aprÃ¨s la mise Ã  jour.  Les notes&#xA;de publication des versions prÃ©cÃ©dentes fournissent les dÃ©tails.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus de dÃ©tails, se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;note de publication de&#xA;versions&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;note-Ã -propos-de-postgresql-18-bÃªta&#34;&gt;Note Ã  propos de PostgreSQL 18 BÃªta&lt;/h2&gt;&#xA;&lt;p&gt;Cette publication marque la troisiÃ¨me publication bÃªta de PostgreSQL&#xA;17 et rapproche d&amp;rsquo;une Ã©tape la communautÃ© de la disponibilitÃ©&#xA;probablement autour de septembre ou octobre 2025.&lt;/p&gt;&#xA;&lt;p&gt;Dans l&amp;rsquo;esprit de la communautÃ© PostgreSQL Â« open-source Â», nous vous&#xA;encourageons fortement Ã  tester les nouvelles fonctionnalitÃ©s de&#xA;PostgreSQL 18 sur vos systÃ¨mes pour nous aider Ã  Ã©liminer les bogues et&#xA;autres problÃ¨mes existants. Bien que nous ne recommandons pas&#xA;l&amp;rsquo;utilisation de PostgreSQL 18 BÃªta 3 dans des environnements de&#xA;production, nous vous encourageons Ã  trouver des moyens de tester les&#xA;applications avec cette version.&lt;/p&gt;&#xA;&lt;p&gt;Vos tests et retours aideront la communautÃ© Ã  s&amp;rsquo;assurer que la&#xA;publication de PostgreSQL 18 maintiendra nos standards pour livrer une&#xA;version fiable et stable de la base de donnÃ©es relationnelle Â«&#xA;open-source Â» la plus avancÃ©e du monde. Merci de prendre connaissance&#xA;du processus de bÃªta test et de comment vous pouvez contribuer : &lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;https://www.postgresql.org/developer/beta/&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;mettre-Ã -jour-vers-postgresql-18-bÃªta-3&#34;&gt;Mettre Ã  jour vers PostgreSQL 18 BÃªta 3&lt;/h2&gt;&#xA;&lt;p&gt;Afin de mettre Ã  jour vers PostgreSQL 18 BÃªta 3 Ã  partir d&amp;rsquo;une&#xA;publication antÃ©rieure de PostgreSQL, vous aurez besoin d&amp;rsquo;utiliser une&#xA;stratÃ©gie similaire Ã  la mise Ã  jour entre versions majeures de&#xA;PostgreSQL (par exemple : &lt;code&gt;pg_upgrade&lt;/code&gt; ou&#xA;&lt;code&gt;pg_dump&lt;/code&gt;/&lt;code&gt;pg_restore&lt;/code&gt;). Pour plus d&amp;rsquo;information, merci de prendre&#xA;connaissance de la documentation sur la &lt;a href=&#34;https://www.postgresql.org/docs/18/static/upgrading.html&#34;&gt;mise Ã  jour&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;changements-depuis-la-bÃªta-2&#34;&gt;Changements depuis la BÃªta 2&lt;/h2&gt;&#xA;&lt;p&gt;Les corrections et changements dans PostgreSQL 18 Beta 3 incluent :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;corrige des rÃ©gressions de performances sur des requÃªtes trivialesÂ ;&lt;/li&gt;&#xA;&lt;li&gt;corrige l&amp;rsquo;erreur &lt;code&gt;can&#39;t get cancellation key&lt;/code&gt; observÃ©e avec&#xA;quelques logiciels additionnelsÂ ;&lt;/li&gt;&#xA;&lt;li&gt;corrige la dÃ©faillance du redÃ©marrage d&amp;rsquo;un processus d&amp;rsquo;arriÃ¨re-plan&#xA;aprÃ¨s un crashÂ ;&lt;/li&gt;&#xA;&lt;li&gt;corrige un rare Ã©chec d&amp;rsquo;entrÃ©e/sortie asynchroneÂ ;&lt;/li&gt;&#xA;&lt;li&gt;arrÃªte l&amp;rsquo;export d&amp;rsquo;objets excÃ©dentaire dans &lt;code&gt;pg_dumpall --statistics-only&lt;/code&gt; et &lt;code&gt;--no-schema&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;retire les formats de fichiers non-texte de &lt;code&gt;pg_dumpall&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;corrige la fonction &lt;code&gt;date_trunc(..., &#39;infinity&#39;::timestamptz)&lt;/code&gt; sur&#xA;des systÃ¨mes.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Merci de se rÃ©fÃ©rer aux notes de publication pour la liste complÃ¨te&#xA;des nouveautÃ©s et changements : &lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;https://www.postgresql.org/docs/18/release-18.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;test-pour-les-bogues-et-la-compatibilitÃ©&#34;&gt;Test pour les bogues et la compatibilitÃ©&lt;/h2&gt;&#xA;&lt;p&gt;La stabilitÃ© de chaque publication de PostgreSQL dÃ©pend grandement de&#xA;vous, la communautÃ©, en testant la version Ã  venir avec vos charges et&#xA;tests pour trouver les bogues et rÃ©gressions avant la mise Ã &#xA;disposition gÃ©nÃ©rale de PostgreSQL 18. En tant que BÃªta, des&#xA;changements mineurs du comportement de la base de donnÃ©es, des&#xA;dÃ©tails des caractÃ©ristiques et des APIs sont toujours possibles. Vos&#xA;retours et tests aideront Ã  finaliser les nouvelles caractÃ©ristiques,&#xA;ainsi, merci de tester dans un futur proche. La qualitÃ© des tests&#xA;utilisateurs dÃ©termine le moment de la publication finale.&lt;/p&gt;&#xA;&lt;p&gt;Une liste de sujets ouverts est publiquement disponible dans le wiki&#xA;de PostgreSQL. Vous pouvez rapporter des bogues en utilisant le site&#xA;web de PostgreSQL : &lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;https://www.postgresql.org/account/submitbug/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;planing-bÃªta&#34;&gt;Planing BÃªta&lt;/h2&gt;&#xA;&lt;p&gt;Il s&amp;rsquo;agit de la troisiÃ¨me publication BÃ©ta de la version 18. Le projet&#xA;PostgreSQL publiera au moins une publication candidate, avant la&#xA;publication finale autour de septembre/octobre 2025. Pour plus&#xA;d&amp;rsquo;information, voir la page sur les tests BÃªta.&lt;/p&gt;&#xA;&lt;h2 id=&#34;liens&#34;&gt;Liens&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargements&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;Notes de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/&#34;&gt;Page sur la sÃ©curitÃ©&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;Politique de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;Information sur le BÃªta Testing&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;Note de publication de PostgreSQL 18 BÃªta&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items&#34;&gt;ProblÃ¨mes connus de PostgreSQL 18&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;Soumettre un bogue&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Si vous avez des corrections ou suggestions sur cette annonce de&#xA;publication, merci de les envoyer Ã  la mailing liste publique&#xA;&lt;a href=&#34;https://www.postgresql.org/list/&#34;&gt;&lt;em&gt;pgsql-www@lists.postgresql.org&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Connexion Ã  une instance PostgreSQL avec mappage d&#39;utilisateur</title>
    <updated>2025-08-05T14:45:00Z</updated>
    <id>tag:www.loxodata.com,2025-08-05:/post/connexions_ident/</id>
    <link href="http://www.loxodata.com/post/connexions_ident/" rel="alternate"></link>
    <summary type="html">&lt;h1 id=&#34;fichier-de-mappage&#34;&gt;Fichier de mappage&lt;/h1&gt;&#xA;&lt;p&gt;En complÃ©ment des articles dÃ©jÃ  publiÃ©s sur les connexions&#xA;(&lt;a href=&#34;http://www.loxodata.com/post/connexions1&#34;&gt;premier article&lt;/a&gt; et &lt;a href=&#34;http://www.loxodata.com/post/connexions2&#34;&gt;deuxiÃ¨me article&lt;/a&gt;),&#xA;nous vous proposons aujourd&amp;rsquo;hui d&amp;rsquo;utiliser le fichier de mappage &lt;code&gt;pg_ident.conf&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Son utilisation n&amp;rsquo;est pas trÃ¨s frÃ©quente, mais il peut Ãªtre utile de savoir&#xA;l&amp;rsquo;utiliser.&lt;/p&gt;&#xA;&lt;h2 id=&#34;authentification-peer&#34;&gt;Authentification peer&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL dispose d&amp;rsquo;un systÃ¨me qui facilite la connexion Ã  l&amp;rsquo;instance de base&#xA;de donnÃ©es pour les administrateurs. C&amp;rsquo;est aussi souvent le seul moyen de se&#xA;connecter Ã  une instance fraÃ®chement installÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;Cette mÃ©thode s&amp;rsquo;appelle &lt;code&gt;peer&lt;/code&gt; et consiste Ã  autoriser la connexion locale (par&#xA;la socket Unix) Ã  la condition que l&amp;rsquo;utilisateur de l&amp;rsquo;instance porte exactement&#xA;le mÃªme nom que l&amp;rsquo;utilisateur systÃ¨me.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;loxodata@debian:~$ psql -U postgres&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psql: error: connection to server on socket &lt;span class=&#34;s2&#34;&gt;&amp;#34;/var/run/postgresql/.s.PGSQL.5432&amp;#34;&lt;/span&gt; failed: FATAL:  Peer authentication failed &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; user &lt;span class=&#34;s2&#34;&gt;&amp;#34;postgres&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;loxodata@debian:~$ sudo -iu postgres&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres@debian:~$ psql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psql &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;17.5 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Debian 17.5-1.pgdg120+1&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Type &lt;span class=&#34;s2&#34;&gt;&amp;#34;help&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; help.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Mais comment utiliser cette authentification &lt;code&gt;peer&lt;/code&gt; lorsque le compte de base de&#xA;donnÃ©es ne porte par le mÃªme nom que le compte systÃ¨me ?&lt;/p&gt;&#xA;&lt;h2 id=&#34;le-fichier-pg_identconf&#34;&gt;Le fichier pg_ident.conf&lt;/h2&gt;&#xA;&lt;p&gt;Le fichier &lt;code&gt;pg_ident.conf&lt;/code&gt; est lÃ  pour nous aider Ã  permettre la connexion dans le&#xA;cas oÃ¹ le compte systÃ¨me et le compte de base de donnÃ©es ne portent pas le mÃªme&#xA;nom.&lt;/p&gt;&#xA;&lt;p&gt;Dans ce cas, il suffit d&amp;rsquo;ajouter un mappage des utilisateurs concernÃ©s dans ce&#xA;fichier.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres@debian:~$ vi /etc/postgresql/17/main/pg_ident.conf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ã€ la fin du fichier, le dernier commentaire nous indique la syntaxe Ã  utiliser.&#xA;Dans notre cas, c&amp;rsquo;est l&amp;rsquo;utilisateur systÃ¨me &lt;code&gt;loxodata&lt;/code&gt; qui sera mappÃ© sur le seul&#xA;utilisateur de l&amp;rsquo;instanceÂ : &lt;code&gt;postgres&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Attention, d&amp;rsquo;un point de vue sÃ©curitÃ©, c&amp;rsquo;est une mauvaise pratique de mapper le&#xA;compte &lt;code&gt;postgres&lt;/code&gt;, il s&amp;rsquo;agit ici seulement d&amp;rsquo;un exemple simple pour la comprÃ©hension.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# MAPNAME       SYSTEM-USERNAME         PG-USERNAME&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;loxomap         loxodata                postgres&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cela n&amp;rsquo;est pas suffisant pour faire fonctionner le tout, le fichier &lt;code&gt;pg_hba.conf&lt;/code&gt;&#xA;doit aussi Ãªtre configurÃ© pour prendre en compte ce mappage.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres@debian:~$ vi /etc/postgresql/17/main/pg_hba.conf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pour notre exemple sous Debian, modifions la premiÃ¨re ligne non commentÃ©e de&#xA;notre fichier.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;local   all          postgres             peer          map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;loxomap&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;En ajoutant l&amp;rsquo;option &lt;code&gt;map=loxomap&lt;/code&gt;, chaque connexion locale sur le compte&#xA;&lt;code&gt;postgres&lt;/code&gt; qui est traitÃ©e par cette ligne du fichier utilisera le mappage dÃ©clarÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Il ne reste plus qu&amp;rsquo;Ã  recharger la configuration.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres@debian:~$ pg_ctlcluster &lt;span class=&#34;m&#34;&gt;17&lt;/span&gt; main reload&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;lancement-de-la-connexion&#34;&gt;Lancement de la connexion&lt;/h2&gt;&#xA;&lt;p&gt;Tentons une connexion depuis le compte &lt;code&gt;postgres&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres@debian:~$ psql&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psql: error: connection to server on socket &lt;span class=&#34;s2&#34;&gt;&amp;#34;/var/run/postgresql/.s.PGSQL.5432&amp;#34;&lt;/span&gt; failed: FATAL:  Peer authentication failed &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; user &lt;span class=&#34;s2&#34;&gt;&amp;#34;postgres&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Le fonctionnement a changÃ© ! On ne peut plus se connecter au compte &lt;code&gt;postgres&lt;/code&gt; comme&#xA;avant, sauf Ã  ajouter le compte systÃ¨me &lt;code&gt;postgres&lt;/code&gt; dans le mappage loxomap.&lt;/p&gt;&#xA;&lt;p&gt;Mais depuis le compte &lt;code&gt;loxodata&lt;/code&gt;, la connexion fonctionne dÃ©sormais comme attendu.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;loxodata@debian:~$ psql -U postgres&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psql &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;17.5 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Debian 17.5-1.pgdg120+1&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Type &lt;span class=&#34;s2&#34;&gt;&amp;#34;help&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; help.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;postgres&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;Avec cette mÃ©thode, il est simple pour un administrateur de gÃ©rer le mappage&#xA;d&amp;rsquo;un utilisateur systÃ¨me vers un rÃ´le de l&amp;rsquo;instance PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Il convient cependant d&amp;rsquo;Ãªtre vigilant sur la sÃ©curitÃ©. L&amp;rsquo;ouverture d&amp;rsquo;une&#xA;connexion depuis des comptes systÃ¨mes vers un compte de base de donnÃ©es peut&#xA;avoir des impacts sur l&amp;rsquo;exposition des donnÃ©es, voire pire dans le cas de&#xA;comptes privilÃ©giÃ©s.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 18 bÃªta 2</title>
    <updated>2025-07-18T13:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-07-18:/post/postgresql-18-beta-2/</id>
    <link href="http://www.loxodata.com/post/postgresql-18-beta-2/" rel="alternate"></link>
    <summary type="html">&lt;h1 id=&#34;postgresql-18-bÃªta-2-publiÃ©e&#34;&gt;PostgreSQL 18 BÃªta 2 publiÃ©e&lt;/h1&gt;&#xA;&lt;p&gt;Le PostgreSQL Global Development Group annonce la disponibilitÃ© de la&#xA;deuxiÃ¨me bÃªta de PostgreSQL 18 en&#xA;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;tÃ©lÃ©chargement&lt;/a&gt;.  Cette&#xA;publication contient un aperÃ§u des fonctionnalitÃ©s qui seront&#xA;disponibles dans la version finale de PostgreSQL 18. Des modifications&#xA;peuvent toutefois intervenir d&amp;rsquo;ici lÃ .&lt;/p&gt;&#xA;&lt;p&gt;Vous pouvez trouver des informations sur toutes les fonctionnalitÃ©s et&#xA;les changements de PostgreSQL 18 dans les &lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;notes de&#xA;version&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Dans l&amp;rsquo;esprit de la communautÃ© open source PostgreSQL, nous vous&#xA;encourageons fortement Ã  tester les nouvelles fonctionnalitÃ©s de&#xA;PostgreSQL dans vos systÃ¨mes de base de donnÃ©es. Ceci afin de nous&#xA;aider Ã  Ã©liminer les bogues et autres problÃ¨mes qui pourraient&#xA;exister. Bien que nous ne vous conseillions pas de faire fonctionner&#xA;PostgreSQL 18 BÃªta 2 dans vos environnements de production, nous vous&#xA;encourageons Ã  trouver des moyens de faire fonctionner votre charge&#xA;applicative typique avec cette publication bÃªta.&lt;/p&gt;&#xA;&lt;p&gt;Vos tests et vos commentaires aideront la communautÃ© Ã  s&amp;rsquo;assurer que&#xA;PostgreSQL 18 respecte nos standards de stabilitÃ© et fiabilitÃ©. Vous&#xA;pouvez Ã©galement vous renseigner sur notre &lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;processus de bÃªta&#xA;testing&lt;/a&gt; et comment y&#xA;contribuer.&lt;/p&gt;&#xA;&lt;h2 id=&#34;mise-Ã -jour-vers-postgresql-18-bÃªta-2&#34;&gt;Mise Ã  jour vers PostgreSQL 18 BÃªta 2&lt;/h2&gt;&#xA;&lt;p&gt;Pour mettre Ã  jour vers PostgreSQL 18 Beta 2 Ã  partir d&amp;rsquo;une prÃ©cÃ©dente&#xA;version de PostgreSQL, vous aurez besoin d&amp;rsquo;utiliser une stratÃ©gie&#xA;similaire Ã  la mise Ã  jour entre versions majeures de PostgreSQL&#xA;(i.e. &lt;code&gt;pg_upgrade&lt;/code&gt; ou &lt;code&gt;pg_dump&lt;/code&gt;/&lt;code&gt;pg_restore&lt;/code&gt;). Pour plus&#xA;d&amp;rsquo;information, merci de consulter la section de la documentation&#xA;concernant les mises Ã  jour.&lt;/p&gt;&#xA;&lt;h2 id=&#34;changement-depuis-la-publication-de-la-bÃªta-1&#34;&gt;Changement depuis la publication de la BÃªta 1&lt;/h2&gt;&#xA;&lt;p&gt;Les corrections et changements depuis la publication PostgreSQL 18 BÃªta&#xA;1 incluentÂ :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout du support des requÃªtes prÃ©parÃ©es dans la gestion des listes lors&#xA;du processus de normalisation de requÃªteÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Correctif pour la validation des clÃ©s Ã©trangÃ¨res sur les tables&#xA;partitionnÃ©esÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Suppression de la fonction &lt;code&gt;pg_get_process_memory_contexts()&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;Plusieurs correctifs sur les points d&amp;rsquo;injection de tests pour le&#xA;support des AIOÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Correctif sur &lt;code&gt;pg_dump&lt;/code&gt; pour les tables Ã  noms complexesÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Correction du calcul de l&amp;rsquo;emplacement de requÃªtes pour les requÃªtes&#xA;imbriquÃ©esÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Correction pour les mises Ã  jour depuis PostgreSQL 14 lorsque que le&#xA;nombre de lignes dans une table est inconnuÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Correction d&amp;rsquo;un dÃ©bordement de pile pour les analyseurs OAuthÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Utilisation par dÃ©faut de &lt;code&gt;--no-statistics&lt;/code&gt; pour &lt;code&gt;pg_dump&lt;/code&gt; et &lt;code&gt;pg_dumpall&lt;/code&gt;. Laisser le comportement par dÃ©faut de &lt;code&gt;pg_restore&lt;/code&gt; et &lt;code&gt;pg_upgrade&lt;/code&gt; avec &lt;code&gt;--with-statistics&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;VÃ©rification que &lt;code&gt;LOAD $libdir/&lt;/code&gt; fonctionneÂ ;&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©liorations de la fonction &lt;code&gt;amcheck&lt;/code&gt; pour le type d&amp;rsquo;index &lt;code&gt;GIN&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;Suppression de la fonction &lt;code&gt;PQservice()&lt;/code&gt; de la librairie &lt;code&gt;libpq&lt;/code&gt;Â ;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Veuillez consulter les notes de publication pour une liste complÃ¨te&#xA;des nouveautÃ©s et changementsÂ : &lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;https://www.postgresql.org/docs/18/release-18.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;tests-pour-le-dÃ©bogage-et-la-compatibilitÃ©&#34;&gt;Tests pour le dÃ©bogage et la compatibilitÃ©&lt;/h2&gt;&#xA;&lt;p&gt;La stabilitÃ© de chaque publication de PostgreSQL dÃ©pend de vous, la&#xA;communautÃ©. En testant la version Ã  venir avec votre charge et vos&#xA;outils de tests, vous pourrez nous aider Ã  trouver les bogues et&#xA;rÃ©gressions avant la publication de PostgreSQL 18.&lt;/p&gt;&#xA;&lt;p&gt;Ã‰tant donnÃ© qu&amp;rsquo;il s&amp;rsquo;agit d&amp;rsquo;une version bÃªta, des changements mineurs&#xA;dans le comportement de la base de donnÃ©es, des dÃ©tails et des APIs&#xA;sont toujours possibles. Vos retours et tests aideront Ã  dÃ©terminer&#xA;les ajustements finaux des nouvelles fonctionnalitÃ©s.&lt;/p&gt;&#xA;&lt;p&gt;La qualitÃ© des tests aide Ã  dÃ©terminer le moment de la publication&#xA;finale.&lt;/p&gt;&#xA;&lt;p&gt;Une liste des &lt;a href=&#34;https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items&#34;&gt;problÃ¨mes&#xA;ouverts&lt;/a&gt;&#xA;est publiquement disponible dans le wiki de PostgreSQL. Vous pouvez&#xA;&lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;rapporter des bogues&lt;/a&gt;&#xA;en utilisant le formulaire prÃ©sent sur le site web de&#xA;PostgreSQLÂ : &lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;https://www.postgresql.org/account/submitbug/&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;planning-bÃªta&#34;&gt;Planning BÃªta&lt;/h2&gt;&#xA;&lt;p&gt;Il s&amp;rsquo;agit de la deuxiÃ¨me publication bÃªta de la version 18. Le projet&#xA;PostgreSQL publiera autant de bÃªtas que nÃ©cessaire pour les&#xA;tests. Celles-ci seront suivies d&amp;rsquo;une ou plusieurs publications de&#xA;versions candidates, jusqu&amp;rsquo;Ã  la publication de la version finale&#xA;autour de septembre ou octobre 2025.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus d&amp;rsquo;information, veuillez consulter la page &lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;Beta&#xA;Testing&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;liens&#34;&gt;Liens&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargement&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;Information sur le BÃªta Testing&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;Note de publication de PostgreSQL 18 BÃªta&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items&#34;&gt;ProblÃ¨me connu de PostgreSQL 18&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/featurematrix/#configuration-management&#34;&gt;Matrice fonctionnelle&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;Soumettre un bogue&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://twitter.com/postgresql&#34;&gt;Suivre @postgresql sur X/Twitter&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;CrÃ©dits photo : Carlos Gonzalez&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL et Debezium</title>
    <updated>2025-06-03T08:30:00Z</updated>
    <id>tag:www.loxodata.com,2025-06-03:/post/postgresql-debezium/</id>
    <link href="http://www.loxodata.com/post/postgresql-debezium/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Dans cet article, nous allons regarder comment connecter PostgreSQL vers d&amp;rsquo;autres applications avec Debezium, dans le cadre d&amp;rsquo;un cluster Patroni assurant la haute disponibilitÃ©. Debezium repose sur un ensemble&#xA;de services distribuÃ©s conÃ§us pour capturer les changements survenants dans vos bases de donnÃ©es afin que d&amp;rsquo;autres applications puissent consulter ces changements et les consommer,&#xA;communÃ©ment appelÃ© &lt;code&gt;CDC&lt;/code&gt; pour &lt;code&gt;change data capture&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;debezium&#34;&gt;Debezium&lt;/h2&gt;&#xA;&lt;p&gt;Debezium propose de capturer les flux d&amp;rsquo;Ã©vÃ¨nements depuis vos bases de donnÃ©es permettant aux applications de rÃ©pondre Ã  des changements survenant au niveau des lignes de tables sur vos bases de donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Debezium repose sur le broker de messages &lt;a href=&#34;http://kafka.apache.org/&#34;&gt;Apache Kafka&lt;/a&gt; et fournit un ensemble de connecteurs sources pour &lt;a href=&#34;https://kafka.apache.org/documentation.html#connect&#34;&gt;Kafka Connect&lt;/a&gt; par type de sources, par exemple pour PostgreSQL. Le connecteur enregistre l&amp;rsquo;historique des changements sur une base de donnÃ©es en acquittant les changements au fil de l&amp;rsquo;eau et en sauvegardant chaque&#xA;Ã©vÃ¨nement dans un topic Kakfa (file de messages), et la position dans les journaux de transactions (WAL).&lt;/p&gt;&#xA;&lt;p&gt;Le connecteur Debezium pour PostgreSQL se base sur le &lt;a href=&#34;https://www.postgresql.org/docs/current/logicaldecoding.html&#34;&gt;dÃ©codage logique&lt;/a&gt; pour rÃ©cupÃ©rer les changements commitÃ©s dans les journaux de transactions et un &lt;a href=&#34;https://www.postgresql.org/docs/current/logicaldecoding-explanation.html#LOGICALDECODING-EXPLANATION-OUTPUT-PLUGINS&#34;&gt;plugin de sortie&lt;/a&gt; pour mettre en forme les donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL ne conserve pas tout l&amp;rsquo;historique des journaux de transactions, car les fichiers WAL sont recyclÃ©s quand nÃ©cessaire par PostgreSQL. Debezium doit donc gÃ¨rer lui mÃªme l&amp;rsquo;historique des lignes, et donc l&amp;rsquo;initialiser.&#xA;Ceci se fait Ã  la premiÃ¨re connexion par une sauvegarde de l&amp;rsquo;Ã©tat de la base de donnÃ©es (snapshot). Pour ce faire, le connecteur suit les Ã©tapes suivantes :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;CrÃ©ation d&amp;rsquo;une transaction avec un niveau d&amp;rsquo;isolation Ã  &lt;code&gt;SERIALIZABLE&lt;/code&gt; pour assurer la cohÃ©rence des donnÃ©es pour les lectures pendant cette transaction;&lt;/li&gt;&#xA;&lt;li&gt;Lecture de la position actuelle (LSN) du journal de transaction;&lt;/li&gt;&#xA;&lt;li&gt;Lecture des tables et schÃ©mas de la base de donnÃ©es et gÃ©nÃ©ration d&amp;rsquo;un Ã©vÃ¨nement &lt;code&gt;READ&lt;/code&gt; pour chaque ligne, chaque Ã©vÃ¨nement est ensuite Ã©crit dans un topic Kakfa correspondant Ã  la table;&lt;/li&gt;&#xA;&lt;li&gt;Commit de la transaction;&lt;/li&gt;&#xA;&lt;li&gt;Enregistrement de l&amp;rsquo;Ã©tat de la sauvegarde et la derniÃ¨re position (LSN) lue;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Ensuite, le connecteur entre dans sa boucle d&amp;rsquo;envoi d&amp;rsquo;Ã©vÃ¨nements consommÃ©s depuis PostgreSQL. Le connecteur convertit chaque changement en Ã©vÃ¨nement &lt;code&gt;create&lt;/code&gt;, &lt;code&gt;update&lt;/code&gt; ou &lt;code&gt;delete&lt;/code&gt; dÃ©finit par Debezium, avec son LSN et les enregistre dans Kakfa Connect, qui Ã  son tour les transmets Ã  un topic Kakfa. Kakfa Connect stocke en parallÃ¨le le LSN actuel afin de repartir de ce point lors de l&amp;rsquo;arrÃªt de Kakfa Connect.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;http://www.loxodata.com/images/post/pg-debezium-connector/pg-connector.png&#34; alt=&#34;Architecture&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;Ã€ l&amp;rsquo;image de cette premiÃ¨re architecture basÃ©e sur Kakfa Connect et Apache Kakfa, il existe deux autres types d&amp;rsquo;architecture disponible :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Un &lt;a href=&#34;https://debezium.io/documentation/reference/stable/operations/debezium-server.html&#34;&gt;serveur Debezium&lt;/a&gt;, une application pour diffuser les changements de bases de donnÃ©es sources vers des infrastructures de messagerie de type Redis par exemple;&lt;/li&gt;&#xA;&lt;li&gt;Une librairie &lt;a href=&#34;https://debezium.io/documentation/reference/stable/development/engine.html&#34;&gt;Debezium Engine&lt;/a&gt; intÃ©grÃ©e directement dans votre application Java;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;mise-en-place-avec-postgresql&#34;&gt;Mise en place avec PostgreSQL&lt;/h2&gt;&#xA;&lt;p&gt;Le connecteur Debezium pour PostgreSQL prend en charge deux plugins de sortie : &lt;code&gt;pgoutput&lt;/code&gt; qui est le plugin par dÃ©faut utilisÃ© avec la rÃ©plication logique ou &lt;a href=&#34;https://github.com/debezium/postgres-decoderbufs/blob/main/README.md&#34;&gt;&lt;code&gt;decoderbufs&lt;/code&gt;&lt;/a&gt; basÃ© sur le format &lt;a href=&#34;https://github.com/google/protobuf&#34;&gt;Protobuf&lt;/a&gt; et maintenu par la communautÃ© Debezium.&lt;/p&gt;&#xA;&lt;p&gt;Pour cet exemple, nous utilisons le plugin &lt;code&gt;decoderbufs&lt;/code&gt;. Nous ne dÃ©taillons pas la mise en place de Debezium et ses services associÃ©s, mais uniquement la mise en place cÃ´tÃ© PostgreSQL. Pour Debezium, il convient de se&#xA;rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://debezium.io/documentation/reference/stable/tutorial.html&#34;&gt;documentation&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il faut tout d&amp;rsquo;abord installer le plugin &lt;a href=&#34;https://github.com/debezium/postgres-decoderbufs/blob/main/README.md&#34;&gt;&lt;code&gt;decoderbufs&lt;/code&gt;&lt;/a&gt; sur votre serveur via le systÃ¨me de paquet appropriÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Sous RedHat, on peut par exemple utiliser la commande &lt;code&gt;dnf&lt;/code&gt; pour installer le paquet pour la version 14 de Postgresql en utilisant le dÃ©pÃ´t du PGDG :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dnf install postgres-decoderbufs_14.x86_64&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On vÃ©rifie l&amp;rsquo;installation du paquet avec :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dnf list installed postgres-decoderbufs_14.x86_64&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Installed Packages&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres-decoderbufs_14.x86_64   3.0.2-1PGDG.rhel9&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Puis on modifie la configuration de PostgreSQL via la commande &lt;code&gt;patronictl edit-config&lt;/code&gt; pour charger le plugin et autoriser le dÃ©codage logique via le paramÃ¨tre &lt;code&gt;wal_level&lt;/code&gt; Ã  &lt;code&gt;logical&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; patronictl -c /etc/patroni/patroni.yml edit-config --apply - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;_EOF_&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;postgresql:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  parameters:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;   shared_preload_libraries: decoderbufs&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;   wal_level: logical&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;_EOF_&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Et on redÃ©marre les instances pour prise en compte des paramÃ¨tres avec la commande &lt;code&gt;patronictl restart&lt;/code&gt; car Les paramÃ¨tres &lt;code&gt;wal_level&lt;/code&gt; et &lt;code&gt;shared_preload_libraries&lt;/code&gt; exige un redÃ©marrage de l&amp;rsquo;instance PostgreSQL.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patronictl -c /etc/patroni/config.yml restart --force loxodemo&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Il peut Ãªtre nÃ©cessaire d&amp;rsquo;affiner les paramÃ¨tres suivants selon votre cas d&amp;rsquo;usage :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;max_wal_senders&lt;/code&gt; (dÃ©faut Ã  10) : doit Ãªtre Ã©quivalent ou plus au nombre de slots de rÃ©plication, plus le nombre de rÃ©plicas prÃ©sents;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;max_replication_slots&lt;/code&gt; (dÃ©faut Ã  10) : indiquant le nombre de slots de rÃ©plication maximum (rÃ©plication logique et physique). Doit Ãªtre au moins Ã©gal au nombre de rÃ©plica et de souscription (pour chaque souscription, un apply worker et plusieurs tablesync worker);&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;max_slot_wal_keep_size&lt;/code&gt; (dÃ©faut Ã  -1) : permet d&amp;rsquo;indiquer la taille maximale de fichiers WAL pouvant Ãªtre conservÃ©s par un slot de rÃ©plication;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Nous crÃ©ons maintenant le rÃ´le de rÃ©plication dÃ©diÃ© au connecteur Debezium et ajoutons les permissions nÃ©cessaires.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ROLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;debezium_replication&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LOGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;REPLICATION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PASSWORD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;lt;redacted&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ROLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GRANT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SCHEMA&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;debezium_replication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GRANT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIVILEGES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SCHEMA&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GRANT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TO&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;debezium_replication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIVILEGES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On ajoute l&amp;rsquo;utilisateur crÃ©Ã© dans le fichier &lt;code&gt;.pgpass&lt;/code&gt; si ce dernier est utilisÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Il faut ensuite adapter le fichier &lt;code&gt;pg_hba.conf&lt;/code&gt; pour autoriser le connecteur Debezium Ã  se connecter Ã  l&amp;rsquo;instance PostgreSQL.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;host         demo         debezium_replication         &amp;lt;ip du connecteur ou plage autorisÃ©e&amp;gt;         scram-sha-256&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Nous crÃ©ons Ã  prÃ©sent la publication portant sur tous les schÃ©mas de la base de donnÃ©es, et crÃ©ons manuellement le slot de rÃ©plication. Il est possible de limiter les tables publiÃ©es dans la commande &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-createpublication.html&#34;&gt;&lt;code&gt;CREATE PUBLICATION&lt;/code&gt;&lt;/a&gt; ou de dÃ©finir un schÃ©ma en particulier.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PUBLICATION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pub_con_to_debezium&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PUBLICATION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_create_logical_replication_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;logical_pub_con_to_debezium_slot&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;decoderbufs&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;INFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exiting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;startup&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;callback&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;slot_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lsn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;----------------------------------+------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logical_pub_con_to_debezium_slot&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7901&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ACD8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Nous mettons Ã  jour la configuration de PostgreSQL via Patroni pour dÃ©clarer l&amp;rsquo;utilisation du slot de rÃ©plication logique et rechargeons la configuration.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; patronictl -c /etc/patroni/patroni.yml edit-config --apply - &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;_EOF_&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;postgresql:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  use_slots: true&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;slots:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  logical_pub_con_to_debezium_slot:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    database: demo&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    plugin: decoderbufs&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    type: logical  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;_EOF_&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;supervision&#34;&gt;Supervision&lt;/h2&gt;&#xA;&lt;p&gt;Une fois la configuration en place, il est nÃ©cessaire de surveiller la consommation des WAL et l&amp;rsquo;Ã©tat des slots de rÃ©plication. En effet, si le connecteur venait Ã  s&amp;rsquo;arrÃªter de consommer les donnÃ©es du slot de rÃ©plication,&#xA;le paramÃ¨tre &lt;code&gt;confirmed_flush_lsn&lt;/code&gt; n&amp;rsquo;Ã©tant pas mis Ã  jour, alors PostgreSQL va accumuler les fichiers WAL nÃ©cessaires au slot de rÃ©plication en attendant une reprise Ã©ventuelle. Ceci peut conduire Ã  la saturation du systÃ¨me de fichiers et entraÃ®ner dans le pire des cas l&amp;rsquo;arrÃªt de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;On peut utiliser des gardes fous comme le paramÃ¨tre &lt;code&gt;max_slot_wal_keep_size&lt;/code&gt; pour limiter la quantitÃ© de fichiers WAL conservÃ©e par un slot de rÃ©plication.&lt;/p&gt;&#xA;&lt;p&gt;Pour surveiller l&amp;rsquo;activitÃ© des slots de rÃ©plication, nous utilisons la vue &lt;a href=&#34;https://www.postgresql.org/docs/current/view-pg-replication-slots.html&#34;&gt;&lt;code&gt;pg_replication_slots&lt;/code&gt;&lt;/a&gt; (ici en version 14 de PostgreSQL).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_replication_slots&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RECORD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-------+---------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;slot_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logical_pub_con_to_debezium_slot&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plugin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoderbufs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;slot_type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logical&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datoid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16437&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;temporary&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;active&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;active_pid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2132668&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;xmin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;catalog_xmin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;134506175&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;restart_lsn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99983378&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;confirmed_flush_lsn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;999873&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wal_status&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;reserved&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;safe_wal_size&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;two_phase&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;active&lt;/code&gt; vaut &lt;code&gt;true&lt;/code&gt; si le slot Ã©met des donnÃ©es;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;catalog_xmin&lt;/code&gt; correspondant Ã  la transaction la plus ancienne affectant le catalogue systÃ¨me et requis par le slot;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;restart_lsn&lt;/code&gt; la position du plus ancien WAL requis par le slot;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;confirmed_flush_lsn&lt;/code&gt; la derniÃ¨re position reÃ§ue et rejouÃ©e cÃ´tÃ© consommateur;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;wal_status&lt;/code&gt; indique la disponibilitÃ© des fichiers WAL requis par le slot&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;On vÃ©rifie que les paramÃ¨tres &lt;code&gt;confirmed_flush_lsn&lt;/code&gt; et &lt;code&gt;restart_lsn&lt;/code&gt; soient bien incrÃ©mentÃ©s.&lt;/p&gt;&#xA;&lt;p&gt;On peut calculer en utilisant cette mÃªme vue la quantitÃ© de WAL retenue et le lag vers le connecteur.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;slot_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;active&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;confirmed_flush_lsn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_current_wal_lsn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_wal_lsn_diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_current_wal_lsn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;restart_lsn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;retained_walsize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_wal_lsn_diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_current_wal_lsn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;confirmed_flush_lsn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subscriber_lag&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_replication_slots&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;slot_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;active&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;confirmed_flush_lsn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_current_wal_lsn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;retained_walsize&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subscriber_lag&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;----------------------------------+--------+---------------------+--------------------+------------------+----------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logical_pub_con_to_debezium_slot&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EEAB53A0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FB3A6000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;239&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;201&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;retained_walsize&lt;/code&gt; la quantitÃ© de WAL (en octet) retenue par le slot cÃ´tÃ© publication&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;subscriber_lag&lt;/code&gt; le retard de rÃ©plication logique (en octet) entre la publication et la souscription.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;configuration-du-connecteur-debezium&#34;&gt;Configuration du connecteur Debezium&lt;/h2&gt;&#xA;&lt;p&gt;Afin de configurer le connecteur Debezium source pour PostgreSQL, il est nÃ©cessaire de fournir au minimum les Ã©lÃ©ments suivants dans un fichier json que l&amp;rsquo;on peut nommer &lt;code&gt;pg-example-connector.json&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pg-example-connector&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;connector.class&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;io.debezium.connector.postgresql.PostgresConnector&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;database.hostname&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pgdeb01&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;database.port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;5437&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;database.user&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;debezium_replication&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;database.password&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;lt;redacted&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;database.dbname&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;demo&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;plugin.name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;decoderbufs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;slot.name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;logical_pub_con_to_debezium_slot&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;#34;publication.name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pub_con_to_debezium&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La liste complÃ¨te des paramÃ¨tres de configuration du connecteur Debezium pour PostgreSQL est disponible dans la &lt;a href=&#34;https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-connector-properties&#34;&gt;documentation&lt;/a&gt; de Debezium.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;&lt;a href=&#34;https://kafka.apache.org/documentation/#connectapi&#34;&gt;API REST&lt;/a&gt; de Kafka Connect permet d&amp;rsquo;enregistrer de nouveaux connecteurs et de vÃ©rifier le status de ces derniers. Une fois enregistrÃ©, le connecteur est actif. CÃ´tÃ© Kakfa, il est possible d&amp;rsquo;utiliser l&amp;rsquo;utilitaire &lt;a href=&#34;https://kafka.apache.org/documentation/#quickstart_consume&#34;&gt;bin/kafka-console-consumer.sh&lt;/a&gt; pour s&amp;rsquo;abonner Ã  un topic donnÃ© et visualiser les messages reÃ§us depuis le connecteur PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Pour le reste des opÃ©rations de Apache Kafka, je vous renvoie Ã  la &lt;a href=&#34;https://kafka.apache.org/documentation/#gettingStarted&#34;&gt;documentation&lt;/a&gt; complÃ¨te de ce dernier.&lt;/p&gt;&#xA;&lt;p&gt;CrÃ©dits photo : Callum Blacoe&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17.5 et autres correctifs</title>
    <updated>2025-05-13T10:01:00Z</updated>
    <id>tag:www.loxodata.com,2025-05-13:/post/postgresql-17-5/</id>
    <link href="http://www.loxodata.com/post/postgresql-17-5/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le PGDG (PostgreSQL Global Development Group) a publiÃ© une mise Ã  jour&#xA;de toutes les versions supportÃ©es de PostgreSQL, incluant 17.5, 16.9, 15.13, 14.18&#xA;et 13.21.&lt;/p&gt;&#xA;&lt;p&gt;Cette publication corrige Ã©galement une vulnÃ©rabilitÃ© de sÃ©curitÃ© et plus de 60 bogues&#xA;reportÃ©s dans les mois prÃ©cÃ©dents.&lt;/p&gt;&#xA;&lt;h2 id=&#34;fin-du-support-de-la-version-13-de-postgresql&#34;&gt;Fin du support de la version 13 de PostgreSQL&lt;/h2&gt;&#xA;&lt;p&gt;La version 13 de PostgreSQL ne recevra plus de correctifs Ã  partir du 13 novembre 2025. Il est donc recommandÃ© de mettre Ã  jour vers une version majeure vos instances en production.&#xA;Se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;note de versions&lt;/a&gt; pour plus d&amp;rsquo;informations.&lt;/p&gt;&#xA;&lt;h2 id=&#34;problÃ¨mes-de-sÃ©curitÃ©&#34;&gt;ProblÃ¨mes de sÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-4207/&#34;&gt;CVE-2025-4207&lt;/a&gt; :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;CVSS v3.1 Base Score: 5.9&lt;/li&gt;&#xA;&lt;li&gt;Supported, Vulnerable Versions: 13 - 17.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Lors de lâ€™utilisation de lâ€™encodage GB18030 (encodage officiel chinois), il est possible Ã  un attaquant dâ€™effectuer une lecture au-delÃ  du tampon de validation de cet encodage. Cette lecture provoque un arrÃªt du processus et induit un dÃ©ni de service temporaire. Cette vulnÃ©rabilitÃ© concerne le serveur de bases de donnÃ©es PotgreSQL et la bibliothÃ¨que libpq.&#xA;Les versions antÃ©rieures Ã  PostgreSQL 17.5, 16.9, 15.13, 14.18, et 13.21 sont affectÃ©es.&lt;/p&gt;&#xA;&lt;h2 id=&#34;corrections-de-bogues-et-amÃ©liorations&#34;&gt;Corrections de bogues et amÃ©liorations&lt;/h2&gt;&#xA;&lt;p&gt;Cette mise Ã  jour corrige plus de 60 bogues ayant Ã©tÃ© signalÃ©s durant les mois prÃ©cÃ©dents. Les problÃ¨mes ci-dessous concernent PostgreSQL 17. Certains de ces problÃ¨mes peuvent aussi concerner d&amp;rsquo;autres versions de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Les correctifs sont :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;gestion correcte des clÃ©s Ã©trangÃ¨res autorÃ©fÃ©rentielles sur les tables partitionnÃ©es. La crÃ©ation ou l&amp;rsquo;attachement d&amp;rsquo;une partition ne crÃ©ait pas les entrÃ©es de catalogue requises pour une contrainte de clÃ© Ã©trangÃ¨re si la table rÃ©fÃ©rencÃ©e par la contrainte Ã©tait la mÃªme table partitionnÃ©e. Il en rÃ©sultait que la contrainte pouvait ne pas Ãªtre respectÃ©e. Pour corriger ce problÃ¨me, veuillez consulter les instructions de la section Â« Mise Ã  jour Â» ;&lt;/li&gt;&#xA;&lt;li&gt;correction d&amp;rsquo;un problÃ¨me de perte de donnÃ©es lors de l&amp;rsquo;utilisation d&amp;rsquo;index &lt;code&gt;BRIN bloom&lt;/code&gt; (en utilisant par exemple la classe d&amp;rsquo;opÃ©rateur &lt;code&gt;date_bloom_ops&lt;/code&gt;) ;&lt;/li&gt;&#xA;&lt;li&gt;correction de &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-merge.html&#34;&gt;&lt;code&gt;MERGE&lt;/code&gt;&lt;/a&gt; dans une table partitionnÃ©e avec des actions &lt;code&gt;DO NOTHING&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;prÃ©vention de l&amp;rsquo;Ã©chec des commandes &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-insert.html&#34;&gt;&lt;code&gt;INSERT&lt;/code&gt;&lt;/a&gt; lorsque la table possÃ¨de une colonne &lt;code&gt;GENERATED&lt;/code&gt; d&amp;rsquo;un &lt;a href=&#34;https://www.postgresql.org/docs/current/domains.html&#34;&gt;&lt;code&gt;type de domaine&lt;/code&gt;&lt;/a&gt; et que les contraintes du domaine interdisent les valeurs &lt;code&gt;NULL&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;correction de la commande &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-altertable.html&#34;&gt;&lt;code&gt;ALTER TABLE ... ADD COLUMN&lt;/code&gt;&lt;/a&gt; pour gÃ©rer correctement le cas d&amp;rsquo;un type de domaine qui a sa propre valeur par dÃ©faut et que la valeur &lt;code&gt;DEFAULT&lt;/code&gt; pour la colonne n&amp;rsquo;est pas dÃ©finie.&lt;/li&gt;&#xA;&lt;li&gt;correction de problÃ¨mes lors de conversion de types dans les clÃ©s des expressions de constructeurs &lt;code&gt;JSON&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;correction de &lt;a href=&#34;https://www.postgresql.org/docs/current/datatype-xml.html&#34;&gt;&lt;code&gt;XMLSERIALIZE()&lt;/code&gt;&lt;/a&gt; pour que l&amp;rsquo;option &lt;code&gt;INDENT&lt;/code&gt; soit correctement supprimÃ©e lorsqu&amp;rsquo;elle est prÃ©sente dans les vues ou les rÃ¨gles. Ceci Ã©tait perceptible lors de restaurations ;&lt;/li&gt;&#xA;&lt;li&gt;corrections pour le planificateur de requÃªtes, Ã©vitant l&amp;rsquo;Ã©valuation prÃ©maturÃ©e des arguments dans une fonction d&amp;rsquo;agrÃ©gation ayant Ã  la fois des clauses &lt;code&gt;FILTER&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; ou &lt;code&gt;DISTINCT&lt;/code&gt; qui pourraient conduire Ã  des Ã©checs ;&lt;/li&gt;&#xA;&lt;li&gt;correction sur le retour de rÃ©sultats incorrects lors d&amp;rsquo;un &lt;code&gt;bitmap scan&lt;/code&gt; sans colonnes de sortie qui est exÃ©cutÃ© alors que &lt;code&gt;vacuum&lt;/code&gt; est Ã©galement en cours d&amp;rsquo;exÃ©cution sur la mÃªme table ;&lt;/li&gt;&#xA;&lt;li&gt;correction des problÃ¨mes de performance dans le dÃ©marrage de la recherche d&amp;rsquo;index &lt;code&gt;GIN&lt;/code&gt; lorsqu&amp;rsquo;il y a beaucoup de clÃ©s de recherche, par exemple, &lt;code&gt;jsonbcol ?| array[...]&lt;/code&gt; avec des dizaines de milliers d&amp;rsquo;Ã©lÃ©ments dans la liste ;&lt;/li&gt;&#xA;&lt;li&gt;s&amp;rsquo;assurer que les statistiques d&amp;rsquo;E/S des &lt;code&gt;WAL senders&lt;/code&gt; actifs soient rapportÃ©es dans un dÃ©lai maximum d&amp;rsquo;une seconde ;&lt;/li&gt;&#xA;&lt;li&gt;correction d&amp;rsquo;une condition de concurrence dans la gestion de &lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT&#34;&gt;&lt;code&gt;synchronous_standby_names&lt;/code&gt;&lt;/a&gt; immÃ©diatement aprÃ¨s le dÃ©marrage, oÃ¹ un backend pourrait ne pas attendre un commit synchrone ;&lt;/li&gt;&#xA;&lt;li&gt;Ã©viter une boucle infinie si &lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-connection.html#GUC-SCRAM-ITERATIONS&#34;&gt;&lt;code&gt;scram_iterations&lt;/code&gt;&lt;/a&gt; est fixÃ© Ã  &lt;code&gt;INT_MAX&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;corrections pour la rÃ©plication logique, y compris la gestion de vacuum autour des lignes supprimÃ©es qui sont toujours nÃ©cessaires pour le dÃ©codage logique ;&lt;/li&gt;&#xA;&lt;li&gt;prÃ©vention des pertes de donnÃ©es potentielles lorsque des opÃ©rations de modification de schÃ©ma (DDL) qui ne prennent pas de verrous forts affectent des tables qui sont rÃ©pliquÃ©es logiquement ;&lt;/li&gt;&#xA;&lt;li&gt;prÃ©venir les problÃ¨mes dans la rÃ©plication logique qui pourraient permettre l&amp;rsquo;enregistrement de donnÃ©es dupliquÃ©es en raison de la gestion des erreurs du &lt;code&gt;apply worker&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;amÃ©lioration de la maniÃ¨re dont &lt;a href=&#34;https://www.postgresql.org/docs/current/app-reindexdb.html&#34;&gt;&lt;code&gt;reindexdb&lt;/code&gt;&lt;/a&gt; gÃ¨re la planification des opÃ©rations de rÃ©indexation parallÃ¨le afin d&amp;rsquo;obtenir le niveau de parallÃ©lisme attendu ;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cette version met Ã©galement Ã  jour les fichiers de donnÃ©es de fuseaux horaires avec la version 2025b de &lt;code&gt;tzdata&lt;/code&gt; pour les changements de loi de l&amp;rsquo;heure d&amp;rsquo;Ã©tÃ© au Chili, ainsi que des corrections historiques pour l&amp;rsquo;Iran. En outre, un nouveau fuseau horaire &lt;code&gt;America/Coyhaique&lt;/code&gt; a Ã©tÃ© crÃ©Ã© pour la rÃ©gion d&amp;rsquo;AysÃ©n au Chili, afin de tenir compte du fait qu&amp;rsquo;elle passe Ã  UTC-03 tout au long de l&amp;rsquo;annÃ©e, ce qui diverge d&amp;rsquo;&lt;code&gt;America/Santiago&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;mise-Ã -jour&#34;&gt;Mise Ã  jour&lt;/h2&gt;&#xA;&lt;p&gt;Toutes les publications de mises Ã  jour de PostgreSQL sont&#xA;cumulatives. Comme pour les autres mises Ã  jour mineures, il n&amp;rsquo;est pas&#xA;nÃ©cessaire d&amp;rsquo;extraire et de recharger les bases de donnÃ©es ni&#xA;d&amp;rsquo;utiliser &lt;code&gt;pg_upgrade&lt;/code&gt; pour appliquer cette mise Ã  jourÂ ;&#xA;il suffit simplement d&amp;rsquo;arrÃªter PostgreSQL et de mettre Ã  jour les binaires.&lt;/p&gt;&#xA;&lt;p&gt;Les utilisateurs ayant sautÃ© une ou plusieurs mises Ã  jour peuvent&#xA;avoir besoin d&amp;rsquo;Ã©tapes additionnelles aprÃ¨s la mise Ã  jour.&#xA;Les notes de publication des versions prÃ©cÃ©dentes fournissent les dÃ©tails.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus de dÃ©tails, se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;note de publication de versions&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;liens&#34;&gt;Liens&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargements&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;Notes de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/&#34;&gt;Page sur la sÃ©curitÃ©&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;Politique de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Si vous avez des corrections ou suggestions sur cette annonce de publication, merci de les envoyer Ã  la mailing liste publique &lt;a href=&#34;https://www.postgresql.org/list/&#34;&gt;&lt;em&gt;pgsql-www@lists.postgresql.org&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Base de donnÃ©es la plus dÃ©sirÃ©e trois annÃ©es consÃ©cutives : L&#39;attrait de PostgreSQL pour les dÃ©veloppeurs</title>
    <updated>2025-08-09T00:00:00Z</updated>
    <id>tag:www.data-bene.io,2025-08-09:/fr/blog/base-de-donnees-la-plus-desiree-trois-annees-consecutives/</id>
    <content type="html"> &lt;p&gt;PostgreSQL vit plus quâ€™un simple moment de gloireâ€”elle Ã©tablit un schÃ©ma clair dâ€™excellence soutenue. Pour la troisiÃ¨me annÃ©e consÃ©cutive, cette base de donnÃ©es pilotÃ©e par la communautÃ© a revendiquÃ© la premiÃ¨re place dans les rÃ©sultats 2025 de lâ€™enquÃªte annuelle des dÃ©veloppeurs de Stack Overflow, et les rÃ©sultats rÃ©vÃ¨lent Ã  la fois ce que les dÃ©veloppeurs valorisent aujourdâ€™hui et oÃ¹ se dirige le paysage des bases de donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Les rÃ©sultats de lâ€™enquÃªte montrent que PostgreSQL est classÃ©e au plus haut rang parmi toutes les technologies de bases de donnÃ©es pour les dÃ©veloppeurs qui veulent lâ€™utiliser dans la prochaine annÃ©e (47%) ou lâ€™ont utilisÃ©e cette annÃ©e et veulent continuer Ã  lâ€™utiliser lâ€™annÃ©e prochaine (66%) pour la troisiÃ¨me annÃ©e dâ€™affilÃ©e.&lt;/p&gt;&#xA;&lt;h2 id=&#34;les-chiffres-racontent-une-histoire-convaincante&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#les-chiffres-racontent-une-histoire-convaincante&#34;&gt;Les chiffres racontent une histoire convaincante&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Les donnÃ©es de lâ€™enquÃªte de plus de 49 000 dÃ©veloppeurs Ã  travers 177 pays fournissent une preuve claire de lâ€™attrait soutenu de PostgreSQL. Depuis 2023, PostgreSQL sâ€™est constamment classÃ©e comme la technologie de base de donnÃ©es la plus dÃ©sirÃ©e et la plus admirÃ©e parmi les dÃ©veloppeurs.&lt;/p&gt;&#xA;&lt;p&gt;En regardant les mesures spÃ©cifiques des visualisations de lâ€™enquÃªte, PostgreSQL mÃ¨ne avec 46,5% des dÃ©veloppeurs voulant travailler avec elle dans lâ€™annÃ©e Ã  venir, tandis quâ€™un impressionnant 65,5% de ceux qui lâ€™ont utilisÃ©e veulent continuer Ã  le faire. Ce ne sont pas seulement des chiffres impressionnantsâ€”ils reprÃ©sentent une cohÃ©rence qui est rare dans le paysage technologique en rapide Ã©volution.&lt;/p&gt;&#xA;&lt;p&gt;Les donnÃ©es de lâ€™enquÃªte rÃ©vÃ¨lent Ã©galement un schÃ©ma intÃ©ressant parmi les dÃ©veloppeurs utilisant actuellement dâ€™autres technologies de bases de donnÃ©es. Les dÃ©veloppeurs travaillant avec MongoDB et Redis montrent un dÃ©sir particuliÃ¨rement fort dâ€™ajouter PostgreSQL Ã  leur boÃ®te Ã  outils lâ€™annÃ©e prochaine, voyant la valeur dâ€™ajouter des compÃ©tences en bases de donnÃ©es relationnelles Ã  leur rÃ©pertoire.&lt;/p&gt;&#xA;&lt;h2 id=&#34;lavantage-communautaire-en-action&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#lavantage-communautaire-en-action&#34;&gt;Lâ€™avantage communautaire en action&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Pourquoi PostgreSQL a-t-elle atteint ce niveau de succÃ¨s soutenu ? La rÃ©ponse rÃ©side dans son modÃ¨le de dÃ©veloppement pilotÃ© par la communautÃ©. En tant que projet open source, PostgreSQL bÃ©nÃ©ficie dâ€™un dÃ©veloppement collaboratif qui est Ã  la fois transparent et rÃ©actif aux besoins du monde rÃ©el.&lt;/p&gt;&#xA;&lt;p&gt;Le projet PostgreSQL reprÃ©sente le meilleur de ce que le dÃ©veloppement pilotÃ© par la communautÃ© peut accomplir. Avec plus de 400 contributeurs de code Ã  travers plus de 140 entreprises de soutien, le projet se vante de plus de 55 000 commits et plus de 1,6 million de lignes de code soigneusement Ã©laborÃ©. Cette approche diverse et globalement distribuÃ©e du dÃ©veloppement rÃ©sulte en des tests plus approfondis, des corrections de bogues plus rapides, et des fonctionnalitÃ©s plus innovantes que les modÃ¨les de dÃ©veloppement commercial traditionnels nâ€™atteignent typiquement.&lt;/p&gt;&#xA;&lt;p&gt;Les versions majeures sont publiÃ©es annuellement avec approximativement 180 fonctionnalitÃ©s par version, complÃ©tÃ©es par des versions mineures trimestrielles qui incluent de nombreuses amÃ©liorations et corrections. Cette cadence rÃ©guliÃ¨re dâ€™innovation constamment contribuÃ©e par des individus partout dans le monde assure que PostgreSQL ne fait pas que suivre le rythme des besoins des dÃ©veloppeursâ€”elle les anticipe. Plus que cela, chaque individu a la capacitÃ© de contribuer au projet pour sâ€™assurer que partout oÃ¹ le logiciel prend du retard, la fonctionnalitÃ© change pour rÃ©pondre aux demandes modernes.&lt;/p&gt;&#xA;&lt;h2 id=&#34;plus-quune-simple-base-de-donnees-relationnelle&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#plus-quune-simple-base-de-donnees-relationnelle&#34;&gt;Plus quâ€™une simple base de donnÃ©es relationnelle&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Un facteur clÃ© dans lâ€™attrait large de PostgreSQL est quâ€™elle nâ€™est pas limitÃ©e Ã  Ãªtre juste un systÃ¨me de base de donnÃ©es relationnelle. PostgreSQL est objet-relationnelle par conception, capable de gÃ©rer des types de donnÃ©es diverses incluant JSON/JSONB, XML, ClÃ©-Valeur, gÃ©omÃ©triques, gÃ©ospatiales, UUID natif, et donnÃ©es de sÃ©ries temporelles. Cette polyvalence explique pourquoi les dÃ©veloppeurs de milieux NoSQL trouvent PostgreSQL attractiveâ€”elle offre la fiabilitÃ© relationnelle tout en maintenant la flexibilitÃ© Ã  laquelle ils sont habituÃ©s.&lt;/p&gt;&#xA;&lt;p&gt;Le soutien Ã©tendu pour diffÃ©rents types de donnÃ©es, combinÃ© avec les caractÃ©ristiques ACID (AtomicitÃ©, CohÃ©rence, Isolation, DurabilitÃ©), permet une gestion de donnÃ©es optimisÃ©e, performante, et fiable indÃ©pendamment des exigences spÃ©cifiques en place. De plus, lâ€™Ã©norme rÃ©seau dâ€™extensions pilotÃ© par la communautÃ© de PostgreSQL sâ€™appuie sur son extensibilitÃ© native, fournissant des solutions pour la gestion gÃ©ospatiale, la rÃ©cupÃ©ration aprÃ¨s sinistre, lâ€™infrastructure de haute disponibilitÃ©, la surveillance, lâ€™audit, et bien plus.&lt;/p&gt;&#xA;&lt;h2 id=&#34;le-paysage-plus-large-des-bases-de-donnees&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#le-paysage-plus-large-des-bases-de-donnees&#34;&gt;Le paysage plus large des bases de donnÃ©es&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Tandis que PostgreSQL domine les positions de tÃªte, lâ€™enquÃªte rÃ©vÃ¨le un Ã©cosystÃ¨me de bases de donnÃ©es sain et compÃ©titif. Les classements complets montrent :&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Bases de donnÃ©es les plus dÃ©sirÃ©es :&lt;/strong&gt;&lt;br&gt;&#xA;â€¢ PostgreSQL : 46,5%&lt;br&gt;&#xA;â€¢ SQLite : 28,3%&lt;br&gt;&#xA;â€¢ Redis : 23,5%&lt;br&gt;&#xA;â€¢ MySQL : 20,5%&lt;br&gt;&#xA;â€¢ MongoDB : 17,6%&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Bases de donnÃ©es les plus admirÃ©es :&lt;/strong&gt;&lt;br&gt;&#xA;â€¢ PostgreSQL : 65,5%&lt;br&gt;&#xA;â€¢ SQLite : 59%&lt;br&gt;&#xA;â€¢ Redis : 54,9%&lt;br&gt;&#xA;â€¢ MongoDB : 45,7%&lt;br&gt;&#xA;â€¢ MySQL : 43,2%&lt;/p&gt;&#xA;&lt;p&gt;Ces chiffres reflÃ¨tent un Ã©cosystÃ¨me diversifiÃ© oÃ¹ diffÃ©rentes bases de donnÃ©es servent des objectifs spÃ©cifiques. La forte performance de SQLite souligne lâ€™importance continue des solutions lÃ©gÃ¨res et intÃ©grÃ©es. Redis maintient sa position comme une base de donnÃ©es spÃ©cialisÃ©e hautement considÃ©rÃ©e pour la mise en cache et les applications temps rÃ©el. Les bases de donnÃ©es traditionnelles comme MySQL et Microsoft SQL Server continuent de dÃ©tenir des positions significatives, tandis que les nouvelles technologies comme DuckDB montrent des scores dâ€™admiration impressionnants malgrÃ© des taux dâ€™utilisation plus faibles.&lt;/p&gt;&#xA;&lt;h2 id=&#34;la-fondation-du-succes-durable-de-postgresql&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#la-fondation-du-succes-durable-de-postgresql&#34;&gt;La fondation du succÃ¨s durable de PostgreSQL&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Trois annÃ©es consÃ©cutives au sommet des prÃ©fÃ©rences des dÃ©veloppeurs nâ€™arrive pas par accident. La domination soutenue de PostgreSQL dÃ©coule de forces fondamentales qui continuent de bien servir les dÃ©veloppeurs alors que les paysages technologiques changent. La rÃ©silience intÃ©grÃ©e dans PostgreSQL Ã  travers son modÃ¨le de dÃ©veloppement pilotÃ© par la communautÃ© signifie quâ€™elle sâ€™adapte sans perdre la stabilitÃ©. Son extensibilitÃ© la distingue de maniÃ¨res pratiquesâ€”plutÃ´t que dâ€™attendre les feuilles de route des fournisseurs ou de sâ€™inquiÃ©ter des lacunes de fonctionnalitÃ©s, les dÃ©veloppeurs peuvent construire ce dont ils ont besoin ou tirer parti de lâ€™Ã©cosystÃ¨me Ã©tendu dâ€™extensions communautaires. La nature open source assure que PostgreSQL reste focalisÃ©e sur les besoins des dÃ©veloppeurs plutÃ´t que sur les modÃ¨les dâ€™affaires, avec des corrections de bogues qui se produisent rapidement et des fonctionnalitÃ©s qui se dÃ©veloppent basÃ©es sur des cas dâ€™usage du monde rÃ©el.&lt;/p&gt;&#xA;&lt;p&gt;AprÃ¨s 35 ans de dÃ©veloppement actif et trois annÃ©es consÃ©cutives comme la technologie de base de donnÃ©es la plus dÃ©sirÃ©e, PostgreSQL a prouvÃ© que le dÃ©veloppement open source pilotÃ© par la communautÃ© peut livrer Ã  la fois une utilitÃ© immÃ©diate et une valeur Ã  long terme. Pour les dÃ©veloppeurs et organisations regardant leurs choix de bases de donnÃ©es, PostgreSQL offre quelque chose dâ€™increasingly rare : une technologie qui sâ€™amÃ©liore avec le temps sans laisser ses utilisateurs derriÃ¨re.&lt;/p&gt;&#xA; </content>
    <link href="https://www.data-bene.io/fr/blog/base-de-donnees-la-plus-desiree-trois-annees-consecutives/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Sarah Conway</name>
    </author>
  </entry>
  <entry>
    <title>Retour de HOW2025</title>
    <updated>2025-07-14T00:00:00Z</updated>
    <id>tag:www.data-bene.io,2025-07-14:/fr/blog/retour-de-how2025/</id>
    <content type="html"> &lt;p&gt;Les 27 et 28 juin se tenaient les confÃ©rences Highgo Open World, consacrÃ©es Ã  lâ€™Ã©cosystÃ¨me PostgreSQL et au projet IvorySQL. CÃ´tÃ© chiffres, le succÃ¨s est notableâ€¯: prÃ¨s de 1â€¯000 participants sur place, jusquâ€™Ã  8â€¯000 connexions simultanÃ©es sur les streams, et environ 25â€¯000 spectateurs au total.&lt;/p&gt;&#xA;&lt;p&gt;Le programme comptait 101 confÃ©rences techniques animÃ©es par 105 intervenants. La majoritÃ© des sessions Ã©taient en mandarin, avec un track anglophone proposÃ© en traduction simultanÃ©e. Vous pouvez consulter le programme complet sur &lt;a href=&#34;https://ivorysql.io/schedule/&#34; rel=&#34;noopener&#34;&gt;IvorySQL.io&lt;/a&gt; et retrouver les replays sur Weibo via &lt;a href=&#34;https://ivorysql.io/2025/06/27/live-access-june27/&#34; rel=&#34;noopener&#34;&gt;ce lien.&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Nous Ã©tions un petit groupe de la communautÃ© internationale prÃ©sents, dont &lt;a href=&#34;https://postgresql.life/post/grant_zhou/&#34; rel=&#34;noopener&#34;&gt;Grant Zhou&lt;/a&gt; qui assure entre autre la liaison et la collaboration avec lâ€™association PostgreSQL en Chine et dans le reste du monde.&lt;/p&gt;&#xA;&lt;p&gt;Sur le plan technique, le contenu Ã©tait dense et particuliÃ¨rement intÃ©ressant. Jâ€™ai retenu notammentâ€¯:&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;La prÃ©sentation dâ€™Alena Rybakina sur le planificateur de requÃªtes PostgreSQL et les stratÃ©gies pour contourner certaines limites.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Un focus clair et concret sur Patroni (Haute-DisponibilitÃ©) par Alexander Kukushkin et Polina Bungina.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Florentz Tselai a prÃ©sentÃ© 2 sujets en appliquant ses prÃ©ceptes: simplicitÃ© efficacitÃ©, sur lâ€™utilisation de Â«lâ€™IAÂ» avec PostgreSQL et la gestion des donnÃ©es avec comme support Sun Tzu et les 36 stratagÃ¨mes.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Ã‰galement une trÃ¨s bonne introduction Ã  Bazel et son utilisation pour Monogres (Ã  dÃ©couvrir bientÃ´t) prÃ©sentÃ© avec Ã©nergie par Alvaro Hernandez.&lt;/p&gt;&#xA;&lt;p&gt;Monogres est une initiative trÃ¨s intÃ©ressante qui doit permettre de renforcer le contrÃ´le de la supply chain logicielle, un thÃ¨me  majeur dans lâ€™IT de nos jours. Et jâ€™y ai aussi vu une trÃ¨s belle occasion dâ€™offrir une vitrine a des variations de PostgreSQL avec des fonctionnalitÃ©s et des correctifs dont lâ€™inclusion dans PostgreSQL lui-mÃªme mÃªme ou le backport dans des version majeures prÃ©cÃ©dentes nâ€™est pas toujours possible.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Michael Meskes avait lâ€™honneur dâ€™une confÃ©rence plÃ©niÃ¨re pour un sujet qui le mÃ©rite largement: Â« From Code to Commerce: Open Source Business Models Today Â», une keynote sur lâ€™open-source et les logiciels libres, appliquÃ©s Ã  lâ€™Ã©cosystÃ¨me PostgreSQL.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Mon collÃ¨gue Andrea a prÃ©sentÃ© les Ã©volutions et les tendances des entreprises pour transiter vers IvorySQL et PostgreSQL&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Pour ma part, jâ€™ai prÃ©sentÃ© linux PSI dans le contexte PostgreSQL.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Comme tout est en streaming, je vous encourage Ã  aller explorer et visionner les sujets qui vous intÃ©ressent. Il y a ausi des confÃ©rences en anglais prÃ©-enregistrÃ©es mais jâ€™avoue avoir profitÃ© des crÃ©neaux pour Ã©changer avec des participants.&lt;/p&gt;&#xA;&lt;p&gt;En appartÃ© des confÃ©rences, jâ€™ai eu la chance de rencontrer plusieurs membres de la communautÃ© PostgreSQL chinoise trÃ¨s rÃ©putÃ©s pour leur implication dans le succÃ¨s de PostgreSQL localement. Jâ€™ai eu aussi lâ€™occasion dâ€™en apprendre dâ€™avantage sur Cloudberry, en remplacement de Greenplum, merci Dianjin Wang!&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;Pour Data Bene sâ€™Ã©tait Ã©galement un moment prÃ©vu pour rencontrer lâ€™Ã©quipe en charge dâ€™IvorySQL, basÃ©e en grande partie dans le Shandong, la province oÃ¹ se trouve Jinan, ville hÃ´te des confÃ©rences. Ivory est un projet auquel nous participons activement et qui permet aux entreprises de sâ€™affranchir dâ€™Oracle Â«en douceurÂ». Câ€™est un sujet important pour nos clients et qui occupe un place prÃ©pondÃ©rante dans notre partenariat avec Highgo: ils portent ce projet depuis plusieurs annÃ©es dÃ©jÃ  et nous voulons permettre aux entreprises europÃ©enes dâ€™en profiter avec un accompagnement et expertise adaptÃ©e.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;Les confÃ©rences Ã©taient trÃ¨s bien organisÃ©es et lâ€™acceuil formidable, le Â«Social EventÂ» au Â«beer gardenÂ» local parfaitement adaptÃ© Ã  la chaleur de Jinan fin juin!&lt;/p&gt;&#xA;&lt;p&gt;Vu le programme des confÃ©rences jâ€™ai amÃ¨rement regretÃ© de ne rien comprendre (Il y avait 1 track en Anglais et 5 en Mandarin) â€¦ mais il se dit dÃ©jÃ  que lâ€™an prochain les confÃ©rences en Mandarin pourraient peut Ãªtre Ãªtre traduites (en anglais), et la date avancÃ©e en Mai pour profiter dâ€™un climat plus doux.&lt;/p&gt;&#xA;&lt;p&gt;Il y a tellement Ã  y apprendre que jâ€™y retournerai avec grand plaisir.&lt;/p&gt;&#xA; </content>
    <link href="https://www.data-bene.io/fr/blog/retour-de-how2025/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Sarah Conway</name>
    </author>
  </entry>
  <entry>
    <title>Une visite Ã  PGConf.DE 2025 et des discussions sur PostgreSQL dans le contexte des sciences de la vie</title>
    <updated>2025-06-06T00:00:00Z</updated>
    <id>tag:www.data-bene.io,2025-06-06:/fr/blog/une-visite-a-pgconfde-2025-et-des-discussions-sur-PostgreSQL-dans-le-contexte-des-sciences-de-la-vie/</id>
    <content type="html"> &lt;p&gt;Câ€™est toujours un plaisir dâ€™assister aux Ã©vÃ©nements Postgres, et la &lt;a href=&#34;http://PGConf.DE&#34; rel=&#34;noopener&#34;&gt;PGConf.DE&lt;/a&gt; 2025 Ã  Berlin nâ€™a pas fait exception. Cette annÃ©e, lâ€™Ã©vÃ©nement a permis de renouer de vieilles amitiÃ©s et a offert un environnement ouvert et accueillant pour en nouer de nouvelles. Et, bien sÃ»r, il y a eu des exposÃ©s passionnants!&lt;/p&gt;&#xA;&lt;p&gt;Lors de la confÃ©rence, jâ€™ai eu lâ€™occasion de parler de Postgres dans le contexte des sciences de la vie (voir la section suivante). Dans lâ€™ensemble, jâ€™ai trouvÃ© quâ€™il y avait une belle diversitÃ© de prÃ©sentationsÂ : une sÃ©lection qui couvrait le cÅ“ur de Postgres, son Ã©cosystÃ¨me et bien plus encore.&lt;/p&gt;&#xA;&lt;p&gt;Je suis convaincu quâ€™Ã  la fin de la confÃ©rence, la plupart des participants, sinon tous, sont repartis plus riches quâ€™ils nâ€™Ã©taient venus, dâ€™une maniÃ¨re ou dâ€™une autre.&lt;/p&gt;&#xA;&lt;h2 id=&#34;presentations&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#presentations&#34;&gt;PrÃ©sentations&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;En amont de cet Ã©vÃ©nement, jâ€™ai eu lâ€™honneur de voir lâ€™une de mes confÃ©rences retenue. Son titre Ã©taitÂ : Â«Â &lt;a href=&#34;https://www.postgresql.eu/events/pgconfde2025/schedule/session/6541-postgres-and-life-science-from-cells-to-stars/&#34; rel=&#34;noopener&#34;&gt;Postgres et les sciences de la vieÂ : des cellules aux Ã©toiles&lt;/a&gt;&amp;quot; et il Ã©tait organisÃ© comme une mÃ©ta-analyse / un hommage Ã  lâ€™extensibilitÃ© de Postgres et Ã  ses diverses applications au monde naturel.&lt;/p&gt;&#xA;&lt;p&gt;Afin de raconter au mieux cette histoire, jâ€™ai prÃ©sentÃ© au public les cinq sujets suivants, de portÃ©e croissante :&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;Cartographie neuronale avec une interface graphique compatible PostGIS&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/catmaid/CATMAID&#34; rel=&#34;noopener&#34;&gt;Code source de CATMAID&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Examen hydrologique des riviÃ¨res avec lâ€™extension PgHydro&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/pghydro/pghydro&#34; rel=&#34;noopener&#34;&gt;Code source de PgHydro&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;MÃ©ta-analyse de la biomasse des poissons avec Vanilla Postgres&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.nature.com/articles/s41597-024-04026-0&#34; rel=&#34;noopener&#34;&gt;Lien vers une publication Ã©valuÃ©e par des pairs&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Tableau de bord de la COVID-19 avec lâ€™extension Citus&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.citusdata.com/blog/2021/12/11/uk-covid-19-dashboard-built-using-postgres-and-citus/&#34; rel=&#34;noopener&#34;&gt;Lien vers lâ€™article de blog&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Classification par Ã©toiles basÃ©e sur des forks de Postgres et des modifications dâ€™extensions&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://indico.cern.ch/event/1471762/contributions/6280216/&#34; rel=&#34;noopener&#34;&gt;Lien vers la prÃ©sentation au Cern PGDay - 2025&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Jâ€™ai apprÃ©ciÃ© la prÃ©paration et la prÃ©sentation de cette confÃ©rence, qui a donnÃ© lieu Ã  des Ã©changes enrichissants. Deux points ont particuliÃ¨rement retenu mon attention et me semblaient intÃ©ressants Ã  aborder iciÂ :&lt;/p&gt;&#xA;&lt;ol class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Quelles sont les trois technologies (outils/flux de travail) qui bÃ©nÃ©ficieraient le plus, en termes dâ€™amÃ©lioration dâ€™impact ou de facilitÃ© dâ€™adoption, si leurs complexitÃ©s Ã©taient considÃ©rablement rÃ©duites/abstraites ?&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Lors de ma prÃ©sentation, jâ€™ai affirmÃ© que le cerveau Ã©tait compatible avec lâ€™ACID. Bien que je fasse principalement rÃ©fÃ©rence aux potentiels dâ€™action des neurones, cette affirmation a Ã©tÃ© lÃ©gitimement contestÃ©e.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;1-outils-/-flux-de-travail-identifies&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#1-outils-/-flux-de-travail-identifies&#34;&gt;1. Outils / flux de travail identifiÃ©s&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;&lt;em&gt;1. Quelles sont les trois technologies (outils/flux de travail) qui bÃ©nÃ©ficieraient le plus, en termes dâ€™amÃ©lioration dâ€™impact ou de facilitÃ© dâ€™adoption, si leurs complexitÃ©s Ã©taient considÃ©rablement rÃ©duites/abstraites ?&lt;/em&gt;&lt;/p&gt;&#xA;&lt;h4 id=&#34;1-vectorisation-dimage&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#1-vectorisation-dimage&#34;&gt;1. Vectorisation dâ€™image&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;DÃ¨s le dÃ©part, jâ€™ai pensÃ© Ã  la classification des images issues de scanner Ã  rÃ©sonance magnÃ©tique. Ce sujet est trÃ¨s discutÃ© au sein de la communautÃ© mÃ©dicale, et de nombreuses startups se sont Ã©galement lancÃ©es dans ce domaine. Personnellement, je pense quâ€™il y a en effet une dynamique pour amÃ©liorer lâ€™accessibilitÃ©, mais quâ€™il existe encore une forte sÃ©paration entre le dÃ©veloppeur et lâ€™utilisateur final. Bien que je nâ€™aie pas de rÃ©ponse toute faite Ã  ce stade, je vous conseillerais, pour commencer, de vous renseigner sur &lt;a href=&#34;https://github.com/pgvector/pgvector&#34; rel=&#34;noopener&#34;&gt;vecteur pg&lt;/a&gt; et &lt;a href=&#34;https://github.com/postgresml/postgresml&#34; rel=&#34;noopener&#34;&gt;postgresml&lt;/a&gt;. Compte tenu de lâ€™intÃ©gration des vecteurs et de lâ€™apprentissage automatique dans ce dÃ©fi, jâ€™envisagerais dâ€™utiliser un service dâ€™intÃ©gration dâ€™images pour convertir la sortie IRM brute en un format compatible avec pgvector.&lt;/p&gt;&#xA;&lt;h4 id=&#34;2-gestion-des-donnees-et-controle-des-versions&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#2-gestion-des-donnees-et-controle-des-versions&#34;&gt;2. Gestion des donnÃ©es et contrÃ´le des versions&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;En tant quâ€™ancien universitaire, je peux tÃ©moigner de lâ€™omniprÃ©sence des feuilles de calcul classiques (le format .csv Ã©tant moins courant, mais toujours utilisÃ©). De plus, les fichiers sont gÃ©nÃ©ralement stockÃ©s dans des rÃ©pertoires locaux, sur un serveur privÃ© ou dans une infrastructure partagÃ©e, mais avec une architecture de dossiers classique. On imagine aisÃ©ment les frictions potentielles lorsque la conversation sâ€™Ã©tend Ã  plusieurs chercheurs de diffÃ©rents groupes. Si lâ€™on ajoute Ã  cela un taux de rotation naturellement Ã©levÃ© des Ã©tudiants, associÃ© Ã  une mentalitÃ© de Â«Â jâ€™aime faire les choses Ã  ma faÃ§onÂ Â», on comprend lâ€™importance des normes. Si les amÃ©liorations peuvent Ãªtre abordÃ©es sous diffÃ©rents angles, je souhaiterais me concentrer sur la gestion des donnÃ©es et le contrÃ´le des versions.&lt;/p&gt;&#xA;&lt;p&gt;Des donnÃ©es bien ordonnÃ©es et une bonne hygiÃ¨ne organisationnelle sont des gages de rÃ©ussite dans tout domaine dâ€™Ã©tudes. Cependant, le suivi des modifications se limite le plus souvent, voire exclusivement, aux documents texte. Bien que cela puisse surprendre le lecteur, le terme Â«Â dÃ©pÃ´t de codeÂ Â» ne fait pas partie du vocabulaire universitaire courant. MÃªme le terme Â«Â LinuxÂ Â» Ã©voque un certain Â«Â mysterium tremendum et fascinansÂ Â» (Otto, 1923). La sÃ©curitÃ© des donnÃ©es Ã©tant une prioritÃ©, des options dâ€™auto-hÃ©bergement telles que &lt;a href=&#34;https://forgejo.org/&#34; rel=&#34;noopener&#34;&gt;Forgejo&lt;/a&gt; pourraient Ãªtre trÃ¨s utiles aux scientifiques du vivant, notamment en cas de rÃ©serves quant au stockage des donnÃ©es en ligne. Au lieu dâ€™avoir plusieurs brouillons de fichiers, par exemple Â«Â draft-1_finalÂ Â», Â«Â draft_final_finalÂ Â», etc., des outils comme Forgejo permettent de suivre lâ€™avancement des documents et dâ€™offrir aux chercheurs une plus grande transparence sur les modifications passÃ©es (ce qui facilite la collaboration entre les Ã©quipes).&lt;/p&gt;&#xA;&lt;h4 id=&#34;3-conformite-et-audit&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#3-conformite-et-audit&#34;&gt;3. ConformitÃ© et audit&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;La confiance est un sujet central dans tout domaine de recherche, et dans certaines circonstances, lâ€™audit (ou toute autre forme de preuve de travail) peut occuper une place centrale. Dans le cas prÃ©sent, Postgres et lâ€™une de ses extensions associÃ©es, &lt;a href=&#34;https://github.com/pgaudit/pgaudit&#34; rel=&#34;noopener&#34;&gt;pgAudit&lt;/a&gt;, peuvent constituer une avancÃ©e significative vers la conformitÃ©. En raison des capacitÃ©s de Postgres, ce service peut parfois Ãªtre perÃ§u comme intimidant et rÃ©servÃ© aux grands projets. Je pense quâ€™il pourrait devenir trÃ¨s rÃ©pandu grÃ¢ce Ã  la publication dâ€™un guide du type Â«Â Postgres pour les petits projetsÂ Â».&lt;/p&gt;&#xA;&lt;h4 id=&#34;decouverte-et-exposition&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#decouverte-et-exposition&#34;&gt;DÃ©couverte et exposition&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;Au final, personne nâ€™utilisera volontairement quelque chose sans en connaÃ®tre lâ€™existence. Câ€™est pourquoi la dÃ©couvrabilitÃ© est lâ€™un des concepts les plus fondamentaux lorsquâ€™on parle dâ€™impact et dâ€™adoptabilitÃ©. Il appartient aux mainteneurs, aux contributeurs et aux communautÃ©s derriÃ¨re ces outils open source de partager leurs avancÃ©es sur plusieurs plateformes et dans diffÃ©rentes confÃ©rences. HonnÃªtement, le moyen le plus simple dâ€™aider est dâ€™en parler et de mettre la main Ã  la pÃ¢te.&lt;/p&gt;&#xA;&lt;h3 id=&#34;2-le-cerveau-et-la-conformite-a-lacid&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#2-le-cerveau-et-la-conformite-a-lacid&#34;&gt;2. Le cerveau et la conformitÃ© Ã  lâ€™ACID&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;&lt;em&gt;2. Lors de ma confÃ©rence, jâ€™ai affirmÃ© que le cerveau Ã©tait compatible avec lâ€™ACID. Bien que je fasse principalement rÃ©fÃ©rence aux potentiels dâ€™action des neurones, cette affirmation a Ã©tÃ© contestÃ©e Ã  juste titre.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Ce fut une autre discussion passionnante aprÃ¨s la prÃ©sentation, et mÃªme si elle mÃ©riterait un article de blog dÃ©diÃ©, je souhaitais partager rapidement mes rÃ©flexions. Dans lâ€™une de mes diapositives, jâ€™ai affirmÃ© que le cerveau est compatible avec ACID, du moins dans le sens oÃ¹ les transactions sont tout ou rien. Les neurones, un type cellulaire courant dans le cerveau, ont la caractÃ©ristique de recevoir des signaux qui se compilent jusquâ€™Ã  atteindre un seuil, aprÃ¨s quoi le neurone envoie son propre signal, ou Â«Â se dÃ©clencheÂ Â». Câ€™est une simplification grossiÃ¨reÂ : voici un petit lien &lt;a href=&#34;https://en.wikipedia.org/wiki/Action_potential&#34; rel=&#34;noopener&#34;&gt;WikipÃ©dia&lt;/a&gt; pour plus dâ€™informations.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, des auditeurs perspicaces ont remarquÃ© que le cerveau est complexe et comporte diffÃ©rentes rÃ©gions. Il peut y avoir des pertes de mÃ©moire et des activitÃ©s pouvant altÃ©rer le fonctionnement et la conscience. Cependant, dans quelle mesure les influences externes sur le cerveau sont-elles liÃ©es Ã  un systÃ¨me de base de donnÃ©esÂ ? Si une base de donnÃ©es Postgres est corrompue, elle nâ€™est plus compatible ACID, contrairement Ã  ce quâ€™elle Ã©tait auparavant. Tous ces points sont Ã  la fois valables et intÃ©ressants. Il sera intÃ©ressant dâ€™y rÃ©flÃ©chir et de rÃ©diger une rÃ©ponse plus formelle.&lt;/p&gt;&#xA;&lt;h2 id=&#34;reflexions-finales&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#reflexions-finales&#34;&gt;RÃ©flexions finales&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;En rÃ©sumÃ©, ce fut une excellente confÃ©rence. Je sais que je parle au nom de tous les participants en remerciant tous ceux qui y ont contribuÃ©, quâ€™ils soient membres du personnel, bÃ©nÃ©voles, intervenants ou autres.&lt;/p&gt;&#xA;&lt;h2 id=&#34;references&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#references&#34;&gt;RÃ©fÃ©rences&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Foote, K. J., Grant, J. W. A., &amp;amp; Biron, P. M. (2024). A global dataset of salmonid biomass in streams. Scientific data, 11(1), 1172. &lt;a href=&#34;https://doi.org/10.1038/s41597-024-04026-0&#34; rel=&#34;noopener&#34;&gt;https://doi.org/10.1038/s41597-024-04026-0&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Giordano, C., &amp;amp; Hadjibagheri, P. (2021, December 11). UK COVID-19 dashboard built using Postgres and Citus for millions of users. Microsoft TechCommunity Blog. &lt;a href=&#34;https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/uk-covid-19-dashboard-built-using-postgres-and-citus-for/ba-p/3039052&#34; rel=&#34;noopener&#34;&gt;https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/uk-covid-19-dashboard-built-using-postgres-and-citus-for/ba-p/3039052&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Kazimiers, T., et al. (2021). CATMAID (Collaborative Annotation Toolkit for Massive Amounts of Image Data) [Computer software]. GitHub. &lt;a href=&#34;https://github.com/catmaid/CATMAID&#34; rel=&#34;noopener&#34;&gt;https://github.com/catmaid/CATMAID&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Krefl, D., &amp;amp; Nienartowicz, K. (2025, January 17). Harnessing Postgres and HPC for petabyte-scale variable star classification in astronomy [Conference presentation]. CERN PGDay 2025, Geneva, Switzerland. &lt;a href=&#34;https://indico.cern.ch/event/1336647/contributions/5660229/&#34; rel=&#34;noopener&#34;&gt;https://indico.cern.ch/event/1336647/contributions/5660229/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Otto, R. (1923). The idea of the holy: An inquiry into the non-rational factor in the idea of the divine and its relation to the rational (J. W. Harvey, Trans.). Oxford University Press. (Original work published 1917)&lt;/p&gt;&#xA;&lt;p&gt;Teixeira, A. de A., &amp;amp; PgHydro Project. (2022). pghydro (Version 6.6) [Computer software]. GitHub. &lt;a href=&#34;https://github.com/pghydro/pghydro&#34; rel=&#34;noopener&#34;&gt;https://github.com/pghydro/pghydro&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Wikipedia contributors. (2025, May 16). Action potential. Wikipedia, The Free Encyclopedia. &lt;a href=&#34;https://en.wikipedia.org/wiki/Action_potential&#34; rel=&#34;noopener&#34;&gt;https://en.wikipedia.org/wiki/Action_potential&lt;/a&gt;&lt;/p&gt;&#xA; </content>
    <link href="https://www.data-bene.io/fr/blog/une-visite-a-pgconfde-2025-et-des-discussions-sur-PostgreSQL-dans-le-contexte-des-sciences-de-la-vie/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Sarah Conway</name>
    </author>
  </entry>
  <entry>
    <title>Il Ã©tait une fois une base confinÃ©e - PostgreSQL, QR Codes et l&#39;art de la sauvegarde sans rÃ©seau</title>
    <updated>2025-04-01T00:00:00Z</updated>
    <id>tag:www.data-bene.io,2025-04-01:/fr/blog/sauvegarde-sans-reseau/</id>
    <content type="html"> &lt;h2 id=&#34;ğŸ“¦-le-fort-knox-des-bases-de-donnees&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#ğŸ“¦-le-fort-knox-des-bases-de-donnees&#34;&gt;ğŸ“¦ Le Fort Knox des bases de donnÃ©es&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Il Ã©tait une fois, dans une salle serveur lointaine, entourÃ©e de verre blindÃ© et de bÃ©ton armÃ©, une base PostgreSQL tellement confinÃ©e, tellement isolÃ©e, quâ€™elle ne pouvait que rÃªver du cloud.&lt;/p&gt;&#xA;&lt;p&gt;Pas de rÃ©seau.&lt;/p&gt;&#xA;&lt;p&gt;Pas dâ€™USB.&lt;/p&gt;&#xA;&lt;p&gt;Aucun stockage externe accessible en Ã©criture.&lt;/p&gt;&#xA;&lt;p&gt;Juste un clavier, un Ã©cran, et le bourdonnement des filtres Ã  air de qualitÃ© industrielle.&lt;/p&gt;&#xA;&lt;p&gt;Ce nâ€™Ã©tait pas un simple environnement â€œair-gappedâ€. Câ€™Ã©tait une zone dâ€™exfiltration zÃ©ro, avec une sÃ©curitÃ© opÃ©rationnelle si rigoureuse quâ€™on aurait cru quâ€™elle protÃ©geait des secrets dâ€™Ã‰tat â€” ou pire, un systÃ¨me bancaire des annÃ©es 80.&lt;/p&gt;&#xA;&lt;p&gt;Et pourtant, dans cet oubli numÃ©rique, une question demeurait :&lt;br&gt;&#xA;&lt;strong&gt;Comment sauvegarder une base PostgreSQL sans jamais extraire un seul fichierÂ ?&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;ğŸ¥-quand-lecran-devient-ton-reseau&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#ğŸ¥-quand-lecran-devient-ton-reseau&#34;&gt;ğŸ¥ Quand lâ€™Ã©cran devient ton rÃ©seau&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Notre client ne voulait pas juste une sauvegarde. Il &lt;em&gt;en avait besoin&lt;/em&gt;. La crainte nâ€™Ã©tait pas le vol, mais &lt;strong&gt;la perte totale&lt;/strong&gt;Â : une carte mÃ¨re qui meurt en silence, enfermant les donnÃ©es Ã  jamais dans sa cage de verre. Et dans ce cas, casser le mur Ã  la masse nâ€™est pas un plan de reprise dâ€™activitÃ© trÃ¨s Ã©lÃ©gant.&lt;/p&gt;&#xA;&lt;p&gt;Nous avons envisagÃ© toutes les options :&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;OCR dâ€™un dÃ©filement de dump SQLÂ ? Trop imprÃ©cis.&lt;/li&gt;&#xA;&lt;li&gt;Filmer la sortie &lt;code&gt;psql&lt;/code&gt; ? Beaucoup trop verbeux.&lt;/li&gt;&#xA;&lt;li&gt;Imprimer lâ€™hexadÃ©cimal ? On a quand mÃªme une conscience.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Et puis, lâ€™illumination : &lt;strong&gt;les QR codes&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Et si on faisait un &lt;code&gt;pg_dump&lt;/code&gt; de la baseâ€¦&lt;/p&gt;&#xA;&lt;p&gt;â€¦en QR codesâ€¦&lt;/p&gt;&#xA;&lt;p&gt;â€¦affichÃ©s Ã  lâ€™Ã©cranâ€¦&lt;/p&gt;&#xA;&lt;p&gt;â€¦filmÃ©s par une camÃ©ra haute frÃ©quenceâ€¦&lt;/p&gt;&#xA;&lt;p&gt;â€¦puis reconstituÃ©s image par image Ã  lâ€™extÃ©rieurÂ ?&lt;/p&gt;&#xA;&lt;p&gt;Câ€™Ã©tait absurde. Donc forcÃ©ment prometteur.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;ğŸ§ -hacking-pg_dump-la-version-pixelisee&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#ğŸ§ -hacking-pg_dump-la-version-pixelisee&#34;&gt;ğŸ§  Hacking &lt;code&gt;pg_dump&lt;/code&gt;Â : la version pixelisÃ©e&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Lâ€™outil adorÃ© &lt;code&gt;pg_dump&lt;/code&gt; de PostgreSQL est modulaire. On lâ€™a donc enrichi dâ€™un nouvel â€œarchiverâ€Â : &lt;code&gt;--format=qrcode&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Voici le fonctionnement :&lt;/p&gt;&#xA;&lt;ol class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;Encodage QR&lt;/strong&gt;Â : chaque portion de sortie SQL est convertie en QR code (format PNG).&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Streaming&lt;/strong&gt;Â : au lieu de sauvegarder les images, on les envoie directement sur &lt;code&gt;stdout&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Mise en page&lt;/strong&gt;Â : notre interface affiche plusieurs QR codes Ã  lâ€™Ã©cran en haute rÃ©solution (on parle de 2000+ pixels â€” de quoi afficher une grille bien dense).&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Capture vidÃ©o&lt;/strong&gt;Â : une machine dÃ©diÃ©e avec une camÃ©ra 1280Hz filme lâ€™Ã©cran et enregistre la sÃ©quence complÃ¨te.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pas de macros. Pas de tricherie. Juste des photons et des images.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;ğŸ”-reconstruction-a-la-sortie-de-la-cage&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#ğŸ”-reconstruction-a-la-sortie-de-la-cage&#34;&gt;ğŸ” Reconstruction Ã  la sortie de la cage&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Une fois la vidÃ©o extraite du cube de verre :&lt;/p&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;Notre parseur lit la vidÃ©o image par image.&lt;/li&gt;&#xA;&lt;li&gt;Les QR codes sont dÃ©tectÃ©s et dÃ©codÃ©s en parallÃ¨le.&lt;/li&gt;&#xA;&lt;li&gt;Chaque bloc est identifiÃ© par son numÃ©ro de sÃ©quence.&lt;/li&gt;&#xA;&lt;li&gt;Le tout est rÃ©assemblÃ© en un fichier &lt;code&gt;pg_dump.sql&lt;/code&gt; complet.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Et voilÃ Â : la base renaÃ®t â€” &lt;strong&gt;entiÃ¨rement exportÃ©e sans transfert numÃ©rique&lt;/strong&gt;.&lt;br&gt;&#xA;Rien que de la lumiÃ¨re et des lentilles.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;ğŸ§©-performances-et-fidelite&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#ğŸ§©-performances-et-fidelite&#34;&gt;ğŸ§© Performances et fidÃ©litÃ©&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ul class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;QR Version&lt;/strong&gt;Â : Version 40, mode binaire optimisÃ© pour la densitÃ© maximale.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Correction dâ€™erreur&lt;/strong&gt;Â : Niveau Q pour une robustesse accrue.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Affichage&lt;/strong&gt;Â : Grille 25Ã—16 QR codes sur un Ã©cran 1920Ã—1080 â€” soit 350 blocs par image (environ 1Â Mo par frame).&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Vitesse de lecture&lt;/strong&gt;Â : ~60 images/seconde â†’ 21Â 000 blocs/seconde â‰ˆ 60Â Mo/s !&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;DurÃ©e totale&lt;/strong&gt;Â : Une sauvegarde logique complÃ¨te de moins de 6Â Go exportÃ©e en moins de 100 minutes !&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;ğŸ›¡ï¸-pourquoi-cest-important&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#ğŸ›¡ï¸-pourquoi-cest-important&#34;&gt;ğŸ›¡ï¸ Pourquoi câ€™est important&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Ce nâ€™est pas juste une anecdote technique â€” câ€™est une preuve que &lt;strong&gt;la souplesse de PostgreSQL sâ€™Ã©tend jusquâ€™Ã  lâ€™absurde&lt;/strong&gt;. Les environnements ultra-sÃ©curisÃ©s ne sont pas rares : dÃ©fense, finance, infrastructures critiquesâ€¦ Et quand les outils classiques ne suffisent plus, lâ€™architecture extensible de PostgreSQL permet dâ€™innover, mÃªme en milieu extrÃªme.&lt;/p&gt;&#xA;&lt;p&gt;Chez &lt;strong&gt;Data Bene&lt;/strong&gt;, on vit pour ce genre de dÃ©fi. Optimiser les plans dâ€™exÃ©cution ou imaginer des mÃ©thodes dâ€™exfiltration qui ressemblent Ã  de lâ€™espionnage, câ€™est notre terrain de jeu.&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;&lt;em&gt;Envie dâ€™essayerÂ ? Ã‰crivez-nous â€” on adore les sauvegardes bizarres.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;Et si jamais vous pensez Ã  utiliser &lt;code&gt;pg_restore&lt;/code&gt; en spectacle laser, appelez-nous. On est curieux.&lt;/em&gt;&lt;/p&gt;&#xA; </content>
    <link href="https://www.data-bene.io/fr/blog/sauvegarde-sans-reseau/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Sarah Conway</name>
    </author>
  </entry>
  <entry>
    <title>Postgres CafÃ©Â : Contribuer Ã  l&#39;Open Source</title>
    <updated>2025-03-04T00:00:00Z</updated>
    <id>tag:www.data-bene.io,2025-03-04:/fr/blog/postgres-cafe-contribuer-a-l-open-source/</id>
    <content type="html"> &lt;p&gt;Câ€™est notre sixiÃ¨me Ã©pisode de &lt;a href=&#34;https://www.youtube.com/watch?v=WwaJd2c9whM&#34; rel=&#34;noopener&#34;&gt;CafÃ© Postgres&lt;/a&gt;, un podcast collaboratif de &lt;a href=&#34;https://www.data-bene.io/en/&#34; rel=&#34;noopener&#34;&gt;Data Bene&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://xata.io/&#34; rel=&#34;noopener&#34;&gt;Xata&lt;/a&gt; oÃ¹ nous discutons de tout, des extensions PostgreSQL aux contributions de la communautÃ©. Dans lâ€™Ã©pisode dâ€™aujourdâ€™hui, Sarah Conway et GÃ¼lÃ§in YÄ±ldÄ±rÄ±m Jelinek recontrent Andrea Cucciniello pour discuter de la maniÃ¨re dont les entreprises et les particuliers peuvent contribuer aux projets open source, et des raisons pour lesquelles ils pourraient envisager de le faire.&lt;/p&gt;&#xA;&lt;h2 id=&#34;episode-6-developpement-dextensions-postgresql-la-communaute-et-au-dela&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#episode-6-developpement-dextensions-postgresql-la-communaute-et-au-dela&#34;&gt;Ã‰pisode 6 : DÃ©veloppement dâ€™extensions PostgreSQL, la communautÃ© et au-delÃ &lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;Ã€ quelle frÃ©quence les entreprises expriment-elles leur intÃ©rÃªt pour une contribution open sourceÂ ? Il est Ã©vident que toute aide apportÃ©e profite directement aux projets open source. Mais y a-t-il des avantages pour lâ€™entreprise qui contribue ? Quels sont les modes de contribution quâ€™une entreprise peut envisager ? Ce sont des questions que nous entendons souvent. Explorons donc certaines des rÃ©ponses Ã©voquÃ©es dans cet Ã©pisode Ã  travers un bref rÃ©capitulatif.&lt;/p&gt;&#xA;&lt;h3 id=&#34;contribuer-aux-projets-et-aux-communautes-open-source&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#contribuer-aux-projets-et-aux-communautes-open-source&#34;&gt;Contribuer aux projets et aux communautÃ©s open source&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Chez Data Bene, nous avons dÃ©jÃ  quelques clients intÃ©ressÃ©s par le dÃ©veloppement de fonctionnalitÃ©s ou dâ€™amÃ©liorations pour lâ€™Ã©cosystÃ¨me PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Ces entreprises souhaitent corriger des bugs et ajouter de nouvelles fonctionnalitÃ©s qui complÃ¨tent leurs cas dâ€™utilisation et leurs piles technologiques dans PostgreSQL, Citus Data et les technologies associÃ©es pour accomplir deux chosesÂ :&lt;/p&gt;&#xA;&lt;ol class=&#34;list&#34;&gt;&#xA;&lt;li&gt;Pour crÃ©er les fonctionnalitÃ©s dont ils ont besoin, qui sont nativement intÃ©grÃ©es au logiciel en amont et maintenues de maniÃ¨re transparente par la grande communautÃ© open source, et&lt;/li&gt;&#xA;&lt;li&gt;Pour garantir que dâ€™autres personnes ayant un cas dâ€™utilisation similaire puissent Ã©galement tirer parti de ces avantages.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Les temps changent ; la seule faÃ§on pour le logiciel source de rester pertinent, utile et bÃ©nÃ©fique pour le public mondial qui lâ€™utilise est de bÃ©nÃ©ficier de contributions mondiales, garantissant quâ€™il rÃ©pond toujours aux besoins rÃ©els des utilisateurs dâ€™annÃ©e en annÃ©e.&lt;/p&gt;&#xA;&lt;h3 id=&#34;pourquoi-soutenir-des-projets-open-source&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#pourquoi-soutenir-des-projets-open-source&#34;&gt;Pourquoi soutenir des projets open source ?&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;La dÃ©pendance vis-Ã -vis des fournisseurs est un problÃ¨me majeur dans le secteur des logiciels et des servicesÂ ; contribuer aux projets open source garantit que la technologie ouvertement dÃ©veloppÃ©e peut continuer Ã  lâ€™Ãªtre. Lâ€™utilisation de la technologie FOSS signifie que vous Ã©vitez dâ€™investir dans une entreprise qui pourrait fermer le code ou en restreindre lâ€™accÃ¨s, donnant ainsi Ã  lâ€™utilisateur final la libertÃ© de continuer Ã  utiliser et Ã  dÃ©velopper des outils essentiels qui font partie de sa pile technologique.&lt;/p&gt;&#xA;&lt;p&gt;Ce type de logiciel est Ã©galement soumis Ã  un processus de dÃ©veloppement trÃ¨s visible, ce qui signifie quâ€™il est beaucoup plus difficile dâ€™intÃ©grer dans le code sous-jacent des atteintes Ã  la vie privÃ©e, des vulnÃ©rabilitÃ©s de cybersÃ©curitÃ©, etc.&lt;/p&gt;&#xA;&lt;p&gt;De plus, les logiciels open source sont crÃ©Ã©s par des individus du monde entier ayant des perspectives et des parcours variÃ©sÂ ; cela garantit quâ€™ils sont minutieusement testÃ©s, et intÃ¨grent un large Ã©ventail de fonctionnalitÃ©s intÃ©grÃ©es qui sont &lt;em&gt;rÃ©ellement utiles&lt;/em&gt; Ã  de nombreux utilisateurs finaux. Cela permet Ã  ce type de projets dâ€™Ãªtre couronnÃ©s de succÃ¨s pendant de nombreuses annÃ©es, aussi longtemps quâ€™il existe une communautÃ© prÃªte Ã  les soutenir.&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;Exemple concretÂ : PostgreSQL existe depuis plus de 35Â ans de dÃ©veloppement actif et figure toujours aujourdâ€™hui en tÃªte des enquÃªtes et des classements des dÃ©veloppeurs comme Ã©tant la solution de base de donnÃ©es la plus apprÃ©ciÃ©e, la plus utilisÃ©e et la plus populaire au mondeÂ !&lt;/em&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;comment-les-entreprises-peuvent-elles-soutenir-au-mieux-les-projets-open-source&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#comment-les-entreprises-peuvent-elles-soutenir-au-mieux-les-projets-open-source&#34;&gt;Comment les entreprises peuvent-elles soutenir au mieux les projets open sourceÂ ?&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Il existe quelques moyens clÃ©s pour atteindre cet objectif finalÂ :&lt;/p&gt;&#xA;&lt;ol class=&#34;list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;Incluez les contributions de code au temps de travail de vos ingÃ©nieurs.&lt;/strong&gt; Lorsque vous allouez du temps aux dÃ©veloppeurs pour travailler sur le code en amont, vous vous assurez que la technologie que vous exploitez (pour fournir un support et/ou des services, pour alimenter votre produit ou sur laquelle repose votre infrastructure) bÃ©nÃ©ficie de performances amÃ©liorÃ©es, de fonctionnalitÃ©s Ã©tendues, de problÃ¨mes rÃ©solus ou de corrections de bugs.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Envisagez de dÃ©velopper des extensions.&lt;/strong&gt; La crÃ©ation et la maintenance dâ€™extensions permettent aux entreprises dâ€™ajouter des fonctionnalitÃ©s spÃ©cialisÃ©es ou de rÃ©pondre Ã  certains cas dâ€™utilisation sans altÃ©rer la base de code principale. Dans le cas de PostgreSQL en particulier, cette extensibilitÃ© permet Ã  Postgres de rÃ©pondre aux besoins de diffÃ©rents secteurs, utilisateurs et entreprises, avec un Ã©cosystÃ¨me polyvalent et solide. Ce type de systÃ¨me modulaire permet Ã  PostgreSQL dâ€™Ã©voluer sans complexifier trop son noyau, ce qui rend le projet dans son ensemble plus facile Ã  gÃ©rer et Ã  mettre Ã  jour.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Sponsorisez, organisez et participez Ã  des Ã©vÃ©nements.&lt;/strong&gt; En tant quâ€™entreprise, vous pouvez choisir de promouvoir ou dâ€™initier des confÃ©rences technologiques, des groupes dâ€™utilisateurs, des ateliers et bien plus encore pour sensibiliser et Ã©duquer le grand public sur la technologie que vous souhaitez voir prospÃ©rer. Les Ã©vÃ©nements sont un excellent moyen pour les utilisateurs et les dÃ©veloppeurs de collaborer, de discuter des avancÃ©es et de partager les meilleures pratiques, ce qui renforce la communautÃ© et amÃ©liore le produit en consÃ©quence.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;comment-data-bene-contribue&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#comment-data-bene-contribue&#34;&gt;Comment Data Bene contribue&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;CÃ©dric Villemain, prÃ©sident de Data Bene, a dÃ©veloppÃ© &lt;a href=&#34;https://codeberg.org/c2main/pgfincore&#34; rel=&#34;noopener&#34;&gt;pg_fincore&lt;/a&gt; et travaille actuellement sur &lt;a href=&#34;https://codeberg.org/data-bene/statsmgr&#34; rel=&#34;noopener&#34;&gt;StatsMgr&lt;/a&gt;, pg_psi et dâ€™autres composants conÃ§us pour amÃ©liorer les capacitÃ©s statistiques de Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Notre Ã©quipe est Ã©galement responsable dâ€™un certain nombre de contributions dans le cadre de projets tels que &lt;a href=&#34;https://www.citusdata.com/blog/2025/02/06/distribute-postgresql-17-with-citus-13/&#34; rel=&#34;noopener&#34;&gt;Citus Data&lt;/a&gt; et &lt;a href=&#34;https://github.com/zammad/zammad/&#34; rel=&#34;noopener&#34;&gt;Zammad&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Nous nous efforÃ§ons de sponsoriser, de prÃ©senter et de promouvoir des confÃ©rences et des groupes dâ€™utilisateurs de la communautÃ© PostgreSQL ou open source, tels que PostgreSQL Europe, pgDay Paris, AlpOSS, Capitole du Libre, et bien dâ€™autres. Certains membres de notre Ã©quipe ont Ã©galement initiÃ© ou font partie des comitÃ©s dâ€™organisation de divers Ã©vÃ©nements tels que les groupes dâ€™utilisateurs PostgreSQL de Barcelone et de Madrid et pgDay Lowlands. Lâ€™impact des Ã©vÃ©nements sur le projet et la communautÃ© dans son ensemble ne peut Ãªtre sous-estimÃ©, et il est important pour nous dâ€™y contribuer de cette maniÃ¨re.&lt;/p&gt;&#xA;&lt;p&gt;Enfin, nous aidons les clients Ã  comprendre comment contribuer Ã  PostgreSQL et Ã  des projets open source similaires. Par le biais de formations, dâ€™ateliers et de collaborations, nous les encourageons Ã  apporter des contributions significatives qui correspondent Ã  leurs objectifs et soutiennent la communautÃ© dans son ensemble.&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;Si vous Ãªtes un dÃ©veloppeur souhaitant contribuer Ã  lâ€™Ã©cosystÃ¨me open source et/ou PostgreSQL, ou aider les clients avec leurs besoins en R&amp;amp;D, notre Ã©quipe sâ€™agrandit : rendez-nous visite sur notre &lt;a href=&#34;https://data-bene.io/en/jobs&#34; rel=&#34;noopener&#34;&gt;site web&lt;/a&gt; pour voir les postes disponibles!&lt;/em&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;regardez-lepisode-complet&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#regardez-lepisode-complet&#34;&gt;Regardez lâ€™Ã©pisode complet&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Vous souhaitez regarder la discussion dans son intÃ©gralitÃ© ? Elle est disponible sur YouTube (en anglais uniquement) :&lt;/p&gt;&#xA;&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube-nocookie.com/embed/BYvXQB9O71U?si=-irKIHXxwiPhBFQP&#34; title=&#34;YouTube video player&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; referrerpolicy=&#34;strict-origin-when-cross-origin&#34; allowfullscreen&gt;&lt;/iframe&gt;&#xA;&lt;h3 id=&#34;restez-a-lecoute-pour-plus-doutils-postgres&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#restez-a-lecoute-pour-plus-doutils-postgres&#34;&gt;Restez Ã  lâ€™Ã©coute pour plus dâ€™outils Postgres&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;A ce jour, nous avons terminÃ© notre premiÃ¨re sÃ©rie dâ€™Ã©pisodes pour Postgres CafÃ©Â ! Dâ€™autres Ã©pisodes pourraient suivre, ou pas. Suivez-nous sur les rÃ©seaux sociaux (comme &lt;a href=&#34;https://www.linkedin.com/company/91744288&#34; rel=&#34;noopener&#34;&gt;LinkedIn&lt;/a&gt; ou &lt;a href=&#34;https://fosstodon.org/@data_bene&#34; rel=&#34;noopener&#34;&gt;Mastodon&lt;/a&gt;) pour Ãªtre informÃ© des prochaines sorties. (Voulez-vous en savoir plus sur cette sÃ©rie de podcasts ? Faites-le nous savoir !)&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/playlist?list=PLf7KS0svgDP_zJmby3RMzzOVO45qLbruA&#34; rel=&#34;noopener&#34;&gt;Abonnez-vous Ã  la playlist&lt;/a&gt; ou consultez-le pour des interviews sur les extensions open source comme &lt;a href=&#34;https://codeberg.org/Data-Bene/StatsMgr&#34; rel=&#34;noopener&#34;&gt;StatsMgr&lt;/a&gt; pour une gestion efficace des statistiques de PostgreSQL, ou &lt;a href=&#34;https://youtu.be/j1R3a0-jg6c&#34; rel=&#34;noopener&#34;&gt;pgstream&lt;/a&gt;, un outil open source de capture de donnÃ©es modifiÃ©es (CDC) conÃ§u spÃ©cifiquement pour PostgreSQL ou bien dâ€™autres. PostgreSQL est lâ€™une des bases de donnÃ©es les plus extensibles du marchÃ© avec un vaste Ã©cosystÃ¨me dâ€™extensions ; apprenez directement des experts en dÃ©couvrant certaines des options disponibles.&lt;/p&gt;&#xA; </content>
    <link href="https://www.data-bene.io/fr/blog/postgres-cafe-contribuer-a-l-open-source/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Sarah Conway</name>
    </author>
  </entry>
  <entry>
    <title>Postgres CafÃ©Â : DÃ©ployer PostgreSQL distribuÃ© Ã  grande Ã©chelle avec Citus Data</title>
    <updated>2025-01-29T00:00:00Z</updated>
    <id>tag:www.data-bene.io,2025-01-29:/fr/blog/postgres-cafe-deployer-postgresql-distribue-a-grande-echelle-avec-citus-data/</id>
    <content type="html"> &lt;p&gt;Câ€™est lâ€™heure du quatriÃ¨me Ã©pisode de &lt;a href=&#34;https://www.youtube.com/watch?v=WwaJd2c9whM&#34; rel=&#34;noopener&#34;&gt;CafÃ© Postgres&lt;/a&gt;, un podcast de nos Ã©quipes de &lt;a href=&#34;https://www.data-bene.io/en/&#34; rel=&#34;noopener&#34;&gt;Data Bene&lt;/a&gt; et &lt;a href=&#34;https://xata.io/&#34; rel=&#34;noopener&#34;&gt;Xata&lt;/a&gt; oÃ¹ nous discutons de la contribution Ã  PostgreSQL et du dÃ©veloppement dâ€™extensions. Dans ce dernier Ã©pisode, Sarah Conway et GÃ¼lÃ§in YÄ±ldÄ±rÄ±m Jelinek rencontrent StÃ©phane Carton pour parler de &lt;a href=&#34;https://github.com/citusdata/citus&#34; rel=&#34;noopener&#34;&gt;Citus Data&lt;/a&gt;, une extension entiÃ¨rement open source de Microsoft qui permet de dÃ©ployer PostgreSQL distribuÃ© Ã  grande Ã©chelle.&lt;/p&gt;&#xA;&lt;h2 id=&#34;episode-4-citus-data&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#episode-4-citus-data&#34;&gt;Ã‰pisode 4Â : Citus Data&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;p&gt;La base de donnÃ©es Citus a connu 127 versions depuis le 24 mars 2016, date Ã  laquelle elle est passÃ©e pour la premiÃ¨re fois gratuite et open source pour son utilisation et ses contributions. Il sâ€™agit dâ€™un outil puissant qui fonctionne nativement avec PostgreSQL et sâ€™intÃ¨gre de maniÃ¨re transparente Ã  tous les outils et extensions Postgres. Voici un rÃ©sumÃ© des points abordÃ©s dans cet Ã©pisode de podcastÂ !&lt;/p&gt;&#xA;&lt;h3 id=&#34;repondre-aux-problematiques-devolutivite-de-performance-et-de-gestion-des-grands-jeux-de-donnees&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#repondre-aux-problematiques-devolutivite-de-performance-et-de-gestion-des-grands-jeux-de-donnees&#34;&gt;RÃ©pondre aux problÃ©matiques dâ€™Ã©volutivitÃ©, de performance et de gestion des grands jeux de donnÃ©es&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Pourquoi Citus Data existe-t-il et quels problÃ¨mes rÃ©sout-il ? Examinons cela par catÃ©gorie.&lt;/p&gt;&#xA;&lt;h4 id=&#34;developpement&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#developpement&#34;&gt;DÃ©veloppement&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;Citus est conÃ§u pour rÃ©soudre le problÃ¨me de la modÃ©lisation des donnÃ©es distribuÃ©es en fournissant des mÃ©thodes de cartographie de la charge de travail dans les modÃ¨les de donnÃ©es distribuÃ©es, telles que des tables de partitionnement basÃ©es sur des clÃ©s primaires (particuliÃ¨rement utiles pour les microservices et les charges de travail Ã  haut dÃ©bit).&lt;/p&gt;&#xA;&lt;h4 id=&#34;evolutivite&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#evolutivite&#34;&gt;Ã‰volutivitÃ©&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;En distribuant les donnÃ©es sur plusieurs nÅ“uds, vous pouvez activer la mise Ã  lâ€™Ã©chelle horizontale des bases de donnÃ©es PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Cela permet aux dÃ©veloppeurs de combiner les capacitÃ©s des processeurs, de mÃ©moire, de stockage et des E/S de plusieurs machines pour gÃ©rer de grands ensembles de donnÃ©es et des charges de travail Ã  trafic Ã©levÃ©. Il est possible dâ€™ajouter facilement davantage de nÅ“uds au cluster et de rÃ©Ã©quilibrer les partitions au fur et Ã  mesure que votre volume de donnÃ©es augmente.&lt;/p&gt;&#xA;&lt;h4 id=&#34;performance&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#performance&#34;&gt;Performance&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;Le moteur de requÃªtes distribuÃ© de Citus est utilisÃ© pour maximiser lâ€™efficacitÃ©, en parallÃ©lisant les requÃªtes et en regroupant lâ€™exÃ©cution de plusieurs nÅ“uds de travail.&lt;/p&gt;&#xA;&lt;p&gt;MÃªme lorsque des milliers, voire des millions dâ€™instructions sont exÃ©cutÃ©es par seconde, lâ€™ingestion de donnÃ©es est toujours optimisÃ©e via la rÃ©cupÃ©ration des bonnes partitions, la connexion aux nÅ“uds appropriÃ©s et la parallÃ©lisation de certaines opÃ©rations. Tout cela garantit un dÃ©bit Ã©levÃ© et une latence faible lors du traitement des donnÃ©es en temps rÃ©el.&lt;/p&gt;&#xA;&lt;h4 id=&#34;haute-disponibilite-et-redondance&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#haute-disponibilite-et-redondance&#34;&gt;Haute disponibilitÃ© et redondance&lt;/a&gt;&lt;/h4&gt;&#xA;&lt;p&gt;GrÃ¢ce au modÃ¨le de donnÃ©es distribuÃ©, vous pouvez crÃ©er des copies redondantes des tables et des partitions sur plusieurs nÅ“uds. Cela permet de garantir que la base de donnÃ©es reste rÃ©siliente et disponible mÃªme en cas de panne de nÅ“uds, et maintenir ainsi une haute disponibilitÃ©.&lt;/p&gt;&#xA;&lt;h3 id=&#34;contribution-a-citus&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#contribution-a-citus&#34;&gt;Contribution Ã  Citus&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Chez Data Bene, notre objectif est de soutenir la dynamique du code source grÃ¢ce au dÃ©veloppement continu et aux contributions au code. CÃ©dric Villemain, entre autres membres de notre Ã©quipe, Ã©value constamment de nouveaux ajouts de fonctionnalitÃ©s ou autres amÃ©liorations qui peuvent faire une diffÃ©rence pour les utilisateurs.&lt;/p&gt;&#xA;&lt;p&gt;Que vous fassiez partie dâ€™une Ã©quipe DevOps qui cherche Ã  crÃ©er une architecture distribuÃ©e pour vos instances PostgreSQL, ou que vous soyez un utilisateur final tel quâ€™un analyste commercial qui recherche des performances efficaces lors du traitement de grandes quantitÃ©s de donnÃ©es, Citus Data peut Ãªtre le meilleur choix.&lt;/p&gt;&#xA;&lt;p&gt;Si vous avez des demandes ou des intÃ©rÃªts particuliers en matiÃ¨re de fonctionnalitÃ©s, notre Ã©quipe de Data Bene vous aidera Ã  contribuer directement Ã  Citus Data ou pourra le faire en votre nom pour garantir la longÃ©vitÃ© du projet Citus et sa pertinence pour vos projets. Apprenez-en davantage sur la contribution Ã  Citus Data en vous rÃ©fÃ©rant au dÃ©pÃ´t officiel &lt;a href=&#34;https://github.com/citusdata/citus/blob/main/CONTRIBUTING.md&#34; rel=&#34;noopener&#34;&gt;CONTRIBUTING.md&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;regardez-lepisode-complet&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#regardez-lepisode-complet&#34;&gt;Regardez lâ€™Ã©pisode complet&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Vous envisagez de regarder la discussion complÃ¨teÂ ? DÃ©couvrez-le sur YouTubeÂ :&lt;/p&gt;&#xA;&lt;iframe width=&#34;560&#34; height=&#34;315&#34; src=&#34;https://www.youtube-nocookie.com/embed/WueRn76nJ9Q?si=ulvzvfcr4Ux17tt0&#34; title=&#34;Lecteur vidÃ©o YouTube&#34; frameborder=&#34;0&#34; allow=&#34;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&#34; referrerpolicy=&#34;strict-origin-when-cross-origin&#34; allowfullscreen=&#34;&#34;&gt;&lt;/iframe&gt;&#xA;&lt;h3 id=&#34;decouvrez-dautres-outils-postgres&#34;&gt;&lt;a class=&#34;heading-anchor&#34; href=&#34;#decouvrez-dautres-outils-postgres&#34;&gt;DÃ©couvrez dâ€™autres outils Postgres&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;p&gt;Dâ€™autres Ã©pisodes sont en cours de publication au Postgres CafÃ©Â ! &lt;a href=&#34;https://www.youtube.com/playlist?list=PLf7KS0svgDP_zJmby3RMzzOVO45qLbruA&#34; rel=&#34;noopener&#34;&gt;Abonnez-vous Ã  la playlist&lt;/a&gt; pour plus dâ€™interviews sur des outils open source comme &lt;a href=&#34;https://codeberg.org/Data-Bene/StatsMgr&#34; rel=&#34;noopener&#34;&gt;StatsMgr&lt;/a&gt; pour une gestion efficace des statistiques PostgreSQL, &lt;a href=&#34;https://github.com/xataio/pgzx&#34; rel=&#34;noopener&#34;&gt;pgzx&lt;/a&gt; pour la crÃ©ation dâ€™extensions PostgreSQL Ã  lâ€™aide de Zig, etc. Laissez les experts vous prÃ©senter de nouvelles extensions Ã  essayer pour optimiser vos dÃ©ploiements Postgres.&lt;/p&gt;&#xA; </content>
    <link href="https://www.data-bene.io/fr/blog/postgres-cafe-deployer-postgresql-distribue-a-grande-echelle-avec-citus-data/" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Sarah Conway</name>
    </author>
  </entry>
  <entry>
    <title>Retour sur le PG Day France 2025</title>
    <updated>2025-06-18T07:56:12Z</updated>
    <id>tag:blog.atolcd.com,2025-06-18:/retour-sur-le-pg-day-france-2025/</id>
    <content type="html">&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;Les 3 et 4 juin derniers, la communautÃ© francophone de PostgreSQL sâ€™est retrouvÃ©e Ã  Mons, en Belgique, Ã  lâ€™occasion de lâ€™Ã©dition 2025 du PG Day France. Chaque annÃ©e depuis 2008, cet Ã©vÃ©nement itinÃ©rant investit une nouvelle ville pour faire vivre et grandir la communautÃ© autour de PostgreSQL. PostgreSQL (prononcÃ© Post-Gress-Q-L) est un systÃ¨me de gestion de base de donnÃ©es relationnelle (SGBDR) open source. Câ€™est lâ€™un des SGBD les plus puissants, fiables et Ã©volutifs du marchÃ©, trÃ¨s prisÃ© par les dÃ©veloppeurs, les entreprises et les administrations.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;AprÃ¨s Toulouse, Lille, Toulon, Marseille, Lyon, Nantes, Montpellier ou encore Strasbourg, câ€™Ã©tait au tour de Mons dâ€™accueillir ateliers, confÃ©rences, retours dâ€™expÃ©rience et moments de convivialitÃ© entre passionnÃ©s, utilisateurs et professionnels du monde PostgreSQL.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Nous avons pu suivre avec intÃ©rÃªt les Ã©changes et les prÃ©sentations qui ont rythmÃ© ces deux journÃ©es. Lâ€™Ã©vÃ©nement a une fois de plus illustrÃ© la richesse de lâ€™Ã©cosystÃ¨mePostgreSQL et les nombreuses possibilitÃ©s quâ€™il offre â€“ bien au-delÃ  du simple SGBD relationnel.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img fetchpriority=&#34;high&#34; decoding=&#34;async&#34; width=&#34;512&#34; height=&#34;483&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-days-1.jpg&#34; alt=&#34;&#34; class=&#34;wp-image-5978&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-days-1.jpg 512w, https://blog.atolcd.com/wp-content/uploads/2025/06/pg-days-1-300x283.jpg 300w&#34; sizes=&#34;(max-width: 512px) 100vw, 512px&#34; /&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Nous saluons lâ€™organisation et lâ€™Ã©nergie des bÃ©nÃ©voles et intervenants qui font du PG Day France un rendez-vous incontournable pour toute la communautÃ© PostgreSQL francophone.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Parmi les temps forts de la premiÃ¨re journÃ©e, plusieurs ateliers techniques Ã©taient proposÃ©s permettant dâ€™assister Ã  un de ces ateliers parmi les 3. Nous avons optÃ© pour un atelier diffÃ©rent chacun Ã  savoir :Â &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Atelier : Industrialisez vos dÃ©ploiements PostgreSQL avec pglift et Ansible&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;&lt;em&gt;Par Alexandre Pereira et Julian Vanden Broeck&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Le but de cet atelier Ã©tait dâ€™industrialiser le dÃ©ploiement des instances, bases de donnÃ©es et rÃ´les PostgreSQL Ã  l&amp;rsquo;aide de pglift et Ansible. Dalibo met Ã  disposition en open source sur son lab ces collections ansible [&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://labs.dalibo.com/dalibo_ansible_collections&#34; rel=&#34;noopener noreferrer&#34;&gt;https://labs.dalibo.com/dalibo_ansible_collections&lt;/a&gt;] ainsi que lâ€™outil pglift [&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://gitlab.com/dalibo/pglift&#34; rel=&#34;noopener noreferrer&#34;&gt;https://gitlab.com/dalibo/pglift&lt;/a&gt;]&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;MalgrÃ© un effet dÃ©mo malencontreux sur les environnements mis Ã  disposition permettant de faire les cas pratiques, cela a permis de voir ce quâ€™il Ã©tait possible de faire avec ces collections et outils pour permettre lâ€™industrialisation des dÃ©ploiements de postgresql, des sauvegardes avec pgbackrest ou encore de la haute disponibilitÃ© avec patroni en utilisant pglift et Ansible.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Atelier: Are you collecting the right metrics ?&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;&lt;em&gt;Par FrÃ©dÃ©ric Delacourt&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Les mÃ©triques sont des donnÃ©es quantifiables permettant de suivre lâ€™Ã©tat de santÃ© et les performances de sa base de donnÃ©es PostgreSQL. Leur principale utilitÃ© est de surveiller la base de donnÃ©es, afin de dÃ©tecter des anomalies dans le but dâ€™alerter les DBA (DataBase Administrator) et les ops/devops d&amp;rsquo;Ã©ventuels problÃ¨mes. Bien utilisÃ©, on peut sâ€™en servir pour comprendre certains comportements pour optimiser les performances et ressources de notre base.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Ces mÃ©triques peuvent Ãªtre classÃ©es en plusieurs catÃ©gories :Â &lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Informatives : qui permettent de suivre et comprendre lâ€™activitÃ© de la base, comme le nombre de requÃªtes par minutes, la taille des tables, la frÃ©quence dâ€™utilisation de chaque indexâ€¦&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Importantes (pour la performance) : qui permettent de dÃ©tecter, anticiper et/ou corriger des lenteurs. On y retrouve par exemple le nombre de connexions ouvertes, le taux de requÃªtes lentes, le taux de bloat dans les tablesâ€¦Critiques : qui peuvent mettre en pÃ©ril lâ€™Ã©tat de santÃ© de la base comme le nombre de transactions bloquÃ©es, un disque presque plein, le nombre d&amp;rsquo;erreurs SQL, des nouvelles connexions rejetÃ©esâ€¦&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Keynote : OÃ¹ sont passÃ©es les femmes de l&amp;rsquo;histoire de la tech? Par Laura Durieux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;La keynote dâ€™ouverture nous a prÃ©sentÃ© des femmes qui ont marquÃ© lâ€™histoire de la tech depuis son commencement, Ã  savoir les calculs astronomiques jusquâ€™au dÃ©veloppement de programme. On a pu en apprendre un peu sur ces femmes clefs de lâ€™histoire avec notamment :Â &lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Nicole-Reine Lepaute qui calcule le retour de la ComÃ¨te de Halley de faÃ§on assez prÃ©cise pour lâ€™Ã©poque (1759)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Maria Mitchell la premiÃ¨re Ã  observer une Â« comÃ¨te tÃ©lescopique Â» (comÃ¨te non visible Ã  lâ€™Å“il nu)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Ada Lovelace qui a Ã©crit les premiÃ¨res formes dâ€™algorithmeÂ &lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Grace Hopper qui a Ã©tÃ© la premiÃ¨re dÃ©veloppeuse sur le Mark I et une des fondatrices du langage COBOL&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;ENIAC Girls Ã©tait un groupe de six programmeuses ayant participÃ© au dÃ©veloppement et Ã  la programmation d&amp;rsquo;un des premiers ordinateurs au monde, l&amp;rsquo;ENIAC&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Hedy Lamarr qui a inventÃ© le FHSS, une technologie qui est toujours derriÃ¨re le wifi et le Bluetooth&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Il y en avait encore dâ€™autres dans la prÃ©sentation que nous vous laisserons dÃ©couvrir si vous avez lâ€™occasion de voir cette confÃ©rence. Cela a Ã©tÃ© aussi lâ€™occasion de voir ce qui a entraÃ®nÃ© la sous-reprÃ©sentation des femmes dans le domaine de la tech Ã  travers notre sociÃ©tÃ© depuis l&amp;rsquo;arrivÃ©e des ordinateurs personnels dans les foyers, souvent associÃ©s au pÃ¨re et leur fils dans les publicitÃ©sâ€¦ On ne voudrait pas vous spoiler trop non plus, mais on vous conseille de la voir, d&amp;rsquo;y rÃ©flÃ©chir et dâ€™agir pour ouvrir le monde de la tech Ã  tous et toutes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Postgres sur Kubernetes pour le DBA rÃ©ticent Par Karen Jex&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Une prÃ©sentation de Postgres sur Kubernetes qui est une Ã©volution des pratiques passant de serveur physique, puis de machines virtuelles et maintenant de conteneurs pour le dÃ©ploiement de PostgreSQL. Kubernetes a dÃ©jÃ  10 ans, il sâ€™agit dâ€™une solution mature qui a montrÃ© ses qualitÃ©s pour le dÃ©ploiement dâ€™applications de faÃ§on automatisÃ©e et scalable mais qui entraÃ®ne quelques rÃ©ticences pour le dÃ©ploiement de base de donnÃ©es, car son principe Ã©tant des conteneurs stateless et Ã©phÃ©mÃ¨res. Mais il y a du stockage persistant qui permet de ne pas perdre ces donnÃ©es. De plus en plus de sociÃ©tÃ©s passent Ã  Kubernetes, le plus grand frein Ã©tant surtout la montÃ©e en compÃ©tence nÃ©cessaire sur Kubernetes mais qui permet une fois ce stade passÃ© de gagner du temps pour dâ€™autres tÃ¢ches nÃ©cessitant lâ€™expertise dâ€™un DBA.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;Tout savoir sur max_connections Par Guillaume Lelarge&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PrÃ©sentation du paramÃ¨tre de configuration â€˜max_connectionsâ€™, son utilisation, les diffÃ©rentes valeurs quâ€™il peut prendre et le changement de performances liÃ©es Ã  ces valeurs.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Avoir une trop grosse valeur de max_connections, permet dâ€™avoir un fort pic dâ€™utilisation de la base, mais la mÃ©moire initiale que prend PostgreSQL sâ€™en voit augmentÃ©e (et de maniÃ¨re trÃ¨s significative, voire exponentielle quand les valeurs deviennent trÃ¨s grandes).&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PrÃ©sentation Ã©galement de la consommation des connexions en comparant des connexions avec pooler et sans pooler. Les avantages et inconvÃ©nients de chacun comme le temps de connexion Ã  la base (qui nâ€™est pas nÃ©cessaire pour les pooler car celle-ci est rÃ©utilisÃ©e) qui peut reprÃ©senter un bon pourcentage du temps total de lâ€™exÃ©cution de la session. La mise en place dâ€™un pooler permet dâ€™augmenter grandement le nombre de transactions par seconde en minimisant ces temps de connexion.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Json in Postgres Par SÃ©bastien Delobel&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PrÃ©sentation du Type Json dans PostgreSQL et son utilisation ainsi que les bonnes pratiques Ã  avoir notamment entre les JSON et les JSONB.&lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Le format JSON permet de stocker la donnÃ©e en texte, il est pratique quand on cherche uniquement Ã  stocker la donnÃ©e sans y toucher. Attention tout de mÃªme, lorsqu&amp;rsquo;un update sur ce champ, lâ€™ancien contenu est Ã©crasÃ© et remplacÃ© par le nouveau.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Le format JSONB quant Ã  lui est plutÃ´t utile pour interroger et modifier les donnÃ©es. Il permet de stocker les informations sous format binaire, ce qui permet plus de flexibilitÃ©. On peut indexer un champ Ã  lâ€™intÃ©rieur du json, faire des recherches et des filtres sur les donnÃ©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Lors dâ€™une modification, on peut ajouter ou supprimer certaines clÃ©s directement et sans avoir Ã  devoir rÃ©Ã©crire tout lâ€™objet pour ne perdre aucune donnÃ©e.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;On retiendra lâ€™usage dâ€™un index b-tree sur une seule valeur et lâ€™utilisation dâ€™un index GIN sur plusieurs valeurs composantes.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;ClÃ´ture de la premiÃ¨re journÃ©e&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;La journÃ©e sâ€™est terminÃ©e par une prÃ©sentation de la ville de Mons par Stefan Fercot qui Ã©tait le contact local de lâ€™Ã©vÃ©nement, avec les diffÃ©rents sites incontournables de la ville : son beffroi, la grand-place, la CollÃ©giale Sainte Waudru, le Doudou et son rituel et surtout le singe du Grandâ€™Garde qui, Ã  lâ€™instar de notre Chouette dijonnaise, porte lui aussi bonheur si on touche sa tÃªte de la main gaucheâ€¯!Â &lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Comme Ã  son accoutumÃ©e, la journÃ©e s&amp;rsquo;est terminÃ©e par un community event dans un lieu incontournable en Belgiqueâ€¦ Ã  savoir une brasserie &lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f609.png&#34; alt=&#34;ğŸ˜‰&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; pour un moment dâ€™Ã©change et de partage entre participants, speakers et organisateurs.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;AprÃ¨s une premiÃ¨re journÃ©e bien remplie, nous voilÃ  prÃªts Ã  attaquer de nouveau une deuxiÃ¨me journÃ©e de prÃ©sentation avec au programme.Â &lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Anatomy of Table-Level Locks in PostgreSQL Par GÃ¼lÃ§in YÄ±ldÄ±rÄ±m Jelinek&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PrÃ©sentation sur les locks, accÃ¨s concurrents, les diffÃ©rents niveaux de blocage en fonction des actions, les diffÃ©rents niveaux dâ€™isolation des transactions et comment faire pour Ã©viter quâ€™une transaction bloque pendant plusieurs minutes, voire heures la base de donnÃ©es.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Si une transaction pose un verrou celui-ci est conservÃ© tant que la transaction nâ€™est pas terminÃ©e, il faut donc veiller Ã  Ã©viter de faire des modifications qui pose un verrou trop important en mÃªme temps quâ€™un gros traitement de donnÃ©es qui garderait un verrou potentiellement exclusif pendant un long moment et bloquerait les autres transactions.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Afin dâ€™analyser et limiter cela, il est possible dâ€™utiliser la vue pg_locks et surtout la fonction pg_blocking_pids() qui permet de voir quels autres processus bloquent le processus en question ainsi que de limiter le temps de lock via le paramÃ¨tre lock_timeout, mais surtout de dÃ©couper les instructions en plusieurs Ã©tapes pour ne pas mixer les types de lock et ne pas bloquer dâ€™autres requÃªtes.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;La prÃ©sentation sâ€™est terminÃ©e par lâ€™usage de lâ€™outil pgroll permettant des modifications de schÃ©ma PostgreSQL sÃ»res, rÃ©versibles et sans temps d&amp;rsquo;arrÃªt.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;RÃ©glage automatisÃ© de PostgreSQL : Explorer l&amp;rsquo;optimisation des paramÃ¨tres serveur Par Luigi Nardi&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PrÃ©sentation de DBtune qui permet dâ€™automatiser lâ€™optimisation de la configuration de base de donnÃ©es Ã  travers le machine learning afin de tester plusieurs configurations et ajuster les paramÃ¨tres pour trouver une configuration optimale pour la base en fonction de la machine, de ces mÃ©triques et de lâ€™usage de celles-ci de faÃ§on dynamique.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Dans les exemples de configurations effectuÃ©es aprÃ¨s plusieurs itÃ©rations de configuration une instance Amazon RDS permettait dâ€™avoir des performances similaires de transactions par secondes quasi identiques entre une instance RDS m5.2xl avec DBtune et une instance de base RDS m5.4xl avec deux fois plus de ressources matÃ©rielles.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Table ronde &amp;#8211; Comment contribuer Ã  PostgreSQL ?&lt;/h3&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Lâ€™importance de la traduction : certains pays oÃ¹ la documentation dans la langue locale nâ€™est pas disponible et oÃ¹ les personnes parlent peu anglais.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;DÃ©couverte de bug et crÃ©ation de ticket et/ou proposition de correctif.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Proposition de nouvelle feature. (plus complexe, car il faut prouver l&amp;rsquo;utilitÃ© de cette feature comparer Ã  un correctif de bug)Â &lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Propager lâ€™existence du rÃ©seau FR pour accueillir de nouveaux â€œadeptesâ€ et montrer que la communautÃ© est accessible et accueillante, comme par exemple par le biais de confÃ©rences ou table ronde comme celle-ci.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Lightning Talks&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Quelques courtes prÃ©sentations de 5 minutes sur diffÃ©rents sujets avec :Â &lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;prÃ©sentation de lâ€™outil pgSimload par Jean-Paul ArgudoÂ &lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;les diffÃ©rents types dâ€™index par Thibaut Madeleine&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;le partitionnement par timestamp avec uuid v7 par Florent Jardin&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;lâ€™extension pg_tde et Percona Server par Yoann La Cancellera&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;FOSS4G Belgium 2025 par Gael Kruwialis&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PostgreSQL Conference Europe 2025 par Marc Linster&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Agent IA et Postgres par Matt Cornillon&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Comment se dÃ©barrasser de Full Page Write ? Par Fabien Coelho&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PrÃ©sentation sur la configuration de full page write afin de ne pas avoir de baisse de performance sur le nombre de transactions par seconde au moment des Ã©critures, mais sa dÃ©sactivation peut poser dâ€™autres questions sur l&amp;rsquo;intÃ©gritÃ© des donnÃ©es. Un paramÃ¨tre Ã  modifier avec prudence.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Voyage au centre des statistiques dans postgres Par Louise Leinweber&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;PrÃ©sentation de multiples solutions natives de Postgres permettant dâ€™avoir des statistiques sur les diffÃ©rentes donnÃ©es et tables utilisÃ©es par le planificateur de requÃªte. On peut retrouver ces donnÃ©es dans la vue systÃ¨me pg_stats qui contient par exemple pour une colonne dâ€™une table les valeurs les plus frÃ©quentes, la frÃ©quence de ces donnÃ©es, la frÃ©quence de valeur nul sur un champâ€¦&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Ã€ partir de ces statistiques, le planificateur de requÃªte va opter pour le meilleur plan Ã  partir dâ€™estimation liÃ© Ã  ces statistiques. Si elles sont erronÃ©es en nombre de lignes estimÃ©es par rapport Ã  la rÃ©alitÃ© cela peut entraÃ®ner de ne pas avoir utilisÃ© le meilleur plan dâ€™exÃ©cution.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;On a pu aussi voir comment est calculÃ©e la sÃ©lectivitÃ© dans diffÃ©rents opÃ©rateurs ainsi que le fonctionnement de la combinaison de sÃ©lectivitÃ© et surtout quâ€™il Ã©tait possible dâ€™agir dessus en crÃ©ant de nouvelles statistiques (&lt;code&gt;CREATE STATISTIC&lt;/code&gt; [&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://www.postgresql.org/docs/17/sql-createstatistics.html&#34; rel=&#34;noopener noreferrer&#34;&gt;https://www.postgresql.org/docs/17/sql-createstatistics.html&lt;/a&gt;]) afin dâ€™influencer sur cela en fonction de cas dâ€™usage spÃ©cifique sâ€™il y a un lien entre diffÃ©rentes colonnes dâ€™une mÃªme table et permettre Ã  PostgreSQL dâ€™avoir une bonne estimation du nombre de lignes, et ainsi rÃ©pondre de faÃ§on plus rapide.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Il est possible de modifier la configuration de ces collectes de statistiques de maniÃ¨re globale, mais aussi par colonne / table.&lt;/p&gt;&#xA;&lt;h3 class=&#34;article-editor-heading&#34;&gt;Comment dÃ©placer une base Postgres avec zÃ©ro downtime ? Par Naeva Mallet&lt;/h3&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Cette confÃ©rence nous montrait un retour dâ€™expÃ©rience chez â€œleboncoinâ€, sur comment dÃ©placer un grand nombre de bases dâ€™instances individuelles vers des instances mutualisÃ©es afin de rÃ©duire les coÃ»ts. L&amp;rsquo;objectif Ã©tait d&amp;rsquo;automatiser le processus pour dÃ©placer les bases en quelques commandes, et surtout avec le moins de downtime possible.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Pour cela la rÃ©plication logique a Ã©tÃ© utilisÃ©e en plusieurs Ã©tapes :&lt;/p&gt;&#xA;&lt;ul class=&#34;article-editor-bullet-list&#34;&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Copie de la structure et clef primaire de la base source&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;publication et souscription de la rÃ©plication logique&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;attente copie des donnÃ©es&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;crÃ©ation des index&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;article-editor-list-item&#34;&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;copie sÃ©quences et suppression de la rÃ©plicationÂ &lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;Cela a aussi abouti Ã  la mise Ã  disposition en open-source de ce script (&lt;a class=&#34;article-editor-link article-editor-link&#34; href=&#34;https://github.com/leboncoin/pg-logical-replication-helper&#34; rel=&#34;noopener noreferrer&#34;&gt;https://github.com/leboncoin/pg-logical-replication-helper&lt;/a&gt;) permettant la migration logique entre deux instances de base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;article-editor-heading article-editor-content__has-focus&#34;&gt;ClÃ´ture&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;512&#34; height=&#34;171&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-fays-2.png&#34; alt=&#34;&#34; class=&#34;wp-image-5980&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2025/06/pg-fays-2.png 512w, https://blog.atolcd.com/wp-content/uploads/2025/06/pg-fays-2-300x100.png 300w&#34; sizes=&#34;(max-width: 512px) 100vw, 512px&#34; /&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;article-editor-paragraph&#34;&gt;AprÃ¨s ces deux jours intensifs de prÃ©sentation, place aux remerciements pour les orateurs, sponsors, bÃ©nÃ©voles de lâ€™association Postgresql FR, participants et graphiste de cette belle affiche. Beaucoup dâ€™informations emmagasinÃ©es, beaucoup d&amp;rsquo;Ã©changes enrichissants avec les organisateurs, participants et orateurs de lâ€™Ã©vÃ©nement. Câ€™est toujours un rÃ©el plaisir de pouvoir Ã©changer avec les membres de la communautÃ© Postgres.&lt;/p&gt;&#xA;&lt;p class=&#34;article-editor-paragraph article-editor-content__has-focus&#34;&gt;Et un remerciement particulier pour les locaux de lâ€™Ã©tape Stephan et Leila qui nous ont fait dÃ©couvrir leur magnifique ville de Mons et la Belgique.Â &lt;/p&gt;&#xA;&#xA;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/&#34;&gt;Retour sur le PG Day France 2025&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=retour-sur-le-pg-day-france-2025" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Les 3 et 4 juin derniers, la communautÃ© francophone de PostgreSQL sâ€™est retrouvÃ©e Ã  Mons, en Belgique, Ã  lâ€™occasion de lâ€™Ã©dition 2025 du PG Day France. Chaque annÃ©e depuis 2008, cet Ã©vÃ©nement itinÃ©rant investit une nouvelle ville pour faire vivre... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/retour-sur-le-pg-day-france-2025/&#34;&gt;Retour sur le PG Day France 2025&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>[Infographie] PostgreSQL</title>
    <updated>2021-02-11T11:23:13Z</updated>
    <id>tag:blog.atolcd.com,2021-02-11:/infographie-postgresql/</id>
    <content type="html">&#xA;&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuliÃ¨rement chez Atol CD ! Retrouvez dans cette infographie quelques caractÃ©ristiques techniques, des chiffres-clÃ©, son histoire mais aussi pourquoi nous l&amp;rsquo;aimons et notre Top5 des fonctionnalitÃ©s cÃ´tÃ© dÃ©veloppement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-gallery columns-1 is-cropped wp-block-gallery-1 is-layout-flex wp-block-gallery-is-layout-flex&#34;&gt;&lt;ul class=&#34;blocks-gallery-grid&#34;&gt;&lt;li class=&#34;blocks-gallery-item&#34;&gt;&lt;figure&gt;&lt;img decoding=&#34;async&#34; width=&#34;866&#34; height=&#34;2560&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; alt=&#34;&#34; data-id=&#34;4477&#34; data-full-url=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; data-link=&#34;https://blog.atolcd.com/infographie-postgresql/infographie_postgresql/&#34; class=&#34;wp-image-4477&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg 866w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-101x300.jpg 101w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-346x1024.jpg 346w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-768x2271.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-520x1536.jpg 520w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-693x2048.jpg 693w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-600x1774.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-945x2794.jpg 945w&#34; sizes=&#34;(max-width: 866px) 100vw, 866px&#34; /&gt;&lt;/figure&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/figure&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/infographie-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=infographie-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuliÃ¨rement chez Atol CD ! Retrouvez dans cette infographie quelques caractÃ©ristiques techniques, des chiffres-clÃ©, son histoire mais aussi pourquoi nous l&amp;#8217;aimons et notre Top5 des fonctionnalitÃ©s cÃ´tÃ© dÃ©veloppement.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 13</title>
    <updated>2020-09-24T05:54:57Z</updated>
    <id>tag:blog.atolcd.com,2020-09-24:/sortie-de-postgresql-13/</id>
    <content type="html">&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-4130&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg&#34; alt=&#34;&#34; width=&#34;960&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg 960w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-300x169.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-768x432.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-600x338.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-945x532.jpg 945w&#34; sizes=&#34;auto, (max-width: 960px) 100vw, 960px&#34; /&gt;MalgrÃ© des actualitÃ©s plutÃ´t moroses au Botswana concernant nos chers Ã©lÃ©phants, il y en a un qui se porte bien et est encore plus fort Ã  savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.Â &lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;AprÃ¨s seulement 3 versions BÃªta et une RC le voilÃ  dans les starting blocks pour dÃ©barquer sur vos serveurs ! Et comme Ã  chaque nouvelle version son&lt;/span&gt; &lt;span style=&#34;font-weight: 400;&#34;&gt;lot de nouveautÃ©s&lt;/span&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;Un petit rappel qui peut parfois Ã©viter bien des catastrophes, si vous avez prÃ©vu de migrer vers PostgreSQL 13, vous devriez jeter un oeil sur &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html#id-1.11.6.5.4&#34;&gt;les potentielles incompatibilitÃ©s avec les prÃ©cÃ©dentes versions&lt;/a&gt;Â  (et aussi sur les versions intermÃ©diaires si vous faite un gap de plusieurs versions d&amp;rsquo;un coup), il est toujours prÃ©fÃ©rable d&amp;rsquo;identifier ces lÃ©gers changements en amont plutÃ´t qu&amp;rsquo;une fois en production. Mais rassurez-vous, dans cette version pas de quoi freiner significativement une migration.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Partitionnement&lt;/h1&gt;&#xA;&lt;p&gt;Des amÃ©liorations sont ajoutÃ©es sur le partitionnement de tables, tant au niveau performance avec l&amp;rsquo;ajout de cas oÃ¹ une jointure directe entre partition peut Ãªtre utilisÃ©e dans une requÃªte, mais aussi de fonctionnalitÃ©s telles queÂ  la gestion des triggers avec le support de la clause BEFORE ou bien encore la rÃ©plication logique sans avoir besoin de publier chaque partition.&lt;/p&gt;&#xA;&lt;h1&gt;Index&lt;/h1&gt;&#xA;&lt;p&gt;LÃ  aussi des amÃ©liorations de performances mais aussi des gains d&amp;rsquo;espace disque sur les index B-tree surtout pour ceux contenant des doublons, mais si vous passez par un pg_upgrade il voudra passer par un reindex pour bÃ©nÃ©ficier de ces changements.&lt;/p&gt;&#xA;&lt;h1&gt;Planificateur&lt;/h1&gt;&#xA;&lt;p&gt;Le planificateur de requÃªte PostgreSQL a lui aussi eu le droit Ã  quelques amÃ©liorations notamment au niveau des statistiques ce qui peut amÃ©liorer les plans d&amp;rsquo;exÃ©cution et donc les performances.&lt;/p&gt;&#xA;&lt;h1&gt;Performance gÃ©nÃ©rale&lt;/h1&gt;&#xA;&lt;p&gt;Les performances ne sont pas en reste dans cette nouvelle version, avec l&amp;rsquo;ajout du &lt;span style=&#34;font-weight: 400;&#34;&gt;tri incrÃ©mentiel ce qui accÃ©lÃ¨re le tri des donnÃ©es dans certains cas, Â sur les agrÃ©gations de hachage qui peuvent dÃ©sormais utiliser le stockage sur disque dans le cadre de grands ensembles d&amp;rsquo;agrÃ©gation, sur la conversion de type entier vers texte.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Vues systÃ¨me&lt;/h1&gt;&#xA;&lt;p&gt;De nouvelles vues systÃ¨me font leur apparition :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#BASEBACKUP-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_basebackup &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#ANALYZE-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_analyze &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/view-pg-shmem-allocations.html&#34;&gt;pg_shmem_allocations &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#MONITORING-PG-STAT-SLRU-VIEW&#34;&gt;pg_stat_slru&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;la vue &lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#PG-STAT-ACTIVITY-VIEW&#34;&gt;pg_stat_activity&lt;/a&gt; se voit elle ajoutÃ©e une colonne leader_pid ce qui permet de retrouver rapidementÂ tous les processus impliquÃ©s dans une requÃªte parallÃ¨le.&lt;/p&gt;&#xA;&lt;h1&gt;FonctionnalitÃ©s&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ajout de la fonctionnalitÃ© &lt;a href=&#34;https://www.postgresql.org/docs/13/sql-select.html#SQL-LIMIT&#34;&gt;FETCH FIRST WITH TIES&lt;/a&gt; (vous trouverez &lt;a href=&#34;http://pgphil.ovh/topn_13_beta_01.php&#34;&gt;ici&lt;/a&gt; un exemple)&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la fonction gen_random_uuid() utilisable sans activer dâ€™extensions&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilitÃ© de renommer une colonne d&amp;rsquo;une vue :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;ALTER VIEW [ IF EXISTS ] name RENAME [ COLUMN ] column_name TO new_column_name&lt;/pre&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la fonction .datetime() dans les jsonpath pour convertir automatique une chaÃ®ne en date ou horodatage&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Client psql&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de nouvelles commandes pour afficher la description de classe d&amp;rsquo;opÃ©rateur et famille d&amp;rsquo;opÃ©rateur&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a class=&#34;link&#34; title=&#34;Meta-Commands&#34; href=&#34;https://www.postgresql.org/docs/13/app-psql.html#APP-PSQL-META-COMMANDS&#34;&gt;&lt;code class=&#34;literal&#34;&gt;\dAc&lt;/code&gt;&lt;/a&gt;,Â &lt;code class=&#34;literal&#34;&gt;\dAf&lt;/code&gt;,Â &lt;code class=&#34;literal&#34;&gt;\dAo&lt;/code&gt;, et &lt;code class=&#34;literal&#34;&gt;\dAp&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Ajout du statut de la transaction dans le promptÂ &lt;br /&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;* dans une transaction&lt;/li&gt;&#xA;&lt;li&gt;! dans un Ã©chec de transaction&lt;/li&gt;&#xA;&lt;li&gt;? pour un Ã©tat indÃ©terminÃ© de la transaction&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Administration&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la capacitÃ© de la commande VACUUM Ã  traiter des index en parallÃ¨le&lt;/li&gt;&#xA;&lt;li&gt;la commande reindexdb peut aussi parallÃ©liser les tÃ¢ches&lt;/li&gt;&#xA;&lt;li&gt;introduction de la notion de Â« trusted extension Â» qui permet Ã  un super utilisateur de dÃ©finir les extensions quâ€™un utilisateur a le droit d&amp;rsquo;installer dans sa base de donnÃ©es en ayant le droit CREATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout pour pg_dump de l&amp;rsquo;option &amp;#8211;include-foreign-data pour inclure dans la sauvegarde les donnÃ©es de serveurs distants&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La liste des nouveautÃ©s dans cette version est grande, toutes les nouveautÃ©s n&amp;rsquo;ont pas Ã©tÃ© abordÃ©es mais vous pouvez bien sur les retrouver dans la &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html&#34;&gt;note de version&lt;/a&gt;. Le focus a surtout Ã©tÃ© fait sur le cÃ´tÃ© utilisateur plutÃ´t qu&amp;rsquo;administrateur de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-13/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-13" rel="alternate"></link>
    <summary type="html">&lt;p&gt;MalgrÃ© des actualitÃ©s plutÃ´t moroses au Botswana concernant nos chers Ã©lÃ©phants, il y en a un qui se porte bien et est encore plus fort Ã  savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.Â  AprÃ¨s... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 11</title>
    <updated>2018-10-19T13:12:39Z</updated>
    <id>tag:blog.atolcd.com,2018-10-19:/sortie-de-postgresql-11/</id>
    <content type="html">&lt;p&gt;AprÃ¨s seulement une release candidate (mais auparavant 4 version bÃªta), PostgreSQL 11 vient de sortir!!!! Et comme Ã  chaque nouvelle version son lot de nouveautÃ©s que nous allons essayer de passer rapidement en revue.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-3169&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg&#34; alt=&#34;&#34; width=&#34;826&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg 826w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-300x196.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-768x502.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-600x392.jpg 600w&#34; sizes=&#34;auto, (max-width: 826px) 100vw, 826px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;AmÃ©lioration de la parallÃ©lisation&lt;/h2&gt;&#xA;&lt;p&gt;Quoi de mieux que de commencer le tour des nouveautÃ©s par un sujet que l&amp;rsquo;on a abordÃ© lors du &lt;a href=&#34;https://blog.atolcd.com/conference-la-parallelisation-au-service-de-loptimisation/&#34;&gt;PG Day France 2018&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL 11 va encore plus loin dans la parallÃ©lisation avec :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;CrÃ©ation d&amp;rsquo;index B-tree en parallÃ¨le&lt;/li&gt;&#xA;&lt;li&gt;ParallÃ©lisation des UNION ALL&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration du Parallel hash join (parallÃ©liser le remplissage dâ€™une seule table de hachage, partagÃ©e) et parallelized sequential scans&lt;/li&gt;&#xA;&lt;li&gt;ParallÃ©lisation sur la crÃ©ation de vue matÃ©rialisÃ©e et table Ã  partir des rÃ©sultats d&amp;rsquo;une requÃªte&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE .. AS, SELECT INTO et CREATE MATERIALIZED VIEW.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un paramÃ¨tre de configuration du serveur Â«Â parallel_leader_participationÂ Â» qui permet de contrÃ´ler si le processus leader participe Ã  l&amp;rsquo;exÃ©cution des sous plans d&amp;rsquo;exÃ©cution&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;AmÃ©lioration du partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilitÃ© de partitionner une table par hashage de clÃ© (en plus des autres)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE hash1 (col1 NUMERIC, col2 VARCHAR(10)) PARTITION BY HASH(col1);&#xD;&#xA;CREATE TABLE hash1a PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 0) ;&#xD;&#xA;CREATE TABLE hash1b PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 1) ;&#xD;&#xA;CREATE TABLE hash1c PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 2) ;&#xD;&#xA;CREATE TABLE hash1d PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 3) ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout possible d&amp;rsquo;une partition par dÃ©faut pour les donnÃ©es ne correspondant Ã  aucune partition&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table1d PARTITION OF table1 DEFAULT;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilitÃ© de crÃ©er des clÃ©s primaires, clÃ©s Ã©trangÃ¨res, index et triggers qui seront automatiquement applicables sur l&amp;rsquo;ensemble des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support du changement automatique de partition en cas de mise Ã  jour de la clÃ© de partitionnement&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances lors des SELECT sur la lecture des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support des upsert sur les tables partitionnÃ©es&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;INSERT  INTO  tablep1 (col1, col2) &#xD;&#xA;VALUES  (100,  &#39;update&#39;) &#xD;&#xA;ON  CONFLICT ON CONSTRAINT tablep1_pkey &#xD;&#xA;DO UPDATE SET col2=&#39;update&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Gestion des transactions dans les procÃ©dures stockÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit la possibilitÃ© de crÃ©er des procÃ©dures (en PL/pgSQL, PL/Perl, PL/Python, et PL/Tcl). Depuis de nombreuses annÃ©es, il est possible dans PostgreSQL de crÃ©er des fonctions et bien ici Ã§a y ressemble fortement, sauf que l&amp;rsquo;on ne retourne pas de rÃ©sultats et que l&amp;rsquo;on peut gÃ©rer les transactions !&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PROCEDURE transaction_test1()&#xD;&#xA;LANGUAGE plpgsql&#xD;&#xA;AS $$&#xD;&#xA;BEGIN&#xD;&#xA;  FOR i IN 0..9 LOOP&#xD;&#xA;    INSERT INTO table1 (col1) VALUES (i) ;&#xD;&#xA;    IF i % 2 = 0 THEN&#xD;&#xA;      COMMIT;&#xD;&#xA;    ELSE&#xD;&#xA;      ROLLBACK;&#xD;&#xA;    END IF;&#xD;&#xA;  END LOOP;&#xD;&#xA;END;&#xD;&#xA;$$;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;exÃ©cution de ces procÃ©dures se fait en utilisant la commande CALL&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CALL transaction_test1();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Compilation JIT&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit le support de la compilation Just-in-Time (JIT) pour optimiser lâ€™exÃ©cution de code et dâ€™autres opÃ©rations. Utilisant des composants du projet LLVM, lâ€™introduction de JIT dans PostgreSQL accÃ©lÃ¨re les requÃªtes utilisant des expressions, listes, agrÃ©gats, projections, ainsi que certaines opÃ©rations internes.&lt;/p&gt;&#xA;&lt;p&gt;Pour pouvoir utiliser la compilation JIT, vous devrez installer la dÃ©pendance LLVM puis activer la compilation JIT soit dans le fichier de configuration (jit = on), soit durant votre session en exÃ©cutant SET jit = on.&lt;/p&gt;&#xA;&lt;p&gt;La compilation JIT bÃ©nÃ©ficie surtout aux requÃªtes de longue durÃ©e et limitÃ©es par le processeur. Ce seront souvent des requÃªtes analytiques (OLAP). Pour les requÃªtes courtes, le surcoÃ»t apportÃ© par la compilation JIT sera souvent supÃ©rieur au temps qu&amp;rsquo;elle permet de gagner.&lt;/p&gt;&#xA;&lt;h2&gt;AmÃ©liorations gÃ©nÃ©rales SQL&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de toutes les clauses (SQL:2011) dans les fonctions de fenÃªtrage ce qui permet maintenant lâ€™utilisation de RANGE dans des clauses PRECEDING/FOLLOWING, GROUPS ou dâ€™exclusion&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;WINDOW window_name AS ( &#xD;&#xA;  [ PARTITION BY expression [, ...] ]&#xD;&#xA;  [ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]&#xD;&#xA;  [ frame_clause ]&#xD;&#xA;)&#xD;&#xA;&#xD;&#xA;frame_clause :&#xD;&#xA;{ RANGE | ROWS | GROUPS } frame_start [ frame_exclusion ]&#xD;&#xA;{ RANGE | ROWS | GROUPS } BETWEEN frame_start AND frame_end [ frame_exclusion ]&#xD;&#xA;&#xD;&#xA;frame_start / frame_end :&#xD;&#xA;&#xD;&#xA;UNBOUNDED PRECEDING&#xD;&#xA;offset PRECEDING&#xD;&#xA;CURRENT ROW&#xD;&#xA;offset FOLLOWING&#xD;&#xA;UNBOUNDED FOLLOWING&#xD;&#xA;&#xD;&#xA;frame_exclusion :&#xD;&#xA;&#xD;&#xA;EXCLUDE CURRENT ROW&#xD;&#xA;EXCLUDE GROUP&#xD;&#xA;EXCLUDE TIES&#xD;&#xA;EXCLUDE NO OTHERS&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de fonctions de hash sha-2 : sha224(), sha256(), sha384() et sha512()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions de recherche plein texte : json(b)_to_tsvector() et websearch_to_tsquery()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;opÃ©rateur ^@ identique Ã  LIKE &amp;lsquo;mot%&amp;rsquo; mais plus efficace sur un index b-tree&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;text ^@ text&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration des index avec l&amp;rsquo;ajout du mot clef INCLUDE, qui permet d&amp;rsquo;indiquer une liste de colonnes qui seront incluses dans l&amp;rsquo;index comme des colonnes non clÃ©s. L&amp;rsquo;ajout de colonnes dans la crÃ©ation d&amp;rsquo;index permet alors l&amp;rsquo;utilisation de parcours d&amp;rsquo;index couvrants.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE [ UNIQUE ] INDEX [ CONCURRENTLY ] [ [ IF NOT EXISTS ] nom ] ON [ ONLY ] nom_table [ USING mÃ©thode ]&#xD;&#xA;    ( { nom_colonne | ( expression ) } [ COLLATE collation ] [ classeop ] [ ASC | DESC ] [ NULLS { FIRST | LAST } ] [, ...] )&#xD;&#xA;    [ INCLUDE ( nom_colonne [, ...] ) ]&#xD;&#xA;    [ WITH ( parametre_stockage = valeur [, ... ] ) ]&#xD;&#xA;    [ TABLESPACE nom_espacelogique ]&#xD;&#xA;    [ WHERE prÃ©dicat ]&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration de lâ€™ordre ALTER TABLE .. ADD COLUMN .. DEFAULT .. avec une valeur par dÃ©faut non NULL nâ€™a plus besoin de rÃ©Ã©crire entiÃ¨rement la table lors de son exÃ©cution, ce qui entraÃ®ne une grosse amÃ©lioration des performances.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Authentification&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;authentification LDAP, mais celle ci n&amp;rsquo;est utilisÃ©e que pour valider les paires nom d&amp;rsquo;utilisateur/mot de passe. De ce fait, pour pouvoir utiliser LDAP comme mÃ©thode d&amp;rsquo;authentification, l&amp;rsquo;utilisateur doit prÃ©alablement exister dans la base.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;psql&lt;/h2&gt;&#xA;&lt;p&gt;Le client psql Ã©volue lui aussi :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des commandes Â«Â quitÂ Â» et Â«Â exitÂ Â» dans le client psql&amp;#8230; (fini les personnes prisent de panique pour sortir de leur terminal ??? )&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://media.giphy.com/media/xTk9ZBWrma4PIC9y4E/giphy.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la commande \gdesc pour afficher les noms et types de colonnes du rÃ©sultat de la requÃªte&lt;/li&gt;&#xA;&lt;li&gt;Ajout de variables pour les erreurs et activitÃ©s des requÃªtes ERROR, SQLSTATE, ROW_COUNT, LAST_ERROR_MESSAGE, and LAST_ERROR_SQLSTATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilitÃ© de tester l&amp;rsquo;existence d&amp;rsquo;une variable par exemple dans un if&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;\if :{?variable_name}&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration de la complÃ©tion dans l&amp;rsquo;Ã©criture de requÃªtes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;En dehors de ces nouveautÃ©s en terme d&amp;rsquo;utilisation, cette nouvelle version apporte aussi des amÃ©liorations de performance et d&amp;rsquo;utilisation de mÃ©moire.&lt;/p&gt;&#xA;&lt;p&gt;Et voilÃ , nous avons fini notre petit tour rapide des nouveautÃ©s de postgreSQL 11, mais ne vous inquiÃ©tez pas une version 12 est dÃ©jÃ  en prÃ©paration pour le troisiÃ¨me trimestre 2019.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-11/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-11" rel="alternate"></link>
    <summary type="html">&lt;p&gt;AprÃ¨s seulement une release candidate (mais auparavant 4 version bÃªta), PostgreSQL 11 vient de sortir!!!! Et comme Ã  chaque nouvelle version son lot de nouveautÃ©s que nous allons essayer de passer rapidement en revue. AmÃ©lioration de la parallÃ©lisation Quoi de... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Pimp My PostgreSQL</title>
    <updated>2018-01-26T11:07:23Z</updated>
    <id>tag:blog.atolcd.com,2018-01-26:/pimp-my-postgresql/</id>
    <content type="html">&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignright wp-image-2934&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pimp-my-postgresql.png&#34; alt=&#34;&#34; width=&#34;491&#34; height=&#34;290&#34; /&gt;Une question qui se pose souvent aprÃ¨s l&amp;rsquo;installation d&amp;rsquo;une instance postgreSQL, c&amp;rsquo;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par dÃ©faut, ce qui ne va pas poser vraiment de problÃ¨me pour une utilisation lÃ©gÃ¨re. Mais si on a une instance postgreSQL avec postGIS et des millions d&amp;rsquo;enregistrements, cela va rapidement se trouver problÃ©matique si on laisse les valeurs par dÃ©faut&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;Pour les initiÃ©s qui installent rÃ©guliÃ¨rement de nouvelles instances postgreSQL, se plonger dans les plus de 600 lignes du fichier de configuration par dÃ©faut ne les effraie pas. Mais on n&amp;rsquo;installe pas forcÃ©ment tous les jours un nouveau serveur avec des caractÃ©ristiques diffÃ©rentes. Il faut donc soit se replonger pour une centiÃ¨me fois dans la documentation de postgres pour se rappeler Ã  notre bonne mÃ©moire les diffÃ©rents paramÃ¨tres et les valeurs Ã  adapter en fonction de la ram, disque, cpu&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;En plus de devoir se rappeler les &lt;strong&gt;paramÃ¨tres Ã  modifier,&lt;/strong&gt; il faut aussi connaÃ®tre les &lt;strong&gt;rÃ¨gles de calcul &lt;/strong&gt;pour les valeurs comme par exemple le Â«Â effective_cache_sizeÂ Â» qui est prÃ©conisÃ© Ã  75% de la ram total du serveur si celui-ci est dÃ©diÃ© Ã  postgres.&lt;/p&gt;&#xA;&lt;p&gt;Le but de cet article n&amp;rsquo;est pas de voir ni de dÃ©tailler tous les paramÃ¨tres de configuration possibles et inimaginables, mais de voir cela comme un mÃ©mo pour les initiÃ©s ou de sâ€™interroger sur les &lt;strong&gt;paramÃ¨tres qui seraient potentiellement Ã  modifier en fonction du serveur&lt;/strong&gt; (et des applications qui l&amp;rsquo;utilisent) si l&amp;rsquo;on ne connait pas l&amp;rsquo;utilisation des paramÃ¨tres de ce fichier postgresql.conf.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela un petit outil a Ã©tÃ© conÃ§u par Cybertec, qui permet de renseigner quelques caractÃ©ristiques et de voir Ã©voluer en consÃ©quence le fichier postgresql.conf notamment en fonction de la ram du serveur, du nombre de cpu, de la taille de la base&amp;#8230; etc.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-2925&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png&#34; alt=&#34;&#34; width=&#34;1005&#34; height=&#34;993&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png 1005w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-300x296.png 300w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-768x759.png 768w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-945x934.png 945w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-600x593.png 600w&#34; sizes=&#34;auto, (max-width: 1005px) 100vw, 1005px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cela ne remplace pas une connaissance aguerrie de postgreSQL et de sa configuration mais Ã§a permet de se faire une idÃ©e des paramÃ¨tres Ã  adapter en fonction de son serveur et de ses besoins.&lt;/p&gt;&#xA;&lt;p&gt;Cet outil est disponible en ligne Ã  cette adresse : &lt;a href=&#34;http://pgconfigurator.cybertec.at/&#34;&gt;http://pgconfigurator.cybertec.at/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/pimp-my-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=pimp-my-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Une question qui se pose souvent aprÃ¨s l&amp;#8217;installation d&amp;#8217;une instance postgreSQL, c&amp;#8217;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par dÃ©faut, ce qui ne va pas poser vraiment de problÃ¨me pour une... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 10</title>
    <updated>2017-10-05T13:28:32Z</updated>
    <id>tag:blog.atolcd.com,2017-10-05:/sortie-de-postgresql-10/</id>
    <content type="html">&lt;p&gt;Aujourd&amp;rsquo;hui, c&amp;rsquo;est la sortie de &lt;strong&gt;PostgreSQL 10&lt;/strong&gt;!!!! PremiÃ¨re rÃ©volution, la numÃ©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures Ã  10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des donnÃ©es. Une opÃ©ration beaucoup plus lourde que la seule mise Ã  jour des exÃ©cutables !&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2788&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg&#34; alt=&#34;&#34; width=&#34;558&#34; height=&#34;337&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg 558w, https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10-300x181.jpg 300w&#34; sizes=&#34;auto, (max-width: 558px) 100vw, 558px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Voici quelques dÃ©tails sur cette&lt;strong&gt; nouvelle version 10&lt;/strong&gt; et ce qu&amp;rsquo;elle apporte :&lt;/p&gt;&#xA;&lt;h2&gt;Performance et partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Le partitionnement de table est maintenant un attribut de la table :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table_name ( ... )&#xD;&#xA;[ PARTITION BY { RANGE | LIST } ( { column_name | ( expression ) }&#xD;&#xA;&#xD;&#xA;CREATE TABLE table_name&#xD;&#xA;PARTITION OF parent_table [ (&#xD;&#xA;) ] FOR VALUES partition_bound_spec&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;PostgreSQL 10 va plus loin dans la parallÃ©lisation avec le parallÃ©lisme des Index-Only Scan, Index Scan, Bitmap Heap Scan, Merge Join / Gather Merge, Subplan-Related Improvements&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances pour les agrÃ©gats et jointures avec &lt;code&gt;postgres_fdw&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances de l&amp;rsquo;analyseur de requÃªte&lt;/li&gt;&#xA;&lt;li&gt;Apparition des statistiques multi-colonnes&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration du plan dâ€™exÃ©cution des requÃªtes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;RÃ©plication et scalabilitÃ©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;RÃ©plication logique : lÃ©gÃ¨re et basÃ©e sur les WAL, rÃ©pliquant les objets individuellement via les commandes PUBLICATION (primaire) et SUBSCRIPTION (secondaire)&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PUBLICATION financials FOR TABLE ONLY loans, ONLY fines;&lt;/pre&gt;&lt;br /&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE SUBSCRIPTION financials&#xD;&#xA;CONNECTION &#39;dbname=libdata user=postgres host=172.17.0.2&#39;&#xD;&#xA;PUBLICATION financials;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;QUORUM replication : avec ANY et FIRST pour synchronous_standby_names;&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;synchronous_standby_names = ANY 2(node1,node2,node3);&#xD;&#xA;synchronous_standby_names = FIRST 2(node1,node2);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Suppression automatique Ã  la fin de la session des slots de rÃ©plication temporaires&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration de libpq permettant des connexions a de multiples systÃ¨mes&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances de la rÃ©plication physique&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Administration&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de la compression pour pg_receivewal&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;informations sur les Background processes et Wait Events dans pg_stat_activity&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions qui remontent Ã  l&amp;rsquo;utilisateur des informations sur le status de transaction. L&amp;rsquo;usage principal de ces fonctions est de dÃ©terminer les transactions commitÃ©es entre deux snapshots.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;txid_status(bigint)&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;FonctionnalitÃ©s SQL et dÃ©veloppeurs&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Gestion de colonne Identity qui vise Ã  remplacer l&amp;rsquo;utilisation du type serial et qui est conforme au standard SQL&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE test_new (&#xD;&#xA;    id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,&#xD;&#xA;    payload text&#xD;&#xA;);&lt;/pre&gt;&lt;p&gt;plus d&amp;rsquo;informations sur ce sujet &lt;a href=&#34;https://blog.2ndquadrant.com/postgresql-10-identity-columns/&#34;&gt;ici par exemple&lt;/a&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;PossibilitÃ© de renommer la valeur d&amp;rsquo;une Ã©numÃ©ration&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TYPE langage AS ENUM (&#39;SQL&#39;, &#39;JAVA&#39;, &#39;HTML&#39;) ;&#xD;&#xA;ALTER TYPE langage RENAME VALUE &#39;HTML&#39; TO &#39;HTML5&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des triggers AFTER STATEMENT qui peuvent avoir accÃ¨s Ã  lâ€™ensemble des lignes modifiÃ©es, avant et aprÃ¨s changement, Ã  travers une pseudo-variable de type table&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TRIGGER nom_trigger AFTER DELETE ON nom_table&#xD;&#xA;REFERENCING OLD TABLE AS OLD&#xD;&#xA;FOR EACH STATEMENT&#xD;&#xA;EXECUTE PROCEDURE nom_procedure();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la fonction xmltable qui produit une table basÃ©e sur la valeur XML donnÃ©e.&lt;/li&gt;&#xA;&lt;li&gt;Supprimer des Ã©lÃ©ments d&amp;rsquo;un JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;SELECT &#39;{&#34;a&#34;:1 , &#34;b&#34;:2, &#34;c&#34;:3}&#39;::jsonb - &#39;{a,c}&#39;::text[] ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Il est possible de crÃ©er des indexes full text sur une colonne JSON ou JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE INDEX bookdata_fts ON bookdata&#xD;&#xA;USING gin (( to_tsvector(&#39;english&#39;,bookdata) ));&#xD;&#xA;&#xD;&#xA;SELECT bookdata -&amp;gt; &#39;title&#39;&#xD;&#xA;FROM bookdata&#xD;&#xA;WHERE to_tsvector(&#39;english&#39;,bookdata) @@ to_tsquery(&#39;duke&#39;);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;SÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Authentification SCRAM plus sÃ©curisÃ©e que md5&lt;/li&gt;&#xA;&lt;li&gt;CrÃ©ation de nouveau rÃ´le pour le monitoring Ã©vitant ainsi d&amp;rsquo;Ãªtre super utilisateur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;pg_read_all_settings : Lit toutes les variables de configuration, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_read_all_stats : Lit toutes les vues pg_stat_* et utilise plusieurs extensions relatives aux statistiques, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_stat_scan_tables : ExÃ©cute des fonctions de monitoring pouvant prendre des verrous verrous ACCESS SHARE sur les tables, potentiellement pour une longue durÃ©e.&#xD;&#xA;pg_monitor : Lit et exÃ©cute plusieurs vues et fonctions de monitoring. Ce rÃ´le est membre de pg_read_all_settings, pg_read_all_stats et pg_stat_scan_tables.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de politiques restrictive dans les politiques de sÃ©curitÃ© pour l&amp;rsquo;accÃ¨s aux lignes et plus seulement de politiques permissives&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE POLICY admin_local_only ON passwd AS RESTRICTIVE TO admin&#xD;&#xA;    USING (pg_catalog.inet_client_addr() IS NULL);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Autres fonctionnalitÃ©s&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;file_fdw peut maintenant utiliser les programmes&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE FOREIGN TABLE&#xD;&#xA;   test(a int, b text)&#xD;&#xA;   SERVER csv&#xD;&#xA;   OPTIONS (program &#39;gunzip -c /tmp/data.czv.gz&#39;);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;support des collations ICU&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un module amcheck permettant de vÃ©rifier cohÃ©rence / corruption d&amp;rsquo;un index B-Tree&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE EXTENSION amcheck ;&#xD;&#xA;   SELECT bt_index_check(&#39;idx1_check1&#39;) ;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Modifications entrainant une incompatibilitÃ© ascendante&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;â€œxlogâ€ et â€œclogâ€ qui deviennent respectivement â€œwalâ€ et â€œxactâ€.&lt;/li&gt;&#xA;&lt;li&gt;fin du support du protocole client/serveur 1.0 (clients datant dâ€™avant la version 6.3)&lt;/li&gt;&#xA;&lt;li&gt;changement de valeurs par dÃ©faut pour pg_basebackup&lt;/li&gt;&#xA;&lt;li&gt;fin du support des TIMESTAMP avec floating point.&lt;/li&gt;&#xA;&lt;li&gt;Le module contrib/tsearch2 a Ã©tÃ© supprimÃ© qui permettait une comptabilitÃ© avec les fonction de recherche full text avant la version 8.3&lt;/li&gt;&#xA;&lt;li&gt;fin du support de la commande pg_dump pour les bases de donnÃ©es plus anciennes que la version 8.0&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Et voilÃ , nous avons fini notre petit tour rapide des nouveautÃ©s de postgreSQL 10 mais une version 11 est dÃ©jÃ  prÃ©vue pour dans 12 mois !&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-10/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-10" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Aujourd&amp;#8217;hui, c&amp;#8217;est la sortie de PostgreSQL 10!!!! PremiÃ¨re rÃ©volution, la numÃ©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures Ã  10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Romy Fuentes</name>
    </author>
  </entry>
  <entry>
    <title>Le partitionnement par UUID v7</title>
    <updated>2025-06-17T08:45:00Z</updated>
    <id>tag:fljd.in,2025-06-17:/2025/06/17/le-partitionnement-par-uuid-v7/</id>
    <link href="https://fljd.in/2025/06/17/le-partitionnement-par-uuid-v7/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Au dernier PG Day 2025, jâ€™ai pris la parole pour prÃ©senter une mÃ©thode de&#xA;conception que je juge mature et astucieuseâ€¯: le partitionnement temporel&#xA;avec le type UUID et sa version 7.&lt;/p&gt;&#xA;&lt;p&gt;Le support de prÃ©sentation est disponible Ã  cette &lt;a href=&#34;https://fljd.in/documents/pgdayfr-2025-lightning-talk-partitionnement-uuidv7.pdf&#34;&gt;adresse&lt;/a&gt; et je reprendrais&#xA;dans cet article, les exemples en guise de dÃ©monstration. Je vous propose de&#xA;passer en dÃ©tail ce que jâ€™ai pu y dire, et ne pas y dire faute de temps.&#xA;Ã‰galement, je vous invite Ã  lire ou redÃ©couvrir mes recherches sur le&#xA;&lt;a href=&#34;https://fljd.in/2021/04/23/le-partitionnement-par-hachage/&#34;&gt;partitionnement par hachage&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Substituer une variable dans un script SQL</title>
    <updated>2024-11-25T08:00:00Z</updated>
    <id>tag:fljd.in,2024-11-25:/2024/11/25/substituer-une-variable-dans-un-script-sql/</id>
    <link href="https://fljd.in/2024/11/25/substituer-une-variable-dans-un-script-sql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Il est frÃ©quent de vouloir automatiser une tÃ¢che rÃ©pÃ©titive en la scriptant&#xA;rapidement, puis Ã  force d&amp;rsquo;itÃ©rations, de l&amp;rsquo;enrichir, voire de l&amp;rsquo;intÃ©grer dans&#xA;la base de code d&amp;rsquo;un projet. Ã€ ce jeu, les outils comme SQL*Plus et psql peuvent&#xA;Ãªtre de puissants alliÃ©s et des interprÃ©teurs aussi pertinents que Bash ou&#xA;Python.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des projets de migration que je mÃ¨ne rÃ©guliÃ¨rement, il m&amp;rsquo;arrive de&#xA;tomber sur ces scripts, en grand nombre. Certains ont la particularitÃ© de&#xA;proposer des paramÃ¨tres d&amp;rsquo;entrÃ©e, traitÃ©s par SQL*Plus avec le mÃ©canisme trÃ¨s&#xA;confortable de substitution de variables. Dans cet article, je partage quelques&#xA;astuces pour convertir certains aspects de ces scripts grÃ¢ce aux fonctionnalitÃ©s&#xA;Ã©quivalentes que l&amp;rsquo;on retrouve sur l&amp;rsquo;outil psql de PostgreSQL.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Poissons et coquillages</title>
    <updated>2024-10-14T08:30:00Z</updated>
    <id>tag:fljd.in,2024-10-14:/2024/10/14/poissons-et-coquillages/</id>
    <link href="https://fljd.in/2024/10/14/poissons-et-coquillages/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;En tant que pur produit acadÃ©mique des annÃ©es 2010, mon langage de script de prÃ©dilection a&#xA;toujours Ã©tÃ© le Bash (&lt;em&gt;Bourne Again Shell&lt;/em&gt;). Non sans ignorer qu&amp;rsquo;il ait pu en exister d&amp;rsquo;autres, je&#xA;ne me suis jamais vraiment tournÃ© vers d&amp;rsquo;autres shells pour automatiser les tÃ¢ches du quotidien&#xA;dans mon mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;Et pour cause, j&amp;rsquo;ai administrÃ© des centaines de serveurs de distributions trÃ¨s variÃ©es et il&#xA;n&amp;rsquo;Ã©tait pas bien vu d&amp;rsquo;installer des dÃ©pendances systÃ¨mes lourdes pour enrichir des scripts Python&#xA;ou Perl. Nous apprenions donc Ã  Ã©crire des scripts portables et universels, compatibles partout&#xA;oÃ¹ nous dÃ©posions nos valises.&lt;/p&gt;&#xA;&lt;p&gt;Me suis-je enfermÃ© dans un dogme conservateur, en m&amp;rsquo;interdisant &lt;em&gt;de facto&lt;/em&gt; Ã  me tourner vers des&#xA;shells modernes et bien plus aisÃ©s Ã  apprÃ©henderÂ ?&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Les types hiÃ©rarchiques</title>
    <updated>2024-09-19T11:20:00Z</updated>
    <id>tag:fljd.in,2024-09-19:/2024/09/19/les-types-hierarchiques/</id>
    <link href="https://fljd.in/2024/09/19/les-types-hierarchiques/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Bien que la norme SQL dÃ©finisse un ensemble de rÃ¨gles pour que les systÃ¨mes de bases&#xA;de donnÃ©es puissent Ãªtre interchangeables, il existe de petites singularitÃ©s dans la&#xA;nature. Ã€ ce titre, le type de donnÃ©es &lt;code&gt;hierarchyid&lt;/code&gt; fourni par SQL Server est un&#xA;exemple flagrant. Si vous Ãªtes amenÃ© Ã  basculer vers PostgreSQL, deux solutions s&amp;rsquo;offrent&#xA;Ã  vous.&lt;/p&gt;&#xA;&lt;p&gt;Une premiÃ¨re et plus simple consiste Ã  lier chaque nÅ“ud Ã  son parent Ã  l&amp;rsquo;aide d&amp;rsquo;une nouvelle&#xA;colonne &lt;code&gt;parentid&lt;/code&gt; et d&amp;rsquo;y appliquer une contrainte de clÃ© Ã©trangÃ¨re. Une autre approche,&#xA;plus complÃ¨te, consiste Ã  utiliser l&amp;rsquo;extension &lt;code&gt;ltree&lt;/code&gt;. Cet article traite de ce dernier&#xA;cas.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Faire vivre une communautÃ©</title>
    <updated>2024-07-30T09:30:00Z</updated>
    <id>tag:fljd.in,2024-07-30:/2024/07/30/faire-vivre-une-communaute/</id>
    <link href="https://fljd.in/2024/07/30/faire-vivre-une-communaute/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le &lt;a href=&#34;https://pgday.fr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PG Day France&lt;/a&gt; s&amp;rsquo;est tenu les 11 et 12 juin derniers Ã  Lille, ma ville natale.&#xA;Il s&amp;rsquo;agit de l&amp;rsquo;Ã©vÃ©nement de la communautÃ© franÃ§aise de PostgreSQL qui pose ses valises dans une&#xA;ville diffÃ©rente chaque annÃ©e. L&amp;rsquo;occasion Ã©tait trop belle pour moi et j&amp;rsquo;y ai rencontrÃ© de nombreuses&#xA;personnes venant de toute la France et de ses alentours, pour discuter de PostgreSQL au cours&#xA;de deux jours d&amp;rsquo;ateliers et de confÃ©rences.&lt;/p&gt;&#xA;&lt;p&gt;Pour cette Ã©dition, j&amp;rsquo;ai eu le plaisir de prendre la parole et de faire un retour d&amp;rsquo;expÃ©rience&#xA;sur l&amp;rsquo;animation du groupe Meetup local dont j&amp;rsquo;ai repris les rennes il y a maintenant quatre ans.&#xA;Dans cet article, je souhaite retranscrire les principaux points abordÃ©s lors de cette prÃ©sentation,&#xA;en attendant que la vidÃ©o de la confÃ©rence soit mise en ligne.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Basics : lire un plan dâ€™exÃ©cution comme unÂ·e pro (ou presque)</title>
    <updated>2025-05-13T15:20:05Z</updated>
    <id>tag:blog.capdata.fr,2025-05-13:/index.php/postgresql-basics-lire-un-plan-dexecution/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;title=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h1&gt;Introduction :&lt;/h1&gt;&#xA;&lt;p&gt;Quand une requÃªte PostgreSQL est considÃ©rÃ©e comme lente ou que ses performances se dÃ©gradent soudainement, il y a un rÃ©flexe Ã  toujours avoir : utiliser les plans d&amp;#8217;exÃ©cution. Je nâ€™apprends certainement rien Ã  la majoritÃ© des personnes qui liront cet article, mais si cela permet de garder vigilants les dÃ©butants et de leur enseigner quelques ficelles, alors cet article vaut le coup.&lt;/p&gt;&#xA;&lt;p&gt;Si vous avez dÃ©jÃ  Ã©tÃ© dans le cas de figure oÃ¹ un plan d&amp;#8217;exÃ©cution est trop gros pour que vous sachiez par quel bout le prendre, ou si vous avez l&amp;#8217;impression qu&amp;#8217;on vous parle chinois quand on Ã©voque les index scan ou les &amp;#8220;cost&amp;#8221; d&amp;#8217;une requÃªte, alors vous Ãªtes au bon endroit.&lt;/p&gt;&#xA;&lt;p&gt;Dans cet article, premier d&amp;#8217;une sÃ©rie sur les bases de PostgreSQL, nous allons dÃ©mystifier l&amp;#8217;optimisation des requÃªtes en utilisant EXPLAIN comme point de dÃ©part, et les plans d&amp;#8217;exÃ©cution gÃ©nÃ©rÃ©s comme fil conducteur.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™objectif : vous aider Ã  identifier rapidement les informations clÃ©s, repÃ©rer les goulots dâ€™Ã©tranglement, et gagner en autonomie pour diagnostiquer les performances de vos requÃªtes.&lt;/p&gt;&#xA;&lt;p&gt;Câ€™est parti !&lt;/p&gt;&#xA;&lt;h2&gt;EXPLAIN ANALYZE : câ€™est quoi exactement et pourquoi lâ€™utiliser ?&lt;/h2&gt;&#xA;&lt;p&gt;Pour commencer, il faut savoir qu&amp;#8217;un moteur de base de donnÃ©es, que ce soit PostgreSQL ou un autre ne &amp;#8220;lit&amp;#8221; pas une requÃªte comme un humain pourrait la lire, de gauche Ã  droite. Il Ã©labore plutÃ´t un plan d&amp;#8217;exÃ©cution : il crÃ©Ã© un ensemble d&amp;#8217;Ã©tape qui se veulent le plus optimisÃ©es possible pour aller chercher les donnÃ©es que vous lui demander de la faÃ§on la plus efficace possible.&lt;/p&gt;&#xA;&lt;p&gt;Il y a un moyen simple de voir ce plan d&amp;#8217;exÃ©cution, c&amp;#8217;est d&amp;#8217;utiliser la commande EXPLAIN ANALYZE. Elle nous permet en plus de comprendre de quelle faÃ§on le moteur Ã  rÃ©ellement exÃ©cutÃ© notre ordre SQL (et pas seulement comment il pensait le faire). C&amp;#8217;est un peu comme lire un journal de bord de l&amp;#8217;exÃ©cution de la requÃªte.&lt;/p&gt;&#xA;&lt;h3&gt;Prenons un exemple simple :&lt;/h3&gt;&#xA;&lt;p&gt;Imaginons que nous avons une table users, constituÃ©e comme tel :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;CREATE TABLE users (&#xD;&#xA;id integer PRIMARY KEY,&#xD;&#xA;name vachar(30),&#xD;&#xA;age integer,&#xD;&#xA;email varchar(80) );&lt;/pre&gt;&#xA;&lt;p&gt;Et que nous souhaitons utiliser la requÃªte suivante dans notre application :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;SELECT * FROM users WHERE email = &#39;foo@example.com&#39;;&lt;/pre&gt;&#xA;&lt;p&gt;Sur cette table, nous n&amp;#8217;avons pas d&amp;#8217;index. Voici donc ce Ã  quoi pourrait ressembler notre plan d&amp;#8217;Ã©xecution si nous utilisons la commande :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;EXPLAIN ANALYZE SELECT * FROM users WHERE email = &#39;foo@example.com&#39;;&#xD;&#xA;&#xD;&#xA;Seq Scan on users (cost=0.00..35.50 rows=1 width=100)&#xD;&#xA;Filter: (email = &#39;foo@example.com&#39;)&#xD;&#xA;Rows Removed by Filter: 999&#xD;&#xA;Actual time=0.010..0.420 rows=1 loops=1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Les termes du plan d&amp;#8217;exÃ©cution :&lt;/h3&gt;&#xA;&lt;p&gt;A premiÃ¨re vue, il n&amp;#8217;est pas Ã©vident de comprendre tout les termes que l&amp;#8217;on voit dans le plan d&amp;#8217;exÃ©cution gÃ©nÃ©rÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Voici un rÃ©capitulatif des principaux :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Seq Scan / Index Scan :&lt;/strong&gt; Le type de parcours utilisÃ© (sÃ©quentiel ou via un index)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;cost=â€¦ :&lt;/strong&gt; Estimation du &amp;#8220;coÃ»t&amp;#8221; total de lâ€™opÃ©ration, selon PostgreSQL. Le coÃ»t n&amp;#8217;est pas exprimÃ© dans une unitÃ© particuliÃ¨re, c&amp;#8217;est juste un indicatif. Plus il est Ã©levÃ©, plus l&amp;#8217;opÃ©ration est &amp;#8220;coÃ»teuse&amp;#8221;, notre but Ã©tant d&amp;#8217;Ã©viter les coÃ»ts Ã©normes pour que tout soit plus simple.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;rows=â€¦ :&lt;/strong&gt; Estimation du nombre de lignes que l&amp;#8217;Ã©tape va retourner&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;actual time=â€¦ :&lt;/strong&gt; Le temps rÃ©el que cette Ã©tape a pris (en millisecondes)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Rows Removed by Filter :&lt;/strong&gt; Nombre de lignes lues mais Ã©liminÃ©es par un filtre&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;loops=1 :&lt;/strong&gt; Nombre de fois que cette Ã©tape a Ã©tÃ© exÃ©cutÃ©e (ex. dans une boucle)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3&gt;Puis un exemple plus compliquÃ© :&lt;/h3&gt;&#xA;&lt;p&gt;Attention, tout les plans d&amp;#8217;exÃ©cution de requÃªte ne sont pas aussi simples que celui que je viens de vous prÃ©senter. Bien souvent ils se prÃ©sentent sous la forme de plusieurs nÅ“uds indentÃ©sÂ  qu&amp;#8217;il faut lire dans le bon ordre. Imaginons une nouvelle table orders qui rÃ©pertorie les commandes passÃ©es par un user :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;CREATE TABLE orders (&#xD;&#xA;id_orders integer PRIMARY KEY,&#xD;&#xA;created_at timestamp,&#xD;&#xA;total numeric,&#xD;&#xA;status text,&#xD;&#xA;user_id integer references users(id));&lt;/pre&gt;&#xA;&lt;p&gt;Nous pouvons alors imaginer la requÃªte suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;SELECT u.name, o.total, o.created_at&#xD;&#xA;FROM users u&#xD;&#xA;JOIN orders o ON u.id = o.user_id&#xD;&#xA;WHERE o.status = &#39;completed&#39;&#xD;&#xA;ORDER BY o.created_at DESC&#xD;&#xA;LIMIT 10;&lt;/pre&gt;&#xA;&lt;p&gt;Qui remonte les dix premiÃ¨res commandes,Â  avec le nom de l&amp;#8217;acheteur, le total de la commande et sa date, pour les 10 premiÃ¨res commandes dans l&amp;#8217;ordre des dates dont le statut est &amp;#8220;completed&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Si on execute un explain analyze sur cette requÃªte, on obtient un plan d&amp;#8217;execution de cet ordre :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; Limit (cost=123.45..123.48 rows=10 width=40) (actual time=1.234..1.239 rows=10 loops=1)&#xD;&#xA;   -&amp;amp;gt; Sort (cost=123.45..130.00 rows=2620 width=40) (actual time=1.234..1.236 rows=10 loops=1)&#xD;&#xA;      Sort Key: o.created_at DESC&#xD;&#xA;      Sort Method: top-N heapsort Memory: 25kB&#xD;&#xA;       -&amp;amp;gt; Nested Loop (cost=0.42..100.00 rows=2620 width=40) (actual time=0.045..0.980 rows=200 loops=1)&#xD;&#xA;            -&amp;amp;gt; Index Scan using idx_orders_created_at on orders o (cost=0.29..45.00 rows=2620 width=24) (actual time=0.030..0.340 rows=200 loops=1)&#xD;&#xA;                 Filter: (status = &#39;completed&#39;)&#xD;&#xA;                 Rows Removed by Filter: 50&#xD;&#xA;            -&amp;amp;gt; Index Scan using users_pkey on users u (cost=0.13..0.20 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=200)&#xD;&#xA;                 Index Cond: (id = o.user_id)&lt;/pre&gt;&#xA;&lt;p&gt;Si on devait visualiser ce plan d&amp;#8217;exÃ©cution de maniÃ¨re graphique pour qu&amp;#8217;il soit plus simple Ã  lire, Ã§a donnerait Ã§a :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX.png&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone wp-image-10701&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-300x170.png&#34; alt=&#34;&#34; width=&#34;508&#34; height=&#34;288&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-300x170.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-768x434.png 768w, https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX.png 853w&#34; sizes=&#34;auto, (max-width: 508px) 100vw, 508px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3&gt;Comment lire un plan d&amp;#8217;exÃ©cution :&lt;/h3&gt;&#xA;&lt;p&gt;Pour lire un plan d&amp;#8217;exÃ©cution, on part toujours du nÅ“ud le plus indentÃ©, puis on remonte vers les nÅ“uds supÃ©rieur. Dans notre cas, on partirais des deux index scan pour remonter ensuite sur le Nested Loop, puis sur le Sort, et enfin sur le Limit.&lt;br /&gt;&#xA;La raison est simple : le plan dâ€™exÃ©cution reflÃ¨te lâ€™ordre rÃ©el dâ€™exÃ©cution de la requÃªte par PostgreSQL.&lt;br /&gt;&#xA;Chaque Ã©tape du plan consomme les rÃ©sultats produits par les Ã©tapes prÃ©cÃ©dentes. Autrement dit : PostgreSQL commence par les opÃ©rations de lecture (accÃ¨s aux tables, scans dâ€™index&amp;#8230;), puis applique les jointures, les filtres, les tris, etc. en remontant vers le haut du plan.&lt;br /&gt;&#xA;Le nÅ“ud le plus &amp;#8220;haut&amp;#8221; du plan (celui avec le moins dâ€™indentation) correspond Ã  lâ€™opÃ©ration finale, celle qui retourne les rÃ©sultats Ã  lâ€™utilisateur. Les blocs en dessous (plus indentÃ©s) sont les dÃ©pendances nÃ©cessaires pour y arriver.&lt;br /&gt;&#xA;Câ€™est donc une logique de pipeline de traitement :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;Lire les donnÃ©es&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les filtrer&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les combiner&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les trier / agrÃ©ger&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les retourner&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Lire un plan dâ€™exÃ©cution &amp;#8220;du plus profond vers le haut&amp;#8221;, câ€™est suivre le chemin de vie dâ€™une ligne de rÃ©sultat depuis le disque jusquâ€™Ã  votre terminal.&lt;/p&gt;&#xA;&lt;h3&gt;Petite encyclopÃ©die des nÅ“uds les plus courants dans un plan dâ€™exÃ©cution&lt;/h3&gt;&#xA;&lt;p&gt;Voici une sÃ©lection des nÅ“uds que vous croiserez rÃ©guliÃ¨rement dans les plans dâ€™exÃ©cution PostgreSQL, avec une explication simple et directe pour chacun :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;251&#34; data-end=&#34;420&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;253&#34; data-end=&#34;420&#34;&gt;&lt;strong data-start=&#34;253&#34; data-end=&#34;265&#34;&gt;Seq Scan&lt;/strong&gt;&lt;br data-start=&#34;265&#34; data-end=&#34;268&#34; /&gt;Lecture sÃ©quentielle de toute la table.&lt;br data-start=&#34;309&#34; data-end=&#34;312&#34; /&gt;&lt;em data-start=&#34;317&#34; data-end=&#34;331&#34;&gt;Ã€ surveiller&lt;/em&gt; : Normal sur petites tables, mais sur les grosses, cela peut indiquer un index manquant.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;422&#34; data-end=&#34;607&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;424&#34; data-end=&#34;607&#34;&gt;&lt;strong data-start=&#34;424&#34; data-end=&#34;438&#34;&gt;Index Scan&lt;/strong&gt;&lt;br data-start=&#34;438&#34; data-end=&#34;441&#34; /&gt;Parcours dâ€™un index pour chercher les lignes correspondantes.&lt;br data-start=&#34;504&#34; data-end=&#34;507&#34; /&gt;&lt;em data-start=&#34;512&#34; data-end=&#34;526&#34;&gt;Ã€ surveiller&lt;/em&gt; : Rapide si lâ€™index est bien choisi. Peut devenir lent avec beaucoup de &lt;em data-start=&#34;599&#34; data-end=&#34;606&#34;&gt;loops&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;609&#34; data-end=&#34;804&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;611&#34; data-end=&#34;804&#34;&gt;&lt;strong data-start=&#34;611&#34; data-end=&#34;630&#34;&gt;Index Only Scan&lt;/strong&gt;&lt;br data-start=&#34;630&#34; data-end=&#34;633&#34; /&gt;Comme un Index Scan, mais sans lire la table si toutes les colonnes nÃ©cessaires sont dÃ©jÃ  dans lâ€™index.&lt;br data-start=&#34;740&#34; data-end=&#34;743&#34; /&gt;&lt;em data-start=&#34;748&#34; data-end=&#34;762&#34;&gt;Ã€ surveiller&lt;/em&gt; : Ultra-performant ! Ã€ viser si possible.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;806&#34; data-end=&#34;1031&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;808&#34; data-end=&#34;1031&#34;&gt;&lt;strong data-start=&#34;808&#34; data-end=&#34;829&#34;&gt;Bitmap Index Scan&lt;/strong&gt; + &lt;strong data-start=&#34;832&#34; data-end=&#34;852&#34;&gt;Bitmap Heap Scan&lt;/strong&gt;&lt;br data-start=&#34;852&#34; data-end=&#34;855&#34; /&gt;PostgreSQL construit une &amp;#8220;carte&amp;#8221; des lignes Ã  lire, puis les rÃ©cupÃ¨re en une seule passe.&lt;br data-start=&#34;946&#34; data-end=&#34;949&#34; /&gt;&lt;em data-start=&#34;954&#34; data-end=&#34;968&#34;&gt;Ã€ surveiller&lt;/em&gt; : TrÃ¨s performant pour des filtres avec beaucoup de rÃ©sultats.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1033&#34; data-end=&#34;1244&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1035&#34; data-end=&#34;1244&#34;&gt;&lt;strong data-start=&#34;1035&#34; data-end=&#34;1050&#34;&gt;Nested Loop&lt;/strong&gt;&lt;br data-start=&#34;1050&#34; data-end=&#34;1053&#34; /&gt;Pour chaque ligne de la premiÃ¨re table, PostgreSQL cherche dans la seconde.&lt;br data-start=&#34;1130&#34; data-end=&#34;1133&#34; /&gt;&lt;em data-start=&#34;1138&#34; data-end=&#34;1152&#34;&gt;Ã€ surveiller&lt;/em&gt; : Bien sur de petits volumes, mais peut exploser sur de grandes tables (effet quadratique).&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1246&#34; data-end=&#34;1445&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1248&#34; data-end=&#34;1445&#34;&gt;&lt;strong data-start=&#34;1248&#34; data-end=&#34;1261&#34;&gt;Hash Join&lt;/strong&gt;&lt;br data-start=&#34;1261&#34; data-end=&#34;1264&#34; /&gt;PostgreSQL construit une table de hachage en mÃ©moire pour faire la jointure.&lt;br data-start=&#34;1342&#34; data-end=&#34;1345&#34; /&gt;&lt;em data-start=&#34;1350&#34; data-end=&#34;1364&#34;&gt;Ã€ surveiller&lt;/em&gt; : Performant si la mÃ©moire le permet. Attention Ã  la taille des jeux de donnÃ©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1447&#34; data-end=&#34;1621&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1449&#34; data-end=&#34;1621&#34;&gt;&lt;strong data-start=&#34;1449&#34; data-end=&#34;1463&#34;&gt;Merge Join&lt;/strong&gt;&lt;br data-start=&#34;1463&#34; data-end=&#34;1466&#34; /&gt;Jointure optimisÃ©e entre deux sources dÃ©jÃ  triÃ©es.&lt;br data-start=&#34;1518&#34; data-end=&#34;1521&#34; /&gt;&lt;em data-start=&#34;1526&#34; data-end=&#34;1540&#34;&gt;Ã€ surveiller&lt;/em&gt; : Excellent en perfs si les colonnes jointes sont indexÃ©es ou triÃ©es Ã  lâ€™avance.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1623&#34; data-end=&#34;1794&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1625&#34; data-end=&#34;1794&#34;&gt;&lt;strong data-start=&#34;1625&#34; data-end=&#34;1638&#34;&gt;Aggregate&lt;/strong&gt;&lt;br data-start=&#34;1638&#34; data-end=&#34;1641&#34; /&gt;Calcule une agrÃ©gation (COUNT, SUM, AVG, &amp;#8230;).&lt;br data-start=&#34;1696&#34; data-end=&#34;1699&#34; data-is-only-node=&#34;&#34; /&gt;&lt;em data-start=&#34;1704&#34; data-end=&#34;1718&#34;&gt;Ã€ surveiller&lt;/em&gt; : Peut Ãªtre coÃ»teux si lâ€™agrÃ©gation se fait sur de gros volumes sans index.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1796&#34; data-end=&#34;1959&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1798&#34; data-end=&#34;1959&#34;&gt;&lt;strong data-start=&#34;1798&#34; data-end=&#34;1806&#34;&gt;Sort&lt;/strong&gt;&lt;br data-start=&#34;1806&#34; data-end=&#34;1809&#34; /&gt;Trie les donnÃ©es selon une ou plusieurs colonnes.&lt;br data-start=&#34;1860&#34; data-end=&#34;1863&#34; /&gt;&lt;em data-start=&#34;1868&#34; data-end=&#34;1882&#34;&gt;Ã€ surveiller&lt;/em&gt; : Peut consommer beaucoup de mÃ©moire ; un bon index peut Ã©viter cette Ã©tape.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1961&#34; data-end=&#34;2136&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1963&#34; data-end=&#34;2136&#34;&gt;&lt;strong data-start=&#34;1963&#34; data-end=&#34;1972&#34;&gt;Limit&lt;/strong&gt;&lt;br data-start=&#34;1972&#34; data-end=&#34;1975&#34; /&gt;Tronque le rÃ©sultat Ã  N lignes.&lt;br data-start=&#34;2010&#34; data-end=&#34;2013&#34; /&gt;&lt;em data-start=&#34;2018&#34; data-end=&#34;2032&#34;&gt;Ã€ surveiller&lt;/em&gt; : TrÃ¨s utile combinÃ© avec ORDER BY, car PostgreSQL peut sâ€™arrÃªter dÃ¨s quâ€™il a assez de lignes triÃ©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2138&#34; data-end=&#34;2327&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2140&#34; data-end=&#34;2327&#34;&gt;&lt;strong data-start=&#34;2140&#34; data-end=&#34;2152&#34;&gt;CTE Scan&lt;/strong&gt;&lt;br data-start=&#34;2152&#34; data-end=&#34;2155&#34; /&gt;UtilisÃ© quand vous avez une clause WITHÂ (CTE â€“ Common Table Expression).&lt;br data-start=&#34;2231&#34; data-end=&#34;2234&#34; /&gt;&lt;em data-start=&#34;2239&#34; data-end=&#34;2253&#34;&gt;Ã€ surveiller&lt;/em&gt; : Si le CTE nâ€™est pas matÃ©rialisÃ©, il peut Ãªtre recalculÃ© Ã  chaque appel.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Options utiles de EXPLAIN / EXPLAIN ANALYZE&lt;/h2&gt;&#xA;&lt;p&gt;La commande EXPLAIN (et sa variante EXPLAIN ANALYZE) peut Ãªtre enrichie avec plusieurs options facultatives pour mieux comprendre ce que PostgreSQL fait avec vos requÃªtes. Voici une prÃ©sentation des principales.&lt;/p&gt;&#xA;&lt;h4&gt;ANALYZE : exÃ©cuter la requÃªte pour de vrai&lt;/h4&gt;&#xA;&lt;p&gt;Cette option (souvent appelÃ©e â€œEXPLAIN ANALYZEâ€) &lt;strong&gt;exÃ©cute rÃ©ellement la requÃªte&lt;/strong&gt; et mesure les temps d&amp;#8217;exÃ©cution.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN ANALYZE SELECT * FROM users WHERE email = &#39;foo@example.com&#39;; &lt;/pre&gt;&#xA;&lt;p&gt;Sans cette option, PostgreSQL ne fait quâ€™estimer le plan, il ne lâ€™exÃ©cute pas rÃ©ellement.&lt;/p&gt;&#xA;&lt;h4&gt;VERBOSE: plus de dÃ©tails sur les colonnes et les expressions&lt;/h4&gt;&#xA;&lt;p&gt;Affiche le nom exact des colonnes internes et les expressions utilisÃ©es dans chaque Ã©tape du plan.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, VERBOSE) SELECT name FROM users WHERE age &amp;amp;gt; 30; &lt;/pre&gt;&#xA;&lt;p&gt;TrÃ¨s utile quand on travaille avec des fonctions, des agrÃ©gats ou des vues complexes.&lt;/p&gt;&#xA;&lt;h4&gt;BUFFERS : dÃ©tail des lectures mÃ©moire et disque&lt;/h4&gt;&#xA;&lt;p&gt;Montre combien de blocs de donnÃ©es ont Ã©tÃ© lus en mÃ©moire (cache partagÃ©) et depuis le disque.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM orders WHERE status = &#39;completed&#39;; &lt;/pre&gt;&#xA;&lt;p&gt;IdÃ©al pour identifier si une requÃªte est ralentie par des accÃ¨s disques trop nombreux.&lt;/p&gt;&#xA;&lt;h4&gt;WAL : suivi des Ã©critures dans le journal de transactions&lt;/h4&gt;&#xA;&lt;p&gt;Affiche lâ€™impact de la requÃªte sur le WAL (Write-Ahead Logging), câ€™est-Ã -dire les Ã©critures nÃ©cessaires Ã  la durabilitÃ©.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, WAL) INSERT INTO logs SELECT * FROM events; &lt;/pre&gt;&#xA;&lt;p&gt;Surtout utile pour comprendre le coÃ»t cachÃ© des requÃªtes dâ€™Ã©criture.&lt;/p&gt;&#xA;&lt;h4&gt;COSTS : afficher ou masquer les coÃ»ts estimÃ©s&lt;/h4&gt;&#xA;&lt;p&gt;Permet de dÃ©sactiver les lignes cost=&amp;#8230; si on veut se concentrer uniquement sur les temps rÃ©els (actual time).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, COSTS OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Pratique pour allÃ©ger la lecture dâ€™un plan quand on nâ€™a pas besoin des estimations.&lt;/p&gt;&#xA;&lt;h4&gt;SETTINGS : voir les paramÃ¨tres ayant influencÃ© le plan&lt;/h4&gt;&#xA;&lt;p&gt;Affiche les paramÃ¨tres de configuration de PostgreSQL qui ont eu un impact sur la gÃ©nÃ©ration du plan.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, SETTINGS) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;TrÃ¨s utile pour le debug avancÃ©, ou si certains paramÃ¨tres sont modifiÃ©s via SET.&lt;/p&gt;&#xA;&lt;h4&gt;SUMMARY : afficher ou non les temps globaux&lt;/h4&gt;&#xA;&lt;p&gt;ContrÃ´le lâ€™affichage du rÃ©sumÃ© final (Planning Time, Execution Time).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, SUMMARY OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Par dÃ©faut activÃ©, mais vous pouvez le dÃ©sactiver si vous ne souhaitez pas ces infos Ã  la fin du plan.&lt;/p&gt;&#xA;&lt;h4&gt;TIMING : activer ou dÃ©sactiver la mesure des temps internes&lt;/h4&gt;&#xA;&lt;p&gt;PostgreSQL mesure le actual time pour chaque nÅ“ud du plan. Cette option permet de dÃ©sactiver ces mesures (utile pour les trÃ¨s petites requÃªtes ou les benchmarks massifs).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, TIMING OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;DÃ©sactive les mesures fines, ce qui peut lÃ©gÃ¨rement amÃ©liorer les performances du plan dâ€™analyse lui-mÃªme.&lt;/p&gt;&#xA;&lt;h4&gt;FORMAT : changer la sortie (TEXT, JSON, YAML)&lt;/h4&gt;&#xA;&lt;p&gt;Permet dâ€™obtenir un plan dans un format structurÃ© (parfait pour les outils externes comme explain.dalibo.com).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, FORMAT JSON) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Pratique pour gÃ©nÃ©rer un plan visuel, lâ€™analyser en script, ou lâ€™intÃ©grer dans des outils de perf.&lt;/p&gt;&#xA;&lt;h2&gt;OK super, mais une fois qu&amp;#8217;on sait Ã§a, on en fait quoi ?&lt;/h2&gt;&#xA;&lt;p data-start=&#34;260&#34; data-end=&#34;525&#34;&gt;On pourrait passer des heures Ã  dÃ©cortiquer les diffÃ©rentes lignes d&amp;#8217;un plan d&amp;#8217;exÃ©cution sans pour autant avancer plus que Ã§a. L&amp;#8217;important est maintenant de savoir quoi en faire. Parce que c&amp;#8217;est bien beau de l&amp;#8217;afficher, encore faut-il savoir quoi y chercher.&lt;/p&gt;&#xA;&lt;p data-start=&#34;260&#34; data-end=&#34;525&#34;&gt;Voici une petite liste non exhaustive des indices Ã  repÃ©rer dans un plan d&amp;#8217;exÃ©cution qui pourraient vous mener Ã  une raison pour la lenteur de votre requÃªte :&lt;/p&gt;&#xA;&lt;h3&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Une lecture sÃ©quentielle sur une grosse table :&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;659&#34; data-end=&#34;678&#34;&gt;&lt;strong data-start=&#34;659&#34; data-end=&#34;674&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Seq Scan on users  (rows=100000)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;725&#34; data-end=&#34;755&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;755&#34; data-end=&#34;758&#34; /&gt;PostgreSQL lit toute la table ligne par ligne. Câ€™est trÃ¨s lent et parfaitement inutile, surtout si vous ne voulez que quelques lignes de cette table.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;861&#34; data-end=&#34;887&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;890&#34; data-end=&#34;992&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;890&#34; data-end=&#34;914&#34;&gt;On note la prÃ©sence d&amp;#8217;un nÅ“ud SEQ SCAN dans notre plan d&amp;#8217;exÃ©cution&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;915&#34; data-end=&#34;992&#34;&gt;Nombre de lignes parcourues trÃ¨s Ã©levÃ© (puce rows ou prÃ©sence de row removed by filter)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;994&#34; data-end=&#34;1010&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1011&#34; data-end=&#34;1184&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1011&#34; data-end=&#34;1085&#34;&gt;Ajouter un index sur la colonne filtrÃ©e peut souvent aider dans ce genre de cas.&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1086&#34; data-end=&#34;1184&#34;&gt;RÃ©Ã©crire la requÃªte pour quâ€™elle utilise une clause mieux optimisÃ©e (exclusion, inclusion&amp;#8230;)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Trop de Loop&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1242&#34; data-end=&#34;1261&#34;&gt;&lt;strong data-start=&#34;1242&#34; data-end=&#34;1257&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Index Scan using users_pkey on users  (loops=10000)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1327&#34; data-end=&#34;1489&#34;&gt;&lt;strong data-start=&#34;1327&#34; data-end=&#34;1357&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;1357&#34; data-end=&#34;1360&#34; /&gt;Une opÃ©ration lente est rÃ©pÃ©tÃ©e pour chaque ligne de lâ€™opÃ©ration extÃ©rieure, souvent dans une jointure en boucle (Nested Loop).&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1491&#34; data-end=&#34;1519&#34;&gt;&lt;strong data-start=&#34;1491&#34; data-end=&#34;1517&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1520&#34; data-end=&#34;1575&#34;&gt;&#xA;&lt;li data-start=&#34;1520&#34; data-end=&#34;1535&#34;&gt;Nombre de loop trÃ¨s Ã©levÃ©s&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1520&#34; data-end=&#34;1535&#34;&gt;Souvent prÃ©cÃ©dÃ© d&amp;#8217;un Nested Loop plus haut dans le plan d&amp;#8217;exÃ©cution&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1577&#34; data-end=&#34;1593&#34;&gt;&lt;strong data-start=&#34;1577&#34; data-end=&#34;1593&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1594&#34; data-end=&#34;1764&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1594&#34; data-end=&#34;1657&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1596&#34; data-end=&#34;1657&#34;&gt;Changer le type de jointure pour quelque chose de plus simple a traiter (hash join ou merge join)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1658&#34; data-end=&#34;1715&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1660&#34; data-end=&#34;1715&#34;&gt;RÃ©Ã©crire la requÃªte pour faire moins de &amp;#8220;aller-retours&amp;#8221;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1716&#34; data-end=&#34;1764&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1718&#34; data-end=&#34;1764&#34;&gt;Ajouter des index pour faciliter les jointures&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;1718&#34; data-end=&#34;1764&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Des estimations loin de la rÃ©alitÃ©&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1826&#34; data-end=&#34;1845&#34;&gt;&lt;strong data-start=&#34;1826&#34; data-end=&#34;1841&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;rows=10   actual rows=10000&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1887&#34; data-end=&#34;2017&#34;&gt;&lt;strong data-start=&#34;1887&#34; data-end=&#34;1917&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;1917&#34; data-end=&#34;1920&#34; /&gt;PostgreSQL sâ€™est trompÃ© dans son estimation, ce qui lâ€™a peut-Ãªtre menÃ© Ã  choisir un mauvais plan.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2019&#34; data-end=&#34;2179&#34;&gt;&lt;strong data-start=&#34;2019&#34; data-end=&#34;2045&#34;&gt;Comment le voir&lt;/strong&gt;&lt;br data-start=&#34;2045&#34; data-end=&#34;2048&#34; /&gt;Comparez le nombre de rows (estimation) avec les actual rows. Si lâ€™Ã©cart est trÃ¨s important, les statistiques sont probablement obsolÃ¨tes.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2181&#34; data-end=&#34;2197&#34;&gt;&lt;strong data-start=&#34;2181&#34; data-end=&#34;2197&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2198&#34; data-end=&#34;2421&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2198&#34; data-end=&#34;2259&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2200&#34; data-end=&#34;2259&#34;&gt;Rafraichir les statistiques dans ce cas ne peut pas faire de mal : Analyze ou vaccuum analyze si nÃ©cessaire.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2260&#34; data-end=&#34;2352&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2262&#34; data-end=&#34;2352&#34;&gt;Ajuster les statistiques&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2353&#34; data-end=&#34;2421&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2355&#34; data-end=&#34;2421&#34;&gt;Ã‰viter les expressions trop complexes qui biaisent les estimations&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;2355&#34; data-end=&#34;2421&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Un tri qui consomme trop&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2494&#34; data-end=&#34;2513&#34;&gt;&lt;strong data-start=&#34;2494&#34; data-end=&#34;2509&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Sort  (Sort Method: quicksort / external merge, Memory: 100MB)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2590&#34; data-end=&#34;2723&#34;&gt;&lt;strong data-start=&#34;2590&#34; data-end=&#34;2620&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;2620&#34; data-end=&#34;2623&#34; /&gt;Le tri est trop gros, PostgreSQL nâ€™arrive plus Ã  le faire en RAM â†’ il passe sur disque â†’ câ€™est lent.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2725&#34; data-end=&#34;2753&#34;&gt;&lt;strong data-start=&#34;2725&#34; data-end=&#34;2751&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2754&#34; data-end=&#34;2879&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2754&#34; data-end=&#34;2813&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2756&#34; data-end=&#34;2813&#34;&gt;NÅ“ud SORT avec un SORT METHOD lent (EXTERNAL MERGE)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2814&#34; data-end=&#34;2843&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2816&#34; data-end=&#34;2843&#34;&gt;Consommation mÃ©moire Ã©levÃ©e&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2844&#34; data-end=&#34;2879&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2846&#34; data-end=&#34;2879&#34;&gt;Ã‰tape qui prend beaucoup de temps&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2881&#34; data-end=&#34;2897&#34;&gt;&lt;strong data-start=&#34;2881&#34; data-end=&#34;2897&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2898&#34; data-end=&#34;3077&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2898&#34; data-end=&#34;2962&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2900&#34; data-end=&#34;2962&#34;&gt;Ajouter un index sur les colonnes utilisÃ©es dans le ORDER BY&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2963&#34; data-end=&#34;3027&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2965&#34; data-end=&#34;3027&#34;&gt;RÃ©duire la quantitÃ© de lignes Ã  trier avec un LIMITÂ en amont&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3028&#34; data-end=&#34;3077&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3030&#34; data-end=&#34;3077&#34;&gt;Ã‰viter les sous-requÃªtes non filtrÃ©es avant tri&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;3030&#34; data-end=&#34;3077&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Une clause Limit inefficace&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3164&#34; data-end=&#34;3183&#34;&gt;&lt;strong data-start=&#34;3164&#34; data-end=&#34;3179&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Sort â†’ Limit&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3210&#34; data-end=&#34;3355&#34;&gt;&lt;strong data-start=&#34;3210&#34; data-end=&#34;3240&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;3240&#34; data-end=&#34;3243&#34; /&gt;PostgreSQL trie &lt;em data-start=&#34;3259&#34; data-end=&#34;3266&#34;&gt;toute&lt;/em&gt; la table avant dâ€™en extraire 10 lignes. Sâ€™il y a 1 million de lignes, câ€™est pas optimal.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3357&#34; data-end=&#34;3385&#34;&gt;&lt;strong data-start=&#34;3357&#34; data-end=&#34;3383&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3386&#34; data-end=&#34;3479&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3386&#34; data-end=&#34;3422&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3388&#34; data-end=&#34;3422&#34;&gt;Le SORT est au-dessus du LIMIT&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3423&#34; data-end=&#34;3479&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3425&#34; data-end=&#34;3479&#34;&gt;Le tri prend beaucoup de temps mÃªme pour un LIMIT 10&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3481&#34; data-end=&#34;3497&#34;&gt;&lt;strong data-start=&#34;3481&#34; data-end=&#34;3497&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3498&#34; data-end=&#34;3678&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3498&#34; data-end=&#34;3588&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3500&#34; data-end=&#34;3588&#34;&gt;Utiliser un index qui permet de lire dÃ©jÃ  triÃ© (ORDER BY created_at DESCÂ â†’ index DESC)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3589&#34; data-end=&#34;3678&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3591&#34; data-end=&#34;3678&#34;&gt;Repenser la requÃªte pour Ã©viter le tri global (ex : prÃ©filtrage ou pagination efficace)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;3591&#34; data-end=&#34;3678&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Des filtres appliquÃ©s trop tard&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3744&#34; data-end=&#34;3763&#34;&gt;&lt;strong data-start=&#34;3744&#34; data-end=&#34;3759&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Rows Removed by Filter: 999000&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3808&#34; data-end=&#34;3948&#34;&gt;&lt;strong data-start=&#34;3808&#34; data-end=&#34;3838&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;3838&#34; data-end=&#34;3841&#34; /&gt;Le filtre est appliquÃ© aprÃ¨s avoir lu la majoritÃ© des lignes â†’ PostgreSQL fait beaucoup de travail inutile.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3950&#34; data-end=&#34;3978&#34;&gt;&lt;strong data-start=&#34;3950&#34; data-end=&#34;3976&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3979&#34; data-end=&#34;4071&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3979&#34; data-end=&#34;4023&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3981&#34; data-end=&#34;4023&#34;&gt;PrÃ©sence de FILTER (&amp;#8230;) en bas de plan&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4024&#34; data-end=&#34;4071&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4026&#34; data-end=&#34;4071&#34;&gt;TrÃ¨s grand nombre de ROWS REMOVED BY FILTER&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4073&#34; data-end=&#34;4089&#34;&gt;&lt;strong data-start=&#34;4073&#34; data-end=&#34;4089&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;4090&#34; data-end=&#34;4311&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4090&#34; data-end=&#34;4120&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4092&#34; data-end=&#34;4120&#34;&gt;Indexer la colonne du filtre&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4121&#34; data-end=&#34;4203&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4123&#34; data-end=&#34;4203&#34;&gt;RÃ©Ã©crire la requÃªte pour que le filtre soit pris en compte plus tÃ´t dans le plan&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4204&#34; data-end=&#34;4311&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4206&#34; data-end=&#34;4311&#34;&gt;Ã‰viter les fonctions non indexables dans le WHERE (ex : LOWER(email)Â â†’ prÃ©fÃ©rer un index fonctionnel)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h1&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;313&#34; data-end=&#34;605&#34;&gt;Comme souvent avec PostgreSQL, il est difficile â€” voire impossible â€” de tout couvrir en un seul article. Chaque plan d&amp;#8217;exÃ©cution est unique, chaque requÃªte a ses subtilitÃ©s, et chaque base de donnÃ©es a ses petites surprises. Il nâ€™existe pas de recette miracle qui marcherait Ã  tous les coups.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;607&#34; data-end=&#34;813&#34;&gt;Mais avec les bons rÃ©flexes, quelques outils et un peu de mÃ©thode, on peut rapidement progresser : repÃ©rer les symptÃ´mes, lire les signes, poser les bonnes questionsâ€¦ et surtout, tester, encore et toujours.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;607&#34; data-end=&#34;813&#34;&gt;EXPLAIN ANALYZE nâ€™est pas rÃ©servÃ© aux DBA ou aux experts en perfs. Câ€™est un compagnon de route pour toute personne qui Ã©crit des requÃªtes, et qui veut comprendre ce qui se passe sous le capot.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1011&#34; data-end=&#34;1213&#34;&gt;Et si vous vous sentez encore un peu perduÂ·e face Ã  un plan trop verbeux : pas de panique. Avec lâ€™habitude, Ã§a devient un langage quâ€™on apprend Ã  lire presque instinctivement. Et Ã§a commence maintenant.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 dÃ©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien Ã©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-pg_stat_statements-avec-postgresql-15/&#34; rel=&#34;bookmark&#34; title=&#34;16 mars 2023&#34;&gt;NouveautÃ©s pg_stat_statements avec PostgreSQL 15&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; rel=&#34;bookmark&#34; title=&#34;26 fÃ©vrier 2025&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/query-store-bloquer-les-regressions-de-plans-dexecution-et-capture-mode/&#34; rel=&#34;bookmark&#34; title=&#34;6 avril 2022&#34;&gt;Query Store : bloquer les rÃ©gressions de plans d&amp;#8217;exÃ©cution et Capture Mode&lt;/a&gt; (Capdata team) [SQL Server]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 4.011 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;title=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34;&gt;PostgreSQL Basics : lire un plan d&amp;#8217;exÃ©cution comme unÂ·e pro (ou presque)&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Introduction : Quand une requÃªte PostgreSQL est considÃ©rÃ©e comme lente ou que ses performances se dÃ©gradent soudainement, il y a un rÃ©flexe Ã  toujours avoir : utiliser les plans d&amp;#8217;exÃ©cution. Je nâ€™apprends certainement rien Ã  la majoritÃ© des personnes qui&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34;&gt;PostgreSQL Basics : lire un plan d&amp;#8217;exÃ©cution comme unÂ·e pro (ou presque)&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !</title>
    <updated>2025-02-26T11:00:21Z</updated>
    <id>tag:blog.capdata.fr,2025-02-26:/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10677&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;200&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-768x513.png 768w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum.png 800w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Hello&lt;/p&gt;&#xA;&lt;p&gt;pour commencer cette annÃ©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous prÃ©sente comment optimiser les opÃ©rations de maintenance que sont les VACUUM et les ANALYZE.&lt;/p&gt;&#xA;&lt;p&gt;Ces 2 opÃ©rations sont essentielles pour conserver des performances optimales pour notre instance et garantir au planner de construire des plans d&amp;#8217;exÃ©cutions optimisÃ©s.&lt;/p&gt;&#xA;&lt;p&gt;les opÃ©rations VACUUM et/ou ANALYZE peuvent Ãªtre longues et sources de nombreuses Ã©critures dans les WALs sur des tables volumineuses.&lt;br /&gt;&#xA;C&amp;#8217;est pourquoi, et ce depuis la version &lt;strong&gt;PostgreSQL 16&lt;/strong&gt;, il est possible de modifier le comportement de ces opÃ©rations en affectant une taille de buffer. Il s&amp;#8217;agit du &amp;#8220;&lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-VACUUM-BUFFER-USAGE-LIMIT&#34;&gt;buffer_usage_limit&lt;/a&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Principe de fonctionnement.&lt;/h2&gt;&#xA;&lt;p&gt;Ce procÃ©dÃ© s&amp;#8217;appuie sur le principe de &amp;#8220;ring buffer&amp;#8221; configurÃ© pour PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Attention, Ã  ne pas confondre, Ã©videment, avec les &amp;#8220;rings buffer&amp;#8221; de SQL Server !!&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, PostgreSQL utilise cette stratÃ©gie de &amp;#8220;ring buffer&amp;#8221; afin de dÃ©dier un espace mÃ©moire pour les opÃ©rations lourdes , telles, la lecture sÃ©quentielle sur une table volumineuse, un CREATE TABLE AS SELECT, un COPY&amp;#8230;. mais aussi un VACUUM !&lt;/p&gt;&#xA;&lt;p&gt;En fait, cet espace est utilisÃ© pour Ã©viter de &amp;#8220;flusher&amp;#8221; sur disque de maniÃ¨re trop brutale les pages en mÃ©moire montÃ©es dans le &amp;#8220;&lt;strong&gt;shared buffer&lt;/strong&gt;&amp;#8220;. Cela pÃ©naliserait en grande partie toute opÃ©ration concurrente Ã  notre traitement actif puisqu&amp;#8217;elle n&amp;#8217;aurait plus d&amp;#8217;espace pour mettre ses propres pages en mÃ©moire.&lt;/p&gt;&#xA;&lt;p&gt;Jusqu&amp;#8217;Ã  la version PostgreSQL 16, cet espace mÃ©moire Ã©tait dÃ©fini Ã &lt;strong&gt;Â 256Ko&lt;/strong&gt;. Ainsi, au cours d&amp;#8217;une lecture sÃ©quentielle, chaque pageÂ  de &lt;strong&gt;8Ko&lt;/strong&gt; par dÃ©faut, est montÃ©e en mÃ©moire dans cet espace si le nombre de pages totales Ã  traiter pour la table, dÃ©passe 1/4 du paramÃ¨tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Il en est de mÃªme pour une opÃ©ration VACUUM ou ANALYZE qui utilise Ã©galement ce ring buffer et permet d&amp;#8217;optimiser cette opÃ©ration.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;NouveautÃ©s PostgreSQL 16 et PostgreSQL 17&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la version PostgreSQL 16, il est possible de configurer la taille du buffer de faÃ§on unitaire. Par exemple, lors d&amp;#8217;un VACUUM, il est tout Ã  fait possible de choisir une valeur pour &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Depuis le version PostgreSQL 17, la valeur par dÃ©faut affectÃ©e Ã  &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; est de &lt;strong&gt;2Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il vous est possible de paramÃ©trer la valeur de &lt;strong&gt;128Ko&lt;/strong&gt; jusqu&amp;#8217;Ã  &lt;strong&gt;16Go&lt;/strong&gt;. Attention, cependant, cette valeur ne peux excÃ©der &lt;strong&gt;1/8&lt;/strong&gt; du paramÃ¨tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Si vous faites le calcul, pour un serveur comportant &lt;strong&gt;32Go de RAM&lt;/strong&gt;, vous ne pourrez obtenir, au plus, &lt;strong&gt;1Go&lt;/strong&gt; pour votre ring buffer.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un VACUUM&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur une instance PostgreSQL 13, nous lanÃ§ons un VACUUM simple sur une table de 2,5Go. Nous utilisons une base exemple crÃ©Ã©e via &amp;#8220;pgbench&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Nous avons utilisÃ© les options &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221; pour analyser, dans un premier temps, tous les blocs de notre table et ne pas sur baser sur les informations de la visibility_map.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:797&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 20000000 nonremovable row versions in 327869 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196215&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 1.34 s, system: 0.67 s, elapsed: 18.90 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18920.292 ms (00:18.920)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le temps passÃ© pour cette opÃ©ration est d&amp;#8217;un peu plus de 18 secondes en temps CPU pour analyser les 327869 blocs de notre table. Soit une taille de 2.5Go.&lt;/p&gt;&#xA;&lt;p&gt;Nous effectuons la mÃªme opÃ©ration sur cette mÃªme table, mais sur un moteur &lt;strong&gt;PostgreSQL 17&lt;/strong&gt;. Nous positionnons le paramÃ¨tre &lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;Â  Ã  &lt;strong&gt;8Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:475&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 327869 scanned (100.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;new relfrozenxid: 208163, which is 5 XIDs ahead of previous value&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 134.208 MB/s, avg write rate: 0.034 MB/s&#xD;&#xA;buffer usage: 330350 hits, 325508 misses, 83 dirtied&#xD;&#xA;WAL usage: 84 records, 83 full page images, 684232 bytes&#xD;&#xA;system usage: CPU: user: 1.41 s, system: 0.64 s, elapsed: 18.94 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18955.006 ms (00:18.955)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;estÂ  Ã  peu de chose prÃ¨s, dans le mÃªme temps d&amp;#8217;exÃ©cution. soir 18 secondes.&lt;/p&gt;&#xA;&lt;p&gt;La suite consiste Ã  redÃ©marrer l&amp;#8217;instance PostgreSQL 17 et constater les temps d&amp;#8217;exÃ©cution pour chaque occurrence de lancement.&lt;br /&gt;&#xA;Nous exÃ©cutons donc, les mÃªmes ordres VACUUM, mais sans l&amp;#8217;option &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 13, nous voyons qu&amp;#8217;Ã  la premiÃ¨re exÃ©cution, juste aprÃ¨s redÃ©marrage, nous sommes Ã  32 millisecondes. Et Ã  chaque exÃ©cution suivante, nous ne descendons pas en dessous de 15 millisecondes&amp;#8230;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 32.149 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.001 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.295 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;En version PostgreSQL 17, nous faisons Ã©galement un &amp;#8220;flush&amp;#8221; des pages dans le buffer cache Ã  chaque exÃ©cution, tout en modifiant la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18.098 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 6.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;16MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 4.333 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le constat est simple, plus nous augmentons le &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, et plus le temps d&amp;#8217;exÃ©cution du VACUUM diminue.&lt;/p&gt;&#xA;&lt;p&gt;Nous comprendrons donc que sur une table de plus de 100Go, le gain peut Ãªtre assez important.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un ANALYZE&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour l&amp;#8217;instance PostgreSQL 13, nous exÃ©cutons le calcul de statistiques sur cette mÃªme table&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (analyze,verbose) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:802&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 52 nonremovable row versions in 1 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196278&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:336&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1190&#xD;&#xA;VACUUM&#xD;&#xA;Time: 29526.404 ms (00:29.526)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous sommes autour de 29 secondes pour analyser 30000 pages sur les 32769 que composent cette table.&lt;br /&gt;&#xA;Le sample est choisi en fonction de la valeur de &amp;#8220;&lt;strong&gt;default_statistics_target&lt;/strong&gt;&amp;#8220;, par dÃ©faut Ã  100, avec 30000 lignes analysÃ©es par dÃ©faut.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 17, les rÃ©sultats sont les suivants&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,verbose,BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:480&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 1 scanned (0.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 46.211 MB/s, avg write rate: 0.000 MB/s&#xD;&#xA;buffer usage: 37 hits, 100 misses, 0 dirtied&#xD;&#xA;WAL usage: 0 records, 0 full page images, 0 bytes&#xD;&#xA;system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.01 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:321&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1301&#xD;&#xA;VACUUM&#xD;&#xA;Time: 8151.201 ms (00:08.151)&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 7282.546 ms (00:07.283)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Les diffÃ©rences de gains sont moins impressionnantes que sur un simple VACUUM Ã  chaque changement de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, mais on voit qu&amp;#8217;en version PostgreSQL 17, nous sommes tout de mÃªme 4 fois plus rapide qu&amp;#8217;en version PostgreSQL 13.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;Remarques&lt;/h4&gt;&#xA;&lt;p&gt;Gardez Ã  l&amp;#8217;esprit que la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&amp;#8221;&lt;/strong&gt; est plafonnÃ©e Ã  &lt;strong&gt;1/8 &lt;/strong&gt;de&lt;strong&gt; &amp;#8220;shared_buffer&amp;#8221;&lt;/strong&gt;. Inutile donc de mettre Ã  1024Mo, si vous ne possÃ©dez que 8Go de RAM.&lt;/p&gt;&#xA;&lt;p&gt;Attention si vous mettez une valeur trop grande, les transactions concurrentes effectuant des lectures sÃ©quentielles seront pÃ©nalisÃ©es par les opÃ©rations VACUUM. D&amp;#8217;ailleurs, il est possible de mettre &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; Ã  0, mais ceci n&amp;#8217;est pas conseillÃ© lors d&amp;#8217;une activitÃ© transactionnelle en cours.&lt;/p&gt;&#xA;&lt;p&gt;Pour aller plus loin dans l&amp;#8217;optimisation d&amp;#8217;une opÃ©ration de vacuum, vous pouvez Ã©galement passer le paramÃ¨tre &amp;#8220;&lt;strong&gt;INDEX_CLEANUP&lt;/strong&gt;&amp;#8221; Ã  &lt;strong&gt;off&lt;/strong&gt;. Ceci aura pour effet de ne pas s&amp;#8217;occuper de traiter les entrÃ©es des index qui pointent sur les lignes mortes de la table.&lt;br /&gt;&#xA;Un &amp;#8220;&lt;strong&gt;REINDEX&lt;/strong&gt;&amp;#8221; sera alors nÃ©cessaire Ã  la fin du VACUUM sur les index de la table.&lt;/p&gt;&#xA;&lt;p&gt;De plus, il est possible de positionner l&amp;#8217;option &amp;#8220;&lt;strong&gt;SKIP_DATABASE_STATS&lt;/strong&gt;&amp;#8221; afin d&amp;#8217;indiquer Ã  l&amp;#8217;ordre VACUUM de ne pas rechercher l&amp;#8217;ID de transaction le plus ancien pour l&amp;#8217;ensemble des tables de la base et de geler celui-ci (datfrozenid).&lt;/p&gt;&#xA;&lt;p&gt;Les opÃ©rations VACUUM sur les grosses tables seront bien entendu optimisÃ©es mais attention aux plages de maintenance choisies !!&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonne journÃ©e Ã  vous.&lt;/p&gt;&#xA;&lt;p&gt;Emmanuel Rami&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 dÃ©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien Ã©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/requetes-consommatrices-sous-postgresql-episode-1/&#34; rel=&#34;bookmark&#34; title=&#34;24 mai 2016&#34;&gt;RequÃªtes consommatrices sous PostgreSQL (Ã©pisode 1)&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-mysql-8-0-les-histogrammes/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;NouveautÃ©s MySQL 8.0 : Les Histogrammes&lt;/a&gt; (Capdata team) [MySQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/replication-logique-avec-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;23 janvier 2020&#34;&gt;RÃ©plication logique avec PostgreSQL&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.222 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Hello pour commencer cette annÃ©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous prÃ©sente comment optimiser les opÃ©rations de maintenance que sont les VACUUM et les ANALYZE. Ces 2 opÃ©rations sont essentielles pour conserver des performances optimales pour&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>La montÃ©e de version en zero-downtime : merci la rÃ©plication !</title>
    <updated>2024-12-19T10:28:41Z</updated>
    <id>tag:blog.capdata.fr,2024-12-19:/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h1&gt;Introduction :&lt;/h1&gt;&#xA;&lt;p&gt;Dans le monde des bases de donnÃ©es, garantir une disponibilitÃ© continue est une exigence incontournable, surtout pour les systÃ¨mes critiques oÃ¹ chaque minute d&amp;#8217;arrÃªt peut entraÃ®ner des pertes significatives. Lorsquâ€™il sâ€™agit de migrer une base de donnÃ©es vers une nouvelle version, ce dÃ©fi prend une toute autre dimension. Comment mettre Ã  jour votre systÃ¨me sans interrompre les services, tout en prÃ©servant lâ€™intÃ©gritÃ© des donnÃ©es ?&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL offre une solution Ã©lÃ©gante : la rÃ©plication logique. Cet outil permet de transfÃ©rer des donnÃ©es de maniÃ¨re fluide entre diffÃ©rentes versions de PostgreSQL, tout en maintenant la base de donnÃ©es source opÃ©rationnelle. Dans cet article, nous allons explorer Ã©tape par Ã©tape comment utiliser cette fonctionnalitÃ© pour rÃ©aliser une montÃ©e de version sans temps d&amp;#8217;arrÃªt, du dÃ©ploiement initial Ã  la bascule finale vers la nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Que vous soyez en train de planifier une migration ou simplement curieux de dÃ©couvrir les possibilitÃ©s offertes par PostgreSQL, suivez ce guide pratique qui vous permettra de transformer un dÃ©fi complexe en une opÃ©ration maÃ®trisÃ©e et efficace.&lt;/p&gt;&#xA;&lt;h1&gt;Le test :&lt;/h1&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h3&gt;PrÃ©paration&lt;/h3&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pour tester cette nouvelle mÃ©thode, nous aurons besoin de deux instances PostgreSQL. Pour cet article j&amp;#8217;ai choisit de dÃ©montrer la technique en migrant d&amp;#8217;une version 14 Ã  une version 17 de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Je commence donc par installer les versions sur deux machines diffÃ©rentes pouvant communiquer entre elles (c&amp;#8217;est important) :&lt;/p&gt;&#xA;&lt;p&gt;Sur les deux machines nous pouvons exÃ©cuter les commandes suivantes :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt update sudo apt upgrade -y&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y install gnupg2 wget vim&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo sh -c &#39;echo &amp;quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&amp;quot; &amp;amp;gt; /etc/apt/sources.list.d/pgdg.list&#39;&#xD;&#xA;root@ip-192-1-1-246:~# curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc|sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y update&#xD;&#xA;Get:1 file:/etc/apt/mirrors/debian.list Mirrorlist [38 B]&#xD;&#xA;Get:2 file:/etc/apt/mirrors/debian-security.list Mirrorlist [47 B]&#xD;&#xA;Hit:3 https://cdn-aws.deb.debian.org/debian bookworm InRelease&#xD;&#xA;Hit:4 https://cdn-aws.deb.debian.org/debian bookworm-updates InRelease&#xD;&#xA;Hit:5 https://cdn-aws.deb.debian.org/debian bookworm-backports InRelease&#xD;&#xA;Hit:6 https://cdn-aws.deb.debian.org/debian-security bookworm-security InRelease&#xD;&#xA;Get:7 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg InRelease [129 kB]&#xD;&#xA;Get:8 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg/main amd64 Packages [359 kB]&#xD;&#xA;Fetched 489 kB in 1s (348 kB/s)&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;All packages are up to date.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur notre premiÃ¨re machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt install postgresql-14&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-14 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl status postgresql@14-main.service&#xD;&#xA;â— postgresql@14-main.service - PostgreSQL Cluster 14-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime;&amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:43:55 UTC; 2min 55s ago&#xD;&#xA;Process: 15248 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect &amp;amp;gt;&#xD;&#xA;Main PID: 15253 (postgres)&#xD;&#xA;Tasks: 7 (limit: 4633)&#xD;&#xA;Memory: 17.3M&#xD;&#xA;CPU: 239ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@14-main.service&#xD;&#xA;â”œâ”€15253 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresq&amp;amp;gt;&#xD;&#xA;â”œâ”€15255 &amp;quot;postgres: 14/main: checkpointer &amp;quot;&#xD;&#xA;â”œâ”€15256 &amp;quot;postgres: 14/main: background writer &amp;quot;&#xD;&#xA;â”œâ”€15257 &amp;quot;postgres: 14/main: walwriter &amp;quot;&#xD;&#xA;â”œâ”€15258 &amp;quot;postgres: 14/main: autovacuum launcher &amp;quot;&#xD;&#xA;â”œâ”€15259 &amp;quot;postgres: 14/main: stats collector &amp;quot;&#xD;&#xA;â””â”€15260 &amp;quot;postgres: 14/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:43:53 ip-192-1-1-246 systemd[1]: Starting postgresql@14-main.service&amp;amp;gt;&#xD;&#xA;Dec 04 09:43:55 ip-192-1-1-246 systemd[1]: Started postgresql@14-main.service &amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur la deuxiÃ¨me machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;admin@ip-192-1-1-89:~$ sudo apt install postgresql-17&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-17 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;admin@ip-192-1-1-89:~$ systemctl status postgresql@17-main.service&#xD;&#xA;â— postgresql@17-main.service - PostgreSQL Cluster 17-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime; &amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:52:33 UTC; 2min 13s ago&#xD;&#xA;Process: 15235 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect 1&amp;amp;gt;&#xD;&#xA;Main PID: 15240 (postgres)&#xD;&#xA;Tasks: 6 (limit: 4633)&#xD;&#xA;Memory: 20.5M&#xD;&#xA;CPU: 332ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@17-main.service&#xD;&#xA;â”œâ”€15240 /usr/lib/postgresql/17/bin/postgres -D /var/lib/postgresql&amp;amp;gt;&#xD;&#xA;â”œâ”€15241 &amp;quot;postgres: 17/main: checkpointer &amp;quot;&#xD;&#xA;â”œâ”€15242 &amp;quot;postgres: 17/main: background writer &amp;quot;&#xD;&#xA;â”œâ”€15244 &amp;quot;postgres: 17/main: walwriter &amp;quot;&#xD;&#xA;â”œâ”€15245 &amp;quot;postgres: 17/main: autovacuum launcher &amp;quot;&#xD;&#xA;â””â”€15246 &amp;quot;postgres: 17/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:52:31 ip-192-1-1-89 systemd[1]: Starting postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;Dec 04 09:52:33 ip-192-1-1-89 systemd[1]: Started postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos deux instances sont maintenant installÃ©es. Sur notre premiÃ¨re base de donnÃ©es, nous allons crÃ©er une base, avec deux tables, et quelques lignes.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE TABLE customers (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;name TEXT NOT NULL,&#xD;&#xA;email TEXT UNIQUE,&#xD;&#xA;created_at TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# CREATE TABLE orders (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;customer_id INT REFERENCES customers(id),&#xD;&#xA;amount NUMERIC(10,2) NOT NULL,&#xD;&#xA;order_date TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES&#xD;&#xA;(&#39;Alice&#39;, &#39;alice@example.com&#39;),&#xD;&#xA;(&#39;Bob&#39;, &#39;bob@example.com&#39;),&#xD;&#xA;(&#39;Charlie&#39;, &#39;charlie@example.com&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;mydb=# INSERT INTO orders (customer_id, amount) VALUES&#xD;&#xA;(1, 50.75),&#xD;&#xA;(2, 20.00),&#xD;&#xA;(1, 75.00);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;2. Configurer la base de donnÃ©es source&lt;/h3&gt;&#xA;&lt;p&gt;Sur notre premiÃ¨re machine, nous allons modifier les paramÃ¨tres du fichier de configuration de PostgreSQL pour permettre de pouvoir crÃ©er la rÃ©plication :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-246:~$ cd /etc/postgresql/14/main&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il s&amp;#8217;agit de modifier les paramÃ¨tres suivants :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Nous modifierons ensuite le pg_hba pour rajouter l&amp;#8217;autorisation de connexion entre les deux machines :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il suffira de rajouter une ligne :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Il ne faut pas oublier de redÃ©marrer le serveur PostgreSQL une fois ces modifications effectuÃ©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;3. Configurer la base de donnÃ©e de destination&lt;/h3&gt;&#xA;&lt;p&gt;AprÃ¨s avoir configurÃ© notre base de donnÃ©e depuis laquelle nous allons faire notre migration, il nous faut a prÃ©sent configurer celle qui va recevoir la nouvelle base de donnÃ©e migrÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela, nous allons rÃ©pÃ©ter les Ã©tapes de configuration de la base de donnÃ©e source, en les adaptant sur notre base de donnÃ©e de destination : modifier le postgresql.conf, puis le pg_hba.conf, redÃ©marrer ensuite la base de donnÃ©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ cd /etc/postgresql/17/main/&#xD;&#xA;postgres@ip-192-1-1-89:/etc/postgresql/17/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il ne faudra pas oublier de crÃ©er la base de donnÃ©e ainsi que toutes les structures de tables et autres objets dans notre base cible pour qu&amp;#8217;elle puisse recevoir les donnÃ©es. Pour avoir les scripts de crÃ©ation de la base de donnÃ©es, vous pouvez faire un pg_dump avec l&amp;#8217;option&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ psql&#xD;&#xA;psql (17.2 (Debian 17.2-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;N&amp;#8217;oubliez pas de donner tout les droits Ã  votre utilisateur de replication pour qu&amp;#8217;il puisse lire, Ã©crire&amp;#8230; Sur votre base de donnÃ©es repliquÃ©e, sur la source, comme sur la destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# GRANT ALL PRIVILEGES ON DATABASE &amp;quot;mydb&amp;quot; to replication;&#xD;&#xA;GRANT&#xD;&#xA;&#xD;&#xA;mydb=# GRANT ALL PRIVILEGES ON all tables in schema public to replication;&#xD;&#xA;GRANT&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;4. Mise en place de la rÃ©plication logique&lt;/h3&gt;&#xA;&lt;p&gt;Maintenant que nos deux environnement sont bien en place, nous sommes prÃªts Ã  mettre en route le processus de rÃ©plication logique pour commencer Ã  transfÃ©rer les donnÃ©es. Les Ã©tapes du dessous ont demandÃ© une premiÃ¨re intervention hors horaire de prod, notamment pour redÃ©marrer le service postgreSQL, mais le but d&amp;#8217;une migration avec rÃ©plication logique, c&amp;#8217;est de pouvoir ensuite n&amp;#8217;avoir rien Ã  toucher jusqu&amp;#8217;au moment de basculer les applicatifs d&amp;#8217;une ip a une autre.&lt;/p&gt;&#xA;&lt;p&gt;Sur notre machine source, on crÃ©Ã© la publication qui va nous servir Ã  transfÃ©rer nos tables :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE PUBLICATION my_pub FOR ALL TABLES;&#xD;&#xA;CREATE PUBLICATION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On va ensuite crÃ©Ã© la souscription sur la base de donnÃ©es cible de notre migration :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# create subscription my_sub connection &#39;host=192.1.1.246 port=5432 dbname=mydb user=replication password=replication&#39;publication my_pub;&#xD;&#xA;NOTICE: created replication slot &amp;quot;my_sub&amp;quot; on publisher&#xD;&#xA;CREATE SUBSCRIPTION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Maintenant que la subscription est en place, on peut vÃ©rifier qu&amp;#8217;elle fonctionne. Pendant ce temps, la vrai production, sur la version 14, peut continuer Ã  fonctionner, elle sera automatiquement repliquÃ©e sur la nouvelle version 17.&lt;/p&gt;&#xA;&lt;p&gt;On peut vÃ©rifier ou en est notre replication avec la commande &lt;span class=&#34;hljs-keyword&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;FROM&lt;/span&gt; pg_stat_subscription;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# SELECT * FROM pg_stat_subscription;&#xD;&#xA;-[ RECORD 1 ]---------+------------------------------&#xD;&#xA;subid | 16422&#xD;&#xA;subname | my_sub&#xD;&#xA;worker_type | apply&#xD;&#xA;pid | 16076&#xD;&#xA;leader_pid |&#xD;&#xA;relid |&#xD;&#xA;received_lsn | 0/1733988&#xD;&#xA;last_msg_send_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;last_msg_receipt_time | 2024-12-04 14:23:59.872357+00&#xD;&#xA;latest_end_lsn | 0/1733988&#xD;&#xA;latest_end_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;5. Test de replication, bascule, et nettoyage&lt;/h3&gt;&#xA;&lt;p&gt;Une fois que la synchronisation de votre replication logique est terminÃ©e, ce qui peut prendre un certain temps si vous avez beaucoup de donnÃ©es, vous pouvez constater de vous mÃªme sur les lignes que vous ajoutez, modifiez ou supprimez sur votre instance source sont repliquÃ©es sur l&amp;#8217;instance de destination.&lt;/p&gt;&#xA;&lt;p&gt;Par exemple, ajoutons un nouveau customer sur notre base source :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES (&#39;Diana&#39;, &#39;diana@example.com&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Si nous allons requÃªter sur notre instance de destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# select * from customers where name=&#39;Diana&#39;;&#xD;&#xA;id | name | email | created_at&#xD;&#xA;----+-------+-------------------+----------------------------&#xD;&#xA;4 | Diana | diana@example.com | 2024-12-04 14:31:05.708031&#xD;&#xA;(1 row)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Quand vous vous Ãªtes bien assurÃ© que tout fonctionne, vous pouvez alors rediriger les drivers odbc de vos applications vers le nouveau serveur et non plus l&amp;#8217;ancien.&lt;/p&gt;&#xA;&lt;p&gt;Une fois que cela est fait, vous pouvez alors supprimer le lien de replication, puisque l&amp;#8217;ancienne instance ne sera plus alimentÃ©e, et mÃªme supprimer l&amp;#8217;ancienne version si vous n&amp;#8217;en avez plus l&amp;#8217;utilitÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Sur la destination, notre nouveau serveur de prod :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP SUBSCRIPTION my_sub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Sur la source, ancien serveur qui va Ãªtre supprimÃ© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP PUBLICATION my_pub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h1&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;La rÃ©plication logique se distingue comme lâ€™une des meilleures solutions pour minimiser le temps dâ€™arrÃªt lors dâ€™une migration de version PostgreSQL. En permettant une synchronisation continue des donnÃ©es entre deux instances, elle garantit une transition en douceur sans jamais interrompre les services en cours. Cela en fait un choix idÃ©al pour les environnements critiques oÃ¹ la disponibilitÃ© est primordiale.&lt;/p&gt;&#xA;&lt;h3&gt;Avantages :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;ZÃ©ro downtime :&lt;/strong&gt; la source reste opÃ©rationnelle pendant toute la migration.&lt;br /&gt;&#xA;&lt;strong&gt;FlexibilitÃ© :&lt;/strong&gt; possibilitÃ© de migrer vers une infrastructure diffÃ©rente (nouveau matÃ©riel, cloud, etc.).&lt;br /&gt;&#xA;&lt;strong&gt;GranularitÃ© :&lt;/strong&gt; la rÃ©plication logique peut se limiter Ã  certaines tables si nÃ©cessaire.&lt;/p&gt;&#xA;&lt;h3&gt;InconvÃ©nients :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;ComplexitÃ© initiale :&lt;/strong&gt; la configuration et les tests nÃ©cessitent une bonne maÃ®trise des paramÃ¨tres de PostgreSQL.&lt;br /&gt;&#xA;&lt;strong&gt;Impact sur les performances :&lt;/strong&gt; la charge de rÃ©plication peut lÃ©gÃ¨rement affecter les performances de la base source, surtout avec un grand volume de donnÃ©es.&lt;br /&gt;&#xA;&lt;strong&gt;Non pris en charge pour certains types de donnÃ©es :&lt;/strong&gt; les types spÃ©cifiques ou les extensions non standards ne sont pas toujours compatibles avec la rÃ©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Si la rÃ©plication logique est souvent la mÃ©thode privilÃ©giÃ©e pour des mises Ã  jour critiques, elle nâ€™est pas la seule option. Des alternatives comme les outils de sauvegarde et restauration ou la rÃ©plication physique peuvent rÃ©pondre Ã  dâ€™autres besoins spÃ©cifiques, notamment pour des bases de donnÃ©es trÃ¨s volumineuses ou des scÃ©narios nÃ©cessitant une rÃ©plication complÃ¨te du systÃ¨me.&lt;/p&gt;&#xA;&lt;p&gt;Dans tous les cas, le choix de la mÃ©thode dÃ©pendra de votre contexte, de vos contraintes techniques et de vos objectifs mÃ©tier. Prenez le temps dâ€™Ã©valuer les diffÃ©rentes options pour garantir une migration rÃ©ussie et sans surprise.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/replication-logique-avec-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;23 janvier 2020&#34;&gt;RÃ©plication logique avec PostgreSQL&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migration-postgresql-via-slony-i-ou-comment-reduire-le-temps-de-coupure/&#34; rel=&#34;bookmark&#34; title=&#34;27 janvier 2020&#34;&gt;Migration PostgreSQL via SLONY-I ou comment rÃ©duire le temps de coupure&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migrer-dun-cluster-galera-mariadb-10-3-vers-mariadb-10-5-avec-la-replication-logique/&#34; rel=&#34;bookmark&#34; title=&#34;25 fÃ©vrier 2022&#34;&gt;Migrer d&amp;#8217;un cluster Galera MariaDB 10.3 vers MariaDB 10.5 avec la rÃ©plication logique&lt;/a&gt; (David Baffaleuf) [ContainerMySQLNon classÃ©]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/comparatif-des-gestionnaires-de-vip-dans-un-cluster-patroni-episode-1-keepalived/&#34; rel=&#34;bookmark&#34; title=&#34;6 mars 2022&#34;&gt;Comparatif des gestionnaires de VIP dans un cluster Patroni : Ã©pisode 1 (KEEPALIVED)&lt;/a&gt; (David Baffaleuf) [ContainerPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des schÃ©mas de base de donnÃ©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.568 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La montÃ©e de version en zero-downtime : merci la rÃ©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Introduction : Dans le monde des bases de donnÃ©es, garantir une disponibilitÃ© continue est une exigence incontournable, surtout pour les systÃ¨mes critiques oÃ¹ chaque minute d&amp;#8217;arrÃªt peut entraÃ®ner des pertes significatives. Lorsquâ€™il sâ€™agit de migrer une base de donnÃ©es vers&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La montÃ©e de version en zero-downtime : merci la rÃ©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>pg_vector : lâ€™IA et PostgreSQL</title>
    <updated>2024-12-03T07:22:34Z</updated>
    <id>tag:blog.capdata.fr,2024-12-03:/index.php/pg_vector-lia-et-postgresql/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h2&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le rÃ´le des bases de donnÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle (IA) connaÃ®t une popularitÃ© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies fonctionnent, elles ont besoin de donnÃ©es, souvent en grande quantitÃ©. Câ€™est lÃ  quâ€™interviennent les bases de donnÃ©es : elles stockent, gÃ¨rent et permettent d&amp;#8217;accÃ©der Ã  ces donnÃ©es de maniÃ¨re efficace.&lt;/p&gt;&#xA;&lt;p&gt;Les bases de donnÃ©es, comme PostgreSQL, ont donc un rÃ´le clÃ© dans lâ€™IA. Mais l&amp;#8217;IA ne traite pas toujours des informations simples comme des noms ou des chiffres ; souvent, elle doit manipuler des informations complexes, comme des reprÃ©sentations numÃ©riques d&amp;#8217;images, de sons, ou de textes. Pour gÃ©rer ces donnÃ©es spÃ©cifiques, il faut des outils adaptÃ©s, et c&amp;#8217;est lÃ  que l&amp;#8217;extension pg_vector de PostgreSQL entre en jeu.&lt;/p&gt;&#xA;&lt;h2&gt;2. Les vecteurs en informatique et dans pg_vector&lt;/h2&gt;&#xA;&lt;p&gt;Dans le cadre de lâ€™informatique, un vecteur est simplement une liste de nombres. Ces nombres peuvent reprÃ©senter nâ€™importe quoi : les caractÃ©ristiques dâ€™un produit, les mots dâ€™un texte ou mÃªme une image. Par exemple, pour un document texte, chaque mot peut Ãªtre transformÃ© en une sÃ©rie de nombres qui capture son sens dans un certain contexte.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™extension pg_vector permet Ã  PostgreSQL de stocker et de manipuler ces vecteurs. Elle offre un moyen simple de les utiliser directement dans une base de donnÃ©es. Imaginons que nous avons des centaines de documents et que nous souhaitions rechercher les plus similaires Ã  un texte donnÃ© : en stockant les reprÃ©sentations numÃ©riques (ou embeddings) de ces documents sous forme de vecteurs, nous pouvons facilement comparer leur similaritÃ© grÃ¢ce Ã  pg_vector.&lt;/p&gt;&#xA;&lt;h2&gt;3. Le lien entre l&amp;#8217;IA et les vecteurs&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle repose sur la capacitÃ© Ã  comprendre et traiter des informations complexes. Par exemple, quand une IA doit reconnaÃ®tre une image, elle ne &amp;#8220;voit&amp;#8221; pas comme nous. Au lieu de cela, l&amp;#8217;image est transformÃ©e en une sÃ©rie de nombres, un vecteur, qui reprÃ©sente ses caractÃ©ristiques (couleurs, formes, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Le mÃªme principe sâ€™applique au texte. Les modÃ¨les de traitement du langage, comme ceux utilisÃ©s par les moteurs de recherche ou les chatbots, transforment chaque mot ou phrase en vecteur. Ces vecteurs capturent le sens des mots et permettent Ã  l&amp;#8217;IA de manipuler des informations complexes sans &amp;#8220;comprendre&amp;#8221; le langage humain.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est ici que les embeddings entrent en jeu. Un embedding est un vecteur qui reprÃ©sente des donnÃ©es sous une forme que lâ€™IA peut utiliser. Par exemple, dans un systÃ¨me de recommandation, chaque produit est converti en un embedding, et les produits les plus proches de celui que nous venons de consulter (en termes de vecteur) nous seront recommandÃ©s. GrÃ¢ce Ã  pg_vector, ces embeddings peuvent Ãªtre stockÃ©s et comparÃ©s directement dans une base de donnÃ©es.&lt;/p&gt;&#xA;&lt;h2&gt;4. Pourquoi est-ce utile ?&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector est trÃ¨s utile pour des applications qui nÃ©cessitent la recherche par similaritÃ©. Par exemple, dans un moteur de recherche, si nous voulons trouver les documents les plus proches d&amp;#8217;un texte donnÃ©, pg_vector permet de comparer les vecteurs (ou embeddings) de chaque document pour voir lesquels sont les plus similaires.&lt;/p&gt;&#xA;&lt;p&gt;Autre exemple, dans une plateforme de streaming musical, chaque chanson peut Ãªtre convertie en vecteur qui reprÃ©sente ses caractÃ©ristiques (comme le tempo, la tonalitÃ©, etc.). GrÃ¢ce Ã  pg_vector, on peut facilement recommander des chansons similaires Ã  celles que nous Ã©coutons.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™avantage de pg_vector, câ€™est quâ€™il permet de gÃ©rer ces vecteurs directement dans la base de donnÃ©es, ce qui Ã©vite de passer par des systÃ¨mes externes plus complexes. Cela simplifie le dÃ©veloppement et amÃ©liore la performance, car tout est gÃ©rÃ© au mÃªme endroit.&lt;/p&gt;&#xA;&lt;h2&gt;5. Le test&lt;/h2&gt;&#xA;&lt;p&gt;Pour dÃ©montrer le fonctionnement de l&amp;#8217;extension, rien de tel qu&amp;#8217;un petit test pour Ã©prouver les fonctionnalitÃ©s qu&amp;#8217;elle propose. Le test sera plutÃ´t simple et succinct pour Ãªtre accessible. Le prÃ©requi est d&amp;#8217;avoir une version PostgreSQL 14 ou plus rÃ©cente d&amp;#8217;installÃ©e.&lt;/p&gt;&#xA;&lt;h3&gt;Etape 1 :&lt;/h3&gt;&#xA;&lt;p&gt;On commence par installer l&amp;#8217;extension pg_vector. Pour cela, nous allons avoir besoin d&amp;#8217;un certain nombre d&amp;#8217;outils pour le faire fonctionner. Une partie de ces outils sont disponible dans la distribution dev de PostgreSQL&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# sudo apt install postgresql-server-dev-14&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nous aurons Ã©galement besoin de gcc et make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# apt install make&#xD;&#xA;root@ip-192-1-1-201:~# apt-get install gcc&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On effectue ensuite un git clone du projet :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# git clone https://github.com/pgvector/pgvector.git&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et une fois que c&amp;#8217;est fait, on l&amp;#8217;installe avec make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# cd pgvector&#xD;&#xA;root@ip-192-1-1-201:~# make &amp;amp;amp;&amp;amp;amp; sudo make install&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 2 :&lt;/h3&gt;&#xA;&lt;p&gt;On se connecte Ã  PostgreSQL pour crÃ©er l&amp;#8217;extension. Au passage, on crÃ©Ã© aussi une base de donnÃ©es pour faire nos test.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-201:~$ psql&#xD;&#xA;psql (14.13 (Ubuntu 14.13-0ubuntu0.22.04.1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# create database test_vector;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c test_vector&#xD;&#xA;You are now connected to database &amp;quot;test_vector&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;test_vector=# CREATE EXTENSION vector;&#xD;&#xA;CREATE EXTENSION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et dans la foulÃ©e, on crÃ©e une table qui contient les vecteurs sur lesquels nous allons faire les test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# CREATE TABLE documents (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;title TEXT,&#xD;&#xA;embedding vector(3) -- vecteur de dimension 3 pour cet exemple&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Insertion des donnÃ©es d&amp;#8217;exemple :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# INSERT INTO documents (title, embedding) VALUES&#xD;&#xA;(&#39;Document 1&#39;, &#39;[0.1, 0.2, 0.3]&#39;),&#xD;&#xA;(&#39;Document 2&#39;, &#39;[0.4, 0.5, 0.6]&#39;),&#xD;&#xA;(&#39;Document 3&#39;, &#39;[0.9, 0.8, 0.7]&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 3 :&lt;/h3&gt;&#xA;&lt;p&gt;Nous avons deux types de choses Ã  tester pour montrer l&amp;#8217;efficacitÃ© de notre extension. En effet, pour rechercher un vecteur, deux modes s&amp;#8217;offrent Ã  nous :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h4&gt;La distance cosinus&lt;/h4&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;La distance cosinus mesure non pas combien deux vecteurs sont Ã©loignÃ©s, mais l&amp;#8217;angle entre eux. Câ€™est un peu comme comparer la direction dans laquelle pointent deux vecteurs plutÃ´t que la distance rÃ©elle entre eux.&lt;/p&gt;&#xA;&lt;p&gt;Imaginons que nous sommes en train de lancer deux flÃ¨ches. La distance cosinus nous dira si les deux flÃ¨ches pointent dans la mÃªme direction (sont similaires) ou si elles pointent dans des directions trÃ¨s diffÃ©rentes (sont moins similaires).&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre de lâ€™IA, cette mesure est souvent utilisÃ©e pour comparer des embeddings (reprÃ©sentations numÃ©riques complexes), car elle se concentre sur la relation entre les Ã©lÃ©ments, indÃ©pendamment de leur taille exacte.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Prenons les deux films :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Film A : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Film B : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance cosinus ne va pas se soucier de la diffÃ©rence de valeur entre chaque composant, mais va regarder si les deux films ont des proportions similaires. Autrement dit, est-ce que leur &amp;#8220;profil&amp;#8221; gÃ©nÃ©ral est proche ou Ã©loignÃ© ?&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette distance, dans notre pg vector, on utilise la mÃ©thode suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+---------------------&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.05582537807240784&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.07142855242198809&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 0.09815280896106982&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Le symbole &amp;lt;=&amp;gt; reprÃ©sente une distance cosinus.&lt;/p&gt;&#xA;&lt;h4&gt;2. La distance Euclidienne&lt;/h4&gt;&#xA;&lt;p&gt;Imaginons que nous sommes sur une carte avec deux points : le point A et le point B. La distance euclidienne, c&amp;#8217;est la faÃ§on la plus intuitive de mesurer la distance entre ces deux points, comme si nous tracions une ligne droite entre eux. Pour parler en terme simple, câ€™est la &amp;#8220;distance Ã  vol d&amp;#8217;oiseau&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des vecteurs, la distance euclidienne mesure la diffÃ©rence entre deux vecteurs, un peu comme si chaque vecteur Ã©tait un point sur une carte en plusieurs dimensions. Plus cette distance est petite, plus les deux vecteurs (et donc les objets quâ€™ils reprÃ©sentent) sont similaires.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Imaginons deux films reprÃ©sentÃ©s par les vecteurs suivants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film A&lt;/strong&gt; : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film B&lt;/strong&gt; : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance euclidienne va calculer la diffÃ©rence entre chaque nombre des deux vecteurs et dÃ©terminer Ã  quel point ces films sont proches en termes de caractÃ©ristiques (genre, nombre dâ€™acteurs, budget, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Dans pg_vector on peut le tester ainsi :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+--------------------&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.1414213612422477&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.5385165006363984&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 1.0677078185041473&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Elle est reprÃ©sentÃ©e par le cigle &amp;lt;-&amp;gt; dans pg_vector.&lt;/p&gt;&#xA;&lt;h4&gt;3. Quand choisir l&amp;#8217;une ou l&amp;#8217;autre des distances ?&lt;/h4&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La distance euclidienne est utile quand tu veux mesurer la diffÃ©rence globale entre deux objets. Elle est facile Ã  comprendre et Ã  utiliser pour des comparaisons directes.&lt;/li&gt;&#xA;&lt;li&gt;La distance cosinus est utile quand tu veux savoir si deux objets sont globalement similaires dans leur profil, indÃ©pendamment de leur taille ou de leur Ã©chelle. Elle est souvent utilisÃ©e pour comparer des documents textuels ou des donnÃ©es complexes en IA&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector apporte une fonctionnalitÃ© puissante Ã  PostgreSQL, permettant de manipuler des donnÃ©es complexes sous forme de vecteurs. Que ce soit pour des systÃ¨mes de recommandation, des moteurs de recherche ou toute autre application liÃ©e Ã  lâ€™intelligence artificielle, elle offre un moyen simple et efficace d&amp;#8217;intÃ©grer l&amp;#8217;IA dans les bases de donnÃ©es. Et tout cela, sans avoir besoin de comprendre des mathÃ©matiques avancÃ©es : il suffit de savoir que ces vecteurs permettent de traiter des informations complexes de maniÃ¨re trÃ¨s efficace.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/&#34; rel=&#34;bookmark&#34; title=&#34;3 avril 2024&#34;&gt;pg_recursively_delete : Simplifier les suppressions rÃ©cursives&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des schÃ©mas de base de donnÃ©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-planifier-une-tache-avec-pg_cron/&#34; rel=&#34;bookmark&#34; title=&#34;24 septembre 2019&#34;&gt;PostgreSQL : planifier une tÃ¢che avec pg_cron&lt;/a&gt; (Emmanuel RAMI) [Non classÃ©PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/transparent-data-encryption-pour-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;13 mai 2022&#34;&gt;Transparent Data Encryption pour PostgreSQL&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pg_dirtyread-ou-comment-reparer-facilement-un-delete-sauvage/&#34; rel=&#34;bookmark&#34; title=&#34;27 mars 2024&#34;&gt;pg_dirtyread oÃ¹ comment rÃ©parer facilement un delete sauvage&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.259 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le rÃ´le des bases de donnÃ©es L&amp;#8217;intelligence artificielle (IA) connaÃ®t une popularitÃ© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup</title>
    <updated>2024-07-16T11:24:05Z</updated>
    <id>tag:blog.capdata.fr,2024-07-16:/index.php/postgresql-17-sauvegardes-incrementales/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-10592&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/07/SalesGrowth.jpg&#34; alt=&#34;&#34; width=&#34;279&#34; height=&#34;180&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonjour&lt;/p&gt;&#xA;&lt;p&gt;Les 11 et 12 juin derniers, nous Ã©tions aux journÃ©es PGDAY Ã  Lille pour dÃ©couvrir les nouveautÃ©s autour de PostgreSQL.&lt;br /&gt;&#xA;Cette confÃ©rence regroupe diffÃ©rents professionnels, de la communautÃ© francophone, qui agissent en contribuant sur des sujets techniques mais aussi sur les bonnes pratiques afin d&amp;#8217;utiliser PostgreSQL dans les meilleurs conditions.&lt;/p&gt;&#xA;&lt;p&gt;Un article m&amp;#8217;a particuliÃ¨rement intÃ©ressÃ© cette annÃ©e, c&amp;#8217;est celui de &lt;a href=&#34;https://www.linkedin.com/in/stefan-fercot/?originalSubdomain=be&#34;&gt;Stefan Fercot&lt;/a&gt; Senior DBA PostgreSQL qui vit en Belgique, et travaille pour une sociÃ©tÃ© allemande experte dans les solutions PostgreSQL. Sa prÃ©sentation portait sur le sujet &amp;#8220;dÃ©mystifier les sauvegardes incrÃ©mentales sous PostgreSQL&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;#8217;ai Ã©coutÃ© sa confÃ©rence tout en ayant hÃ¢te de tester sa mise en place dÃ¨s mon retour de Lille.&lt;/p&gt;&#xA;&lt;p&gt;Je tiens Ã  remercier Stefan pour son travail sur ce sujet sauvegardes PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Tout d&amp;#8217;abord, il faut savoir que les sujets sauvegardes incrÃ©mentales ont Ã©tÃ© dÃ©jÃ  abordÃ©s avec des outils comme &lt;strong&gt;Barman&lt;/strong&gt; ou &lt;strong&gt;Pg_BackRest&lt;/strong&gt;, et que certaines instances PostgreSQL de production sont sauvegardÃ©es via ces mÃ©canismes depuis quelques annÃ©es maintenant.&lt;/p&gt;&#xA;&lt;p&gt;Ici, nous parlons de la solution &amp;#8220;backup incremental&amp;#8221; inclu nativement dans le moteur PostgreSQL, et disponible avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8220;. C&amp;#8217;est d&amp;#8217;ailleurs ce point que Stefan a soulignÃ© durant la journÃ©e PGDAY du 11 juin dernier.&lt;/p&gt;&#xA;&lt;p&gt;Cette nouvelle fonctionnalitÃ© fait partie de la version &lt;strong&gt;PostgreSQL 17&lt;/strong&gt; qui est pour le moment, en version&lt;strong&gt; Beta 2&lt;/strong&gt;.&lt;br /&gt;&#xA;Celle ci devrait sortir, comme Ã  l&amp;#8217;accoutumÃ©, au cour de l&amp;#8217;automne prochain.&lt;/p&gt;&#xA;&lt;p&gt;Preuve que PostgreSQL est en perpÃ©tuel Ã©volution, et rejoint la liste des SGBD Ã©tant capable, comme peuvent le faire Oracle et SQL Server, de proposer nativement des sauvegardes incrÃ©mentales.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Installation de PostgreSQL 17&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette fonctionnalitÃ©, nous devons installer la toute derniÃ¨re version de PostgreSQL , la 17 beta 2. Attention, celle ci n&amp;#8217;Ã©tant pas disponible dans les dÃ©pÃ´ts PGDG, nous devons nous charger d&amp;#8217;installer cette version via le site postgresql.org&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&#34;&gt;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Nous disposons d&amp;#8217;un serveur Linux fork Red Hat 8 (Rocky Linux). Il nous faut donc tÃ©lÃ©charger les &amp;#8220;rpm&amp;#8221; liÃ©s Ã  cette version.&lt;/p&gt;&#xA;&lt;p&gt;Les packages dont nous avons besoin sont les suivants&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;# ls -lrt postgresql1* | awk &#39;{print$9}&#39;&#xD;&#xA;postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous les installons avec le compte &lt;strong&gt;root&lt;/strong&gt; de notre serveur.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[root@ tmp]# rpm -i postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous sommes sur un environnement &amp;#8220;Red Hat like&amp;#8221;, la crÃ©ation d&amp;#8217;une premiÃ¨re instance via &amp;#8220;initdb&amp;#8221; est nÃ©cessaire.&lt;br /&gt;&#xA;Surtout, ne pas oublier d&amp;#8217;activer les &amp;#8220;data checksums&amp;#8221; (option -k), nous verrons pourquoi dans la suite de cet article. La suite est Ã  faire avec le compte &lt;strong&gt;postgres&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ initdb -D /data/postgres/17/pg_data -k&#xD;&#xA;The files belonging to this database system will be owned by user &amp;quot;postgres&amp;quot;.&#xD;&#xA;This user must also own the server process.&#xD;&#xA;&#xD;&#xA;The database cluster will be initialized with locale &amp;quot;en_US.UTF-8&amp;quot;.&#xD;&#xA;The default database encoding has accordingly been set to &amp;quot;UTF8&amp;quot;.&#xD;&#xA;The default text search configuration will be set to &amp;quot;english&amp;quot;.&#xD;&#xA;&#xD;&#xA;Data page checksums are enabled.&#xD;&#xA;&#xD;&#xA;creating directory /data/postgres/17/pg_data ... ok&#xD;&#xA;creating subdirectories ... ok&#xD;&#xA;selecting dynamic shared memory implementation ... posix&#xD;&#xA;selecting default &amp;quot;max_connections&amp;quot; ... 100&#xD;&#xA;selecting default &amp;quot;shared_buffers&amp;quot; ... 128MB&#xD;&#xA;selecting default time zone ... UTC&#xD;&#xA;creating configuration files ... ok&#xD;&#xA;running bootstrap script ... ok&#xD;&#xA;performing post-bootstrap initialization ... ok&#xD;&#xA;syncing data to disk ... ok&#xD;&#xA;&#xD;&#xA;initdb: warning: enabling &amp;quot;trust&amp;quot; authentication for local connections&#xD;&#xA;initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.&#xD;&#xA;&#xD;&#xA;Success. You can now start the database server using:&#xD;&#xA;&#xD;&#xA;pg_ctl -D /data/postgres/17/pg_data -l logfile start&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;DÃ©marrer cette instance pour s&amp;#8217;assurer que tout fonctionne&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data -l logfile start&#xD;&#xA;waiting for server to start.... done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Notre version enregistrÃ©e est bien une Beta 2. Version qui ne doit pas Ãªtre mise sur un environnement de production comme le rappelle le site de la communautÃ© PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ psql&#xD;&#xA;(postgres@[local]:5437) [postgres] &amp;gt; select * from version();&#xD;&#xA;version&#xD;&#xA;------------------------------------------------------------------------------------------------------------&#xD;&#xA;PostgreSQL 17beta2 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-22), 64-bit&#xD;&#xA;(1 row)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Upgrade de version&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous disposions deja d&amp;#8217;une version PostgreSQL15 sur ce serveur, nous passons par un upgrade via l&amp;#8217;outil &amp;#8220;pg_upgrade&amp;#8221; toujours disponible dans cette nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Lancer pg_upgrade en mode check&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -c -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&#xD;&#xA;.....&#xD;&#xA;.....&#xD;&#xA;&#xD;&#xA;*Clusters are compatible*&#xD;&#xA;&amp;quot;/usr/pgsql-17/bin/pg_ctl&amp;quot; -w -D &amp;quot;/data/postgres/17/pg_data&amp;quot; -o &amp;quot;&amp;quot; -m smart stop  &amp;quot;/data/postgres/17/pg_data/pg_upgrade_output.d/20240708T085906.955/log/pg_upgrade_server.log&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;la log est gÃ©nÃ©rÃ©e dans le $PGDATA de la version 17.&lt;/p&gt;&#xA;&lt;p&gt;Puis lancer l&amp;#8217;exÃ©cution de pg_upgrade&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Effectuer une sauvegarde&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;PrÃ©requis&lt;/h3&gt;&#xA;&lt;p&gt;Avant de pouvoir effectuer une premiÃ¨re sauvegarde avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221; natif, il est primordial de respecter certains prÃ©requis important.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;L&amp;#8217;instance PostgreSQL doit Ãªtre crÃ©Ã©e avec les &amp;#8216;data checksums&amp;#8217; activÃ©s. Si ce n&amp;#8217;est pas le cas, utiliser l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_checksums&lt;/strong&gt;&amp;#8221; avec l&amp;#8217;option &amp;#8220;&lt;strong&gt;-e&lt;/strong&gt;&amp;#8220;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Si vous lancez une sauvegarde full puis une incrÃ©mentale immÃ©diatement, vous avez toutes les chances de tomber sur cette erreur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: incremental backups cannot be taken unless WAL summarization is enabled&lt;/pre&gt;&#xA;&lt;p&gt;En effet, pour avoir toutes les informations concernant les blocks modifiÃ©s, PostgreSQL a besoin de tracer dans les WALs toutes les modifications sur les objets en base.&lt;br /&gt;&#xA;Pour les DBA Oracle, le &amp;#8220;block change tracking&amp;#8221; de la version Enterprise Edition vous parlera trÃ¨s certainement&amp;#8230;.&lt;br /&gt;&#xA;Il s&amp;#8217;agit ici de la mÃªme fonctionnalitÃ©, c&amp;#8217;est Ã  dire, tracer les modifications effectuÃ©es dans les blocks de donnÃ©es.&lt;br /&gt;&#xA;Cette option est le &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Pour activer l&amp;#8217;option, nous aurons 2 paramÃ¨tres Ã  modifier, soit via un ALTER SYSTEM directement sous psql, ou bien dans le fichier &amp;#8220;postgresql.conf&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres backup]$ vi $PGDATA/postgresql.conf&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;# - WAL Summarization -&#xD;&#xA;&#xD;&#xA;#summarize_wal = off # run WAL summarizer process?&#xD;&#xA;#wal_summary_keep_time = &#39;10d&#39; # when to remove old summary files, 0 = never&lt;/pre&gt;&#xA;&lt;p&gt;Le premier paramÃ¨tre permet d&amp;#8217;activer cette option.&lt;br /&gt;&#xA;Le second dÃ©finit un temps de conservation des informations concernant les blocks modifiÃ©s entre une sauvegarde FULL et un incrÃ©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous activons donc l&amp;#8217;option &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8221; et la passons Ã  &lt;strong&gt;ON&lt;/strong&gt; et laissons Ã  10 jours le &amp;#8220;&lt;strong&gt;wal_summary_keep_time&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Attention, activez ces deux paramÃ¨tres avant votre premiÃ¨re sauvegarde FULL. Si vous le faites aprÃ¨s, vous risquez de rencontrer l&amp;#8217;erreur suivante&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: WAL summaries are required on timeline 1 from 1/AA000028 to 1/AC000060, but the summaries for that timeline and LSN range are incomplete&#xD;&#xA;DETAIL: The first unsummarized LSN in this range is 1/AA000028.&lt;/pre&gt;&#xA;&lt;p&gt;Le LSN pris lors de la premiÃ¨re sauvegarde FULL n&amp;#8217;est pas reconnu, et donc la sauvegarde incrÃ©mentale ne peut s&amp;#8217;appuyer dessus.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;RedÃ©marrer l&amp;#8217;instance une fois les modifications effectuÃ©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data/ restart&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Lancer une sauvegarde FULL&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Voici la nouvelle option prÃ©sente pour l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup --help&#xD;&#xA;pg_basebackup takes a base backup of a running PostgreSQL server.&#xD;&#xA;&#xD;&#xA;Usage:&#xD;&#xA;pg_basebackup [OPTION]...&#xD;&#xA;&#xD;&#xA;Options controlling the output:&#xD;&#xA;-D, --pgdata=DIRECTORY receive base backup into directory&#xD;&#xA;-F, --format=p|t output format (plain (default), tar)&#xD;&#xA;-i, --incremental=OLDMANIFEST&#xD;&#xA;take incremental backup&#xD;&#xA;-r, --max-rate=RATE maximum transfer rate to transfer data directory&#xD;&#xA;(in kB/s, or use suffix &amp;quot;k&amp;quot; or &amp;quot;M&amp;quot;)&#xD;&#xA;&#xD;&#xA;.... &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34;&gt;version 13&lt;/a&gt; de PostgreSQL, nous disposons pour chaque sauvegarde, d&amp;#8217;un fichier nommÃ© &amp;#8220;backup_manifest&amp;#8221;. Il s&amp;#8217;agit d&amp;#8217;un fichier json qui recense entiÃ¨rement les objets bases de donnÃ©es sauvegardÃ©s avec leur emplacement, leur taille, leur date de modification et leur &amp;#8220;checksum&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Celui ci est essentiel pour vÃ©rifier l&amp;#8217;intÃ©gritÃ© de notre sauvegarde avec &amp;#8220;&lt;strong&gt;pg_verifybackup&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Nous pouvons Ã  prÃ©sent faire une premiÃ¨re sauvegarde FULL de notre instance PG17.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17 -F p -l &amp;quot;Full Backup PG17&amp;quot; -P -v&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AD000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8048&amp;quot;&#xD;&#xA;3097788/3097788 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AD000158&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on effectue quelques transactions : crÃ©ation d&amp;#8217;une table et insertions de donnÃ©es sur cette table de test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [manu] $ &amp;gt; create table backup (nom varchar(20), type varchar(20), date_backup date);&#xD;&#xA;CREATE TABLE&#xD;&#xA;Time: 3.344 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;FULL&#39;,&#39;2024-07-08 12:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 3.612 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental&#39;,&#39;2024-07-08 13:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;RepÃ©rer le fichier &amp;#8220;backup_manifest&amp;#8221; de la sauvegarde FULL rÃ©alisÃ©e dans le dossier &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres PG17]$ ls -lrt backup*&#xD;&#xA;-rw-------. 1 postgres postgres 218 Jul 8 09:19 backup_label&#xD;&#xA;-rw-------. 1 postgres postgres 433295 Jul 8 09:20 backup_manifest&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Effectuer une sauvegarde incrÃ©mentale&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A partir de lÃ , lancer une sauvegarde incrÃ©mentale. Nous utilisons l&amp;#8217;option &amp;#8220;&lt;strong&gt;-i&lt;/strong&gt;&amp;#8221; pour indiquer Ã  &lt;strong&gt;pg_basebackup&lt;/strong&gt; ou est situÃ© le &amp;#8220;backup_manifest&amp;#8221; de la derniÃ¨re sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr -l &amp;quot;Incremental Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AF000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8139&amp;quot;&#xD;&#xA;12485/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AF000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;S&amp;#8217;il l&amp;#8217;on compare les deux rÃ©pertoires de sauvegardes &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221; et &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8220;, nous voyons que les tailles sont bien diffÃ©rentes&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;......&#xD;&#xA;3.0G /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;&#xD;&#xA;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17_incr&#xD;&#xA;......&#xD;&#xA;35M /data/postgres/backup/pg_basebackup/PG17_incr&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Un volume de 3Go pour la sauvegarde FULL de l&amp;#8217;instance contre 35Mo pour l&amp;#8217;incrÃ©mentale.&lt;br /&gt;&#xA;La taille occupÃ©e par les objets dans chacune des bases est bien plus faible dans la sauvegarde incrÃ©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous continuons Ã  insÃ©rer des donnÃ©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; [postgres - ]$ psql -d manu&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&#xD;&#xA;&#xD;&#xA;Time: 0.614 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental 2&#39;,&#39;2024-07-08 14:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.436 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;(3 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on lance une seconde sauvegarde incrÃ©mentale :&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr_2 -l &amp;quot;Incremental 2 Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17_incr/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/B1000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8313&amp;quot;&#xD;&#xA;12260/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/B1000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous remarquons l&amp;#8217;appel au &amp;#8220;backup manifest&amp;#8221; de la derniÃ¨re sauvegarde incrÃ©mentale prÃ©sente dans le rÃ©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on regarde la taille de ce nouveau backup&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres pg_basebackup]$ du -h PG17_incr_2&#xD;&#xA;.......&#xD;&#xA;35M PG17_incr_2&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A nouveau 35 Mo, mais vu le peu de modifications effectuÃ©es, la taille n&amp;#8217;est pas trÃ¨s reprÃ©sentative.&lt;/p&gt;&#xA;&lt;p&gt;Ce qu&amp;#8217;il faut retenir, c&amp;#8217;est qu&amp;#8217;en fonction du fichier &amp;#8220;backup manifest&amp;#8221; pris lors de l&amp;#8217;appel Ã  &lt;strong&gt;pg_basebackup&lt;/strong&gt;, vous pourrez faire soit&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde incrÃ©mentale qui prendra les derniÃ¨res modifications depuis la derniÃ¨re sauvegarde incrÃ©mentale effectuÃ©e.&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde diffÃ©rentielle qui prendra les modifications faites depuis la derniÃ¨re sauvegarde FULL si vous vous appuyez toujours sur le &amp;#8220;backup manifest&amp;#8221; de votre sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est donc ce fichier json &amp;#8220;backup manifest&amp;#8221; qui a un rÃ´le essentiel dans l&amp;#8217;Ã©laboration de votre stratÃ©gie de sauvegarde au fur et Ã  mesure du temps.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Et la restauration , comment ca se passe ?&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on souhaite restaurer tous ces jeux de sauvegardes, nous utilisons un nouvel outil qui est &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Cet outil permet de &amp;#8220;merger&amp;#8221; les diffÃ©rentes sauvegardes dans un et un seul dossier que l&amp;#8217;on restaurera par la suite.&lt;/p&gt;&#xA;&lt;p&gt;Dans notre exemple, nous avons fait 1 sauvegarde FULL puis 2 incrÃ©mentales.&lt;br /&gt;&#xA;Nous allons donc restaurer ces 3 jeux de sauvegardes afin de retrouver les donnÃ©es. A noter qu&amp;#8217;il existe une option &amp;#8220;&amp;#8211;dry-run&amp;#8221; pour tester la commande&lt;/p&gt;&#xA;&lt;p&gt;ExÃ©cuter la commande en prenant en paramÃ¨tre les dossiers de sauvegardes dans l&amp;#8217;ordre chronologique.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -n -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;Si aucune erreur en sortie, on exÃ©cute sans l&amp;#8217;option &amp;#8220;dry run&amp;#8221;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; [postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le rÃ©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_ALL&lt;/strong&gt;&amp;#8221; ainsi gÃ©nÃ©rÃ©, doit avoir une taille trÃ¨s lÃ©gÃ¨rement supÃ©rieure au dossier de la sauvegarde FULL.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h PG17_ALL&#xD;&#xA;....&#xD;&#xA;3.0G PG17_ALL&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;DerniÃ¨re Ã©tape, nous passons Ã  la restauration des donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Nous arrÃªtons l&amp;#8217;instance PG17&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ stop&#xD;&#xA;waiting for server to shut down.... done&#xD;&#xA;server stopped&lt;/pre&gt;&#xA;&lt;p&gt;Nous supprimons les donnÃ©es dans $PGDATA&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ rm -rf /data/postgres/17/pg_data/* &lt;/pre&gt;&#xA;&lt;p&gt;Puis nous restaurons ce jeu complet de donnÃ©es avec une simple copie.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ cp -r /data/postgres/backup/pg_basebackup/PG17_ALL/* /data/postgres/17/pg_data/ &lt;/pre&gt;&#xA;&lt;p&gt;Enfin redÃ©marrons l&amp;#8217;instance&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ start&#xD;&#xA;waiting for server to start....2024-07-08 10:51:45.671 UTC [8909] LOG: redirecting log output to logging collector process&#xD;&#xA;2024-07-08 10:51:45.671 UTC [8909] HINT: Future log output will appear in directory &amp;quot;log&amp;quot;.&#xD;&#xA;done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis contrÃ´ler que nous rÃ©cupÃ©rons bien toutes les lignes de notre table &amp;#8220;backup&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres@ip-172-44-2-96 pg_basebackup]$ psql -d manu&#xD;&#xA;(postgres@[local]:5437) [manu] primaire $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;Remarques&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Attention, toujours vÃ©rifier les sauvegardes Ã  chaque Ã©tape avec l&amp;#8217;outil &lt;strong&gt;pg_verifybackup &lt;/strong&gt;car rien ne garantit qu&amp;#8217;au moment de l&amp;#8217;appel Ã  &lt;strong&gt;pg_combinebackup&lt;/strong&gt; les diffÃ©rents jeux de sauvegardes FULL et/ou incrÃ©mentales ne soient pas corrompus.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Assurez vous d&amp;#8217;Ãªtre en mode &amp;#8220;data_checksum&amp;#8221; activÃ© et ne pas changer de mode entre les jeux de backup. Le &amp;#8220;backup manifest&amp;#8221; s&amp;#8217;appuie sur ce paramÃ©trage pour valider les checksums de chaque fichier.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le mode TAR pour &lt;strong&gt;pg_basebackup&lt;/strong&gt; n&amp;#8217;est pas compatible pour les sauvegardes full et incrÃ©mentales mÃªme si celui ci est possible. Mais c&amp;#8217;est Ã  vous de dÃ©tarer les fichiers &amp;#8220;&lt;strong&gt;base.tar.gz&lt;/strong&gt;&amp;#8221; Et au moment de la restaurationÂ  avec &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;, une possible corruption est rencontrÃ©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_all_tar /data/postgres/backup/pg_basebackup/PG17_TAR /data/postgres/backup/pg_basebackup/PG17_incr_TAR&#xD;&#xA;pg_combinebackup: error: could not write to file &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar/base/25284/25332&amp;quot;, offset 122470400: wrote 380928 of 409600&#xD;&#xA;pg_combinebackup: removing output directory &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;La compression a potentiellement ajoutÃ©e une corruption ne rendant pas possible l&amp;#8217;opÃ©ration de &amp;#8220;merge&amp;#8221; des donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La restauration PITR est possible bien entendu. N&amp;#8217;oubliez pas de crÃ©er le &amp;#8220;&lt;strong&gt;recovery.signal&lt;/strong&gt;&amp;#8221; dans $PGDATA et de dÃ©finir dans le fichier &amp;#8220;postgresql.conf&amp;#8221; les quelques paramÃ¨tres suivants&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_nameÂ &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_time &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_xid &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_lsn &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_inclusive = off ou on&lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_timeline = &amp;#8216;latest&amp;#8217; &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_action = &amp;#8216;pause&amp;#8217;Â &lt;/span&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f642.png&#34; alt=&#34;ğŸ™‚&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-la-streaming-replication-en-12/&#34; rel=&#34;bookmark&#34; title=&#34;19 novembre 2019&#34;&gt;PostgreSQL : la streaming replication en 12.&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/oracle-rds-effectuer-des-backup-rman-en-mode-paas/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;Oracle RDS : effectuer des backup RMAN en mode PaaS.&lt;/a&gt; (Emmanuel RAMI) [AWSNon classÃ©Oracle]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-comparatif-entre-barman-et-pgbackrest/&#34; rel=&#34;bookmark&#34; title=&#34;4 fÃ©vrier 2020&#34;&gt;PostgreSQL : Comparatif entre Barman et pgBackRest&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/haute-disponibilite-de-postgresql-avec-patroni/&#34; rel=&#34;bookmark&#34; title=&#34;2 fÃ©vrier 2022&#34;&gt;Haute disponibilitÃ© de PostgreSQL avec Patroni&lt;/a&gt; (Ludovic AUGEREAU) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.080 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&amp;#160; Bonjour Les 11 et 12 juin derniers, nous Ã©tions aux journÃ©es PGDAY Ã  Lille pour dÃ©couvrir les nouveautÃ©s autour de PostgreSQL. Cette confÃ©rence regroupe diffÃ©rents professionnels, de la communautÃ© francophone, qui agissent en contribuant sur des sujets techniques mais&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PGO : la suite</title>
    <updated>2024-05-29T08:58:17Z</updated>
    <id>tag:blog.capdata.fr,2024-05-29:/index.php/pgo-la-suite/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;title=PGO%20%3A%20la%20suite&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PGO%20%3A%20la%20suite&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;La gestion efficace des clusters PostgreSQL dans un environnement Kubernetes est un dÃ©fi complexe auquel sont confrontÃ©es de nombreuses entreprises aujourd&amp;#8217;hui. PGO offre une solution dÃ©clarative qui automatise la gestion des clusters PostgreSQL, simplifiant ainsi le dÃ©ploiement, la mise Ã  l&amp;#8217;Ã©chelle et la gestion des bases de donnÃ©es PostgreSQL dans un environnement Kubernetes.&lt;/p&gt;&#xA;&lt;p&gt;Pour faire suite Ã  l&amp;#8217;article de David sur PGO et Ã  la demande d&amp;#8217;un de nos clients, j&amp;#8217;ai rÃ©alisÃ© une Ã©tude approfondie de plusieurs fonctionnalitÃ©s de PGO.&lt;br /&gt;&#xA;Cet article va faire un petit tour d&amp;#8217;horizon des outils principaux inclus dans l&amp;#8217;implÃ©mentation de PGO. Que ce soit pour la sauvegarde avec pgbackrest, pour la balance des connexion avec pgbouncer ou pour le monitoring avec prometheus, PGO ne manque pas d&amp;#8217;utilitaire dont l&amp;#8217;utilisation est facilitÃ©e par la solution tout embarquÃ©.&lt;/p&gt;&#xA;&lt;h3&gt;Pgbackrest :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;PgBackRest est une solution de sauvegarde et de restauration pour les bases de donnÃ©es PostgreSQL qui propose plusieurs fonctionnalitÃ©s, telles que la sauvegarde et la restauration parallÃ¨les, la compression, les sauvegardes complÃ¨tes, diffÃ©rentielles et incrÃ©mentielles, la rotation des sauvegardes et l&amp;#8217;expiration des archives, l&amp;#8217;intÃ©gritÃ© des sauvegardes, etc. Il prend en charge plusieurs rÃ©fÃ©rentiels, qui peuvent Ãªtre situÃ©s localement ou Ã  distance via TLS/SSH, ou Ãªtre des stockages fournis par le cloud comme S3/GCS/Azure.&lt;br /&gt;&#xA;L&amp;#8217;architecture de pgbackrest pour PGO est la suivante :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1.png&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10564&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1-300x168.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;168&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1-300x168.png 300w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image1.png 605w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;On peut imaginer plusieurs moyens de mettre en place le pgbackrest. Dans un premier temps, nous avons la sauvegarde classique en systÃ¨me de fichier, comme dans notre exemple sur le blog :&lt;/p&gt;&#xA;&lt;h5&gt;1) La sauvegarde sur volume persistant Kubernetes :&lt;/h5&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;- name: repo1&#xD;&#xA;  volume:&#xD;&#xA;    volumeClaimSpec:&#xD;&#xA;      accessModes:&#xD;&#xA;      - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;      resources:&#xD;&#xA;        requests:&#xD;&#xA;          storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ce type de sauvegarde utilise un volume persistant de Kubernetes pour recueillir nos sauvegardes et les garder.&lt;br /&gt;&#xA;Une PersistentVolumeClaim (PVC) est une demande de stockage faite par un utilisateur. Elle est similaire Ã  un Pod. Les Pods consomment des ressources de nÅ“ud et les PVC consomment des ressources de PV (PersistentVolume). Les Pods peuvent demander des niveaux spÃ©cifiques de ressources (CPU et mÃ©moire). Les revendications peuvent demander une taille spÃ©cifique et des modes d&amp;#8217;accÃ¨s spÃ©cifiques (par exemple, elles peuvent Ãªtre montÃ©es en ReadWriteOnce, ReadOnlyMany, ReadWriteMany, ou ReadWriteOncePod, voir AccessModes).&lt;/p&gt;&#xA;&lt;h5&gt;2) Le stockage pour S3 :&lt;/h5&gt;&#xA;&lt;p&gt;Pour pouvoir faire du stockage dans S3, il faut rajouter un fichier de configuration dans notre dossier de dÃ©ploiement. Le fichier doit sâ€™appeler s3.conf. Ce fichier contient les crÃ©dential de connexion Ã  un AWS S3 :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;repo1-s3-key=$YOUR_AWS_S3_KEY&#xD;&#xA;repo1-s3-key-secret=$YOUR_AWS_S3_KEY_SECRET&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois que câ€™est configurÃ© dans votre fichier, il ne reste plus quâ€™Ã  modifier le postgresql.yaml, et configurer dans la partie backup :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-s3-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster1/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        s3:&#xD;&#xA;          bucket: &amp;quot;&amp;lt;YOUR_AWS_S3_BUCKET_NAME&amp;gt;&amp;quot;&#xD;&#xA;          endpoint: &amp;quot;&amp;lt;YOUR_AWS_S3_ENDPOINT&amp;gt;&amp;quot;&#xD;&#xA;          region: &amp;quot;&amp;lt;YOUR_AWS_S3_REGION&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois configurÃ©, et le job mis dans le cron, vous devriez voir apparaitre les sauvegardes sur le volume S3.&lt;/p&gt;&#xA;&lt;h5&gt;3) Le stockage GCS :&lt;/h5&gt;&#xA;&lt;p&gt;Comme pour Amazon S3 on peut sauvegarder nos backups dans Google Cloud Storage. Pour pouvoir le faire fonctionner il vous faut copier votre GCS key secret (qui est un fichier JSON) dans un gcs.conf que vous allez placer dans votre dossier Kustomize.&lt;br /&gt;&#xA;Il vous suffit ensuite de modifier votre fichier postgres.yaml pour ajouter dans la partie backup la configuration pour une sauvegarde gcs :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-gcs-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster1/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        gcs:&#xD;&#xA;          bucket: &amp;quot;&amp;lt;YOUR_GCS_BUCKET_NAME&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il ne vous reste plus quâ€™Ã  regÃ©nÃ©rer vos pods, et votre sauvegarde arrivera directement dans votre Google Cloud Service.&lt;/p&gt;&#xA;&lt;h5&gt;4) Le stockage Azur Blob Storage :&lt;/h5&gt;&#xA;&lt;p&gt;Comme pour les deux points prÃ©cÃ©dents, vous pouvez Ã©galement stocker vos sauvegardes sur le blob storage dâ€™Azure. Pour cela il vous faut crÃ©er un fichier dans votre kustomize, avec Ã  lâ€™intÃ©rieur la configuration pour votre point de sauvegarde Azure. Il vous faut lâ€™appeler azure.conf et il devra contenir les lignes suivantes :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;repo1-azure-account=$YOUR_AZURE_ACCOUNT&#xD;&#xA;repo1-azure-key=$YOUR_AZURE_KEY&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il faut ensuite intÃ©grer ces modifications dans votre fichier postgres.yaml :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-azure-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        azure:&#xD;&#xA;          container: &amp;quot;&amp;lt;YOUR_AZURE_CONTAINER&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Bien sur rien ne vous interdit, et câ€™est mÃªme conseillÃ©, de joindre plusieurs moyens de sauvegarde. Cela permet notamment de sâ€™assurer une plus grande fiabilitÃ© du systÃ¨me de sauvegarde, en sâ€™assurant quâ€™elles sont disponibles Ã  plusieurs endroits.&lt;br /&gt;&#xA;Une fois que vous avez dÃ©cidÃ© dâ€™oÃ¹ vous allez stocker vos sauvegardes, et que vous lâ€™avez configurÃ©, il faut maintenant dÃ©cider des diffÃ©rents paramÃ¨tres de ces sauvegardes : la programmation, la rÃ©tentionâ€¦&lt;/p&gt;&#xA;&lt;h5&gt;5) La programmation des sauvegardes :&lt;/h5&gt;&#xA;&lt;p&gt;Il faut savoir que par dÃ©faut, PGO sauvegarde automatiquement les WAL dans la mÃ©thode de sauvegarde que vous lui avez configurÃ©. Câ€™est donc une forme de sauvegarde en soit.&lt;br /&gt;&#xA;Mais dans le cadre dâ€™une rÃ©cupÃ©ration aprÃ¨s incident majeur, il peut aussi Ãªtre utilise dâ€™avoir des sauvegardes full programmÃ©es. Pgbackrest, qui est lâ€™outil utilisÃ© par PGO permet de mettre en place trois types de sauvegarde : les incrÃ©mentales, les diffÃ©rentielles et les fulls.&lt;br /&gt;&#xA;Chaque type de sauvegarde peut Ãªtre programmÃ©e en suivant une notation identique Ã  celle des crontab. Par exemple :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        schedules:&#xD;&#xA;          full: &amp;quot;0 1 * * 0&amp;quot;&#xD;&#xA;          differential: &amp;quot;0 1 * * 1-6&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Le fait dâ€™implÃ©menter ces planifications crÃ©era des CronJobs dans Kubernetes.&lt;/p&gt;&#xA;&lt;h5&gt;6) La rÃ©tention des backups :&lt;/h5&gt;&#xA;&lt;p&gt;Vous pouvez dÃ©finir une rÃ©tention maximum pour vos backups sur le support de backup de votre choix. Une fois que cette rÃ©tention sera atteinte, pgbackrest fera le mÃ©nage tout seul des sauvegardes et des WAL qui lui sont reliÃ©es.&lt;br /&gt;&#xA;Il y a deux types de rÃ©tentions que lâ€™on peut dÃ©finir : les rÃ©tentions Â« count Â» basÃ©es sur le nombre de backup que lâ€™on souhaite garder et les rÃ©tentions Â« time Â» basÃ©es sur le nombre de jours ou vous souhaitez garder votre sauvegarde.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      global:&#xD;&#xA;        repo1-retention-full: &amp;quot;14&amp;quot;&#xD;&#xA;        repo1-retention-full-type: time&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h5&gt;7) La sauvegarde unique :&lt;/h5&gt;&#xA;&lt;p&gt;Si dans le cadre dâ€™un besoin particuliers, une grosse modification ou une migration par exemple, vous avez besoin de prendre une sauvegarde immÃ©diate sans forcÃ©ment attendre que le cron nâ€™arrive, vous pouvez le faire.&lt;br /&gt;&#xA;Pour la configuration de cette sauvegarde, il faudra lâ€™annoter comme Â« manuelle Â» :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      manual:&#xD;&#xA;        repoName: repo1&#xD;&#xA;        options:&#xD;&#xA;         - --type=full&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il vous faudra ensuite dÃ©clencher cette sauvegarde avec une commande manuelle. Dans le cadre de notre cluster exemple pgcluster1 :&lt;br /&gt;&#xA;kubectl annotate -n postgres-operator postgrescluster pgcluster1 \ postgres-operator.crunchydata.com/pgbackrest-backup=&amp;#8221;$(date)&amp;#8221;&lt;/p&gt;&#xA;&lt;h5&gt;8) Faire un clone Ã  partir dâ€™un repo :&lt;/h5&gt;&#xA;&lt;p&gt;Quand on a configurÃ© un repo sur notre instance primaire, on peut facilement crÃ©er un clone de notre instance Ã  lâ€™aide de notre sauvegarde. Ainsi, on crÃ©er un tout nouveau Pods Ã  partir des informations stockÃ©es Ã  propos du pod que lâ€™on possÃ¨de dÃ©jÃ . Ici, nous allons crÃ©er un nouveau pod Ã  partir de notre pod pgcluster1 :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;apiVersion: postgres-operator.crunchydata.com/v1beta1&#xD;&#xA;kind: PostgresCluster&#xD;&#xA;metadata:&#xD;&#xA;  name: pgcluster2&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;  image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres:ubi8-16.2-0&#xD;&#xA;  postgresVersion: 16&#xD;&#xA;  instances:&#xD;&#xA;    - dataVolumeClaimSpec:&#xD;&#xA;        accessModes:&#xD;&#xA;        - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;        resources:&#xD;&#xA;          requests:&#xD;&#xA;            storage: 1Gi&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        volume:&#xD;&#xA;          volumeClaimSpec:&#xD;&#xA;            accessModes:&#xD;&#xA;            - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;            resources:&#xD;&#xA;              requests:&#xD;&#xA;                storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici on peut noter entre autres la partie spec de la configuration, qui est le morceau de yaml nous permettant de dire quâ€™on sâ€™appuie sur le cluster existant pour crÃ©er un clone indÃ©pendant :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h5&gt;9) Point in Time Recovery :&lt;/h5&gt;&#xA;&lt;p&gt;De la mÃªme faÃ§on, si lâ€™on veut faire une restauration PITR, nous allons remplir la balise spec de notre yaml. Attention cependant, pour faire une restauration PITR, nous avons besoin de possÃ©der encore la sauvegarde. On ne peut pas faire une restauration PITR sur une sauvegarde lointaine quâ€™on ne possÃ¨derait plus. Imaginons que je souhaite repartir dâ€™une sauvegarde datant dâ€™hier soir Ã  20h30 de mon instance pgcluster1 sur mon instance pgcluster2, la configuration serait la suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;apiVersion: postgres-operator.crunchydata.com/v1beta1&#xD;&#xA;kind: PostgresCluster&#xD;&#xA;metadata:&#xD;&#xA;  name: pgcluster2&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;      options:&#xD;&#xA;      - --type=time&#xD;&#xA;      - --target=&amp;quot;2024-04-09 20:30:00-00&amp;quot;&#xD;&#xA;  image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres:ubi8-16.2-0&#xD;&#xA;  postgresVersion: 16&#xD;&#xA;  instances:&#xD;&#xA;    - dataVolumeClaimSpec:&#xD;&#xA;        accessModes:&#xD;&#xA;        - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;        resources:&#xD;&#xA;          requests:&#xD;&#xA;            storage: 1Gi&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        volume:&#xD;&#xA;          volumeClaimSpec:&#xD;&#xA;            accessModes:&#xD;&#xA;            - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;            resources:&#xD;&#xA;              requests:&#xD;&#xA;                storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;La partie qui nous intÃ©resse ici est la partie spec, ou nous avons rajouter un type de restauration (ici time) et une heure target. Cela indique Ã  pgbackrest quâ€™il doit aller chercher tous les fichiers de sauvegarde et WAL sur notre point de sauvegarde repo1 venant de lâ€™instance pgcluster1 pour les rÃ©appliquer sur notre nouveau cluster pgcluster2.&lt;br /&gt;&#xA;Vous pouvez Ã©galement vouloir rÃ©aliser une restauration In Place, câ€™est-Ã -dire Ã©craser lâ€™instance prÃ©sente pour la remplacer par la restauration. Auquel cas, plutÃ´t que de prÃ©ciser comment sâ€™appellera notre nouveau cluster, il faut alors passer par la balise restore :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      restore:&#xD;&#xA;        enabled: true&#xD;&#xA;        repoName: repo1&#xD;&#xA;        options:&#xD;&#xA;        - --type=time&#xD;&#xA;        - --target=&amp;quot;2024-04-09 20:30:00-00&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici, comme prÃ©cÃ©demment, nous restaurons Ã  lâ€™heure de 20 :30 hier soir, et cela sur notre propre instance. Ne reste plus quâ€™Ã  lancer la restauration :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;kubectl annotate -n postgres-operator postgrescluster pgcluster1 --overwrite \ postgres-operator.crunchydata.com/pgbackrest-restore=&amp;quot;$(date)&amp;quot;&lt;/pre&gt;&#xA;&lt;p&gt;A noter quâ€™il ne faut pas oublier de dÃ©sactiver ensuite le restore en le passant Ã  false si vous ne souhaitez pas quâ€™il soit de nouveau Ã©crasÃ© au prochain changement de configuration.&lt;/p&gt;&#xA;&lt;h5&gt;10) Restaurer une base de donnÃ©es spÃ©cifique :&lt;/h5&gt;&#xA;&lt;p&gt;Si votre besoin est de restaurer une base de donnÃ©es spÃ©cifique plutÃ´t que lâ€™intÃ©gralitÃ© de lâ€™instance, vous pouvez le prÃ©ciser dans les paramÃ¨tres de votre restauration.&lt;br /&gt;&#xA;Attention cependant, ce nâ€™est pas une restauration comme le serais un pg_dump. Ici si vous restaurez simplement une seule base de donnÃ©es et pas le reste du cluster, les autres bases que vous nâ€™avez pas choisit de restaurer deviendront inaccessibles.&lt;br /&gt;&#xA;Si nous voulons restaurer une base de donnÃ©es, et uniquement elle, voici la procÃ©dure :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;backups:&#xD;&#xA;  pgbackrest:&#xD;&#xA;    restore:&#xD;&#xA;      enabled: true&#xD;&#xA;      repoName: repo1&#xD;&#xA;      options:&#xD;&#xA;        - --db-include=capdata&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici, on ne restaurera que la base de donnÃ©es capdata, et aucunes autres bases Ã  partir de notre repo1.&lt;/p&gt;&#xA;&lt;h3&gt;PgBouncer :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;PgBouncer est un pooler de connexion pour PostgreSQL. Un pooler de connexion permet de maintenir ouvertes des sessions entre lui-mÃªme et le serveur, ce qui rend plus rapide l&amp;#8217;ouverture de sessions depuis les clients, une application Web par exemple.&lt;br /&gt;&#xA;PgBouncer permet aussi de mutualiser les sessions dans le serveur, Ã©conomisant ainsi des ressources. PgBouncer propose plusieurs modes de partage : par requÃªte (default), par transaction ou par session.&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour ajouter un bouncer Ã  notre configuration câ€™est une rÃ©alitÃ© trÃ¨s simple. Il suffit dâ€™ajouter dans notre fichier postgres.yaml la rubrique proxy :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;proxy:&#xD;&#xA;  pgBouncer:&#xD;&#xA;    image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbouncer:ubi8-1.21-3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois que vous avez rajoutÃ© cela dans la configuration, il nâ€™y a plus quâ€™Ã  appliquer celle-ci :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; kubectl apply -k kustomize/keycloak &lt;/pre&gt;&#xA;&lt;p&gt;Quand PGO crÃ©Ã© un nouveau connexion pooler sur notre instance dÃ©ployÃ©e, il modifier le fichier secrets de lâ€™utilisateur.&lt;br /&gt;&#xA;On voit que plusieurs champs qui concerne pg_bouncer sont apparus. Ils constituent les informations qui vont vous permettre de vous connecter sur votre bouncer nouvellement crÃ©Ã© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;{&#xD;&#xA;    &amp;quot;apiVersion&amp;quot;: &amp;quot;v1&amp;quot;,&#xD;&#xA;    &amp;quot;data&amp;quot;: {&#xD;&#xA;        &amp;quot;dbname&amp;quot;: &amp;quot;cGdjbHVzdGVyMQ==&amp;quot;,&#xD;&#xA;        &amp;quot;host&amp;quot;: &amp;quot;cGdjbHVzdGVyMS1wcmltYXJ5LnBvc3RncmVzLW9wZXJhdG9yLnN2Yw==&amp;quot;,&#xD;&#xA;        &amp;quot;jdbc-uri&amp;quot;: &amp;quot;amRiYzpwb3N0Z3Jlc3FsOi8vcGdjbHVzdGVyMS1wcmltYXJ5LnBvc3RncmVzLW9wZXJhdG9yLnN2Yzo1NDMyL3BnY2x1c3RlcjE/cGFzc3dvcmQ9NXNSaSUzRCU1QmZZbSUzQ2lSSGslMkElNUIlM0VuWGhqaiU3Q1EmdXNlcj1wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;password&amp;quot;: &amp;quot;NXNSaT1bZlltPGlSSGsqWz5uWGhqanxR&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-host&amp;quot;: &amp;quot;cGdjbHVzdGVyMS1wZ2JvdW5jZXIucG9zdGdyZXMtb3BlcmF0b3Iuc3Zj&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-jdbc-uri&amp;quot;: &amp;quot;amRiYzpwb3N0Z3Jlc3FsOi8vcGdjbHVzdGVyMS1wZ2JvdW5jZXIucG9zdGdyZXMtb3BlcmF0b3Iuc3ZjOjU0MzIvcGdjbHVzdGVyMT9wYXNzd29yZD01c1JpJTNEJTVCZlltJTNDaVJIayUyQSU1QiUzRW5YaGpqJTdDUSZwcmVwYXJlVGhyZXNob2xkPTAmdXNlcj1wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-port&amp;quot;: &amp;quot;NTQzMg==&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-uri&amp;quot;: &amp;quot;cG9zdGdyZXNxbDovL3BnY2x1c3RlcjE6NXNSaT0lNUJmWW0lM0NpUkhrJTJBJTVCJTNFblhoamolN0NRQHBnY2x1c3RlcjEtcGdib3VuY2VyLnBvc3RncmVzLW9wZXJhdG9yLnN2Yzo1NDMyL3BnY2x1c3RlcjE=&amp;quot;,&#xD;&#xA;        &amp;quot;port&amp;quot;: &amp;quot;NTQzMg==&amp;quot;,&#xD;&#xA;        &amp;quot;uri&amp;quot;: &amp;quot;cG9zdGdyZXNxbDovL3BnY2x1c3RlcjE6NXNSaT0lNUJmWW0lM0NpUkhrJTJBJTVCJTNFblhoamolN0NRQHBnY2x1c3RlcjEtcHJpbWFyeS5wb3N0Z3Jlcy1vcGVyYXRvci5zdmM6NTQzMi9wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;user&amp;quot;: &amp;quot;cGdjbHVzdGVyMQ==&amp;quot;,&#xD;&#xA;        &amp;quot;verifier&amp;quot;: &amp;quot;U0NSQU0tU0hBLTI1NiQ0MDk2OlgyQ3NQRU1FZjh3QkVlc05McDFJTkE9PSRKcDhKakl5Q0o1ZEpFRVhia1ptUERTNE5rR3d0V00rczdrMElsQmx0YkpvPTpEaHg3VzNCOE5vNDRYSHJ1Qm1RdENMQW9jNEtnSUZQa2dIeStUMkVWUUowPQ==&amp;quot;&#xD;&#xA;    },&#xD;&#xA;    &amp;quot;kind&amp;quot;: &amp;quot;Secret&amp;quot;,&#xD;&#xA;    &amp;quot;metadata&amp;quot;: {&#xD;&#xA;        &amp;quot;creationTimestamp&amp;quot;: &amp;quot;2024-04-09T16:37:36Z&amp;quot;,&#xD;&#xA;        &amp;quot;labels&amp;quot;: {&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/cluster&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/pguser&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/role&amp;quot;: &amp;quot;pguser&amp;quot;&#xD;&#xA;        },&#xD;&#xA;        &amp;quot;name&amp;quot;: &amp;quot;pgcluster1-pguser-pgcluster1&amp;quot;,&#xD;&#xA;        &amp;quot;namespace&amp;quot;: &amp;quot;postgres-operator&amp;quot;,&#xD;&#xA;        &amp;quot;ownerReferences&amp;quot;: [&#xD;&#xA;            {&#xD;&#xA;                &amp;quot;apiVersion&amp;quot;: &amp;quot;postgres-operator.crunchydata.com/v1beta1&amp;quot;,&#xD;&#xA;                &amp;quot;blockOwnerDeletion&amp;quot;: true,&#xD;&#xA;                &amp;quot;controller&amp;quot;: true,&#xD;&#xA;                &amp;quot;kind&amp;quot;: &amp;quot;PostgresCluster&amp;quot;,&#xD;&#xA;                &amp;quot;name&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;                &amp;quot;uid&amp;quot;: &amp;quot;7260b882-116f-4b02-b51a-18d4fe3a8038&amp;quot;&#xD;&#xA;            }&#xD;&#xA;        ],&#xD;&#xA;        &amp;quot;resourceVersion&amp;quot;: &amp;quot;9495&amp;quot;,&#xD;&#xA;        &amp;quot;uid&amp;quot;: &amp;quot;1fbdf1d2-48ea-4a45-b7d6-01248317dbee&amp;quot;&#xD;&#xA;    },&#xD;&#xA;    &amp;quot;type&amp;quot;: &amp;quot;Opaque&amp;quot;&#xD;&#xA;}&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Pour se connecter Ã  notre pgbouncer, il suffit dâ€™utiliser les informations fournies par le fichier de secret Ã  la place de nos infos de connexion habituelles, et cela nous permet dâ€™accÃ©der directement au bouncer et non plus Ã  lâ€™instance elle-mÃªme.&lt;/p&gt;&#xA;&lt;p&gt;Cette connexion peut Ãªtre facilement modifiÃ©e en utilisant la documentation de pgbouncer afin de pouvoir configurer Ã  notre guise notre pgbouncer. Un exemple de configuration quâ€™on pourrais rencontrer serait :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;  proxy:&#xD;&#xA;    pgBouncer:&#xD;&#xA;      image: {{.Values.image.pgBouncer }}&#xD;&#xA;      config:&#xD;&#xA;        global:&#xD;&#xA;          default_pool_size: &amp;quot;100&amp;quot;&#xD;&#xA;          max_client_conn: &amp;quot;10000&amp;quot;&#xD;&#xA;          pool_mode: transaction&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Pour cet exemple on voit quâ€™on a dÃ©finit un nombre de client maximum, la taille du pool Ã  100 et un mode transaction pour notre pool.&lt;/p&gt;&#xA;&lt;h3&gt;PGO et Prometheus&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;Prometheus est une trousse Ã  outils de surveillance et d&amp;#8217;alerte des systÃ¨mes en open source.&lt;br /&gt;&#xA;Prometheus collecte et stocke ses mÃ©triques sous forme de donnÃ©es de sÃ©ries temporelles, c&amp;#8217;est-Ã -dire que les informations de mÃ©triques sont stockÃ©es avec le timestamp auquel elles ont Ã©tÃ© enregistrÃ©es, aux cÃ´tÃ©s de paires clÃ©-valeur optionnelles appelÃ©es labels.&lt;br /&gt;&#xA;&amp;#8211; Un modÃ¨le de donnÃ©es multidimensionnel avec des donnÃ©es de sÃ©ries temporelles identifiÃ©es par le nom de la mÃ©trique et des paires clÃ©-valeur&lt;br /&gt;&#xA;&amp;#8211; PromQL, un langage de requÃªte flexible pour exploiter cette dimensionnalitÃ©&lt;br /&gt;&#xA;&amp;#8211; Aucune dÃ©pendance sur le stockage distribuÃ© ; les nÅ“uds de serveur individuels sont autonomes&lt;br /&gt;&#xA;&amp;#8211; La collecte de sÃ©ries temporelles se fait via un modÃ¨le de tirage sur HTTP&lt;br /&gt;&#xA;&amp;#8211; La poussÃ©e de sÃ©ries temporelles est prise en charge via une passerelle intermÃ©diaire&lt;br /&gt;&#xA;&amp;#8211; Les cibles sont dÃ©couvertes via la dÃ©couverte de service ou la configuration statique&lt;br /&gt;&#xA;&amp;#8211; Prise en charge de plusieurs modes de graphiques et de tableaux de bord&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir mettre en place une surveillance pour notre cluster, il est plus simple de tÃ©lÃ©charger et complÃ©ter le modÃ¨le fournit dans les exemples de pgo.&lt;br /&gt;&#xA;Ainsi, on peut rÃ©cupÃ©rer les exemples Ã  lâ€™aide de git :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;YOUR_GITHUB_UN=&amp;quot;$YOUR_GITHUB_USERNAME&amp;quot;&#xD;&#xA;git clone --depth 1 &amp;quot;git@github.com:${YOUR_GITHUB_UN}/postgres-operator-examples.git&amp;quot;&#xD;&#xA;cd postgres-operator-examples&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Les diffÃ©rentes configurations se trouvent dans le dossier kustomize/monitoring.&lt;br /&gt;&#xA;Pour activer le monitoring de notre instance, il faut ajouter la balise monitoring Ã  notre fichier postgres.yaml :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;monitoring:&#xD;&#xA;  pgmonitor:&#xD;&#xA;    exporter:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres-exporter:ubi8-5.5.1-0&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois notre configuration modifiÃ©e, on lâ€™applique afin que PGO dÃ©tecte les changements et configure tout seul lâ€™exporter pour quâ€™il puisse se connecter Ã  nos bases de donnÃ©es et rÃ©cupÃ©rer les mÃ©triques.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;kubectl apply -k kustomize/postgres&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il faut ensuite appliquer la configuration de base de pgmonitor pour quâ€™il crÃ©Ã© lui-mÃªme les fichiers de configuration pour prometheus (il le fera en mÃªme temps pour Grafana et Alertmanager qui sont deux autres outils de surveillance). Pour cela on applique le kustomize prÃ©sent dans le dossier monitoring :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;$kubectl apply -k kustomize\postgres&#xD;&#xA;postgrescluster.postgres-operator.crunchydata.com/pgcluster1 configured&#xD;&#xA;$kubectl apply -k kustomize\monitoring&#xD;&#xA;serviceaccount/alertmanager created&#xD;&#xA;serviceaccount/grafana created&#xD;&#xA;serviceaccount/prometheus created&#xD;&#xA;clusterrole.rbac.authorization.k8s.io/prometheus created&#xD;&#xA;clusterrolebinding.rbac.authorization.k8s.io/prometheus created&#xD;&#xA;configmap/alert-rules-config created&#xD;&#xA;configmap/alertmanager-config created&#xD;&#xA;configmap/crunchy-prometheus created&#xD;&#xA;configmap/grafana-dashboards created&#xD;&#xA;configmap/grafana-datasources created&#xD;&#xA;secret/grafana-admin created&#xD;&#xA;service/crunchy-alertmanager created&#xD;&#xA;service/crunchy-grafana created&#xD;&#xA;service/crunchy-prometheus created&#xD;&#xA;persistentvolumeclaim/alertmanagerdata created&#xD;&#xA;persistentvolumeclaim/grafanadata created&#xD;&#xA;persistentvolumeclaim/prometheusdata created&#xD;&#xA;deployment.apps/crunchy-alertmanager created&#xD;&#xA;deployment.apps/crunchy-grafana created&#xD;&#xA;deployment.apps/crunchy-prometheus created&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos services ont Ã©tÃ© correctement dÃ©ployÃ©s, il ne nous reste plus quâ€™Ã  utiliser celui qui nous intÃ©resse, ici service/crunchy-prometheus et lui indiquer de commencer Ã  envoyer les informations sur notre prometheus :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;$kubectl -n postgres-operator port-forward service/crunchy-prometheus 9090:9090&#xD;&#xA;Forwarding from 127.0.0.1:9090 -&amp;gt; 9090&#xD;&#xA;Forwarding from [::1]:9090 -&amp;gt; 9090&#xD;&#xA;Handling connection for 9090&#xD;&#xA;Handling connection for 9090&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Afin dâ€™accÃ©der Ã  notre service prometheus, il ne nous reste plus quâ€™Ã  se connecter avec lâ€™adresse de notre machine, sur le port 9090 prÃ©alablement ouvert, pour voir apparaitre le dashboard de prometheus :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2.jpg&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10567&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-300x66.jpg&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;66&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-300x66.jpg 300w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-1024x226.jpg 1024w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-768x170.jpg 768w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2.jpg 1386w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3&gt;PGO Client :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir gÃ©rer plus facilement le cluster crÃ©Ã© par PGO, CrunchyData Ã  dÃ©veloppÃ© une surcouche Ã  kubectl qui permet de faciliter les commandes que nous pouvons rÃ©aliser sur le cluster.&lt;br /&gt;&#xA;Cela permet de ne pas avoir Ã  taper les longues lignes de commandes qui permettent par exemple de dÃ©marrer les sauvegardes unitaires.&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir installer cette surcouche, il faut tÃ©lÃ©charger la version qui correspond au systÃ¨me dâ€™exploitation Ã  partir du GIT de pgo client :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;# wget https://github.com/CrunchyData/postgres-operator-client/releases/download/v0.4.1/kubectl-pgo-linux-arm64&#xD;&#xA;--2024-04-11 12:07:45--  https://github.com/CrunchyData/postgres-operator-client/releases/download/v0.4.1/kubectl-pgo-linux-arm64&#xD;&#xA;Resolving github.com (github.com)... 140.82.121.4&#xD;&#xA;Connecting to github.com (github.com)|140.82.121.4|:443... connected.&#xD;&#xA;HTTP request sent, awaiting response... 302 Found&#xD;&#xA;Resolving objects.githubusercontent.com (objects.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.110.133, ...&#xD;&#xA;Connecting to objects.githubusercontent.com (objects.githubusercontent.com)|185.199.109.133|:443... connected.&#xD;&#xA;HTTP request sent, awaiting response... 200 OK&#xD;&#xA;Length: 47895849 (46M) [application/octet-stream]&#xD;&#xA;Saving to: â€˜kubectl-pgo-linux-arm64â€™&#xD;&#xA;&#xD;&#xA;kubectl-pgo-linux-arm64                                     100%[========================================================================================================================================&amp;gt;]  45.68M  --.-KB/s    in 0.1s&#xD;&#xA;&#xD;&#xA;2024-04-11 12:07:45 (373 MB/s) - â€˜kubectl-pgo-linux-arm64â€™ saved [47895849/47895849]&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On renome le fichier tÃ©lÃ©chargÃ© en kubectl-pgo et on le dÃ©place dans nos bin pour pouvoir les utiliser :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;# mv kubectl-pgo-linux-arm64 kubectl-pgo&#xD;&#xA;# sudo mv kubectl-pgo /usr/local/bin/kubectl-pgo&#xD;&#xA;# sudo chmod +x /usr/local/bin/kubectl-pgo&#xD;&#xA;Une fois que ces actions sont rÃ©alisÃ©es, on peut tester le fonctionnement :&#xD;&#xA;# kubectl pgo version&#xD;&#xA;Client Version: v0.4.1&#xD;&#xA;Operator Version: v5.5.1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Les commandes disponibles avec cette extension sont les suivantes :&lt;br /&gt;&#xA;&amp;#8211; backup : Backup cluster&lt;br /&gt;&#xA;&amp;#8211; create : Create a resource&lt;br /&gt;&#xA;&amp;#8211; delete : Delete a resource&lt;br /&gt;&#xA;&amp;#8211; help : Help about any command&lt;br /&gt;&#xA;&amp;#8211; restore : Restore cluster&lt;br /&gt;&#xA;&amp;#8211; show Show : PostgresCluster details&lt;br /&gt;&#xA;&amp;#8211; start : Start cluster&lt;br /&gt;&#xA;&amp;#8211; stop : Stop cluster&lt;br /&gt;&#xA;&amp;#8211; support : Crunchy Support commands for PGO&lt;br /&gt;&#xA;&amp;#8211; version : PGO client&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pgo-operateurs-kubernetes-pour-postgresql-la-suite/&#34; rel=&#34;bookmark&#34; title=&#34;6 juin 2023&#34;&gt;PGO : opÃ©rateurs kubernetes pour PostgreSQL, la suite !&lt;/a&gt; (David Baffaleuf) [ContainerDevopsPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/kubegres-loperateur-kubernetes-cle-en-main-pour-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;26 avril 2023&#34;&gt;Kubegres : l&amp;#8217;opÃ©rateur Kubernetes clÃ© en main pour PostgreSQL&lt;/a&gt; (David Baffaleuf) [ContainerDevopsPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-comparatif-entre-barman-et-pgbackrest/&#34; rel=&#34;bookmark&#34; title=&#34;4 fÃ©vrier 2020&#34;&gt;PostgreSQL : Comparatif entre Barman et pgBackRest&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-sur-la-solution-kubernetes-locale-minikube/&#34; rel=&#34;bookmark&#34; title=&#34;29 mars 2023&#34;&gt;PostgreSQL sur la solution Kubernetes locale Minikube&lt;/a&gt; (Emmanuel RAMI) [ContainerPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/sauvegardes-sql-server-dans-un-azure-blob-storage/&#34; rel=&#34;bookmark&#34; title=&#34;21 aoÃ»t 2018&#34;&gt;Sauvegardes SQL Server dans un Azure Blob Storage&lt;/a&gt; (Capdata team) [AzureSQL Server]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 4.362 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;title=PGO%20%3A%20la%20suite&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PGO%20%3A%20la%20suite&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34;&gt;PGO : la suite&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pgo-la-suite/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;La gestion efficace des clusters PostgreSQL dans un environnement Kubernetes est un dÃ©fi complexe auquel sont confrontÃ©es de nombreuses entreprises aujourd&amp;#8217;hui. PGO offre une solution dÃ©clarative qui automatise la gestion des clusters PostgreSQL, simplifiant ainsi le dÃ©ploiement, la mise Ã &amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34;&gt;PGO : la suite&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #121</title>
    <updated>2025-05-13T14:47:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-05-13:/blog/index.php/post/2025/04/13/PostgreSQL-Hebdo-121</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/04/13/PostgreSQL-Hebdo-121" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://kmoppel.github.io/2025-04-10-postgres-scaling-roadmap/&#34;&gt;A roadmap to scaling Postgres&lt;/a&gt;Â : Une liste complÃ¨te de concepts Ã  utiliser pour assurer une montÃ©e en charge de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://r.ena.to/blog/optimizing-postgres-table-layout-for-maximum-efficiency/&#34;&gt;Optimizing Postgres table layout for maximum efficiency&lt;/a&gt;Â : Une explication simple et claire Ã  propos de l&#39;alignement des types de donnÃ©esÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://tselai.com/all-databases-are-just-files&#34;&gt;(All) Databases Are Just Files. Postgres Too&lt;/a&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://cedardb.com/blog/postgres_compatibility/&#34;&gt;What It Takes to Be PostgreSQL Compatible&lt;/a&gt;Â : de nombreaux produits adoptent une compatibilitÃ© avec PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.danslimmon.com/2025/03/14/did-u-ever-read-so-hard-u-accidentally-wrote/&#34;&gt;did u ever read so hard u accidentally wrote?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-175-169-1513-1418-and-1321-released-3072/&#34;&gt;PostgreSQL 17.5, 16.9, 15.13, 14.18, and 13.21 Released!&lt;/a&gt;Â et en franÃ§ais &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-5/&#34;&gt;PostgreSQL 17.5 et autres correctifs&lt;/a&gt;Â Â : Ã  noter la fin de vie de PostgreSQL 13 en novembreÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;p&gt;Ã€Â venir dans PostgreSQL 18Â :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2025/05/05/waiting-for-postgresql-18-add-function-to-get-memory-context-stats-for-processes/&#34;&gt;Add function to get memory context stats for processes&lt;/a&gt;Â : interessant de pouvoir suivre l&#39;Ã©tat d&#39;un processus, cela dÃ©voile beaucoup d&#39;informations utileÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-18-beta-1-released-3070/&#34;&gt;PostgreSQL 18 Beta 1 Released!&lt;/a&gt; et en franÃ§ais &lt;a href=&#34;https://www.loxodata.com/post/postgresql-18-beta1/&#34;&gt;PostgreSQL 18 bÃªta 1&lt;/a&gt;Â : Ã  vos tests !&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #120</title>
    <updated>2025-02-21T15:20:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-02-21:/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.octo.com/7-things-a-developer-should-know-about-databases&#34;&gt;7 things a developer should know about databases&lt;/a&gt;Â : de prÃ©cieux conseils, Ã  lire attentivement et Ã  faire circuler auprÃ¨s de vos Ã©quipes !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.dalibo.com//2025/02/10/patchs_parallelisations_2.html&#34;&gt;La suite des patchs sur la parallÃ©lisation &lt;/a&gt;Â : Au-delÃ  du fond, qui est intÃ©ressant, câ€™est le point de vue sur le dÃ©veloppement de PostgreSQLÂ est mis en Ã©vidence, et cela permet de mieux comprendre cet aspect de la communautÃ© PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.loxodata.com/post/pgwatch3/&#34;&gt;pgwatch3&lt;/a&gt; : quelques explications sur la nouvelle version de l&#39;outil de supervision pgwatchÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.twilio.com/en-us/blog/sqlite-postgresql-complicated&#34;&gt;SQLite or PostgreSQL? It&#39;s Complicated!&lt;/a&gt; : comparatif de performances sur de vraies donnÃ©es !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/&#34;&gt;PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!&lt;/a&gt; et &lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-173-167-1511-1416-and-1319-released-3015/&#34;&gt;PostgreSQL 17.3, 16.7, 15.11, 14.16, and 13.19 Released!&lt;/a&gt; : mettez Ã  jour !&#xA;&lt;ul&gt;&#xA;&lt;li&gt;en franÃ§ais : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-4/&#34;&gt;PostgreSQL 17.4 et autres correctifs&lt;/a&gt; et  &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-3/&#34;&gt;PostgreSQL 17.3 et autres correctifs&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/end-of-the-road-for-postgresql-streaming-replication/&#34;&gt;End of the road for PostgreSQL streaming replication?&lt;/a&gt; : pourquoi il est difficile de parallÃ©liser le rejeu de la rÃ©plication dans une instance StandbyÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/enhanced-postgres-release-notes&#34;&gt;Enhanced Postgres Release Notes&lt;/a&gt; : trÃ¨s bonne idÃ©e, et gros travail : on trouve maintenant un lien vers le commit pour chacune des entrÃ©es des notes de publicationÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #119</title>
    <updated>2025-01-31T16:16:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-01-31:/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semaines :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2024/12/01/sql-best-practices-dont-compare-count-with-0/&#34;&gt;SQL best practices â€“ donâ€™t compare count(*) with 0&lt;/a&gt; : il n&#39;est pas utile de compter quelque chose alors qu&#39;on juste savoir s&#39;il existe ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://raymondtukpe.com/sql-nulls-are-weird.html&#34;&gt;SQL NULLs are Weird!&lt;/a&gt;Â : maÃ®triser cet aspect du SQL n&#39;est pas si Ã©vident, et pourtant fondamentalÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://notso.boringsql.com/posts/deletes-are-difficult/&#34;&gt;DELETEs are difficult&lt;/a&gt;: tout savoir sur l&#39;opÃ©ration DELETE ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.pgedge.com/blog/understanding-and-reducing-postgresql-replication-lag&#34;&gt;Understanding and Reducing PostgreSQL Replication Lag&lt;/a&gt; : le retard de rÃ©plication peut avoir de nombreux impacts, le mesurer et le maitriser est important ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://thebuild.com/blog/2025/01/28/vacuum-index_cleanup-off-considered-harmful/&#34;&gt;VACUUM (INDEX_CLEANUP OFF) Considered Harmful&lt;/a&gt; : attention aux options de commandes qui pourraient paraÃ®tre intÃ©ressantes au premier abordÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.binwang.me/2024-12-02-PostgreSQL-High-Availability-Solutions-Part-1.html&#34;&gt;Jepsen Test on Patroni: A PostgreSQL High Availability Solution&lt;/a&gt;Â : test trÃ¨s complet de PatroniÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rodoq.medium.com/are-all-your-update-useful-6b8d548085bf&#34;&gt;Are all your UPDATE useful ?&lt;/a&gt;Â : Vos UPDATE sont-ils toujours utiles ?&lt;/li&gt;&#xA;&lt;li&gt;Le projet PostgreSQL Ecosystem est maintenant public : &lt;a href=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34; title=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34;&gt;https://www.loxodata.com/post/pg-ec...&lt;/a&gt; et &lt;a href=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34; title=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34;&gt;https://pg-ecosystem.gitlab.io/pg-e...&lt;/a&gt;Â ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #118</title>
    <updated>2024-11-22T16:09:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-11-22:/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgversions.com/&#34; title=&#34;https://pgversions.com/&#34;&gt;https://pgversions.com/&lt;/a&gt;Â : outil permettant de connaitre les diffÃ©rences entre une version mineure et l&#39;Ã©tat actuel de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgpedia.info/blog/index.html&#34; title=&#34;https://pgpedia.info/blog/index.html&#34;&gt;https://pgpedia.info/blog/index.htm...&lt;/a&gt;Â : blog rÃ©sumant l&#39;activitÃ© de dÃ©veloppement de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rhaas.blogspot.com/2024/11/why-pgdump-is-amazing.html&#34;&gt;Why pg_dump Is Amazing&lt;/a&gt;Â : oui, pg_dump est un bon outil, trÃ¨s utile, qu&#39;il faut maitriserÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://databaserookies.wordpress.com/2024/11/02/plpgsql-how-conditional-expressions-are-evaluated/&#34;&gt;PL/pgSQL Secrets: How Conditional Expressions Are Parsed and Evaluated Under the Hood.&lt;/a&gt;Â : ou on comprend qu&#39;un IF est en fait un SELECTÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Publication de PostgreSQL 17.2Â : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34; title=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34;&gt;https://www.loxodata.com/post/postg...&lt;/a&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/a-change-to-relresultinfo-a-near-miss-with-postgres-17-1&#34;&gt;A change to ResultRelInfo - A Near Miss with Postgres 17.1&lt;/a&gt;Â : retour sur un petit couac&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://challahscript.com/what_i_wish_someone_told_me_about_postgres&#34;&gt;What I Wish Someone Told Me About Postgres&lt;/a&gt;Â : le plein de bonnes idÃ©es Ã  retenirÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://stormatics.tech/blogs/scenarios-that-trigger-autovacuum-in-postgresql&#34;&gt;Scenarios That Trigger Autovacuum in PostgreSQL&lt;/a&gt;Â : article assez complet sur le fonctionnement d&#39;autovacuum.&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #117</title>
    <updated>2024-10-31T16:00:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-10-31:/blog/index.php/post/2024/31/10/PostgreSQL-Hebdo-117</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/31/10/PostgreSQL-Hebdo-117" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rhaas.blogspot.com/2024/10/is-pgdump-backup-tool.html&#34;&gt;Is pg_dump a Backup Tool?&lt;/a&gt;Â : la sauvegarde, et la restauration des donnÃ©es, et en rÃ©alitÃ© un processus, et non pas juste un problÃ¨me d&#39;outil. pg_dump est un outil qui peut faire partie du processus de sauvegarde/restauration, et Ã§a peut-Ãªtre utile pour BACK UP, c&#39;est-Ã -dire revenir dans un Ã©tat normalÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-17-released-2936/&#34;&gt;PostgreSQL 17 Released!&lt;/a&gt; : Publication de PostgreSQL 17.0 ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/whats-so-great-about-postgresql-v17/&#34;&gt;What&#39;s so great about PostgreSQL v17?&lt;/a&gt;Â : aperÃ§u de quelques fonctionnalitÃ©s de PostgreSQL 17Â ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://dev.to/lifen/as-rails-developers-why-we-are-excited-about-postgresql-17-27nj&#34;&gt;As Rails developers, why we are excited about PostgreSQL 17 &lt;/a&gt;Â : PostgreSQL 17 du point de vue d&#39;un dÃ©veloppeur RailsÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://notso.boringsql.com/posts/custom-postgresql-extensions-with-rust/&#34;&gt;Custom PostgreSQL extensions with Rust&lt;/a&gt;Â : comment faire une extension PostgreSQL en RustÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://danolivo.substack.com/p/7456653e-9716-4e91-ad09-83737784c665&#34;&gt;PostgreSQL &#39;VALUES -&amp;gt; ANY&#39; transformation&lt;/a&gt;Â : Ã  propos de l&#39;adaptation du Planner aux requÃªtes des utilisateursÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://amitkapila16.blogspot.com/2024/09/online-upgrading-logical-and-physical.html?m=1&#34;&gt;Online Upgrading Logical and Physical Replication Nodes&lt;/a&gt;Â : Ã  propos de la rÃ©plication logique lors d&#39;une mise Ã  jour majeureÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2024/10/29/new-way-to-search-postgresql-documentation/&#34;&gt;New way to search PostgreSQL documentation&lt;/a&gt;Â : un prompt simple pour rechercher dans la documentation de PostgreSQL, Ã  mettre dans ses bookmarksÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #116</title>
    <updated>2024-09-09T14:06:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-09-09:/blog/index.php/post/2024/09/09/PostgreSQL-Hebdo-116</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/09/09/PostgreSQL-Hebdo-116" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://begriffs.com/posts/2018-03-20-user-defined-order.html&#34;&gt;User-defined Order in SQL&lt;/a&gt;Â : Ordonner les informations, c&#39;est souvent adopter un certain point de vue, et cette dÃ©marche fait partie de la modÃ©lisation des donnÃ©esÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://mccue.dev/pages/8-16-24-just-use-postgres&#34;&gt;Just use Postgres&lt;/a&gt;Â : passage en revue des alternatives Ã  PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/pulse/do-you-still-need-pgbadger-youre-using-grafana-alicja-kucharczyk-cgfmf&#34;&gt;Do you still need pgBadger if youâ€™re using Grafana?&lt;/a&gt;Â : Grafana ne remplace pas complÃ¨tement un rapport pgBadger, dans lequel on trouve de nombreuses informations utiles Ã  la comprÃ©hension du fonctionnement d&#39;une instance PostgreSQL ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/pulse/not-so-good-idea-pipe-syntax-sql-franck-pachot-dx6he/&#34;&gt;&lt;/a&gt;Â : De la faÃ§on dont le language SQL s&#39;Ã©crit, ou pourquoi on manipule des ensembles et non pas des fluxÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/cybertec-postgresql/pgwatch&#34; title=&#34;https://github.com/cybertec-postgresql/pgwatch&#34;&gt;https://github.com/cybertec-postgre...&lt;/a&gt; la prochaine version de PgWatch poursuit son dÃ©veloppement avec la version 3.0 beta4&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://dataegret.com/2024/08/handling_cancellation_request/&#34;&gt;Handling Cancellation Request&lt;/a&gt;Â : Comment annuler correctement une requÃªte, depuis l&#39;application client, vers un cluster PostgreSQL avec le gestionnaire de connexions PgBouncerÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.shayon.dev/post/2024/225/stop-relying-on-if-not-exists-for-concurrent-index-creation-in-postgresql/&#34;&gt;Stop Relying on IF NOT EXISTS for Concurrent Index Creation in PostgreSQL&lt;/a&gt;Â : Ã  propos d&#39;index invalide et de crÃ©ation conditionelleÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://anyblockers.com/posts/postgres-as-a-search-engine&#34;&gt;Postgres as a search engine&lt;/a&gt;Â : Peut-on utiliser PostgreSQL comme moteur de recherche ?&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://okbob.blogspot.com/2024/09/how-to-get-info-about-relations-between.html?m=1&#34;&gt;How to get info about relations between system tables?&lt;/a&gt;Â : Ã  propos des liens internes du catalogueÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-17-rc1-released-2926/&#34;&gt;PostgreSQL 17 RC1 Released!&lt;/a&gt;Â  (et en franÃ§ais : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-rc1/&#34; title=&#34;https://www.loxodata.com/post/postgresql-17-rc1/&#34;&gt;https://www.loxodata.com/post/postg...&lt;/a&gt;)Â : la date prÃ©vue pour PostgreSQL 17.0 est le 26 septembreÂ !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/patroni/patroni/blob/master/docs/releases.rst#version-401&#34;&gt;Patroni 4.0&lt;/a&gt;Â : nouvelle version de l&#39;outil de gestion de la haute disponibilitÃ©, avec quelques ruptures de compatibilitÃ©Â ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>Index &#34;Skip Scan&#34; avec PostgreSQL 18</title>
    <updated>2025-04-06T10:30:00Z</updated>
    <id>tag:pgphil.ovh,2025-04-06:/index_composite_18_01.php</id>
    <link href="https://pgphil.ovh/index_composite_18_01.php" rel="alternate"></link>
    <summary type="html">Mise Ã  jour de la page sur les index composites et les requÃªtes dont la clause de filtrage comprend des colonnes de l&#39;index mais pas la premiÃ¨re colonne. PostgreSQL 18 est Ã  prÃ©sent capable d&#39;effectuer des &#34;skip scan&#34;, de sauter la premiÃ¨re colonne et de tirer parti bien plus efficacement de l&#39;index composite b-tree dans certains cas.</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Mesurer facilement la latence I/O avec PostgreSQL 16</title>
    <updated>2023-09-02T16:30:00Z</updated>
    <id>tag:pgphil.ovh,2023-09-02:/traqueur_16_01.php</id>
    <link href="http://pgphil.ovh/traqueur_16_01.php" rel="alternate"></link>
    <summary type="html">DÃ©monstration avec le traqueur d&#39;une nouvelle fonctionnalitÃ© PostgreSQL 16 facilitant le suivi des performances et le diagnostic des ralentissements</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Mettre Ã  jour PostgreSQL pour amÃ©liorer les performances</title>
    <updated>2023-05-21T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-05-21:/migration_performance_14_15_01.php</id>
    <link href="http://pgphil.ovh/migration_performance_14_15_01.php" rel="alternate"></link>
    <summary type="html">Pagination, ex aequo...obtenez vos rÃ©sultats triÃ©s bien plus rapidement avec PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL inspire les autres SGBD ?</title>
    <updated>2023-04-12T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-04-12:/oracle23c_ou_oracle23p_comme_postgresql.php</id>
    <link href="http://pgphil.ovh/oracle23c_ou_oracle23p_comme_postgresql.php" rel="alternate"></link>
    <summary type="html">Oracle 23c ou 23p comme PostgreSQL ?</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>CYCLE</title>
    <updated>2022-12-03T15:00:00Z</updated>
    <id>tag:pgphil.ovh,2022-12-03:/nocycle_15_01.php</id>
    <link href="http://pgphil.ovh/nocycle_15_01.php" rel="alternate"></link>
    <summary type="html">NouveautÃ©s autour des requÃªtes hiÃ©rarchiques avec PostgreSQL 14 et versions supÃ©rieures</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>MERGE</title>
    <updated>2022-03-29T17:30:00Z</updated>
    <id>tag:pgphil.ovh,2022-03-29:/upsert_15_devel_01.php</id>
    <link href="http://pgphil.ovh/upsert_15_devel_01.php" rel="alternate"></link>
    <summary type="html">Introduction de la commande MERGE par PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQLâ€¦ Pythonâ€¦ Ã§a fait PL/Python !</title>
    <updated>2025-02-15T19:00:00Z</updated>
    <id>tag:blog.arthurbazin.com,2025-02-15:/programmation/postgresql-python-ca-fait-pl-python</id>
    <content type="html">&#xA;&lt;p&gt;Imaginez, vous utilisez PostgreSQL au quotidien pour stocker et traiter vos donnÃ©es. Comme vous Ãªtes curieux, vous avez essayÃ© Python pour faire quelques traitements et vous vous Ãªtes rendus compte que c&amp;rsquo;Ã©tait pas mal quand mÃªme&amp;#8230; Malheureusement vos scripts sont complÃ¨tement dissociÃ©s de la base de donnÃ©es et vous vous dites qu&amp;rsquo;il serait pratique que ces scripts soient directement pilotÃ©s depuis PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Et bien vous pouvez mÃ©langer les deux technologies grÃ¢ce au PL/Python. Â«Â SorcellerieÂ Â» me direz-vous&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;blockquote class=&#34;wp-block-quote is-layout-flow wp-block-quote-is-layout-flow&#34;&gt;&#xA;&lt;p&gt;Si, si, c&amp;rsquo;est possible !&lt;/p&gt;&#xA;&lt;cite&gt;Hassan Cehef &amp;#8211; Les Nuls&lt;/cite&gt;&lt;/blockquote&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le PL/Python est un langage de PostgreSQL permettant d&amp;rsquo;Ã©crire des fonctions en langage Python directement au sein d&amp;rsquo;une base de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;il s&amp;rsquo;agit d&amp;rsquo;une langage dit Â«Â untrustedÂ Â» (Â«Â sans confianceÂ Â») car il permet de faire tout et n&amp;rsquo;importe quoi (comme modifier des fichiers sur le serveur par exemple). C&amp;rsquo;est pour cela que seul un superutilisateur peut crÃ©er des fonctions avec ce langage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Introduction&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cet article prÃ©suppose que vous avez dÃ©jÃ  utilisÃ© Python et PostgreSQL et que vous possÃ©dez une version de Python sur votre machine en parallÃ¨le d&amp;rsquo;une installation de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devez par ailleurs avoir des notions sur les variables d&amp;rsquo;environnement et le fonctionnement des services.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Installation du langage&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Linux, il faut installer le package en lien avec l&amp;rsquo;extension : &lt;code&gt;postgresql-plpythonY-Z&lt;/code&gt; (avec &lt;code&gt;Y&lt;/code&gt; = 3 pour Python 3.X et &lt;code&gt;Z&lt;/code&gt; = version de PostgreSQL). Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bash&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo apt install postgresql-plpython3-16&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, le PL/Python est prÃ©installÃ© avec PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de lancer la requÃªte suivante pour l&amp;rsquo;activer :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE EXTENSION plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant utiliser le PL/Python pour vos fonctions et procÃ©dures. Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DO &#xA;$function$&#xA;&#xA;&#x9;import sys&#xA;&#x9;plpy.notice(sys.version)&#xA;&#xA;$function$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce bloc de code anonyme (oui, il n&amp;rsquo;est pas encapsulÃ© dans une fonction ou un procÃ©dure) ne retourne rien mais un message contenant la version de Python utilisÃ© est renvoyÃ© dans la sortie console.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Fonctionnement&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si l&amp;rsquo;Ã©tape prÃ©cÃ©dente a fonctionnÃ© du premier coup, fÃ©licitation ! Sinon, cette partie devrait vous aider.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Version de Python&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, PostgreSQL est compatible avec une version spÃ©cifique de Python qui est dÃ©finie lors de sa compilation. Cette information est disponible dans les notes d&amp;rsquo;installations prÃ©sentes dans &lt;em&gt;C:\Emplacement\de\PostgreSQL\XX\doc\installation-notes.html&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un tableau rÃ©sumant la compatibilitÃ© avec l&amp;rsquo;installeur PostgreSQL fournit par EDB.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Version de PostgreSQL&lt;/th&gt;&lt;th&gt;Version de Python compatible&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 17&lt;/td&gt;&lt;td&gt;Python 3.13.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 16&lt;/td&gt;&lt;td&gt;Python 3.12.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 15&lt;/td&gt;&lt;td&gt;Python 3.11.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 14&lt;/td&gt;&lt;td&gt;Python 3.9.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 13&lt;/td&gt;&lt;td&gt;Python 3.8.x&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PostgreSQL 12 et avant&lt;/td&gt;&lt;td&gt;Python 2.7&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Tableau issu du site : &lt;a href=&#34;https://postgresapp.com/documentation/plpython.html&#34; data-type=&#34;link&#34; data-id=&#34;https://postgresapp.com/documentation/plpython.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;postgresapp.com&lt;/a&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Linux, je n&amp;rsquo;ai pas explicitement trouvÃ© l&amp;rsquo;information mais il semble que le tableau prÃ©cÃ©dent soit valable (en tout cas d&amp;rsquo;aprÃ¨s mes quelques tests c&amp;rsquo;est le cas).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si vous n&amp;rsquo;utilisez pas la bonne version de Python, PostgreSQL vous renverra un message d&amp;rsquo;erreur de ce type lors de lâ€™exÃ©cution d&amp;rsquo;une procÃ©dure Python :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SQL Error [58P01]: ERREUR: n&#39;a pas pu charger la bibliothÃ¨que Â« C:/Program Files/PostgreSQL/16/lib/plpython3.dll Â» : The specified module could not be found.&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Choix de l&amp;rsquo;interprÃ©teur&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;exÃ©cution du code Python se fait au travers d&amp;rsquo;un interprÃ©teur. Pour cela, PostgreSQL utilise l&amp;rsquo;interprÃ©teur disponible Â«Â par dÃ©fautÂ Â» sur la machine et donc celui disponible Ã  travers la variable d&amp;rsquo;environnement &lt;code&gt;PATH&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;DÃ©finir un autre interprÃ©teur n&amp;rsquo;est pas simple&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur Linux, c&amp;rsquo;est l&amp;rsquo;installation d&amp;rsquo;une version de Python autre que celle fourni par dÃ©faut, qui est complexe ; il faut en gÃ©nÃ©ral compiler l&amp;rsquo;interprÃ©teur. En revanche il est relativement simple de redÃ©finir la variable &lt;code&gt;PATH&lt;/code&gt; directement dans la configuration du service (&lt;a href=&#34;https://serverfault.com/a/413408&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©crit ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sous Windows, c&amp;rsquo;est l&amp;rsquo;inverse&amp;#8230; DiffÃ©rentes versions de Python peuvent Ãªtre installÃ©es trÃ¨s facilement mais la redÃ©finition de la variable &lt;code&gt;PATH&lt;/code&gt; pour un service spÃ©cifique est relativement complexe (mais &lt;a href=&#34;https://serverfault.com/a/1103091&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©crite ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En lien avec le sujet, voici &lt;a href=&#34;https://stackoverflow.com/questions/67852675/postgresql-13-python-3-7-9-plpython3u-psql-server-closed-the-connection-u&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;un thread stackoverflow&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation de modules et environnements&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous aurez trÃ¨s probablement besoin d&amp;rsquo;installer des modules. Il est peu recommandÃ© de le faire directement dans l&amp;rsquo;environnement Python de base et il vaut mieux utiliser des environnements spÃ©cifiques Ã  chaque projet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il en est de mÃªme pour PostgreSQL, vous pouvez crÃ©er et utiliser des environnements pour vos projets.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela il faut utiliser le module &lt;code&gt;virtualenv&lt;/code&gt; car l&amp;rsquo;activation d&amp;rsquo;un environnement peut Ãªtre fait directement depuis Python avec cet outil :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bash&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;pip install virtualenv&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devez ensuite crÃ©er votre environnement dans un dossier spÃ©cifique. Vous pouvez crÃ©er un rÃ©pertoire spÃ©cifique dans l&amp;rsquo;installation de PostgreSQL par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;virtualenv &#34;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ensuite accÃ©der Ã  cet environnement et y installer tous les modules souhaitÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement\Scripts\activate.bat&#34;&#xA;pip install geopandas&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme ce n&amp;rsquo;est pas vous mais le service qui contrÃ´le le dÃ©marrage de PostgreSQL, il ne vous ai pas possible de dÃ©marrer l&amp;rsquo;environnement avant PostgreSQL (encore que en modifiant le service mais ce n&amp;rsquo;est pas des plus simple). Nous allons donc crÃ©er une fonction en PL/Python permettant de dÃ©marrer l&amp;rsquo;environnement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE OR REPLACE PROCEDURE py_activate_venv(venv text)&#xA;RETURNS boolean AS&#xA;$BODY$&#xA;&#x9;import os&#xA;&#x9;import sys&#xA;&#xA;&#x9;if sys.platform in (&#39;win32&#39;, &#39;win64&#39;, &#39;cygwin&#39;):&#xA;&#x9;&#x9;activate_this = os.path.join(venv, &#39;Scripts&#39;, &#39;activate_this.py&#39;)&#xA;&#x9;else:&#xA;&#x9;&#x9;activate_this = os.path.join(venv, &#39;bin&#39;, &#39;activate_this.py&#39;)&#xA;&#xA;&#x9;try:&#xA;&#x9;&#x9;exec(open(activate_this).read(), dict(__file__=activate_this))&#xA;&#x9;except FileNotFoundError:&#xA;&#x9;&#x9;plpy.error(&#39;Virtual environment {} does not exist.&#39;.format(name))&#xA;&#x9;&#xA;&#x9;return True&#xA;$BODY$&#xA;LANGUAGE plpython3u&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour activer l&amp;rsquo;environnement, il suffit de lancer la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT py_activate_venv(&#39;C:\Program Files\PostgreSQL\16\envs_python\mon_environnement&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour aller plus loin, vous pouvez utiliser ce superbe projet GitHub qui automatise toute la gestion des environnements sous Python :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-16018d1d wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/dpage/plpy_venv&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;GitHub &amp;#8211; plpy_venv&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Module plpy&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le langage PL/Python apporte un module python automatiquement chargÃ© : &lt;code&gt;plpy&lt;/code&gt; qui apporte quelques fonctions utiles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fonctions&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour retourner des message, utilisez les fonctions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;plpy.debug(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.log(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.info(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.notice(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.warning(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.error(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.fatal(msg, **kwargs)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les arguments suivants peuvent Ãªtre utilisÃ©s pour ajouter des informations de contexte au message renvoyÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;detail&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;hint&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;sqlstate&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;schema_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;table_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;column_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;datatype_name&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;constraint_name&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour exÃ©cuter une requÃªte SQL au sein de la base de donnÃ©es, utilisez &lt;code&gt;plpy.execute(&#34;query&#34; [, limit])&lt;/code&gt; avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;query&lt;/code&gt; : la requÃªte.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;limit&lt;/code&gt; : un entier permettant de limiter le nombre de rÃ©sultat.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;objet rÃ©sultant est une liste (les lignes) de dictionnaires (ensemble de colonnes). Par exemple pour renvoyer une colonne de la 4Ã¨me ligne :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;result = plpy.execute(&#34;SELECT * FROM ma_table&#34;, 25)&#xA;return result[4][&#34;ma_colonne&#34;]&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe trois fonctions Ã©quivalentes Ã  leurs homonyme au sein de PostgreSQL : &lt;code&gt;plpy.quote_literal(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt;, &lt;code&gt;plpy.quote_nullable(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt; et &lt;code&gt;plpy.quote_ident(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Gestion des erreurs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions &lt;code&gt;plpy.execute&lt;/code&gt; et &lt;code&gt;plpy.cursor&lt;/code&gt; (non dÃ©crite dans cet article), renvoient une exception dans le cas oÃ¹ la requÃªte SQL passÃ©e en argument Ã©choue. L&amp;rsquo;exception est une instance de la classe &lt;code&gt;plpy.SPIError&lt;/code&gt; qui peut Ãªtre rÃ©cupÃ©rÃ©e via la construction &lt;code&gt;try&lt;/code&gt;/&lt;code&gt;except&lt;/code&gt;. Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE FUNCTION test_plpython() &#xA;RETURNS text AS &#xA;$BODY$&#xA;&#xA;    try:&#xA;        plpy.execute(&#34;UPDATE ma_table SET &#34;ma_colonne&#34; = 12&#34;)&#xA;&#xA;    except plpy.SPIError:&#xA;        return &#34;La mise Ã  jour a Ã©chouÃ©e&#34;&#xA;&#xA;    else:&#xA;        return &#34;La mise Ã  jour a fonctionnÃ©e&#34;&#xA;&#xA;$BODY$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible de cibler une erreur spÃ©cifique retournÃ©e par PostgreSQL. Pour cela, vous pouvez vÃ©rifier la valeur de l&amp;rsquo;attribut &lt;code&gt;sqlstate&lt;/code&gt; de la classe &lt;code&gt;SPIError&lt;/code&gt; ou utiliser le module &lt;code&gt;plpy.spiexceptions&lt;/code&gt; qui dÃ©finit une classe d&amp;rsquo;exception pour chaque condition PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour spÃ©cifier une erreur avec &lt;code&gt;spiexception&lt;/code&gt;, il suffit de se rÃ©fÃ©rer Ã  &lt;a href=&#34;https://www.postgresql.org/docs/current/errcodes-appendix.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;la liste des erreurs de PostgreSQL&lt;/a&gt; et de convertir le nom de l&amp;rsquo;erreur comme suivant : retirer les soulignÃ©s (Â«Â _Â Â») + mettre en majuscule la premiÃ¨re lettre de chaque mot. Ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;privilege_not_granted&lt;/code&gt; devient &lt;code&gt;PrivilegeNotGranted&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;data_exception&lt;/code&gt; devient &lt;code&gt;DataException&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;division_by_zero&lt;/code&gt; devient &lt;code&gt;DivisionByZero&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour attraper une erreur spÃ©cifique il suffit d&amp;rsquo;utiliser la syntaxe suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE FUNCTION test_plpython() &#xA;RETURNS text AS &#xA;$BODY$&#xA;&#xA;    try:&#xA;        plpy.execute(&#34;UPDATE ma_table SET &#34;ma_colonne&#34; = 12&#34;)&#xA;&#xA;    except plpy.spiexceptions.UniqueViolation:&#xA;        return &#34;La mise Ã  jour a Ã©chouÃ©e en raison d&#39;une erreur d&#39;unicitÃ©&#34;&#xA;&#xA;    except plpy.SPIError as e:&#xA;        return &#34;Une erreur s&#39;est produite : SQLSTATE %s&#34; % e.sqlstate&#xA;&#xA;    else:&#xA;        return &#34;La mise Ã  jour a fonctionnÃ©e&#34;&#xA;&#xA;$BODY$&#xA;LANGUAGE plpython3u;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Gestion des transactions&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lâ€™exÃ©cution d&amp;rsquo;une fonction en PL/Python se fait toujours au sein d&amp;rsquo;une transaction. Ainsi, lorsqu&amp;rsquo;une requÃªte est exÃ©cutÃ©e via &lt;code&gt;plpy.execute&lt;/code&gt;, une sous-transaction est automatiquement dÃ©marrÃ©e. Il devient alors possible de contrÃ´ler l&amp;rsquo;issue de cette sous-transaction via les fonctions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;plpy.commit()&lt;/code&gt; : valider la sous-transaction&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;plpy.rollback()&lt;/code&gt; : annuler la sous-transaction&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;AprÃ¨s la fin d&amp;rsquo;une sous-transaction, une nouvelle sous-transaction est automatiquement dÃ©marrÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas oÃ¹ plusieurs requÃªtes doivent Ãªtre exÃ©cutÃ©es et que l&amp;rsquo;intÃ©gralitÃ© de ces requÃªtes doivent Ãªtre validÃ©es ou non, il est possible de dÃ©marrer une sous-transaction grÃ¢ce Ã   &lt;code&gt;plpy.subtransaction()&lt;/code&gt;. Pour cela, il faudra l&amp;rsquo;utiliser de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;with plpy.subtransaction():&#xA;  plpy.execute(&#34;DELETE FROM ma_table WHERE colonne = &#39;xxx&#39;&#34;)&#xA;  plpy.execute(&#34;INSERT INTO autre_table (col_1, col_2) VALUES (&#39;valeur1&#39;, &#39;valeur2&#39;)&#34;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;une erreur lors de l&amp;rsquo;une des requÃªte entraine donc l&amp;rsquo;annulation de l&amp;rsquo;ensemble des requÃªtes de la sous-transaction mais engendre Ã©galement une exception qui stoppera lâ€™exÃ©cution de la fonction et annulera la transaction en cours. Pour limiter la propagation de l&amp;rsquo;exception, il est possible d&amp;rsquo;encapsuler le tout au sein d&amp;rsquo;un &lt;code&gt;try&lt;/code&gt;/&lt;code&gt;catch&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;python&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;try:&#xA;  with plpy.subtransaction():&#xA;    plpy.execute(&#34;DELETE FROM ma_table WHERE colonne = &#39;xxx&#39;&#34;)&#xA;    plpy.execute(&#34;INSERT INTO autre_table (col_1, col_2) VALUES (&#39;valeur1&#39;, &#39;valeur2&#39;)&#34;)&#xA;except plpy.SPIError as e:&#xA;  result = &#34;Erreur de requÃªte : %s&#34; % e.args&#xA;else:&#xA;  result = &#34;OpÃ©ration effectuÃ©e&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour allez plus loin&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lq &lt;a href=&#34;https://www.postgresql.org/docs/current/plpython.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentation de PostgreSQL sur le langage PL/Python&lt;/a&gt; vous permettra d&amp;rsquo;approfondir le sujet maintenant que vous avez les Ã©lÃ©ments clÃ©s en main.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/programmation/postgresql-python-ca-fait-pl-python" rel="alternate"></link>
    <summary type="html">Imaginez, vous utilisez PostgreSQL au quotidien pour stocker et traiter vos donnÃ©es. Comme vous Ãªtes curieux, vous avez essayÃ© Python pour faire quelques traitements et vous vous Ãªtes rendus compte que c&amp;#8217;Ã©tait pas mal quand mÃªme&amp;#8230; Malheureusement vos scripts sont complÃ¨tement dissociÃ©s de la base de donnÃ©es et vous vous dites qu&amp;#8217;il serait pratique que [&amp;#8230;]</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Soyons prÃ©cis avec PostGIS</title>
    <updated>2025-02-09T20:26:53Z</updated>
    <id>tag:blog.arthurbazin.com,2025-02-09:/bdd/postgresql/soyons-precis-avec-postgis</id>
    <content type="html">&#xA;&lt;p&gt;Vous Ãªtes vous dÃ©jÃ  demandÃ© quelle Ã©tait la prÃ©cision de PostGIS ? Moi oui&amp;#8230; Alors Ã©tudions cela ensemble.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La documentation de PostGIS n&amp;rsquo;est pas trÃ¨s claire sur la question de la prÃ©cision mais il faut savoir que toutes les coordonnÃ©es sont stockÃ©es sous forme d&amp;rsquo;entiers Ã  virgule flottante en double prÃ©cision. La prÃ©cision de PostGIS est donc liÃ©e Ã  ce format de stockage des numÃ©riques.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Virgule flottante et double prÃ©cision&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce paragraphe est une simplification de la norme IEEE 754 pour vous aidez Ã  comprendre le fonctionnement des nombres Ã  virgules flottantes en double precision. Des imprÃ©cisions sont donc volontairement prÃ©sentes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La &lt;strong&gt;virgule flottante&lt;/strong&gt; est une mÃ©thode de reprÃ©sentation d&amp;rsquo;un nombre en informatique qui s&amp;rsquo;apparente Ã  la notation scientifique (par exemple &lt;code&gt;1,234 * 10&lt;sup&gt;123&lt;/sup&gt;&lt;/code&gt;). Elle repose ainsi sur les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;un signe : + ou -.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une mantisse : une valeur binaire qui dÃ©finie une fraction entre 0 et 1.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une base : un nombre entier (par exemple 2 ou 10).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un exposant : un nombre entier.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On obtient la valeur finale grÃ¢ce Ã  l&amp;rsquo;opÃ©ration suivante : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;signe * 1,mantisse * base&lt;sup&gt;exposant&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quand on parle de &lt;strong&gt;double prÃ©cision&lt;/strong&gt;, on fait alors rÃ©fÃ©rence Ã  un format particulier de nombre Ã  virgule flottante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;encodage se fait sur 64 bits :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1 bit pour le signe (&lt;code&gt;0&lt;/code&gt; = &lt;code&gt;+&lt;/code&gt; et &lt;code&gt;1&lt;/code&gt; = &lt;code&gt;-&lt;/code&gt;)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;11 bits pour l&amp;rsquo;exposant&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;53 bits pour la mantisse dont :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1 bit pour le dÃ©calage (voir le paragraphe sur la dÃ©normalisation)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;52 bits pour la valeur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La base est 2 car le stockage se fait sous forme binaire.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;exposant est dÃ©calÃ©, par convention on ajoute 1023 a sa valeur rÃ©elle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le calcul d&amp;rsquo;un nombre en double prÃ©cision est alors le suivant :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (1 + mantisse) * 2&lt;sup&gt;exposant-1023&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Dans le cas d&amp;rsquo;un nombre dÃ©normalisÃ© (voir le paragraphe dÃ©diÃ©), le calcul est le suivant :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (0 + mantisse) * 2&lt;sup&gt;1-1023&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * 0,mantisse * 2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Exposant&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;exposant est codÃ© sur 11 bits ce qui permet les valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;0&lt;/code&gt; : &lt;code&gt;00000000000&lt;/code&gt; : valeur minimum&lt;br&gt;Valeur spÃ©cifique rÃ©servÃ©e pour reprÃ©senter le 0 ou un nombre dÃ©normalisÃ© (voir plus bas).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;1&lt;/code&gt; : &lt;code&gt;00000000001&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2046&lt;/code&gt; : &lt;code&gt;11111111110&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2047&lt;/code&gt; : &lt;code&gt;11111111111&lt;/code&gt; : valeur maximum&lt;br&gt;Valeur spÃ©cifique rÃ©servÃ©e pour reprÃ©sentÃ© les valeurs &lt;code&gt;infini&lt;/code&gt; ou &lt;code&gt;NaN&lt;/code&gt; (Not A Number : pas un nombre)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette valeur d&amp;rsquo;exposant est non signÃ©e. Afin de permettre le stockage d&amp;rsquo;exposants nÃ©gatifs, un dÃ©calage est introduit. Dans le cas du double prÃ©cision, ce dÃ©calage est de &lt;code&gt;1023&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, avec un exposant dÃ©calÃ© de 1023, la plage d&amp;rsquo;exposants utilisables est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;De &lt;code&gt;0 - 1023&lt;/code&gt; = &lt;code&gt;-1022&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Ã€ &lt;code&gt;2046 - 1023&lt;/code&gt; = &lt;code&gt;1023&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Mantisse&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La mantisse est codÃ©e sur 52 bits et reprÃ©sente une fraction comprise entre 0 et 1 sous la forme d&amp;rsquo;un nombre binaire. La mantisse peut ainsi avoir 2&lt;sup&gt;52&lt;/sup&gt; (4 503 599 627 370 496 = 4,503599627370496 Ã— 10&lt;sup&gt;15&lt;/sup&gt;) valeurs diffÃ©rentes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le calcul de la valeur dÃ©cimale de la mantisse Ã  partir de la valeur binaire se fait comme suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Valeur binaire : &lt;code&gt;10100...00101&lt;/code&gt; (la partie tronquÃ©e n&amp;rsquo;est composÃ©e que de zÃ©ros).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur dÃ©cimale est Ã©gale Ã  la somme des puissances de deux multipliÃ©es par la valeur du bit correspondant :&lt;br&gt;&lt;code&gt;(&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-1&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-2&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-3&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-4&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-5&lt;/sup&gt;) + ... + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-48&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-49&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-50&lt;/sup&gt;) + (&lt;strong&gt;0&lt;/strong&gt;*2&lt;sup&gt;-51&lt;/sup&gt;) + (&lt;strong&gt;1&lt;/strong&gt;*2&lt;sup&gt;-52&lt;/sup&gt;)&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat pour notre exemple est ainsi &lt;code&gt;0,6250000000000011102230246251565404236316680908203125&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Combinaison exposant + mantisse&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une explication plus simple du fonctionnement de l&amp;rsquo;exposant combinÃ©e Ã  la mantisse est de parler de fenÃªtres et de paliers. Imaginez que l&amp;rsquo;amplitude maximum permise par le type double prÃ©cision soit dÃ©coupÃ©e en fenÃªtres elles mÃªmes sous dÃ©coupÃ©es en paliers avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;2045&lt;/code&gt; fenÃªtres : 2047 exposants disponibles moins les exposants 0 et 2047 qui sont rÃ©servÃ©s.&lt;br&gt;Une fenÃªtre est donc bornÃ©e entre deux puissances de 2 : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La premiÃ¨re fenÃªtre (exposant 1) dÃ©bute Ã  2&lt;sup&gt;-1022&lt;/sup&gt; (2&lt;sup&gt;1-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusquâ€™Ã  2&lt;sup&gt;-1021&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La derniÃ¨re fenÃªtre (exposant 2046) dÃ©bute Ã  2&lt;sup&gt;1023&lt;/sup&gt; (2&lt;sup&gt;2046-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusqu&amp;rsquo;Ã  2&lt;sup&gt;1024&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; paliers (&lt;code&gt;4 503 599 627 370 496&lt;/code&gt;) par fenÃªtre : le nombre de valeurs de mantisse disponibles.&lt;br&gt;Pour chaque fenÃªtre, un nombre de valeurs limitÃ© est ainsi disponible, la valeur d&amp;rsquo;incrÃ©mentation du palier (et donc la prÃ©cision) dÃ©pend de la fenÃªtre Ã  laquelle il se rattache.&lt;br&gt;Le calcul de la prÃ©cision est le suivant : &lt;code&gt;(Taille de la fenÃªtre)/(nombre de valeurs de la mantisse)&lt;/code&gt;&lt;br&gt;Par exemple &lt;code&gt;(2&lt;sup&gt;-1021&lt;/sup&gt; - 2&lt;sup&gt;-1022&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; pour la premiÃ¨re fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Calcul de la mantisse et de l&amp;rsquo;exposant depuis une valeur rÃ©elle&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible de calculer la mantisse et l&amp;rsquo;exposant d&amp;rsquo;une valeur rÃ©elle en suivant les Ã©tapes suivantes. la valeur d&amp;rsquo;exemple sera 1234,56789.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã‰tape 1 &amp;#8211; Convertir le nombre en binaire :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; Diviser la partie entiÃ¨re par 2 puis noter le reste (0 ou 1), rÃ©pÃ©ter l&amp;rsquo;opÃ©ration jusquâ€™Ã  ce que l&amp;rsquo;opÃ©ration soit Ã©gale Ã  0.&lt;br&gt;Le reste est notÃ© en commenÃ§ant par la droite.&lt;br&gt;Dans notre exemple, divisons successivement 1234 par 2â€¯en rÃ©cupÃ©rant le reste :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1234 Ã· 2 = 617â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;617 Ã· 2 = 308â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;308 Ã· 2 = 154â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;154 Ã· 2 = 77â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;77 Ã· 2 = 38â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;38 Ã· 2 = 19â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;19 Ã· 2 = 9â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;9 Ã· 2 = 4â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;4 Ã· 2 = 2â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2 Ã· 2 = 1â€‰reste&amp;nbsp;0&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1 Ã· 2 = 0â€‰reste&amp;nbsp;1&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Donc, &lt;code&gt;1234&lt;sub&gt;10&lt;/sub&gt; â€‹= 10011010010&lt;sub&gt;2&lt;/sub&gt;â€‹&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; Multiplier la partie dÃ©cimale par 2 puis noter la partie entiÃ¨re (0 ou 1), rÃ©pÃ©ter l&amp;rsquo;opÃ©ration un grand nombre de fois (voir l&amp;rsquo;Ã©tape 2 pour dÃ©terminer ce nombre).&lt;br&gt;La partie entiÃ¨re est notÃ©e en commenÃ§ant par la gauche.&lt;br&gt;Dans notre exemple, multiplions successivement 0,56789 par 2, en prenant la partie entiÃ¨re de chaque produitâ€¯:&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt; 0,56789 Ã— 2 = 1,13578 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,13578 Ã— 2 = 0,27156 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,27156 Ã— 2 = 0,54312 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,54312 Ã— 2 = 1,08624 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,08624 Ã— 2 = 0,17248 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,17248 Ã— 2 = 0,34496 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,34496 Ã— 2 = 0,68992 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;0)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;0,68992 Ã— 2 = 1,37984 (partie&amp;nbsp;entiÃ¨re&amp;nbsp;1)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&amp;#8230; on rÃ©pÃ¨te l&amp;rsquo;opÃ©ration un nombre important de fois&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En continuant, &lt;code&gt;0,56789&lt;sub&gt;10&lt;/sub&gt;â€‹ = 100100010110000100111101001100011011100111...&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt; (il s&amp;rsquo;agit d&amp;rsquo;une approximation)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur totale approximÃ©e est ainsi : &lt;code&gt;10011010010,100100010110000100111101001100011011100111&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã‰tape 2 &amp;#8211; Normaliser le nombre&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Normaliser le nombre sous la forme &lt;code&gt;1,xyz x 2&lt;sup&gt;abc&lt;/sup&gt;&lt;/code&gt;&lt;br&gt;Si le nombre dÃ©bute par &lt;code&gt;0,x&lt;/code&gt;, il faudra alors utiliser une puissance nÃ©gative.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur normalisÃ©e doit avoir 52 dÃ©cimales car la mantisse possÃ¨de 52 bits. Il vous faudra ajuster le nombre de calculs nÃ©cessaires Ã  l&amp;rsquo;Ã©tape 2. S&amp;rsquo;il ne vous est pas possible d&amp;rsquo;effectuer autant de calculs, complÃ©tez la mantisse par la valeur 0 (des bits nuls).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour notre exemple :&lt;br&gt;&lt;code&gt;10011010010,100100010110000100111101001100011011100111&lt;sub&gt;2&lt;/sub&gt;&lt;/code&gt; = &lt;code&gt;1,0011010010100100010110000100111101001100011011100111 x 2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas du nombre &lt;code&gt;0,0003&lt;/code&gt;, la valeur binaire est &lt;code&gt;0,000000000000001010001101101110001011101011000111000100001100101101&lt;/code&gt;. &lt;br&gt;La valeur normalisÃ©e est donc &lt;code&gt;1,010001101101110001011101011000111000100001100101101 x 2&lt;sup&gt;-14&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si votre valeur normalisÃ©e n&amp;rsquo;a pas 52 dÃ©cimales, complÃ©tez avec des 0 : &lt;code&gt;1,010011&lt;em&gt;0000000000000000000000000000000000000000000000&lt;/em&gt; x 2&lt;sup&gt;y&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Ã‰tape 3 &amp;#8211; Extraire les informations&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les informations sont disponibles presque immÃ©diatement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;exposant vous est donnÃ© par l&amp;rsquo;exposant de la valeur normalisÃ©e. &lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La mantisse est constituÃ©e de l&amp;rsquo;ensemble des valeurs suivant le Â«Â 1.Â Â».&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans notre exemple : &lt;code&gt;1,0011010010100100010110000100111101001100011011100111 x 2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;exposant est &lt;code&gt;10&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;exposant dÃ©calÃ© est &lt;code&gt;1033&lt;/code&gt; (&lt;code&gt;10 + 1023&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La fenÃªtre d&amp;rsquo;exposant est &lt;code&gt;2&lt;sup&gt;10&lt;/sup&gt;&lt;/code&gt; Ã  &lt;code&gt;2&lt;sup&gt;11&lt;/sup&gt;&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La valeur d&amp;rsquo;incrÃ©mentation et donc la prÃ©cision est &lt;code&gt;(2&lt;sup&gt;11&lt;/sup&gt; - 2&lt;sup&gt;10&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;2,27373675443232059478759765625 Ã— 10&lt;sup&gt;-13&lt;/sup&gt;&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La mantisse est : &lt;code&gt;0011010010100100010110000100111101001100011011100111&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La valeur approchÃ©e stockÃ©e est &lt;code&gt;1234,567890000000033978722058236598968505859375&lt;/code&gt; (calcul fait sur &lt;a href=&#34;https://www.wolframalpha.com/input?i=1.0011010010100100010110000100111101001100011011100111+base+2+x+2%5E10&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfram Alpha&lt;/a&gt;).&lt;br&gt;La valeur n&amp;rsquo;est prÃ©cise qu&amp;rsquo;a &lt;code&gt;2,27 x 10&lt;sup&gt;-13&lt;/sup&gt;&lt;/code&gt; donc peut Ãªtre arrondie Ã  &lt;code&gt;1234,5678900000000&lt;/code&gt; soit &lt;code&gt;1234,56789&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Valeurs spÃ©cifiques&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La combinaison de valeurs spÃ©cifiques de la mantisse et de l&amp;rsquo;exposant permet de reprÃ©senter certaines valeurs :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 0&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse = 0&lt;/code&gt; : la valeur est &lt;code&gt;0&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 0&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse != 0&lt;/code&gt; : la valeur est dÃ©normalisÃ©&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 2047&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse = 0&lt;/code&gt; : la valeur est &lt;code&gt;infini&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;Exposant = 2047&lt;/code&gt; &amp;amp; &lt;code&gt;mantisse != 0&lt;/code&gt; : &lt;code&gt;NaN&lt;/code&gt;, la valeur n&amp;rsquo;est pas un nombre&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;DÃ©normalisation&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La dÃ©normalisation permet de stocker des nombres plus petits que &lt;code&gt;2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt; (exposant le plus petit disponible). Pour cela, la mÃ©thode permettant de calculer la valeur finale change comme exposÃ© plus haut :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un nombre normalisÃ© se calcule de la faÃ§on suivante :&lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (1 + mantisse) * 2&lt;sup&gt;exposant-1023&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Alors qu&amp;rsquo;un nombre dÃ©normalisÃ© se calcule comme suivant : &lt;br&gt;&lt;code&gt;x&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * (0 + mantisse) * 2&lt;sup&gt;1-1023&lt;/sup&gt;&lt;/code&gt; = &lt;code&gt;-1&lt;sup&gt;signe&lt;/sup&gt; * 0,mantisse * 2&lt;sup&gt;-1022&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sans entrer dans les dÃ©tails, le principe est de dire que dans ce mode de calcul, la valeur la plus haute de la mantisse (&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt;) est alors Ã©gale Ã  la valeur immÃ©diatement avant la plus petite valeur en mode normalisÃ©. Il devient ainsi possible d&amp;rsquo;augmenter l&amp;rsquo;amplitude.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D&amp;rsquo;un point de vue technique, le bit de dÃ©calage de la mantisse est alors dÃ©fini Ã  0 et les programmes traitent la valeur de la mantisse comme dÃ©normalisÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Amplitude de valeurs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La combinaison de la mantisse et de l&amp;rsquo;exposant permet ainsi de calculer un ensemble de nombres avec une certaine prÃ©cision. Cependant il n&amp;rsquo;est pas possible de reprÃ©senter la totalitÃ© des nombres rÃ©els.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une explication plus simple du fonctionnement est de parler de fenÃªtres et de paliers. La plage de valeurs utilisables est dÃ©coupÃ©e en fenÃªtres elles mÃªmes sous dÃ©coupÃ©es en paliers avec :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;2045&lt;/code&gt; fenÃªtres : 2047 exposants disponibles moins les exposants 0 et 2047 rÃ©servÃ©s.&lt;br&gt;Une fenÃªtre est donc bornÃ©e entre deux puissances de 2 :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La premiÃ¨re fenÃªtre (exposant 1) dÃ©bute Ã  2&lt;sup&gt;-1022&lt;/sup&gt; (2&lt;sup&gt;1-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusquâ€™Ã  2&lt;sup&gt;-1021&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La derniÃ¨re fenÃªtre (exposant 2046) dÃ©bute Ã  2&lt;sup&gt;1023&lt;/sup&gt; (2&lt;sup&gt;2046-1023&lt;/sup&gt;) et s&amp;rsquo;Ã©tend jusqu&amp;rsquo;Ã  2&lt;sup&gt;1024&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; paliers (&lt;code&gt;4 503 599 627 370 496&lt;/code&gt;) par fenÃªtre : le nombre de valeurs de mantisses disponibles.&lt;br&gt;Pour chaque fenÃªtre, un nombre de valeurs limitÃ© est ainsi disponible, la valeur d&amp;rsquo;incrÃ©mentation du palier (et donc la prÃ©cision) dÃ©pend de la fenÃªtre auquel le palier se rattache.&lt;br&gt;Le calcul de la prÃ©cision est le suivant : &lt;code&gt;(Taille de la fenÃªtre)/(nombre de valeurs de la mantisse)&lt;/code&gt;&lt;br&gt;Par exemple &lt;code&gt;(2&lt;sup&gt;-1021&lt;/sup&gt; - 2&lt;sup&gt;-1022&lt;/sup&gt;) / 2&lt;sup&gt;52&lt;/sup&gt;&lt;/code&gt; pour la premiÃ¨re fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Partant de ce constat, voici un tableau de plusieurs valeurs intÃ©ressantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;FenÃªtre d&amp;rsquo;exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur d&amp;rsquo;incrÃ©mentation d&amp;rsquo;un palier&lt;br&gt;= &lt;strong&gt;PrÃ©cision&lt;/strong&gt;&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Mantisse&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur approchÃ©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;-1022&lt;/sup&gt; Ã  2&lt;sup&gt;-1021&lt;/sup&gt; : &lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 x 10&lt;sup&gt;âˆ’324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072013 x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus petit nombre normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;-1022&lt;/sup&gt; Ã  2&lt;sup&gt;-1021&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 x 10&lt;sup&gt;âˆ’324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072018 x 10&lt;sup&gt;âˆ’308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre immÃ©diatement aprÃ¨s le prÃ©cÃ©dent&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; Ã  2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 Ã— 10&lt;sup&gt;âˆ’16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,0&lt;/td&gt;&lt;td&gt;Valeur 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; Ã  2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 Ã— 10&lt;sup&gt;âˆ’16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,0000000000000002220446&lt;/td&gt;&lt;td&gt;Nombre immÃ©diatement aprÃ¨s le prÃ©cÃ©dent&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1023&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;0&lt;/sup&gt; Ã  2&lt;sup&gt;1&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2204460492 Ã— 10&lt;sup&gt;âˆ’16&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;450 359 962 737 050&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,10000000000000008881784197001&lt;/td&gt;&lt;td&gt;Plus proche palier de 1.1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1074&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;51&lt;/sup&gt; Ã  2&lt;sup&gt;52&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0,5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1075&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;52&lt;/sup&gt; Ã  2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4 503 599 627 370 496&lt;/td&gt;&lt;td&gt;Le nombre suivant sera l&amp;rsquo;entier suivant&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1076&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;53&lt;/sup&gt; Ã  2&lt;sup&gt;54&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2046&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;1023&lt;/sup&gt; Ã  2&lt;sup&gt;1024&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,99584030953 Ã— 10&lt;sup&gt;292&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,79769313486231550856 x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre immÃ©diatement avant le plus grand nombre normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2046&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;de 2&lt;sup&gt;1023&lt;/sup&gt; Ã  2&lt;sup&gt;1024&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,99584030953 Ã— 10&lt;sup&gt;292&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1 + (1 âˆ’ 2&lt;sup&gt;âˆ’52&lt;/sup&gt;))&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1,79769313486231570814 x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus grand nombre normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce tableau nous permet de voir plusieurs Ã©lÃ©ments :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;tous les nombres ne peuvent Ãªtre reprÃ©sentÃ©s exactement, c&amp;rsquo;est le cas de 1,1 qui est approximÃ© Ã  1,100 000 000 000 000 088 817 841 970 01. &lt;br&gt;Si un calcul est rÃ©alisÃ© et qu&amp;rsquo;une valeur intermÃ©diaire est trouvÃ©e, alors la valeur sera arrondie au palier le plus proche (voir la partie sur la prÃ©cision).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le passage d&amp;rsquo;une valeur Ã  celle immÃ©diatement aprÃ¨s n&amp;rsquo;est pas rÃ©gulier et dÃ©pend de l&amp;rsquo;ordre de grandeur d&amp;rsquo;un nombre.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le point prÃ©cÃ©dent implique que la prÃ©cision d&amp;rsquo;un nombre dÃ©pend de son ordre de grandeur et peut aller de plusieurs centaines de chiffres aprÃ¨s la virgule Ã  plusieurs centaines de milliers en passant par un.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les valeurs Ã©tant extrÃªmes, vous pouvez effectuer le calcul sur le site &lt;a href=&#34;https://www.wolframalpha.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfram Alpha&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un tableau de quelques nombres dÃ©normalisÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Mantisse&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur d&amp;rsquo;incrÃ©mentation d&amp;rsquo;un palier&lt;br&gt;= &lt;strong&gt;PrÃ©cision&lt;/strong&gt;&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur approchÃ©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus petit nombre dÃ©normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9,881 x 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Nombre dÃ©normalisÃ© suivant&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,940656458 Ã— 10&lt;sup&gt;-324&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,2250738585072008 x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;Plus grand nombre dÃ©normalisÃ©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce tableau nous permet de voir que :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;la valeur d&amp;rsquo;incrÃ©mentation des nombres dÃ©normalisÃ©s est la mÃªme que le premier palier des nombres normalisÃ© car le calcul se base sur le mÃªme exposant (la mÃªme fenÃªtre) : &lt;code&gt;-1022&lt;/code&gt; et la mantisse possÃ¨de toujours le mÃªme nombre de valeurs (mÃªme nombre de paliers)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le plus grand nombre dÃ©normalisÃ© est immÃ©diatement avant la plus petite valeur normalisÃ©e ce qui permet une continuitÃ© des valeurs.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici enfin un dernier tableau prÃ©sentant certains nombres spÃ©cifiques :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Exposant&lt;/th&gt;&lt;th&gt;Mantisse&lt;/th&gt;&lt;th&gt;Valeur approchÃ©e&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;0,0&lt;/td&gt;&lt;td&gt;ZÃ©ro&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;Infini&lt;/td&gt;&lt;td&gt;Infini&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;&lt;em&gt;NaN&lt;/em&gt;&lt;/td&gt;&lt;td&gt;PremiÃ¨re valeur de NaN&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2047&lt;/td&gt;&lt;td&gt;2&lt;sup&gt;53&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;&lt;em&gt;NaN&lt;/em&gt;&lt;/td&gt;&lt;td&gt;DerniÃ¨re valeur de NaN&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision et chiffres significatifs&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La prÃ©cision reprÃ©sente la plus petite diffÃ©rence pouvant Ãªtre calculÃ©e entre deux valeurs consÃ©cutives. Cette prÃ©cision varie selon l&amp;rsquo;ordre de grandeur de la valeur d&amp;rsquo;oÃ¹ le terme de Â«Â nombre Ã  virgule flottanteÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Chaque valeur Ã©tant liÃ©e Ã  une plage d&amp;rsquo;exposant (une fenÃªtre) et chaque plage d&amp;rsquo;exposant pouvant Ãªtre dÃ©coupÃ©e par 2&lt;sup&gt;52&lt;/sup&gt; valeurs de mantisse (les paliers), la prÃ©cision de chaque plage peut Ãªtre estimÃ©e par l&amp;rsquo;approximation suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;prÃ©cision&lt;/code&gt; &lt;strong&gt;â‰ƒ&lt;/strong&gt; &lt;code&gt;(valeur / 2&lt;sup&gt;52&lt;/sup&gt;)&lt;/code&gt; &lt;strong&gt;â‰ƒ&lt;/strong&gt; &lt;code&gt;(valeur / (4,5 x 10&lt;sup&gt;15&lt;/sup&gt;))&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques ordres de grandeur de prÃ©cision :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Plus petit nombre normalisÃ© : 2,225 x 10&lt;sup&gt;-308&lt;/sup&gt; : &lt;code&gt;10&lt;sup&gt;-324&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 : &lt;code&gt;10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 x 10&lt;sup&gt;16&lt;/sup&gt; : &lt;code&gt;1&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Plus grand nombre normalisÃ© : 1,798 x 10&lt;sup&gt;308&lt;/sup&gt; : &lt;code&gt;10&lt;sup&gt;292&lt;/sup&gt;&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le terme de Â«Â nombre de chiffres significatifsÂ Â» est Ã©galement utilisÃ© et reprÃ©sente le nombre de chiffre maximum qu&amp;rsquo;il faut pour percevoir une diffÃ©rence entre deux nombres en notation scientifique. Le nombre de chiffres significatifs est ici entre 15 et 16 car il faut au maximum 16 chiffres pour percevoir une diffÃ©rence entre deux nombres :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Plus petit nombre normalisÃ© : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;2,225 073 858 507 201 &lt;strong&gt;3&lt;/strong&gt; x 10&lt;sup&gt;-308&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2,225 073 858 507 201 &lt;strong&gt;8&lt;/strong&gt; x 10&lt;sup&gt;âˆ’308&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur 1,0 : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1,000 000 000 000 000 &lt;strong&gt;0&lt;/strong&gt; x 10&lt;sup&gt;0&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1,000 000 000 000 000 &lt;strong&gt;2&lt;/strong&gt; x 10&lt;sup&gt;0&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Valeur dont l&amp;rsquo;incrÃ©mentation est de 1 Ã  chaque palier :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;4,503 599 627 370 49&lt;strong&gt;6&lt;/strong&gt; x 10&lt;sup&gt;15&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;4,503 599 627 370 49&lt;strong&gt;7&lt;/strong&gt; x 10&lt;sup&gt;16&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Plus grand nombre normalisÃ© : 1,798 x 10&lt;sup&gt;308&lt;/sup&gt; :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;1,797 693 134 862 315 &lt;strong&gt;5&lt;/strong&gt; x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1,797 693 134 862 315 &lt;strong&gt;7&lt;/strong&gt; x 10&lt;sup&gt;308&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas de PostgreSQL (et d&amp;rsquo;autres programmes) la valeur exacte stockÃ©e est arrondie selon la prÃ©cision permise pour celle-ci (grÃ¢ce Ã  &lt;a href=&#34;https://github.com/postgres/postgres/blob/master/src/common/d2s.c#L346&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;cette fonction dans le code source&lt;/a&gt;). &lt;br&gt;Ainsi, pour la valeur &lt;code&gt;1,1&lt;/code&gt;, le stockage en double prÃ©cision donne la valeur exacte &lt;code&gt;1,10000000000000008881784197001&lt;/code&gt; ce qui est prÃ©cis Ã  10&lt;sup&gt;-29&lt;/sup&gt;. Comme la prÃ©cision permise pour l&amp;rsquo;ordre de grandeur de la valeur est de &lt;code&gt;2,22 x 10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt; prÃ¨s, la valeur renvoyÃ©e est arrondie selon cette prÃ©cision donc &lt;code&gt;1,1000000000000000&lt;/code&gt; soit &lt;code&gt;1,1&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques ressources pour aller plus loin :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Des calculateurs de valeur en double prÃ©cision :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.omnicalculator.com/other/floating-point&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.omnicalculator.com/other/floating-point&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.binaryconvert.com/result_double.html?hexadecimal=0000000000000000&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.binaryconvert.com/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un outil de calcul surpuissant pour rapidement convertir des donnÃ©es : &lt;a href=&#34;https://www.wolframalpha.com/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Wolfra Alpha&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;article WikipÃ©dia sur les nombre Ã  virgule flottante : &lt;a href=&#34;https://fr.wikipedia.org/wiki/Virgule_flottante&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://fr.wikipedia.org/wiki/Virgule_flottante&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un article intÃ©ressant sur les nombres Ã  virgule flottante : &lt;a href=&#34;https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;What Every Computer Scientist Should Know About Floating-Point Arithmetic&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La documentation de PostgreSQL sur les nombres Ã  virgule flottante : &lt;a href=&#34;https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-FLOAT&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-FLOAT&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision sous PostGIS&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision globale&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les coordonnÃ©es sous PostGIS sont stockÃ©es en utilisant le type double prÃ©cision de PostgreSQL. La prÃ©cision des valeurs dÃ©pend donc de l&amp;rsquo;ordre de grandeur et varie selon :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;le systÃ¨me de projection.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;la valeur de la coordonnÃ©e (et donc la position).&lt;br&gt;En rÃ¨gle gÃ©nÃ©rale, il est possible d&amp;rsquo;appliquer la formule suivante pour avoir une idÃ©e de la prÃ©cision possible : &lt;code&gt;10&lt;sup&gt;-16&lt;/sup&gt; x la valeur&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques Ã©lÃ©ments de prÃ©cision en lien avec diffÃ©rents systÃ¨mes de coordonnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;WGS84 (EPSG:4326) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;CoordonnÃ©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -180 Ã  180&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-14&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;CoordonnÃ©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de -90 Ã  90&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-14&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;WGS 84 / Pseudo-Mercator (EPSG:3857) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;CoordonnÃ©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -20037508,34 Ã  20037508,34&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-9&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;CoordonnÃ©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de -20048966,1 Ã  20048966,1&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-9&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Lambert 93 (EPSG:2154) :&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;CoordonnÃ©es X :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude : de -378305,81 Ã  1320649,57 (entre environ 100 000 et 1 100 000 pour la France mÃ©tropolitaine)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : de 10&lt;sup&gt;-16&lt;/sup&gt; Ã  10&lt;sup&gt;-10&lt;/sup&gt; (sauf pour les coordonnÃ©es entre -1 et 1 qui peuvent atteindre une prÃ©cision de 10&lt;sup&gt;-324&lt;/sup&gt; mais qui ne sont presque jamais utilisÃ©es).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;CoordonnÃ©es Y :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Amplitude de 6005281,2 Ã  7235612,72  (entre environ 6 033 000 et 7 130 000 pour la France mÃ©tropolitaine)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;PrÃ©cision : 10&lt;sup&gt;-10&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le Lambert 93, la prÃ©cision est entre 10&lt;sup&gt;-10&lt;/sup&gt; soit 0,1 nanomÃ¨tres (1 Ã¥ngstrÃ¶m, la taille d&amp;rsquo;une molÃ©cule) et 10&lt;sup&gt;-16&lt;/sup&gt; soit 0,1 femtomÃ¨tre (la taille d&amp;rsquo;un nuclÃ©on : proton ou neutron) ce qui suffit largement Ã  positionner n&amp;rsquo;importe quoi&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour mieux visualiser la prÃ©cision, il est possible de tester quelques requÃªtes dans PostGIS. Dirigeons nous vers Chamonix en Haute Savoie oÃ¹ se trouve un point possÃ©dant les coordonnÃ©es suivantes en Lambert 93 : X = 1000000 et Y = 6543210. Il s&amp;rsquo;agit de la terrasse d&amp;rsquo;un hÃ´tel.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_text,&#xA;&#x9;ST_AsText(geom_text::geometry(point, 2154)) AS geom&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000.0000000001 6543210.000000001)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000.00000000001 6543210.0000000001)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000.00000000008 6543210.0000000008)&#39;)&#xA;) AS t (id, geom_text)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;POINT (1000000 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;POINT (1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000008 6543210.0000000008)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce que l&amp;rsquo;on observe c&amp;rsquo;est que lorsqu&amp;rsquo;une coordonnÃ©e dont la prÃ©cision est supÃ©rieure Ã  ce qui est permis par le type double prÃ©cision, alors celle-ci est automatiquement arrondie :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Dans le cas de la ligne 2, la valeur des coordonnÃ©es est permise par le type double prÃ©cision, les coordonnÃ©es sont conservÃ©es telles quelles avec une prÃ©cision Â«Â Ã  la molÃ©cule prÃ¨sÂ Â».&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Dans le cas de la ligne 3, les coordonnÃ©es X et Y possÃ¨dent une valeur dont l&amp;rsquo;ordre de grandeur est 10&lt;sup&gt;6&lt;/sup&gt;. La prÃ©cision maximum est donc de 10&lt;sup&gt;-10&lt;/sup&gt; (&lt;code&gt;10&lt;sup&gt;6&lt;/sup&gt; x 10&lt;sup&gt;-16&lt;/sup&gt;&lt;/code&gt;). Les valeurs sont donc arrondies Ã  10&lt;sup&gt;-10&lt;/sup&gt;. Notez que pour la valeur de Y, la valeur de la partie entiÃ¨re impose un arrondi Ã  10&lt;sup&gt;-9&lt;/sup&gt; plutÃ´t que 10&lt;sup&gt;-10&lt;/sup&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pour la ligne 4, le principe est le mÃªme mais l&amp;rsquo;arrondi se faisant au plus proche, nous rÃ©cupÃ©rons la valeur au dessus.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que la transformation des coordonnÃ©es dans le systÃ¨me WGS 84 (EPSG:4326) permet d&amp;rsquo;utiliser plus de dÃ©cimales car les valeurs possÃ¨dent un ordre de grandeur plus faible :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;ST_AsText(&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#39;POINT (1000000 6543210)&#39;::geometry(point, 2154), &#xA;&#x9;&#x9;&#x9;4326&#xA;&#x9;&#x9;)&#xA;&#x9;) AS geom&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat est &lt;code&gt;POINT(6.87241320435217 45.92236395248839)&lt;/code&gt; : la prÃ©cision est de 10&lt;sup&gt;-14&lt;/sup&gt; pour les coordonnÃ©es X et Y. Ici aussi vous pouvez voir que selon la valeur de la partie entiÃ¨re, la prÃ©cision autorisÃ©e oscille entre 10&lt;sup&gt;-16&lt;/sup&gt; et 10&lt;sup&gt;-15&lt;/sup&gt; multipliÃ©e par l&amp;rsquo;ordre de grandeur.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision lors des calculs&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les calculs sous PostGIS sont rÃ©alisÃ©s en double prÃ©cision et donc avec la prÃ©cision dÃ©taillÃ©e prÃ©cÃ©demment. Par exemple, une distance entre deux objets aura une prÃ©cision qui dÃ©pendra de l&amp;rsquo;ordre de grandeur de la valeur elle-mÃªme.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;il s&amp;rsquo;agit de comparer des gÃ©omÃ©tries, le cas est plus complexe. Nous allons Ã©tudier la fonction &lt;code&gt;ST_Intersects&lt;/code&gt; mais le principe est le mÃªme pour les autres fonctions de relation spatiale.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Relation sommet Ã  sommet : il s&amp;rsquo;agit simplement de comparer les coordonnÃ©es entres-elles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_text,&#xA;&#x9;ST_AsText(geom_text::geometry(point, 2154)) AS geom,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_text::geometry(point, 2154),&#xA;&#x9;&#x9;&#39;POINT(1000000 6543210)&#39;::geometry(geometry, 2154)&#xA;&#x9;) AS st_intersects&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000.0000000001 6543210)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000.00000000001 6543210)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000.00000000008 6543210)&#39;),&#xA;&#x9;(5, &#39;POINT (999999.99999999990 6543210)&#39;),&#xA;&#x9;(6, &#39;POINT (999999.99999999997 6543210)&#39;)&#xA;) AS t (id, geom_text)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;POINT (1000000 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;POINT (1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;POINT (1000000.00000000008 6543210.0000000008)&lt;/td&gt;&lt;td&gt;POINT(1000000.0000000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td&gt;POINT (999999.99999999990 6543210)&lt;/td&gt;&lt;td&gt;POINT(999999.9999999999 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td&gt;POINT (999999.99999999997 6543210)&lt;/td&gt;&lt;td&gt;POINT(1000000 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, la requÃªte prÃ©cÃ©dente permet de visualiser que la correspondance doit Ãªtre exacte. Lorsqu&amp;rsquo;une coordonnÃ©es est Â«Â trop prÃ©ciseÂ Â», elle est simplement arrondie afin de pouvoir Ãªtre traitÃ©e puis comparÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que dans le cas du type &lt;code&gt;geography&lt;/code&gt;, deux gÃ©omÃ©tries s&amp;rsquo;intersectent si elles sont distantes de moins de 0,00001 mÃ¨tre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Relation sommet Ã  segment : ce cas est plus complexe car il faut calculer la distance entre un sommet rÃ©el et un point virtuel situÃ© sur le segment. Pour faire cela, plusieurs calculs sont rÃ©alisÃ©s, tous en double prÃ©cision. Ainsi, la distance doit Ãªtre infÃ©rieur Ã  la prÃ©cision permise par les coordonnÃ©es des objets comparÃ©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ces opÃ©rations peuvent d&amp;rsquo;ailleurs entrainer des erreurs en raison de la nature imprÃ©cise des nombre en double prÃ©cision. Il est donc possible d&amp;rsquo;avoir de faux nÃ©gatifs : deux objets considÃ©rÃ©s comme ne s&amp;rsquo;intersectant pas alors qu&amp;rsquo;ils le sont ou inversement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requÃªte qui compare un point avec des lignes trÃ¨s proches de celui-ci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_line AS geom_text,&#xA;&#x9;ST_AsText(geom_line::geometry(linestring, 2154)),&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_distance,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210)&#39;),&#xA;&#x9;(2, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.0000000001)&#39;),&#xA;&#x9;(3, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.000000001)&#39;),&#xA;&#x9;(4, &#39;POINT (1000000 6543210)&#39;, &#39;LINESTRING(999999 6543210, 1000001 6543210.00000001)&#39;)&#xA;) AS t (id, geom_pt, geom_line)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les objets sont alignÃ©s selon un axe globalement Est-Ouest. La variation de la coordonnÃ©e Y du sommet le plus Ã  l&amp;rsquo;Est de la ligne permet de dÃ©caler lÃ©gÃ¨rement celle-ci par rapport au point testÃ© pour vÃ©rifier l&amp;rsquo;intersection des deux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le rÃ©sultat est le suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.0000000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.000000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210.000000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;LINESTRING(999999 6543210, 1000001 6543210.00000001)&lt;/td&gt;&lt;td&gt;LINESTRING (999999 6543210, 1000001 6543210.00000001)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.0000000055879354&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne 1 est une intersection parfaite. Vous pouvez observer que les gÃ©omÃ©tries trop prÃ©cises dans le cas de la ligne 2 sont ici aussi arrondies. En revanche, la ligne 3 met en valeur le fait que les arrondis de calcul entrainent une distance nulle alors que les objets ne s&amp;rsquo;intersectent pas ; en rÃ©alitÃ©, la distance est infinitÃ©simale et est donc arrondie Ã  0. La ligne 4 montre un Ã©cart trÃ¨s petit.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dernier exemple intÃ©ressant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id,&#xA;&#x9;geom_line AS geom_text,&#xA;&#x9;ST_AsText(geom_line::geometry(linestring, 2154)) AS geom_line,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_distance,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) * 1e100 AS st_distance_xe100,&#xA;&#x9;ST_Distance(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) * 1e308 AS st_distance_xe308,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;geom_pt::geometry(point, 2154),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects,&#xA;&#x9;st_astext(&#xA;&#x9;&#x9;ST_LineInterpolatePoint(&#xA;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;ST_LineLocatePoint(&#xA;&#x9;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;&#x9;geom_pt::geometry(point, 2154)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;)&#xA;&#x9;) AS geom_point_proj,&#xA;&#x9;ST_Intersects(&#xA;&#x9;&#x9;ST_LineInterpolatePoint(&#xA;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;ST_LineLocatePoint(&#xA;&#x9;&#x9;&#x9;&#x9;geom_line::geometry(linestring, 2154),&#xA;&#x9;&#x9;&#x9;&#x9;geom_pt::geometry(point, 2154)&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;geom_line::geometry(linestring, 2154)&#xA;&#x9;) AS st_intersects_proj&#xA;FROM (&#xA;&#x9;VALUES &#xA;&#x9;(1, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-100)&#39;),&#xA;&#x9;(2, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-323)&#39;),&#xA;&#x9;(3, &#39;POINT (1 0)&#39;, &#39;LINESTRING(0 0, 10 1e-324)&#39;)&#xA;) AS t (id, geom_pt, geom_line)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;J&amp;rsquo;ai repris l&amp;rsquo;exemple d&amp;rsquo;une ligne avec un point mais l&amp;rsquo;ai amplifiÃ© : une ligne qui dÃ©bute en X = 0 et finie en X = 10 est comparÃ©e Ã  un point positionnÃ© en X = 2. Pour dÃ©caler la ligne du point, la fin de la ligne est dÃ©placÃ©e selon l&amp;rsquo;axe Y d&amp;rsquo;une distance trÃ¨s petite (en limite du type double prÃ©cision).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je calcule la distance, ainsi que la distance multipliÃ©e par 10&lt;sup&gt;100&lt;/sup&gt; et 10&lt;sup&gt;300&lt;/sup&gt; pour Ã©viter de passer sous la tolÃ©rance d&amp;rsquo;affichage des double prÃ©cision de PostgreSQL.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je dÃ©termine Ã©galement un point projetÃ© sur la ligne Ã  partir du point testÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th&gt;geom_text&lt;/th&gt;&lt;th&gt;geom_line&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance_xe100&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_distance_xe300&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects&lt;/th&gt;&lt;th&gt;geom_point_proj&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;st_intersects_proj&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 0)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-100)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 1e-100)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0.1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;sup&gt;99&lt;/sup&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;td&gt;POINT(1 1e-101)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-323)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 1e-323)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td&gt;LINESTRING(0 0, 10 1e-324)&lt;/td&gt;&lt;td&gt;LINESTRING(0 0,10 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;true&lt;/td&gt;&lt;td&gt;POINT(1 0)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;false&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que le point projetÃ© n&amp;rsquo;intersecte la ligne sur laquelle il est censÃ© Ãªtre positionnÃ© que dans le premier cas. Dans le cas d&amp;rsquo;un dÃ©calage, mÃªme infinitÃ©simale (dans le cas de la ligne 2, la distance entre la ligne et le point projetÃ© est tellement infime qu&amp;rsquo;il n&amp;rsquo;est pas calculable avec PostGIS), il n&amp;rsquo;y a pas intersection.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez essayer avec des dÃ©calages plus importants (de l&amp;rsquo;ordre de 1 m par exemple) mais trÃ¨s souvent il n&amp;rsquo;y aura pas d&amp;rsquo;intersection car un point projetÃ© sur un segment de ligne n&amp;rsquo;est qu&amp;rsquo;une approximation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Pour avoir une intersection fiable, il doit y avoir une correspondance topologique : un sommet avec un sommet.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;RÃ©duire la prÃ©cision&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme avoir une cohÃ©rence topologique ne vous intÃ©resse pas&amp;#8230; vous voulez rÃ©duire la prÃ©cision. Soit !&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il n&amp;rsquo;est pas possible de spÃ©cifier une prÃ©cision Ã  utiliser pour une base de donnÃ©es avec PostGIS. D&amp;rsquo;ailleurs le simple fait de vouloir contraindre la prÃ©cision des coordonnÃ©es doit amener Ã  rÃ©flÃ©chir sur les propositions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Il ne faut pas confondre prÃ©cision de la mesure et prÃ©cision des coordonnÃ©es : une mesure effectuÃ©e avec un GPS ayant une prÃ©cision de Â± 10 mÃ¨tres doit Ãªtre stockÃ©e telle que mesurÃ©e. &lt;br&gt;Par exemple X = 33,5 m, alors la valeur rÃ©elle est comprise entre 23,5 et 43,5 m, rÃ©duire la prÃ©cision Ã  10 mÃ¨tres prÃ¨s entrainerait alors une perte d&amp;rsquo;information.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Lorsque les coordonnÃ©es d&amp;rsquo;un point sont calculÃ©es par interpolation, la valeur peut avoir plus de dÃ©cimales que les valeurs utilisÃ©es dans l&amp;rsquo;interpolation. &lt;br&gt;Par exemple, deux points distants dont les coordonnÃ©es sont au mÃ¨tre prÃ¨s (pas de dÃ©cimales) peuvent entrainer le calcul d&amp;rsquo;un point mÃ©dian avec des coordonnÃ©es Ã  dÃ©cimales.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La rÃ©duction de la prÃ©cision au niveau des coordonnÃ©es implique une perte de prÃ©cision des valeurs issues de calculs Ã  partir des coordonnÃ©es (aire, pÃ©rimÃ¨tre&amp;#8230;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La reprojection des coordonnÃ©es peut impliquer un changement du nombre de dÃ©cimales. &lt;br&gt;Par exemple, les coordonnÃ©es en WGS 84 (en degrÃ©s) impliquent un nombre plus important de dÃ©cimales que les coordonnÃ©es en Lambert 93 (en mÃ¨tres).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe cependant plusieurs mÃ©thodes pour rÃ©duire la prÃ©cision des coordonnÃ©es ou des calculs associÃ©s aux coordonnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision des coordonnÃ©es&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_SnapToGrid.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_SnapToGrid&lt;/a&gt;&lt;/code&gt; : dÃ©place les sommets de gÃ©omÃ©tries en entrÃ©e sur une grille dont le pas est dÃ©fini. Les points consÃ©cutifs dÃ©placÃ©s au mÃªme endroit ainsi que les gÃ©omÃ©tries nulles sont supprimÃ©s. Attention, des gÃ©omÃ©tries invalides peuvent Ãªtre crÃ©Ã©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_ReducePrecision.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_ReducePrecision&lt;/a&gt;&lt;/code&gt; : rÃ©duit la prÃ©cision des coordonnÃ©es en les arrondissant selon la prÃ©cision choisie. Les gÃ©omÃ©tries crÃ©Ã©es sont toutes valides.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;code&gt;&lt;a href=&#34;https://postgis.net/docs/ST_QuantizeCoordinates.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ST_QuantizeCoordinates&lt;/a&gt;&lt;/code&gt; : rÃ©duit la prÃ©cision des coordonnÃ©es tout en opÃ©rant un traitement spÃ©cifique sur leur stockage afin d&amp;rsquo;en augmenter la compressibilitÃ©. Pour cela, les valeurs des bits non significatifs de la mantisse sont dÃ©finies Ã  zÃ©ro. Il s&amp;rsquo;agit de la meilleure mÃ©thode pour rÃ©duire le poids d&amp;rsquo;une gÃ©omÃ©trie.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;PrÃ©cision des calculs&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la prÃ©cision des calculs, c&amp;rsquo;est diffÃ©rents. En effet, PostGIS utilise toujours la prÃ©cision permise par le type double prÃ©cision et seules quelques fonctions permettent d&amp;rsquo;utiliser une tolÃ©rance. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les fonctions qui permettent de spÃ©cifier une tolÃ©rance (le paramÃ¨tre gridsize) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;ST_Union&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_UnaryUnion&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Difference&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Intersection&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_SymDifference&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;ST_Subdivide&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cependant, dans la plupart des cas c&amp;rsquo;est la mÃ©thode qu&amp;rsquo;il faut adapter. Il s&amp;rsquo;agit ainsi d&amp;rsquo;utiliser une fonction rÃ©duisant la prÃ©cision des coordonnÃ©es en conjonction d&amp;rsquo;une fonction classique ou d&amp;rsquo;utiliser une autre mÃ©thode que celle habituelle. Voici quelques cas et adaptations possibles.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Intersects&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour tester si deux gÃ©omÃ©tries s&amp;rsquo;intersectent avec une certaine tolÃ©rance, il faut utiliser la fonction &lt;code&gt;ST_DWithin()&lt;/code&gt; qui permet de dÃ©terminer si deux gÃ©omÃ©tries sont situÃ©es Ã  une certaine distance l&amp;rsquo;une de l&amp;rsquo;autre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Covers&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour tester le recouvrement de deux gÃ©omÃ©tries, vous pouvez appliquer une zone tampon Ã  la gÃ©omÃ©trie Â«Â englobanteÂ Â» avec la fonction &lt;code&gt;ST_Buffer()&lt;/code&gt;. Par exemple, une zone tampon de 5 mÃ¨tres permet de savoir si une gÃ©omÃ©trie englobe une autre Ã  5 mÃ¨tres prÃ¨s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Touches&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Deux gÃ©omÃ©tries se touchent si elle s&amp;rsquo;intersectent mais pas leurs Â«Â intÃ©rieursÂ Â». Introduire une tolÃ©rance implique alors d&amp;rsquo;autoriser un lÃ©ger chevauchement des intÃ©rieurs. Il faudra alors utiliser la fonction &lt;code&gt;ST_DWithin&lt;/code&gt; pour valider que les gÃ©omÃ©tries soient proches l&amp;rsquo;une de lâ€™autre. Il faut ensuite valider que l&amp;rsquo;intersection des deux gÃ©omÃ©tries soit minime en calculant l&amp;rsquo;aire d&amp;rsquo;intersection avec &lt;code&gt;ST_Area(ST_Intersection())&lt;/code&gt; et en la comparant Ã  l&amp;rsquo;aire de chacune des gÃ©omÃ©tries. Il conviendra de dÃ©finir un pourcentage maximum (par exemple Â«Â moins de 1% d&amp;rsquo;intersectionÂ Â»).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Relation topologique : cas gÃ©nÃ©ral&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le calcul des relations topologiques de maniÃ¨re gÃ©nÃ©rale, tout va dÃ©pendre du rÃ©sultat voulu. Selon les cas, il faudra rÃ©duire la prÃ©cision des coordonnÃ©es avant d&amp;rsquo;utiliser la fonction ou encore combiner plusieurs autres fonctions permettant de dÃ©terminer la relation voulue.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ST_Distance&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le calcul d&amp;rsquo;une distance n&amp;rsquo;est pas Ã  proprement parlÃ© liÃ© Ã  une tolÃ©rance mais la prÃ©cision du rÃ©sultat peut Ãªtre modifiÃ© avec la fonction &lt;code&gt;round()&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques liens pour approfondir le sujet :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un excellent article de LoÃ¯c Bartoletti sur Geotribu sur le sujet de la tolÃ©rance dans PostGIS : &lt;a href=&#34;https://geotribu.fr/articles/2024/2024-07-16_de-la-tolerance-en-sig-geometrie-00-annonce/&#34;&gt;https://geotribu.fr/articles/2024/2024-07-16_de-la-tolerance-en-sig-geometrie-00-annonce/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le type PostGIS &lt;code&gt;geometry&lt;/code&gt; : &lt;a href=&#34;https://postgis.net/docs/using_postgis_dbmanagement.html#PostGIS_Geometry&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://postgis.net/docs/using_postgis_dbmanagement.html#PostGIS_Geometry&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Discussion sur l&amp;rsquo;implÃ©mentation (future) d&amp;rsquo;une tolÃ©rance dans PostGIS : &lt;a href=&#34;https://trac.osgeo.org/postgis/wiki/ToleranceDiscussion#no1&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://trac.osgeo.org/postgis/wiki/ToleranceDiscussion#no1&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un article sur l&amp;rsquo;origine de &lt;code&gt;ST_QuantizeCoordinates()&lt;/code&gt; : &lt;a href=&#34;http://www.danbaston.com/posts/2018/02/15/optimizing-postgis-geometries.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;http://www.danbaston.com/posts/2018/02/15/optimizing-postgis-geometries.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la possibilitÃ© de dÃ©finir une rÃ©solution spatiale : &lt;a href=&#34;https://gis.stackexchange.com/questions/424798/is-it-possible-to-define-a-spatial-resolution-for-a-geometry-column-in-postgis&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://gis.stackexchange.com/questions/424798/is-it-possible-to-define-a-spatial-resolution-for-a-geometry-column-in-postgis&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la prÃ©cision des fonctions dans PostGIS : &lt;a href=&#34;https://stackoverflow.com/questions/70258656/postgis-precision-of-functions&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://stackoverflow.com/questions/70258656/postgis-precision-of-functions&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une discussion sur la mailing list PostGIS Ã  propos de la prÃ©cision du WKT : &lt;a href=&#34;https://lists.osgeo.org/pipermail/postgis-users/2008-May/019606.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://lists.osgeo.org/pipermail/postgis-users/2008-May/019606.html&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/soyons-precis-avec-postgis" rel="alternate"></link>
    <summary type="html">Vous Ãªtes vous dÃ©jÃ  demandÃ© quelle Ã©tait la prÃ©cision de PostGIS ? Moi oui... Alors Ã©tudions cela ensemble.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Monitorer PostgreSQL avec Prometheus et Grafana</title>
    <updated>2024-05-21T19:35:50Z</updated>
    <id>tag:blog.arthurbazin.com,2024-05-21:/it/monitorer-postgresql-avec-prometheus-et-grafana</id>
    <content type="html">&#xA;&lt;p&gt;Plus une instance PostgreSQL est utilisÃ©e et plus il devient crucial de la monitorer. De nombreuses solutions existent, je vais vous en prÃ©senter une que j&amp;rsquo;utilise rÃ©guliÃ¨rement et qui repose sur Prometheus et Grafana et qui permet de faire de beaux tableaux de bord.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img fetchpriority=&#34;high&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-3303&#34; style=&#34;width:768px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-300x159.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-768x407.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1536x813.png 1536w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1.png 1611w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Voila un trÃ¨s beau tableau de bord &lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f609.png&#34; alt=&#34;ğŸ˜‰&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Pourquoi cette solution ? Car il est possible de monitorer d&amp;rsquo;autres programmes ainsi que des serveurs. Il s&amp;rsquo;agit donc d&amp;rsquo;une solution trÃ¨s modulaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Grafana&lt;/strong&gt; est un logiciel libre de visualisation de donnÃ©es. Il permet notamment la rÃ©alisation de tableaux de bord et s&amp;rsquo;interface parfaitement avec Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Prometheus &lt;/strong&gt;est un logiciel libre dâ€™enregistrement de mÃ©triques en temps rÃ©el. Il permet l&amp;rsquo;interrogation des donnÃ©es Ã  l&amp;rsquo;aide d&amp;rsquo;un langage simple (PromQL) et de gÃ©nÃ©rer des alertes si besoin.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Exporters&lt;/strong&gt; : il s&amp;rsquo;agit de petits logiciels qui permettent de rÃ©cupÃ©rer des donnÃ©es en temps rÃ©el dans un format comprÃ©hensible par Prometheus. Il en existe de toutes sortes dont celui pour PostgreSQL : &lt;strong&gt;Postgres Exporter&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Exporters&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Postgres Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Postgres Exporter est l&amp;rsquo;outil qui va interroger votre instance PostgreSQL est rÃ©cupÃ©rer les mÃ©triques nÃ©cessaires. Il est en gÃ©nÃ©ral installÃ© sur le serveur sur lequel se trouve l&amp;rsquo;instance PostgreSQL mais il peut Ãªtre installer ailleurs, il doit simplement pouvoir accÃ©der Ã  la base de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que Postgres Exporter gÃ¨re le multi-instance mais ce n&amp;rsquo;est pour l&amp;rsquo;instant pas recommandÃ© de l&amp;rsquo;utiliser. Il faudra donc autant de processus que d&amp;rsquo;instance PostgreSQL (pour rappel, une instance de PostgreSQL peut possÃ©der plusieurs bases de donnÃ©es).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, il n&amp;rsquo;est pas possible de sÃ©curiser l&amp;rsquo;accÃ¨s aux donnÃ©es exportÃ©es par Postgres Exporter directement. L&amp;rsquo;outil ne gÃ¨re pas l&amp;rsquo;authentification, il faut donc utiliser des rÃ¨gle de pare-feu ou un serveur web frontal pour Ã©viter que n&amp;rsquo;importe qui puisse voir les donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par tÃ©lÃ©charger le logiciel depuis &lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le projet GitHub&lt;/a&gt; (dans les Releases).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le dÃ©zipper puis de la placer lÃ  oÃ¹ vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ez ensuite un fichier &lt;code&gt;start_127.0.0.1_5432.bat&lt;/code&gt; dans le rÃ©pertoire de Postgres Exporter avec le contenu suivant (en remplaÃ§ant l&amp;rsquo;url d&amp;rsquo;accÃ¨s Ã  votre base de donnÃ©es dans le fichier et dans son nom) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;@echo off&#xA;&#xA;REM DÃ©claration d&#39;une variable pour identifier la source de donnÃ©es&#xA;set DATA_SOURCE_NAME=postgresql://postgres:postgres@127.0.0.1:5432/postgres?sslmode=disable&#xA;&#xA;REM Lancement du processus postgres_exporter.exe avec diffÃ©rentes options&#xA;postgres_exporter.exe ^&#xA;  --web.listen-address=:9187 \&#xA;  --collector.database_wraparound ^&#xA;  --collector.locks ^&#xA;  --collector.long_running_transactions ^&#xA;  --collector.postmaster ^&#xA;  --collector.stat_activity_autovacuum ^&#xA;  --collector.stat_bgwriter ^&#xA;  --collector.stat_database ^&#xA;  --collector.stat_statements ^&#xA;  --collector.stat_user_tables ^&#xA;  --collector.statio_user_indexes ^&#xA;  --collector.statio_user_tables ^&#xA;  --collector.wal&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce script permet deux choses :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;de gÃ©rer la variable &lt;code&gt;DATA_SOURCE_NAME&lt;/code&gt; qui permet de dÃ©clarer la base de donnÃ©es Ã  surveiller.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;de dÃ©clarer et Ã©ventuellement modifier facilement les options de surveillance (&lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter?tab=readme-ov-file#flags&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©taillÃ©es ici&lt;/a&gt;).&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9187&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donnÃ©es pourront Ãªtre rÃ©cupÃ©rÃ©es via HTTP.&lt;br&gt;9187 est le port par dÃ©faut mais vous pouvez en attribuer un autre si celui-ci est dÃ©jÃ  utilisÃ© ou si vous avez plusieurs instances Ã  surveiller.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La surveillance peut ensuite dÃ©marrer en lanÃ§ant le fichier &lt;code&gt;bat&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9187&lt;/code&gt;, vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005124&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.00158&#xA;go_gc_duration_seconds_sum 8.0821208&#xA;go_gc_duration_seconds_count 30800&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 16&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi Ãªtre crÃ©Ã© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de crÃ©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM, si vous avez prÃ©vu d&amp;rsquo;installer Grafana, vous pouvez attendre de l&amp;rsquo;avoir fait plutÃ´t que de tÃ©lÃ©charger NSSM.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois rÃ©cupÃ©rer, vous pourrez crÃ©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Prometheus - Postgres Exporter - 127.0.0.1:5432&#34; &#34;C:\chemin\vers\start_127.0.0.1_5432.bat&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Prometheus - Postgres Exporter - 127.0.0.1:5432&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ© (si vous avez dÃ©jÃ  PostgreSQL installÃ© il est probable que l&#39;utilisateur existe dÃ©jÃ )&#xA;sudo useradd postgres --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ©&#xA;sudo mkdir /opt/postgres_exporter&#xA;&#xA;# TÃ©lÃ©chargement de Postgres_exporter&#xA;# Attention Ã  la verion, dans le doute RDV sur le projet GitHub : https://github.com/prometheus-community/postgres_exporter&#xA;sudo wget -P /opt/postgres_exporter https://github.com/prometheus-community/postgres_exporter/releases/download/v0.15.0/postgres_exporter-0.15.0.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64.tar.gz -C /opt/postgres_exporter&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/postgres_exporter/postgres_exporter-0.15.0.linux-amd64 /opt/postgres_exporter/postgres_exporter&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown postgres:postgres -R /opt/postgres_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ons le fichier de configuration des variables d&amp;rsquo;environnement :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/postgres_exporter/postgres_exporter_127.0.0.1_5432.env&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez alors la configuration suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# BDD Ã  monitorer&#xA;DATA_SOURCE_NAME=&#34;postgresql://postgres:postgres@127.0.0.1:5432/?sslmode=disable&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Postgres Exporter. Ajoutez une information sur l&amp;rsquo;instance monitorÃ©e car postgres_exporter ne gÃ¨re pas correctement le multi-instance.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/postgres_exporter_127.0.0.1_5432.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus exporter for Postgresql&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=postgres&#xA;Group=postgres&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;&#xA;WorkingDirectory=/opt/postgres_exporter&#xA;EnvironmentFile=/opt/postgres_exporter/postgres_exporter_127.0.0.1_5432.env&#xA;ExecStart=/opt/postgres_exporter/postgres_exporter/postgres_exporter \&#xA;    --web.listen-address=:9187 \&#xA;    --collector.database_wraparound \&#xA;    --collector.locks \&#xA;    --collector.long_running_transactions \&#xA;    --collector.postmaster \&#xA;    --collector.stat_activity_autovacuum \&#xA;    --collector.stat_bgwriter \&#xA;    --collector.stat_database \&#xA;    --collector.stat_statements \&#xA;    --collector.stat_user_tables \&#xA;    --collector.statio_user_indexes \&#xA;    --collector.statio_user_tables \&#xA;    --collector.wal&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous intÃ©grons dans la ligne de commande diffÃ©rentes options de surveillance (&lt;a href=&#34;https://github.com/prometheus-community/postgres_exporter?tab=readme-ov-file#flags&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©taillÃ©es ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34; id=&#34;block-013a31d6-fbb5-4dd0-8c9a-f05ee7df2cad&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9187&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donnÃ©es pourront Ãªtre rÃ©cupÃ©rÃ©es via HTTP.&lt;br&gt;9187 est le port par dÃ©faut mais vous pouvez en attribuer un autre si celui-ci est dÃ©jÃ  utilisÃ© ou si vous avez plusieurs instances Ã  surveiller.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable postgres_exporter_127.0.0.1_5432.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start postgres_exporter_127.0.0.1_5432&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status postgres_exporter_127.0.0.1_5432&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u postgres_exporter_127.0.0.1_5432.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9187&lt;/code&gt;. Vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005124&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.00158&#xA;go_gc_duration_seconds_sum 8.0821208&#xA;go_gc_duration_seconds_count 30800&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 16&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Node Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Node Exporter est l&amp;rsquo;outil qui va collecter les mÃ©triques du systÃ¨me Linux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, il n&amp;rsquo;est pas possible de sÃ©curiser l&amp;rsquo;accÃ¨s aux donnÃ©es exportÃ©es par Node Exporter directement. L&amp;rsquo;outil ne gÃ¨re pas l&amp;rsquo;authentification, il faut donc utiliser des rÃ¨gle de pare-feu ou un serveur web frontal pour Ã©viter que n&amp;rsquo;importe qui puisse voir les donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ©&#xA;sudo useradd node_exporter --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ©&#xA;sudo mkdir /opt/node_exporter&#xA;&#xA;# TÃ©lÃ©chargement de Node_exporter&#xA;# Attention Ã  la verion, dans le doute RDV sur le site de Prometheus : https://prometheus.io/download/#node_exporter&#xA;sudo wget -P /opt/node_exporter https://github.com/prometheus/node_exporter/releases/download/v1.8.1/node_exporter-1.8.1.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/node_exporter/node_exporter-1.8.1.linux-amd64.tar.gz -C /opt/node_exporter&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/node_exporter/node_exporter-1.8.1.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/node_exporter/node_exporter-1.8.1.linux-amd64 /opt/node_exporter/node_exporter&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown node_exporter:node_exporter -R /opt/node_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Node Exporter. Ajoutez une information sur l&amp;rsquo;instance monitorÃ©e car postgres_exporter ne gÃ¨re pas correctement le multi-instance.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/node_exporter.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus exporter for Linux&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=node_exporter&#xA;Group=node_exporter&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;&#xA;WorkingDirectory=/opt/node_exporter&#xA;ExecStart=/opt/node_exporter/node_exporter/node_exporter \&#xA;    --web.listen-address=:9100 &#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous pouvons intÃ©grer dans la ligne de commande diffÃ©rentes options de surveillance (&lt;a href=&#34;https://github.com/prometheus/node_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;dÃ©taillÃ©es ici&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34; id=&#34;block-013a31d6-fbb5-4dd0-8c9a-f05ee7df2cad&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;une des options est &lt;code&gt;web.listen-adress=:9100&lt;/code&gt;, il s&amp;rsquo;agit du port sur lequel les donnÃ©es pourront Ãªtre rÃ©cupÃ©rÃ©es via HTTP.&lt;br&gt;9100 est le port par dÃ©faut mais vous pouvez en attribuer un autre si celui-ci est dÃ©jÃ  utilisÃ©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable node_exporter.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start node_exporter&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status node_exporter&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u node_exporter.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9100&lt;/code&gt;. Vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0&#xA;go_gc_duration_seconds_sum 0&#xA;go_gc_duration_seconds_count 0&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 7&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.22.3&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Windows Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Windows Exporter est l&amp;rsquo;outil qui va collecter les mÃ©triques du systÃ¨me Windows.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La procÃ©dure d&amp;rsquo;installation de cet exporter est bien dÃ©taillÃ©e sur la page du projet GitHub. Je ne la dÃ©taillerai donc pas entiÃ¨rement ici.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-vertical is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-9a7cdcfd wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/prometheus-community/windows_exporter?tab=readme-ov-file#installation&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;ProcÃ©dure d&amp;rsquo;installation de Windows Exporter&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://github.com/prometheus-community/windows_exporter/releases&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;TÃ©lÃ©chargement de Windows Exporter&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la ligne de commande utilisÃ©e pour installer l&amp;rsquo;exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;msiexec /i &#34;C:\chemin_vers\windows_exporter-0.25.1-amd64.msi&#34; LISTEN_PORT=9182 EXTRA_FLAGS=&#34;--config.file=&#34;&#34;C:\Program Files\windows_exporter\config.yml&#34;&#34;&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cela permet de configurer Windows Exporter avec un fichier de configuration afin de pouvoir facilement modifier certains paramÃ¨tres si besoin (il suffit ensuite de relancer le service pour prendre en compte le nouveau paramÃ©trage).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en rÃ©cupÃ©rant les donnÃ©es collectÃ©es en vous rendant Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9182&lt;/code&gt;. Vous devriez rÃ©cupÃ©rer quelques chose qui ressemble Ã  ceci :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;raw&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.&#xA;# TYPE go_gc_duration_seconds summary&#xA;go_gc_duration_seconds{quantile=&#34;0&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0&#xA;go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.0005129&#xA;go_gc_duration_seconds{quantile=&#34;1&#34;} 0.0005364&#xA;go_gc_duration_seconds_sum 0.0058283&#xA;go_gc_duration_seconds_count 37&#xA;# HELP go_goroutines Number of goroutines that currently exist.&#xA;# TYPE go_goroutines gauge&#xA;go_goroutines 15&#xA;# HELP go_info Information about the Go environment.&#xA;# TYPE go_info gauge&#xA;go_info{version=&#34;go1.21.5&#34;} 1&#xA;...&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Prometheus&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prometheus est l&amp;rsquo;outil qui va stocker les donnÃ©es rÃ©cupÃ©rÃ©es par Postgres Exporter. Pour cela, il doit pouvoir contacter Postgres Exporter via HTTP.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prometheus gÃ¨re l&amp;rsquo;authentification basique, il faut pour cela suivre la procÃ©dure indiquÃ©e sur le site officiel : &lt;a href=&#34;https://prometheus.io/docs/guides/basic-auth&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://prometheus.io/docs/guides/basic-auth&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par tÃ©lÃ©charger le logiciel depuis &lt;a href=&#34;https://prometheus.io/download/&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Prometheus&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le dÃ©zipper puis de la placer lÃ  oÃ¹ vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La configuration de Prometheus se fait au travers d&amp;rsquo;un fichier YAML. Un fichier de configuration de base est fournit, ouvrez le et complÃ©tez le avec les informations suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Configuration globale&#xA;global:&#xA;  # Interval global de rÃ©cupÃ©ration (dÃ©faut 1 min)&#xA;  scrape_interval: 15s&#xA;  # Interval global d&#39;Ã©valuation des rÃ¨gles (dÃ©faut 1 min)&#xA;  evaluation_interval: 15s&#xA;  # Interval global de timeout (dÃ©faut 10s)&#xA;  scrape_timeout: 10s&#xA;&#xA;# Gestionnaire d&#39;alertes&#xA;alerting:&#xA;  alertmanagers:&#xA;    - static_configs:&#xA;        - targets:&#xA;          # - alertmanager:9093&#xA;&#xA;# RÃ¨gles&#xA;rule_files:&#xA;  # - &#34;first_rules.yml&#34;&#xA;  # - &#34;second_rules.yml&#34;&#xA;&#xA;# Configuration des data scraper (rÃ©cupÃ©rateurs de donnÃ©es)&#xA;scrape_configs:&#xA;  # Prometheus lui-mÃªme&#xA;  # &#34;job_name&#34; est ajoutÃ© Ã  chaque donnÃ©e rÃ©cupÃ©rÃ©e via cette configuration&#xA;  - job_name: &#34;Prometheus - Local&#34;&#xA;    static_configs:&#xA;      # Cible Ã  atteindre&#xA;      - targets: [&#34;localhost:9090&#34;]&#xA;&#xA;    # Identifiant et mot de passe pour accÃ©der Ã  Prometheus&#xA;    basic_auth:&#xA;      username: identifiant&#xA;      password: mdp&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons ensuite sÃ©curiser l&amp;rsquo;accÃ¨s Ã  Prometheus. CrÃ©ez un fichier web.yml avec les Ã©lÃ©ments suivants (pensez Ã  utiliser les mÃªmes identifiant/mdp dans le fichier prÃ©cÃ©dent : Prometheus doit pouvoir accÃ©der Ã  lui-mÃªme pour s&amp;rsquo;auto-monitorer) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;basic_auth_users:&#xA;  # Utilisateur 1 : identifiant: mdp_encryptÃ©&#xA;  identifiant: $2a$12$P63ADVOo///fo4HiMm4sYuogjceHfzT3vfShmgAYvEw8v28Bt4GBq&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant d&amp;rsquo;utilisateurs que vous le souhaitez. Le mot de passe doit Ãªtre spÃ©cifiÃ© de faÃ§on cryptÃ© avec bcrypt. Vous pouvez utiliser un crypteur sur le web &lt;a href=&#34;https://bcrypt-generator.com/&#34;&gt;comme celui-ci&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ez ensuite un fichier &lt;code&gt;start.bat&lt;/code&gt; dans le rÃ©pertoire de Prometheus avec le contenu suivant (en remplaÃ§ant l&amp;rsquo;url d&amp;rsquo;accÃ¨s Ã  votre base de donnÃ©es dans le fichier et dans son nom) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;@echo off&#xA;&#xA;REM Lancement du processus prometheus.exe avec diffÃ©rentes options&#xA;prometheus.exe ^&#xA;  --web.listen-address=:9090 ^&#xA;  --web.config.file=web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce script permet de dÃ©clarer et Ã©ventuellement modifier facilement les options de Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;option &lt;code&gt;web.listen-adress=:9090&lt;/code&gt; permet de dÃ©finir le port d&amp;rsquo;Ã©coute. &lt;br&gt;La valeur 9090 est la valeur par dÃ©faut, cette option n&amp;rsquo;est donc pas indispensable dans notre cas.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;option &lt;code&gt;web.config.file=web.yml&lt;/code&gt; permet d&amp;rsquo;activer l&amp;rsquo;authentification.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La surveillance peut ensuite dÃ©marrer en lanÃ§ant le fichier &lt;code&gt;bat&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Prometheus Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9090&lt;/code&gt;. Vous devriez obtenir la page suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;440&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png&#34; alt=&#34;&#34; class=&#34;wp-image-3323&#34; style=&#34;width:696px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-300x129.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-768x330.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil.png 1041w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi Ãªtre crÃ©Ã© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de crÃ©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM, si vous avez prÃ©vu d&amp;rsquo;installer Grafana, vous pouvez attendre de l&amp;rsquo;avoir fait plutÃ´t que de tÃ©lÃ©charger NSSM.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois rÃ©cupÃ©rer, vous pourrez crÃ©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Prometheus&#34; &#34;C:\chemin\vers\start.exe&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;bat&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Prometheus&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux (Ubuntu/Debian) dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ©&#xA;sudo useradd prometheus --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ© et d&#39;un rÃ©pertoire pour stocker les donnÃ©es&#xA;sudo mkdir /opt/prometheus&#xA;sudo mkdir /opt/prometheus/data&#xA;&#xA;# TÃ©lÃ©chargement de Prometheus&#xA;# Attention Ã  la version qu&#39;il vous faudra adapter&#xA;sudo wget -P /opt/prometheus https://github.com/prometheus/prometheus/releases/download/v2.51.1/prometheus-2.51.1.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/prometheus/prometheus-2.51.1.linux-amd64.tar.gz -C /opt/prometheus&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/prometheus/prometheus-2.51.1.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/prometheus/prometheus-2.51.1.linux-amd64 /opt/prometheus/prometheus&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown prometheus:prometheus -R /opt/prometheus&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La configuration de Prometheus se fait au travers d&amp;rsquo;un fichier YAML. Un fichier de configuration de base est fournit, ouvrez le :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/prometheus/prometheus/prometheus.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Configuration globale&#xA;global:&#xA;  # Interval global de rÃ©cupÃ©ration (dÃ©faut 1 min)&#xA;  scrape_interval: 15s&#xA;  # Interval global d&#39;Ã©valuation des rÃ¨gles (dÃ©faut 1 min)&#xA;  evaluation_interval: 15s&#xA;  # Interval global de timeout (dÃ©faut 10s)&#xA;  scrape_timeout: 10s&#xA;&#xA;# Gestionnaire d&#39;alertes&#xA;alerting:&#xA;  alertmanagers:&#xA;    - static_configs:&#xA;        - targets:&#xA;          # - alertmanager:9093&#xA;&#xA;# RÃ¨gles&#xA;rule_files:&#xA;  # - &#34;first_rules.yml&#34;&#xA;  # - &#34;second_rules.yml&#34;&#xA;&#xA;# Configuration des data scraper (rÃ©cupÃ©rateurs de donnÃ©es)&#xA;scrape_configs:&#xA;  # Prometheus lui-mÃªme&#xA;  # &#34;job_name&#34; est ajoutÃ© Ã  chaque donnÃ©e rÃ©cupÃ©rÃ©e via cette configuration&#xA;  - job_name: &#34;Prometheus - Local&#34;&#xA;    static_configs:&#xA;      # Cible Ã  atteindre&#xA;      - targets: [&#34;localhost:9090&#34;]&#xA;&#xA;    # Identifiant et mot de passe pour accÃ©der Ã  Prometheus&#xA;    basic_auth:&#xA;      username: identifiant&#xA;      password: mdp&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons ensuite sÃ©curiser l&amp;rsquo;accÃ¨s Ã  Prometheus. CrÃ©ez un fichier web.yml avec les Ã©lÃ©ments suivants (pensez Ã  utiliser les mÃªmes identifiant/mdp dans le fichier prÃ©cÃ©dent : Prometheus doit pouvoir accÃ©der Ã  lui-mÃªme pour s&amp;rsquo;auto-monitorer) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /opt/prometheus/prometheus/web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;basic_auth_users:&#xA;  # Utilisateur 1 : identifiant: mdp_encryptÃ©&#xA;  identifiant: $2a$12$P63ADVOo///fo4HiMm4sYuogjceHfzT3vfShmgAYvEw8v28Bt4GBq&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant d&amp;rsquo;utilisateurs que vous le souhaitez. Le mot de passe doit Ãªtre spÃ©cifiÃ© de faÃ§on cryptÃ© avec bcrypt. Vous pouvez utiliser un crypteur sur le web &lt;a href=&#34;https://bcrypt-generator.com/&#34;&gt;comme celui-ci&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La rÃ©cupÃ©ration des donnÃ©es peut ensuite dÃ©marrer en lanÃ§ant le programme Prometheus via la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;/opt/prometheus/prometheus/prometheus --config.file=prometheus.yml --web.config.file=web.yml&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Prometheus Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:9090&lt;/code&gt;. Vous devriez obtenir la page suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;440&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png&#34; alt=&#34;&#34; class=&#34;wp-image-3323&#34; style=&#34;width:696px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-1024x440.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-300x129.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil-768x330.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_accueil.png 1041w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Prometheus est disponible peut Ãªtre modifier avec l&amp;rsquo;argument &lt;code&gt;--web.listen-address&lt;/code&gt; a ajouter lors du dÃ©marrage du programme (comme avec Postgres Exporter).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Prometheus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/prometheus.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Prometheus &#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=prometheus &#xA;Group=prometheus &#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;ExecStart=/opt/prometheus/prometheus/prometheus \&#xA;    --config.file=/opt/prometheus/prometheus/prometheus.yml \&#xA;    --web.config.file=/opt/prometheus/prometheus/web.yml \&#xA;    --web.listen-address=:9090 \&#xA;    --storage.tsdb.path=/opt/prometheus/data \&#xA;    --storage.tsdb.retention.time=30d&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable prometheus.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start prometheus&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status prometheus&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u prometheus.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Liaison Prometheus &amp;#8211; Exporter&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour que Prometheus rÃ©cupÃ¨re les donnÃ©es d&amp;rsquo;un Exporter que vous avez installÃ©, il vous faut Ã©diter le fichier de configuration YAML.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez un nouveau Â«Â jobÂ Â» dans la partie &lt;code&gt;scrape_configs&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour PostgreSQL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;  # PostgreSQL Monitoring avec postgres_exporter&#xA;  - job_name: &#39;PostgreSQL Exporter&#39;&#xA;    scrape_interval: 5s&#xA;    static_configs:&#xA;      # Cible Ã  atteindre&#xA;      - targets: [&#39;127.0.0.1:9187&#39;]&#xA;        labels:&#xA;          # &#34;instance&#34; est ajoutÃ© Ã  chaque donnÃ©e rÃ©cupÃ©rÃ©e et prend la valeur du paramÃ¨tre &amp;lt;targets&gt;, comme on sait qu&#39;il n&#39;y a qu&#39;un PG derriÃ¨re, on renomme l&#39;instance&#xA;          &#34;instance&#34;: &#34;127.0.0.1:5431&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour Node Exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt; # Linux Monitoring with node_exporter&#xA;  - job_name: &#39;Node Exporter&#39;&#xA;    scrape_interval: 15s&#xA;    static_configs:&#xA;      - targets: [&#39;127.0.0.1:9100&#39;]&#xA;        labels:&#xA;          &#34;instance&#34;: &#34;Mon serveur XYZ&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour Windows Exporter :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;yaml&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt; # Windows Monitoring with windows_exporter&#xA;  - job_name: &#39;Windows Exporter&#39;&#xA;    scrape_interval: 15s&#xA;    static_configs:&#xA;      - targets: [&#39;127.0.0.1:9182&#39;]&#xA;        labels:&#xA;          &#34;instance&#34;: &#34;Mon serveur ABC&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez ajouter autant de job que nÃ©cessaire, afin que votre Prometheus rÃ©cupÃ¨re des donnÃ©es de divers services.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;RedÃ©marrez le service de Prometheus et rendez-vous dans la page Â«Â StatusÂ Â» =&amp;gt; Â«Â TargetÂ Â» de l&amp;rsquo;interface, vous devriez voir la connexion avec Postgres Exporter et Node Exporter&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;520&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-1024x520.png&#34; alt=&#34;&#34; class=&#34;wp-image-3324&#34; style=&#34;width:757px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-1024x520.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-300x152.png 300w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target-768x390.png 768w, https://blog.arthurbazin.com/wp-content/uploads/prometheus_target.png 1036w&#34; sizes=&#34;(max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Grafana&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Windows&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par tÃ©lÃ©charger le logiciel depuis &lt;a href=&#34;https://grafana.com/grafana/download?platform=windows&#34; data-type=&#34;link&#34; data-id=&#34;https://github.com/prometheus-community/postgres_exporter&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Grafana&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il suffit ensuite de le dÃ©zipper puis de la placer lÃ  oÃ¹ vous le souhaitez.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le logiciel se lance simplement en dÃ©marrant le programme &lt;code&gt;grafana-server.exe&lt;/code&gt; situÃ© dans le rÃ©pertoire &lt;code&gt;bin&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Grafana Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Grafana est disponible peut Ãªtre modifier dans le fichier de configuration &lt;code&gt;conf/defaults.ini&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un service peut ainsi Ãªtre crÃ©Ã© pour automatiser le processus. Pour cela vous aurez besoin du logiciel gratuit &lt;a href=&#34;http://nssm.cc/download&#34; data-type=&#34;link&#34; data-id=&#34;http://nssm.cc/download&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;NSSM&lt;/a&gt; qui permet de crÃ©er des service Windows pour tout et n&amp;rsquo;importe quoi. Notez que Grafana embarque NSSM dans le rÃ©pertoire &lt;code&gt;svc-x&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une fois rÃ©cupÃ©rer, vous pourrez crÃ©er un service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; install &#34;Grafana&#34; &#34;C:\chemin\vers\grafana-server.exe&#34; Start Automatic&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez supprimer le service avec la ligne de commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#34;C:\emplacement\nssm.exe&#34; remove &#34;Grafana&#34; confirm&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Installation sur Linux&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe une multitude de faÃ§on d&amp;rsquo;installer Grafana sur Linux (Ubuntu/Debian).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;installation sous Linux dÃ©marre avec les commandes suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# CrÃ©ation d&#39;un utilisateur dÃ©diÃ©&#xA;sudo useradd grafana --shell /bin/bash&#xA;&#xA;# CrÃ©ation d&#39;un rÃ©pertoire dÃ©diÃ©&#xA;sudo mkdir /opt/grafana&#xA;&#xA;# TÃ©lÃ©chargement de Prometheus&#xA;# Attention Ã  la version qu&#39;il vous faudra adapter&#xA;sudo wget -P /opt/grafana https://dl.grafana.com/enterprise/release/grafana-enterprise-11.0.0.linux-amd64.tar.gz&#xA;&#xA;# DÃ©crompression&#xA;sudo tar xvzf /opt/grafana/grafana-enterprise-11.0.0.linux-amd64.tar.gz -C /opt/grafana&#xA;&#xA;# Nettoyage&#xA;sudo rm /opt/grafana/grafana-enterprise-11.0.0.linux-amd64.tar.gz&#xA;&#xA;# Retrait du numero de version dans le nom du rÃ©pertoire&#xA;sudo mv /opt/grafana/grafana-v11.0.0 /opt/grafana/grafana&#xA;&#xA;# Gestion du propriÃ©taire des fichiers&#xA;sudo chown grafana:grafana -R /opt/grafana&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le logiciel se lance simplement en dÃ©marrant le programme &lt;code&gt;grafana&lt;/code&gt; situÃ© dans le rÃ©pertoire &lt;code&gt;bin&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;grafana server&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez tester le fonctionnement en vous rendant sur l&amp;rsquo;interface de Grafana Ã  l&amp;rsquo;adresse suivante : &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le port sur lequel Grafana est disponible peut Ãªtre modifier dans le fichier de configuration &lt;code&gt;conf/defaults.ini&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut maintenant mettre en place le service qui gÃ¨rera Grafana.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo nano /etc/systemd/system/grafana.service&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Puis renseignez les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;shell&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;[Unit] &#xA;Description=Grafana&#xA;Wants=network-online.target &#xA;After=network-online.target &#xA;&#xA;[Service] &#xA;User=grafana&#xA;Group=grafana&#xA;Type=simple&#xA;Restart=always&#xA;RestartSec=1&#xA;WorkingDirectory=/opt/grafana/grafana&#xA;ExecStart=/opt/grafana/grafana/bin/grafana server&#xA;&#xA;&#xA;[Install]&#xA;WantedBy=multi-user.target&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisez les commandes suivantes pour crÃ©er et lancer le service :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;# Recharger les paramÃ¨tres des services&#xA;sudo systemctl daemon-reload&#xA;&#xA;# Activer le service au dÃ©marrage&#xA;sudo systemctl enable grafana.service&#xA;&#xA;# DÃ©marrer le service&#xA;sudo systemctl start grafana&#xA;&#xA;# Tester le dÃ©marrage du service&#xA;sudo systemctl status grafana&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour voir les logs, vous pouvez utiliser la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;sudo journalctl -u grafana.service -f&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;ParamÃ©trages&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant accÃ©der Ã  Grafana sur l&amp;rsquo;adresse &lt;code&gt;http://serveur:3000&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le premier Ã©cran vous demande de vous connecter, utilisez l&amp;rsquo;identifiant &lt;code&gt;admin&lt;/code&gt; avec &lt;code&gt;admin&lt;/code&gt; pour mot de passe. L&amp;rsquo;Ã©crans suivant vous demandera de dÃ©finir un nouveau mot de passe.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;594&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-1024x594.png&#34; alt=&#34;&#34; class=&#34;wp-image-3293&#34; style=&#34;width:604px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-1024x594.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-300x174.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in-768x446.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_sign_in.png 1034w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Dans l&amp;rsquo;interface suivante, cliquer sur l&amp;rsquo;icone pour ouvrir le menu de gauche puis sur Â«Â Add new connectionÂ Â» :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full is-resized&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;772&#34; height=&#34;462&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion.png&#34; alt=&#34;&#34; class=&#34;wp-image-3294&#34; style=&#34;width:590px;height:auto&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion.png 772w, https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion-300x180.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_new_connexion-768x460.png 768w&#34; sizes=&#34;auto, (max-width: 772px) 100vw, 772px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant ajouter une connexion vers Prometheus en renseignant son url d&amp;rsquo;accÃ¨s &lt;code&gt;http://serveur:9090&lt;/code&gt; puis en choisissant le type d&amp;rsquo;authentification Â«Â basiqueÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il ne vous reste plus qu&amp;rsquo;a crÃ©er votre tableau de bord ou en rÃ©cupÃ©rer un dÃ©jÃ  crÃ©Ã© depuis &lt;a href=&#34;https://grafana.com/grafana/dashboards/&#34; data-type=&#34;link&#34; data-id=&#34;https://grafana.com/grafana/dashboards/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;le site de Grafana&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple de tableau de bord :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-large&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-3303&#34; srcset=&#34;https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1024x542.png 1024w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-300x159.png 300w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-768x407.png 768w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1-1536x813.png 1536w, https://blog.arthurbazin.com/wp-content/uploads/grafana_dashboard-1.png 1611w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici le code json Ã  tÃ©lÃ©charger pour importer ce tableau de bord dans votre Grafana : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-16018d1d wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/wp-content/uploads/tdb_postgresql.zip&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;Tableau de bord PostgreSQL &amp;#8211; 7ko&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;MÃ©triques importantes&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quelles sont les mÃ©triques importantes Ã  surveiller ? &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Tout dÃ©pends des usages mais en voici quelques unes que j&amp;rsquo;ai pu choisir pour PostgreSQL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_up&lt;/code&gt; : l&amp;rsquo;Ã©tat actif ou non de l&amp;rsquo;instance.&lt;br&gt;C&amp;rsquo;est un peu la base de tout le monitoring&amp;#8230;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;process_start_time_seconds&lt;/code&gt; : le dÃ©lais d&amp;rsquo;activitÃ© (depuis quand la base est-elle dÃ©marrÃ©e ?)&lt;br&gt;Cela permet de repÃ©rer les redÃ©marrages de la base.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_activity_count&lt;/code&gt; et &lt;code&gt;pg_settings_max_connections&lt;/code&gt; : le nombre de connexions par rapport au nombre total de connexions possibles.&lt;br&gt;Pour savoir s&amp;rsquo;il faut augmenter le pool de connexions disponibles.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_database_size_bytes&lt;/code&gt; : la taille totale des bases de l&amp;rsquo;instance&lt;br&gt;Pour identifier celle qui pourrait poser problÃ¨me et/ou anticiper une augmentation de la capacitÃ© du serveur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_xact_commit&lt;/code&gt; et &lt;code&gt;pg_stat_database_xact_rollback&lt;/code&gt; : le taux de COMMIT et de ROLLBACK.&lt;br&gt;S&amp;rsquo;il y a beaucoup de ROLLBACK, il y a peut Ãªtre un problÃ¨me avec certaines requÃªtes.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;process_resident_memory_bytes&lt;/code&gt; et &lt;code&gt;process_cpu_seconds_total&lt;/code&gt; : les consommations RAM et CPU.&lt;br&gt;Il s&amp;rsquo;agit plus de valeur indicatives de la charge de la base, il n&amp;rsquo;y a pas de mise en rapport avec la puissance du serveur et donc pas d&amp;rsquo;information sur l&amp;rsquo;Ã©tat de charge de la machine.&lt;br&gt;Il faudra plutot surveiller le serveur en lui-mÃªme.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_tup_fetched&lt;/code&gt; et &lt;code&gt;pg_stat_database_tup_returned&lt;/code&gt; : le rapport entre le nombre de tuples lus directement dans le stockage (returned) par rapport au nombre de tuples rÃ©ellement nÃ©cessaires (fetched). Cela permet de dÃ©celer un manque d&amp;rsquo;indexation.&lt;br&gt;Par exemple, sur une table de 1000 lignes sans index, une requÃªte avec une clause ne renvoyant que 100 lignes aura un nombre de tuples Â«Â returnedÂ Â» de 1000 et un nombre de tuples Â«Â fetchedÂ Â» de 100 car il aura fallu scanner toutes les lignes pour rÃ©cupÃ©rer le rÃ©sultat. Avec un index, la valeur de returned aurait Ã©tÃ© bien moindre (probablement lÃ©gÃ¨rement supÃ©rieur Ã  100).&lt;br&gt;Attention, le nombre de tuples Â«Â fetchedÂ Â» ne correspond pas forcÃ©ment au nombre de tuples retournÃ©s au clients ce qui est interessant ici c&amp;rsquo;est bien le rapport entre les deux valeurs.&lt;br&gt;Attention, la valeur porte sur la base entiÃ¨re, il conviendra ensuite d&amp;rsquo;auditer les requÃªtes pour identifier l&amp;rsquo;origine du manque d&amp;rsquo;indexation.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_database_blks_hit&lt;/code&gt; et &lt;code&gt;pg_stat_database_blks_read&lt;/code&gt; : le nombre de blocs lu sur le disque (read) par rapport au nombre de bloc lu dans la mÃ©moire tampon (hit).&lt;br&gt;Cela permet de dÃ©tecter un Ã©ventuel manque de ressources pour la mÃ©moire tampon (paramÃ¨tre shared buffer).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_stat_user_tables_n_dead_tup&lt;/code&gt; : le nombre de tuples mort (dead tuple).&lt;br&gt;Cela permet de surveiller le bon fonctionnement du processus de VACUUM.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention, Postgres Exporter se focalise sur une seule base de donnÃ©es et ne permet donc pas d&amp;rsquo;avoir certaines mÃ©triques en Â«Â multibaseÂ Â», sur l&amp;rsquo;instance complÃ¨te (en fait si mais Â«Â c&amp;rsquo;est compliquÃ©Â Â» et non recommandÃ©). Il faudrait ainsi avoir plusieurs Postgres Exporter en parallÃ¨le, un pour chaque base d&amp;rsquo;une instance&amp;#8230; Je complÃ¨terai cet article lorsque j&amp;rsquo;aurai identifiÃ© une solution (sous peu j&amp;rsquo;espÃ¨re)&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;D&amp;rsquo;autres mÃ©triques sont intÃ©ressantes, notamment si vous avez mis en place de la rÃ©plication. Voici quelques ressources utiles :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Une liste dÃ©taillÃ©e de mÃ©triques : &lt;a href=&#34;https://www.datadoghq.com/blog/postgresql-monitoring&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.datadoghq.com/blog/postgresql-monitoring&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une autre liste de mÃ©triques : &lt;a href=&#34;https://sysdig.com/blog/postgresql-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://sysdig.com/blog/postgresql-monitoring/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des exemples de tableaux de bord : &lt;a href=&#34;https://promcat.io/apps/postgresql/latest&#34;&gt;https://promcat.io/apps/postgresql/latest&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les tableau de bord prÃ©construits pour Grafana : &lt;a href=&#34;https://grafana.com/grafana/dashboards/?search=postgresql&#34;&gt;https://grafana.com/grafana/dashboards/?search=postgresql&lt;/a&gt;&lt;br&gt;On y trouve beaucoup d&amp;rsquo;exemples et de bonnes idÃ©es.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Retrouvez Ã©galement quelques Ã©lÃ©ments dans l&amp;rsquo;article suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-embed is-type-wp-embed is-provider-bazinga-039-s wp-block-embed-bazinga-039-s&#34;&gt;&lt;div class=&#34;wp-block-embed__wrapper&#34;&gt;&#xA;&lt;blockquote class=&#34;wp-embedded-content&#34; data-secret=&#34;2qLbf2cgdB&#34;&gt;&lt;a href=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-7&#34;&gt;PostgreSQL &amp;#8211; Vade-mecum SQL &amp;#8211; 7/8 &amp;#8211; Administration serveur&lt;/a&gt;&lt;/blockquote&gt;&lt;iframe loading=&#34;lazy&#34; class=&#34;wp-embedded-content&#34; sandbox=&#34;allow-scripts&#34; security=&#34;restricted&#34;  title=&#34;Â«Â PostgreSQL &amp;#8211; Vade-mecum SQL &amp;#8211; 7/8 &amp;#8211; Administration serveurÂ Â» &amp;#8212; BazinGa&amp;#039;s&#34; src=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-7/embed#?secret=hIDLWEJ0Nz#?secret=2qLbf2cgdB&#34; data-secret=&#34;2qLbf2cgdB&#34; width=&#34;600&#34; height=&#34;338&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34;&gt;&lt;/iframe&gt;&#xA;&lt;/div&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour les serveurs Windows et Linux, cela dÃ©pendra Ã©galement ce que vous faites avec ceux-ci. Voici ce que je surveille Ã  minima :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La charge CPU&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La consommation de mÃ©moire RAM&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La consommation d&amp;rsquo;espace disque&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La quantitÃ© d&amp;rsquo;Ã©criture et de lecture sur le disque et leur rapiditÃ© (i/o).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Eventuellement le nombre d&amp;rsquo;utilisateur connectÃ©s pour un Windows.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/it/monitorer-postgresql-avec-prometheus-et-grafana" rel="alternate"></link>
    <summary type="html">Monitorez votre instance PostgreSQL avec Postgres Exporter, Prometheus et Grafana.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Stockage physique, gestion des donnÃ©es et VACUUM</title>
    <updated>2024-02-03T13:32:02Z</updated>
    <id>tag:blog.arthurbazin.com,2024-02-03:/bdd/postgresql/stockage-physique-gestion-des-donnees-et-vacuum</id>
    <content type="html">&#xA;&lt;p&gt;En SIG, on oppose souvent le stockage sous forme de fichiers plats au stockage en base de donnÃ©es. Mais comment fait PostgreSQL pour stocker rÃ©ellement les donnÃ©es ? Et bien il utilise des fichiers plats&amp;#8230; (le serpent se mort la queue). Nous allons donc dÃ©mystifier un peu ce fonctionnement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre question que j&amp;rsquo;ai pu avoir en lien avec le stockage : pourquoi aprÃ¨s avoir fait du nettoyage dans une base de donnÃ©es, l&amp;rsquo;espace disque n&amp;rsquo;avait pas franchement diminuÃ©, y compris aprÃ¨s avoir utilisÃ© la commande &lt;code&gt;VACUUM&lt;/code&gt; ? Nous allons voir d&amp;rsquo;oÃ¹ provient ce comportement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que je prendrais parfois quelques raccourcis pour pour simplifier les explications. Nous ne parlerons Ã©galement que des tables et non des index.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Fonctions personnalisÃ©es&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour nous aider dans notre quÃªte, nous allons avoir besoin d&amp;rsquo;extensions spÃ©cifiques et de fonctions crÃ©Ã©es pour l&amp;rsquo;occasion. Les voici, vous pourrez les dÃ©cortiquer une fois que vous aurez lu l&amp;rsquo;article :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;extension&#34; data-enlighter-group=&#34;install&#34;&gt;-- Ajout des extensions&#xA;CREATE EXTENSION pgstattuple;&#xA;CREATE EXTENSION pageinspect;&#xA;CREATE EXTENSION pg_freespacemap;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;table_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_table_info(relname TEXT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_table_info(relname TEXT)&#xA;RETURNS TABLE(&#xA;  &#34;schema&#34; text,&#xA;  &#34;table&#34; text,&#xA;  &#34;tablespace&#34; text,&#xA;  oid_table oid,&#xA;  numero_heap_file oid,&#xA;  heap_file_segment_0_location text,&#xA;  nb_page bigint,&#xA;  tuple_count bigint,&#xA;  dead_tuple_count bigint,&#xA;  table_length bigint,&#xA;  table_length_human text,&#xA;  tuple_length bigint,&#xA;  tuple_percent numeric,&#xA;  dead_tuple_length bigint,&#xA;  dead_tuple_percent numeric,&#xA;  free_space_length bigint,&#xA;  free_space_percent numeric,&#xA;  max_frozen_txid xid,&#xA;  n_tup_ins bigint,&#xA;  n_tup_upd bigint,&#xA;  n_tup_del bigint,&#xA;  n_mod_since_analyze bigint,&#xA;  n_ins_since_vacuum bigint,&#xA;  last_vacuum timestamp with time zone, &#xA;  last_autovacuum timestamp with time zone, &#xA;  last_analyze timestamp with time zone,&#xA;  last_autoanalyze timestamp with time zone,&#xA;  toast_oid oid,&#xA;  toast_table text,&#xA;  toast_heap_file_segment_0_location text,&#xA;  toast_nb_page bigint,&#xA;  toast_nb_tuple bigint,&#xA;  toast_length bigint,&#xA;  toast_length_human text&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION table_info(relname TEXT)&#xA; * Renvoi diffÃ©rentes informations sur une table et son stockage&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : objet Ã  analyser au choix :&#xA; *    - &#39;schema.Table&#39; : pour analyser une table en particulier.&#xA; *    - &#39;schema&#39; : pour analyser toutes les tables d&#39;un schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; * &#xA; */&#xA;DECLARE &#xA;  var_requete TEXT;&#xA;  schemaname TEXT;&#xA;  table_schema record;&#xA;  schema_check boolean DEFAULT FALSE;&#xA;  where_clause TEXT;&#xA;&#xA;BEGIN&#xA;  &#xA;  -- Nettoyage du nom d&#39;objet&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  &#xA;&#xA;&#xA;  -- L&#39;analyse porte-elle sur un schÃ©ma ?&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      TRUE&#xA;    FROM &#xA;      information_schema.schemata&#xA;    WHERE &#xA;      schema_name = $a$ || quote_literal(relname)&#xA;  ;&#xA;&#xA;  EXECUTE &#xA;    var_requete&#xA;  INTO &#xA;    schema_check&#xA;  ;&#xA;  &#xA;&#xA;  &#xA;  -- Action selon si schema/table&#xA;  IF schema_check THEN&#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for schema&#39;;&#xA;    &#xA;    -- Clause de rÃ©cupÃ©ration des donnÃ©es d&#39;un schÃ©ma&#xA;    where_clause := &#xA;      $a$pgc.relnamespace = $a$ || quote_literal(relname) || $a$::regnamespace $a$&#xA;    ;&#xA;  &#xA;    -- Boucle sur toutes les tables d&#39;un schema&#xA;    var_requete := &#xA;      $a$SELECT&#xA;        pgc.relname::TEXT AS &#34;table&#34;&#xA;      FROM&#xA;        pg_class AS pgc&#xA;      WHERE &#xA;        $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;  &#xA;    FOR table_schema IN EXECUTE var_requete&#xA;        &#xA;    LOOP&#xA;      &#xA;      var_requete := &#xA;        $a$ANALYZE $a$ || quote_ident(relname) || &#39;.&#39; || quote_ident(table_schema.&#34;table&#34;)&#xA;      ;&#xA;      &#xA;      --RAISE NOTICE USING MESSAGE = var_requete;&#xA;&#xA;        -- Analyse de la table&#xA;      EXECUTE &#xA;        var_requete&#xA;      ;&#xA;      &#xA;      &#xA;    END LOOP;&#xA;    &#xA;  &#xA;  ELSE &#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for table&#39;;&#xA;  &#xA;    -- Quotation du schema.table&#xA;    relname := &#xA;      quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;      &#39;.&#39; || &#xA;      quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;    ;&#xA;  &#xA;    -- Clause de rÃ©cuÃ©pration d&#39;une table&#xA;    where_clause :=&#xA;      $a$pgc.oid = $a$ || quote_literal(relname) || $a$::regclass $a$&#xA;    ;&#xA;&#xA;    -- Analyse de la table&#xA;    EXECUTE &#xA;      $a$ANALYZE $a$ || relname&#xA;    ;&#xA;  &#xA;  END IF;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      pgc.relnamespace::regnamespace::text AS &#34;schema&#34;,&#xA;      pgc.relname::text AS &#34;table&#34;,&#xA;      COALESCE (pgt.spcname, &#39;pg_default&#39;)::TEXT AS &#34;tablespace&#34;,&#xA;      pgc.oid AS oid_table,&#xA;      pg_relation_filenode(pgc.oid) AS numero_heap_file,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgc.oid) AS &#34;heap_file_segment_0_location&#34;,&#xA;      pgc.relpages::int AS nb_page,&#xA;      pst.tuple_count::bigint,&#xA;      pst.dead_tuple_count::bigint,&#xA;      pst.table_len::bigint AS table_length,&#xA;      pg_size_pretty(pst.table_len) AS table_length_human,&#xA;      pst.tuple_len::bigint AS tuple_length,&#xA;      pst.tuple_percent::numeric,&#xA;      pst.dead_tuple_len::bigint AS dead_tuple_length,&#xA;      pst.dead_tuple_percent::numeric,&#xA;      pst.free_space::bigint AS free_space_length,&#xA;      pst.free_percent::NUMERIC AS free_space_percent,&#xA;      pgc.relfrozenxid AS max_frozen_txid,&#xA;      psut.n_tup_ins::bigint,&#xA;      psut.n_tup_upd::bigint,&#xA;      psut.n_tup_del::bigint,&#xA;      psut.n_mod_since_analyze::bigint,&#xA;      psut.n_ins_since_vacuum::bigint,&#xA;      psut.last_vacuum, &#xA;      psut.last_autovacuum, &#xA;      psut.last_analyze,&#xA;      psut.last_autoanalyze,&#xA;      pgc.reltoastrelid AS toast_oid,&#xA;      pgct.relname::text AS toast_table,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgct.oid) AS &#34;toast_heap_file_segment_0_location&#34;,&#xA;      pgct.relpages::int AS toast_nb_page,&#xA;      pgct.reltuples::int AS toast_nb_tuple,&#xA;      pg_relation_size(pgc.reltoastrelid)::bigint AS toast_length,&#xA;      pg_size_pretty(pg_relation_size(pgc.reltoastrelid))::text AS toast_length_human&#xA;    FROM &#xA;      pg_class AS pgc&#xA;    LEFT JOIN &#xA;      pg_tablespace AS pgt &#xA;      ON pgt.oid = pgc.reltablespace &#xA;    LEFT JOIN &#xA;      pg_class AS pgct &#xA;      ON pgct.oid = pgc.reltoastrelid&#xA;    LEFT JOIN&#xA;      pg_stat_user_tables AS psut&#xA;      ON psut.relid = pgc.oid&#xA;    LEFT JOIN LATERAL&#xA;      pgstattuple(pgc.oid::regclass::text) AS pst&#xA;      ON TRUE&#xA;    WHERE &#xA;      $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;    &#xA;    RETURN QUERY EXECUTE &#xA;      var_requete&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;table_info() (PG &lt; 12)&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_table_info(relname TEXT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_table_info(relname TEXT)&#xA;RETURNS TABLE(&#xA;  &#34;schema&#34; text,&#xA;  &#34;table&#34; text,&#xA;  &#34;tablespace&#34; text,&#xA;  oid_table oid,&#xA;  numero_heap_file oid,&#xA;  heap_file_segment_0_location text,&#xA;  nb_page bigint,&#xA;  tuple_count bigint,&#xA;  dead_tuple_count bigint,&#xA;  table_length bigint,&#xA;  table_length_human text,&#xA;  tuple_length bigint,&#xA;  tuple_percent numeric,&#xA;  dead_tuple_length bigint,&#xA;  dead_tuple_percent numeric,&#xA;  free_space_length bigint,&#xA;  free_space_percent numeric,&#xA;  max_frozen_txid xid,&#xA;  n_tup_ins bigint,&#xA;  n_tup_upd bigint,&#xA;  n_tup_del bigint,&#xA;  n_mod_since_analyze bigint,&#xA;  last_vacuum timestamp with time zone, &#xA;  last_autovacuum timestamp with time zone, &#xA;  last_analyze timestamp with time zone,&#xA;  last_autoanalyze timestamp with time zone,&#xA;  toast_oid oid,&#xA;  toast_table text,&#xA;  toast_heap_file_segment_0_location text,&#xA;  toast_nb_page bigint,&#xA;  toast_nb_tuple bigint,&#xA;  toast_length bigint,&#xA;  toast_length_human text&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION table_info(relname TEXT)&#xA; * Renvoi diffÃ©rentes informations sur une table et son stockage&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : objet Ã  analyser au choix :&#xA; *    - &#39;schema.Table&#39; : pour analyser une table en particulier.&#xA; *    - &#39;schema&#39; : pour analyser toutes les tables d&#39;un schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; * &#xA; */&#xA;DECLARE &#xA;  var_requete TEXT;&#xA;  schemaname TEXT;&#xA;  table_schema record;&#xA;  schema_check boolean DEFAULT FALSE;&#xA;  where_clause TEXT;&#xA;&#xA;BEGIN&#xA;  &#xA;  -- Nettoyage du nom d&#39;objet&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  &#xA;&#xA;&#xA;  -- L&#39;analyse porte-elle sur un schÃ©ma ?&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      TRUE&#xA;    FROM &#xA;      information_schema.schemata&#xA;    WHERE &#xA;      schema_name = $a$ || quote_literal(relname)&#xA;  ;&#xA;&#xA;  EXECUTE &#xA;    var_requete&#xA;  INTO &#xA;    schema_check&#xA;  ;&#xA;  &#xA;&#xA;  &#xA;  -- Action selon si schema/table&#xA;  IF schema_check THEN&#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for schema&#39;;&#xA;    &#xA;    -- Clause de rÃ©cupÃ©ration des donnÃ©es d&#39;un schÃ©ma&#xA;    where_clause := &#xA;      $a$pgc.relnamespace = $a$ || quote_literal(relname) || $a$::regnamespace $a$&#xA;    ;&#xA;  &#xA;    -- Boucle sur toutes les tables d&#39;un schema&#xA;    var_requete := &#xA;      $a$SELECT&#xA;        pgc.relname::TEXT AS &#34;table&#34;&#xA;      FROM&#xA;        pg_class AS pgc&#xA;      WHERE &#xA;        $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;  &#xA;    FOR table_schema IN EXECUTE var_requete&#xA;        &#xA;    LOOP&#xA;      &#xA;      var_requete := &#xA;        $a$ANALYZE $a$ || quote_ident(relname) || &#39;.&#39; || quote_ident(table_schema.&#34;table&#34;)&#xA;      ;&#xA;      &#xA;      --RAISE NOTICE USING MESSAGE = var_requete;&#xA;&#xA;        -- Analyse de la table&#xA;      EXECUTE &#xA;        var_requete&#xA;      ;&#xA;      &#xA;      &#xA;    END LOOP;&#xA;    &#xA;  &#xA;  ELSE &#xA;  &#xA;    RAISE NOTICE USING message = &#39;ANALYZE for table&#39;;&#xA;  &#xA;    -- Quotation du schema.table&#xA;    relname := &#xA;      quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;      &#39;.&#39; || &#xA;      quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;    ;&#xA;  &#xA;    -- Clause de rÃ©cuÃ©pration d&#39;une table&#xA;    where_clause :=&#xA;      $a$pgc.oid = $a$ || quote_literal(relname) || $a$::regclass $a$&#xA;    ;&#xA;&#xA;    -- Analyse de la table&#xA;    EXECUTE &#xA;      $a$ANALYZE $a$ || relname&#xA;    ;&#xA;  &#xA;  END IF;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  var_requete := &#xA;    $a$SELECT &#xA;      pgc.relnamespace::regnamespace::text AS &#34;schema&#34;,&#xA;      pgc.relname::text AS &#34;table&#34;,&#xA;      COALESCE (pgt.spcname, &#39;pg_default&#39;)::TEXT AS &#34;tablespace&#34;,&#xA;      pgc.oid AS oid_table,&#xA;      pg_relation_filenode(pgc.oid) AS numero_heap_file,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgc.oid) AS &#34;heap_file_segment_0_location&#34;,&#xA;      pgc.relpages::int AS nb_page,&#xA;      pst.tuple_count::bigint,&#xA;      pst.dead_tuple_count::bigint,&#xA;      pst.table_len::bigint AS table_length,&#xA;      pg_size_pretty(pst.table_len) AS table_length_human,&#xA;      pst.tuple_len::bigint AS tuple_length,&#xA;      pst.tuple_percent::numeric,&#xA;      pst.dead_tuple_len::bigint AS dead_tuple_length,&#xA;      pst.dead_tuple_percent::numeric,&#xA;      pst.free_space::bigint AS free_space_length,&#xA;      pst.free_percent::NUMERIC AS free_space_percent,&#xA;      pgc.relfrozenxid AS max_frozen_txid,&#xA;      psut.n_tup_ins::bigint,&#xA;      psut.n_tup_upd::bigint,&#xA;      psut.n_tup_del::bigint,&#xA;      psut.n_mod_since_analyze::bigint,&#xA;      psut.last_vacuum, &#xA;      psut.last_autovacuum, &#xA;      psut.last_analyze,&#xA;      psut.last_autoanalyze,&#xA;      pgc.reltoastrelid AS toast_oid,&#xA;      pgct.relname::text AS toast_table,&#xA;      current_setting(&#39;data_directory&#39;) || &#39;/&#39; || pg_relation_filepath(pgct.oid) AS &#34;toast_heap_file_segment_0_location&#34;,&#xA;      pgct.relpages::int AS toast_nb_page,&#xA;      pgct.reltuples::int AS toast_nb_tuple,&#xA;      pg_relation_size(pgc.reltoastrelid)::bigint AS toast_length,&#xA;      pg_size_pretty(pg_relation_size(pgc.reltoastrelid))::text AS toast_length_human&#xA;    FROM &#xA;      pg_class AS pgc&#xA;    LEFT JOIN &#xA;      pg_tablespace AS pgt &#xA;      ON pgt.oid = pgc.reltablespace &#xA;    LEFT JOIN &#xA;      pg_class AS pgct &#xA;      ON pgct.oid = pgc.reltoastrelid&#xA;    LEFT JOIN&#xA;      pg_stat_user_tables AS psut&#xA;      ON psut.relid = pgc.oid&#xA;    LEFT JOIN LATERAL&#xA;      pgstattuple(pgc.oid::regclass::text) AS pst&#xA;      ON TRUE&#xA;    WHERE &#xA;      $a$ || where_clause&#xA;    ;&#xA;  &#xA;    --RAISE NOTICE USING MESSAGE = var_requete;&#xA;    &#xA;    RETURN QUERY EXECUTE &#xA;      var_requete&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;heap_page_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les pages d&#39;une table&#xA;DROP FUNCTION IF EXISTS public.get_heap_page_info(relname TEXT, page_number INT);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_heap_page_info(relname TEXT, page_number INT DEFAULT -1)&#xA;RETURNS TABLE(&#xA;  page_num int,&#xA;  lsn pg_lsn, &#xA;  nb_pointer int,&#xA;  nb_tuple int,&#xA;  nb_tuple_visible int,&#xA;  length_header int,&#xA;  length_pointer int,&#xA;  length_free_space int,&#xA;  length_tuple int,&#xA;  length_meta int,&#xA;  length_data int,&#xA;  length_empty int,&#xA;  length_special int,&#xA;  offset_pointer int,&#xA;  offset_free_space int,&#xA;  offset_data int,&#xA;  offset_special int,&#xA;  offset_page_end int,&#xA;  unused_line_pointer bool,&#xA;  no_free_space bool,&#xA;  all_visible bool&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION heap_page_info(relname TEXT, page_number INT)&#xA; * Renvoi diffÃ©rentes informations sur les pages d&#39;une table&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : table Ã  analyser prÃ©fixÃ©e par son schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; *  page_number INT : (facultatif) numÃ©ro de page Ã  analyser.&#xA; *    Sans ce paramÃ¨tre, toutes les pages sont remontÃ©es&#xA; * &#xA; */&#xA;BEGIN&#xA;  -- Quotation du schema.table&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  relname := &#xA;    quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;    &#39;.&#39; || &#xA;    quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;  ;&#xA;  &#xA;  &#xA;  -- Analyse de la table&#xA;  EXECUTE &#xA;    $a$ANALYZE $a$ || relname ;&#xA;&#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  RETURN QUERY EXECUTE &#xA;    $a$SELECT&#xA;      pages.page_num,&#xA;      -- Identifiant xlog de la derniÃ¨re opÃ©ration effectuÃ©e sur la page.&#xA;      ph.lsn,&#xA;      tm.count_pointer::int AS nb_pointer,&#xA;      tm.count_tuple::int AS nb_tuple,&#xA;      tm.count_tuple_visible::int AS nb_tuple_visible,&#xA;      24::int AS length_header,&#xA;      (ph.lower - 24)::int AS length_pointer,&#xA;      (ph.upper - ph.lower)::int AS length_free_space,&#xA;      (ph.special - ph.upper)::int AS length_tuple,&#xA;      (tm.length_meta)::int,&#xA;      (tm.length_data)::int,&#xA;      (tm.length_empty)::int,&#xA;      (ph.pagesize - ph.special)::int AS length_special,&#xA;      24::int AS offset_pointer,&#xA;      (ph.lower)::int AS offset_free_space,&#xA;      (ph.upper)::int AS offset_data,&#xA;      (ph.special)::int AS offset_special,&#xA;      (ph.pagesize)::int AS offset_page_end,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0001&#39;) = (x&#39;0001&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS unused_line_pointer,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0002&#39;) = (x&#39;0002&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS no_free_space,&#xA;      CASE &#xA;        WHEN (ph.flags::int::bit(16) &amp;amp; x&#39;0004&#39;) = (x&#39;0004&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS all_visible&#xA;    FROM &#xA;      pg_catalog.pg_class AS pgc&#xA;    LEFT JOIN LATERAL &#xA;        generate_series(0, pgc.relpages - 1) AS pages(page_num)&#xA;        ON TRUE&#xA;    LEFT JOIN LATERAL&#xA;        page_header(&#xA;          get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;        ) AS ph&#xA;        ON TRUE&#xA;    LEFT JOIN LATERAL (&#xA;        SELECT&#xA;          -- Nombre de pointeur&#xA;          count(1) AS count_pointer,&#xA;          -- Nombre de tuples&#xA;          count(&#xA;            CASE &#xA;              WHEN hpi.lp_len &gt; 0 THEN 1&#xA;            END&#xA;          ) AS count_tuple,&#xA;          -- Nombre de tuples visibles&#xA;          count(&#xA;            CASE &#xA;              WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39;)  &#xA;              OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0800&#39;)&#xA;              OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0200&#39; | x&#39;0800&#39;)&#xA;                THEN 1&#xA;            END&#xA;          ) AS count_tuple_visible,&#xA;          -- Longueur des mÃ©tadonnÃ©es&#xA;          sum(hpi.t_hoff::int) AS length_meta,&#xA;          -- Longueur des donnÃ©es&#xA;          sum((hpi.lp_len - hpi.t_hoff)::int) AS length_data,&#xA;          -- Longueur des espaces vides&#xA;          sum(((ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8) - (hpi.lp_off + hpi.lp_len))::int) AS length_empty&#xA;        FROM&#xA;          heap_page_items(&#xA;            get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;          ) AS hpi &#xA;        ) AS tm&#xA;        ON TRUE&#xA;    WHERE &#xA;      pgc.oid = $a$ || quote_literal(relname) || $a$::regclass &#xA;    AND (&#xA;      (&#xA;        $a$ || page_number || $a$ &amp;lt;&gt; -1&#xA;        AND&#xA;        $a$ || page_number || $a$ = pages.page_num&#xA;      )OR &#xA;      $a$ || page_number || $a$ = - 1&#xA;    ) $a$&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;heap_tuple_info()&#34; data-enlighter-group=&#34;install&#34;&gt;-- Fonction de rÃ©cupÃ©ration des informations sur les tuples&#xA;DROP FUNCTION IF EXISTS public.get_heap_tuple_info(relname text);&#xA;&#xA;CREATE OR REPLACE FUNCTION public.get_heap_tuple_info(relname TEXT, page_number INT DEFAULT -1)&#xA;RETURNS TABLE(&#xA;  ctid tid, &#xA;  page_num int,&#xA;  page_index int, &#xA;  offset_start int,&#xA;  offset_end int,&#xA;  offset_next int,&#xA;  length_tuple int,&#xA;  length_meta int,&#xA;  length_data int,&#xA;  length_empty int,&#xA;  xmin text, &#xA;  xmax text, &#xA;  state text,&#xA;  visible bool,&#xA;  &#34;update&#34; bool,&#xA;  direction text,&#xA;  hot bool,&#xA;  &#34;delete&#34; bool, &#xA;  &#34;freeze&#34; bool,&#xA;  info text[]&#xA;)&#xA;AS $function$&#xA;/*&#xA; * FUNCTION heap_tuple_info(relname TEXT, page_number INT)&#xA; * Renvoi diffÃ©rentes informations sur les tuples prÃ©sents dans les pages d&#39;une table&#xA; * &#xA; * PARAMETERS&#xA; *  relname TEXT : table Ã  analyser prÃ©fixÃ©e par son schÃ©ma.&#xA; *    Les noms d&#39;objet n&#39;ont pas besoin d&#39;Ãªtre quotÃ©s.&#xA; *  page_number INT : (facultatif) numÃ©ro de page Ã  analyser.&#xA; *    Sans ce paramÃ¨tre, tous les tuples de toutes les pages sont remontÃ©s&#xA; * &#xA; */&#xA;BEGIN&#xA;  -- Quotation du schema.table&#xA;  relname := replace(relname, &#39;&#34;&#39;, &#39;&#39;);&#xA;  relname := &#xA;    quote_ident((regexp_match(relname, &#39;(.*)\..+&#39;))[1]) || &#xA;    &#39;.&#39; || &#xA;    quote_ident((regexp_match(relname, &#39;.*\.(.+)&#39;))[1])&#xA;  ;&#xA;  &#xA;  -- Analyse de la table&#xA;  EXECUTE &#xA;    $a$ANALYZE $a$ || relname ;&#xA;  &#xA;&#xA;  &#xA;  -- Renvoi des statistiques&#xA;  RETURN QUERY EXECUTE &#xA;    $a$SELECT&#xA;      -- Indentifiant du tuple&#xA;      hpi.t_ctid AS ctid,&#xA;      -- NumÃ©ro de page&#xA;      pages.page_num,&#xA;      -- Index dans la page&#xA;      hpi.lp::int AS page_index,&#xA;      -- DÃ©but du tuple dans la page&#xA;      hpi.lp_off::int AS offset_start,&#xA;      -- Fin du tuple dans la page&#xA;      (hpi.lp_off + hpi.lp_len)::int AS offset_end,&#xA;      -- DÃ©but du tuple suivant dans la page&#xA;      (ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8)::int AS offset_next,&#xA;      -- Longueur du tuple&#xA;      hpi.lp_len::int AS length_tuple,&#xA;      -- Longueur des mÃ©tadonnÃ©es&#xA;      hpi.t_hoff::int AS length_meta,&#xA;      -- Longueur des donnÃ©es&#xA;      (hpi.lp_len - hpi.t_hoff)::int AS length_data,&#xA;      -- Longueur de l&#39;espacement avant le tuple suivant&#xA;      ((ceil((hpi.lp_off + hpi.lp_len)::numeric / 8) * 8) - (hpi.lp_off + hpi.lp_len))::int AS length_empty,&#xA;      -- ID de transaction de dÃ©but de vie&#xA;      --    c : transaction commitÃ©e&#xA;      --    a : transaction annulÃ©e&#xA;      concat(&#xA;        hpi.t_xmin,&#xA;        CASE &#xA;          WHEN ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) &amp;amp; (x&#39;0100&#39; | x&#39;0200&#39;)) = (x&#39;0100&#39; | x&#39;0200&#39;) THEN &#39; - f&#39;&#xA;          WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0100&#39;) = x&#39;0100&#39; THEN &#39; - c&#39;&#xA;          WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0200&#39;) = x&#39;0200&#39; THEN &#39; - a&#39;&#xA;        END&#xA;      ) AS xmin,&#xA;      -- ID de transaction de fin de vie&#xA;      --    c : transaction commitÃ©e&#xA;      --    a : transaction annulÃ©e&#xA;      NULLIF(&#xA;        concat(&#xA;          hpi.t_xmax,&#xA;          CASE &#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0400&#39;) = x&#39;0400&#39; THEN &#39; - c&#39;&#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0800&#39;) = x&#39;0800&#39; THEN &#39; - a&#39;&#xA;          END&#xA;        ),&#xA;        &#39;0 - a&#39;&#xA;      ) AS xmax,&#xA;      -- Etat de la ligne&#xA;      CASE lp_flags&#xA;        WHEN 0 THEN &#39;unused&#39;&#xA;        WHEN 1 THEN &#39;normal&#39;&#xA;        WHEN 2 THEN &#39;redirect to &#39;||lp_off&#xA;        WHEN 3 THEN &#39;dead&#39;&#xA;      END AS state,&#xA;      -- VisibilitÃ© actuelle du tuple&#xA;      CASE &#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39;)  &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0800&#39;)&#xA;          THEN TRUE&#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0200&#39;) &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0200&#39; | x&#39;0800&#39;)  &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0000&#39;) &#xA;        OR   (t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0400&#39;) &#xA;          THEN FALSE&#xA;        ELSE FALSE&#xA;      END AS visible,&#xA;      -- Tuple concernÃ© par un UPDATE&#xA;      CASE &#xA;        WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;)&#xA;        OR t_infomask IS NULL &#xA;        OR ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;4000&#39;)) = (x&#39;4000&#39;)&#xA;        OR ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) = (x&#39;0100&#39; | x&#39;0400&#39;) AND NOT (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;))&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS &#34;update&#34;,&#xA;      -- Si concernÃ© par un UPDATE, tuple initial (to) ou final (from)&#xA;      NULLIF(&#xA;        concat_ws(&#xA;          &#39; and &#39;,&#xA;          CASE &#xA;            WHEN (t_infomask::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;2000&#39;)&#xA;              THEN &#39;from&#39;&#xA;          END,&#xA;          CASE &#xA;            WHEN t_infomask IS NULL &#xA;            OR ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;4000&#39;)) = (x&#39;4000&#39;)&#xA;              THEN &#39;to&#39;&#xA;          END&#xA;        ),&#xA;        &#39;&#39;&#xA;      ) || &#39; another line&#39; AS direction,&#xA;      -- Tuple hot updated &#xA;      --    le tuple actuel et son ancienne version sont sur la mÃªme page&#xA;      CASE &#xA;        WHEN (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;4000&#39;)&#xA;        OR (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;8000&#39;)&#xA;        OR (t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) = (x&#39;4000&#39; | x&#39;8000&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE&#xA;      END AS hot,&#xA;      -- Tuple supprimÃ© (ou attribut clÃ© mis Ã  jour)&#xA;      CASE &#xA;        WHEN ((t_infomask2::int::bit(16) &amp;amp; x&#39;F000&#39;) &amp;amp; (x&#39;2000&#39;)) = (x&#39;2000&#39;)&#xA;          THEN TRUE &#xA;        ELSE FALSE&#xA;      END AS &#34;delete&#34;,&#xA;      -- Identifiant de transaction xmin gelÃ©&#xA;      CASE &#xA;        WHEN ((t_infomask::int::bit(16) &amp;amp; x&#39;0F00&#39;) &amp;amp; (x&#39;0100&#39; | x&#39;0200&#39;)) = (x&#39;0100&#39; | x&#39;0200&#39;)&#xA;          THEN TRUE&#xA;        ELSE FALSE &#xA;      END AS &#34;freeze&#34;,&#xA;      -- Drapeaux d&#39;information&#xA;      ARRAY(&#xA;        SELECT&#xA;          array_to_string(&#xA;            regexp_matches(&#xA;              heap_tuple_infomask_flags(t_infomask, t_infomask2)::TEXT,&#xA;              &#39;[A-Za-z0-9_\-]+&#39;,&#xA;              &#39;g&#39;&#xA;            ),&#xA;            &#39;&#39;&#xA;          )&#xA;      )::text[] AS info&#xA;    FROM &#xA;      pg_catalog.pg_class AS pgc,&#xA;      LATERAL &#xA;        generate_series(0, pgc.relpages - 1) AS pages(page_num),&#xA;      LATERAL&#xA;        heap_page_items(&#xA;          get_raw_page(pgc.oid::regclass::text, pages.page_num)&#xA;        ) AS hpi&#xA;    WHERE &#xA;      pgc.oid = $a$ || quote_literal(relname) || $a$::regclass &#xA;    AND (&#xA;      (&#xA;        $a$ || page_number || $a$ &amp;lt;&gt; -1&#xA;        AND&#xA;        $a$ || page_number || $a$ = pages.page_num&#xA;      )OR &#xA;      $a$ || page_number || $a$ = - 1&#xA;    ) $a$&#xA;    ;&#xA;&#xA;    RETURN;&#xA;END&#xA;$function$&#xA;LANGUAGE PLPGSQL&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Stockage physique&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CÃ´tÃ© base, les donnÃ©es sont structurÃ©es de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Base de donnÃ©es&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;SchÃ©ma&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Table&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Ligne&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Attribut&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Mais dans le systÃ¨me de fichiers, les donnÃ©es sont structurÃ©es diffÃ©remment :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un rÃ©pertoire racine par tablespace.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un rÃ©pertoire par base de donnÃ©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des fichiers spÃ©cifiques pour chaque table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Tablespace&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le lien entre les donnÃ©es et le systÃ¨me de fichier se matÃ©rialise en base via le tablespace. Cet objet permet aux administrateurs de dÃ©finir l&amp;#8217;emplacement des donnÃ©es. Par dÃ©faut deux tablespaces existent et pointent vers le rÃ©pertoire &lt;code&gt;$PGDATA/base&lt;/code&gt; du rÃ©pertoire (sur Windows, il s&amp;rsquo;agit par dÃ©faut de Â«Â C:\Program Files\PostgreSQL\16\data\baseÂ Â»). Il s&amp;rsquo;se nomment :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_default&lt;/code&gt; : emplacement de stockage par dÃ©faut.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_global&lt;/code&gt; : emplacement de stockage des objets contenant le &lt;a href=&#34;https://www.postgresql.org/docs/current/catalogs.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;catalogue systÃ¨me&lt;/a&gt; (donnÃ©es sur le cluster).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est possible crÃ©er un nouveau tablespace pour stocker des donnÃ©es sur un stockage spÃ©cifique (un disque dur plus rapide par exemple) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLESPACE pgraster_data&#xA;&#x9;OWNER postgres&#xA;&#x9;LOCATION &#39;C:\mon_repertoire\de_stockage&#39;&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un tablespace est liÃ© Ã  une instance PostgreSQL et ne peut pas Ãªtre ouvert par une instance autre que celle qui l&amp;rsquo;a crÃ©Ã©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un tablespace non trouvable (dÃ©faillance du disque dur, dÃ©placement&amp;#8230;) peut empÃªcher le dÃ©marrage de l&amp;rsquo;instance PostgreSQL.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;un tablespace peut Ãªtre utilisÃ© par n&amp;rsquo;importe qu&amp;rsquo;elle base de donnÃ©e de l&amp;rsquo;instance Ã  laquelle il appartient.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;un tablespace ne peut Ãªtre supprimÃ© tant qu&amp;rsquo;un objet est stockÃ© dedans.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque vous crÃ©ez un tablespace, un lien symbolique est crÃ©Ã© dans le rÃ©pertoire &lt;code&gt;$PGDATE/pg_tblspc&lt;/code&gt; et pointe vers le rÃ©pertoire dÃ©finit pour stocker les donnÃ©es du tablespace.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez lister les diffÃ©rents tablespaces ainsi que leurs emplacements de stockage grÃ¢ce Ã  la commande suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  pt.spcname AS nom,&#xA;  pa.rolname AS proprietaire,&#xA;  pg_tablespace_location(pt.oid) AS emplacement,&#xA;  pg_size_pretty(pg_tablespace_size(pt.oid)) AS poids&#xA;FROM &#xA;  pg_tablespace AS pt&#xA;LEFT JOIN&#xA;  pg_authid AS pa&#xA;  ON pa.oid = pt.spcowner&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fichiers&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le systÃ¨me de fichier, les donnÃ©es sont stockÃ©es dans le rÃ©pertoire du tablespace et s&amp;rsquo;organise assez simplement : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un rÃ©pertoire par base de donnÃ©es, dont le nom correspond Ã  l&amp;rsquo;OID de la base au sein de l&amp;rsquo;instance PostgreSQL.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Un ensemble de fichiers par table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque table il existe un ou plusieurs fichiers dont le nom dÃ©bute toujours par un numÃ©ro nommÃ© &lt;em&gt;filenode&lt;/em&gt; qui correspond souvent Ã  l&amp;rsquo;OID de la table (mais pas toujours, par exemple lorsqu&amp;rsquo;une table est rÃ©Ã©crite, un nouveau fichier est crÃ©Ã© avec un nouveau numÃ©ro ; voir &lt;a href=&#34;#vacuum&#34;&gt;la partir sur les VACUUM&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pourrez trouver les fichiers suivants pour chaque table (exemple pour un filenode = 112233 ) : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le &lt;strong&gt;heap file&lt;/strong&gt; : ensemble de fichiers contenant les donnÃ©es.&lt;br&gt;Chaque fichier du &lt;em&gt;heap file&lt;/em&gt; est appelÃ© segment et ne peut exÃ©der 1 Go, il y a donc un nombre de segments diffÃ©rent selon la taille de la table.&lt;br&gt;Le premier segment est nommÃ© &lt;code&gt;filenode&lt;/code&gt; sans extension (&lt;code&gt;112233&lt;/code&gt; dans notre exemple), le second se voit ajouter l&amp;rsquo;extension Â«Â 1Â Â» (&lt;code&gt;112233.1&lt;/code&gt;), le troisiÃ¨me l&amp;rsquo;extension Â«Â 2Â Â» (&lt;code&gt;11223.2&lt;/code&gt;) et ainsi de suite&amp;#8230;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La &lt;strong&gt;free space map&lt;/strong&gt; : liste l&amp;rsquo;espace disponible dans chaque page.&lt;br&gt;Le fichier est nommÃ©  &lt;code&gt;filenode_fsm&lt;/code&gt; (&lt;code&gt;112233_fsm&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La &lt;strong&gt;visibility map&lt;/strong&gt; : liste indiquant pour chaque page si toutes les lignes sont visibles pour toutes les transactions et si tous les tuples sont gelÃ©s. Cela permet au VACUUM de ne pas avoir Ã  scanner ces pages afin d&amp;rsquo;aller plus vite.&lt;br&gt;Le fichier est nommÃ© &lt;code&gt;filenode_vm&lt;/code&gt; (&lt;code&gt;112233_vm&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;MÃªme si c&amp;rsquo;est trÃ¨s rare, les fichiers fsm et vm peuvent se voir attribuer des extensions Â«Â 1Â Â», Â«Â 2Â Â»&amp;#8230; s&amp;rsquo;ils dÃ©passent 1 Go et que d&amp;rsquo;autres fichiers doivent Ãªtre crÃ©Ã©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un graphique pour vous reprÃ©senter la rÃ©partition des donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_filesystem.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3002&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Exemple d&amp;rsquo;une carte de visibilitÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Only visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Only frozen&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La premiÃ¨re page ne contient que des tuples visibles, en revanche, les pages d&amp;rsquo;aprÃ¨s contiennent des tuples non visibles : il s&amp;rsquo;agit de tuples supprimÃ©s qui sont encore prÃ©sents dans la base et en attente de suppression par le &lt;code&gt;VACUUM&lt;/code&gt;. Ce dernier n&amp;rsquo;a donc pas besoin de travailler sur la premiÃ¨re page pour le nettoyage. Nous allons voir dans le paragraphe suivant ce qu&amp;rsquo;est un tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Page&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour faciliter la gestion des donnÃ©es, leur stockage au sein des segments du &lt;em&gt;heap file&lt;/em&gt; se fait sous la forme de paquets de 8 ko de donnÃ©es (paramÃ©trable mais par dÃ©faut 8 ko). Un paquet de donnÃ©es est appelÃ© &lt;strong&gt;page&lt;/strong&gt; (ou bloc). Un segment peut donc contenir plusieurs pages.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3007&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Les pages sont toujours structurÃ©es de la mÃªme faÃ§on :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;diffÃ©rentes mÃ©tadonnÃ©es sur la page (24 octets).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Les pointeurs :&lt;/strong&gt; il s&amp;rsquo;agit de donnÃ©es contenant l&amp;#8217;emplacement de chaque tuple stockÃ© dans la page (4 octets chacun).&lt;br&gt;Les index rÃ©fÃ©rencent ces pointeurs.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;espace restant disponible dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Les tuples :&lt;/strong&gt; un tuple Ã©quivaut Ã  une ligne dans la table. &lt;br&gt;Il s&amp;rsquo;agit d&amp;rsquo;un ensemble de mÃ©tadonnÃ©es associÃ©es aux valeurs des attributs de la ligne les unes Ã  la suite des autres.&lt;br&gt;Les Ã©lÃ©ments sont positionnÃ©s dans l&amp;rsquo;ordre inverse : du dernier au premier et accolÃ©s Ã  la fin de la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Des donnÃ©es spÃ©cifiques (uniquement pour les table d&amp;rsquo;index).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3097&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;La page est considÃ©rÃ©e comme complÃ¨te lorsque l&amp;rsquo;espace disponible vient Ã  manquer : au fur et Ã  mesure du remplissage, les pointeurs rejoignent les tuples et l&amp;rsquo;espace entre les deux devient insuffisant pour stocker un nouvel Ã©lÃ©ment.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que les tuples sont toujours placÃ©s de faÃ§on Ã  Ãªtre alignÃ©s sur des multiples de 8 octets. Ce positionnement entraine la prÃ©sence d&amp;rsquo;espace entre les tuples lorsque ceux-ci ne possÃ¨dent pas une longueur multiple de 8.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Avec une telle structure, vous pouvez donc voir que lorsque PostgreSQL crÃ©Ã© une nouvelle page, celle-ci occupe immÃ©diatement 8 ko, mÃªme si elle est presque vide car il s&amp;rsquo;agit d&amp;rsquo;un conteneur de taille fixe. Ainsi, une base PostgreSQL grossit par multiple de 8 ko.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la lecture des donnÃ©es, il y a deux cas :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le scan sÃ©quentiel : lors d&amp;rsquo;un parcours complet de la table, PostgreSQL lit chaque pointeur ce qui lui permet ensuite d&amp;rsquo;aller lire chaque tuple.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le scan indexÃ© : lors d&amp;rsquo;un parcours via un index, ce dernier contient le numÃ©ro de page ainsi que l&amp;#8217;emplacement du pointeur de chaque donnÃ©e indexÃ©e. &lt;br&gt;PostgreSQL n&amp;rsquo;a plus qu&amp;rsquo;a parcourir les pointeurs pour rÃ©cupÃ©rer la donnÃ©e sans avoir Ã  lire tous les tuples (scan sÃ©quentiel). &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Tuple&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es de toutes les colonnes d&amp;rsquo;une ligne sont stockÃ©es au sein d&amp;rsquo;un tuple (en franÃ§ais Â«Â upletÂ Â»). Pour faire simple, il s&amp;rsquo;agit d&amp;rsquo;une liste de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les tuples sont organisÃ©s de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Un en-tÃªte contenant l&amp;rsquo;identifiant du tuple (ctid), des donnÃ©es de visibilitÃ© de transaction (t_xmin et t_xmax) et d&amp;rsquo;autres Ã©lÃ©ments que nous verrons plus tard.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Une carte des valeurs &lt;code&gt;NULL&lt;/code&gt; au sein de la ligne. &lt;br&gt;Cette carte n&amp;rsquo;est prÃ©sente que si la ligne contient des valeurs &lt;code&gt;NULL&lt;/code&gt;.&lt;br&gt;Il s&amp;rsquo;agit d&amp;rsquo;une suite de valeurs boolÃ©enne reprÃ©sentant chaque colonne (dans l&amp;rsquo;ordre donc) avec Â«Â 1Â Â» indiquant la prÃ©sence d&amp;rsquo;une valeur &lt;code&gt;NULL&lt;/code&gt;, Â«Â 0Â Â» dans le cas contraire.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les donnÃ©es les unes Ã  la suite des autres.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;en-tÃªte d&amp;rsquo;un tuple mesurant 23 octets, il y a donc 1 octet ajoutÃ© pour l&amp;rsquo;alignement si aucune carte de valeurs &lt;code&gt;NULL&lt;/code&gt; n&amp;rsquo;existe : c&amp;rsquo;est la taille minimum d&amp;rsquo;un tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le placement des donnÃ©es au sein du tuple se fait dans l&amp;rsquo;ordre de dÃ©finition des colonnes en respectant deux rÃ¨gles : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;espace occupÃ© dÃ©pend du type :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;espace peut Ãªtre fixe (smallint, integer, bigint&amp;#8230;)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;espace peut Ãªtre variable et dÃ©pend donc de la donnÃ©e (varchar, text&amp;#8230;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;#8217;emplacement d&amp;rsquo;une donnÃ©e par rapport Ã  la prÃ©cÃ©dente dÃ©pend du type :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;#8217;emplacement peut Ãªtre alignÃ© (smallint, integer, bigint&amp;#8230;) (mÃªme principe que l&amp;rsquo;alignement des tuples dans la page sauf qu&amp;rsquo;ici la longueur est variable).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;#8217;emplacement peut Ãªtre non alignÃ© (boolÃ©en, varchar&amp;#8230;)&lt;br&gt;Si ce type de donnÃ©e est en premiÃ¨re position et qu&amp;rsquo;aucune carte de valeurs NULL n&amp;rsquo;est prÃ©sente, un alignement sur le 24&lt;sup&gt;Ã¨me&lt;/sup&gt; octet est tout de mÃªme rÃ©alisÃ©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques cas de figure pour les types les plus utilisÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;BoolÃ©en :&lt;/strong&gt;&lt;br&gt;Pas d&amp;rsquo;alignement : se place directement aprÃ¨s la donnÃ©e de la colonne prÃ©cÃ©dente.&lt;br&gt;Espace occupÃ© de 1 octet.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Smallint &amp;#8211; int2 :&lt;/strong&gt; &lt;br&gt;Alignement sur un multiple de 2 octets.&lt;br&gt;Espace occupÃ© de 2 octets.&lt;br&gt;Attention Ã  ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occupÃ© qui sont les mÃªmes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Integer &amp;#8211; int4 :&lt;/strong&gt;  &lt;br&gt;Alignement sur un multiple de 4 octets.&lt;br&gt;Espace occupÃ© de 4 octets.&lt;br&gt;Attention Ã  ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occupÃ© qui sont les mÃªmes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Biginteger &amp;#8211; int8 :&lt;/strong&gt;&lt;br&gt;Alignement sur un multiple de 8 octets.&lt;br&gt;Espace occupÃ© de 8 octets.&lt;br&gt;Attention Ã  ne pas confondre l&amp;rsquo;alignement et l&amp;rsquo;espace occupÃ© qui sont les mÃªmes pour ce type.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;Text, Varchar :&lt;/strong&gt;&lt;br&gt;Alignement variable : aucun alignement en dessous d&amp;rsquo;une certaine taille ; au dela, les donnÃ©es peuvent Ãªtre compressÃ©e et/ou TOASTÃ©es et un header alignÃ© sur un multiple de 4 octets est ajoutÃ©.&lt;br&gt;Espace occupÃ© variable : 1 octet de header plus les donnÃ©es en dessous d&amp;rsquo;une certaine taille ; au dela, 4 octets de header plus les donnÃ©es.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requÃªte permettant de connaitre la taille fixÃ©e pour les types de donnÃ©es (pour les types variables, l&amp;rsquo;alignement se fait pour le header Ã©ventuellement prÃ©sent) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;typname AS type,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typcategory,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typcategory&#xA;&#x9;&#x9;&#x9;WHEN &#39;A&#39; THEN &#39;Array types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;B&#39; THEN &#39;Boolean types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;C&#39; THEN &#39;Composite types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;D&#39; THEN &#39;Date/time types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;E&#39; THEN &#39;Enum types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;G&#39; THEN &#39;Geometric types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;I&#39; THEN &#39;Network address types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;N&#39; THEN &#39;Numeric types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;P&#39; THEN &#39;Pseudo-types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;R&#39; THEN &#39;Range types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;S&#39; THEN &#39;String types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;T&#39; THEN &#39;Timespan types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;U&#39; THEN &#39;User-defined types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;V&#39; THEN &#39;Bit-string types&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;X&#39; THEN &#39;unknown type&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;Z&#39; THEN &#39;Internal-use types&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS category,&#xA;&#x9;CASE &#xA;&#x9;&#x9;WHEN typlen = -1 THEN &#39;variable&#39;&#xA;&#x9;&#x9;ELSE typlen::text&#xA;&#x9;END AS longueur,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typalign,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typalign&#xA;&#x9;&#x9;&#x9;WHEN &#39;c&#39; THEN &#39;char alignment, i.e., no alignment needed&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;s&#39; THEN &#39;short alignment (2 bytes on most machines)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;i&#39; THEN &#39;int alignment (4 bytes on most machines)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;d&#39; THEN &#39;double alignment (8 bytes on many machines, but by no means all)&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS alignement,&#xA;&#x9;concat(&#xA;&#x9;&#x9;typstorage,&#xA;&#x9;&#x9;&#39; - &#39; || &#xA;&#x9;&#x9;CASE typstorage&#xA;&#x9;&#x9;&#x9;WHEN &#39;p&#39; THEN &#39;plain: Values must always be stored plain (non-varlena types always use this value)&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;e&#39; THEN &#39;external: Values can be stored in a secondary â€œTOASTâ€ relation&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;m&#39; THEN &#39;main: Values can be compressed and stored inline&#39;&#xA;&#x9;&#x9;&#x9;WHEN &#39;x&#39; THEN &#39;extended: Values can be compressed and/or moved to a secondary relation&#39;&#xA;&#x9;&#x9;END&#xA;&#x9;) AS stockage&#xA;FROM &#xA;&#x9;pg_type&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette valeur d&amp;rsquo;alignement implique donc une potentielle perte d&amp;rsquo;espace entre les valeurs de chaque colonne. Ainsi, l&amp;rsquo;ordre des colonnes a une forte incidence sur le poids d&amp;rsquo;une table. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple concret pour mieux situer le problÃ¨me. Voila deux tables avec les mÃªmes colonnes mais des agencements diffÃ©rents et l&amp;rsquo;impact que cela a :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.test_non_optimise (&#xA;  a int2,&#xA;  b int8,&#xA;  c int2,&#xA;  d int8&#xA;)&#xA;;&#xA;&#xA;INSERT INTO public.test_non_optimise&#xA;VALUES (1, 1, 1, 1)&#xA;;&#xA;&#xA;SELECT &#xA;  pg_column_size(test_non_optimise.*) &#xA;FROM &#xA;  public.test_non_optimise&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne insÃ©rÃ©e pÃ¨se 56 octets que l&amp;rsquo;on peut dÃ©composer ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;position &amp;#8211; longueur : commentaire&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;0  - 23 o&lt;/code&gt; : MÃ©tadonnÃ©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;23 -  1 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;24 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;26 -  6 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;32 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;40 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;42 -  6 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;48 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On note beaucoup d&amp;rsquo;octets d&amp;rsquo;espacement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.test_optimise (&#xA;  b int8,&#xA;  d int8,&#xA;  a int2,&#xA;  c int2&#xA;)&#xA;;&#xA;&#xA;INSERT INTO public.test_optimise &#xA;VALUES (1, 1, 1, 1)&#xA;;&#xA;&#xA;SELECT &#xA;  pg_column_size(test_optimise.*) &#xA;FROM &#xA;  public.test_optimise&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La ligne insÃ©rÃ©e pÃ¨se 44 octets que l&amp;rsquo;on peut dÃ©composer ainsi :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;position &amp;#8211; longueur : commentaire&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;0  - 23 o&lt;/code&gt; : MÃ©tadonnÃ©es.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;23 -  1 o&lt;/code&gt; : Espacement.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;24 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;32 -  8 o&lt;/code&gt; : DonnÃ©es biginteger (alignÃ©e sur un multiple de 8).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;40 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;42 -  2 o&lt;/code&gt; : DonnÃ©es integer (alignÃ©e sur un multiple de 2).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;optimisation du placement des colonnes permet de gagner 22% d&amp;rsquo;espace disque : c&amp;rsquo;est non nÃ©gligeable sur des tables de grande taille.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Toast&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es d&amp;rsquo;un tuple ne peuvent dÃ©passer une page. Ainsi, pour contourner cette limite avec des donnÃ©es lourdes, un mÃ©canisme spÃ©cifique appelÃ© TOAST est utilisÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;TOAST signifie Â«Â The Oversized-Attribute Storage TechniqueÂ Â» et se dÃ©clenche de faÃ§on automatisÃ©e et totalement transparente pour l&amp;rsquo;utilisateur lorsqu&amp;rsquo;une ligne est trop lourde pour le stockage Â«Â standardÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fonctionnement est le suivant : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Jusquâ€™Ã  2 ko (par dÃ©faut, dÃ©finit via la variable &lt;code&gt;TOAST_TUPLE_THRESHOLD&lt;/code&gt;), un tuple est stockÃ© normalement, directement dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;A partir de 2 ko, le systÃ¨me compresse le tuple, puis deux cas de figures se prÃ©sentent :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le poids du tuple compressÃ© est infÃ©rieur Ã  2 ko (par dÃ©faut, dÃ©finit via la variable &lt;code&gt;TOAST_TUPLE_TARGET&lt;/code&gt;), alors ce dernier est stockÃ© compressÃ© dans la page.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le poids du tuple compressÃ© est supÃ©rieur Ã  2 ko, alors le systÃ¨me transfert les donnÃ©es colonne par colonne dans une table annexe appelÃ©e table TOAST.&lt;br&gt;Le transfert commence par les colonnes les plus lourdes et s&amp;rsquo;arrÃªte lorsque les colonnes restantes peuvent Ãªtre stockÃ©es dans la page (lorsqu&amp;rsquo;il reste moins de 2 ko).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_toast_diagram-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3183&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Les tables TOAST sont stockÃ©es dans le schÃ©ma systÃ¨me &lt;code&gt;pg_toast&lt;/code&gt; et sont nommÃ©es d&amp;rsquo;aprÃ¨s l&amp;rsquo;OID de la table d&amp;rsquo;origine sous la forme &lt;code&gt;pg_toast_oidorigine&lt;/code&gt;. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il s&amp;rsquo;agit de tables standards (et donc qui peuvent Ãªtre lues via un simple &lt;code&gt;SELECT&lt;/code&gt;) Ã  la structure suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;chunk_id&lt;/code&gt; : identifiant de bloc (permettant la correspondance avec un tuple spÃ©cifique de la table source).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;chunk_seq&lt;/code&gt; : numÃ©ro d&amp;rsquo;ordre du bloc (une donnÃ©e importante peut Ãªtre dÃ©coupÃ©e en plusieurs blocs qu&amp;rsquo;il faut pouvoir ordonnancer).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;chunk_data&lt;/code&gt; : donnÃ©e au format binaire.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es y sont stockÃ©es Ã  raison d&amp;rsquo;un bloc par ligne, chaque bloc Ã©tant un morceau de 2 ko (par dÃ©faut, dÃ©finit via la variable &lt;code&gt;TOAST_MAX_CHUNK_SIZE&lt;/code&gt;) de la donnÃ©e d&amp;rsquo;origine qui a donc Ã©tÃ© dÃ©coupÃ©e.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette division permet de rÃ©partir le poids des donnÃ©es et de les stocker de faÃ§on classique (dans un &lt;em&gt;heap file&lt;/em&gt;), sans dÃ©passer la taille limite dâ€™une page. Voici un exemple schÃ©matisÃ© du contenu de deux pages d&amp;rsquo;une table TOAST :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_toast_page.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3186&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Notez que lorsque vous requÃªtez une table, la rÃ©cupÃ©ration des donnÃ©es TOASTÃ©es possÃ¨de un certain coÃ»t car PostgreSQL doit lire la table TOAST, rÃ©cupÃ©rer les morceaux de donnÃ©es, les assembler puis retourner la donnÃ©es consolidÃ©e. C&amp;rsquo;est une des raisons pour lesquelles le sÃ©lecteur &lt;code&gt;*&lt;/code&gt; est souvent dÃ©conseillÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre point, depuis PostgreSQL 14, vous pouvez choisir l&amp;rsquo;algorithme de compression via la variable &lt;code&gt;default_toast_compression&lt;/code&gt; qui permet de choisir entre &lt;em&gt;pglz&lt;/em&gt; (format compression par dÃ©faut) et &lt;em&gt;lz4 (nouveau format jusquâ€™Ã &lt;/em&gt; 80% plus rapide pour un taux de compression similaire).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Quelques requÃªtes&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici quelques requÃªtes pour rÃ©cupÃ©rer des informations sur vos tables et mieux apprÃ©hender la structure des pages.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Commencez par crÃ©er une table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez maintenant rÃ©cupÃ©rer quelques donnÃ©es grÃ¢ce Ã  la premiÃ¨re fonction &lt;code&gt;get_table_info()&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats (tronquÃ©, je n&amp;rsquo;ai pas mis toutes les colonnes) avec en gras les valeurs qui mâ€™intÃ©ressent :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;schema&lt;/td&gt;&lt;td&gt;public&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table&lt;/td&gt;&lt;td&gt;table_test&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tablespace&lt;/td&gt;&lt;td&gt;pg_default&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;oid_table&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;numero_heap_file&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;Le numÃ©ro du fichier peut Ãªtre diffÃ©rent de l&amp;rsquo;oid de la table&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;heap_file_segment_0_location&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;C:/&amp;#8230;/PG16-data/base/246510/350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;nb_page&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table vient d&amp;rsquo;Ãªtre crÃ©Ã©e et ne contient aucune donnÃ©e donc aucune page n&amp;rsquo;a Ã©tÃ© crÃ©Ã©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;tuple_count&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;Aucune donnÃ©es.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;table_length&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table venant d&amp;rsquo;Ãªtre crÃ©Ã©e, elle ne pÃ¨se encore rien&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;table_length_human&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;0 bytes&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;dead_tuple_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;free_space_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;toast_oid&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;350937&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;La table TOAST est dÃ©jÃ  crÃ©Ã©e dans le SGBD bien qu&amp;rsquo;il n&amp;rsquo;y ait pas encore eu besoin du systÃ¨me TOAST..&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;toast_table&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;pg_toast_350934&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_heap_file_segment_0_location&lt;/td&gt;&lt;td&gt;C:/&amp;#8230;/PG16-data/base/246510/350937&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_nb_page&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_nb_tuple&lt;/td&gt;&lt;td&gt;-1&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_length&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;toast_length_human&lt;/td&gt;&lt;td&gt;0 bytes&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez une ligne de donnÃ©es puis recalculez les statistiques :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Insertion de la donnÃ©e&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats (tronquÃ©s) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;nb_page&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;Une page a Ã©tÃ© crÃ©Ã©e&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_count&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table_length_human&lt;/td&gt;&lt;td&gt;8192 bytes&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_length&lt;/td&gt;&lt;td&gt;2113&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;free_space_length&lt;/td&gt;&lt;td&gt;6036&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est intÃ©ressant de constater que les donnÃ©es pÃ¨sent 2113 octets (tuple_length) et que la page pÃ¨se 8,192 ko. En effet, les pages font toujours la mÃªme taille.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir qu&amp;rsquo;il reste 6036 octets d&amp;rsquo;espace disponible dans la page avant la crÃ©ation d&amp;rsquo;une seconde.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez maintenant un peu plus en dÃ©tail le stockage des donnÃ©es grÃ¢ce Ã  cette seconde fonction &lt;code&gt;get_heap_page_info()&lt;/code&gt; qui remonte des statistiques sur le contenu des pages d&amp;rsquo;une table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;th&gt;Commentaire&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;page_num&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;NumÃ©ro de page&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;lsn&lt;/td&gt;&lt;td&gt;4/1D111198&lt;/td&gt;&lt;td&gt;Identifiant xlog de la derniÃ¨re opÃ©ration effectuÃ©e sur la page.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_pointer&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_tuple&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de tuple.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_tuple_visible&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_header&lt;/td&gt;&lt;td&gt;24&lt;/td&gt;&lt;td&gt;Taille des mÃ©tadonnÃ©es de la page.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_pointer&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;td&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_free_space&lt;/td&gt;&lt;td&gt;6036&lt;/td&gt;&lt;td&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_tuple&lt;/td&gt;&lt;td&gt;2120&lt;/td&gt;&lt;td&gt;Taille occupÃ©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_meta&lt;/td&gt;&lt;td&gt;48&lt;/td&gt;&lt;td&gt;Taille des mÃ©tadonnÃ©es des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_data&lt;/td&gt;&lt;td&gt;2065&lt;/td&gt;&lt;td&gt;Taille des donnÃ©es des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_empty&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;td&gt;Taille des espaces laissÃ©s par l&amp;rsquo;alignement des tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;length_special&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;Taille des donnÃ©es spÃ©cifiques.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_pointer&lt;/td&gt;&lt;td&gt;24&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but des pointeurs.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_free_space&lt;/td&gt;&lt;td&gt;32&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but de l&amp;rsquo;espace disponible.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_data&lt;/td&gt;&lt;td&gt;6072&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but des donnÃ©es.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_special&lt;/td&gt;&lt;td&gt;8192&lt;/td&gt;&lt;td&gt;Positionnement du dÃ©but des donnÃ©es spÃ©cifique.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;offset_page_end&lt;/td&gt;&lt;td&gt;8192&lt;/td&gt;&lt;td&gt;Positionnement de la fin de la page.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un schÃ©ma de l&amp;rsquo;Ã©tat actuel de la page, vous remarquerez qu&amp;rsquo;il n&amp;rsquo;y a pas de bloc spÃ©cifique car il s&amp;rsquo;agit d&amp;rsquo;une table classique et non pas d&amp;rsquo;une table d&amp;rsquo;index :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_test-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3099&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Bon nous voyons dÃ©jÃ  pas mal de chose mais nous ne savons pas comment se rÃ©partissent les tuples, leurs mÃ©tadonnÃ©es ainsi que les espaces vides. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Allez donc un peu plus loin (puisque vous Ãªtes lÃ  pour Ã§a), grÃ¢ce Ã  une troisiÃ¨me fonction &lt;code&gt;get_heap_tuple_info()&lt;/code&gt; qui permet de rÃ©cupÃ©rer toutes les informations disponibles sur les tuples prÃ©sents dans la page.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats (attention, j&amp;rsquo;ai plusieurs lignes donc mon tableau est maintenant dans l&amp;rsquo;autre sens).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_end&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_next&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_meta&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_data&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_empty&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position de la fin du tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position du dÃ©but du tuple prÃ©cÃ©dent.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur des mÃ©tadonnÃ©es du tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Longueur des donnÃ©es en elle-mÃªme&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Espace vide&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8192&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2002&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1978&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6183&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;111&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;87&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la reprÃ©sentation exacte de la page (avec en jaune l&amp;rsquo;espace perdu Ã  cause de l&amp;rsquo;alignement) :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_test_accurate-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3101&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que le premier tuple possÃ¨de un peu moins de 2000 octets de donnÃ©es : c&amp;rsquo;est Ã  cause du champ &lt;code&gt;commentaire_2&lt;/code&gt;. En effet, le type de donnÃ©es &lt;code&gt;char(2000)&lt;/code&gt; limite les donnÃ©es Ã  2000 caractÃ¨res maximum. Cependant, ce type de donnÃ©es est en fait le type &lt;code&gt;bpchar(2000)&lt;/code&gt; comme &lt;em&gt;blank padded caractÃ¨re&lt;/em&gt; : PostgreSQL ajoute des espaces au texte jusquâ€™Ã  ce qu&amp;rsquo;il atteigne 2000 caractÃ¨res ce qui force la ligne Ã  prendre plus de place que nÃ©cessaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Autre Ã©lÃ©ment, le second tuple ne possÃ¨de que 87 octets de donnÃ©es. C&amp;rsquo;est Ã  cause du systÃ¨me TOAST qui s&amp;rsquo;est dÃ©clenchÃ© car les donnÃ©es pesaient plus que 2 ko, elles ont donc Ã©tÃ© compressÃ©es. Comme le rÃ©sultat pÃ¨se moins de 2 ko, aucune colonne n&amp;rsquo;a Ã©tÃ© transfÃ©rÃ©e dans la table TOAST.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez Ã©galement que les pointeurs renseignent sur l&amp;#8217;emplacement des tuples.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ajoutez encore des donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_end&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Position de la fin du tuple.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6183&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6066&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2056&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4058&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;48&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2050&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8186&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une page supplÃ©mentaire a Ã©tÃ© crÃ©Ã©e, la table pÃ¨se maintenant 2 x 8 ko : 16 ko (vous pouvez le vÃ©rifier avec &lt;code&gt;get_table_info()&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Gestion des donnÃ©es&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Colonnes systÃ¨me&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Des colonnes systÃ¨me sont prÃ©sentes dans chacune des tables. Il suffit de les spÃ©cifier dans vos requÃªtes pour y accÃ©der, les voici :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;tableoid&lt;/code&gt; : l&amp;rsquo;OID de la table, utilisez &lt;code&gt;tableoid::regclass&lt;/code&gt; pour obtenir le nom de la table.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;ctid&lt;/code&gt; : emplacement physique de la ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;xmin&lt;/code&gt; : identifiant de la transaction d&amp;rsquo;insertion.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;cmin&lt;/code&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/ddl-system-columns.html#DDL-SYSTEM-COLUMNS-CMIN&#34;&gt;&lt;/a&gt; : identifiant de commande au sein de la transaction d&amp;rsquo;insertion.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;xmax&lt;/code&gt; : identifiant de la transaction de supression.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;cmax&lt;/code&gt; : identifiant de commande au sein de la transaction de suppression.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple avec notre table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  tableoid::regclass,&#xA;  tableoid,&#xA;  ctid,&#xA;  xmin,&#xA;  xmax,&#xA;  *&#xA;FROM &#xA;  public.table_test&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;tableoid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;tableoid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;id&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;commentaire_1&lt;/th&gt;&lt;th&gt;commentaire_2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td&gt;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;E&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;table_test&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;350934&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;F&lt;/td&gt;&lt;td&gt;un commentaire&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si besoin, n&amp;rsquo;hÃ©sitez pas Ã  utiliser cette requÃªte pour voir Ã  quelles lignes correspondent les tuples que nous allons analyser.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Fonctionnement&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Maintenant que nous connaissons un peu mieux la faÃ§on dont les donnÃ©es sont stockÃ©es physiquement, regardons comment les mouvements sont gÃ©rÃ©s.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans une base PostgreSQL, l&amp;rsquo;accÃ¨s aux donnÃ©es peut se faire de faÃ§on concurrentielle (en mÃªme temps) depuis diffÃ©rents clients. Il faut donc gÃ©rer correctement l&amp;rsquo;ordonnancement des transactions. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, il existe le MVCC : Multiversion Concurrency Control ou contrÃ´le d&amp;rsquo;accÃ¨s simultanÃ©, il s&amp;rsquo;agit d&amp;rsquo;un systÃ¨me permettant la conservation des diffÃ©rents Ã©tats de la donnÃ©e afin de permettre Ã  chaque transaction de travailler sur un instantanÃ© de la base. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fonctionnement repose sur le principe suivant : chaque transaction possÃ¨de un identifiant unique et incrÃ©mentale, lorsqu&amp;rsquo;elle effectue une opÃ©ration, les lignes modifiÃ©es se voient attribuer son identifiant ce qui permet de ressituer l&amp;rsquo;Ã©tat des donnÃ©es par rapport Ã  toute autre transaction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Horaire&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 1&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h00&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but UPDATE sur la table X&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but INSERT sur la table Y&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h06&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin INSERT sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h08&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin UPDATE sur la table X&lt;br&gt;DÃ©but UPDATE sur la table Y&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin UPDATE sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque la transaction 1 effectue sa seconde opÃ©ration, l&amp;rsquo;Ã©tat des donnÃ©es doit Ãªtre celui qui existait lors du dÃ©marrage de la transaction. Cependant, pour Ã©viter de bloquer tous les utilisateurs, PostgreSQL a dÃ©jÃ  effectuÃ© l&amp;rsquo;INSERT de la transaction 2. Ainsi, pour conserver l&amp;rsquo;isolation de chaque transaction, une version de la table telle qu&amp;rsquo;elle Ã©tait lors de dÃ©marrage de la transaction 1 existe toujours aprÃ¨s la finalisation de la transaction 2, le temps que la transaction 1 puisse se terminer.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que si la transaction 2 avait effectuÃ© une opÃ©ration modifiant des donnÃ©es de la table Y concernÃ©es par la transaction 1, PostgreSQL aurait attendu la fin de la transaction grÃ¢ce Ã  un systÃ¨me de verrous placÃ©s sur les lignes concernÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que selon le niveau d&amp;rsquo;isolation, il est possible pour une transaction de Â«Â voirÂ Â» les lignes modifiÃ©es par d&amp;rsquo;autres transactions. Il s&amp;rsquo;agit du rÃ©glage de la variable &lt;code&gt;default_transaction_isolation&lt;/code&gt; qui peut prendre l&amp;rsquo;une des valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;READ COMMITTED&lt;/code&gt; : une requÃªte n&amp;rsquo;a accÃ¨s qu&amp;rsquo;aux lignes commitÃ©es avant qu&amp;rsquo;elle ne commence, c&amp;rsquo;est donc le dÃ©marrage de la requÃªte qui fait foi. &lt;br&gt;Ainsi, les derniÃ¨res requÃªtes d&amp;rsquo;une transaction peuvent opÃ©rer sur des donnÃ©es ayant Ã©tÃ© modifiÃ©es par d&amp;rsquo;autres transactions par rapport aux premiÃ¨res requÃªtes.&lt;br&gt;Il s&amp;rsquo;agit de la valeur par dÃ©faut.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;REPEATABLE READ&lt;/code&gt; : une transaction ne peut voir que les lignes commitÃ©es avant que la premiÃ¨re requÃªte de la transaction ne soit exÃ©cutÃ©e.&lt;br&gt;Deux transactions concurrentes peuvent modifier des donnÃ©es diffÃ©rentes mais appartenant Ã  la mÃªme table ce qui peut conduire Ã  des donnÃ©es inconsistantes (car calculÃ©es sur une base qui n&amp;rsquo;existe plus par exemple).&lt;br&gt;En revanche, si une seconde transaction modifie les mÃªmes donnÃ©es que la premiÃ¨re, une erreur &lt;code&gt;serialization_failure&lt;/code&gt; est remontÃ©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;SERIALIZABLE&lt;/code&gt; : une transaction ne peut voir que les lignes commitÃ©es avant que la premiÃ¨re requÃªte de la transaction ne soit exÃ©cutÃ©e. &lt;br&gt;Si deux transactions concurrentes modifient les mÃªmes donnÃ©es, la premiÃ¨re transaction Ã  commiter Â«Â gagneÂ Â» et la seconde est annulÃ©e (&lt;code&gt;ROLLBACK&lt;/code&gt;) et une erreur &lt;code&gt;serialization_failure&lt;/code&gt; est remontÃ©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Mais comment cela fonctionne en dÃ©tail ? Pour voir cela, nous allons devoir utiliser un exemple concret.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;INSERT &amp;#8211; UPDATE &amp;#8211; DELETE&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour dÃ©marrer nos test, nous allons repartir de la table prÃ©cÃ©dente (disponible dans l&amp;rsquo;onglet Â«Â initialisationÂ Â»).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;DÃ©marrez une transaction et affichez son identifiant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW gestion_data_insert_delete_udpate&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;txid_current()&#34; data-enlighter-group=&#34;gestion_data_insert_delete_udpate&#34;&gt;BEGIN;&#xA;&#xA;SELECT txid_current();&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;gestion_data_insert_delete_udpate&#34;&gt;-- !!!&#xA;-- Attention Ã  bien exÃ©cuter chaque requÃªte dans une transaction spÃ©cifique&#xA;-- Ce que permet le COMMIT Ã  la suite de chaque requÃªte si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- CrÃ©ation d&#39;une table de test&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ma transaction porte le numÃ©ro d&amp;rsquo;identifiant &lt;strong&gt;4440&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Modifiez des donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Mise Ã  jour de la ligne 3&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Validez la transaction :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Tant qu&amp;rsquo;a faire, faites la suppression suivante suivit d&amp;rsquo;une insertion :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez les donnÃ©es : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4432 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4442 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4440 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;br&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous dÃ©couvrez les colonnes &lt;code&gt;xmin&lt;/code&gt; et &lt;code&gt;xmax&lt;/code&gt; qui indiquent Â«Â Ã  partir deÂ Â» et Â«Â jusquâ€™Ã Â Â» quelle transaction un tuple est visible. J&amp;rsquo;ai ajoutÃ© un petit drapeau Ã  cÃ´tÃ© de chaque valeur :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;c : la transaction a Ã©tÃ© validÃ©e (&lt;code&gt;COMMIT&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;a : la transaction a Ã©tÃ© annulÃ©e (&lt;code&gt;ROLLBACK&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous noterez donc que PostgreSQL garde en mÃ©moire les donnÃ©es qui ont Ã©tÃ© modifiÃ©es lors des transactions abandonnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir plusieurs Ã©lÃ©ments :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les lignes visibles ne possÃ¨dent pas de &lt;em&gt;xmax&lt;/em&gt; (en vrai il est Ã©gal Ã  0).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;id = 3&lt;/code&gt; a Ã©tÃ© mise Ã  jour.&lt;br&gt;Son ancien emplacement avec les donnÃ©es d&amp;rsquo;origine est toujours prÃ©sent et correspond Ã  la troisiÃ¨me ligne. Elle est identifiÃ©e comme Â«Â morteÂ Â» et devra Ãªtre nettoyÃ©e.&lt;br&gt;La nouvelle version est prÃ©sente Ã  la derniÃ¨re ligne (&lt;code&gt;ctid = (1,2)&lt;/code&gt;).&lt;br&gt;PostgreSQL a rÃ©alisÃ© un &lt;code&gt;INSERT&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;ctid = (0,4)&lt;/code&gt; correspond Ã  la ligne &lt;code&gt;id = 4&lt;/code&gt; que nous avons supprimÃ©e.&lt;br&gt;Ici aussi la donnÃ©e n&amp;rsquo;est pas supprimÃ©e mais simplement Â«Â tagguÃ©eÂ Â» comme non visible.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La ligne &lt;code&gt;ctid = (1,3)&lt;/code&gt; correspond Ã  la ligne que nous venons d&amp;rsquo;ajouter : elle est situÃ©e en derniÃ¨re position.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un &lt;code&gt;UPDATE&lt;/code&gt; est en rÃ©alitÃ© la mÃªme opÃ©ration qu&amp;rsquo;un &lt;code&gt;DELETE&lt;/code&gt; suivi d&amp;rsquo;un &lt;code&gt;INSERT&lt;/code&gt;, d&amp;rsquo;ailleurs son coÃ»t est assez similaire.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce fonctionnement nous montre Ã©galement pourquoi les lignes peuvent paraitre dÃ©sordonnÃ©es lors d&amp;rsquo;un &lt;code&gt;SELECT&lt;/code&gt;. En effet, PostgreSQL remonte les lignes dans l&amp;rsquo;ordre dans lequel elles sont stockÃ©es. Dans notre cas, un simple &lt;code&gt;SELECT&lt;/code&gt; sur la table nous aurait donnÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;initialement 1, 2, 3, 4, 5, 6.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;AprÃ¨s l&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; 1, 2, 4, 5, 6, 3.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;AprÃ¨s le &lt;code&gt;DELETE&lt;/code&gt; 1, 2, 5, 6, 3.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;HOT UPDATE&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le Heap Only Tuple UPDATE (ou simplement &lt;code&gt;HOT UPDATE&lt;/code&gt;) un processus particulier de PostgreSQL qui se produit lorsqu&amp;rsquo;il reste suffisamment de place dans une page pour que l&amp;rsquo;ancienne et la nouvelle version d&amp;rsquo;un tuple y soient stockÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lancez maintenant la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Mise Ã  jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Analysez les donnÃ©es de la deuxiÃ¨me page :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;, 1);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4440 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from and to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;160&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette fois-ci vous pouvez voir :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;L&amp;rsquo;&lt;code&gt;INSERT&lt;/code&gt; est fait en fin de donnÃ©es (&lt;code&gt;ctid = (1,2)&lt;/code&gt;).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;L&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; de la ligne &lt;code&gt;id = 3&lt;/code&gt; est ici un &lt;code&gt;HOT UPDATE&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le processus en image :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_1-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3104&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Voici la table dans son Ã©tat initial&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3106&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;&lt;br&gt;PremiÃ¨re Ã©tape du HOT UPDATE&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;La nouvelle version du tuple est insÃ©rÃ©e en derniÃ¨re position avec le &lt;code&gt;ctid = (1,4)&lt;/code&gt; et porte de tag Â«Â HOT UPDATEÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;ancienne version est Â«Â dÃ©sactivÃ©eÂ Â» : son &lt;code&gt;ctid&lt;/code&gt; devient &lt;code&gt;(1,4)&lt;/code&gt; et les tags Â«Â HOT UPDATEÂ Â» et Â«Â HEAP ONLY TUPLEÂ Â» sont ajoutÃ©s. Ceci permet Ã  PostgreSQL de comprendre, lors de la lecture du tuple 2, qu&amp;rsquo;il doit aller lire le tuple 4.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le &lt;code&gt;HOT UPDATE&lt;/code&gt; n&amp;rsquo;est en rÃ©alitÃ© pas terminÃ©, une seconde opÃ©ration va Ãªtre menÃ©e par la base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Faites la requÃªte SELECT suivante puis rÃ©analysez la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- SELECT&#xA;SELECT * FROM public.table_test;&#xA;&#xA;-- Analyse&#xA;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;, 1);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les donnÃ©es de la 2Ã¨me page : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;direction&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;hot&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;to : vers un autre tuple.&lt;br&gt;from : depuis unautre tuple&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;HOT UPDATE&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4435 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;redirect to 4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from and to another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4453 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4454 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;from another line&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le tuple 2, qui contient l&amp;rsquo;ancienne version de la ligne &lt;code&gt;id = 3&lt;/code&gt;, a Ã©tÃ© Â«Â nettoyÃ©eÂ Â» et sont pointeur redirige vers le pointeur 4. L&amp;rsquo;offset des tuples a Ã©tÃ© modifiÃ© Ã  cause d&amp;rsquo;une dÃ©fragmentation de la page : c&amp;rsquo;est la seconde opÃ©ration du &lt;code&gt;HOT UPDATE&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le processus imagÃ© :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_3-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3107&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Pruning : mise Ã  jour du pointeur ce qui tue le tuple 2&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Lors de la premiÃ¨re requÃªte qui suit l&amp;rsquo;&lt;code&gt;UPDATE&lt;/code&gt; et qui lit les donnÃ©es de la table (un &lt;code&gt;SELECT&lt;/code&gt; par exemple), PostgreSQL opÃ¨re un processus de pruning :&lt;br&gt;il met Ã  jour le pointeur du tuple 2 et remplace la valeur de position du tuple 2 par celle du pointeur de la nouvelle version (ici le pointeur 4).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, lors d&amp;rsquo;une lecture de la donnÃ©e, c&amp;rsquo;est toujours le pointeur 2 qui sera lu en premier mais PostgreSQL est directement redirigÃ© vers le nouveau pointeur (le 4) qui l&amp;rsquo;envoi ainsi vers le nouveau tuple (le 4 donc). Ceci permet de ne pas avoir Ã  modifier les index dans ce type de situation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que dans le cas d&amp;rsquo;une lecture sÃ©quentiel, cette opÃ©ration (de redirection) est similaire en temps et en coÃ»t que de lire directement le pointeur 4.&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_page_content_hot_4-1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3108&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;PostgreSQL effectue ensuite une dÃ©fragmentation de la page en supprimant physiquement le tuple 2 (ce qui entraine un Â«Â dÃ©calageÂ Â» des tuples pour combler l&amp;rsquo;espace vide). Cette dÃ©fragmentation ne concerne pas les pointeurs, le 2&lt;sup&gt;Ã¨me&lt;/sup&gt; reste donc prÃ©sent, rÃ©fÃ©renÃ§ant toujours le pointeur 4 (toujours pour ne pas avoir Ã  toucher aux index).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le processus de lecture est donc identique Ã  l&amp;rsquo;Ã©tape prÃ©cÃ©dente mais de l&amp;rsquo;espace est rendu disponible.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que si un second &lt;code&gt;HOT UPDATE&lt;/code&gt; est rÃ©alisÃ© sur le mÃªme tuple et ceci juste aprÃ¨s le premier &lt;code&gt;HOT UPDATE&lt;/code&gt;, la nouvelle version est insÃ©rÃ©e dans l&amp;rsquo;espace qui aurait du Ãªtre nettoyÃ© par la dÃ©fragmentation, le pointeur qui redirigeait vers un autre pointeur (pt&lt;sub&gt;1-2&lt;/sub&gt; dans notre exemple) est alors rÃ©tabli. La dÃ©fragmentation nettoiera alors le tuple intermÃ©diaire ainsi que son pointeur (pt&lt;sub&gt;1-4&lt;/sub&gt;, tuple 4).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le &lt;code&gt;HOT UPDATE&lt;/code&gt; est ainsi plus rapide Ã  executer qu&amp;rsquo;un &lt;code&gt;UPDATE&lt;/code&gt; classique et permet de libÃ©rer de l&amp;rsquo;espace en Ã©vitant de conserver l&amp;rsquo;ancien tuple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous savez maintenant plus prÃ©cisÃ©ment comment fonctionne le stockage physique. Vous voyez ainsi que lorsque beaucoup d&amp;rsquo;opÃ©rations sont faites, des lignes mortes ainsi que des pointeurs supplÃ©mentaires sont prÃ©sents dans vos tables ce qui entraine une grande perte d&amp;rsquo;espace.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Heureusement, un outil spÃ©cifique existe pour nettoyer tout cela : le &lt;code&gt;VACUUM&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34; id=&#34;vacuum&#34;&gt;VACUUM&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Passons l&amp;rsquo;aspirateur ! Ce n&amp;rsquo;est pas pour rien que le mot &lt;em&gt;VACUUM&lt;/em&gt; a Ã©tÃ© choisi pour cette opÃ©ration&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM consiste en le nettoyage d&amp;rsquo;une table afin d&amp;rsquo;en retirer tous les Ã©lÃ©ments qui ne sont plus utiles (lignes mortes) ainsi que de rÃ©arranger les Ã©lÃ©ments pour gagner de la place.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Deux types de VACUUM existent :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le Plain VACUUM (standard) : nettoyage rapide et dÃ©fragmentation partielle de la table.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le VACUUM FULL (complet) : nettoyage et dÃ©fragmentation complets de la table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;opÃ©ration de VACUUM est lancÃ©e automatiquement par PostgreSQL via l&amp;rsquo;autovacuum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;VACUUM standard&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM standard (ou VACUUM concurrentiel ou Plain VACUUM) peut Ãªtre exÃ©cuter sans verrouiller la table sur laquelle il porte.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il opÃ¨re les actions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ol class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Analyse des pages pour identifier les tuples morts (issus d&amp;rsquo;un &lt;code&gt;UPDATE&lt;/code&gt;, d&amp;rsquo;un &lt;code&gt;DELETE&lt;/code&gt; ou d&amp;rsquo;une transaction abandonnÃ©e).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;FREEZE des tuples si nÃ©cessaire (voir le chapitre VACUUM FREEZE)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Suppression des entrÃ©es des index correspondant Ã  des tuples morts.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Pour chaque page :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Suppression des tuples morts&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;DÃ©fragmentation de la page pour rÃ©cupÃ©rer l&amp;rsquo;espace des tuples morts.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Mise Ã  jour de la &lt;em&gt;free space map&lt;/em&gt; et de la &lt;em&gt;visibility map&lt;/em&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Suppression de la derniÃ¨re page si possible (si aucun tuple vivant dedans).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Mise Ã  jour des statistiques de la table dans les tables systÃ¨me.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;Ã©tape 1 commence par un listing des tuples mort, cette lsite est crÃ©Ã©e en mÃ©moire. C&amp;rsquo;est pour cette Ã©tape que la variable de configuration &lt;code&gt;maintenance_work_mem&lt;/code&gt; est importante. En effet, si sa valeur est trop faible, PostgreSQL devra itÃ©rer plusieurs fois sur la table jusquâ€™Ã  ce qu&amp;rsquo;il ne trouve plus de tuple mort.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;Ã©tape 2 est un FREEZE des valeurs &lt;em&gt;xmin&lt;/em&gt; des tuples. Cette opÃ©ration est dÃ©taillÃ©e dans le chapitre &lt;a href=&#34;#vacuum_freeze&#34;&gt;VACUUM FREEZE&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;Ã©tape 4 se dÃ©roule de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_1.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3114&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Ã‰tat initial : un tuple est considÃ©rÃ© comme mort&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3115&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Les donnÃ©es sont effacÃ©es et le pointeur du tuple est rÃ©initialisÃ©&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_vac_plain_3.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3117&#34;/&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;La dÃ©fragmentation rÃ©organise les donnÃ©es mais conserve le pointeur 2&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple, repartez de notre table d&amp;rsquo;exemple utilisÃ©e prÃ©cÃ©demment (disponible dans l&amp;rsquo;onglet Â«Â initialisationÂ Â») puis supprimez quelques lignes et analysezla :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;get_heap_tuple_info()&#34; data-enlighter-group=&#34;start_vacuum_plain&#34;&gt;DELETE FROM public.table_test&#xA;WHERE id IN (6, 3)&#xA;;&#xA;&#xA;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;start_vacuum_plain&#34;&gt;-- !!!&#xA;-- Attention Ã  bien exÃ©cuter chaque requÃªte dans une transaction spÃ©cifique&#xA;-- Ce que permet le COMMIT Ã  la suite de chaque requÃªte si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- CrÃ©ation de la table&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 2&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Suppression de la ligne 4&#xA;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- SÃ©lection des donnÃ©es pour finalisation HOT UPDATE&#xA;SELECT * FROM public.table_test&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devriez avoir la structure suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4530 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2056&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4533 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;redirect to 4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4176&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4531 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,4)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2168&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4532 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4533 &amp;#8211; c&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez la diffÃ©rence entre les tuples non visibles qui ont Ã©tÃ© mis Ã  jour et les tuples non visibles qui ont Ã©tÃ© supprimÃ©s :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les premiers ont dÃ©jÃ  Ã©tÃ© nettoyÃ©s des tables, leurs pointeurs sont toujours prÃ©sents mais ne pointent vers rien ou redirigent vers un autre pointeur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les seconds en revanche sont toujours prÃ©sents mais simplement non visibles.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez Ã©galement le rÃ©sultat de la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple_visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille occupÃ©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2012&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6136&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2128&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6024&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lancez un VACUUM puis analysez les donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;VACUUM public.table_test;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_tuple_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ctid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_index&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;offset_start&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmin&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;xmax&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;state&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;update&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;delete&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;freeze&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Identifiant de la ligne : numÃ©ro de page, numÃ©ro d&amp;rsquo;index dans la page&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro de page&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;NumÃ©ro d&amp;rsquo;index du tuple dans la page.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Position du dÃ©but du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;ID de la transaction Ã  partir de laquelle le tuple est visible&lt;/em&gt;.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;&lt;em&gt;ID de la transaction au delÃ  de laquelle le tuple n&amp;rsquo;est plus visible&lt;/em&gt;.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Ã‰tat du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;VisibilitÃ© du tuple.&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Le tuple a-t-il Ã©tÃ© mis Ã  jour&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;Tuple supprimÃ©&lt;/em&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;em&gt;xmin gelÃ©&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,1)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,2)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6072&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4527 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(0,5)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4064&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4528 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;(1,3)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6184&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4531 &amp;#8211; f&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;normal&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir que les tuples vivants ont Ã©tÃ© rÃ©organisÃ©s (modification des offsets), quand aux morts, ils ont Ã©tÃ© supprimÃ©s mais leurs pointeurs sont toujours prÃ©sents dans un Ã©tat Â«Â inutilisÃ©Â Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Regardez les statistiques au niveau de chaque page :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple_visible&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_pointer&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_tuple&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuples visibles.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;ensemble des pointeurs.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille occupÃ©e par les tuples.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4020&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4128&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6148&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2008&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous pouvez voir immÃ©diatement que l&amp;rsquo;espace prÃ©cÃ©demment occupÃ© par les tuples morts a pu Ãªtre rÃ©cupÃ©rÃ©. Les prochaines insertions se feront alors d&amp;rsquo;abord dans la premiÃ¨re page puis dans la seconde avant de crÃ©er une Ã©ventuelle troisiÃ¨me page.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En revanche, vous pouvez voir que les pointeurs n&amp;rsquo;ont pas disparus.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez Ã©galement que les donnÃ©es prÃ©sentes dans la page 2 pourraient tout Ã  fait Ãªtre transfÃ©rÃ©es dans la page 1 maintenant qu&amp;rsquo;il y a suffisamment de place., c&amp;rsquo;est le &lt;code&gt;VACUUM FULL&lt;/code&gt; qui permet de faire cela.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;VACUUM FULL&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM FULL permet d&amp;rsquo;aller au delÃ  du VACUUM standard. En effet, ce dernier ne permet pas de rÃ©duire la taille des tables.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM FULL rÃ©Ã©crit complÃ¨tement le &lt;em&gt;heap file&lt;/em&gt; afin de rÃ©organiser les tuples et d&amp;rsquo;Ã©liminer les pages en trop. L&amp;rsquo;avantage est un gain de place qui peut Ãªtre consÃ©quent.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;inconvÃ©nient est que pendant la rÃ©Ã©criture, la table n&amp;rsquo;est plus accessible. Un autre inconvÃ©nient est que deux versions de la table seront prÃ©sentes sur le disque lors de la phase de rÃ©Ã©criture ce qui peut entrainer des problÃ¨mes d&amp;rsquo;espace disque si les donnÃ©es sont trÃ¨s volumineuses.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Reprenez notre exemple (disponible dans l&amp;rsquo;onglet Â«Â initialisationÂ Â») et analysez la table avec la fonction &lt;code&gt;get_heap_page_info()&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;get_heap_tuple_info()&#34; data-enlighter-group=&#34;start_vacuum_full&#34;&gt;-- Quelques statistiques&#xA;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;Initialisation&#34; data-enlighter-group=&#34;start_vacuum_full&#34;&gt;-- !!!&#xA;-- Attention Ã  bien exÃ©cuter chaque requÃªte dans une transaction spÃ©cifique&#xA;-- Ce que permet le COMMIT Ã  la suite de chaque requÃªte si vous lancez tout d&#39;un seul bloc&#xA;-- !!!&#xA;&#xA;-- CrÃ©ation de la table&#xA;CREATE TABLE public.table_test (&#xA;  id int4,&#xA;  commentaire_1 char(1955),&#xA;  commentaire_2 text&#xA;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (1, &#39;A&#39;, &#39;un commentaire&#39;),&#xA;  (2, &#39;B&#39;, &#39;un commentaire vraiment trÃ¨s trÃ¨s trÃ¨s long&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Insertion de donnÃ©es&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (3, &#39;C&#39;, &#39;un commentaire&#39;),&#xA;  (4, &#39;D&#39;, &#39;un commentaire&#39;),&#xA;  (5, &#39;E&#39;, &#39;un commentaire&#39;),&#xA;  (6, &#39;F&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 2&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un autre commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Suppression de la ligne 4&#xA;DELETE FROM public.table_test&#xA;WHERE id = 4&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Ajout d&#39;une ligne&#xA;INSERT INTO &#xA;  public.table_test (id, commentaire_1, commentaire_2)&#xA;VALUES &#xA;  (7, &#39;G&#39;, &#39;un commentaire&#39;)&#xA;;&#xA;COMMIT;&#xA;&#xA;-- Mise Ã  jour de la ligne 3 (oui encore)&#xA;UPDATE public.table_test&#xA;SET commentaire_2 = &#39;Un commentaire&#39;&#xA;WHERE id = 3&#xA;;&#xA;COMMIT;&#xA;&#xA;-- SÃ©lection des donnÃ©es pour finalisation HOT UPDATE&#xA;SELECT * FROM public.table_test&#xA;;&#xA;COMMIT;&#xA;&#xA;-- VACUUM Standard&#xA;VACUUM public.table_test&#xA;;&#xA;COMMIT;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused_line_pointer&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;PrÃ©sence de pointeurs non utilisÃ©s.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4020&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6148&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Oui&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Maintenant, rÃ©alisez un VACUUM FULL :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- VACUUM FULL&#xA;VACUUM FULL public.table_test&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;RÃ©analysons la table :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_heap_page_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le retour :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;page_num&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_pointeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;nb_tuple&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;length_free_space&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;unused_line_pointer&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;NumÃ©ro de page&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de pointeur.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Nombre de tuple.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Taille de l&amp;rsquo;espace libre.&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;PrÃ©sence de pointeurs non utilisÃ©s.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2016&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Non&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les tuples ont Ã©tÃ© rÃ©organisÃ©s sur la premiÃ¨re page du nouveau fichier. D&amp;rsquo;ailleurs dans l&amp;rsquo;exemple, mon filenode Ã©tait &lt;strong&gt;350934&lt;/strong&gt; (l&amp;rsquo;OID de la table). GrÃ¢ce Ã  la fonction &lt;code&gt;get_table_info()&lt;/code&gt; je vois maintenant qu&amp;rsquo;il est Ã©gal Ã  &lt;strong&gt;351418&lt;/strong&gt; : le fichier heap a bien Ã©tÃ© rÃ©Ã©crit.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le VACUUM FULL rÃ©Ã©crit Ã©galement les index, la visibility map ainsi que la free space map.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34; id=&#34;vacuum_freeze&#34;&gt;FREEZE des donnÃ©es&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le VACUUM possÃ¨de une option : &lt;code&gt;FREEZE&lt;/code&gt; qui permet de geler les donnÃ©es. Mais Ã  quoi Ã§a sert ?&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;ID de transaction&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme vous l&amp;rsquo;avez vu, le systÃ¨me de contrÃ´le d&amp;rsquo;accÃ¨s simultanÃ© (MVCC) utilise l&amp;rsquo;identifiant des transactions pour dÃ©terminer la visibilitÃ© des tuples. Cet identifiant est nommÃ© &lt;strong&gt;txid&lt;/strong&gt; et est assignÃ© par le gestionnaire de transaction. Il s&amp;rsquo;agit d&amp;rsquo;un nombre entier non signÃ© de 32 bit (soit 2&lt;sup&gt;32&lt;/sup&gt; = 4 294 967 295 valeurs diffÃ©rentes).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ainsi, lorsqu&amp;rsquo;une transaction est en cours, tous les Ã©lÃ©ments portant un &lt;em&gt;txid&lt;/em&gt; infÃ©rieur Ã  celui de la transaction sont considÃ©rÃ©s comme dans le passÃ© et donc modifiables par la transaction. Tous ceux qui ont un &lt;em&gt;txid&lt;/em&gt; supÃ©rieur, sont dans le futur et donc non modifiables par la transaction (cela dÃ©pend du mode de transaction utilisÃ© mais ne compliquons pas les choses).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;une seule transaction peut contenir plusieurs instructions SQL, chaque instruction se voit alors assigner un identifiant de commande (&lt;strong&gt;cid&lt;/strong&gt;), nombre entier non signÃ© de 32 bits Ã©galement ; permettant de comparer les rÃ©sultats des instructions les uns par rapport aux autres, exactement comme avec les &lt;em&gt;txid&lt;/em&gt;, au sein de la transaction. Ceci contraint d&amp;rsquo;ailleurs le systÃ¨me Ã  ne pouvoir exÃ©cuter Â«Â queÂ Â» 4,2 milliard d&amp;rsquo;instructions SQL par transaction (on est large&amp;#8230;)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les &lt;em&gt;txid&lt;/em&gt; suivants sont spÃ©ciaux :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;0 : &lt;em&gt;txid&lt;/em&gt; invalide.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;1 : &lt;em&gt;txid&lt;/em&gt; d&amp;rsquo;initialisation du cluster.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;2 : avant PG 9.4, il s&amp;rsquo;agit de la valeur &lt;em&gt;xmin&lt;/em&gt; gelÃ©e, maintenant c&amp;rsquo;est un drapeau qui est ajoutÃ© au tuple.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;assignement du &lt;em&gt;txid&lt;/em&gt; se produit lorsque la transaction commence Ã  Ã©crire et n&amp;rsquo;indique donc pas l&amp;rsquo;ordre de dÃ©marrage des transactions. Ceci implique qu&amp;rsquo;une transaction peut Â«Â doublerÂ Â» une autre. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Horaire&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 1&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Transaction 2&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h00&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but &lt;code&gt;SELECT&lt;/code&gt; sur la table X&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;DÃ©marrage transaction&lt;br&gt;DÃ©but &lt;code&gt;INSERT&lt;/code&gt; sur la table Y&lt;br&gt;&lt;strong&gt;=&amp;gt; Assignation d&amp;rsquo;un txid&lt;/strong&gt; : 1000&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h06&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;INSERT&lt;/code&gt; sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h08&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;SELECT&lt;/code&gt; sur la table X&lt;br&gt;DÃ©but &lt;code&gt;UPDATE&lt;/code&gt; sur la table Y&lt;br&gt;&lt;strong&gt;=&amp;gt; Assignation d&amp;rsquo;un txid&lt;/strong&gt; : 1001&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10h09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Fin &lt;code&gt;UPDATE&lt;/code&gt; sur la table Y&lt;br&gt;Fin transaction&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Les actions de la transaction 1 sont considÃ©rÃ©es comme ayant Ã©tÃ© rÃ©alisÃ©es aprÃ¨s la transaction 2 bien que cette derniÃ¨re ait dÃ©marrÃ©e aprÃ¨s&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Bouclage ou wraparound&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le problÃ¨me, c&amp;rsquo;est que 4,2 milliards de valeurs ce n&amp;rsquo;est pas forcÃ©ment assez dans la vie d&amp;rsquo;une base de donnÃ©es. Lorsqu&amp;rsquo;il y a plusieurs milliers de transactions par minutes, le compteur peut Ãªtre dÃ©passÃ© en moins de 8 ans (ok on est large mais une base avec plusieurs millions de transactions par jour cela peut arriver).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour rÃ©soudre ceci, PostgreSQL utilise le bouclage (wraparround) : lorsque les 4,2 milliards de valeurs sont atteintes, le compteur redÃ©marre Ã  0. Le problÃ¨me c&amp;rsquo;est qu&amp;rsquo;au moment du bouclage, la transaction portant le &lt;code&gt;txid = 4,1 milliards&lt;/code&gt; qui Ã©tait dans le passÃ© se retrouve alors dans le futur (le &lt;em&gt;txid&lt;/em&gt; courant Ã©tant maintenant infÃ©rieur). Pour Ã©viter ce phÃ©nomÃ¨ne, PostgreSQL considÃ¨re que les 2,1 milliards de transactions prÃ©cÃ©dentes sont dans le passÃ© et les 2,1 milliards suivantes dans le futur en tenant compte de ce bouclage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par exemple, ma transaction porte le &lt;code&gt;txid = 1000&lt;/code&gt;, la Â«Â boucle du tempsÂ Â» serait la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table is-style-regular&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;txid&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;TemporalitÃ©&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;999&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;mark style=&#34;background-color:rgba(0, 0, 0, 0)&#34; class=&#34;has-inline-color has-bleu-dodger-color&#34;&gt;&lt;strong&gt;1000&lt;/strong&gt;&lt;/mark&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;mark style=&#34;background-color:rgba(0, 0, 0, 0)&#34; class=&#34;has-inline-color has-bleu-dodger-color&#34;&gt;&lt;strong&gt;PrÃ©sent&lt;/strong&gt;&lt;/mark&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1001&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Futur -&amp;gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;31&lt;/sup&gt; + 999&lt;br&gt;2 147 484 647&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Futur -&amp;gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;31&lt;/sup&gt; + 1000&lt;br&gt;2 147 484 648&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;sup&gt;32&lt;/sup&gt;&lt;br&gt;4 294 967 295&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;lt;- PassÃ©&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-image&#34;&gt;&#xA;&lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://blog.arthurbazin.com/wp-content/uploads/tuto_vacuum_freeze_wraparround-2.svg&#34; alt=&#34;&#34; class=&#34;wp-image-3132&#34;/&gt;&lt;/figure&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&lt;p&gt;Voici une requÃªte pour connaitre les limites de votre passÃ© et de votre futur :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;  txid_current() AS &#34;txid_current&#34;,&#xA;  CASE &#xA;    WHEN txid_current() &amp;lt; 2^31 THEN txid_current() + 2^31 - 1&#xA;    ELSE txid_current() + 2^31 - 2^32 - 1&#xA;  END AS &#34;limite_futur&#34;,&#xA;  CASE &#xA;    WHEN txid_current() &gt; 2^31 THEN txid_current() - 2^31&#xA;    ELSE txid_current() - 2^31 + 2^32&#xA;  END AS &#34;limite_passÃ©&#34;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h5 class=&#34;wp-block-heading&#34;&gt;Gel des donnÃ©es : Freeze&lt;/h5&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le problÃ¨me qui peut survenir c&amp;rsquo;est que lorsqu&amp;rsquo;il y a eu plus de 2,1 (exactement 2&lt;sup&gt;21&lt;/sup&gt;) milliards de transactions, PostgreSQL va considÃ©rer d&amp;rsquo;anciennes transactions comme Ã©tant dans le futur. Pas trÃ¨s pratique&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;C&amp;rsquo;est pour rÃ©soudre ce problÃ¨me que le FREEZE a Ã©tÃ© inventÃ©. Il permet d&amp;rsquo;ajouter un drapeau sur un tuple indiquant que son &lt;em&gt;xmin &lt;/em&gt;est Â«Â gelÃ©Â Â», c&amp;rsquo;est Ã  dire que peu importe la valeur du &lt;em&gt;xmin&lt;/em&gt;, il doit Ãªtre considÃ©rÃ© comme infÃ©rieur au &lt;em&gt;txid&lt;/em&gt; actuel, mÃªme si ce n&amp;rsquo;est pas le cas.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, le VACUUM se charge de geler les lignes adÃ©quates selon les cas suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM standard :&lt;/strong&gt; tous les tuples dont le &lt;em&gt;xmin&lt;/em&gt; est infÃ©rieur de la valeur Ã  : &lt;code&gt;oldest_current_txid&lt;/code&gt; &amp;#8211; &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt;&lt;br&gt;Le FREEZE n&amp;rsquo;est opÃ©rÃ© que sur les pages pour lesquelles le VACUUM opÃ¨re : les pages contenant des tuples morts. On parle alors de lazy FREEZE (FREEZE paresseux).&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La valeur de &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt; est dÃ©finie dans le fichier &lt;em&gt;postgresql.com&lt;/em&gt; et est fixÃ©e par dÃ©faut fixÃ©e Ã  50 000 000.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;oldest_current_txid&lt;/code&gt; correspond au plus vieux txid des transaction en cours.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM FREEZE :&lt;/strong&gt; tous les tuples dont le &lt;em&gt;xmin&lt;/em&gt; est infÃ©rieur Ã  &lt;code&gt;oldest_current_txid&lt;/code&gt;.&lt;br&gt;Le FREEZE est opÃ©rÃ© sur toutes les pages de la table. On parle de FREEZE aggressif.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;strong&gt;VACUUM FULL :&lt;/strong&gt; Ã©quivalent du VACUUM FREEZE, les opÃ©rations de nettoyage sont diffÃ©rentes mais les opÃ©rations de FREEZE intÃ©grÃ©e sont Ã©quivalentes.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si l&amp;rsquo;age de la table (age du plus vieux tuple) dÃ©passe la valeur de la variable &lt;code&gt;vacuum_freeze_table_age&lt;/code&gt; (par dÃ©faut 150 000 000) alors le prochain VACUUM lancÃ© s&amp;rsquo;accompagnera d&amp;rsquo;un FREEZE aggressif.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention car le gel des tuples d&amp;rsquo;une page implique de rÃ©Ã©crire entiÃ¨rement cette derniÃ¨re et a donc un coÃ»t important. Si le VACUUM prend trop de temps, il est possible de le stopper, le travail dÃ©jÃ  accompli en sera pas perdu (notamment sur le gel des donnÃ©es).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A la fin du VACUUM, des statistiques sont calculÃ©es et les valeurs suivantes renseignÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; : &lt;em&gt;txid&lt;/em&gt; le plus rÃ©cent ayant Ã©tÃ© gelÃ© dans la table.&lt;br&gt;Il s&amp;rsquo;agit de la valeur ayant Ã©tÃ© utilisÃ©e pour geler les tuples (&lt;code&gt;txid&lt;/code&gt; ou &lt;code&gt;txid&lt;/code&gt; &amp;#8211; &lt;code&gt;vacuum_freeze_min_age&lt;/code&gt;), pas forcÃ©ment du &lt;em&gt;txid&lt;/em&gt; gelÃ© le plus rÃ©cent ; ce dernier est en effet plus ancien ou Ã©gal Ã  cette valeur.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;pg_catalog.pg_database.datfrozenxid&lt;/code&gt; : &lt;em&gt;txid&lt;/em&gt; le plus rÃ©cent ayant Ã©tÃ© gelÃ© dans toute la base.&lt;br&gt;Il s&amp;rsquo;agit du &lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; le plus ancien.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans le cas de notre exemple, la colonne &lt;code&gt;max_frozen_txid&lt;/code&gt; de la fonction &lt;code&gt;get_table_info()&lt;/code&gt; vaut &lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;AUTOVACUUM&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;blockquote class=&#34;wp-block-quote is-layout-flow wp-block-quote-is-layout-flow&#34;&gt;&#xA;&lt;p&gt;Vacuuming is like exercising. If it hurts, youâ€™re not doing it enough!&lt;/p&gt;&#xA;&lt;cite&gt;Robert Haas, PGConf.EU 2023, Prague, 13 dÃ©cembre 2023&lt;/cite&gt;&lt;/blockquote&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un VACUUM cela peut Ãªtre trÃ¨s rapide mais cela peut aussi Ãªtre trÃ¨s lourd et c&amp;rsquo;est pour cela qu&amp;rsquo;il faut le lancer rÃ©guliÃ¨rement. C&amp;rsquo;est justement le rÃ´le de l&amp;rsquo;autovacuum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Toutes les minutes (interval paramÃ©trable via le paramÃ¨tre &lt;code&gt;autovacuum_naptime&lt;/code&gt;), l&amp;rsquo;autovacuum se lance, analyse les donnÃ©es de la vue &lt;code&gt;pg_stat_all_tables&lt;/code&gt; afin de dÃ©terminer s&amp;rsquo;il doit lancer un &lt;code&gt;VACUUM&lt;/code&gt; et ou un &lt;code&gt;ANALYSE&lt;/code&gt; sur les diffÃ©rentes tables de la base.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Plusieurs tables peuvent Ãªtre nettoyÃ©es en mÃªme temps : un processus de VACUUM sur une table utilise un worker et par dÃ©faut jusquâ€™Ã  trois peuvent Ãªtre lancÃ©s (variable &lt;code&gt;autovacuum_max_workers&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le dÃ©clenchement de l&amp;rsquo;autovacuum sur une table se fait si au moins l&amp;rsquo;une des conditions suivantes est remplie :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt; Le &lt;em&gt;txid&lt;/em&gt; courant est plus rÃ©cent que :&lt;br&gt;&lt;code&gt;pg_catalog.pg_class.relfrozenxid&lt;/code&gt; + &lt;code&gt;autovacuum_freeze_max_age&lt;/code&gt;&lt;br&gt;Le tuple le plus vieux de la table est plus ancien que la valeur de la variable &lt;code&gt;autovacuum_freeze_max_age&lt;/code&gt; (par dÃ©faut 200 000 000).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le nombre de tuples morts est plus important que :&lt;br&gt;&lt;code&gt;autovacuum_vacuum_threshold&lt;/code&gt; + ( &lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; Ã— &lt;code&gt;nombre_tuples_relation&lt;/code&gt; )&lt;br&gt;Avec les valeurs par dÃ©faut cela correspond Ã  250 tuples morts pour 1000 tuples dans la table ou 2050 pour 10 000.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le nombre de tuples insÃ©rÃ©s est plus important que :&lt;br&gt;&lt;code&gt;autovacuum_vacuum_insert_threshold&lt;/code&gt; + ( &lt;code&gt;autovacuum_vacuum_insert_scale_factor&lt;/code&gt; Ã— &lt;code&gt;nombre_tuples_relation&lt;/code&gt; )&lt;br&gt;Avec les valeurs par dÃ©faut cela correspond Ã  3000 tuples insÃ©rÃ©s pour 10 000 tuples dans la table.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La valeur par dÃ©faut de &lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; est trop importante pour les grosses tables. Par exemple, une table qui contient 1 000 000 d&amp;rsquo;enregistrements ne se verra nettoyÃ©e qu&amp;rsquo;aprÃ¨s 200 050 mouvements ce qui est trÃ¨s important. D&amp;rsquo;autant plus que le VACUUM qui sera dÃ©clenchÃ© risque d&amp;rsquo;Ãªtre trÃ¨s lourds en raison de la taille importante de la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les paramÃ¨tres suivants sont intÃ©ressants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;maintenance_work_mem&lt;/code&gt; / &lt;code&gt;autovacuum_work_mem&lt;/code&gt; : quantitÃ© de mÃ©moire allouÃ©e pour les processus de maintenance. N&amp;rsquo;hÃ©sitez pas Ã  le pousser jusquâ€™Ã  1 Go (au delÃ , le VACUUM n&amp;rsquo;en a pas l&amp;rsquo;utilitÃ©).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_vacuum_scale_factor&lt;/code&gt; : pourcentage de tuples modifiÃ©s au delÃ  duquel l&amp;rsquo;autovacuum se lance. Il est intÃ©ressant de le dÃ©finir spÃ©cifiquement pour les tables de grande taille.&lt;br&gt;Par exemple pour le passer Ã  5% : &lt;code&gt;ALTER TABLE table_name SET (autovacuum_vacuum_scale_factor = 0.05);&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_vacuum_insert_scale_factor&lt;/code&gt; : pourcentage de tuples insÃ©rÃ©s au delÃ  duquel l&amp;rsquo;autovacuum se lance. Il est intÃ©ressant de le dÃ©finir spÃ©cifiquement pour les tables de grande taille.&lt;br&gt;Par exemple pour le passer Ã  5% : &lt;code&gt;ALTER TABLE table_name SET (autovacuum_vacuum_insert_scale_factor = 0.05);&lt;/code&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;autovacuum_max_workers&lt;/code&gt; : nombre de workers pouvant Ãªtre lancÃ©s simultanÃ©ment durant le processus d&amp;rsquo;autovacuum.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les statistiques que nous avons actuellement pour la table de notre exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT * FROM public.get_table_info(&#39;public.table_test&#39;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;ParamÃ¨tre&lt;/th&gt;&lt;th&gt;Valeur&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;schema&lt;/td&gt;&lt;td&gt;public&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;table&lt;/td&gt;&lt;td&gt;table_test&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;nb_page&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tuple_count&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;dead_tuple_count&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;max_frozen_txid&lt;/td&gt;&lt;td&gt;4644&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_ins&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_upd&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_tup_del&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_mod_since_analyze&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;n_ins_since_vacuum&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_vacuum&lt;/td&gt;&lt;td&gt;2024-01-01 01:01:01.000 +0100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_autovacuum&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_analyze&lt;/td&gt;&lt;td&gt;2024-01-01 01:01:01.000 +0100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;last_autoanalyze&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour en savoir plus&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voila un trÃ¨s gros rÃ©sumÃ© de comment PostgreSQL gÃ¨re les donnÃ©es physiquement. Vous pouvez pousser le sujet en consultant les ressources suivantes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le stockage physique :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage-page-layout.htm&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage-page-layout.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/pageinspect.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/pageinspect.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/pgstattuple.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/pgstattuple.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/ddl-system-columns.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/ddl-system-columns.html&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le systÃ¨me de contrÃ´le concurrentiel :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/transaction-id.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/transaction-id.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql05.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql05.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.thenile.dev/blog/transaction-isolation-postgres&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.thenile.dev/blog/transaction-isolation-postgres&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://medium.com/quadcode-life/structure-of-heap-table-in-postgresql-d44c94332052&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://medium.com/quadcode-life/structure-of-heap-table-in-postgresql-d44c94332052&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://postgrespro.com/blog/pgsql/5967892&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://postgrespro.com/blog/pgsql/5967892&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://idrawone.github.io/2020/10/09/Heap-Page-in-details/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://idrawone.github.io/2020/10/09/Heap-Page-in-details/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur les TOAST :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/storage-toast.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/storage-toast.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.anayrat.info/en/2022/02/14/postgresql-toast-compression-and-toast_tuple_target/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://blog.anayrat.info/en/2022/02/14/postgresql-toast-compression-and-toast_tuple_target/&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Sur le VACUUM :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/maintenance.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.postgresql.org/docs/current/maintenance.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql05/10.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql05/10.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.interdb.jp/pg/pgsql06.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://www.interdb.jp/pg/pgsql06.html&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://public.dalibo.com/exports/formation/manuels/modules/m5/m5.handout.html#param%C3%A9trage-de-vacuum-autovacuum&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://public.dalibo.com/exports/formation/manuels/modules/m5/m5.handout.html#param%C3%A9trage-de-vacuum-autovacuum&lt;/a&gt;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;a href=&#34;https://pankajconnect.medium.com/vacuum-and-vacuum-full-postgresql-4c9da30a1500&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;https://pankajconnect.medium.com/vacuum-and-vacuum-full-postgresql-4c9da30a1500&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/stockage-physique-gestion-des-donnees-et-vacuum" rel="alternate"></link>
    <summary type="html">Base de donnÃ©es ou fichiers plats ? Saviez-vous que PostgreSQL stockait les donnÃ©es dans des fichiers plats ? DÃ©mystifions un peu ce fonctionnement.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Ouvrez les fenÃªtres de PostgreSQL â€“ Guide complet sur le fenÃªtrage</title>
    <updated>2024-01-04T16:39:54Z</updated>
    <id>tag:blog.arthurbazin.com,2024-01-04:/bdd/postgresql/ouvrez-les-fenetres-de-postgresql-guide-complet-sur-le-fenetrage</id>
    <content type="html">&#xA;&lt;p&gt;Sous PostgreSQL, il est possible d&amp;rsquo;effectuer des opÃ©rations de statistique (de type agrÃ©gat) sur un ensemble de lignes sans avoir Ã  les agrÃ©ger grÃ¢ce aux fonctions de fenÃªtrage. Il devient ainsi possible de calculer des valeurs cumulÃ©es ou encore des sommes par unitÃ© de temps (dans le cas de donnÃ©es datÃ©es)&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le fenÃªtrage permet en outre de dÃ©finir la portÃ© de la fonction, c&amp;rsquo;est Ã  dire de spÃ©cifier les limites des regroupements de lignes utilisÃ©s dans la fonction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple de ce qu&amp;rsquo;il est possible de calculer : les deux derniÃ¨res colonnes se basent sur des fonctions de fenÃªtrage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Valeur&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Cumul&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Moyenne par mois&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;27&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;D&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;47&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;E&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;23&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;70&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;F&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/02/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;90&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;G&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;H&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;113&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;I&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;123&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Syntaxe&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Clause WINDOW&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La syntaxe est relativement simple : il suffit d&amp;rsquo;utiliser une fonction de fenÃªtrage dans la clause &lt;code&gt;SELECT&lt;/code&gt; puis dÃ©finir la fenÃªtre Ã  utiliser dans la clause &lt;code&gt;WINDOW&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;colonne_1,&#xA;&#x9;colonne_2,&#xA;&#x9;fonction_fenetre(colonne_3) OVER ma_fenetre&#xA;FROM&#xA;&#x9;mon_schema.ma_table&#xA;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;--definition&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez qu&amp;rsquo;il est possible de dÃ©finir la fenÃªtre directement aprÃ¨s la fonction de fenÃªtrage :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;colonne_1,&#xA;&#x9;colonne_2,&#xA;&#x9;fonction_fenetre(colonne_3) OVER (&#xA;&#x9;&#x9;--definition&#xA;&#x9;)&#xA;FROM&#xA;&#x9;mon_schema.ma_table&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est tout Ã  fait possible de dÃ©finir plusieurs fenÃªtres dans la clause &lt;code&gt;WINDOW&lt;/code&gt; afin d&amp;rsquo;utiliser des portÃ©es diffÃ©rentes dans chaque fonction.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention les lignes vues par la fenÃªtre dÃ©pendent des clauses prÃ©sentes dans votre requÃªte :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La clause &lt;code&gt;WHERE&lt;/code&gt; restreint le nombre de lignes dans le rÃ©sultat de la requÃªte mais Ã©galement dans la fenÃªtre.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Avec la clause &lt;code&gt;GROUP BY&lt;/code&gt;, les lignes vues par la fenÃªtre sont les lignes regroupÃ©es et non les lignes d&amp;rsquo;origines.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La clause &lt;code&gt;HAVING&lt;/code&gt; restreint le nombre de lignes groupÃ©es visibles par la fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;DÃ©finition&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La dÃ©finition d&amp;rsquo;une fenÃªtre peut faire appel Ã  diffÃ©rents Ã©lÃ©ments, tous optionnels :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La clause &lt;code&gt;PARTITION BY&lt;/code&gt; : comment regrouper les lignes ?&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La clause &lt;code&gt;ORDER BY&lt;/code&gt; : comment ordonnancer les lignes ?&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de la fenÃªtre : quelles lignes du groupe faut-il utiliser ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;-- Regroupement&#xA;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;ma_colonne_1&#xA;&#x9;&#x9;-- Ordonnancement&#xA;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;ma_colonne_2&#xA;&#x9;&#x9;-- Limites&#xA;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;PARTITION BY : regroupement&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La clause de regroupement &lt;code&gt;PARTITION BY&lt;/code&gt; permet de grouper les lignes issues de la requÃªtes en partitions. Chacune de ces partitions est traitÃ©e individuellement par la fonction de fenÃªtrage. Ainsi, chaque ligne se voit attribuer une valeur calculÃ©e par la fonction de fenÃªtrage en fonction de la partition Ã  laquelle elle appartient. Par exemple la somme ou encore la valeur moyenne de toutes les valeurs d&amp;rsquo;une partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette clause attend une expression pouvant contenir une ou plusieurs colonnes ainsi que des expressions SQL (fonction, calcul&amp;#8230;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Si cette clause n&amp;rsquo;est pas spÃ©cifiÃ©e alors toutes les lignes de la requÃªte sont considÃ©rÃ©es comme faisant partie de la mÃªme partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici deux exemples de regroupement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pays&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe calculÃ© par &lt;code&gt;PARTITION BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;France&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;France&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Suisse&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Suisse&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;france&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 3&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Regroupement basÃ© sur une colonne : &lt;code&gt;PARTITION BY pays&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ma_colonne_date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe calculÃ© par &lt;code&gt;PARTITION BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;08/04/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;15/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Groupe 1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Regroupement basÃ© sur une expression : &lt;code&gt;PARTITION BY extract(MONTH FROM ma_colonne_date)&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que le regroupement des valeurs entraine un ordonnancement de celles-ci qui influe sur l&amp;rsquo;ordre des lignes dans les rÃ©sultats de la requÃªte. Il pourra Ãªtre nÃ©cessaire d&amp;rsquo;utiliser la clause &lt;code&gt;ORDER BY&lt;/code&gt; (dans la requÃªte, pas le &lt;code&gt;ORDER BY&lt;/code&gt; de la fenÃªtre) pour spÃ©cifier un ordre particulier des rÃ©sultats.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;ORDER BY : l&amp;rsquo;ordonnancement&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Selon le calcul rÃ©alisÃ©, il peut Ãªtre intÃ©ressant d&amp;rsquo;ordonnancer les valeurs de la fenÃªtre. Par exemple dans le cas d&amp;rsquo;une somme cumulÃ©e (croissante ou dÃ©croissante), il est important que les valeurs au sein d&amp;rsquo;une partition soient triÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette clause attend une expression permettant d&amp;rsquo;ordonnancer les lignes, cela peut Ãªtre une ou plusieurs colonnes ainsi que des expressions SQL (fonction, calculâ€¦).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ma_colonne_date&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;Rang calculÃ© par &lt;code&gt;ORDER BY&lt;/code&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;01/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14/03/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;15/01/2024&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption class=&#34;wp-element-caption&#34;&gt;Ordonnancement basÃ© sur une colonne, &lt;code&gt;ma_colonne_date&lt;/code&gt;&lt;/figcaption&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les options suivantes peuvent Ãªtre utilisÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ASC&lt;/code&gt; ou &lt;code&gt;DESC&lt;/code&gt; : pour spÃ©cifier un tri ascendant ou descendant.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;NULLS { FIRST | LAST }&lt;/code&gt;  pour gÃ©rer l&amp;rsquo;ordre des valeurs nulles (en premier ou en dernier).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsque plusieurs fonctions de fenÃªtrage sont utilisÃ©es, les valeurs peuvent Ãªtre triÃ©es plusieurs fois de suites.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Les fenÃªtre ayant des clauses &lt;code&gt;PARTITION BY&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; Ã©quivalente seront Ã©valuÃ©es en mÃªme temps et auront donc exactement le mÃªme ordre de tri (mÃªme si &lt;code&gt;ORDER BY&lt;/code&gt; ne dÃ©finit pas une faÃ§on unique de trier les lignes).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les fenÃªtres ayant des clauses &lt;code&gt;PARTITION BY&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; diffÃ©rentes seront Ã©valuÃ©es sÃ©parÃ©ment. Il en rÃ©sulte un tri potentiellement diffÃ©rent entre deux fenÃªtres ayant des partions diffÃ©rentes mais un ordre de tri identique (lorsque &lt;code&gt;ORDER BY&lt;/code&gt; ne dÃ©finit pas une faÃ§on unique de trier les lignes).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que l&amp;rsquo;ordonnancement des valeurs influe sur l&amp;rsquo;ordre des lignes dans les rÃ©sultats de la requÃªte. Il pourra Ãªtre nÃ©cessaire d&amp;rsquo;utiliser la clause &lt;code&gt;ORDER BY&lt;/code&gt; (dans la requÃªte, pas le &lt;code&gt;ORDER BY&lt;/code&gt; de la fenÃªtre) pour spÃ©cifier un ordre particulier des rÃ©sultats.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Clause de portÃ©e : les limites de la fenÃªtre&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions ne portent pas directement sur toutes les ligne de la partition qu&amp;rsquo;elles sont en train de traiter. En fait, leur calcul est dÃ©pendant de la ligne en cour de traitement. En effet, chaque fenÃªtre possÃ¨de un portÃ©e limitÃ©e au sein de la partition dÃ©finie (par &lt;code&gt;PARTITION BY&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Par dÃ©faut, cette limite s&amp;rsquo;Ã©tend Ã  toute la partition sauf dans le cas oÃ¹ une clause &lt;code&gt;ORDER BY&lt;/code&gt; est dÃ©finie pour la fenÃªtre. Dans ce dernier cas, la limite est comprise entre Â«Â toutes les lignes prÃ©cÃ©dentesÂ Â» et Â«Â la ligne actuelleÂ Â». Donc la fonction ne Â«Â voientÂ Â» pas les lignes qui Â«Â suiventÂ Â» au sein de la mÃªme partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les limites se dÃ©finissent de la faÃ§on suivante : &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le mode de dÃ©finition&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de dÃ©but&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La limite de fin&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les exclusions&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;{ROWS | RANGE | GROUPS}&#xA;BETWEEN&#xA;&#x9;{UNBOUNDED PRECEDING | n PRECEDING | CURRENT ROW | n FOLLOWING}&#xA;AND&#xA;&#x9;{n PRECEDING | CURRENT ROW | n FOLLOWING | UNBOUNDED FOLLOWING}&#xA;EXCLUDE &#xA;&#x9;{CURRENT ROW | EXCLUDE GROUP | EXCLUDE TIES | EXCLUDE NO OTHERS}&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il existe trois modes de dÃ©finition des limites :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : que je traduis par ligne.&lt;br&gt;On dÃ©finit un nombre spÃ©cifique de lignes avant ou aprÃ¨s la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : que je traduis par rang.&lt;br&gt;On dÃ©finit un nombre de rangs sÃ©parant la limite de la ligne courante.&lt;br&gt;Le rang de chaque ligne est dÃ©finit avec la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Plusieurs lignes peuvent avoir le mÃªme rang, on parle alors de Â«Â groupe de lignes Ã©quivalentesÂ Â» dans le tri ce qui Ã©quivaut Ã  Â«Â groupe de ligne ayant le mÃªme rangÂ Â» dans le tri.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : (mode par dÃ©faut) que je traduis par intervalle.&lt;br&gt;On dÃ©finit un intervalle d&amp;rsquo;Ã©cart entre la ligne courante et la limite&lt;br&gt;L&amp;rsquo;intervalle est calculÃ© sur une colonne unique dÃ©finie dans la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Le type de l&amp;rsquo;intervalle dÃ©pend de la colonne spÃ©cifiÃ©e (numÃ©rique, date&amp;#8230;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La dÃ©finition des limites peut utiliser les Ã©lÃ©ments suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;UNBOUNDED PRECEDING&lt;/code&gt; : toutes les lignes prÃ©cÃ©dentes (limite infÃ©rieur par dÃ©faut)&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;n PRECEDING&lt;/code&gt; : &#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : n = nombre de ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : n = nombre de rang/groupe.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : n = intervalle avec la ligne actuelle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;CURRENT ROW&lt;/code&gt; : (limite supÃ©rieur par dÃ©faut)&lt;br&gt;Ã‰quivalent Ã  &lt;code&gt;0 PRECEDING&lt;/code&gt; ou &lt;code&gt;0 FOLLOWING&lt;/code&gt;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : la ligne courante ainsi que toutes les lignes ayant le mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;En dÃ©but de portÃ©e, la ligne utilisÃ©e sera la premiÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;En fin de portÃ©e, la ligne utilisÃ©e sera la derniÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : la ligne courante ainsi que toutes les lignes ayant le mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;En dÃ©but de portÃ©e, la ligne utilisÃ©e sera la premiÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;En fin de portÃ©e, la ligne utilisÃ©e sera la derniÃ¨re ligne retournÃ©e ayant un rang Ã©quivalent Ã  la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;n FOLLOWING&lt;/code&gt; :&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;ROWS&lt;/code&gt; : n = nombre de ligne.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;GROUPS&lt;/code&gt; : n = nombre de rang/groupe.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;RANGE&lt;/code&gt; : n = intervalle avec la ligne courante.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;UNDOUNDED FOLLOWING&lt;/code&gt; : toutes les lignes suivantes.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Attention aux restrictions suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;le dÃ©but de la portÃ©e ne peut valoir &lt;code&gt;UNBOUNDED FOLLOWING&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La fin de la portÃ©e ne peut valoir &lt;code&gt;UNBOUNDED PRECEDING&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le dÃ©but de la portÃ©e doit toujours Ãªtre infÃ©rieur Ã  la fin de la portÃ©e (&lt;code&gt;ROWS BETWEEN 7 PRECEDING AND 8 PRECEDING&lt;/code&gt; ne donne aucune ligne et &lt;code&gt;RANGE BETWEEN CURRENT ROW AND &lt;em&gt;n&lt;/em&gt; PRECEDING&lt;/code&gt; renvoie une erreur).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que lorsque la clause &lt;code&gt;ORDER BY&lt;/code&gt; n&amp;rsquo;est pas spÃ©cifiÃ©e, toutes les lignes sont considÃ©rÃ©es comme ayant le mÃªme rang. Ainsi, il est important de tenir compte de cet Ã©lÃ©ment dans les modes &lt;code&gt;GROUPS&lt;/code&gt; et &lt;code&gt;RANGE&lt;/code&gt; et par consÃ©quent avec la limite par dÃ©faut qui est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;RANGE BETWEEN&#xA;&#x9;UNBOUNDED PRECEDING&#xA;AND&#xA;&#x9;CURRENT ROW&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En effet, avec la limite par dÃ©faut, toutes les lignes entre la premiÃ¨re de la partition et la ligne courante incluant les lignes de mÃªme rang sont utilisÃ©es. Ainsi, deux cas de figure se prÃ©sentes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Une clause &lt;code&gt;ORDER BY&lt;/code&gt; est spÃ©cifiÃ©e : une partie seulement des lignes de la partition est utilisÃ©e.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Aucune clause &lt;code&gt;ORDER BY&lt;/code&gt; n&amp;rsquo;est spÃ©cifiÃ©e : toutes les lignes possÃ¨dent le mÃªme rang, ainsi elles sont toutes incluses dans la fenÃªtre.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans tous les cas, la distance jusqu&amp;rsquo;Ã  la fin de la portÃ©e est limitÃ©e par la distance jusqu&amp;rsquo;Ã  la fin de la partition. Si la limite dÃ©passe la fin de la partition, alors la derniÃ¨re ligne est la derniÃ¨re de la partition.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est enfin possible de dÃ©finir un ensemble de lignes Ã  exclure de la fenÃªtre avec la clause &lt;code&gt;EXCLUDE&lt;/code&gt; qui peut prendre les valeurs suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE NO OTHERS&lt;/code&gt; : ne rien exclure (comportement par dÃ©faut).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;CURRENT ROW&lt;/code&gt; : exclure la ligne courante.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE GROUP&lt;/code&gt; : exclure la ligne courante ainsi que toutes les lignes de mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;EXCLUDE TIES&lt;/code&gt; : conserver la ligne courante mais exclure toutes les lignes de mÃªme rang selon la clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;FenÃªtres de fenÃªtre&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;une fenÃªtre est dÃ©finie sans clause de portÃ©e, il est possible d&amp;rsquo;en dÃ©finir une seconde Ã  partir de celle-ci.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans ce cas :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;La seconde reprend le partitionnement de la fenÃªtre source.&lt;br&gt;Il est impossible de spÃ©cifier une clause &lt;code&gt;PARTITION BY&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La seconde reprend l&amp;rsquo;ordonnancement de la fenÃªtre source si la clause &lt;code&gt;ORDER BY&lt;/code&gt; existe.&lt;br&gt;Dans ce cas, il est impossible de spÃ©cifier une clause &lt;code&gt;ORDER BY&lt;/code&gt;.&lt;br&gt;Sinon, la seconde peut se voir dÃ©finir un clause &lt;code&gt;ORDER BY&lt;/code&gt; qui lui sera spÃ©cifique.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;La seconde peut avoir ses propres limites de fenÃªtre via sa propre clause de portÃ©e.&lt;br&gt;Si les limites ne sont pas dÃ©finies, les limites par dÃ©faut s&amp;rsquo;appliquent (&lt;code&gt;RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW&lt;/code&gt;).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un exemple :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;WINDOW&#xA;&#x9;ma_fenetre as (&#xA;&#x9;&#x9;-- Regroupement&#xA;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;ma_colonne_1&#xA;&#x9;),&#xA;&#xA;&#x9;ma_seconde_fenetre as (&#xA;&#x9;&#x9;-- FenÃªtre source&#xA;&#x9;&#x9;ma_fenetre&#xA;&#x9;&#x9;-- Ordonnancement (car la fenÃªtre source ne spÃ©cifie pas de clause ORDER BY)&#xA;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;ma_colonne_2&#xA;&#x9;&#x9;-- Limites spÃ©cifiques&#xA;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;)&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Les fonctions&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les fonctions de fenÃªtrage peuvent Ãªtre utilisÃ©es dans les clauses &lt;code&gt;SELECT&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; uniquement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ces fonctions regroupent Ã  la fois les fonctions spÃ©cifiques au fenÃªtrage (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-window.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentÃ©es ici&lt;/a&gt;) ainsi que certaines fonctions d&amp;rsquo;agrÃ©gation : celles Ã  but gÃ©nÃ©ral (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentÃ©es ici&lt;/a&gt;) et celles Ã  but statistique (&lt;a href=&#34;https://www.postgresql.org/docs/current/functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;documentÃ©es ici&lt;/a&gt;) mais pas les autres.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La syntaxe est la suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;fonction_fenetre(colonne) OVER ma_fenetre&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Lors de l&amp;rsquo;utilisation de fonctions d&amp;rsquo;agrÃ©gation avec une fenÃªtre, il n&amp;rsquo;est pas possible d&amp;rsquo;utiliser les clauses &lt;code&gt;DISTINCT&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; dans les arguments de la fonction comme habituellement avec les fonctions d&amp;rsquo;agrÃ©gation.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;En revanche, ces fonctions d&amp;rsquo;agrÃ©gation autorisent le filtrage des lignes utilisÃ©es par celles-ci grÃ¢ce Ã  la clause &lt;code&gt;FILTER&lt;/code&gt; de la faÃ§on suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;fonction_fenetre(colonne) FILTER ( WHERE ma_clause_where ) OVER ma_fenetre&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est ainsi possible d&amp;rsquo;utiliser n&amp;rsquo;importe quelle condition qui sera testÃ©e sur chaque ligne de la fenÃªtre avant de fournir celles-ci Ã  la fonction. Les lignes ne satisfaisant pas la conditions seront ignorÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les principales fonctions de fenÃªtrage :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table alignwide has-fixed-layout is-style-stripes&#34;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Fonction&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;row_number()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;NumÃ©ro de ligne&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang de l&amp;rsquo;objet avec trou. &lt;br&gt;Comme row_number() mais deux objets peuvent avoir le mÃªme rang.&lt;br&gt;Par exemple : &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;6&lt;/code&gt;, &lt;code&gt;7&lt;/code&gt;, &lt;code&gt;7&lt;/code&gt;, &lt;code&gt;9&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;dense_rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang de l&amp;rsquo;objet sans trou. &lt;br&gt;Comme rank() mais si plusieurs objets ont le mÃªme rang, l&amp;rsquo;objet d&amp;rsquo;aprÃ¨s possÃ¨de le rang suivant.&lt;br&gt;Par exemple : &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;3&lt;/code&gt;, &lt;code&gt;4&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;5&lt;/code&gt;, &lt;code&gt;6&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;percent_rank()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang en pourcentage (de 0% Ã  100%) : (rang -1) / (nb_ligne_total &amp;#8211; 1).&lt;br&gt;Par exemple (pour 4 valeurs) : &lt;code&gt;0%&lt;/code&gt;, &lt;code&gt;33%&lt;/code&gt;, &lt;code&gt;66%&lt;/code&gt;, &lt;code&gt;100%&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;cume_dist()&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Rang en pourcentage (de n% Ã  100%) : (nb_lignes_prÃ©cÃ©dentes + nb_ligne_mÃªme_rang + 1) / (nb_ligne_total).&lt;br&gt;Par exemple (pour 4 valeurs) : &lt;code&gt;25%&lt;/code&gt;, &lt;code&gt;50%&lt;/code&gt;, &lt;code&gt;75%&lt;/code&gt;, &lt;code&gt;100%&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;first_value(colonne_1)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;PremiÃ¨re valeur issue de la fenÃªtre pour la colonne indiquÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;last_value(colonne_1)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;DerniÃ¨re valeur issue de la fenÃªtre pour la colonne indiquÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;nth_value(colonne_1,n)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur &amp;lsquo;n&amp;rsquo; issue de la fenÃªtre pour la colonne indiquÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;lag(colonne_1,n,&#39;text&#39;)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur issue de la fenÃªtre pour la colonne indiquÃ©e situÃ©e n lignes (defaut = &lt;code&gt;1&lt;/code&gt;) avant la ligne Ã©valuÃ©e. &lt;br&gt;Si aucune valeur n&amp;rsquo;existe, &amp;lsquo;text&amp;rsquo; (dÃ©faut = &lt;code&gt;NULL&lt;/code&gt;) est renvoyÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;lead(colonne_1,n,&#39;text&#39;)&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Valeur issue de la fenÃªtre pour la colonne indiquÃ©e situÃ©e n lignes (defaut = &lt;code&gt;1&lt;/code&gt;) aprÃ¨s la ligne Ã©valuÃ©e. &lt;br&gt;Si aucune valeur n&amp;rsquo;existe, &amp;lsquo;text&amp;rsquo; (dÃ©faut = &lt;code&gt;NULL&lt;/code&gt;) est renvoyÃ©e.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Exemples&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Exemple basique&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;DonnÃ©es d&amp;rsquo;exemple&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour rÃ©aliser nos exemples, nous allons utiliser les donnÃ©es suivantes :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;valeur&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;13&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;21&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;22&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;23&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;30&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;31&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;32&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;33&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici la requÃªte qui permet de crÃ©er une table contenant ces donnÃ©es, notez que les lignes sont dans le dÃ©sordre (pour mieux apprÃ©cier le fonctionnement des fenÃªtres) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- DROP TABLE public.test_fenetrage;&#xA;&#xA;CREATE TABLE public.test_fenetrage AS &#xA;SELECT&#xA;&#x9;*&#xA;FROM (&#xA;&#x9;VALUES&#xA;&#x9;&#x9;(&#39;C-3&#39;, &#39;C&#39;, 2, 32),&#xA;&#x9;&#x9;(&#39;A-1&#39;, &#39;A&#39;, 1, 10),&#xA;&#x9;&#x9;(&#39;C-1&#39;, &#39;C&#39;, 4, 30),&#xA;&#x9;&#x9;(&#39;B-4&#39;, &#39;B&#39;, 3, 23),&#xA;&#x9;&#x9;(&#39;B-3&#39;, &#39;B&#39;, 2, 22),&#xA;&#x9;&#x9;(&#39;A-2&#39;, &#39;A&#39;, 2, 11),&#xA;&#x9;&#x9;(&#39;C-4&#39;, &#39;C&#39;, 1, 33),&#xA;&#x9;&#x9;(&#39;B-1&#39;, &#39;B&#39;, 1, 20),&#xA;&#x9;&#x9;(&#39;C-2&#39;, &#39;C&#39;, 3, 31),&#xA;&#x9;&#x9;(&#39;A-3&#39;, &#39;A&#39;, 3, 12),&#xA;&#x9;&#x9;(&#39;A-4&#39;, &#39;A&#39;, 4, 13),&#xA;&#x9;&#x9;(&#39;B-2&#39;, &#39;B&#39;, 2, 21)&#xA;) as t1 (identifiant, groupe, ordre, valeur)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre par dÃ©faut&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici un premier test avec la fenÃªtre par dÃ©faut :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons le numÃ©ro de ligne (&lt;code&gt;row_number&lt;/code&gt;) qui correspond au numÃ©ro d&amp;rsquo;ordre des lignes dans la fenÃªtre. Cette derniÃ¨re n&amp;rsquo;ayant pas de clause &lt;code&gt;ORDER BY&lt;/code&gt;, il s&amp;rsquo;agit du numÃ©ro d&amp;rsquo;ordre dans la table (dans le stockage physique).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous pouvons voir que toutes les lignes possÃ¨dent le mÃªme rang (&lt;code&gt;rank&lt;/code&gt;) car nous n&amp;rsquo;avons pas utilisÃ© la clause &lt;code&gt;ORDER BY&lt;/code&gt; dans la fenÃªtre. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons Ã©galement une information sur les valeurs immÃ©diatement prÃ©cÃ©dentes (&lt;code&gt;lag&lt;/code&gt;) et suivantes (&lt;code&gt;lead&lt;/code&gt;) de chaque ligne ainsi que la premiÃ¨re (&lt;code&gt;first_value&lt;/code&gt;) et la derniÃ¨re (&lt;code&gt;last_value&lt;/code&gt;) valeur de la partition (et donc de la table).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons utiliser la mÃªme fenÃªtre mais avec une clause &lt;code&gt;ORDER BY&lt;/code&gt; au niveau de la requÃªte :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;ORDER BY&#xA;&#x9;identifiant&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous devriez avoir les rÃ©sultats suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons exactement les mÃªmes donnÃ©es que prÃ©cÃ©demment mais l&amp;rsquo;ordre des lignes n&amp;rsquo;est pas le mÃªme. Ceci dÃ©montre que le fenÃªtrage permet de calculer des donnÃ©es sur des ensembles bien spÃ©cifiques avec un ordre bien spÃ©cifique.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;Fonctionnement du CURRENT ROW&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Testez la requÃªte suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;row_number() OVER fenetre_range,&#xA;&#x9;rank() OVER fenetre_range,&#xA;&#x9;first_value(identifiant) OVER fenetre_range as first_value_range,&#xA;&#x9;last_value(identifiant) OVER fenetre_range as last_value_range,&#xA;&#x9;first_value(identifiant) OVER fenetre_row as first_value_row,&#xA;&#x9;last_value(identifiant) OVER fenetre_row as last_value_row&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;fenetre_range AS (&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;),&#xA;&#x9;fenetre_row AS (&#xA;&#x9;&#x9;ROWS&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Elle renvoie ces rÃ©sultats :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value_range&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value_range&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value_row&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value_row&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voyez la diffÃ©rence entre les modes &lt;code&gt;RANGE&lt;/code&gt; (ou &lt;code&gt;GROUPS&lt;/code&gt;) et &lt;code&gt;ROWS&lt;/code&gt;. Avec les deux premiers modes, &lt;code&gt;CURRENT ROW&lt;/code&gt; inclut toutes les lignes de mÃªme rang que la ligne courante. La premiÃ¨re ligne correspond alors Ã  la premiÃ¨re ligne de mÃªme rang que la ligne courante remontÃ©e par la requÃªte. C&amp;rsquo;est la mÃªme chose pour la derniÃ¨re ligne.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme il n&amp;rsquo;y a pas de sous ordre dÃ©finit au sein d&amp;rsquo;un mÃªme rang, c&amp;rsquo;est l&amp;rsquo;ordre de stockage des lignes qui est utilisÃ©. Ainsi, la premiÃ¨re ligne d&amp;rsquo;un rang donnÃ© correspond Ã  la premiÃ¨re ligne de ce rang rencontrÃ© lors du parcours de la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre partitionnÃ©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Utilisons maintenant les partitions avec &lt;code&gt;PARTITION BY&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;groupe,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;PARTITION BY&#xA;&#x9;&#x9;&#x9;groupe&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/th&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les calculs sont maintenant effectuÃ©s Â«Â par partitionÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est intÃ©ressant de constater que les lignes ont Ã©tÃ© rÃ©ordonnÃ©es, c&amp;rsquo;est Ã  cause du &lt;code&gt;PARTITION BY&lt;/code&gt; qui implique une rÃ©organisation des lignes lors du calcul. Notez cependant que les lignes conservent leur positionnement d&amp;rsquo;origine au sein de chaque partition (A-4 est avant A-2 qui est avant A-1 qui est avant A-3 comme dans la table d&amp;rsquo;origine).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre ordonnancÃ©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;RemplaÃ§ons les partitions par &lt;code&gt;ORDER BY&lt;/code&gt; afin dâ€™ordonnancer nos valeurs :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;ordre,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;dense_rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;ordre ASC&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les donnÃ©es suivantes sont renvoyÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dense_rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;La partition s&amp;rsquo;Ã©tend maintenant Ã  toute la table.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est intÃ©ressant de constater que les lignes ont ici aussi Ã©tÃ© rÃ©ordonnÃ©es, c&amp;rsquo;est Ã  cause du &lt;code&gt;ORDER BY&lt;/code&gt; qui implique une rÃ©organisation des lignes lors du calcul.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;IntÃ©ressons nous aux colonnes &lt;code&gt;row_number&lt;/code&gt;, &lt;code&gt;rank&lt;/code&gt; et &lt;code&gt;dense_rank&lt;/code&gt;. Nous pouvons maintenant voir la diffÃ©rence entre ces fonctions :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;&lt;code&gt;row_number&lt;/code&gt; indique le numÃ©ro de ligne aprÃ¨s le rÃ©ordonnancement effectuÃ© par la fenÃªtre. &lt;br&gt;A-1, B-1 et C-4 possÃ¨de le numÃ©ro d&amp;rsquo;ordre 1, il est donc logique de les retrouver en 1&lt;sup&gt;Ã¨re&lt;/sup&gt;, 2&lt;sup&gt;Ã¨me&lt;/sup&gt; et 3&lt;sup&gt;Ã¨me&lt;/sup&gt; place.&lt;br&gt;Notez que C-4 est avant A-1 qui est avant B-1 ce qui correspond Ã  leurs positionnements dans la table d&amp;rsquo;origine.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;rank&lt;/code&gt; permet de dÃ©finir le rang de chaque ligne. &lt;br&gt;A-1, B-1 et C-4 possÃ¨de le numÃ©ro d&amp;rsquo;ordre 1, il possÃ¨dent donc tous les trois le rang 1. A-2, B-2, B-3 et C-3 possÃ¨de la valeur d&amp;rsquo;ordre 2, il sont donc au rang suivant : 4. &lt;br&gt;Le numÃ©ro de rang correspond au premier numÃ©ro de ligne (&lt;code&gt;row_number&lt;/code&gt;) du groupe de lignes Ã©quivalentes.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;&lt;code&gt;dense_rank&lt;/code&gt; permet de dÃ©finir le rang de chaque ligne mais sans trous.&lt;br&gt;A-1, B-1 et C-4 sont au rang 1 puis A-2, B-2, B-3 et C-3 sont au rang 2.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;h4 class=&#34;wp-block-heading&#34;&gt;FenÃªtre partitionnÃ©e et ordonnancÃ©e&lt;/h4&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Combinons le &lt;code&gt;PARTITION BY&lt;/code&gt; avec le &lt;code&gt;ORDER BY&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;&#x9;identifiant,&#xA;&#x9;groupe,&#xA;&#x9;ordre,&#xA;&#x9;row_number() OVER ma_fenetre,&#xA;&#x9;rank() OVER ma_fenetre,&#xA;&#x9;dense_rank() OVER ma_fenetre,&#xA;&#x9;lag(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;first_value(identifiant) OVER ma_fenetre,&#xA;&#x9;lead(identifiant, 1) OVER ma_fenetre,&#xA;&#x9;last_value(identifiant) OVER ma_fenetre&#xA;FROM &#xA;&#x9;public.test_fenetrage&#xA;WINDOW&#xA;&#x9;ma_fenetre AS (&#xA;&#x9;&#x9;PARTITION BY&#xA;&#x9;&#x9;&#x9;groupe&#xA;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;ordre ASC&#xA;&#x9;&#x9;RANGE&#xA;&#x9;&#x9;&#x9;BETWEEN&#xA;&#x9;&#x9;&#x9;&#x9;UNBOUNDED PRECEDING&#xA;&#x9;&#x9;&#x9;AND&#xA;&#x9;&#x9;&#x9;&#x9;CURRENT ROW&#xA;&#x9;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;identifiant&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;groupe&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;ordre&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;row_number&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;dense_rank&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lag&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;first_value&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;lead&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;last_value&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;A-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;B-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;C-1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous avons maintenant des donnÃ©es calculÃ©es pour chaque partition en utilisant un ordre d&amp;rsquo;affichage spÃ©cifique.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Statistiques sur mon dernier voyage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons maintenant voir un cas lÃ©gÃ¨rement plus concret. Il s&amp;rsquo;agit d&amp;rsquo;un petit tour que j&amp;rsquo;ai fait en Europe et dont j&amp;rsquo;aimerais calculer quelques statistiques.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-bleu-dodger-color has-text-color has-link-color wp-elements-3c6d8cfd14dcc1cdeb3ec9c6ac006d7c&#34;&gt;Notez que vous aurez besoin de PostGIS pour cet exemple.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici les donnÃ©es :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- DROP TABLE public.voyage_fenetrage;&#xA;&#xA;CREATE TABLE public.voyage_fenetrage AS &#xA;SELECT&#xA;  *&#xA;FROM (&#xA;  VALUES&#xA;    (&#39;2023-07-01&#39;::date, &#39;Maison&#39;, &#39;Maison&#39;, &#39;SRID=4326;POINT(6.3183 46.19)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-01&#39;::date, &#39;Suisse&#39;, &#39;GenÃ¨ve&#39;, &#39;SRID=4326;POINT(6.14 46.20)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-03&#39;::date, &#39;Suisse&#39;, &#39;Berne&#39;, &#39;SRID=4326;POINT(7.44 46.95)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-07&#39;::date, &#39;Suisse&#39;, &#39;Zurich&#39;, &#39;SRID=4326;POINT(8.54 47.37)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-10&#39;::date, &#39;Autriche&#39;, &#39;Innsbruck&#39;, &#39;SRID=4326;POINT(11.39 47.26)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-12&#39;::date, &#39;Allemagne&#39;, &#39;Munich&#39;, &#39;SRID=4326;POINT(11.58 48.14)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-17&#39;::date, &#39;Allemagne&#39;, &#39;Francfort&#39;, &#39;SRID=4326;POINT(8.68 50.11)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-21&#39;::date, &#39;Allemagne&#39;, &#39;Berlin&#39;, &#39;SRID=4326;POINT(13.41 52.52)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-25&#39;::date, &#39;Allemagne&#39;, &#39;Hambourg&#39;, &#39;SRID=4326;POINT(9.99 53.55)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-07-29&#39;::date, &#39;Danemark&#39;, &#39;Copenhague&#39;, &#39;SRID=4326;POINT(12.58 55.68)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-01&#39;::date, &#39;Royaume-Uni&#39;, &#39;Ã‰dimbourg&#39;, &#39;SRID=4326;POINT(-3.20 55.95)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-05&#39;::date, &#39;Royaume-Uni&#39;, &#39;Glasgow&#39;, &#39;SRID=4326;POINT(-4.25 55.86)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-09&#39;::date, &#39;Royaume-Uni&#39;, &#39;Manchester&#39;, &#39;SRID=4326;POINT(-2.24 53.48)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-13&#39;::date, &#39;Royaume-Uni&#39;, &#39;Londres&#39;, &#39;SRID=4326;POINT(0 51.51)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-16&#39;::date, &#39;France&#39;, &#39;Paris&#39;, &#39;SRID=4326;POINT(2.35 48.85)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-20&#39;::date, &#39;France&#39;, &#39;Nantes&#39;, &#39;SRID=4326;POINT(-1.55 47.21)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-22&#39;::date, &#39;France&#39;, &#39;Toulouse&#39;, &#39;SRID=4326;POINT(1.44 43.60)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-25&#39;::date, &#39;France&#39;, &#39;Marseille&#39;, &#39;SRID=4326;POINT(5.37 43.29)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-28&#39;::date, &#39;France&#39;, &#39;Annecy&#39;, &#39;SRID=4326;POINT(6.13 45.90)&#39;::geometry(point, 4326)),&#xA;    (&#39;2023-08-31&#39;::date, &#39;Maison&#39;, &#39;Maison&#39;, &#39;SRID=4326;POINT(6.3183 46.19)&#39;::geometry(point, 4326))&#xA;) as t1 (date_arrive, pays, ville, geom)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Je considÃ¨re que la date d&amp;rsquo;arrivÃ©e quelque part correspond Ã  la date d&amp;rsquo;arrivÃ©e Ã  l&amp;rsquo;Ã©tape suivante.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le but est d&amp;rsquo;avoir des informations tout au long du trajet : distance parcourue, pourcentage d&amp;rsquo;avancement, avancement par pays&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons utiliser plusieurs fenÃªtres en parallÃ¨le afin de calculer ce dont nous avons besoin.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT&#xA;  -- Localisation Ã©tape&#xA;  concat(ville, &#39; (&#39;, pays, &#39;)&#39;) AS etape,&#xA;  -- Date d&#39;arrivÃ©e&#xA;  date_arrive,&#xA;  -- Date de dÃ©part : date d&#39;arrivÃ©e de la ligne suivante&#xA;  lead(date_arrive, 1) OVER toutes_lignes AS date_depart,&#xA;  -- DurÃ©e de l&#39;Ã©tape&#xA;  lead(date_arrive, 1) OVER toutes_lignes - date_arrive AS duree_etape,&#xA;  -- DurÃ©e totale du voyage trajet depuis la premiÃ¨re localisation&#xA;  -- Fonction first_value permettant de rÃ©cupÃ©rer la premiÃ¨re ligne de la fenÃªtre&#xA;  date_arrive - first_value(date_arrive) OVER toutes_lignes AS duree_voyage,&#xA;  -- Distance parcourue depuis la localisation prÃ©cÃ©dente&#xA;  -- Fonction lag permettant de rÃ©cupÃ©rer la ligne prÃ©cÃ©dente&#xA;  -- ST_DistanceSpheroid pour obtenir la distance entre deux coordonnÃ©es en WGS84&#xA;  ST_DistanceSpheroid(&#xA;    geom, &#xA;    lag(geom, 1) OVER toutes_lignes,&#xA;    &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;  )::integer/1000 AS distance_depuis_loc_precedente,&#xA;  -- Distance totale parcourue depuis la premiÃ¨re localisation&#xA;  -- Fonction ST_MakeLine permettant de crÃ©er une ligne constituÃ©e de l&#39;ensemble des points de la fenÃªtre&#xA;  -- L&#39;ordre des point est assurÃ© par la fenÃªtre&#xA;  -- ST_DistanceSpheroid pour obtenir la longueur d&#39;une ligne en WGS84&#xA;  ST_LengthSpheroid(&#xA;    ST_MakeLine(geom) OVER lignes_precedentes,&#xA;    &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;  )::integer/1000 AS distance_parcourue,&#xA;  -- Calcul d&#39;un pourcentage de parcours en comparant les valeurs issues de calculs sur deux fenÃªtres diffÃ©rentes&#xA;  round(&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER lignes_precedentes,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric /&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER toutes_lignes,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric *&#xA;    100,&#xA;    2&#xA;  ) AS pourcentage_trajet,&#xA;  -- Calcul d&#39;un pourcentage de parcours par pays en comparant les valeurs issues de calculs sur deux fenÃªtres diffÃ©rentes&#xA;  -- La fonction nullif permet d&#39;Ã©liminer les divisions par 0&#xA;  round(&#xA;    ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER lignes_precedentes_pays,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric /&#xA;    nullif(ST_LengthSpheroid(&#xA;      ST_MakeLine(geom) OVER toutes_lignes_pays,&#xA;      &#39;SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563]&#39;&#xA;    )::numeric,0) *&#xA;    100,&#xA;    2&#xA;  ) AS pourcentage_trajet_pays&#xA;FROM &#xA;  public.voyage_fenetrage&#xA;WINDOW&#xA;  toutes_lignes AS (&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        UNBOUNDED FOLLOWING&#xA;  ),&#xA;  lignes_precedentes AS (&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        CURRENT ROW&#xA;  ),&#xA;  toutes_lignes_pays AS (&#xA;    PARTITION BY &#xA;      pays&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        UNBOUNDED FOLLOWING&#xA;  ),&#xA;  lignes_precedentes_pays AS (&#xA;    PARTITION BY &#xA;      pays&#xA;    ORDER BY&#xA;      date_arrive&#xA;    ROWS&#xA;      BETWEEN&#xA;        UNBOUNDED PRECEDING&#xA;      AND&#xA;        CURRENT ROW&#xA;  )&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voici le rÃ©sultat :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-table&#34;&gt;&lt;table class=&#34;has-fixed-layout&#34;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;etape&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;date_arrive&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;date_depart&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;duree_etape&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;duree_voyage&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;distance_depuis_loc_precedente&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;distance_parcourue&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pourcentage_trajet&lt;/th&gt;&lt;th class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;pourcentage_trajet_pays&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Maison (Maison)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;GenÃ¨ve (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-03&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;14&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0,28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Berne (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-03&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-07&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;129&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;144&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2,76&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;57,61&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Zurich (Suisse)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-07&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;6&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;95&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;240&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4,58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Innsbruck (Autriche)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-10&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;215&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;456&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;8,69&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Munich (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-12&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;11&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;98&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;554&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10,58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Francfort (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-17&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-21&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;304&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;859&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;16,38&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;30,89&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Berlin (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-21&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;424&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1â€¯284&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24,48&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;73,99&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Hambourg (Allemagne)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-29&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;256&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1â€¯540&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;29,37&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Copenhague (Danemark)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-07-29&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;290&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;1â€¯830&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;34,9&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Ã‰dimbourg (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-01&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;987&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2â€¯818&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;53,72&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Glasgow (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-05&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;35&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;66&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2â€¯884&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;54,99&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;10,58&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Manchester (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-09&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;39&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;294&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3â€¯179&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;60,61&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;57,53&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Londres (Royaume-Uni)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-13&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;43&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;266&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3â€¯446&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;65,7&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Paris (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-16&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;46&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;340&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3â€¯786&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;72,18&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Nantes (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-20&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-22&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;50&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;343&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4â€¯130&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;78,72&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;24,11&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Toulouse (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-22&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;52&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;464&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4â€¯594&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;87,57&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;56,72&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Marseille (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-25&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;55&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;319&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;4â€¯914&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;93,67&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;79,19&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Annecy (France)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-28&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;3&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;58&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;296&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5â€¯210&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;99,32&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Maison (Maison)&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;2023-08-31&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;61&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;35&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;5â€¯246&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;100&lt;/td&gt;&lt;td class=&#34;has-text-align-center&#34; data-align=&#34;center&#34;&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Vous voyez qu&amp;rsquo;avec le fenÃªtrage il devient simple de rÃ©aliser tout un tas de calculs divers et variÃ©s sur vos donnÃ©es.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Un excellent exemple est Ã©galement fournit dans l&amp;rsquo;article suivant oÃ¹ je me sers du fenÃªtrage pour dÃ©terminer le parcours du PÃ¨re NoÃ«l dans la nuit du 24 au 25.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-embed aligncenter is-type-wp-embed is-provider-bazinga-039-s wp-block-embed-bazinga-039-s&#34;&gt;&lt;div class=&#34;wp-block-embed__wrapper&#34;&gt;&#xA;&lt;blockquote class=&#34;wp-embedded-content&#34; data-secret=&#34;1XkVFCGu98&#34;&gt;&lt;a href=&#34;https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis&#34;&gt;Suivons le PÃ¨re NoÃ«l avec PostGIS (Nouvelle version)&lt;/a&gt;&lt;/blockquote&gt;&lt;iframe loading=&#34;lazy&#34; class=&#34;wp-embedded-content&#34; sandbox=&#34;allow-scripts&#34; security=&#34;restricted&#34;  title=&#34;Â«Â Suivons le PÃ¨re NoÃ«l avec PostGIS (Nouvelle version)Â Â» &amp;#8212; BazinGa&amp;#039;s&#34; src=&#34;https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis/embed#?secret=31T1XinWsi#?secret=1XkVFCGu98&#34; data-secret=&#34;1XkVFCGu98&#34; width=&#34;600&#34; height=&#34;338&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34;&gt;&lt;/iframe&gt;&#xA;&lt;/div&gt;&lt;/figure&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Pour aller plus loin&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cet article fait parti du cours sur PostgreSQL, parties 3 et 4 du Vade-mecum.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-buttons is-vertical is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-9a7cdcfd wp-block-buttons-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/sql/postgresql-tout-comprendre-1&#34;&gt;Cours sur PostgreSQL&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/sql/postgresql-vade-mecum-3#le_fenetrage&#34;&gt;Vade-mecum &amp;#8211; 3 &amp;#8211; GÃ©rer la donnÃ©e&lt;/a&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-button has-custom-width wp-block-button__width-50&#34;&gt;&lt;a class=&#34;wp-block-button__link wp-element-button&#34; href=&#34;https://blog.arthurbazin.com/programmation/postgresql-vade-mecum-4#fonction_de_fenetrage&#34;&gt;Vade-mecum &amp;#8211; 4 &amp;#8211; Fonctions et opÃ©rateurs&lt;/a&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/ouvrez-les-fenetres-de-postgresql-guide-complet-sur-le-fenetrage" rel="alternate"></link>
    <summary type="html">Voici un guide complet sur l&#39;utilisation du fenÃªtrage sous PostgreSQL. Ces fonctionnalitÃ©s sont particuliÃ¨rement pratique lors de l&#39;analyse de donnÃ©es continues.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>Suivons le PÃ¨re NoÃ«l avec PostGIS (Nouvelle version)</title>
    <updated>2023-12-14T13:23:01Z</updated>
    <id>tag:blog.arthurbazin.com,2023-12-14:/bdd/postgresql/suivons-le-pere-noel-avec-postgis</id>
    <content type="html">&#xA;&lt;p&gt;Cette annÃ©e pour NoÃ«l, j&amp;rsquo;ai eu l&amp;rsquo;idÃ©e de monter une application de suivi du PÃ¨re NoÃ«l en temps rÃ©el. &lt;a href=&#34;https://santatracker.google.com/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;Google&lt;/a&gt; le fait dÃ©jÃ  et le &lt;a href=&#34;https://www.noradsanta.org/fr/index.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;NORAD&lt;/a&gt; aussi alors pourquoi pas un frenchy ?&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Comme j&amp;rsquo;ai Â«Â quelques notionsÂ Â» de SQL et que je travaille chez &lt;a href=&#34;https://www.business-geografic.com/fr/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;Business Geografic&lt;/a&gt; (&lt;a href=&#34;https://www.cirilgroup.com/fr/&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener nofollow&#34;&gt;Ciril GROUP&lt;/a&gt;) (Ã©diteur franÃ§ais de solutions cartographiques web) qui a accepter de suivre ma dÃ©marche, j&amp;rsquo;ai tous les outils nÃ©cessaires Ã  une telle application sous la main. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour la suite des explications, c&amp;rsquo;est juste en dessous de l&amp;rsquo;appli (que vous pouvez consulter en plein Ã©cran sur &lt;a href=&#34;https://noel.cirilgroup.com&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;noel.cirilgroup.com&lt;/a&gt;).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;iframe loading=&#34;lazy&#34; id=&#34;iframe_santa_tracker&#34; title=&#34;Le voyage du PÃ¨re NoÃ«l&#34; src=&#34;https://geoservices.business-geografic.com/adws/app/c2d0e97d-6c09-11ed-9a76-19bfa8332a84/&#34; width=&#34;100%&#34; height=&#34;650px&#34;&gt;&#xA;&lt;/iframe&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez que cet article sâ€™intÃ©resse surtout Ã  la partie donnÃ©e (PostgreSQL + PostGIS) et moins Ã  la partie conception de l&amp;rsquo;application qui repose sur &lt;a href=&#34;https://www.business-geografic.com/fr/geo-software/geo-technologies.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;GEO Software de Business Geografic (Ciril GROUP)&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;hr class=&#34;wp-block-separator has-alpha-channel-opacity is-style-default&#34;/&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le suivi, j&amp;rsquo;ai un peu Ã©tudier la chose et il s&amp;rsquo;avÃ¨re qu&amp;rsquo;un traineau magique, Ã§a nâ€™apparait pas sur les radars. Il est donc compliquÃ© de suivre le bonhomme. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;MalgrÃ© mes nombreux courriers, le PÃ¨re NoÃ«l refuse Ã©galement de m&amp;rsquo;envoyer son itinÃ©raire dÃ©taillÃ©, un petit GPX aurait pourtant bien fait mon affaire mais il semble qu&amp;rsquo;il n&amp;rsquo;utilise pas de GPS&amp;#8230;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il faut donc un peu ruser pour suivre Santa Ã  la trace et voici comment j&amp;rsquo;ai procÃ©dÃ©.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le principe est de partir d&amp;rsquo;une liste de destinations que le PÃ¨re NoÃ«l va visiter. On calcule ensuite le trajet pour rejoindre toutes ces destinations en tenant compte du fait que le passage doit s&amp;rsquo;effectuer durant la nuit du 24 au 25 dÃ©cembre et que la terre tourne donc que l&amp;rsquo;heure de passage s&amp;rsquo;Ã©tale de GMT+12 Ã  GMT-12 (d&amp;rsquo;est en ouest). Plus facile Ã  dire qu&amp;rsquo;a faire mais essayons.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;application repose sur PostgreSQL 11 + PostGIS 2.5 (je sais, c&amp;rsquo;est oldschool mais Ã§a tourne bien) mais vous pouvez utiliser les requÃªtes suivantes dans PostgreSQL 15 + PostGIS 3.x.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous serons dans le schÃ©ma suivant :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE SCHEMA IF NOT EXISTS santa_tracker;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Destination&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A priori, le PÃ¨re NoÃ«l visite toutes les maisons du monde. Ceci dit, Â«Â toutes les maisons du mondeÂ Â» c&amp;rsquo;est complexe Ã  cartographier : un igloo doit il Ãªtre considÃ©rÃ© comme une maison mÃªme s&amp;rsquo;il n&amp;rsquo;a pas de cheminÃ©e ? &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Alors simplifions un peu la chose et basons nous sur l&amp;rsquo;ensemble des villes du monde. Bon lÃ  aussi c&amp;rsquo;est complexe car il y a vraiment beaucoup de villes et Ã§a risque d&amp;rsquo;Ãªtre difficile de suivre tous les dÃ©placements. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Simplifions encore et prenons environ 500 destinations parmi les plus connues dans le monde (avec une sur reprÃ©sentation des villes de lâ€™hexagone ;-).&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour rÃ©cupÃ©rer ces donnÃ©es, une petite recherche sur internet et nous voila avec &lt;a rel=&#34;noreferrer noopener nofollow&#34; href=&#34;https://public.opendatasoft.com/explore/dataset/geonames-all-cities-with-a-population-1000/&#34; target=&#34;_blank&#34;&gt;un magnifique jeu de donnÃ©es&lt;/a&gt; du monde entier dont la population est supÃ©rieure Ã  1000 habitants.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Quelques traitements plus tard (rien de bien sorcier, juste des formules magiques pour rÃ©cupÃ©rer les villes qui m&amp;rsquo;intÃ©ressent) nous voici avec la table suivante :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;CREATE TABLE santa_tracker.destination (&#xA;&#x9;-- Un identifiant numÃ©rique&#xA;&#x9;id_destination int8 PRIMARY KEY,&#xA;&#x9;-- La rÃ©gion de la destination&#xA;&#x9;region text,&#xA;&#x9;-- Le nom de la destination&#xA;&#x9;ville text,&#xA;&#x9;-- Le nombre d&#39;habitant dans cette destination&#xA;&#x9;population int8,&#xA;&#x9;-- L&#39;interval de temps entre le fuseau horaire de la destination et GMT&#xA;&#x9;utc_offset interval,&#xA;&#x9;-- L&#39;emplacement de la destination&#xA;&#x9;geom public.geometry(point, 4326)&#xA;);&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;ProblÃ¨me, cette table ne possÃ¨de pas l&amp;#8217;emplacement du PÃ¨re NoÃ«l&amp;#8230; Nous allons rusÃ© pour cela.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Quelques variables&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour les diffÃ©rents calculs que nous allons mener, je vais avoir besoin de dÃ©finir certains paramÃ¨tres. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour cela, nous allons crÃ©er une vue dans laquelle nous stockerons des variables que nous pourrons utiliser dans nos diffÃ©rentes requÃªtes.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_00_variable CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_00_variable as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;-- Population&#xA;&#x9;&#x9;-- Le nombre total d&#39;Ãªtre humain sur Terre&#xA;&#x9;&#x9;8000000000 as pop_total,&#xA;&#x9;&#x9;-- Le pourcentage de personne recevant des cadeaux (oui, certains ont Ã©tÃ© mÃ©chants cette annÃ©e)&#xA;&#x9;&#x9;0.95 as cadeau_par_pop,&#xA;&#x9;&#x9;-- Le nombre de cadeau par personnes&#xA;&#x9;&#x9;1 as cadeau_par_pers,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;-- Autres donnÃ©es&#xA;&#x9;&#x9;-- Largeur d&#39;une zone de longitude (ce qui permet de diviser le globe en secteurs de passage)&#xA;&#x9;&#x9;10 as largeur_zone_longitude,&#xA;&#x9;&#x9;-- Le pourcentage de temps total passÃ© Ã  voler de maison en maison (ici 90% de temps de vol donc 10% du temps passÃ© dans les maisons)&#xA;&#x9;&#x9;90::numeric as pourcent_temps_de_vol,&#xA;&#x9;&#x9;-- Les informations sur l&#39;emplacement de la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;jsonb_build_object(&#xA;&#x9;&#x9;&#x9;&#39;id&#39;, 0,&#xA;&#x9;&#x9;&#x9;&#39;region&#39;, &#39;Svalbard&#39;,&#xA;&#x9;&#x9;&#x9;&#39;ville&#39;, &#39;Maison de la famille NoÃ«l&#39;,&#xA;&#x9;&#x9;&#x9;&#39;population&#39;, 2,&#xA;&#x9;&#x9;&#x9;&#39;utc_offset&#39;, 1,&#xA;&#x9;&#x9;&#x9;&#39;geom_4326&#39;, &#39;SRID=4326;POINT(24 80)&#39;&#xA;&#x9;&#x9;) as maison_pere_noel,&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;-- Dates et horaire&#xA;&#x9;&#x9;-- Les dates contiennent toujours les heures&#xA;&#x9;&#x9;-- Le temps est exprimÃ© en temps UTC&#xA;&#x9;&#x9;-- L&#39;heure exacte du dÃ©but de la distribution (le 24 dÃ©cembre Ã  19h sur le premier fuseau horaire)&#xA;&#x9;&#x9;(extract(year from now()) || &#39;-12-24 19:00:00 +12&#39;)::timestamp with time zone as debut_distrib,&#xA;&#x9;&#x9;-- L&#39;heure exacte de la fin de la distribution (le 25 dÃ©cembre Ã  5h sur le dernier fuseau horaire)&#xA;&#x9;&#x9;(extract(year from now()) || &#39;-12-25 05:00:00 -12&#39;)::timestamp with time zone as fin_distrib,&#xA;&#x9;&#x9;-- DurÃ©e du trajet pour rejoindre la premiÃ¨re destination depuis la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;-- DurÃ©e Ã©galement pour rejoindre la maison du PÃ¨re NoÃ«l depuis la derniÃ¨re maison&#xA;&#x9;&#x9;&#39;2 minutes&#39;::interval as delai_dest_santa_house,&#xA;&#xA;&#x9;&#x9;-- Heure du dÃ©but de la transaction&#xA;&#x9;&#x9;--transaction_timestamp() as &#34;now&#34;&#x9;-- Maintenant&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Notez l&amp;rsquo;utilisation des heures avec fuseau horaire car il faut tenir compte des diffÃ©rents emplacements sur Terre.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour le calcul des dates, on utilise une extraction de l&amp;rsquo;annÃ©e depuis la fonction &lt;code&gt;transaction_timestamp()&lt;/code&gt; afin de rendre la vue valide tous les ans.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On dÃ©finit Ã©galement une variable &lt;code&gt;now&lt;/code&gt; que l&amp;rsquo;on utilisera lors des calculs Ã  un instant t car cela permet de faire des tests en fixant cette valeur. Cette derniÃ¨re peut Ãªtre modifiÃ©e pour vos tests, voila quelques moments possibles :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;generic&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Heure du dÃ©but de la transaction&#xA;transaction_timestamp() as &#34;now&#34;&#x9;-- Maintenant&#xA;&#39;2023-07-03 08:00:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Fabrication&#xA;&#39;2023-12-24 07:59:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage aller&#xA;&#39;2023-12-24 19:00:10 +1200&#39;::timestamp WITH time zone as &#34;now&#34; -- Distribution 1Ã¨re destination&#xA;&#39;2023-12-24 19:00:45 +1200&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage depuis 1Ã¨re destination&#xA;&#39;2023-12-25 00:29:25 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Distribution Ã  GenÃ¨ve&#xA;&#39;2023-12-25 00:30:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage depuis GenÃ¨ve&#xA;&#39;2023-12-25 05:01:00 -1200&#39;::timestamp WITH time zone as &#34;now&#34; -- Voyage retour&#xA;&#39;2023-12-27 08:00:00 +0100&#39;::timestamp WITH time zone as &#34;now&#34; -- Repos&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;Trajet&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous devons maintenant calculer le trajet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Ce trajet doit rÃ©pondre au critÃ¨res suivants :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Passer par toutes les destinations&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;DÃ©marrer et finir par la maison du PÃ¨re NoÃ«l&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Chaque destination doit Ãªtre visitÃ©e la nuit&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons donc devoir dÃ©couper la Terre en zones de passage dans lesquelles le PÃ¨re NoÃ«l aura un timing bien spÃ©cifique Ã  respecter. Le principe est de dÃ©terminer l&amp;rsquo;intervalle de temps pendant lequel le PÃ¨re NoÃ«l effectue sa tournÃ©e puis de diviser cet intervalle par le nombre de zones de passage.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Dans la vue &lt;code&gt;v_00_variable&lt;/code&gt; j&amp;rsquo;avais indiquÃ© un dÃ©coupage en zone de 10 degrÃ©s mais notez que si aucune destination nâ€™existe dans une zone, il ne faudra alors pas en tenir compte.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;L&amp;rsquo;intervalle est dÃ©finit par les dates de dÃ©but et de fin de la tournÃ©e spÃ©cifiÃ©es dans la vue &lt;code&gt;v_00_variable&lt;/code&gt; : du 24 dÃ©cembre Ã  19h (+12) jusqu&amp;rsquo;au 25 dÃ©cembre Ã  5h (-12) : 1j et 10h soit 34h.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour calculer le trajet et pouvoir relancer le calcul facilement, je vais me baser sur plusieurs vues.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Calcul du rang longitudinal&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Le principe est d&amp;rsquo;attribuer Ã  chaque destination un numÃ©ro de rang correspondant au numÃ©ro d&amp;rsquo;ordre de la zone de longitude Ã  laquelle appartient la destination.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Une zone de longitude est une portion de la surface terrestre comprise entre deux bornes de longitudes. Ces bornes sont dÃ©finies par rapport Ã  un dÃ©coupage du globe tous les x degrÃ©s ; x Ã©tant dÃ©fini dans la vue &lt;code&gt;v_00_variable&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_01_destination_rang_longitudeCASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_01_destination_rang_longitude as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration du rang de chaque zone de longitude (plage de x degrÃ© dÃ©finit dans la vue v_00_variable)&#xA;&#x9;&#x9;-- Le fenÃªtrage permet d&#39;Ã©liminer les zones sans destination&#xA;&#x9;&#x9;dense_rank() OVER zone_longitude as rang_longitude,&#xA;&#x9;&#x9;geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.destination &#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;zone_longitude AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;floor(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(-ST_X(geom) + 180)::numeric &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;/ var.largeur_zone_longitude&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;+ 1&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Ordonnancement par latitude&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Au sein de chaque zone de longitude, les destinations sont ordonnancÃ©es afin d&amp;rsquo;avoir un trajet cohÃ©rent allant du nord au sud dans une zone puis du sud au nord dans la zone suivante dans un mouvement Ã  l&amp;rsquo;effet Â«Â yoyoÂ Â».&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_02_destination_rang_latitude CASCADE;&#xA;&#xA;CREATE VIEW santa_tracker.v_02_destination_rang_latitude as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration du rang de chaque destination au sein de sa zone de longitude&#xA;&#x9;&#x9;-- Le rang est dÃ©terminÃ© par la latitude de l&#39;objet&#xA;&#x9;&#x9;-- Pour faire un effet &#34;yoyo&#34;, on inverse l&#39;ordonnancement des latitudes une zone de longitude sur deux&#xA;&#x9;&#x9;row_number() OVER zone_latitude as rang_latitude,&#xA;&#x9;&#x9;last_value(rang_longitude) OVER all_zone_longitude as nb_zone_longitude,&#xA;&#x9;&#x9;count(id_destination) OVER part_by_zone_longitude as nb_destination_in_zone,&#xA;&#x9;&#x9;geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_01_destination_rang_longitude&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;zone_latitude AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN rang_longitude % 2 = 0 THEN ST_Y(geom)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE -ST_Y(geom)&#xA;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;part_by_zone_longitude AS (&#xA;&#x9;&#x9;&#x9;PARTITION BY rang_longitude&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;all_zone_longitude AS (&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Consolidation des destinations&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque destination, on va calculer plusieurs valeurs, notamment des cumuls par rapport aux destination prÃ©cÃ©dentes. &lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette vue est une sorte de version amÃ©liorÃ©e de la table &lt;code&gt;destination&lt;/code&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_03_destination CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_03_destination as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la prochaine destination&#xA;&#x9;&#x9;first_value(id_destination) OVER next_etape as id_destination_next,&#xA;&#x9;&#x9;first_value(region) OVER next_etape as region_next,&#xA;&#x9;&#x9;first_value(ville) OVER next_etape as ville_next,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;-- CrÃ©ation d&#39;une valeur de population fictive&#xA;&#x9;&#x9;-- pour qu&#39;une fois toutes destination visitÃ©es, le PÃ¨re NoÃ«l ait vu toute la population mondiale&#xA;&#x9;&#x9;round( &#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(population / sum(population) OVER ()) &#xA;&#x9;&#x9;&#x9;&#x9;* var.pop_total::NUMERIC&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as pop_fictive,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;-- Rang de l&#39;Ã©tape&#xA;&#x9;&#x9;row_number() OVER all_etape as rang_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;-- Temps de passage dans chaque zone&#xA;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;(var.fin_distrib - var.debut_distrib) &#xA;&#x9;&#x9;&#x9;/ nb_zone_longitude &#xA;&#x9;&#x9;) AS duree_zone,&#xA;&#x9;&#x9;-- Temps de passage dans chaque destination (distribution + trajet pour la suivante)&#xA;&#x9;&#x9;-- DurÃ©e totale / nb zone longitude = durÃ©e par zone&#xA;&#x9;&#x9;-- DurÃ©e par zone / nb Ã©tape dans zone = temps par Ã©tape&#xA;&#x9;&#x9;-- Pour la derniÃ¨re zone, on retire le temps du dernier trajet (retour Ã  la maison du PÃ¨re NoÃ«l)&#xA;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;WHEN rang_longitude = nb_zone_longitude THEN &#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.fin_distrib - var.debut_distrib) &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;/ nb_zone_longitude &#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;/ (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;((nb_destination_in_zone - 1) * (var.pourcent_temps_de_vol/100))&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;+ (nb_destination_in_zone * ((100 - var.pourcent_temps_de_vol)/100))&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;ELSE &#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.fin_distrib - var.debut_distrib) &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;/ nb_zone_longitude &#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;/ nb_destination_in_zone&#xA;&#x9;&#x9;END as duree_destination,&#xA;&#x9;&#x9;-- On reprojete les donnÃ©es pour travailler en coordonnÃ©es projetÃ©es&#xA;&#x9;&#x9;ST_Transform(geom, 3857) as geom,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la gÃ©omÃ©trie de la prochaine destination&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;first_value(geom) OVER next_etape,&#xA;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;) as geom_next&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_02_destination_rang_latitude&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;all_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude, &#xA;&#x9;&#x9;&#x9;&#x9;rang_latitude&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;next_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY&#xA;&#x9;&#x9;&#x9;&#x9;rang_longitude, &#xA;&#x9;&#x9;&#x9;&#x9;rang_latitude&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Ã‰tapes de distribution&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A partir des donnÃ©es des destination, on gÃ©nÃ¨re des Ã©tapes de distribution des cadeaux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pendant ces Ã©tapes, le PÃ¨re NoÃ«l s&amp;rsquo;arrÃªte dans la destination et distribue les prÃ©sents.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_04_etape_distribution CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_04_etape_distribution as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la prochaine destination&#xA;&#x9;&#x9;-- S&#39;il n&#39;y a pas de prochaine destination, alors on retourne chez le PÃ¨re NoÃ«l&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(id_destination) OVER next_etape,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;id&#39;)::int&#xA;&#x9;&#x9;) as id_destination_next,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(region) OVER next_etape,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39;&#xA;&#x9;&#x9;) as region_next,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(ville) OVER next_etape,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39;&#xA;&#x9;&#x9;) as ville_next,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;-- CrÃ©ation d&#39;une valeur de population fictive&#xA;&#x9;&#x9;-- pour qu&#39;une fois toutes destination visitÃ©es, le PÃ¨re NoÃ«l ait vu toute la population mondiale&#xA;&#x9;&#x9;round( &#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;population * var.pop_total::NUMERIC&#xA;&#x9;&#x9;&#x9;&#x9;/ sum(population) OVER ()&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as pop_fictive,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;first_value(utc_offset) OVER next_etape,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval&#xA;&#x9;&#x9;) as utc_offset_next,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;(1 - (var.pourcent_temps_de_vol / 100)) * (duree_destination) AS duree_etape,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer l&#39;heure de dÃ©but de l&#39;Ã©tape&#xA;&#x9;&#x9;var.debut_distrib + &#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(duree_destination) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;&#39;0&#39;::interval&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;as date_debut,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer l&#39;heure de fin de l&#39;Ã©tape&#xA;&#x9;&#x9;var.debut_distrib &#xA;&#x9;&#x9;+ (1 - (var.pourcent_temps_de_vol / 100)) * (duree_destination) &#xA;&#x9;&#x9;+ coalesce(&#xA;&#x9;&#x9;&#x9;sum(duree_destination) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;&#39;0&#39;::interval&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;as date_fin,&#xA;&#x9;&#x9;-- Trajet effectuÃ© (ici ce sera un point)&#xA;&#x9;&#x9;-- On utilise une gÃ©omÃ©trie de type ligne pour homogÃ©nÃ©Ã¯ser les types de gÃ©omÃ©trie avec les trajets&#xA;&#x9;&#x9;ST_MakeLine(geom, geom) as geom,&#xA;&#x9;&#x9;geom AS geom_etape,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer la gÃ©omÃ©trie de la prochaine destination&#xA;&#x9;&#x9;-- S&#39;il n&#39;y a pas de prochaine destination, alors on retourne chez le PÃ¨re NoÃ«l&#xA;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;COALESCE(&#xA;&#x9;&#x9;&#x9;&#x9;first_value(geom) OVER next_etape,&#xA;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326)&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;) as geom_etape_next&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_03_destination&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;next_etape AS (&#xA;&#x9;&#x9;&#x9;ORDER BY rang_etape&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING&#xA;&#x9;&#x9;),&#xA;&#x9;&#x9;all_preceding_step AS (&#xA;&#x9;&#x9;&#x9;ORDER BY rang_etape&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Ã‰tapes de trajet&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;A partir des donnÃ©es des destination, on gÃ©nÃ¨re Ã©galement des Ã©tapes de trajet.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pendant ces Ã©tapes, le PÃ¨re NoÃ«l vol Ã  bord de son traineau de destination en destination.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_05_trajet CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_05_trajet as (&#xA;&#xA;&#x9;SELECT &#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;-- Il n&#39;y a aucune population lors du vol&#xA;&#x9;&#x9;0 AS population,&#xA;&#x9;&#x9;0 AS pop_fictive,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;-- La durÃ©e du trajet est Ã©gale Ã  la durÃ©e totale de la destination moins la durÃ©e de l&#39;Ã©tape&#xA;&#x9;&#x9;duree_destination - duree_etape AS duree_trajet,&#xA;&#x9;&#x9;-- La date de dÃ©but du trajet est identique Ã  la date de fin de l&#39;Ã©tape&#xA;&#x9;&#x9;date_fin AS date_debut,&#xA;&#x9;&#x9;-- La date de fin correspond Ã  la date de dÃ©but de l&#39;Ã©tape + la durÃ©e sur la destination&#xA;&#x9;&#x9;date_debut + duree_destination AS date_fin,&#xA;&#x9;&#x9;-- Trajet effectuÃ©&#xA;&#x9;&#x9;ST_MakeLine(geom_etape, geom_etape_next) as geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;santa_tracker.v_04_etape_distribution&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;-- On ne calcul pas de trajet pour le retour Ã  la maison du PÃ¨re NoÃ«l&#xA;&#x9;WHERE &#xA;&#x9;&#x9;id_destination_next &amp;lt;&gt; 0&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Construction du voyage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour crÃ©er le voyage, les Ã©tapes suivantes sont associÃ©es (via des &lt;code&gt;UNION ALL&lt;/code&gt;) :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Le trajet de la maison du PÃ¨re NoÃ«l jusqu&amp;rsquo;Ã  la premiÃ¨re destination (crÃ©Ã© dans la requÃªte).&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les Ã©tapes de distribution des cadeaux.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Les Ã©tapes de trajet entre destinations.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Le trajet de derniÃ¨re destination jusqu&amp;rsquo;Ã  la la maison du PÃ¨re NoÃ«l (crÃ©Ã© dans la requÃªte).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Les Ã©lÃ©ments sont ensuite rÃ©agencÃ©s selon l&amp;rsquo;ordre de passage afin de pouvoir calculer certains cumuls (population visitÃ©e, cadeaux distribuÃ©s, distance parcourue&amp;#8230;)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_06_voyage CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_06_voyage as (&#xA;&#xA;WITH &#xA;&#x9;all_steps AS (&#xA;&#x9;&#x9;-- Trajet de la maison du PÃ¨re NoÃ«l Ã  la premiÃ¨re destination&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;etp.id_destination AS id_destination_next,&#xA;&#x9;&#x9;&#x9;etp.region AS region_next,&#xA;&#x9;&#x9;&#x9;etp.ville AS ville_next,&#xA;&#x9;&#x9;&#x9;-- Il n&#39;y a aucune population lors du vol&#xA;&#x9;&#x9;&#x9;0 AS population,&#xA;&#x9;&#x9;&#x9;0 AS pop_fictive,&#xA;&#x9;&#x9;&#x9;0 AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;etp.utc_offset AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;0 AS rang_longitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_latitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_etape,&#xA;&#x9;&#x9;&#x9;1 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Trajet&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;0 AS nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;0 AS nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e totale pour la destination est uniquement la durÃ©e du trajet (pas de distribution)&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_destination,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e du trajet est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_etape,&#xA;&#x9;&#x9;&#x9;-- La date de dÃ©but du trajet est calculÃ©e par rapport aux variables&#xA;&#x9;&#x9;&#x9;var.debut_distrib - var.delai_dest_santa_house AS date_debut,&#xA;&#x9;&#x9;&#x9;-- La date de fin est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.debut_distrib AS date_fin,&#xA;&#x9;&#x9;&#x9;-- Trajet effectuÃ©&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;etp.geom_etape&#xA;&#x9;&#x9;&#x9;) AS geom&#x9;&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable AS var&#xA;&#x9;&#x9;LEFT JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_04_etape_distribution AS etp&#xA;&#x9;&#x9;&#x9;ON etp.rang_etape = 1&#xA;&#x9;&#x9;UNION ALL &#xA;&#x9;&#x9;-- Etapes de distribution des cadeaux&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;&#x9;-- Nombre de cadeau distribuÃ©&#xA;&#x9;&#x9;&#x9;round( var.cadeau_par_pop * pop_fictive::numeric, 0) AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;&#x9;2 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Distribution&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_04_etape_distribution&#xA;&#x9;&#x9;CROSS JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;UNION ALL &#xA;&#x9;&#x9;-- Trajets entre les Ã©tapes de distribution&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;&#x9;0 AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;&#x9;2 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Trajet&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;&#x9;duree_trajet AS duree_etape,&#xA;&#x9;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_05_trajet&#xA;&#x9;&#x9;UNION ALL&#xA;&#x9;&#x9;-- Trajet de la derniÃ¨re destination Ã  la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;etp.id_destination AS id_destination,&#xA;&#x9;&#x9;&#x9;etp.region AS region,&#xA;&#x9;&#x9;&#x9;etp.ville AS ville,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville_next,&#xA;&#x9;&#x9;&#x9;-- Il n&#39;y a aucune population lors du vol&#xA;&#x9;&#x9;&#x9;0 AS population,&#xA;&#x9;&#x9;&#x9;0 AS pop_fictive,&#xA;&#x9;&#x9;&#x9;0 AS cadeau_distribue,&#xA;&#x9;&#x9;&#x9;etp.utc_offset AS utc_offset,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;0 AS rang_longitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_latitude,&#xA;&#x9;&#x9;&#x9;0 AS rang_etape,&#xA;&#x9;&#x9;&#x9;3 AS rang_voyage,&#xA;&#x9;&#x9;&#x9;&#39;Trajet&#39; AS type_etape,&#xA;&#x9;&#x9;&#x9;0 AS nb_zone_longitude,&#xA;&#x9;&#x9;&#x9;0 AS nb_destination_in_zone,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e totale pour la destination est uniquement la durÃ©e du trajet (pas de distribution)&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_destination,&#xA;&#x9;&#x9;&#x9;-- La durÃ©e du trajet est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.delai_dest_santa_house AS duree_etape,&#xA;&#x9;&#x9;&#x9;-- La date de dÃ©but du trajet est calculÃ©e par rapport aux variables&#xA;&#x9;&#x9;&#x9;var.fin_distrib AS date_debut,&#xA;&#x9;&#x9;&#x9;-- La date de fin est fixÃ©e dans les variables&#xA;&#x9;&#x9;&#x9;var.fin_distrib + var.delai_dest_santa_house AS date_fin,&#xA;&#x9;&#x9;&#x9;-- Trajet effectuÃ©&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;etp.geom_etape,&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;) AS geom&#x9;&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable AS var&#xA;&#x9;&#x9;LEFT JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_04_etape_distribution AS etp&#xA;&#x9;&#x9;&#x9;ON etp.rang_etape = 440&#xA;&#x9;)&#xA;&#x9;SELECT &#xA;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#39;-&#39;,&#xA;&#x9;&#x9;&#x9;rang_voyage::text,&#xA;&#x9;&#x9;&#x9;rang_longitude::text,&#xA;&#x9;&#x9;&#x9;rang_latitude::text,&#xA;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;WHEN type_etape = &#39;Distribution&#39; THEN &#39;d&#39;&#xA;&#x9;&#x9;&#x9;&#x9;ELSE &#39;t&#39;&#xA;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;) AS id_voyage,&#xA;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;region,&#xA;&#x9;&#x9;ville,&#xA;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;population,&#xA;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de population visitÃ©e&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(pop_fictive) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as pop_fictive_cumul,&#xA;&#x9;&#x9;cadeau_distribue,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de population visitÃ©e&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(cadeau_distribue) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as cadeau_distribue_cumul,&#xA;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;rang_longitude,&#xA;&#x9;&#x9;rang_latitude,&#xA;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;rang_voyage,&#xA;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;nb_zone_longitude,&#xA;&#x9;&#x9;nb_destination_in_zone,&#xA;&#x9;&#x9;duree_destination,&#xA;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de temps de voyage&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;sum(duree_etape) OVER all_preceding_step,&#xA;&#x9;&#x9;&#x9;&#39;0 second&#39;::interval&#xA;&#x9;&#x9;) as duree_etape_cumul,&#xA;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;-- Distance parcourue durant le trajet&#xA;&#x9;&#x9;round(&#xA;&#x9;&#x9;&#x9;ST_Length(geom)::NUMERIC,&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as distance_to_next,&#xA;&#x9;&#x9;-- Le fenÃªtrage permet de rÃ©cupÃ©rer le cumul de distance parcourue&#xA;&#x9;&#x9;coalesce(&#xA;&#x9;&#x9;&#x9;round(&#xA;&#x9;&#x9;&#x9;&#x9;(sum(ST_Length(geom)) OVER all_preceding_step)::NUMERIC,&#xA;&#x9;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;0&#xA;&#x9;&#x9;) as distance_cumul,&#xA;&#x9;&#x9;-- Azimuth du symbole sur la carte&#xA;&#x9;&#x9;Degrees(ST_Azimuth(ST_StartPoint(geom),ST_EndPoint(geom))) as azimuth,&#xA;&#x9;&#x9;-- Orientation du symbole sur la carte&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;WHEN Degrees(ST_Azimuth(ST_StartPoint(geom),ST_EndPoint(geom))) &amp;lt; 180 THEN &#39;Est&#39; &#xA;&#x9;&#x9;&#x9;ELSE &#39;Ouest&#39;&#xA;&#x9;&#x9;END as orientation,&#xA;&#x9;&#x9;geom::geometry(linestring,3857)&#xA;&#x9;FROM &#xA;&#x9;&#x9;all_steps&#xA;&#x9;WINDOW &#xA;&#x9;&#x9;all_preceding_step AS (&#xA;&#x9;&#x9;&#x9;ORDER BY &#xA;&#x9;&#x9;&#x9;&#x9;rang_voyage,&#xA;&#x9;&#x9;&#x9;&#x9;rang_etape,&#xA;&#x9;&#x9;&#x9;&#x9;type_etape&#xA;&#x9;&#x9;&#x9;ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING&#xA;&#x9;&#x9;)&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;On fixe ensuite les donnÃ©es du voyage dans une vue matÃ©rialisÃ©e pour amÃ©liorer les performance lors de la consultation :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP MATERIALIZED VIEW IF EXISTS santa_tracker.vm_06_voyage CASCADE;&#xA;&#xA;CREATE MATERIALIZED VIEW santa_tracker.vm_06_voyage as (&#xA;&#x9;SELECT * &#xA;&#x9;FROM santa_tracker.v_06_voyage&#xA;)&#xA;WITH DATA&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;L&#39;Â Â»instant tÂ Â»&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Avoir un trajet c&amp;rsquo;est bien mais connaitre toutes les infos sur le trajet Ã  un Â«Â instant tÂ Â», c&amp;rsquo;est mieux.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;DonnÃ©es&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Nous allons crÃ©er une nouvelle vue qui va se baser sur la vue matÃ©rialisÃ©e &lt;code&gt;vm_06_voyage&lt;/code&gt; pour calculer la position du PÃ¨re NoÃ«l et divers les paramÃ¨tres au moment de la consultation de cette vue.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cette vue dÃ©finies trois grands temps dans l&amp;rsquo;annÃ©e :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;ul class=&#34;wp-block-list&#34;&gt;&#xA;&lt;li&gt;Du 1er janvier au 24 dÃ©cembre : le PÃ¨re NoÃ«l se trouve chez lui et fabrique les cadeaux&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;Du 24 au 25 dÃ©cembre : le PÃ¨re NoÃ«l distribue les cadeaux selon les donnÃ©es prÃ©sentes dans la vue matÃ©rialisÃ©e &lt;code&gt;vm_06_voyage&lt;/code&gt;.&lt;/li&gt;&#xA;&#xA;&#xA;&#xA;&lt;li&gt;A partir du 25 dÃ©cembre : le PÃ¨re NoÃ«l se repose chez lui aprÃ¨s tout ce travail.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;&#xA;&#xA;&#xA;DROP VIEW IF EXISTS santa_tracker.v_instant_t CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_instant_t as (&#xA;&#xA;WITH &#xA;&#x9;voyage_instant_t as (&#xA;&#x9;&#x9;-- Etape de prÃ©paration des cadeaux&#xA;&#x9;&#x9;-- Cette Ã©tape sera visible du 1er janvier au dÃ©but de la tournÃ©e&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;&#39;PrÃ©paratifs&#39; as type_trajet,&#xA;&#x9;&#x9;&#x9;&#39;0-0-0-p&#39; AS id_voyage,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination,&#xA;&#x9;&#x9;&#x9;NULL AS id_destination_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;NULL as region_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;NULL as ville_next,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;population&#39;)::integer AS population,&#xA;&#x9;&#x9;&#x9;NULL as pop_fictive,&#xA;&#x9;&#x9;&#x9;NULL as pop_fictive_cumul,&#xA;&#x9;&#x9;&#x9;-- Nombre total de cadeau total Ã  fabriquer&#xA;&#x9;&#x9;&#x9;(var.pop_total * var.cadeau_par_pop) as cadeau_distribue,&#xA;&#x9;&#x9;&#x9;0 as cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;NULL AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time ZONE - var.debut_distrib)::interval as duree_etape,&#xA;&#x9;&#x9;&#x9;&#39;0 second&#39;::interval as duree_etape_cumul,&#xA;&#x9;&#x9;&#x9;-- DÃ©but de fabrication le 1er janvier (fuseau horaire du PÃ¨re NoÃ«l)&#xA;&#x9;&#x9;&#x9;(extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone as date_debut,&#xA;&#x9;&#x9;&#x9;-- Fin de fabrication lors du dÃ©but de la distribution&#xA;&#x9;&#x9;&#x9;var.debut_distrib as date_fin,&#xA;&#x9;&#x9;&#x9;-- Calcul du pourcentage d&#39;avancement sur l&#39;Ã©tape&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.&#34;now&#34;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from ((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone))&#xA;&#x9;&#x9;&#x9;&#x9;) / (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.debut_distrib)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from ((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone))&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;)::NUMERIC as avancement,&#xA;&#x9;&#x9;&#x9;NULL as distance_to_next,&#xA;&#x9;&#x9;&#x9;NULL as distance_cumul,&#xA;&#x9;&#x9;&#x9;0 AS azimuth,&#xA;&#x9;&#x9;&#x9;NULL AS orientation,&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326), &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;) as geom &#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &amp;lt; (var.debut_distrib - var.delai_dest_santa_house)&#xA;&#x9;&#x9;UNION ALL&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration des Ã©tapes du voyage&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;type_etape,&#xA;&#x9;&#x9;&#x9;id_voyage,&#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;id_destination_next,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;region_next,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;ville_next,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;pop_fictive,&#xA;&#x9;&#x9;&#x9;pop_fictive_cumul,&#xA;&#x9;&#x9;&#x9;cadeau_distribue,&#xA;&#x9;&#x9;&#x9;cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;utc_offset_next,&#xA;&#x9;&#x9;&#x9;duree_etape,&#xA;&#x9;&#x9;&#x9;duree_etape_cumul,&#xA;&#x9;&#x9;&#x9;date_debut,&#xA;&#x9;&#x9;&#x9;date_fin,&#xA;&#x9;&#x9;&#x9;-- Calcul du pourcentage d&#39;avancement sur l&#39;Ã©tape&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.&#34;now&#34;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from date_debut)&#xA;&#x9;&#x9;&#x9;&#x9;) / (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from date_fin)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from date_debut)&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;)::NUMERIC as avancement,&#xA;&#x9;&#x9;&#x9;distance_to_next,&#xA;&#x9;&#x9;&#x9;distance_cumul,&#xA;&#x9;&#x9;&#x9;azimuth,&#xA;&#x9;&#x9;&#x9;orientation,&#xA;&#x9;&#x9;&#x9;geom &#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.vm_06_voyage as t&#xA;&#x9;&#x9;CROSS JOIN &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;WHERE &#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &gt;= date_debut&#xA;&#x9;&#x9;AND &#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &amp;lt; date_fin&#xA;&#x9;&#x9;UNION ALL&#xA;&#x9;&#x9;-- Ajout d&#39;une Ã©tape de repos&#xA;&#x9;&#x9;-- Cette Ã©tape sera visible aprÃ¨s la fin de la tournÃ©e &#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;&#39;Repos&#39; as type_trajet,&#xA;&#x9;&#x9;&#x9;&#39;0-0-0-r&#39; AS id_voyage,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;id&#39;)::int AS id_destination,&#xA;&#x9;&#x9;&#x9;NULL AS id_destination_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;NULL as region_next,&#xA;&#x9;&#x9;&#x9;var.maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;NULL as ville_next,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;population&#39;)::integer AS population,&#xA;&#x9;&#x9;&#x9;NULL as pop_fictive,&#xA;&#x9;&#x9;&#x9;var.pop_total as pop_fictive_cumul,&#xA;&#x9;&#x9;&#x9;(var.pop_total * var.cadeau_par_pop) as cadeau_distribue,&#xA;&#x9;&#x9;&#x9;(var.pop_total * var.cadeau_par_pop) as cadeau_distribue_cumul,&#xA;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;NULL AS utc_offset_next,&#xA;&#x9;&#x9;&#x9;((extract(year from now()) || &#39;-12-31 23:59:59 +01&#39;)::timestamp with time ZONE - var.fin_distrib)::interval as duree_etape,&#xA;&#x9;&#x9;&#x9;&#39;0 second&#39;::interval as duree_etape_cumul,&#xA;&#x9;&#x9;&#x9;-- DÃ©but du repos Ã  la fin de la distribution&#xA;&#x9;&#x9;&#x9;var.fin_distrib as date_debut,&#xA;&#x9;&#x9;&#x9;-- Fin du repos le 1er janvier Ã  00h00 (fuseau horaire du PÃ¨re NoÃ«l)&#xA;&#x9;&#x9;&#x9;((extract(year from now()) + 1)::text || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone as date_fin,&#xA;&#x9;&#x9;&#x9;-- Calcul du pourcentage d&#39;avancement sur l&#39;Ã©tape&#xA;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.&#34;now&#34;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from var.fin_distrib)&#xA;&#x9;&#x9;&#x9;&#x9;) / (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;extract(&#39;epoch&#39; from var.fin_distrib)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;- extract(&#39;epoch&#39; from ((extract(year from now()) || &#39;-01-01 00:00:00 +01&#39;)::timestamp with time zone))&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;)::NUMERIC as avancement,&#xA;&#x9;&#x9;&#x9;NULL as distance_to_next,&#xA;&#x9;&#x9;&#x9;NULL as distance_cumul,&#xA;&#x9;&#x9;&#x9;0 AS azimuth,&#xA;&#x9;&#x9;&#x9;NULL AS orientation,&#xA;&#x9;&#x9;&#x9;ST_MakeLine(&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326), &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;),&#xA;&#x9;&#x9;&#x9;&#x9;ST_Transform(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(var.maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(point,4326),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;3857&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;) as geom &#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable as var&#xA;&#x9;&#x9;WHERE&#xA;&#x9;&#x9;&#x9;var.&#34;now&#34; &gt; (var.fin_distrib + var.delai_dest_santa_house)&#xA;&#x9;)&#xA;SELECT &#xA;&#x9;type_trajet,&#xA;&#x9;id_voyage,&#xA;&#x9;id_destination,&#xA;&#x9;id_destination_next,&#xA;&#x9;region,&#xA;&#x9;region_next,&#xA;&#x9;ville,&#xA;&#x9;ville_next,&#xA;&#x9;population,&#xA;&#x9;pop_fictive,&#xA;&#x9;pop_fictive_cumul,&#xA;&#x9;-- Calcul du nombre de personnes visitÃ©es au moment de la visualisation&#xA;&#x9;round(&#xA;&#x9;&#x9;pop_fictive_cumul + &#xA;&#x9;&#x9;(pop_fictive * avancement)::numeric,&#xA;&#x9;&#x9;0&#xA;&#x9;) as pop_fictive_cumul_actuel,&#xA;&#x9;cadeau_distribue,&#xA;&#x9;cadeau_distribue_cumul,&#xA;&#x9;-- Calcul du nombre de cadeau distribuÃ© au moment de la visualisation&#xA;&#x9;round(&#xA;&#x9;&#x9;cadeau_distribue_cumul + &#xA;&#x9;&#x9;(cadeau_distribue * avancement)::numeric,&#xA;&#x9;&#x9;0&#xA;&#x9;) as cadeau_cumul_actuel,&#xA;&#x9;utc_offset,&#xA;&#x9;utc_offset_next,&#xA;&#x9;duree_etape,&#xA;&#x9;date_debut,&#xA;&#x9;date_fin,&#xA;&#x9;avancement,&#xA;&#x9;distance_to_next,&#xA;&#x9;distance_cumul,&#xA;&#x9;-- Calcul de la distance parcourue au moment de la visualisation&#xA;&#x9;round(&#xA;&#x9;&#x9;distance_cumul + &#xA;&#x9;&#x9;(distance_to_next * avancement)::numeric,&#xA;&#x9;&#x9;0&#xA;&#x9;) as distance_cumul_actuel,&#xA;&#x9;azimuth,&#xA;&#x9;orientation,&#xA;&#x9;-- Calcul de l&#39;emplacement au moment de la visualisation&#xA;&#x9;ST_LineInterpolatePoint(geom, avancement)::geometry(point,3857) as geom&#xA;FROM &#xA;&#x9;voyage_instant_t&#xA;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;h3 class=&#34;wp-block-heading&#34;&gt;Affichage&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Selon le moment de l&amp;rsquo;annÃ©e, nous n&amp;rsquo;allons pas afficher les mÃªmes donnÃ©es. Dans le cadre de l&amp;rsquo;application, j&amp;rsquo;ai mis en forme les donnÃ©es avec beaucoup de HTML, c&amp;rsquo;est peu lisible et nous allons donc ici gÃ©nÃ©rer quelque chose de beaucoup plus simple mais avec les mÃªmes informations.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;CrÃ©ons une vue qui rÃ©cupÃ¨re les donnÃ©es et les mets en forme :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;DROP VIEW IF EXISTS santa_tracker.v_instant_t_affichage CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_instant_t_affichage as (&#xA;&#xA;SELECT &#xA;&#x9;id_voyage,&#xA;&#x9;type_trajet,&#xA;&#x9;-- On gÃ©nÃ¨re des paroles du PÃ¨re NoÃ«l.&#xA;&#x9;-- Le texte varie selon le moment de l&#39;annÃ©e et change toutes les 10 secondes&#xA;&#x9;jsonb_extract_path_text(&#xA;&#x9;&#x9;$${&#xA;&#x9;&#x9;&#x9;&#34;PrÃ©paratifs&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Vive le vent d&#34;,&#34;hiver !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum ?!&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Quel beau camion !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Ah, une belle poupÃ©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Trajet&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Joyeux NoÃ«l !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Mon beau sapin !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hue tornade !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Allez comÃ¨te !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Il fait frais cette nuit !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Distribution&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh hisse !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;SerrÃ©e cette cheminÃ©e !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Et un cadeau de plus !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Chut, pas un bruit !&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Hum un petit biscuit...&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;Oh Oh Oh !&#34;&#xA;&#x9;&#x9;&#x9;],&#xA;&#x9;&#x9;&#x9;&#34;Repos&#34;:[&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;ZZZ&#34;,&#xA;&#x9;&#x9;&#x9;&#x9;&#34;RONFFFFFFFLE&#34;&#xA;&#x9;&#x9;&#x9;]&#xA;&#x9;&#x9;}$$::jsonb,&#xA;&#x9;&#x9;type_trajet,&#xA;&#x9;&#x9;FLOOR(EXTRACT(second from transaction_timestamp()) / 10)::text&#xA;&#x9;) as parole,&#xA;&#x9;CASE &#xA;&#x9;&#x9;WHEN type_trajet = &#39;PrÃ©paratifs&#39; THEN &#39;Le PÃ¨re NoÃ«l prÃ©pare les cadeaux&#39;&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Trajet&#39; THEN &#39;Le PÃ¨re NoÃ«l voyage vers un nouveau lieu de distribution&#39;&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Distribution&#39; THEN &#39;Le PÃ¨re NoÃ«l est en cours de distribution&#39;&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Repos&#39; THEN &#39;Le PÃ¨re NoÃ«l a terminÃ© et prend un repos bien mÃ©ritÃ©&#39;&#xA;&#x9;END AS titre,&#xA;&#x9;ville || &#39; (&#39; || region || &#39;)&#39; AS ville,&#xA;&#x9;ville_next || &#39; (&#39; || region_next || &#39;)&#39; AS ville_next,&#xA;&#x9;concat(&#xA;&#x9;&#x9;NULLIF(extract(day from (date_fin - var.&#34;now&#34;)), 0) || &#39; jours, &#39;,&#xA;&#x9;&#x9;NULLIF(extract(hour from (date_fin - var.&#34;now&#34;)), 0) || &#39; heures, &#39;,&#xA;&#x9;&#x9;NULLIF(extract(minute from (date_fin - var.&#34;now&#34;)), 0) || &#39; minutes et &#39;,&#xA;&#x9;&#x9;NULLIF(round(extract(second from (date_fin - var.&#34;now&#34;))::numeric, 0), 0) || &#39; secondes&#39;&#xA;&#x9;) AS timer,&#xA;&#x9;to_char(date_debut,&#39;DD TMmon YYYY&#39;) AS date_debut,&#xA;&#x9;to_char(date_debut,&#39;HH24:MI:SS&#39;) AS heure_debut,&#xA;&#x9;to_char(date_debut AT TIME ZONE utc_offset,&#39;DD TMmon YYYY&#39;) AS date_debut_local,&#xA;&#x9;to_char(date_debut AT TIME ZONE utc_offset,&#39;HH24:MI:SS&#39;) AS heure_debut_local,&#xA;&#x9;to_char(date_fin,&#39;DD TMmon YYYY&#39;) AS date_fin,&#xA;&#x9;to_char(date_fin,&#39;HH24:MI:SS&#39;) AS heure_fin,&#xA;&#x9;to_char(date_fin AT TIME ZONE utc_offset,&#39;DD TMmon YYYY&#39;) AS date_fin_local,&#xA;&#x9;to_char(date_fin AT TIME ZONE utc_offset,&#39;HH24:MI:SS&#39;) AS heure_fin_local,&#xA;&#x9;trim(to_char(cadeau_cumul_actuel, &#39;999 999 999 999&#39;)) AS cadeau,&#xA;&#x9;trim(to_char(pop_fictive_cumul_actuel, &#39;999 999 999 999&#39;)) AS population,&#xA;&#x9;trim(to_char(distance_cumul_actuel/1000, &#39;999 999 999 999 km&#39;)) AS distance&#xA;FROM&#xA;&#x9;santa_tracker.v_instant_t&#xA;CROSS JOIN&#xA;&#x9;santa_tracker.v_00_variable as var &#xA;&#x9;&#xA;)&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Il est maintenant possible d&amp;rsquo;appeler la vue avec un SELECT qui finalise la mise en forme. N&amp;rsquo;hÃ©sitez pas Ã  utiliser du HTML.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;SELECT &#xA;&#x9;id_voyage,&#xA;&#x9;CASE &#xA;&#x9;&#x9;WHEN type_trajet = &#39;PrÃ©paratifs&#39; THEN &#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Emplacement actuel : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;DÃ©part prÃ©vu dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux fabriquÃ©s : &#39; || cadeau&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Trajet&#39; THEN&#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;DÃ©collage : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;le &#39; || date_debut || &#39; Ã  &#39; || heure_debut,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_debut_local || &#39; Ã  &#39; || heure_debut_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;ArrivÃ©e prÃ©vue dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Atterissage : &#39; || ville_next ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_fin_local || &#39; Ã  &#39; || heure_fin_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux distribuÃ©s : &#39; || cadeau,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Population visitÃ©e : &#39; || population,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Distance parcourue : &#39; || distance&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Distribution&#39; THEN&#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Emplacement actuel : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;ArrivÃ© sur place le &#39; || date_debut || &#39; Ã  &#39; || heure_debut,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_debut_local || &#39; Ã  &#39; || heure_debut_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Prochain dÃ©part le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;&#x9;(&#39; || date_fin_local || &#39; Ã  &#39; || heure_fin_local || &#39; heure locale)&#39;,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Prochaine destination : &#39; || ville_next ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux distribuÃ©s : &#39; || cadeau,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Population visitÃ©e : &#39; || population,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Distance parcourue : &#39; || distance&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;WHEN type_trajet = &#39;Repos&#39; THEN&#xA;&#x9;&#x9;&#x9;concat_ws(&#xA;&#x9;&#x9;&#x9;&#x9;chr(10),&#xA;&#x9;&#x9;&#x9;&#x9;titre,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Petit mot du PÃ¨re NoÃ«l : &#39; || parole,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Emplacement actuel : &#39; || ville ,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Prochaine fabrication de cadeau dans &#39; || timer,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Le &#39; || date_fin || &#39; Ã  &#39; || heure_fin,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Cadeaux distribuÃ©s : &#39; || cadeau,&#xA;&#x9;&#x9;&#x9;&#x9;&#39;Population visitÃ©e : &#39; || population&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;END as informations&#xA;FROM&#xA;&#x9;santa_tracker.v_instant_t_affichage&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Voila un exemple de rÃ©ponse :&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-columns is-layout-flex wp-container-core-columns-is-layout-9d6595d7 wp-block-columns-is-layout-flex&#34;&gt;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&#xA;&lt;p class=&#34;has-text-align-center&#34;&gt;&lt;strong&gt;Le PÃ¨re NoÃ«l est en cours de distribution&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Petit mot du PÃ¨re NoÃ«l : Oh hisse !&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Emplacement actuel : Anadyr (Russie)&lt;br&gt;ArrivÃ© sur place le 24 dÃ©c. 2023 Ã  08:00:00&lt;br&gt;(24 dÃ©c. 2023 Ã  19:00:00 heure locale)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Prochaine destination : Majuro Atoll (Ãles Marshall)&lt;br&gt;DÃ©part dans 36 secondes&lt;br&gt;Le 24 dÃ©c. 2023 Ã  08:00:37&lt;br&gt;(24 dÃ©c. 2023 Ã  19:00:37 heure locale)&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Cadeaux distribuÃ©s : 7 222&lt;br&gt;Population visitÃ©e : 7 602&lt;br&gt;Distance parcourue : 18 108 km&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;div class=&#34;wp-block-column is-layout-flow wp-block-column-is-layout-flow&#34;&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&#xA;&#xA;&#xA;&lt;h2 class=&#34;wp-block-heading&#34;&gt;L&amp;rsquo;Ã©tat des lieux&lt;/h2&gt;&#xA;&#xA;&#xA;&#xA;&lt;p&gt;Pour chaque destination, il est possible de voir en temps rÃ©el si le PÃ¨re NoÃ«l est passÃ© ou non. Pour cela nous allons nous appuyer sur la table des destinations ainsi que la vue matÃ©rialisÃ©e &lt;code&gt;vm_06_voyage&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;sql&#34; data-enlighter-theme=&#34;&#34; data-enlighter-highlight=&#34;&#34; data-enlighter-linenumbers=&#34;&#34; data-enlighter-lineoffset=&#34;&#34; data-enlighter-title=&#34;&#34; data-enlighter-group=&#34;&#34;&gt;-- Vue contenant toutes les destinations&#xA;DROP VIEW IF EXISTS santa_tracker.v_destination CASCADE;&#xA;&#xA;CREATE OR REPLACE VIEW santa_tracker.v_destination AS &#xA;&#xA;WITH &#xA;&#x9;all_destinations AS (&#xA;&#x9;&#x9;-- RÃ©cupÃ©ration de toutes les destinations&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;id_destination,&#xA;&#x9;&#x9;&#x9;region,&#xA;&#x9;&#x9;&#x9;ville,&#xA;&#x9;&#x9;&#x9;population,&#xA;&#x9;&#x9;&#x9;utc_offset,&#xA;&#x9;&#x9;&#x9;geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.destination&#xA;&#x9;&#x9;UNION&#xA;&#x9;&#x9;-- Ajout de la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;id&#39;)::integer AS id_destination,&#xA;&#x9;&#x9;&#x9;maison_pere_noel -&gt;&gt; &#39;region&#39; AS region,&#xA;&#x9;&#x9;&#x9;maison_pere_noel -&gt;&gt; &#39;ville&#39; AS ville,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;population&#39;)::integer AS population,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;utc_offset&#39;)::interval AS utc_offset,&#xA;&#x9;&#x9;&#x9;(maison_pere_noel -&gt;&gt; &#39;geom_4326&#39;)::geometry(Point,4326) AS geom&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;santa_tracker.v_00_variable&#xA;&#x9;)&#xA;&#x9;SELECT &#xA;&#x9;&#x9;t1.id_destination,&#xA;&#x9;&#x9;t1.region,&#xA;&#x9;&#x9;t1.ville,&#xA;&#x9;&#x9;t1.population,&#xA;&#x9;&#x9;t1.utc_offset,&#xA;&#x9;&#x9;-- GÃ©nÃ©ration d&#39;un message d&#39;information sur l&#39;Ã©tat de passage&#xA;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;-- S&#39;il n&#39;y a pas de date de dÃ©but (pas de distribution) alors il s&#39;agit de la maison du PÃ¨re NoÃ«l&#xA;&#x9;&#x9;&#x9;WHEN voy.date_debut IS NULL THEN &#xA;&#x9;&#x9;&#x9;&#x9;CASE &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; var.debut_distrib THEN &#39;Le PÃ¨re NoÃ«l prÃ©pare les cadeaux&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &amp;lt; var.fin_distrib THEN &#39;Le PÃ¨re NoÃ«l est absent&#39;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE &#39;Le PÃ¨re NoÃ«l se repose&#39;&#xA;&#x9;&#x9;&#x9;&#x9;END&#xA;&#x9;&#x9;&#x9;-- Sinon on dÃ©termine si la visite est rÃ©alisÃ©e en fonction de l&#39;heure de passage&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &gt; voy.date_fin  THEN &#39;A reÃ§u la visite du PÃ¨re NoÃ«l&#39;&#xA;&#x9;&#x9;&#x9;WHEN var.&#34;now&#34; &gt; voy.date_debut  THEN &#39;Le PÃ¨re NoÃ«l est ici, Youpi !&#39;&#xA;&#x9;&#x9;&#x9;ELSE &#39;Attend la visite du PÃ¨re NoÃ«l&#39;&#xA;&#x9;&#x9;END AS informations,&#xA;&#x9;&#x9;t1.geom&#xA;&#x9;FROM &#xA;&#x9;&#x9;all_destinations AS t1&#xA;&#x9;CROSS JOIN &#xA;&#x9;&#x9;santa_tracker.v_00_variable AS var&#xA;&#x9;LEFT JOIN &#xA;&#x9;&#x9;santa_tracker.vm_06_voyage as voy&#xA;&#x9;&#x9;ON voy.id_destination = t1.id_destination&#xA;&#x9;&#x9;AND voy.type_etape = &#39;Distribution&#39;&#xA;;&lt;/pre&gt;&#xA;&#xA;&#xA;&#xA;&lt;hr class=&#34;wp-block-separator has-alpha-channel-opacity&#34;/&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center&#34;&gt;Voila ! J&amp;rsquo;espÃ¨re que Ã§a vous a plu et n&amp;rsquo;hÃ©sitez pas Ã  suivre le PÃ¨re NoÃ«l !!&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center has-rouge-color has-text-color&#34;&gt;&lt;a href=&#34;https://noel.cirilgroup.com/index.html&#34; target=&#34;_blank&#34; rel=&#34;noreferrer noopener&#34;&gt;&lt;strong&gt;noel.cirilgroup.com&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;p class=&#34;has-text-align-center has-rouge-color has-text-color has-large-font-size&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f384.png&#34; alt=&#34;ğŸ„&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; &lt;strong&gt;Joyeux NoÃ«l !!&lt;/strong&gt; &lt;img src=&#34;https://s.w.org/images/core/emoji/16.0.1/72x72/1f384.png&#34; alt=&#34;ğŸ„&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/p&gt;&#xA;</content>
    <link href="https://blog.arthurbazin.com/bdd/postgresql/suivons-le-pere-noel-avec-postgis" rel="alternate"></link>
    <summary type="html">DÃ©couvrez ce qui se cache derriÃ¨re une application de suivi du PÃ¨re NoÃ«l. Une liste de destination, quelques requÃªtes SQL et le tour est jouÃ© ? Ce n&#39;est pas aussi simple que Ã§a, vous allez le voir...&#xA;En partenariat avec Ciril GROUP.</summary>
    <author>
      <name>Arthur Bazin</name>
    </author>
  </entry>
  <entry>
    <title>On analyse la nouvelle collation de PostgreSQL 17</title>
    <updated>2024-06-07T11:40:12Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-06-07:/2024/06/07/pg17-utf8-collation.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/06/07/pg17-utf8-collation.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL 17 est sorti en version bÃªta le 23 mai dernier, et dans ce billet on&#xA;va dÃ©tailler une de ses nouveautÃ©s: une collation interne gÃ©rant lâ€™UTF-8 avec des&#xA;comparaisons de texte en binaire.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les rapports de bugs de Postgres en 2023</title>
    <updated>2024-01-24T10:23:10Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-01-24:/2024/01/24/pgsql-bugs-annee-2023.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/01/24/pgsql-bugs-annee-2023.html" rel="alternate"></link>
    <summary type="html">Une revue quantitative des rapports de bugs de Postgres en 2023</summary>
  </entry>
  <entry>
    <title>Classification des caractÃ¨res avec ICU</title>
    <updated>2023-06-11T14:32:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2023-06-11:/2023/06/11/caracteres-icu.html</id>
    <link href="https://blog-postgresql.verite.pro/2023/06/11/caracteres-icu.html" rel="alternate"></link>
    <summary type="html">Avec PostgreSQL 16 oÃ¹ ICU devient le fournisseur de collations par dÃ©faut, il y a quelques diffÃ©rences sÃ©mantiques Ã  anticiper dans la classification des caractÃ¨res. Cet article en dÃ©taille quelques-unes.</summary>
  </entry>
  <entry>
    <title>Isolation Repeatable Read avec PostgreSQL versus MySQL</title>
    <updated>2020-02-10T17:50:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-02-10:/2020/02/10/isolation-postgresql-vs-mysql.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/02/10/isolation-postgresql-vs-mysql.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Les moteurs SQL permettent aux transactions concurrentes dâ€™Ãªtre&#xA;isolÃ©es les unes des autres pour Ã©viter les interfÃ©rences.&#xA;Cette propriÃ©tÃ© dâ€™isolation correspond Ã  la lettre I de lâ€™acronyme&#xA;bien connu &lt;a href=&#34;https://fr.wikipedia.org/wiki/Propri%C3%A9t%C3%A9s_ACID&#34;&gt;â€œACIDâ€&lt;/a&gt;,&#xA;les autres propriÃ©tÃ©s Ã©tant AtomicitÃ©, CohÃ©rence&#xA;(&lt;em&gt;Consistency&lt;/em&gt; en anglais) et DurabilitÃ©.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Recherche et remplacement multiple avec plperl</title>
    <updated>2020-01-22T09:05:14Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-01-22:/2020/01/22/multi-replace.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/01/22/multi-replace.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Remplacer une chaÃ®ne par une autre dans une chaÃ®ne plus large est simple&#xA;en SQL, avec la fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;replace&lt;/code&gt;:&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les collations non dÃ©terministes</title>
    <updated>2019-10-16T16:32:15Z</updated>
    <id>tag:blog-postgresql.verite.pro,2019-10-16:/2019/10/16/collations-non-deterministes.html</id>
    <link href="https://blog-postgresql.verite.pro/2019/10/16/collations-non-deterministes.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Depuis la version 12, les collations de PostgreSQL peuvent Ãªtre crÃ©Ã©es&#xA;avec un paramÃ¨tre nommÃ© &lt;strong&gt;deterministic&lt;/strong&gt;, qui peut Ãªtre vrai&#xA;ou faux, si bien que les collations  sont maintenant&#xA;soit &lt;strong&gt;dÃ©terministes&lt;/strong&gt; (ce quâ€™elles sont par dÃ©faut), soit&#xA;&lt;strong&gt;non dÃ©terministes&lt;/strong&gt;.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>De retour du pgDay Paris 2024.</title>
    <updated>2024-03-18T09:39:28Z</updated>
    <id>tag:blog.anayrat.info,2024-03-18:/2024/03/18/de-retour-du-pgday-paris-2024./</id>
    <link href="https://blog.anayrat.info/2024/03/18/de-retour-du-pgday-paris-2024./" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Me voilÃ  rentrÃ© du pgDay Paris. Jâ€™ai beaucoup aimÃ© cette Ã©dition. Jâ€™Ã©tais dÃ©jÃ  venu Ã  celle de &lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2019/schedule/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2019&lt;/a&gt; et je dois dire que je nâ€™ai pas Ã©tÃ© dÃ©Ã§u. Pour rappel, le pgDay Paris est une confÃ©rence internationale. Les prÃ©sentations sont en anglais et permettent dâ€™attirer des orateurs et un public plus anglophone.&lt;/p&gt;&#xA;&lt;p&gt;Je vois souvent cette confÃ©rence comme un petit &lt;a href=&#34;https://www.postgresql.eu/events/series/pgconfeu-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGConf Europe&lt;/a&gt; : on retrouve un contenu assez riche avec la dimension internationale.&lt;/p&gt;&#xA;&lt;p&gt;On croise des tÃªtes dÃ©jÃ  connues : public, orateurs, bÃ©nÃ©voles, contributeurs : Tout ce petit monde qui fait vivre la communautÃ© Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Puis, câ€™est lâ€™occasion de mettre des visages sur des noms que lâ€™on croise en lisant des articles ou les mailing-list Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Voici un petit retour sur les confÃ©rences auxquelles jâ€™ai assistÃ© :&lt;/p&gt;&#xA;&lt;h1 id=&#34;elephant-in-a-nutshell---navigating-the-postgres-community-101&#34;&gt;Elephant in a nutshell - Navigating the Postgres community 101&lt;/h1&gt;&#xA;&lt;p&gt;Avec &lt;a href=&#34;https://2024.pgday.paris/organization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Carole et StÃ©phanie&lt;/a&gt;, on a pensÃ© que ce serait bien dâ€™avoir cette confÃ©rence en introduction.&lt;/p&gt;&#xA;&lt;p&gt;Je lâ€™ai trouvÃ© trÃ¨s complÃ¨te. Elle parle de Postgres, mais aussi et surtout de sa communautÃ©. Câ€™est ce qui fait sa force.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5293/slides/481/pgDay%20Paris_Valeria%27s%20talk%20-%20Elephant%20in%20a%20nutshell.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles.&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;sustainable-database-performance-profiling-in-postgresql&#34;&gt;Sustainable Database Performance profiling in PostgreSQL&lt;/h1&gt;&#xA;&lt;p&gt;Postgres dispose de nombreuses vues statistiques apportant des informations sur son fonctionnement.&lt;/p&gt;&#xA;&lt;p&gt;Elles peuvent Ãªtre natives (&lt;em&gt;pg_stat_statements&lt;/em&gt; â€¦) ou via des extensions &lt;em&gt;pg_stat_kcache&lt;/em&gt;, &lt;em&gt;pg_wait_sampling&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, et câ€™est ce que souligne cette confÃ©rence, elles apportent une vue Ã  un instant T.&lt;/p&gt;&#xA;&lt;p&gt;Pour les exploiter, il faut les historiser. Lâ€™orateur prÃ©sente un outil basÃ© sur ce qui se fait sur Oracle : &lt;a href=&#34;https://github.com/zubkov-andrei/pg_profile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pg_profile&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;En revanche, il le prÃ©sente comme lâ€™unique outil permettant dâ€™exploiter ces informations. Une personne dans le public lui a fait remarquer quâ€™il existait un autre projet : &lt;a href=&#34;https://powa.readthedocs.io/en/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PoWA&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Les deux outils ne fournissent pas les mÃªmes fonctions, &lt;em&gt;pg_profile&lt;/em&gt; gÃ©nÃ¨re un rapport HTML. Il est plutÃ´t facile Ã  installer, il ne nÃ©cessite pas de librairies externe car il est Ã©crit en pl/pgsql.&lt;/p&gt;&#xA;&lt;p&gt;PoWA apporte des graphes, de la suggestion dâ€™indexâ€¦ mais est plus lourd Ã  installer.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5067/slides/482/20240314_dkrautschick_PGdayParis_SustainableDatabasePerformanceProfilingInPostgreSQL.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgresql-without-permanent-local-data-storage&#34;&gt;PostgreSQL without permanent local data storage&lt;/h1&gt;&#xA;&lt;p&gt;LÃ , on rentre dans une confÃ©rence trÃ¨s technique. Matthias travaille sur le projet &lt;a href=&#34;https://neon.tech/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Neon&lt;/a&gt; et il participe rÃ©guliÃ¨rement sur les &lt;a href=&#34;https://www.postgresql.org/list/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mailing-list Postgres&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Neon est un fork opensource de Postgres visant Ã  sÃ©parer le &lt;em&gt;compute&lt;/em&gt; et le &lt;em&gt;storage&lt;/em&gt;. Câ€™est ce quâ€™a fait AWS avec le projet Aurora.&lt;/p&gt;&#xA;&lt;p&gt;Heikki Linnakangas, un des co-fondateurs de Neon et committer de Postgres a fait plusieurs prÃ©sentations :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=rES0yzeERns&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Neon: Serverless PostgreSQL! (Heikki Linnakangas)&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://neon.tech/blog/architecture-decisions-in-neon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Architecture decisions in Neon&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Matthias a prÃ©sentÃ© les diffÃ©rents problÃ¨mes que cela posait de vouloir sÃ©parer le stockage du reste du moteur. Câ€™est clairement un projet trÃ¨s ambitieux. Pour le moment, il est difficile de savoir si ce fork perdurera ou non.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, on peut souligner que les personnes travaillant dessus ont une trÃ¨s grande connaissance du moteur. On peut espÃ©rer que Ã§a ait des implications positives dans le projet Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Affaire Ã  suivreâ€¦&lt;/p&gt;&#xA;&lt;h1 id=&#34;lightning-talks&#34;&gt;Lightning Talks!&lt;/h1&gt;&#xA;&lt;p&gt;Les Lightning Talks sont une bonne occasion de balayer certains sujets un peu plus lÃ©gers. Ca passe plutÃ´t bien aprÃ¨s le repas. Câ€™est assez divertissant. Jâ€™ai bien aimÃ© la prÃ©sentation de LÃ©o Unbekandt sur lâ€™architecture des instances Postgres Ã  Scalingo. Pas de K8S, une architecture simple et Ã©prouvÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;Jâ€™ai aussi aimÃ© la prÃ©sentation de Chris Ellis oÃ¹ il fabrique un objet dÃ©coratif lumineux avec de lâ€™ESP32 dedans.&lt;/p&gt;&#xA;&lt;h1 id=&#34;multi-tenant-database-the-good-the-bad-the-ugly&#34;&gt;Multi-tenant database: the good, the bad, the ugly.&lt;/h1&gt;&#xA;&lt;p&gt;AprÃ¨s, les Lightning Talks, on retourne dans le vif du sujet avec cette prÃ©sentation de Pierre Ducroquet.&lt;/p&gt;&#xA;&lt;p&gt;Je connais bien Pierre, la premiÃ¨re fois que je lâ€™ai croisÃ©, câ€™Ã©tait au pgDay France 2016. Il avait fait une trÃ¨s bonne prÃ©sentation sur &lt;a href=&#34;https://2016.pgday.fr/programme.html#comprendre-requete-lente&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Comprendre pourquoi une requÃªte est lente, et comment rÃ©gler le soucis&lt;/a&gt;. Ensuite, Ã§a a Ã©tÃ© mon collÃ¨gue de travail pendant quelques annÃ©es oÃ¹ on a rencontrÃ© les problÃ¨mes que pouvaient poser les bases de donnÃ©es &lt;em&gt;multi-tenant&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il prÃ©sente diffÃ©rentes faÃ§ons de faire du &lt;em&gt;multi-tenant&lt;/em&gt; avec les contraintes que cela implique. Il donne des chiffres assez impressionnants comme plus de 200 000 tables!&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.pinaraf.info/2024/03/look-ma-i-wrote-a-new-jit-compiler-for-postgresql/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelque chose me dit quâ€™on ne va pas tarder Ã  le revoir&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;beyond-b-trees-looking-at-columnar-storage-and-lsm-trees&#34;&gt;Beyond B-trees looking at Columnar Storage and LSM trees&lt;/h1&gt;&#xA;&lt;p&gt;Une autre confÃ©rence assez bas niveau sur le stockage colonne et les LSM Tree.&lt;/p&gt;&#xA;&lt;p&gt;Ce type de stockage peut effectivement faire partie du futur de Postgres. Le moteur commence Ã  Ãªtre utilisÃ© pour de plus en plus de projets analytiques oÃ¹ on manipule de gros volumes de donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Il faut donc des mÃ©thodes de stockage capable dâ€™encaisse des Ã©critures rapides.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgres-16-highlight-logical-decoding-on-standby&#34;&gt;Postgres 16 highlight: Logical decoding on standby&lt;/h1&gt;&#xA;&lt;p&gt;Une nouveautÃ© assez attendue sur Postgres 16 : La possibilitÃ© de faire du dÃ©codage logique sur un secondaire.&lt;/p&gt;&#xA;&lt;p&gt;Qui mieux quâ€™un des auteurs de cette fonctionnalitÃ© pour en parler ?&lt;/p&gt;&#xA;&lt;p&gt;Bertrand prÃ©sente les difficultÃ©s pour faire un dÃ©codage logique sur un secondaire, et comment elles ont Ã©tÃ© rÃ©solues.&lt;/p&gt;&#xA;&lt;p&gt;Il a aussi fait une dÃ©monstration. Câ€™est vraiment impressionnant, car câ€™est un sujet assez compliquÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Point bonus, il explique aussi une nouveautÃ© de Postres 17 : la synchronisation des slots de rÃ©plication.&lt;/p&gt;&#xA;&lt;p&gt;Actuellement, on peut difficilement â€œraccrocherâ€ une rÃ©plication logique en cas de bascule. Il y a un risque de perte de transaction.&lt;/p&gt;&#xA;&lt;p&gt;Postgres 17 devrait permettre de synchroniser un slot de rÃ©plication. En cas de bascule, on peut reprendre la rÃ©plication.&#xA;On est chanceux, il vient tout juste dâ€™Ã©crire un article sur le sujet : &lt;a href=&#34;https://bdrouvot.github.io/2024/03/16/postgres-17-highlight-logical-replication-slots-synchronization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Postgres 17 highlight: Logical replication slots synchronization&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5122/slides/483/pgdayParis2024.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;closing&#34;&gt;Closing&lt;/h1&gt;&#xA;&lt;p&gt;Câ€™Ã©tait la derniÃ¨re confÃ©rence de la journÃ©e. On a pu se retrouver pour le social event.&lt;/p&gt;&#xA;&lt;p&gt;Câ€™est un moment que jâ€™affectionne particuliÃ¨rement. Car au-delÃ  des confÃ©rences, câ€™est surtout une occasion dâ€™Ã©changer entre passionnÃ©s. De retrouver des connaissances et amis de longue date.&lt;/p&gt;&#xA;&lt;p&gt;Jâ€™ai rÃ©alisÃ© que jâ€™avais un peu dÃ©laissÃ© les confÃ©rences, entre le covid, mon passage en freelance etcâ€¦ A lâ€™avenir, jâ€™essaierai dâ€™Ãªtre plus prÃ©sent sur ce genre dâ€™Ã©vÃ¨nement (si je peux prendre le train).&lt;/p&gt;&#xA;&lt;h1 id=&#34;merci&#34;&gt;Merci&lt;/h1&gt;&#xA;&lt;p&gt;Jâ€™en profite aussi pour remercier les &lt;a href=&#34;https://2024.pgday.paris/organization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;organisateurs et bÃ©nÃ©voles&lt;/a&gt;. On a du mal Ã  rÃ©aliser lâ€™investissement que Ã§a demande. Un grand merci Ã  eux pour cet Ã©vÃ¨nement !&lt;/p&gt;&#xA;&lt;p&gt;On se verra sÃ»rement au pgDay 2025 !&lt;/p&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Recommandations de lectures pour amÃ©liorer ses connaissances en base de donnÃ©es et PostgreSQL</title>
    <updated>2024-02-12T08:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-02-12:/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/</id>
    <link href="https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#fondamentaux-des-bases-de-donnÃ©es&#34;&gt;Fondamentaux des bases de donnÃ©es&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#the-manga-guide-to-databases&#34;&gt;The Manga Guide to Databases&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#database-design-for-mere-mortals&#34;&gt;Database Design for Mere Mortals&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-antipatterns&#34;&gt;SQL Antipatterns&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-for-smarties&#34;&gt;SQL for Smarties&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#the-art-of-sql&#34;&gt;The Art Of SQL&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#performance&#34;&gt;Performance&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-performance-explained&#34;&gt;SQL Performance Explained&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#indexing-beyond-the-basics&#34;&gt;Indexing Beyond the Basics&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#postgresql&#34;&gt;PostgreSQL&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#practical-sql&#34;&gt;Practical SQL&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#postgresql---architecture-et-notions-avancÃ©es&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#learn-postgresql&#34;&gt;Learn PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#postgresql-14-internals&#34;&gt;PostgreSQL 14 Internals&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;p&gt;Je ne vais lister que quelques livres, mais je pourrais en citer pleins d&amp;rsquo;autres &amp;#x1f603; . J&amp;rsquo;espÃ¨re que Ã§a permettra Ã  plus de dÃ©veloppeurs, DBA, DEVOPS, CTO &amp;hellip; de mieux comprendre les bases de donnÃ©es et leurs enjeux.&lt;/p&gt;&#xA;&lt;h1 id=&#34;fondamentaux-des-bases-de-donnÃ©es&#34;&gt;Fondamentaux des bases de donnÃ©es&lt;/h1&gt;&#xA;&lt;h2 id=&#34;the-manga-guide-to-databases&#34;&gt;The Manga Guide to Databases&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-the-manga-guide-to-databases&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;manga&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_79a33cb973abaedb22e66948cdc60d80.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_c3accdb2c9ecf2675e6df1dee150cd9e.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_79a33cb973abaedb22e66948cdc60d80.webp&#34;&#xA;               width=&#34;474&#34;&#xA;               height=&#34;626&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      The Manga Guide to Databases&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://nostarch.com/mg_databases.htm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Manga Guide to Databases&lt;/a&gt; est celui que je recommande dans la plupart de mes rapports d&amp;rsquo;audit.&lt;/p&gt;&#xA;&lt;p&gt;Il est vraiment gÃ©nial, facile Ã  lire et pour autant, il ne sacrifie pas le fond Ã  la forme.&lt;/p&gt;&#xA;&lt;p&gt;Il couvre un peu tous les aspects importants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ModÃ©lisation&lt;/li&gt;&#xA;&lt;li&gt;Ã‰criture de requÃªtes simples&lt;/li&gt;&#xA;&lt;li&gt;Grands principes des bases de donnÃ©es : transaction, isolation&amp;hellip;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;database-design-for-mere-mortals&#34;&gt;Database Design for Mere Mortals&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-database-design-for-mere-mortals&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;design&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_721347960fb63df78ab2314199294f15.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_2a81b8ec12f19038971875854feca26c.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_721347960fb63df78ab2314199294f15.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Database Design for Mere Mortals&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.informit.com/store/database-design-for-mere-mortals-25th-anniversary-edition-9780136788041&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Database Design for Mere Mortals&lt;/a&gt; de &lt;em&gt;Michael J. Hernandez&lt;/em&gt; est, comme son nom l&amp;rsquo;indique, orientÃ© sur la modÃ©lisation.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est un gros pavÃ© de plus de 600 pages, mais il ne faut pas se laisser impressionner. Il se lit trÃ¨s bien, c&amp;rsquo;est bien vulgarisÃ© et l&amp;rsquo;auteur a fait attention  Ã  Ã©viter de s&amp;rsquo;embarquer dans la thÃ©orie qui peut parfois Ãªtre indigeste.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai beaucoup aimÃ© le processus d&amp;rsquo;interviews pour construire le modÃ¨le de donnÃ©es, l&amp;rsquo;accent mis sur la documentation du modÃ¨le. Il  parle peu des formes normales, c&amp;rsquo;est un parti pris. Cependant, si on suit son processus, le modÃ¨le respecte bien les formes normales.&lt;/p&gt;&#xA;&lt;h2 id=&#34;sql-antipatterns&#34;&gt;SQL Antipatterns&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-antipatterns&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;antipatterns&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_c320047c4b1f0cff61ce38e7e7f6d3dc.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_0d0faf00cb44ab3739d2b4e20f0b205e.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_c320047c4b1f0cff61ce38e7e7f6d3dc.webp&#34;&#xA;               width=&#34;633&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL Antipatterns&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://pragprog.com/titles/bksap1/sql-antipatterns-volume-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Antipatterns&lt;/a&gt; est un bon livre pour identifier les &lt;em&gt;anti-patterns&lt;/em&gt; et apporte des solutions.&#xA;Je m&amp;rsquo;en sers rÃ©guliÃ¨rement quand j&amp;rsquo;ai besoin d&amp;rsquo;expliquer ce qui ne va pas dans un modÃ¨le ou une requÃªte.&lt;/p&gt;&#xA;&lt;h2 id=&#34;sql-for-smarties&#34;&gt;SQL for Smarties&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-for-smarties&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;smarties&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_c6c3d9973032c4ac34459909ff559894.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_ca4d66cca791addd71955b48a3f29c2c.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_c6c3d9973032c4ac34459909ff559894.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL for Smarties&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : AvancÃ©&lt;/p&gt;&#xA;&lt;p&gt;Comment ne pas mentionner les livres de &lt;a href=&#34;https://en.wikipedia.org/wiki/Joe_Celko&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Joe Celko&lt;/a&gt;.&#xA;Il a participÃ© au standard SQL et Ã©crit de &lt;a href=&#34;https://www.oreilly.com/pub/au/1919&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nombreux livres&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sciencedirect.com/book/9780128007617/joe-celkos-sql-for-smarties&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL for Smarties&lt;/a&gt; fait partie&#xA;des rÃ©fÃ©rences en matiÃ¨re de SQL. La premiÃ¨re Ã©dition date de 1995&amp;hellip; oui&amp;hellip; presque 30 ans quand j&amp;rsquo;Ã©cris ces lignes !&#xA;La cinquiÃ¨me Ã©dition date de 2015, malgrÃ© ces 10 ans, le contenu est toujours d&amp;rsquo;actualitÃ©. On trouve mÃªme des ordres assez rÃ©cents comme &lt;code&gt;LATERAL&lt;/code&gt;, les &lt;em&gt;window functions&lt;/em&gt;, &lt;code&gt;CTE&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;On est aussi sur un gros pavÃ© de plus de 800 pages, le livre est trÃ¨s complet, assez exhaustif. Je dirai rÃ©servÃ© Ã  ceux qui veulent vraiment approfondir leurs connaissances en SQL.&lt;/p&gt;&#xA;&lt;p&gt;Ã€ noter qu&amp;rsquo;il existe une version en franÃ§ais basÃ© sur la seconde Ã©dition qui date de 2000, elle accuse un peu l&amp;rsquo;age : &lt;a href=&#34;https://www.decitre.fr/livres/sql-avance-9782711786367.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL AvancÃ©&lt;/a&gt;. On peut le trouver &lt;a href=&#34;https://www.momox-shop.fr/joe-celko-sql-avance-taschenbuch-M02841801411.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;d&amp;rsquo;occasion&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;the-art-of-sql&#34;&gt;The Art Of SQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-the-art-of-sql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;art&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_2bb5db8f1a45e313260bc7467bf92c17.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_ad989b301e7ba70987c52db0c9c535e3.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_2bb5db8f1a45e313260bc7467bf92c17.webp&#34;&#xA;               width=&#34;579&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      The Art Of SQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : AvancÃ©&lt;/p&gt;&#xA;&lt;p&gt;Avec &lt;a href=&#34;https://www.oreilly.com/library/view/the-art-of/0596008945/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Art of SQL&lt;/a&gt; de &lt;a href=&#34;https://www.oreilly.com/pub/au/2005&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stephane Faroult&lt;/a&gt;, on change de catÃ©gorie. LÃ , on est sur du SQL plus avancÃ©.&#xA;Le livre va Ãªtre orientÃ© performances, bonnes pratiques. MalgrÃ© ses 18 ans, son contenu est toujours d&amp;rsquo;actualitÃ©. C&amp;rsquo;est un livre trÃ¨s puissant, il vous faudra du temps pour le lire et assimiler chaque page.&lt;/p&gt;&#xA;&lt;h1 id=&#34;performance&#34;&gt;Performance&lt;/h1&gt;&#xA;&lt;h2 id=&#34;sql-performance-explained&#34;&gt;SQL Performance Explained&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-performance-explained&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;luke&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_d25868af42f9fe155d70736822260a43.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_c361959935046d9adedd33681287b70f.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_d25868af42f9fe155d70736822260a43.webp&#34;&#xA;               width=&#34;480&#34;&#xA;               height=&#34;737&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL Performance Explained&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;Impossible de ne pas mentionner l&amp;rsquo;excellent livre de &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Markus Winand&lt;/a&gt;, &lt;a href=&#34;https://sql-performance-explained.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Performance Explained&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Comme son titre l&amp;rsquo;indique, on va parler performance, indexation, Ã©criture de requÃªtes. Ã€ noter qu&amp;rsquo;il a Ã©galement Ã©tÃ© traduit en plusieurs langues : Allemand, Espagnol, Japonais et FranÃ§ais grÃ¢ce Ã  Guillaume Lelarge &lt;a href=&#34;https://sql-au-coeur-des-performances.fr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL : Au cÅ“ur des performances&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le contenu du livre est Ã©galement disponible sur son site &lt;a href=&#34;https://use-the-index-luke.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Use the Index, Luke !&lt;/a&gt;. Markus est aussi l&amp;rsquo;auteur d&amp;rsquo;un excellent site sur les fonctionnalitÃ©s avancÃ©s du SQL : &lt;a href=&#34;https://modern-sql.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL&lt;/a&gt;. Lors de l&amp;rsquo;Ã©mission &lt;a href=&#34;https://youtu.be/mGqqQg-dG-w?si=he4R6eTC_2VckAVA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL sur Postgres.FM&lt;/a&gt;, il a annoncÃ© la volontÃ© d&amp;rsquo;en faire un livre. J&amp;rsquo;ai hÃ¢te ! Il a aussi fait de nombreuses &lt;a href=&#34;https://winand.at/sql-slides-for-developers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prÃ©sentations&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;indexing-beyond-the-basics&#34;&gt;Indexing Beyond the Basics&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-indexing-beyond-the-basics&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;indexing&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_cd04fe528416e6d69ed46ae57835a97e.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_7b7f71022bce674d799dc5af2cfdb5cb.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_cd04fe528416e6d69ed46ae57835a97e.webp&#34;&#xA;               width=&#34;668&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Indexing Beyond the Basics&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant - IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://sqlfordevs.com/ebooks/indexing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Indexing Beyond the Basics&lt;/a&gt; est un e-book orientÃ© sur les index. Un point intÃ©ressant est qu&amp;rsquo;il mentionne aussi pourquoi le moteur n&amp;rsquo;utilise pas un index.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgresql&#34;&gt;PostgreSQL&lt;/h1&gt;&#xA;&lt;h2 id=&#34;practical-sql&#34;&gt;Practical SQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-practical-sql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;practical&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_c3df0446f9f62391d13c57dd10ec2e89.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_f2aecb321cb118f7fb40dddd50422be5.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_c3df0446f9f62391d13c57dd10ec2e89.webp&#34;&#xA;               width=&#34;477&#34;&#xA;               height=&#34;630&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Practical SQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant - intermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://nostarch.com/practical-sql-2nd-edition/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Practical SQL&lt;/a&gt; est un super livre pour quelqu&amp;rsquo;un qui dÃ©bute sur Postgres. Il parle d&amp;rsquo;un peu de tout, du SQL jusqu&amp;rsquo;aux types avancÃ©s. Comment utiliser le SQL pour analyser des donnÃ©es, faire du &lt;em&gt;full text search&lt;/em&gt;, opÃ©ration d&amp;rsquo;administration&amp;hellip;&lt;/p&gt;&#xA;&lt;h2 id=&#34;postgresql---architecture-et-notions-avancÃ©es&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-postgresql---architecture-et-notions-avancÃ©es&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;architecture&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_8da2fb9ff08beb89b92a47f2af0154cc.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_504568017e4d0ef28b5f0f36871185ec.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_8da2fb9ff08beb89b92a47f2af0154cc.webp&#34;&#xA;               width=&#34;559&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      PostgreSQL - Architecture et notions avancÃ©es&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire - avancÃ©&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.d-booker.fr/bases-de-donnees/805-1338-postgresql-architecture-et-notions-avancees-5ed.html#/21-option-consultation_en_ligne&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/a&gt; par Guillaume Lelarge et Julien Rouhaud est &lt;strong&gt;le&lt;/strong&gt; livre que je recommande pour qui veut comprendre comment fonctionne Postgres. Mon seul regret est qu&amp;rsquo;il ne soit pas traduit en anglais pour en faire profiter plus de lecteurs.&lt;/p&gt;&#xA;&lt;p&gt;Ã€ noter aussi qu&amp;rsquo;il est mis Ã  jour tous les ans.&lt;/p&gt;&#xA;&lt;h2 id=&#34;learn-postgresql&#34;&gt;Learn PostgreSQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-learn-postgresql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;learn&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_2e08c564415b06ee6ac817f7ac0914b0.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_c22b1c79c1fe1d43eb51d2ce83b5ee11.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_2e08c564415b06ee6ac817f7ac0914b0.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Learn PostgreSQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.packtpub.com/product/learn-postgresql-second-edition/9781837635641&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Learn PostgreSQL&lt;/a&gt; par Lucas Ferrari et Enrico Pirozzi est un livre trÃ¨s complet sur l&amp;rsquo;administration de Postgres. Un &lt;em&gt;must have&lt;/em&gt; pour un DBA.&lt;/p&gt;&#xA;&lt;p&gt;Pour les francophones, vous pouvez vous orienter vers &lt;a href=&#34;https://www.editions-eni.fr/livre/postgresql-administration-et-exploitation-de-vos-bases-de-donnees-4e-edition-9782409011467&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL Administration et exploitation de vos bases de donnÃ©es&lt;/a&gt; de SÃ©bastien LardiÃ¨re.&lt;/p&gt;&#xA;&lt;h2 id=&#34;postgresql-14-internals&#34;&gt;PostgreSQL 14 Internals&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-postgresql-14-internals&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;internals&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_8639f0d8b0e15fe8fb464f6e5412e100.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_3d76ec668fd76ab0113449dbb278d740.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_8639f0d8b0e15fe8fb464f6e5412e100.webp&#34;&#xA;               width=&#34;384&#34;&#xA;               height=&#34;552&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      PostgreSQL 14 Internals&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://postgrespro.com/community/books/internals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL 14 Internals&lt;/a&gt; par Egor Rogov est un livre sur les entrailles de Postgres. Il est vraiment trÃ¨s complet. Un grand merci Ã  lui de le mettre Ã  disposition en accÃ¨s libre.&lt;/p&gt;&#xA;&lt;p&gt;Dans le mÃªme style, il existe un site &lt;a href=&#34;https://www.interdb.jp/pg/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Internals of PostgreSQL&lt;/a&gt; par Hironobu SUZUKI.&lt;/p&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Postgres Ã  nouveau Ã©lu SGBD de l&#39;annÃ©e en 2023, mais je suis inquiet</title>
    <updated>2024-02-05T08:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-02-05:/2024/02/05/postgres-a-nouveau-elu-sgbd-de-lannee-en-2023-mais-je-suis-inquiet/</id>
    <link href="https://blog.anayrat.info/2024/02/05/postgres-a-nouveau-elu-sgbd-de-lannee-en-2023-mais-je-suis-inquiet/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cette annÃ©e encore, Postgres a Ã©tÃ© Ã©lu SGBD de l&amp;rsquo;annÃ©e par &lt;a href=&#34;https://db-engines.com/en/blog_post/106&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DB-Engines&lt;/a&gt;. MÃªme si ce n&amp;rsquo;est qu&amp;rsquo;un classement, cela donne une tendance. Cela fait aussi plusieurs annÃ©es qu&amp;rsquo;il est reconnu selon&#xA;les sondages de Stackoverflow : &lt;a href=&#34;https://survey.stackoverflow.co/2023/#section-most-popular-technologies-databases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Most popular Databases&lt;/a&gt;.&#xA;C&amp;rsquo;est un SGBD trÃ¨s apprÃ©ciÃ©, tant par les dÃ©veloppeurs, que par les DBA chevronnÃ©s&amp;hellip; Mais aussi par les directeurs qui y trouvent une stabilitÃ©&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Postgres a tout pour sÃ©duire :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AnnÃ©e aprÃ¨s annÃ©e, de nouvelles fonctionnalitÃ©s sont rajoutÃ©es. Je pense notamment Ã  : la parallÃ©lisation, le partitionnement, la rÃ©plication logique&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;Il a su, depuis toujours, garder sa fiabilitÃ©.&lt;/li&gt;&#xA;&lt;li&gt;Sa communautÃ© n&amp;rsquo;a fait que grandir. Les confÃ©rences dÃ©diÃ©es Ã  Postgres battent des records d&amp;rsquo;affluence tous les ans.&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est devenu un standard, mÃªme pour les autres logiciels : les Ã©diteurs rajoutent mÃªme le support du protocole Postgres pour faciliter leur intÃ©gration : Aurora, AlloyDB, QuestDB&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est un des rares projets de cette envergure Ã  Ãªtre communautaire. On a pu voir qu&amp;rsquo;il ne suffit pas que le projet soit opensource, il faut aussi compter sur la communautÃ© et son Ã©cosystÃ¨me.&lt;/li&gt;&#xA;&lt;li&gt;Il est supportÃ© par les gros acteurs : les GAFAM emploient de nombreux committers et contributeurs. Ils sponsorisent Ã©galement les confÃ©rences. Par exemple, le prochain &lt;a href=&#34;https://2024.pgday.paris/sponsors/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pgDay Paris est sponsorisÃ© par Microsoft&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cependant, je suis un peu inquiet pour le futur. Non pas pour PostgreSQL. Bruce Momjian a fait plusieurs prÃ©sentations sur ce sujet :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/challenges.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Future Postgres Challenges&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/forever.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Will Postgres Live Forever?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/past_present_future.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL: Past, Present, and Future&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;C&amp;rsquo;est mÃªme le sujet de la Keynote d&amp;rsquo;ouverture du dernier PGConf Europe : &lt;a href=&#34;https://www.youtube.com/watch?v=8W-J36IxYv4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Simon Riggs: The Next 20 Years (PGConf.EU 2023)&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Non, je suis plutÃ´t inquiet sur la perte de connaissance du mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;A quoi servira Postgres si on ne sait pas l&amp;rsquo;utiliser correctement ?&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#un-peu-dhistoire&#34;&gt;Un peu d&amp;rsquo;histoire&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#quest-ce-quon-oublie-&#34;&gt;Qu&amp;rsquo;est-ce qu&amp;rsquo;on oublie ?&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#oui-mais-le-cloud&#34;&gt;Oui, mais le cloud!&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#on-oublie-le-mÃ©tier-de-dba&#34;&gt;On oublie le mÃ©tier de DBA&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#on-oublie-le-passÃ©&#34;&gt;On oublie le passÃ©&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#le-code-change-la-donnÃ©e-reste&#34;&gt;Le code change, la donnÃ©e reste&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#il-faut-quelques-minutes-pour-prendre-une-mauvaise-dÃ©cision-sur-une-base-de-donnÃ©e&#34;&gt;Il faut quelques minutes pour prendre une mauvaise dÃ©cision sur une base de donnÃ©e&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#lusage-du-cloud&#34;&gt;L&amp;rsquo;usage du cloud&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#ce-quil-faudrait-changer&#34;&gt;Ce qu&amp;rsquo;il faudrait changer&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#pour-conclure&#34;&gt;Pour conclure&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;un-peu-dhistoire&#34;&gt;Un peu d&amp;rsquo;histoire&lt;/h1&gt;&#xA;&lt;p&gt;Par le passÃ©, il y avait une spÃ©cialisation forte des compÃ©tences : dÃ©veloppeurs, testeurs, DBA Ã©tude, DBA prod, ingÃ©nieur systÃ¨me, ingÃ©nieur stockage, ingÃ©nieur sauvegarde&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Chaque spÃ©cialitÃ© Ã©voluait un peu dans sa bulle, ce qui compliquait la collaboration avec des cycles de dÃ©veloppement longs.&lt;/p&gt;&#xA;&lt;p&gt;Cette organisation a laissÃ© place Ã  une nouvelle faÃ§on de travailler : dÃ©veloppeurs &lt;em&gt;fullstack&lt;/em&gt;, &lt;em&gt;DEVOPS/SRE&lt;/em&gt;, des data &amp;ldquo;quelque chose&amp;rdquo; (engineer, analyst, steward&amp;hellip;).&lt;/p&gt;&#xA;&lt;p&gt;Les compÃ©tences se sont diluÃ©es sur les diffÃ©rents mÃ©tiers. Je croise de plus en plus rarement des DBA.&lt;/p&gt;&#xA;&lt;p&gt;A la place, la base de donnÃ©e est &lt;em&gt;gÃ©rÃ©e&lt;/em&gt; par les dÃ©veloppeurs. Ou, si on a un peu de chance, par des &amp;ldquo;data engineer&amp;rdquo; ou &amp;ldquo;data analyst&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;AprÃ¨s plusieurs annÃ©es, alors que je baigne dedans, j&amp;rsquo;ai encore du mal Ã  dÃ©finir ces mÃ©tiers.&lt;/p&gt;&#xA;&lt;p&gt;Le constat : bonne connaissance du python, monte des pipelines, on assemble en quelque sorte des Legos avec pleins d&amp;rsquo;outils : airflow, dbt&amp;hellip; Puis, on envoie ces donnÃ©es dans du Redshift, Biquery, Snowflake&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Cependant, j&amp;rsquo;ai l&amp;rsquo;impression que la connaissance du SQL s&amp;rsquo;appauvrit Ã  cause des couches d&amp;rsquo;abstraction.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Du moment oÃ¹ on manipule de la donnÃ©e, la premiÃ¨re des compÃ©tences Ã  avoir, devrait Ãªtre la maitrise du SQL.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;quest-ce-quon-oublie-&#34;&gt;Qu&amp;rsquo;est-ce qu&amp;rsquo;on oublie ?&lt;/h1&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai le sentiment, qu&amp;rsquo;annÃ©e aprÃ¨s annÃ©e, on oublie le mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, ce dernier va Ãªtre Ã  la croisÃ©e de plusieurs chemins :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Il a des compÃ©tences pures sur la base de donnÃ©es :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ModÃ©lisation.&lt;/li&gt;&#xA;&lt;li&gt;Maitrise du SQL.&lt;/li&gt;&#xA;&lt;li&gt;Maitrise du SGBD : connait le fonctionnement du moteur (&lt;em&gt;vacuum&lt;/em&gt;, &lt;em&gt;checkpoint&lt;/em&gt; &amp;hellip;). Comprend les mÃ©canismes de verrouillages (&lt;em&gt;MVCC&lt;/em&gt;, &lt;em&gt;locks&lt;/em&gt;&amp;hellip;).&lt;/li&gt;&#xA;&lt;li&gt;Conserve une veille technique : le Postgres que j&amp;rsquo;ai connu Ã  mes dÃ©buts est trÃ¨s loin du Postgres actuel.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Mais Ã©galement des compÃ©tences plus transverses :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Avoir une bonne connaissance systÃ¨me pour investiguer sur les problÃ¨mes de performance, dimensionner les ressources.&lt;/li&gt;&#xA;&lt;li&gt;Un vernis en dÃ©veloppement pour comprendre les besoins des dÃ©veloppeurs et pouvoir les accompagner.&lt;/li&gt;&#xA;&lt;li&gt;De la culture &amp;ldquo;computer science&amp;rdquo;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;oui-mais-le-cloud&#34;&gt;Oui, mais le cloud!&lt;/h1&gt;&#xA;&lt;p&gt;On pourrait penser que le cloud a rebattu les cartes et qu&amp;rsquo;on n&amp;rsquo;a plus besoin de DBA. Dans la liste que j&amp;rsquo;ai donnÃ©e ci-dessus, quelles compÃ©tences sont couvertes par le cloud ?&lt;/p&gt;&#xA;&lt;p&gt;Le cloud rÃ©sout une partie des besoins : hÃ©bergement, maintenance, rÃ©seau, monitoring (qu&amp;rsquo;il faut souvent complÃ©ter avec un APM ou un Datadog like).&#xA;Et il rajoute d&amp;rsquo;autres problÃ¨mes :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Il faut rajouter un mÃ©tier de &lt;a href=&#34;https://lota.cloud/finops-cloud-2/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FinOps&lt;/a&gt; pour maitriser et optimiser les dÃ©penses.&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est parfois une boite noire et il peut Ãªtre difficile d&amp;rsquo;investiguer sur des problÃ¨mes de performance&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Cet excellent article de Markus Winand prÃ©sente aussi d&amp;rsquo;autres inconvÃ©nients : &lt;a href=&#34;https://winand.at/newsletter/2024-01/clouds-bring-rain&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sometimes Clouds Bring Rain&lt;/a&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Changer de cloud provider est difficile. Je dirais mÃªme que c&amp;rsquo;est volontaire de leur part.&lt;/li&gt;&#xA;&lt;li&gt;Les coÃ»ts peuvent changer &lt;em&gt;Just because it is cheap today doesnâ€™t mean it will be cheap forever&lt;/em&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Il faut prÃ©voir un plan de sortie : Ã©viter les services propriÃ©taires, conserver un faible nombre de services.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Car une fois dans le cloud, qui s&amp;rsquo;occupe de : la modÃ©lisation, l&amp;rsquo;optimisation des requÃªtes, l&amp;rsquo;indexation, la veille technique sur le SGBD&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;, l&amp;rsquo;investigation sur les performances, comprendre les problÃ¨mes de verrouillages, l&amp;rsquo;accompagnement des dÃ©veloppeurs ?&lt;/p&gt;&#xA;&lt;p&gt;Ceci est confirmÃ© dans mes audits, je vois rÃ©guliÃ¨rement des problÃ¨mes trÃ¨s basiques :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Absence de clÃ© primaire.&lt;/li&gt;&#xA;&lt;li&gt;Pas d&amp;rsquo;index sur des cas trÃ¨s simples.&lt;/li&gt;&#xA;&lt;li&gt;Aucun respect des formes normales, mÃªme les plus basiques. Le JSON n&amp;rsquo;a pas arrangÃ© les choses.&lt;/li&gt;&#xA;&lt;li&gt;RequÃªtes spaghetti.&lt;/li&gt;&#xA;&lt;li&gt;Des jointures faÃ§on SQL-89 alors que Ã§a fait plus de 30 ans que le mot clÃ© &lt;code&gt;JOIN&lt;/code&gt; existe.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;S&amp;rsquo;il faut retenir une chose : &lt;strong&gt;Le cloud ne permet pas de s&amp;rsquo;affranchir du DBA. Ce n&amp;rsquo;est pas parce qu&amp;rsquo;on peut obtenir les clÃ©s d&amp;rsquo;un avion, qu&amp;rsquo;on sait le piloter.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Un article intÃ©ressant sur le nombre de DBA dont vous avez besoin : &lt;a href=&#34;https://www.bytebase.com/blog/how-many-dbas-should-a-company-hire/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How many DBAs should a company hire?&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;on-oublie-le-mÃ©tier-de-dba&#34;&gt;On oublie le mÃ©tier de DBA&lt;/h1&gt;&#xA;&lt;p&gt;On pourrait naÃ¯vement penser qu&amp;rsquo;on confie ces tÃ¢ches Ã  des DBA experts, mais j&amp;rsquo;ai de plus en plus de doutes. J&amp;rsquo;ai l&amp;rsquo;impression &amp;ldquo;qu&amp;rsquo;on&amp;rdquo; est en train de perdre la connaissance d&amp;rsquo;un mÃ©tier.&#xA;J&amp;rsquo;ai dÃ©jÃ  croisÃ© des dÃ©veloppeurs expÃ©rimentÃ©s qui ne savaient mÃªme pas que le mÃ©tier de DBA existait.&#xA;Des recruteurs qui me demandaient si en tant que DBA, je savais optimiser des requÃªtes et si je connaissais le SQL. C&amp;rsquo;est mon mÃ©tier ! C&amp;rsquo;est un peu comme demander Ã  un plombier s&amp;rsquo;il sait changer un robinet !&lt;/p&gt;&#xA;&lt;p&gt;Ce qui est d&amp;rsquo;autant plus alarmant, c&amp;rsquo;est que je crains qu&amp;rsquo;il y ait aussi des CTO qui ont aussi cette mÃ©connaissance de la donnÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;La consÃ©quence est qu&amp;rsquo;en cas de problÃ¨me de performance, on ne fait qu&amp;rsquo;augmenter les ressources des instances.&#xA;Avec le cloud, la facture croÃ®t linÃ©airement avec la taille de l&amp;rsquo;instance.&#xA;Si la croissance de la charge est exponentielle, il faudra scaler la base et la facture qui va avec. On se retrouve avec une facture exponentielle.&lt;/p&gt;&#xA;&lt;p&gt;Quand on n&amp;rsquo;arrive plus Ã  s&amp;rsquo;en sortir, on va accuser l&amp;rsquo;outil ou le modÃ¨le, donc on va changer de SGBD ou aller vers du NoSQL. Spoiler : Ã§a ne rÃ©soudra pas vos problÃ¨mes.&lt;/p&gt;&#xA;&lt;h1 id=&#34;on-oublie-le-passÃ©&#34;&gt;On oublie le passÃ©&lt;/h1&gt;&#xA;&lt;p&gt;Pendant un temps, j&amp;rsquo;ai voulu Ã©crire un livre pour parler optimisation de requÃªte, des erreurs courantes que je rencontre, etc.&lt;/p&gt;&#xA;&lt;p&gt;En regardant ma bibliothÃ¨que, elle est pleine de livres de ce genre. Ils ont pour la plupart entre 10 et 30 ans et le contenu est toujours d&amp;rsquo;actualitÃ©. A quoi servirait un Ã©niÃ¨me livre s&amp;rsquo;il n&amp;rsquo;est pas connu ?&lt;/p&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai un autre exemple en tÃªte : les data warehouse (DWH). Ce terme devient de plus en plus galvaudÃ©.&#xA;La construction d&amp;rsquo;un DWH est complexe, il faut passer par une phase de modÃ©lisation afin de stocker correctement les donnÃ©es. Cela permet de bonnes performances et facilite l&amp;rsquo;Ã©criture&#xA;des requÃªtes analytiques.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant, je croise rÃ©guliÃ¨rement des &amp;ldquo;data warehouse&amp;rdquo; qui se rÃ©sument Ã  envoyer toutes les donnÃ©es dans un SGBD spÃ©cialisÃ© (redshift, biquery &amp;hellip;). Sans travail de modÃ©lisation et avec des requÃªtes trÃ¨s mal Ã©crites, parfois gÃ©nÃ©rÃ©es, car les utilisateurs ne savent pas faire du SQL.&lt;/p&gt;&#xA;&lt;p&gt;Ces services coÃ»tent trÃ¨s cher et ne font pas de miracle s&amp;rsquo;il n&amp;rsquo;y a pas eu un travail approfondi de modÃ©lisation et d&amp;rsquo;optimisation.&lt;/p&gt;&#xA;&lt;p&gt;Pourtant, les livres sur les DWH et le SQL ont entre 10 et 30 ans. A cette Ã©poque, le cloud n&amp;rsquo;existait pas, les SSD non plus, les CPU avec plusieurs coeurs non plus.&#xA;Pourtant, on savait construire des DWH, faire des sites performants&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Il ne faudrait pas que le cloud nous fasse oublier tout cet hÃ©ritage. Sinon, on risque de payer la dette technique et la perte de connaissance trÃ¨s cher, avec les intÃ©rÃªts en plus.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Il faut avoir en tÃªte que mÃªme si le SQL a Ã©voluÃ©, les SGBD gagnÃ©s en fonctionnalitÃ©s, &lt;strong&gt;les principes fondateurs sont toujours justes&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;le-code-change-la-donnÃ©e-reste&#34;&gt;Le code change, la donnÃ©e reste&lt;/h1&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai eu un super manager, ancien DBA, qui expliquait aux dÃ©veloppeurs : tu n&amp;rsquo;es pas ici pour &amp;ldquo;produire du code&amp;rdquo; =&amp;gt; yeux Ã©carquillÃ©s du dÃ©veloppeur.&#xA;&amp;ldquo;tu es lÃ  pour produire et manipuler de la donnÃ©e.&amp;rdquo;&lt;/p&gt;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;il y avait une dÃ©cision compliquÃ©e. Par exemple, prendre plus de temps pour revoir le code applicatif, faire une migration plus compliquÃ©e, plutÃ´t qu&amp;rsquo;une solution&#xA;&amp;ldquo;quick win&amp;rdquo;. Ce mÃªme manager expliquait :&amp;quot;&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;D&amp;rsquo;ici 5-10 ans, ton code aura Ã©tÃ© rÃ©Ã©crit plusieurs fois, peut-Ãªtre mÃªme dans un autre langage.&#xA;Nous, la donnÃ©e, dans 50 ans, elle sera toujours lÃ . C&amp;rsquo;est notre devoir de nous assurer qu&amp;rsquo;elle sera toujours exploitable.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h1 id=&#34;il-faut-quelques-minutes-pour-prendre-une-mauvaise-dÃ©cision-sur-une-base-de-donnÃ©e&#34;&gt;Il faut quelques minutes pour prendre une mauvaise dÃ©cision sur une base de donnÃ©e&lt;/h1&gt;&#xA;&lt;p&gt;&lt;em&gt;Et parfois plusieurs mois / annÃ©es pour la corriger.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Il m&amp;rsquo;est arrivÃ© de faire des audits oÃ¹ le modÃ¨le Ã©tait catastrophique. Il avait Ã©voluÃ© de solutions Ã  court terme en d&amp;rsquo;autres solutions Ã  court terme.&#xA;&amp;ldquo;On corrigera plus tard, il faut faire passer cette fonctionnalitÃ© dans le sprint&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;Un DBA peut corriger le modÃ¨le de donnÃ©es Ã  coup de grosses migrations (encore faut-il avoir un DBA, difficile si on ignore que ce mÃ©tier existe&amp;hellip;).&#xA;Au-delÃ  de Ã§a, le problÃ¨me va se poser autour : il faut rÃ©Ã©crire une grosse partie du code applicatif (qui est souvent dans le mÃªme Ã©tat que la base).&lt;/p&gt;&#xA;&lt;p&gt;Parfois, la complexitÃ© est quadratique ou exponentielle. Il vaut mieux tout jeter pour tout recommencer.&lt;/p&gt;&#xA;&lt;p&gt;On se retrouve face Ã  plusieurs dilemmes :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Augmenter la taille des instances.&lt;/li&gt;&#xA;&lt;li&gt;Parfois, cette solution n&amp;rsquo;est pas suffisante. J&amp;rsquo;explique : &amp;ldquo;lÃ , vous pouvez faire encore fois dix sur la taille de l&amp;rsquo;instance, mais vous ne pourrez jouer cette carte qu&amp;rsquo;une fois&amp;rdquo;. Notez que cette solution est inutile si le traitement ne peut pas Ãªtre parallÃ©lisÃ©.&lt;/li&gt;&#xA;&lt;li&gt;Tout jeter pour tout recommencer. LÃ  aussi, le coÃ»t ou la perte peut Ãªtre dÃ©mentielle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Alors qu&amp;rsquo;il aurait suffi des conseils d&amp;rsquo;un DBA Ã  quelques moments de la vie du projet pour Ã©viter de partir dans une mauvaise direction.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;On ne bÃ¢tit pas un chÃ¢teau sur du sable&lt;/strong&gt;. J&amp;rsquo;ai une anecdote en tÃªte, une personne de mon entourage m&amp;rsquo;a racontÃ© une histoire d&amp;rsquo;un bÃ¢timent qui avait Ã©tÃ© contrÃ´lÃ© au moment de la livraison :&lt;/p&gt;&#xA;&lt;p&gt;Un prÃ©lÃ¨vement avait Ã©tÃ© fait dans les murs et il n&amp;rsquo;y avait pas assez de ciment, le bÃ¢timent, &lt;strong&gt;neuf&lt;/strong&gt;, pouvait s&amp;rsquo;Ã©crouler. Il venait d&amp;rsquo;Ãªtre totalement terminÃ©, Ã©lectricitÃ©, plomberie, menuiseries&amp;hellip; Tout Ã©tait terminÃ©.&#xA;Il a dÃ» Ãªtre rasÃ© complÃ¨tement. Autant il existe des assurances dans le bÃ¢timent, mais pas pour le dÃ©veloppement&amp;hellip;&#xA;Je pense que certaines sociÃ©tÃ©s ne survivent pas si la dette technique est trop importante.&lt;/p&gt;&#xA;&lt;h1 id=&#34;lusage-du-cloud&#34;&gt;L&amp;rsquo;usage du cloud&lt;/h1&gt;&#xA;&lt;p&gt;Le cloud a de nombreux avantages :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;On peut rapidement obtenir des bases de donnÃ©es avec une installation relativement propre.&lt;/li&gt;&#xA;&lt;li&gt;Le cloud provider vous obligera Ã  rester sur des versions supportÃ©es.&lt;/li&gt;&#xA;&lt;li&gt;&amp;ldquo;Ã‰cologiquement&amp;rdquo;, cela permet de mutualiser des ressources physiques. Mais c&amp;rsquo;est aussi une faiblesse. L&amp;rsquo;accÃ¨s facile Ã  ces ressources peut aussi entrainer un gaspillage. On peut facilement dÃ©ployer&#xA;une centaine d&amp;rsquo;instances. LÃ , oÃ¹ avec une infrastructure &lt;em&gt;on-premise&lt;/em&gt;, il faut concilier avec les ressources physiques Ã  disposition : puissance des serveurs, puissance Ã©lectrique, espace dans les baies&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;On paye ce qu&amp;rsquo;on consomme. On peut facilement identifier combien coute un service. Qu&amp;rsquo;une requÃªte est responsable de 80% de la facture. Ce qui peut inciter Ã  l&amp;rsquo;optimiser, le gain financier est immÃ©diat. Encore faut-il qu&amp;rsquo;il y ait des personnes qui s&amp;rsquo;y intÃ©ressent.&#xA;Je n&amp;rsquo;ai pas l&amp;rsquo;impression qu&amp;rsquo;il y ait beaucoup de FinOps. S&amp;rsquo;il y en a, est-ce que ces derniers pensent Ã  optimiser la base ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Mais il y a aussi de vrais inconvÃ©nients :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Perte de souverainetÃ© numÃ©rique. A cela s&amp;rsquo;ajoute des risques juridiques. Comment garantir que vos donnÃ©es ne sont pas stockÃ©es ailleurs ? Si vous avez choisi un service managÃ©, comment en sortir si la lÃ©gislation vous impose d&amp;rsquo;Ãªtre sur le sol FranÃ§ais ou d&amp;rsquo;un autre pays ?&lt;/li&gt;&#xA;&lt;li&gt;Perte de compÃ©tences.&lt;/li&gt;&#xA;&lt;li&gt;DÃ©pendance Ã  un cloud provider : encore que sur ce point, on voit Ã©merger de nouvelles offres &amp;ldquo;cloud agnostique&amp;rdquo; : Des sociÃ©tÃ©s crÃ©ent un cloud par-dessus un autre cloud.&#xA;Je pense notamment Ã  &lt;a href=&#34;https://aiven.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aiven&lt;/a&gt;, &lt;a href=&#34;https://www.enterprisedb.com/docs/biganimal/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EDB BigAnimal&lt;/a&gt;, &lt;a href=&#34;https://www.crunchydata.com/products/crunchy-bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Crunchy Bridge&lt;/a&gt; et j&amp;rsquo;en oublie certainement&amp;hellip;&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;li&gt;Les couts dÃ©collent quand l&amp;rsquo;infrastructure est importante. Certains commencent Ã  quitter le cloud. Je pense notamment Ã  Basecamp :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/why-we-re-leaving-the-cloud-654b47e0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Why we&amp;rsquo;re leaving the cloud&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/we-stand-to-save-7m-over-five-years-from-our-cloud-exit-53996caa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;We stand to save $7m over five years from our cloud exit&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/the-big-cloud-exit-faq-20274010&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Big Cloud Exit FAQ&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;ce-quil-faudrait-changer&#34;&gt;Ce qu&amp;rsquo;il faudrait changer&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Redonner de la valeur Ã  la donnÃ©e : des sociÃ©tÃ©s rechignent Ã  faire appel Ã  des DBA ou prendre des contrats de supports sur leur base. Quel est le cout d&amp;rsquo;une indisponibilitÃ© de service, d&amp;rsquo;une corruption de donnÃ©e, d&amp;rsquo;une perte de la base ?&lt;/li&gt;&#xA;&lt;li&gt;RÃ©investir le champ des compÃ©tences en base de donnÃ©e : SQL, modÃ©lisation&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;. A ce sujet, j&amp;rsquo;aime beaucoup le titre de Markus Winand : &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Renaissance Ambassador&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;S&amp;rsquo;attarder un peu plus sur l&amp;rsquo;usage des ressources : la consommation du numÃ©rique est importante, si les serveurs et l&amp;rsquo;Ã©lectricitÃ© Ã©taient plus chers, on serait contraint d&amp;rsquo;optimiser.&lt;/li&gt;&#xA;&lt;li&gt;Surveiller les dÃ©penses sur les bases. Que Ã§a soit dans le cloud, mais Ã©galement on-premise. Pour cela, il faut avoir des indicateurs de couts.&lt;/li&gt;&#xA;&lt;li&gt;Penser pas Ã  faire appel Ã  des DBA pour anticiper les problÃ¨mes et investiguer sur les problÃ¨mes de performance : J&amp;rsquo;ai auditÃ© des bases dans un Ã©tat catastrophique, Ã§a aurait pu Ãªtre Ã©vitÃ© si un DBA Ã©tait intervenu dans la phase de modÃ©lisation. Sur les problÃ¨mes de performance, il m&amp;rsquo;est dÃ©jÃ  arrivÃ© de diviser des factures de cloud par 10 ou de baisser la charge moyenne de 80% Ã  5% avec un suivi rÃ©gulier.&lt;/li&gt;&#xA;&lt;li&gt;Il ne faut pas se rÃ©signer Ã  payer de grosses factures cloud plutÃ´t que d&amp;rsquo;investir dans de la compÃ©tence de DBA.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;pour-conclure&#34;&gt;Pour conclure&lt;/h1&gt;&#xA;&lt;p&gt;C&amp;rsquo;est un article moins technique par rapport Ã  ce que vous avez l&amp;rsquo;habitude de lire sur mon blog.&#xA;Cependant, c&amp;rsquo;est un des plus importants que j&amp;rsquo;ai Ã©tÃ© amenÃ© Ã  Ã©crire.&#xA;Ca fait plus de dix ans que je fais du Postgres et je rÃ©alise que la tendance ne va pas dans la bonne direction.&#xA;J&amp;rsquo;espÃ¨re qu&amp;rsquo;il y aura une prise de conscience pour un avenir plus durable des bases de donnÃ©es.&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Ainsi que dans le public, il est dans le &lt;a href=&#34;https://code.gouv.fr/data/sill.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Socle interministÃ©riel de logiciels libres&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:2&#34;&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://twitter.com/pgconfeu/status/1734860251390750980&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;720 personnes Ã  la PGEurope 2023&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:3&#34;&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.datadoghq.com/blog/aws-ebs-latency-and-iops-the-surprising-truth/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS EBS latency and IOPS: The surprising truth&lt;/a&gt;&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Ultimately, due to AWSâ€™ opacity, there is simply no way to know how much throughput (from the physical disks and from the network that sits in-between) to expect for a given EBS volume. Provisioned IOPS only offer a partial solution to this issue, at a higher hourly cost.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:4&#34;&gt;&#xA;&lt;p&gt;Le Postgres actuel est trÃ¨s loin du Postgres avec lequel j&amp;rsquo;ai dÃ©butÃ© :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Nouvelles fonctionnalitÃ©s liÃ©es au standard SQL : JSONPath par exemple. &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Markus Winand&lt;/a&gt; est l&amp;rsquo;auteur d&amp;rsquo;un super site Ã  ce sujet: &lt;a href=&#34;https://modern-sql.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;Nouvelles fonctionnalitÃ©s sur le moteur : parallÃ©lisme, partitionnement, nouveaux noeuds d&amp;rsquo;exÃ©cution, rÃ©plication logique&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;La consÃ©quence est un nombre de paramÃ¨tres qui augmente au fur et Ã  mesure.&lt;/li&gt;&#xA;&lt;li&gt;De nouvelles extensions.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:5&#34;&gt;&#xA;&lt;p&gt;Je n&amp;rsquo;ai pas travaillÃ© avec ces offres, je n&amp;rsquo;ai pas de recul dessus. On peut nÃ©anmoins souligner que ces sociÃ©tÃ©s emploient des dÃ©veloppeurs qui contribuent Ã  Postgres.&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:6&#34;&gt;&#xA;&lt;p&gt;Il y a quelques annÃ©es, un article Ã©tait tirÃ© d&amp;rsquo;une confÃ©rence.&lt;/p&gt;&#xA;&lt;p&gt;Le titre est particuliÃ¨rement juste : &lt;a href=&#34;https://www.citusdata.com/blog/2018/03/19/postgres-database-constraints&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Database constraints in Postgres: The last line of defense&lt;/a&gt;.&#xA;Voici la vidÃ©o de la confÃ©rence : &lt;a href=&#34;https://www.youtube.com/watch?v=hWh8QoV8z8k&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Constraints: a Developer&amp;rsquo;s Secret Weapon - Will Leinweber&lt;/a&gt;&#xA;et ses &lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2018/sessions/session/1835/slides/70/2018-03-15%20constraints%20a%20developers%20secret%20weapon%20pgday%20paris.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;slides&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Optimisation du GROUP BY</title>
    <updated>2024-01-26T09:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-01-26:/2024/01/26/optimisation-du-group-by/</id>
    <link href="https://blog.anayrat.info/2024/01/26/optimisation-du-group-by/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Un commit a attirÃ© mon attention lors de ma veille technique :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;commit 0452b461bc405e6d35d8a14c02813c15e28ae516&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Author:     Alexander Korotkov &amp;lt;akorotkov@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AuthorDate: Sun Jan 21 22:21:36 2024 +0200&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Commit:     Alexander Korotkov &amp;lt;akorotkov@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CommitDate: Sun Jan 21 22:21:36 2024 +0200&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Explore alternative orderings of group-by pathkeys during optimization.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    When evaluating a query with a multi-column GROUP BY clause, we can minimize&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sort operations or avoid them if we synchronize the order of GROUP BY clauses&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    with the ORDER BY sort clause or sort order, which comes from the underlying&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    query tree. Grouping does not imply any ordering, so we can compare&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    the keys in arbitrary order, and a Hash Agg leverages this. But for Group Agg,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    we simply compared keys in the order specified in the query. This commit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    explores alternative ordering of the keys, trying to find a cheaper one.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    The ordering of group keys may interact with other parts of the query, some of&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    which may not be known while planning the grouping. For example, there may be&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    an explicit ORDER BY clause or some other ordering-dependent operation higher up&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    in the query, and using the same ordering may allow using either incremental&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sort or even eliminating the sort entirely.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    The patch always keeps the ordering specified in the query, assuming the user&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    might have additional insights.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    This introduces a new GUC enable_group_by_reordering so that the optimization&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    may be disabled if needed.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Discussion: https://postgr.es/m/7c79e6a5-8597-74e8-0671-1c39d124c9d6%40sigaev.ru&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Author: Andrei Lepikhov, Teodor Sigaev&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Tomas Vondra, Claudio Freire, Gavin Flower, Dmitry Dolgov&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Robert Haas, Pavel Borisov, David Rowley, Zhihong Yu&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Tom Lane, Alexander Korotkov, Richard Guo, Alena Rybakina&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On remarque le message du commit assez explicite en mentionnant les personnes impliquÃ©es (12 relecteurs!) ainsi que le lien vers la discussion :&#xA;&lt;a href=&#34;https://www.postgresql.org/message-id/flat/7c79e6a5-8597-74e8-0671-1c39d124c9d6%40sigaev.ru&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;POC: GROUP BY optimization&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Les travaux ont commencÃ© en 2018! Il aura fallu 5 ans et demi pour aboutir Ã  ce commit. C&amp;rsquo;est le fruit de nombreux Ã©changes afin de parvenir Ã  un consensus en prenant en compte les multiples idÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Pour tester ce patch, j&amp;rsquo;ai compilÃ© Postgres depuis les sources. Prenons un exemple tout simple :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_000_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;vacuum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On obtient une table de 422Mo et un index de 66Mo.&#xA;Vous noterez au passage que j&amp;rsquo;ai utilisÃ© une nouveautÃ© de Postgres 16 en utilisant des &amp;ldquo;underscore&amp;rdquo; dans le &lt;em&gt;generate_series&lt;/em&gt;&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Si on fait un &lt;code&gt;GROUP BY&lt;/code&gt; sur &lt;em&gt;c1,c2&lt;/em&gt;, on obtient un parcours d&amp;rsquo;index :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c1,c2 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                    QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------------------------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; GroupAggregate  (cost=0.43..235342.27 rows=100000 width=16) (actual time=3.605..3501.887 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Group Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Index Only Scan using t1_c1_c2_idx on t1  (cost=0.43..159340.96 rows=10000175 width=8) (actual time=0.070..1900.730 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Heap Fetches: 0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: enable_group_by_reordering = &amp;#39;off&amp;#39;, random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.191 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 3502.036 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Vous remarquerez que j&amp;rsquo;ai volontairement dÃ©sactivÃ© la fonctionnalitÃ© dans un premier temps (enable_group_by_reordering=off). J&amp;rsquo;ai Ã©galement dÃ©sactivÃ© la parallÃ©lisation pour plus de clartÃ©.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;On a le plan attendu, le moteur va lire 10447 blocs avec un parcours &lt;em&gt;Index Only Scan&lt;/em&gt;. Le moteur va chercher le plan qui manipule le moins de blocs possible.&lt;/p&gt;&#xA;&lt;p&gt;En revanche, si on change l&amp;rsquo;ordre du group by :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c2,c1 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                          QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Sort  (cost=602422.32..602672.32 rows=100000 width=16) (actual time=5393.446..5393.503 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Sort Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Sort Method: quicksort  Memory: 79kB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  HashAggregate  (cost=514992.50..594117.50 rows=100000 width=16) (actual time=5392.351..5392.894 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Group Key: c2, c1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Batches: 1  Memory Usage: 3217kB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         -&amp;gt;  Seq Scan on t1  (cost=0.00..154055.00 rows=10000000 width=8) (actual time=0.033..1186.171 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: enable_group_by_reordering = &amp;#39;off&amp;#39;, random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.189 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 5394.566 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans ce cas, le moteur va lire toute la table (&lt;em&gt;seqscan&lt;/em&gt;) et faire un tri, alors que le rÃ©sultat est identique.&lt;/p&gt;&#xA;&lt;p&gt;Le moteur lit 422Mo de donnÃ©es contre 80Mo, soit 5 fois plus. Le rÃ©sultat peut Ãªtre dÃ©sastreux suivant les performances du stockage.&#xA;LÃ , on a de la &amp;ldquo;chance&amp;rdquo;, mon instance est dans un ramdisk donc la requÃªte n&amp;rsquo;est pas beaucoup plus lente.&#xA;Avec du stockage mÃ©canique ou des disques cloud, le temps de rÃ©ponse peut augmenter drastiquement.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;ordre des colonnes dans un group by est important, c&amp;rsquo;est une optimisation assez simple pour peu qu&amp;rsquo;on connaisse le schÃ©ma de la base et qu&amp;rsquo;on maitrise les requÃªtes exÃ©cutÃ©es sur le serveur.&lt;/p&gt;&#xA;&lt;p&gt;Malheureusement, avec les ORM, on peut perdre cette maitrise ou rater des corrections.&#xA;C&amp;rsquo;est lÃ  oÃ¹ cette fonctionnalitÃ© est intÃ©ressante. Voyons son effet :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres=# set enable_group_by_reordering to on;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SET&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres=# explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c2,c1 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                    QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------------------------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; GroupAggregate  (cost=0.43..235338.33 rows=100000 width=16) (actual time=4.502..3658.168 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Group Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Index Only Scan using t1_c1_c2_idx on t1  (cost=0.43..159338.33 rows=10000000 width=8) (actual time=0.081..1923.553 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Heap Fetches: 0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.230 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 3658.337 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On retrouve le premier plan bien plus performant.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est une fonctionnalitÃ© assez simple qui devrait amÃ©liorer les temps d&amp;rsquo;exÃ©cutions de certaines requÃªtes dont la clause group by n&amp;rsquo;a pas Ã©tÃ© optimisÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est une demande assez rÃ©currente d&amp;rsquo;amÃ©liorer le planificateur afin de gÃ©rer des cas en apparence simple. Il faut avoir en tÃªte que le risque est de d&amp;rsquo;augmenter&#xA;les opÃ©rations de calculs dans le planificateur. Or, on veut que cette Ã©tape soit la plus rapide possible La rÃ©ponse est souvent rÃ©sumÃ©e Ã  : &amp;ldquo;on ne veut pas alourdir le planificateur alors qu&amp;rsquo;on peut corriger la requÃªte&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, ce type d&amp;rsquo;optimisation peut Ãªtre acceptÃ©e si on sait que Ã§a ne sera pas couteux pour le planificateur.&lt;/p&gt;&#xA;&lt;p&gt;Il n&amp;rsquo;y a plus qu&amp;rsquo;Ã  espÃ©rer que cette fonctionnalitÃ© ne soit pas retirÃ©e d&amp;rsquo;ici la sortie de Postgres 17 :)&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Petite anecdote, pour ajouter cette fonctionnalitÃ©, l&amp;rsquo;auteur a fait Ã©voluer le standard SQL : &lt;a href=&#34;http://peter.eisentraut.org/blog/2023/09/20/grouping-digits-in-sql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grouping digits in SQL&lt;/a&gt; .&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL compression du TOAST et toast_tuple_target</title>
    <updated>2022-02-14T07:00:00Z</updated>
    <id>tag:blog.anayrat.info,2022-02-14:/2022/02/14/postgresql-compression-du-toast-et-toast_tuple_target/</id>
    <link href="https://blog.anayrat.info/2022/02/14/postgresql-compression-du-toast-et-toast_tuple_target/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Quelques rappels sur le TOAST et prÃ©sentation d&amp;rsquo;un changement apparu avec PostgreSQL 11.&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#quest-ce-que-le-toast-&#34;&gt;Qu&amp;rsquo;est-ce que le TOAST ?&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#exemple-avec-le-jsonb&#34;&gt;Exemple avec le JSONB&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#paramÃ©trage-avancÃ©&#34;&gt;ParamÃ©trage avancÃ©&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#conclusion&#34;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#bonus&#34;&gt;Bonus&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;quest-ce-que-le-toast-&#34;&gt;Qu&amp;rsquo;est-ce que le TOAST ?&lt;/h1&gt;&#xA;&lt;p&gt;Vous Ãªtes-vous dÃ©jÃ  posÃ© la question sur comment Postgres fait pour stocker des lignes dÃ©passant la taille d&amp;rsquo;un bloc? Pour rappel, la taille par dÃ©faut d&amp;rsquo;un bloc est de 8Ko.&lt;/p&gt;&#xA;&lt;p&gt;Postgres utilise un mÃ©canisme appelÃ© TOAST pour &lt;a href=&#34;https://www.postgresql.org/docs/current/storage-toast.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Oversized-Attribute Storage Technique&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;un enregistrement devient trop gros pour Ãªtre stockÃ© dans un bloc, le moteur va le stocker &amp;ldquo;Ã  part&amp;rdquo;, dans une table de toast.&#xA;L&amp;rsquo;enregistrement sera dÃ©coupÃ© en &lt;em&gt;chunks&lt;/em&gt;, ainsi la table principale (appelÃ©e &lt;em&gt;heap&lt;/em&gt;) contiendra un pointeur (&lt;em&gt;chunk_id&lt;/em&gt;) pointant vers le bon &lt;em&gt;chunk&lt;/em&gt; dans la table de toast.&lt;/p&gt;&#xA;&lt;p&gt;Ce &lt;em&gt;chunk&lt;/em&gt; sera stockÃ© sur plusieurs lignes, pour un &lt;em&gt;chunk_id&lt;/em&gt; on peut avoir plusieurs lignes dans cette table de toast.&#xA;Ainsi, cette table de toast est composÃ©e de 3 colonnes:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_id&lt;/em&gt; : NumÃ©ro du chunk rÃ©fÃ©rencÃ© dans la heap&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_seq&lt;/em&gt; : NumÃ©ro de chaque segment d&amp;rsquo;un chunk&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_data&lt;/em&gt; : Partie donnÃ©es de chaque segment&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La rÃ©alitÃ© est un peu plus complexe, en vrai le moteur va tenter d&amp;rsquo;Ã©viter de stocker la donnÃ©e dans la table toast.&#xA;Si la ligne dÃ©passe &lt;code&gt;TOAST_TUPLE_THRESHOLD&lt;/code&gt; (2Ko), il va tenter de compresser les colonnes pour essayer de faire rentrer la ligne dans le bloc.&#xA;Plus prÃ©cisÃ©ment, il faut que la taille soit infÃ©rieure Ã  &lt;code&gt;TOAST_TUPLE_TARGET&lt;/code&gt; (2Ko par dÃ©faut, on va en reparler).&lt;/p&gt;&#xA;&lt;p&gt;Si on a de la chance, la ligne compressÃ©e rentre dans la heap. Sinon, il va tenter de compresser les colonnes,&#xA;de la plus grande Ã  la plus petite et les stocker dans la partie toast jusqu&amp;rsquo;Ã  ce que les colonnes restantes rentrent dans une ligne de la heap. &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;A noter Ã©galement que si le gain en compression est trop faible, il considÃ¨re qu&amp;rsquo;il est inutile de dÃ©penser&#xA;de la ressource de calcul Ã  tenter de compresser. Il stocke donc la donnÃ©e sans compression. &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;Avez-vous dÃ©jÃ  prÃªtÃ© attention Ã  la colonne &amp;ldquo;Storage&amp;rdquo; lorsque vous affichez les caractÃ©ristiques d&amp;rsquo;une table Ã  l&amp;rsquo;aide de la mÃ©ta commande &lt;code&gt;\d+ table&lt;/code&gt; ?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;stackoverflow=# \d+ posts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   Table &amp;#34;public.posts&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Column     |  Type   | Collation | Nullable | Default | Storage  |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---------------+---------+-----------+----------+---------+----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; id            | integer |           | not null |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; posttypeid    | integer |           | not null |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; score         | integer |           |          |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; viewcount     | integer |           |          |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; body          | text    |           |          |         | extended |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans cet exemple, la colonne prend comme valeur &lt;em&gt;plain&lt;/em&gt; ou &lt;em&gt;extended&lt;/em&gt;. En rÃ©alitÃ©, il existe 4 valeurs possibles selon le type de donnÃ©e :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;em&gt;plain&lt;/em&gt; : la colonne est stockÃ©e dans la heap uniquement et sans compression.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;extended&lt;/em&gt; : la colonne peut Ãªtre compressÃ©e et stockÃ©e dans le toast si nÃ©cessaire.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;external&lt;/em&gt; : la colonne peut Ãªtre stockÃ©e dans le toast mais uniquement sans compression. Parfois on peut utiliser ce mode pour avoir un gain en performance (Ã©vite la compression/dÃ©compression)&#xA;au prix d&amp;rsquo;une consommation plus importante de l&amp;rsquo;espace disque.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;main&lt;/em&gt; : La colonne est stockÃ©e dans la heap uniquement mais contrairement au mode &lt;em&gt;plain&lt;/em&gt;, on autorise la compression.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Au premier abord, on peut penser que l&amp;rsquo;intÃ©rÃªt est surtout sur la possibilitÃ© de stocker&#xA;des lignes dÃ©passant la taille d&amp;rsquo;un bloc et de compresser la donnÃ©e pour gagner de l&amp;rsquo;espace disque.&lt;/p&gt;&#xA;&lt;p&gt;Il y a un autre intÃ©rÃªt : lors d&amp;rsquo;une mise Ã  jour d&amp;rsquo;une ligne, si les colonnes &amp;ldquo;toastÃ©es&amp;rdquo; ne sont pas modifiÃ©es, le moteur n&amp;rsquo;a pas besoin de modifier la table toast.&#xA;On va ainsi Ã©viter de devoir dÃ©compresser et recompresser le toast et Ã©crire tout Ã§a dans des journaux de transaction.&lt;/p&gt;&#xA;&lt;p&gt;Nous allons voir qu&amp;rsquo;un autre avantage est que le moteur peut Ã©viter de lire le toast si ce n&amp;rsquo;est pas nÃ©cessaire.&lt;/p&gt;&#xA;&lt;h1 id=&#34;exemple-avec-le-jsonb&#34;&gt;Exemple avec le JSONB&lt;/h1&gt;&#xA;&lt;p&gt;Pour Ã©tudier Ã§a, on va utiliser le type JSONB. De maniÃ¨re gÃ©nÃ©rale, je dÃ©conseille l&amp;rsquo;usage de ce type :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;On perd les avantages d&amp;rsquo;avoir un schÃ©ma :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;vÃ©rification des types&lt;/li&gt;&#xA;&lt;li&gt;contraintes d&amp;rsquo;intÃ©gritÃ©&lt;/li&gt;&#xA;&lt;li&gt;pas de clÃ©s Ã©trangÃ¨res&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;L&amp;rsquo;Ã©criture des requÃªtes devient plus complexe&lt;/li&gt;&#xA;&lt;li&gt;Absence des statistiques sur les clÃ©s d&amp;rsquo;un champ json&lt;/li&gt;&#xA;&lt;li&gt;Perte d&amp;rsquo;efficacitÃ© du stockage vu qu&amp;rsquo;on stocke les clÃ©s pour chaque ligne&lt;/li&gt;&#xA;&lt;li&gt;Pas de mise Ã  jour partielle du JSONB. Si on modifie une clÃ© on est obligÃ© de &lt;em&gt;detoaster&lt;/em&gt; et &lt;em&gt;toaster&lt;/em&gt; tout le JSONB&lt;/li&gt;&#xA;&lt;li&gt;Pas de &lt;em&gt;detoast&lt;/em&gt; partiel : si on souhaite lire une seule clÃ© du JSONB, on est contraint de &lt;em&gt;detoaster&lt;/em&gt; tout le JSONB &lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cependant, il y a quelques exceptions oÃ¹ le JSON peut Ãªtre utile :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Lorsqu&amp;rsquo;on n&amp;rsquo;a pas besoin de chercher dans de multiples champs et qu&amp;rsquo;on rÃ©cupÃ¨re le json via une autre colonne. (Statistiques sur les clÃ©s du json inutiles).&lt;/li&gt;&#xA;&lt;li&gt;Et, lorsqu&amp;rsquo;il serait trÃ¨s difficile de faire rentrer le json dans un schÃ©ma relationnel. Certains cas impliqueraient d&amp;rsquo;avoir Ã©normÃ©ment de colonnes et la plupart Ã  &lt;code&gt;NULL&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Par exemple, pour stocker des caractÃ©ristiques de produit oÃ¹ une version normalisÃ©e entrainerait l&amp;rsquo;usage de beaucoup de colonnes dont la plupart seraient Ã  &lt;code&gt;NULL&lt;/code&gt;.&#xA;Imaginons que vous stockez des produits, une tÃ©lÃ©vision aurait des caractÃ©ristiques spÃ©cifiques (type d&amp;rsquo;Ã©cran, taille etc). Une machine Ã  laver aurait aussi d&amp;rsquo;autre caractÃ©ristiques spÃ©cifiques (vitesse essorage, poids acceptÃ©&amp;hellip;).&lt;/p&gt;&#xA;&lt;p&gt;On pourrait ainsi envisager d&amp;rsquo;avoir des colonnes &amp;ldquo;normales&amp;rdquo; comprenant le modÃ¨le, son prix, sa rÃ©fÃ©rence etc, et une colonne contenant toutes les caractÃ©ristiques.&#xA;On accÃ¨derait Ã  la ligne via la rÃ©fÃ©rence et ainsi on rÃ©cupÃ¨rerait toutes les caractÃ©ristiques du produit stockÃ©es dans le json.&lt;/p&gt;&#xA;&lt;p&gt;Je vais rÃ©utiliser la table des posts de Stackoverflow en dÃ©plaÃ§ant quelques colonnes dans une colonne de type jsonb (colonne &lt;em&gt;jsonfield&lt;/em&gt; dans cet exemple):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;\d posts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            Unlogged table &amp;#34;public.posts&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Column         |            Type             | Collation | Nullable | Default&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----------------------+-----------------------------+-----------+----------+---------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; id                    | integer                     |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; posttypeid            | integer                     |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; acceptedanswerid      | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; parentid              | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; creationdate          | timestamp without time zone |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; score                 | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; viewcount             | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; body                  | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; owneruserid           | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditoruserid      | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditordisplayname | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditdate          | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lastactivitydate      | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; title                 | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tags                  | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; answercount           | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; commentcount          | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; favoritecount         | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; closeddate            | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; communityowneddate    | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; jsonfield             | jsonb                       |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Voici une requÃªte toute simple d&amp;rsquo;agrÃ©gation :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;viewcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;answercount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commentcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;favoritecount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                          QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Aggregate  (cost=10265135.77..10265135.78 rows=1 width=128) (actual time=170221.557..170221.558 rows=1 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1 read=9186137&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   I/O Timings: read=138022.290&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Seq Scan on posts  (cost=0.00..9725636.88 rows=53949888 width=16) (actual time=0.014..153665.913 rows=53949886 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=1 read=9186137&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         I/O Timings: read=138022.290&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.240 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 170221.627 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(8 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La requÃªte lit 70 Go de donnÃ©es et met environ 2min 50s Ã  s&amp;rsquo;exÃ©cuter.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant la mÃªme requÃªte, mais cette fois en utilisant les clÃ©s prÃ©sentes dans le json.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ViewCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;AnswerCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CommentCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;FavoriteCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Aggregate  (cost=11883632.41..11883632.42 rows=1 width=128)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            (actual time=520917.028..520917.030 rows=1 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=241116554 read=13625756&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Seq Scan on posts  (cost=0.00..9725636.88 rows=53949888 width=570)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          (actual time=0.972..70569.365 rows=53949886 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared read=9186138&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.118 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 520945.395 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(10 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La requÃªte met environ 8min 40s Ã  s&amp;rsquo;exÃ©cuter. En revanche le nombre de blocs lus semble un peu dÃ©lirant :&lt;/p&gt;&#xA;&lt;p&gt;Le Seq Scan indique comme tout Ã  l&amp;rsquo;heure 70Go. En revanche, le nÅ“ud parent indique plus de 1.9 To lus!&lt;/p&gt;&#xA;&lt;p&gt;Voici la taille de la table avec le paramÃ©trage par dÃ©faut. Il faut savoir que pour certains enregistrements,&#xA;le moteur va, soit compresser la ligne dans la heap, soit la compresser et la placer dans le toast.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SELECT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(oid)) table_size,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(reltoastrelid)) toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FROM pg_class&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WHERE relname = &amp;#39;posts&amp;#39;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; table_size | toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------+-----------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 70 GB      | 33 GB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(1 row)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Comment expliquer les 1.9 To lus ?&lt;/p&gt;&#xA;&lt;p&gt;Par curiositÃ©, j&amp;rsquo;ai fait la mÃªme requÃªte, mais avec une seule agrÃ©gation et j&amp;rsquo;obtiens environ 538 Go.&lt;/p&gt;&#xA;&lt;p&gt;On peut se poser plusieurs questions :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Comment savoir si le moteur va lire le toast ?&lt;/li&gt;&#xA;&lt;li&gt;Pourquoi un tel Ã©cart de temps d&amp;rsquo;exÃ©cution entre la version &amp;ldquo;colonne standard&amp;rdquo; et champ jsonb?&lt;/li&gt;&#xA;&lt;li&gt;A quoi correspondent les compteurs dans le nÅ“ud &lt;code&gt;Aggregate&lt;/code&gt; ?&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pour rÃ©pondre Ã  la premiÃ¨re question, il suffit de lire la vue &lt;code&gt;pg_statio_user_tables&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Avant exÃ©cution de la requÃªte :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;select relid,schemaname,relname,heap_blks_read,heap_blks_hit,toast_blks_read,toast_blks_hit from pg_statio_all_tables where relname in (&amp;#39;posts&amp;#39;,&amp;#39;pg_toast_26180851&amp;#39;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  relid   | schemaname |      relname      | heap_blks_read | heap_blks_hit | toast_blks_read | toast_blks_hit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----------+------------+-------------------+----------------+---------------+-----------------+----------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180851 | public     | posts             |      422018238 |      87673549 |       129785076 |      628153337&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180854 | pg_toast   | pg_toast_26180851 |      129785076 |     628153337 |                 |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;AprÃ¨s :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  relid   | schemaname |      relname      | heap_blks_read | heap_blks_hit | toast_blks_read | toast_blks_hit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----------+------------+-------------------+----------------+---------------+-----------------+----------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180851 | public     | posts             |      431204376 |      87673549 |       134156898 |      686299551&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180854 | pg_toast   | pg_toast_26180851 |      134156898 |     686299551 |                 |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ce qui nous fait :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;431204376&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;87673549&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;422018238&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;87673549&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;heap_buffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;134156898&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;686299551&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;129785076&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;628153337&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_buffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;heap_buffers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_buffers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------+---------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;477&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Le moteur va bien lire le toast. En revanche les compteurs laissent penser que le moteur va lire plusieurs fois le toast.&lt;/p&gt;&#xA;&lt;p&gt;Si je fais le mÃªme calcul, mais cette fois en effectuant l&amp;rsquo;agrÃ©gation que sur un seul champ, j&amp;rsquo;obtiens 119 Go (~ 477 Go / 4)&#xA;J&amp;rsquo;imagine que le moteur lit le toast pour chaque fonction.&lt;/p&gt;&#xA;&lt;p&gt;Ensuite, l&amp;rsquo;Ã©cart du temps d&amp;rsquo;exÃ©cution s&amp;rsquo;explique par plusieurs facteurs :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le moteur va devoir lire et &lt;em&gt;detoaster&lt;/em&gt; (dÃ©compresser) le toast&lt;/li&gt;&#xA;&lt;li&gt;Faire des opÃ©rations supplÃ©mentaires sur le jsonb pour accÃ©der Ã  la valeur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Avec la premiÃ¨re requÃªte, le moteur n&amp;rsquo;avait pas Ã  lire le toast. D&amp;rsquo;une part, il a moins de donnÃ©es Ã  lire,&#xA;d&amp;rsquo;autre part, il n&amp;rsquo;a pas Ã  manipuler le json pour identifier la clÃ© et extraire la valeur Ã  calculer.&lt;/p&gt;&#xA;&lt;p&gt;Enfin, les compteurs du nÅ“ud aggregate doivent correspondre aux donnÃ©es dÃ©compressÃ©es pour chaque fonction qui va lire dans le json.&#xA;En effet, si on prend le total moins le &lt;em&gt;seqscan&lt;/em&gt; de la table, donc que la partie &lt;em&gt;toast&lt;/em&gt;, on a :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;468 Go pour un seul champ&lt;/li&gt;&#xA;&lt;li&gt;936 Go, le double pour deux champs&lt;/li&gt;&#xA;&lt;li&gt;1873 Go pour les 4 champs (donc environ 4 x 468 Go)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;C&amp;rsquo;est ce qui explique pourquoi on obtient une valeur aussi Ã©levÃ©e.&lt;/p&gt;&#xA;&lt;h1 id=&#34;paramÃ©trage-avancÃ©&#34;&gt;ParamÃ©trage avancÃ©&lt;/h1&gt;&#xA;&lt;p&gt;Maintenant, on va encourager Postgres Ã  placer le maximum de donnÃ©es dans le toast grÃ¢ce Ã  l&amp;rsquo;option &lt;em&gt;toast_tuple_target&lt;/em&gt; apparue avec la version 11 de Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Cette option permet de manipuler le seuil Ã  partir duquel les donnÃ©es sont stockÃ©e dans le &lt;em&gt;toast&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Par ailleurs, Ã©tant sous Postgres 14, j&amp;rsquo;en ai profitÃ© pour utiliser l&amp;rsquo;algorithme de compression lz4 (paramÃ¨tre &lt;em&gt;default_toast_compression&lt;/em&gt;).&#xA;Cet algorithme offre un ratio de compression similaire Ã  pglz, cependant, il est beaucoup plus rapide (Voir &lt;a href=&#34;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is the new LZ4 TOAST compression in PostgreSQL 14, and how fast is it?&lt;/a&gt;).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts_toast&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_tuple_target&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Voici la taille de la table obtenue.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SELECT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(oid)) table_size,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(reltoastrelid)) toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FROM pg_class&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WHERE relname = &amp;#39;posts_toast&amp;#39;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; table_size | toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------+------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 59 GB      | 52 GB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Au total, la table avec le toast fait grosso-modo la mÃªme taille. Dans l&amp;rsquo;exemple avec la premiÃ¨re table,&#xA;il faut savoir que le moteur compresse aussi les donnÃ©es dans la heap.&lt;/p&gt;&#xA;&lt;p&gt;Rejouons notre requÃªte d&amp;rsquo;agrÃ©gation :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;viewcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;answercount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commentcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;favoritecount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts_toast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cette fois la requÃªte lit 59 Go de donnÃ©es et met 2min 17 secondes.&#xA;On a gagnÃ© environ 20% de temps d&amp;rsquo;exÃ©cution sur cet exemple.&lt;/p&gt;&#xA;&lt;p&gt;On pourrait gagner beaucoup plus si la partie stockÃ©e en toast Ã©tait plus importante. Le volume de donnÃ©e Ã  lire dans la heap serait beaucoup plus rÃ©duit.&lt;/p&gt;&#xA;&lt;p&gt;Par curiositÃ©, j&amp;rsquo;ai aussi exÃ©cutÃ© la requÃªte qui fait l&amp;rsquo;agrÃ©gation depuis les donnÃ©es du champ json. J&amp;rsquo;obtiens un temps d&amp;rsquo;exÃ©cution de 7min 17s.&lt;/p&gt;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;RÃ©sumÃ© en quelques chiffres :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AgrÃ©gation type standard, stockage standard : 2min 50s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type jsonb, stockage standard : 8min 40s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type standard, stockage avec &lt;em&gt;toast_tuple_target&lt;/em&gt; = 128 : 2min 17s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type jsonb, stockage avec &lt;em&gt;toast_tuple_target&lt;/em&gt; = 128 : 7min 17s&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;On constate que l&amp;rsquo;usage du JSON est bien plus couteux que d&amp;rsquo;utiliser les types standards. Le moteur doit faire plus d&amp;rsquo;opÃ©rations pour accÃ©der Ã  la valeur d&amp;rsquo;une clÃ© json.&lt;/p&gt;&#xA;&lt;p&gt;Par ailleurs, il est obligÃ© de dÃ©compresser les donnÃ©es dans le toast pour y accÃ©der. NÃ©anmoins, on peut aussi jouer avec le paramÃ¨tre &lt;code&gt;toast_tuple_target&lt;/code&gt; pour pousser plus&#xA;d&amp;rsquo;informations dans le toast. Ainsi, dans certains cas, cela peut permettre de rÃ©duire la quantitÃ© de donnÃ©es lues en Ã©vitant de lire le toast.&lt;/p&gt;&#xA;&lt;h1 id=&#34;bonus&#34;&gt;Bonus&lt;/h1&gt;&#xA;&lt;p&gt;Comment souvent dans Postgres, tout Ã©volue au fil des versions. Le TOAST n&amp;rsquo;Ã©chappe pas Ã  cette rÃ¨gle.&#xA;Ainsi, quelques nouveautÃ©s pourraient apparaitre dans les prochaines versions :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Un premier patch a Ã©tÃ© proposÃ© pour avoir plus de statistiques sur le toast : &lt;a href=&#34;https://commitfest.postgresql.org/37/3457/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pg_stat_toast&lt;/a&gt;.&#xA;L&amp;rsquo;idÃ©e, est d&amp;rsquo;avoir des statistiques sur la compression : gain compression, stockage inline ou sÃ©parÃ© dans le toast&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;Un second patch appelÃ© &lt;a href=&#34;https://commitfest.postgresql.org/37/3490/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pluggable toaster&lt;/a&gt;. Celui-ci est beaucoup plus important. Il propose d&amp;rsquo;Ã©tendre le &lt;em&gt;&amp;ldquo;toaster&amp;rdquo;&lt;/em&gt;.&#xA;L&amp;rsquo;idÃ©e serait de pouvoir proposer diffÃ©rents &lt;em&gt;&amp;ldquo;toaster&amp;rdquo;&lt;/em&gt; selon le type de donnÃ©e (notamment le JSONB).&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Voir &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/access/heap/heaptoast.c;h=55bbe1d584760a849960871296dfbdd7447b2b67;hb=refs/heads/REL_14_STABLE#l160&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;heap_toast_insert_or_update&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:2&#34;&gt;&#xA;&lt;p&gt;Il existe deux algorithmes de compression supportÃ©s : &lt;em&gt;pglz&lt;/em&gt; (historique et intÃ©grÃ© dans Postgres) et &lt;em&gt;lz4&lt;/em&gt; (depuis Postgres 14).&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Pour &lt;em&gt;pglz&lt;/em&gt;, voir &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/include/common/pg_lzcompress.h;h=3e53fbe97bd0a10e3fbf7ed4396924084f657868;hb=refs/heads/REL_14_STABLE#l25&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGLZ_Strategy&lt;/a&gt;&#xA;et &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/common/pg_lzcompress.c;h=a30a2c2eb83a71725754d8dd680621a02e7557e9;hb=refs/heads/REL_14_STABLE#l223&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;strategy_default_data&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;Pour &lt;em&gt;lz4&lt;/em&gt;, il s&amp;rsquo;agit d&amp;rsquo;une librarie externe. Voir &lt;a href=&#34;https://github.com/lz4/lz4/blob/dev/lib/lz4.h#L145&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LZ4_compress_default&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:3&#34;&gt;&#xA;&lt;p&gt;Voir les slides de la confÃ©rence d&amp;rsquo;Oleg Bartunov et Nikita Glukhov : &lt;a href=&#34;http://www.sai.msu.su/~megera/postgres/talks/jsonb-nizhny-2021.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;json or not json that is the question&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Cas d&#39;usages du partitionnement natif dans PostgreSQL</title>
    <updated>2021-09-01T07:00:00Z</updated>
    <id>tag:blog.anayrat.info,2021-09-01:/2021/09/01/cas-dusages-du-partitionnement-natif-dans-postgresql/</id>
    <link href="https://blog.anayrat.info/2021/09/01/cas-dusages-du-partitionnement-natif-dans-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;AprÃ¨s une pÃ©riode d&amp;rsquo;inactivitÃ©, je reprends l&amp;rsquo;Ã©criture d&amp;rsquo;articles techniques sur Postgres. C&amp;rsquo;est aussi pour moi l&amp;rsquo;occasion de vous annoncer mon changement d&amp;rsquo;activitÃ©. Depuis courant 2021 je suis passÃ© freelance pour permettre aux entreprises de bÃ©nÃ©ficier de mon expÃ©rience sur Postgres.&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#histoire-du-partitionnement-dans-postgresql&#34;&gt;Histoire du partitionnement dans PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#erreurs-courantes&#34;&gt;Erreurs courantes&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#il-faut-partitionner-dÃ¨s-que-la-volumÃ©trie-est-importante&#34;&gt;&amp;ldquo;Il faut partitionner dÃ¨s que la volumÃ©trie est importante&amp;rdquo;&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#il-faut-partitionner-pour-rÃ©partir-les-donnÃ©es-sur-plusieurs-disques&#34;&gt;&amp;ldquo;Il faut partitionner pour rÃ©partir les donnÃ©es sur plusieurs disques&amp;rdquo;&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#cas-dusages-du-partitionnement&#34;&gt;Cas d&amp;rsquo;usages du partitionnement&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-gÃ©rer-la-rÃ©tention&#34;&gt;Partitionner pour gÃ©rer la rÃ©tention&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-contrÃ´ler-la-fragmentation-des-index&#34;&gt;Partitionner pour contrÃ´ler la fragmentation des index&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-faciliter-lexÃ©cution-de-requÃªte-lorsque-la-cardinalitÃ©-est-faible&#34;&gt;Partitionner pour faciliter l&amp;rsquo;exÃ©cution de requÃªte lorsque la cardinalitÃ© est faible&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-obtenir-de-meilleures-statistiques&#34;&gt;Partitionner pour obtenir de meilleures statistiques&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionwise-join--partitionwise-aggregate&#34;&gt;partitionwise join &amp;amp; partitionwise aggregate&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#stockage-avec-tiering&#34;&gt;Stockage avec tiering&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#conclusion&#34;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;histoire-du-partitionnement-dans-postgresql&#34;&gt;Histoire du partitionnement dans PostgreSQL&lt;/h1&gt;&#xA;&lt;p&gt;PostgreSQL permet depuis trÃ¨s longtemps de partitionner des tables en exploitant l&amp;rsquo;hÃ©ritage de table. Toutefois, cette mÃ©thode Ã©tait assez lourde Ã  mettre en oeuvre : elle impliquait de mettre en place soi-mÃªme des triggers pour rediriger les Ã©critures (moins performant que le partitionnement natif), le temps de planification pouvait augmenter fortement au-delÃ  d&amp;rsquo;une centaine de partitions&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Le partitionnement natif est arrivÃ© avec la version 10. C&amp;rsquo;est depuis cette version que le moteur est capable (entre autres) de diriger lui-mÃªme les Ã©critures vers les bonnes tables, lire seulement les tables concernÃ©es, d&amp;rsquo;utiliser des algorithmes exploitant le partitionnement etc.&#xA;Il offre ainsi de meilleures performances et une facilitÃ© d&amp;rsquo;exploitation. On peut entre autres :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Partitionner :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Par liste&lt;/li&gt;&#xA;&lt;li&gt;Par hashage&lt;/li&gt;&#xA;&lt;li&gt;Par intervalles&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Faire des partitionnements Ã  plusieurs niveaux&lt;/li&gt;&#xA;&lt;li&gt;Partitionner sur plusieurs colonnes&lt;/li&gt;&#xA;&lt;li&gt;Utiliser des clÃ©s primaires et clÃ©s Ã©trangÃ¨res&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Toutes ces fonctionnalitÃ©s sont intÃ©ressantes, mais on en vient Ã  se poser une question toute bÃªte : quand mettre en oeuvre le partitionnement?&lt;/p&gt;&#xA;&lt;p&gt;Je vais vous prÃ©senter plusieurs cas d&amp;rsquo;usages que j&amp;rsquo;ai pu rencontrer. Mais avant, voici quelques erreurs courantes sur le partitionnement.&lt;/p&gt;&#xA;&lt;h1 id=&#34;erreurs-courantes&#34;&gt;Erreurs courantes&lt;/h1&gt;&#xA;&lt;h2 id=&#34;il-faut-partitionner-dÃ¨s-que-la-volumÃ©trie-est-importante&#34;&gt;&amp;ldquo;Il faut partitionner dÃ¨s que la volumÃ©trie est importante&amp;rdquo;&lt;/h2&gt;&#xA;&lt;p&gt;DÃ©jÃ , qu&amp;rsquo;est-ce qu&amp;rsquo;une volumÃ©trie &amp;ldquo;importante&amp;rdquo;?&lt;/p&gt;&#xA;&lt;p&gt;Certains diront que c&amp;rsquo;est au-delÃ  de plusieurs centaines de Go, d&amp;rsquo;autres au-delÃ  du tÃ©raoctet, d&amp;rsquo;autres encore au-delÃ  du pÃ©taoctet&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Il n&amp;rsquo;existe pas vraiment de rÃ©ponse Ã  cette question et globalement Ã§a va dÃ©pendre du type d&amp;rsquo;activitÃ© : ratio INSERT/UPDATE/DELETE, type de SELECT (OLTP, OLAP&amp;hellip;).&#xA;Ca dÃ©pendra Ã©galement du matÃ©riel. Il y a 10 ans, quand les serveurs n&amp;rsquo;avaient que quelques Go de RAM avec des disques mÃ©caniques, il Ã©tait probable qu&amp;rsquo;une base de quelques centaines de Go soit perÃ§ue comme une grosse base.&#xA;Maintenant il n&amp;rsquo;est pas rare de voir des serveurs avec plus d&amp;rsquo;un tÃ©raoctet de RAM, des disques NVMe.&lt;/p&gt;&#xA;&lt;p&gt;Ainsi, une base de quelques centaines de Go n&amp;rsquo;est plus considÃ©rÃ©e comme une grosse base. Mais plutÃ´t comme une base de taille modeste.&lt;/p&gt;&#xA;&lt;p&gt;Petite anecdote, pour se rassurer, un client m&amp;rsquo;a questionnÃ© si Postgres Ã©tait dÃ©jÃ  utilisÃ© pour des volumÃ©tries &amp;ldquo;importantes&amp;rdquo;. On parlait alors d&amp;rsquo;une base d&amp;rsquo;une quarantaine de Go sur un serveur qui disposait de 64Go de RAM. Toutes les lectures se faisaient depuis le cache&amp;hellip; :). J&amp;rsquo;ai pu le rassurer sur la taille de sa base qui Ã©tait relativement modeste.&lt;/p&gt;&#xA;&lt;p&gt;Il peut tout Ã  fait Ãªtre superflu de partitionner une base de quelques To comme il peut Ãªtre nÃ©cessaire de partitionner une base de quelques centaines de Go. Par exemple, si l&amp;rsquo;activitÃ© consiste juste Ã  ajouter des lignes Ã  des tables et que les requÃªtes se rÃ©sument Ã  de simple &lt;code&gt;WHERE colonne = 4&lt;/code&gt; qui retournent quelques lignes. Un simple Btree fera l&amp;rsquo;affaire. Et si la requÃªte retourne un nombre assez important de lignes, il est possible d&amp;rsquo;utiliser les index BRIN ou les bloom filter.&lt;/p&gt;&#xA;&lt;p&gt;Les index BRIN prÃ©sentent des bÃ©nÃ©fices proches du partitionnement ou sharding en Ã©vitant la complexitÃ© de mise en oeuvre&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;il-faut-partitionner-pour-rÃ©partir-les-donnÃ©es-sur-plusieurs-disques&#34;&gt;&amp;ldquo;Il faut partitionner pour rÃ©partir les donnÃ©es sur plusieurs disques&amp;rdquo;&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;idÃ©e serait de crÃ©er des partitions et des tablespaces sur diffÃ©rents disques afin de rÃ©partir les opÃ©rations d&amp;rsquo;entrÃ©es/sorties.&lt;/p&gt;&#xA;&lt;p&gt;Pour PostgreSQL, un tablespace n&amp;rsquo;est ni plus, ni moins qu&amp;rsquo;un chemin vers un rÃ©pertoire. Il est tout Ã  fait possible&#xA;de gÃ©rer le stockage au niveau du systÃ¨me d&amp;rsquo;exploitation et d&amp;rsquo;agrÃ©ger plusieurs disques (en RAID10) par exemple.&#xA;Ensuite, il suffit de stocker la table sur le volume crÃ©Ã©. Ainsi, on peut rÃ©partir les I/O sur un ensemble de disques.&lt;/p&gt;&#xA;&lt;p&gt;Dans ce cas, il n&amp;rsquo;est donc pas nÃ©cessaire de mettre en oeuvre le partitionnement. Toutefois, nous verrons un cas oÃ¹ il pourrait avoir du sens.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant nous allons nous intÃ©resser Ã  des cas d&amp;rsquo;usage &amp;ldquo;lÃ©gitimes&amp;rdquo; du partitionnement.&lt;/p&gt;&#xA;&lt;h1 id=&#34;cas-dusages-du-partitionnement&#34;&gt;Cas d&amp;rsquo;usages du partitionnement&lt;/h1&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-gÃ©rer-la-rÃ©tention&#34;&gt;Partitionner pour gÃ©rer la rÃ©tention&lt;/h2&gt;&#xA;&lt;p&gt;A cause du modÃ¨le MVCC, la suppression massive de donnÃ©es entraine de la fragmentation dans les tables.&lt;/p&gt;&#xA;&lt;p&gt;Un cas d&amp;rsquo;usage possible est de partitionner par date. Supprimer les anciennes donnÃ©es revient Ã  supprimer une partition complÃ¨te. L&amp;rsquo;opÃ©ration sera rapide et les tables ne seront pas fragmentÃ©es&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-contrÃ´ler-la-fragmentation-des-index&#34;&gt;Partitionner pour contrÃ´ler la fragmentation des index&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;ajout et modification de donnÃ©es dans une table fragmente les index au fil du temps. Pour faire simple, on ne peut pas rÃ©cupÃ©rer l&amp;rsquo;espace libre dans un bloc tant qu&amp;rsquo;il n&amp;rsquo;est pas vide. Avec le temps les splits d&amp;rsquo;index crÃ©ent du &amp;ldquo;vide&amp;rdquo; dans ce dernier et le seul moyen de rÃ©cupÃ©rer cet espace est de reconstruire l&amp;rsquo;index.&lt;/p&gt;&#xA;&lt;p&gt;On appelle cela le &amp;ldquo;bloat&amp;rdquo;. Il y a eu de nombreuses amÃ©liorations sur les derniÃ¨res versions de Postgres:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 12, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/12/release-12.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Improve performance and space utilization of btree indexes with many duplicates (Peter Geoghegan, Heikki Linnakangas)&lt;/p&gt;&#xA;&lt;p&gt;Previously, duplicate index entries were stored unordered within their duplicate groups. This caused overhead during index inserts, wasted space due to excessive page splits, and it reduced VACUUM&amp;rsquo;s ability to recycle entire pages. Duplicate index entries are now sorted in heap-storage order.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 13, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;More efficiently store duplicates in B-tree indexes (Anastasia Lubennikova, Peter Geoghegan)&lt;/p&gt;&#xA;&lt;p&gt;This allows efficient B-tree indexing of low-cardinality columns by storing duplicate keys only once. Users upgrading with pg_upgrade will need to use REINDEX to make an existing index use this feature.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 14, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/14/release-14.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Allow btree index additions to remove expired index entries to prevent page splits (Peter Geoghegan)&lt;/p&gt;&#xA;&lt;p&gt;This is particularly helpful for reducing index bloat on tables whose indexed columns are frequently updated.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;Pour contrÃ´ler le bloat, on pourrait reconstruire l&amp;rsquo;index Ã  intervalles rÃ©guliers (merci &lt;code&gt;REINDEX CONCURRENTLY&lt;/code&gt; arrivÃ© en version 12). Cette solution serait contraignante, car il faudrait rÃ©guliÃ¨rement reconstruire l&amp;rsquo;intÃ©gralitÃ© de l&amp;rsquo;index.&lt;/p&gt;&#xA;&lt;p&gt;Si la majoritÃ© des modifications sont faites sur les donnÃ©es rÃ©centes, par exemple: table de logs, commandes clients, rendez-vous&amp;hellip; On pourrait imaginer un partitionnement par mois. Ainsi, Ã  chaque dÃ©but de mois on part sur une table &amp;ldquo;neuve&amp;rdquo; et on peut rÃ©-indexer la prÃ©cÃ©dente table pour supprimer le bloat.&lt;/p&gt;&#xA;&lt;p&gt;On peut aussi en profiter pour faire un &lt;code&gt;CLUSTER&lt;/code&gt; sur la table pour avoir une bonne corrÃ©lation des donnÃ©es avec le stockage.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-faciliter-lexÃ©cution-de-requÃªte-lorsque-la-cardinalitÃ©-est-faible&#34;&gt;Partitionner pour faciliter l&amp;rsquo;exÃ©cution de requÃªte lorsque la cardinalitÃ© est faible&lt;/h2&gt;&#xA;&lt;p&gt;Petit Ã  petit on va voir des cas d&amp;rsquo;usages un peu plus compliquÃ©s :)&lt;/p&gt;&#xA;&lt;p&gt;Prenons un exemple : une table de commande comprenant un statut de livraison, au bout de quelques annÃ©es 99% des commandes sont livrÃ©es (on l&amp;rsquo;espÃ¨re!) et trÃ¨s peu en cours de paiement ou livraison.&lt;/p&gt;&#xA;&lt;p&gt;Imaginons qu&amp;rsquo;on souhaite rÃ©cupÃ©rer 100 commandes en cours de livraison. On va crÃ©er un index sur le statut et l&amp;rsquo;utiliser pour rÃ©cupÃ©rer les enregistrements.&#xA;En Ã©tant un peu astucieux, on peut crÃ©er un index partiel sur ce statut particulier. ProblÃ¨me, cet index va se fragmenter assez vite au fur et Ã  mesure que les commandes seront livrÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Dans ce cas on pourrait faire un partitionnement sur le statut. Ainsi, rÃ©cupÃ©rer 100 commandes en cours de livraison revient Ã  lire 100 enregistrements de la partition.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-obtenir-de-meilleures-statistiques&#34;&gt;Partitionner pour obtenir de meilleures statistiques&lt;/h2&gt;&#xA;&lt;p&gt;Pour dÃ©terminer le meilleur plan d&amp;rsquo;exÃ©cution, Postgres prend des dÃ©cisions Ã  partir des statistiques d&amp;rsquo;une table. Ces statistiques sont obtenues Ã  partir d&amp;rsquo;un Ã©chantillon de la table (le &lt;code&gt;default_statistic_target&lt;/code&gt; qui vaut 100 par dÃ©faut).&lt;/p&gt;&#xA;&lt;p&gt;Par dÃ©faut le moteur va collecter 300 x &lt;code&gt;default_statistic_target&lt;/code&gt; lignes, soit 30 000 lignes. Avec une table de plusieurs centaines de millions de lignes, cet Ã©chantillon est parfois trop petit.&lt;/p&gt;&#xA;&lt;p&gt;On peut augmenter de maniÃ¨re drastique la taille de l&amp;rsquo;Ã©chantillon, mais cette approche prÃ©sente quelques inconvÃ©nients:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ca alourdis le temps de planification&lt;/li&gt;&#xA;&lt;li&gt;Ca alourdis le &lt;code&gt;ANALYZE&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Parfois ce n&amp;rsquo;est pas suffisant si les donnÃ©es sont mal rÃ©parties. Par exemple si on prend quelques centaines de milliers de lignes sur une table qui comprend plusieurs centaines de millions, on peut rater les lignes dont le statut est en livraison.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Avec le partitionnement on pourrait avoir un mÃªme Ã©chantillon, mais par partition, ce qui permet de gagner en prÃ©cision.&lt;/p&gt;&#xA;&lt;p&gt;Ce serait Ã©galement utile quand on a des donnÃ©es corrÃ©lÃ©es entre colonnes. Je vais reprendre l&amp;rsquo;exemple des commandes. On a une annÃ©e entiÃ¨re de commandes: toutes les commandes qui ont plus d&amp;rsquo;un mois sont livrÃ©es, celles du dernier mois sont livrÃ©es Ã  90% (10% sont en cours de livraison).&lt;/p&gt;&#xA;&lt;p&gt;Intuitivement, si je cherche une commande en cours de livraison il y a plus de 6 mois je ne devrais pas avoir de rÃ©sultat. Inversement, si je cherche des commandes en cours de livraison sur le dernier mois, je devrais obtenir 10% de la table. Or, le moteur ne le sait pas, pour lui les commandes en cours de livraison sont rÃ©parties sur toute la table.&lt;/p&gt;&#xA;&lt;p&gt;Avec un partitionnement par date, il peut estimer qu&amp;rsquo;il n&amp;rsquo;y a pas de commande en cours de livraisons de plus d&amp;rsquo;un mois. Ce type d&amp;rsquo;approche permet surtout de rÃ©duire une erreur d&amp;rsquo;estimation dans un plan d&amp;rsquo;exÃ©cution.&lt;/p&gt;&#xA;&lt;p&gt;Voici un exemple avec cette table de commandes, &lt;code&gt;orders_p&lt;/code&gt; est la version partitionnÃ©e par mois de la table &lt;code&gt;orders&lt;/code&gt;. Les donnÃ©es Ã©tant identiques dans les deux tables.&lt;/p&gt;&#xA;&lt;p&gt;On peut remarquer que l&amp;rsquo;estimation est bien meilleure dans le cas oÃ¹ la table est partitionnÃ©e, le moteur ayant des statistiques par partition.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_13_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_13&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;42&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;120&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;059&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;---------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;44&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3978&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Removed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100161&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;188&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;141&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;571&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Maintenant prenons la mÃªme requÃªte sur le dernier mois:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;43&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2417&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;19215&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20931&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;297&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;618&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;44&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15008&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20931&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Removed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;79230&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;146&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;326&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Ici aussi on peut remarquer que l&amp;rsquo;estimation est meilleure.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionwise-join--partitionwise-aggregate&#34;&gt;partitionwise join &amp;amp; partitionwise aggregate&lt;/h2&gt;&#xA;&lt;p&gt;Un autre intÃ©rÃªt du partitionnement est de bÃ©nÃ©ficier de meilleurs algorithmes pour les jointures et agrÃ©gation.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;code&gt;partitionwise aggregate&lt;/code&gt; permet de faire une agregation ou un regroupement partition par partition. Un exemple vaut mieux qu&amp;rsquo;un long discours:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;508361&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;508365&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Append&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;408317&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20008890&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20000000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45308&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;131708&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;576&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5273&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;217&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enable_partitionwise_aggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Append&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;408343&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;83&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1765&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60013&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60013&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;37&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45308&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;174455&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;174455&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;131708&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;461&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4669&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;315&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;63&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Dans le premier cas l&amp;rsquo;agrÃ©gation se fait une fois pour toutes les tables, alors que dans le second exemple, on fait l&amp;rsquo;agrÃ©gation par partition.&#xA;On peut Ã©galement remarquer que le coÃ»t total est infÃ©rieur dans le plan avec agrÃ©gation par partition.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;code&gt;partitionwise join&lt;/code&gt; fonctionne sur le mÃªme principe, on fait une jointure partition par partition. C&amp;rsquo;est utile pour joindre deux tables partitionnÃ©es.&lt;/p&gt;&#xA;&lt;h2 id=&#34;stockage-avec-tiering&#34;&gt;Stockage avec tiering&lt;/h2&gt;&#xA;&lt;p&gt;Enfin, un autre cas d&amp;rsquo;usage serait de vouloir stocker une partie de la table sur un stockage diffÃ©rent:&lt;/p&gt;&#xA;&lt;p&gt;On peut stocker une table partitionnÃ©e dans des tablespaces diffÃ©rents. Par exemple les donnÃ©es rÃ©centes sur un tablespace rapide sur SSD NVMe.&#xA;Puis les donnÃ©es plus rarement accÃ©dÃ©es sur un autre tablespace, avec des disques mÃ©caniques moins couteux.&lt;/p&gt;&#xA;&lt;p&gt;Cette approche peut aussi avoir du sens Ã  l&amp;rsquo;heure du cloud oÃ¹ le stockage est trÃ¨s onÃ©reux.&lt;/p&gt;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;VoilÃ , je pense avoir fait le tour des principaux cas d&amp;rsquo;usages qui me venaient en tÃªte.&lt;/p&gt;&#xA;&lt;p&gt;Evidemment, la mise en oeuvre du partitionnement implique une plus grande complexitÃ© (gestion des partitions&amp;hellip;)&#xA;et des limitations qu&amp;rsquo;il faudra Ã©tudier en amont.&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;&amp;ldquo;BRIN indexes provide similar benefits to horizontal partitioning or sharding but without needing to explicitly declare partitions.&amp;rdquo; - &lt;a href=&#34;https://en.wikipedia.org/wiki/Block_Range_Index&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://en.wikipedia.org/wiki/Block_Range_Index&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity</title>
    <updated>2020-03-08T05:33:26Z</updated>
    <id>tag:rjuju.github.io,2020-03-08:/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html</id>
    <content type="html">&lt;h3 id=&#34;nouvelle-colonne-leader_pid-dans-la-vue-pg_stat_activity&#34;&gt;Nouvelle colonne leader_pid dans la vue pg_stat_activity&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ã‰tonnamment, depuis que les requÃªtes parallÃ¨les ont Ã©tÃ© ajoutÃ©es dans&#xA;PostgreSQL 9.6, il Ã©tait impossible de savoir Ã  quel processus client Ã©tait liÃ©&#xA;un worker parallÃ¨le.  Ainsi, comme &lt;a href=&#34;https://twitter.com/g_lelarge/status/1209486212190343168&#34;&gt;Guillaume lâ€™a fait&#xA;remarquer&lt;/a&gt;, it makes&#xA;il est assez difficile de construire des outils simples permettant&#xA;dâ€™Ã©chantillonner les Ã©vÃ©nements dâ€™attente liÃ©s Ã  tous les processus impliquÃ©s&#xA;dans une requÃªte.  Une solution simple Ã  ce problÃ¨me est dâ€™exporter&#xA;lâ€™information de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;lock group leader&lt;/code&gt; disponible dans le processus client au&#xA;niveau SQL :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit b025f32e0b5d7668daec9bfa957edf3599f4baa8&#xA;Author: Michael Paquier &amp;lt;michael@paquier.xyz&amp;gt;&#xA;Date:   Thu Feb 6 09:18:06 2020 +0900&#xA;&#xA;Add leader_pid to pg_stat_activity&#xA;&#xA;This new field tracks the PID of the group leader used with parallel&#xA;query.  For parallel workers and the leader, the value is set to the&#xA;PID of the group leader.  So, for the group leader, the value is the&#xA;same as its own PID.  Note that this reflects what PGPROC stores in&#xA;shared memory, so as leader_pid is NULL if a backend has never been&#xA;involved in parallel query.  If the backend is using parallel query or&#xA;has used it at least once, the value is set until the backend exits.&#xA;&#xA;Author: Julien Rouhaud&#xA;Reviewed-by: Sergei Kornilov, Guillaume Lelarge, Michael Paquier, Tomas&#xA;Vondra&#xA;Discussion: https://postgr.es/m/CAOBaU_Yy5bt0vTPZ2_LUM6cUcGeqmYNoJ8-Rgto+c2+w3defYA@mail.gmail.com&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Avec cette modification, il est maintenant trÃ¨s simple de trouver tous les&#xA;processus impliquÃ©s dans une requÃªte parallÃ¨le.  Par exemple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;array_agg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_activity&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;GROUP&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;       &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-------------------+------------+---------------&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;mi&#34;&gt;31630&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32269&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32268&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Attention toutefois, comme indiquÃ© dans le message de commit, si la colonne&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;leader_pid&lt;/code&gt; Ã  la mÃªme valeur que la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pid&lt;/code&gt;, cela ne veut pas forcÃ©ment&#xA;dire que le processus client est actuellement en train dâ€™effectuer une requÃªte&#xA;parallÃ¨le, car une fois que le champ est positionnÃ© il nâ€™est jamais&#xA;rÃ©initialisÃ©.  De plus, pour Ã©viter tout surcoÃ»t, aucun verrou supplÃ©mentaire&#xA;nâ€™est maintenu lors de lâ€™affichage de ces donnÃ©es.  Cela veut dire que chaque&#xA;ligne est traitÃ©e indÃ©pendamment.  Ainsi, bien que cela soit fort peu probable,&#xA;vous pouvez obtenir des donnÃ©es incohÃ©rentes dans certaines circonstances,&#xA;comme par exemple un worker paralÃ¨lle pointant vers un pid qui est dÃ©jÃ &#xA;dÃ©connectÃ©.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html&#34;&gt;Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on March 08, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>pgÂ qualstats 2: Suggestion d&#39;index globale</title>
    <updated>2020-01-06T12:23:29Z</updated>
    <id>tag:rjuju.github.io,2020-01-06:/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html</id>
    <content type="html">&lt;p&gt;Parvenir Ã  une suggestion dâ€™index de qualitÃ© peut Ãªtre une tÃ¢che complexe.&#xA;Cela nÃ©cessite Ã  la fois une connaissance des requÃªtes applicatives et des&#xA;spÃ©cificitÃ©s de la base de donnÃ©es.  Avec le temps de nombreux projets ont&#xA;essayÃ© de rÃ©soudre ce problÃ¨me, lâ€™un dâ€™entre eux Ã©tant &lt;a href=&#34;https://powa.readthedocs.io/&#34;&gt;PoWA version&#xA;3&lt;/a&gt;, avec lâ€™aide de &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_qualstats.html&#34;&gt;pg_qualstats&#xA;extension&lt;/a&gt;.&#xA;Cet outil donne de plutÃ´t bonnes suggestions dâ€™index, mais il est nÃ©cessaire&#xA;dâ€™installer et configurer PoWA, alors que certains utilisateurs aimeraient&#xA;nâ€™avoir que la suggestion dâ€™index globale.  Pour rÃ©pondre Ã  ce besoin de&#xA;simplicitÃ©, lâ€™algorithme utilisÃ© dans PoWA est maintenant disponible dans&#xA;pg_qualstats version 2, sans avoir besoin dâ€™utiliser des composants&#xA;additionnels.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;EDIT: La fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_qualstats_index\_advisor()&lt;/code&gt; a Ã©tÃ© changÃ©e pour retourner&#xA;du &lt;strong&gt;json&lt;/strong&gt; plutÃ´t que du &lt;strong&gt;jsonb&lt;/strong&gt;, afin de conserver la compatibilitÃ© avec PostgreSQL&#xA;9.3.  Les requÃªtes dâ€™exemples sont donc Ã©galement modifiÃ©es pour utiliser&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;json_array_elements()&lt;/code&gt; plutÃ´t que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;jsonb_array_elements()&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;quest-ce-que-pg_qualstats&#34;&gt;Quâ€™est-ce que pg_qualstats&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une maniÃ¨re simple dâ€™expliquer ce quâ€™est pg_qualstats serait de dire quâ€™il&#xA;sâ€™agit dâ€™une extension similaire Ã &#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/pgstatstatements.html&#34;&gt;pg_stat_statements&lt;/a&gt;&#xA;mais travaillant au niveaux des prÃ©dicats.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette extension sauvegarde des statistiques utiles pour les clauses &lt;strong&gt;WHERE&lt;/strong&gt;&#xA;et &lt;strong&gt;JOIN&lt;/strong&gt; : Ã  quelle table et quelle colonne un prÃ©dicat fait rÃ©fÃ©rÃ©nce, le&#xA;nombre de fois quâ€™un prÃ©dicat a Ã©tÃ© utilisÃ©, le nombre dâ€™exÃ©cutions de&#xA;lâ€™opÃ©rateur sous-jacent, si le prÃ©dicat provient dâ€™un parcours dâ€™index ou non,&#xA;la sÃ©lectivitÃ©, la valeur des constantes et bien plus encore.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est possible de dÃ©duire beaucoup de choses depuis ces informations.  Par&#xA;exemple, si vous examinez les prÃ©dicats qui contiennent des rÃ©fÃ©rences Ã  des&#xA;tables diffÃ©rentes, vous pouvez trouver quelles tables sont jointes ensembles,&#xA;et Ã  quel point les conditions de jointures sont sÃ©lectives.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;suggestion-globale-&#34;&gt;Suggestion Globale ?&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Comment je lâ€™ai mentionnÃ©, la suggestion dâ€™index globale ajoutÃ©e dans&#xA;pg_qualstats 2 utilise la mÃªme approche que celle de PoWA, ainsi cet article&#xA;peut servir Ã  dÃ©crire le fonctionnement des deux outils.  La seule diffÃ©rence&#xA;est que vous obtiendrez probablement une suggestion de meilleure qualitÃ© avec&#xA;PoWA, puisque plus de prÃ©dicats seront disponibles, et que vous pourrez&#xA;Ã©galement choisir sur quel intervalle de temps vous souhaitez effectuer une&#xA;suggestion dâ€™index manquants.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La chose importante Ã  retenir ici est quâ€™il sâ€™agit dâ€™une suggestion effectuÃ©e&#xA;de maniÃ¨re &lt;strong&gt;globale&lt;/strong&gt;, câ€™est-Ã -dire en prenant en compte tous les prÃ©dicats&#xA;intÃ©ressant en mÃªme temps.  Cette approche est diffÃ©rente de toutes les autres&#xA;dont jâ€™ai connaissance, qui ne prennent en compte quâ€™une seule requÃªte Ã  la&#xA;fois.  Selon moi, une approche globale est meilleure, car il est possible de&#xA;rÃ©duire le nombre total dâ€™index, en maximisant lâ€™efficacitÃ© des index&#xA;multi-colonnes.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;comment-marche-la-suggestion-globale&#34;&gt;Comment marche la suggestion globale&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;La premiÃ¨re Ã©tape consiste Ã  rÃ©cupÃ©rer tous les prÃ©dicats qui pourraient&#xA;bÃ©nÃ©ficier de nouveaux index.  Câ€™est particuliÃ¨rement facile Ã  obtenir avec&#xA;pg_qualstats.  En filtrant les prÃ©dicats venant dâ€™un parcours sÃ©quentiel,&#xA;exÃ©cutÃ©s de nombreuses fois et qui filtrent de nombreuses lignes (Ã  la fois en&#xA;nombre et en pourcentage), vous obtenez une liste parfaite de prÃ©dicats qui&#xA;auraient trÃ¨s probablement besoin dâ€™un index (ou alors dans certains cas une&#xA;liste des requÃªtes mal Ã©crites).  Voyons regardons par exemple le cas dâ€™une&#xA;applications qui utiliserait ces 4 prÃ©dicats:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_1_quals.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_1_quals.png&#34; alt=&#34;Liste de tous les prÃ©dicats&#xA;trouvÃ©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, il faut construire lâ€™ensemble entier des chemins de toutes les&#xA;prÃ©dicats joints par un AND logique, qui contiennent dâ€™autres prÃ©dicats, qui&#xA;peuvent Ãªtre eux-meme Ã©galement joints par des AND logiques.  En utilisants les&#xA;mÃªme 4 prÃ©dicats vus prÃ©cÃ©demments, nous obtenons ces chemins :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_2_graphs.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_2_graphs.png&#34; alt=&#34;Construction de tous les chemins de prÃ©dicats&#xA;possibles&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois tous les chemins construits, il suffit dâ€™obtenir le meilleur chemin&#xA;pour trouver le meilleur index Ã  suggÃ©rer.  Le classement de ces chemins est&#xA;pour le moment fait en donnant un poids Ã  chaque nÅ“ud de chaque chemin qui&#xA;correspond au nombre de prÃ©dicats simple quâ€™il contient, et en additionnant le&#xA;poids pour chaque chemin.  Câ€™est une approche trÃ¨s simple, et qui permet de&#xA;favoriser un nombre minimal dâ€™index qui optimisent le plus de requÃªtes&#xA;possible.  Avec nos exemple, nous obtenons :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_3_weighted.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_3_weighted.png&#34; alt=&#34;Ajout d&#39;un poids Ã  tous les chemins et choix du score le plus&#xA;haut&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, dâ€™autres approches de classement pourraient Ãªtre utilisÃ©e pour&#xA;prendre en compte dâ€™autres paramÃ¨tres, et potentiellement obtenir une meilleur&#xA;suggestion.  Par exemple, en prenant en compte Ã©galement le nombre dâ€™exÃ©cution&#xA;ou la sÃ©lectivitÃ© des prÃ©dicats.  Si le ratio de lecture/Ã©criture pour chaque&#xA;table est connu (ce qui est disponible avec lâ€™extension&#xA;&lt;a href=&#34;https://github.com/powa-team/powa-archivist&#34;&gt;powa-archivist&lt;/a&gt;), il serait&#xA;Ã©galement possible dâ€™adapter le classement pour limiter la suggestion dâ€™index&#xA;pour les tables qui ne sont accÃ©dÃ©es presque exclusivement en Ã©criture.  Avec&#xA;cet algorithme, ces ajustements seraient relativement simples Ã  faire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois que le meilleur chemin est trouvÃ©, on peut gÃ©nÃ©rer lâ€™ordre de crÃ©ation&#xA;de lâ€™index !  Comme lâ€™ordre des colonnes peut Ãªtre important, lâ€™ordre est&#xA;gÃ©nÃ©rÃ© en rÃ©cupÃ©rant les colonnes de chaque nÅ“ud par poids croissant.  Avec&#xA;notre exemple, lâ€™index suivant est gÃ©nÃ©rÃ© :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Une fois que lâ€™index est trouvÃ©, on supprime simplement les prÃ©dicats contenus&#xA;de la liste globale de prÃ©dicats et on reprendre de zÃ©ro jusquâ€™Ã  ce quâ€™il nâ€™y&#xA;ait plus de prÃ©dicats.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;un-peu-plus-de-dÃ©tails-et-mise-en-garde&#34;&gt;Un peu plus de dÃ©tails et mise en garde&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, il sâ€™agit ici dâ€™une version simplifiÃ©e de lâ€™algorithme de&#xA;suggestion, car dâ€™autres informations sont nÃ©cessaires.  Par exemple, la liste&#xA;des prÃ©dicats est en rÃ©alitÃ© ajustÃ©e avec les &lt;a href=&#34;https://www.postgresql.org/docs/current/indexes-opclass.html&#34;&gt;classes dâ€™opÃ©rateurs et mÃ©thode&#xA;dâ€™acces&lt;/a&gt; en&#xA;fonction du type de la colonne et de sont opÃ©rateur, afin de sâ€™assurer&#xA;dâ€™obtenir des index valides.  Si plusieurs mÃ©thodes dâ€™accÃ¨s aux index sont&#xA;trouvÃ©es pour un mÃªme meilleur chemin, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;btree&lt;/code&gt; sera choisi en prioritÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cela nous amÃ¨ne Ã  un autre dÃ©tail : cette approche est principalement pensÃ©e&#xA;pour les index &lt;strong&gt;btree&lt;/strong&gt;, pour lesqules lâ€™ordre des colonnes est critiques.&#xA;Dâ€™autres mÃ©thodes dâ€™accÃ¨s ne requiÃ¨rent pas un ordre spÃ©cifique pour les&#xA;colonnes, et pour ces mÃ©thodes dâ€™accÃ¨s il est possible quâ€™une suggestion plus&#xA;optimale soit possible si lâ€™ordre des colonnes nâ€™Ã©tait pas pris en compte.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un autre point important est que les classes dâ€™opÃ©rateurs et mÃ©thodes dâ€™accÃ¨s&#xA;ne sont pas gÃ©rÃ©s en dur mais rÃ©cupÃ©rÃ©s Ã  lâ€™exÃ©cution en utilisant les&#xA;catalogues locaux.  Par consÃ©quent, vous pouvez obtenir des rÃ©sultats&#xA;diffÃ©rents (et potentiellement meilleurs) si vous faites en sorte dâ€™avoir&#xA;toutes les classes dâ€™opÃ©rateur additionelles disponibles quand vous utilisez la&#xA;suggestion dâ€™index globale.  Cela pourrait Ãªtre les extensions &lt;strong&gt;btree_gist&lt;/strong&gt;&#xA;et &lt;strong&gt;btree_gist&lt;/strong&gt;, mais Ã©galement dâ€™autres mÃ©thodes dâ€™accÃ¨s aux index.  Il est&#xA;Ã©galement possible que certain types / opÃ©rateurs nâ€™aient pas de mÃ©thode&#xA;dâ€™accÃ¨s associÃ©e dans les catalogues.  Dans ce cas, ces prÃ©dicats sont&#xA;retournÃ©es sÃ©parÃ©ment dans une liste de prÃ©dicats non optimisables&#xA;automatiquement, et pour lequel une analyse manuelle est nÃ©cessaire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Enfin, comme pg_qualstats ne traite pas les prÃ©dicats composÃ©s dâ€™expressions,&#xA;lâ€™outil ne peut pas suggÃ©rer dâ€™index sur des expressions, par exemple en cas&#xA;dâ€™utilisateur de recherche plein texte.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;exemple-dutilisation&#34;&gt;Exemple dâ€™utilisation&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une simple fonction est fournie, avec des paramÃ¨tres facultatifs, qui retourne&#xA;une valeur de type json :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_selectivity&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;forbidden_am&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;{}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Les noms de paramÃ¨tres sont parlants :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_filter&lt;/code&gt;: combien de lignes le prÃ©dicat doit-il filtrer en moyenne pour&#xA;Ãªtre pris en compte par la suggestion globale, par dÃ©faut &lt;strong&gt;1000&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_selectivity&lt;/code&gt;: quelle doit Ãªtre la sÃ©lectivitÃ© moyenne dâ€™un prÃ©dicat&#xA;pour quâ€™il soit pris en compte par la suggestion globale, par dÃ©faut&#xA;&lt;strong&gt;30%&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;forbidden_am&lt;/code&gt;: liste des mÃ©thodes dâ€™accÃ¨s aux index Ã  ignorer.  Aucune par&#xA;dÃ©faut, bien que pour les version 9.6 et infÃ©rieures &lt;strong&gt;les index hash sont&#xA;ignorÃ© en interne&lt;/strong&gt;, puisque ceux-ci ne sont sur que depuis la version 10.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple simple, tirÃ©s des tests de non rÃ©gression de pg_qualstats :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;a&#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;line &#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ILIKE&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;moh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Et voici ce que la fonction retourne :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;indexes&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;                               &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------------------------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (id1)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (val, id1, id2, id3)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.pgqs USING btree (id)&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;unoptimised&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;        &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;adv.val ~~* ?&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/&#34;&gt;version 2 de pg_qualstats&lt;/a&gt;&#xA;nâ€™est pas encore disponible en version stable, mais nâ€™hÃ©sitez pas Ã  la tester&#xA;et &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/issues&#34;&gt;rapporter tout problÃ¨me que vous pourriez&#xA;rencontrer&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html&#34;&gt;pgÂ qualstats 2: Suggestion d&#39;index globale&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on January 06, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: Nouveau daemon powa-collector</title>
    <updated>2019-12-10T18:54:17Z</updated>
    <id>tag:rjuju.github.io,2019-12-10:/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie dâ€™une sÃ©rie dâ€™article sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et dÃ©crit le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-daemon-powa-collector&#34;&gt;Nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ce daemon remplace le prÃ©cÃ©dent &lt;em&gt;background worker&lt;/em&gt; lorsque le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;mode&#xA;remote&lt;/a&gt; est utilisÃ©.&#xA;Il sâ€™agit dâ€™un simple daemon Ã©crit en python, qui sâ€™occupera de toutes les&#xA;Ã©tapes nÃ©cessaires pour effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;.  Il est &lt;a href=&#34;https://pypi.org/project/powa-collector/&#34;&gt;disponible&#xA;sur pypi&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme je lâ€™ai expliquÃ© dans mon &lt;a href=&#34;/postgresql/2019/05/17/powa-4-with-remote-mode-beta-is-available.html&#34;&gt;prÃ©cÃ©dent article introduistant PoWA 4&lt;/a&gt;, ce&#xA;daemon est nÃ©cessaire  pour la configuration dâ€™un mode remote, en gardant cette&#xA;architecture Ã  lâ€™esprit :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture de PoWA 4 en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Sa configuration est trÃ¨s simple.  Il vous suffit tout simplement de renommer&#xA;le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa-collector.conf.sample&lt;/code&gt; fourni, et dâ€™adapter &lt;a href=&#34;https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING&#34;&gt;lâ€™URI de&#xA;connexion&lt;/a&gt;&#xA;pour dÃ©crire comment se connecter sur votre &lt;em&gt;serveur repository&lt;/em&gt; dÃ©diÃ©, et&#xA;câ€™est fini.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une configuration typique devrait ressembler Ã  :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;{&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;repository&#34;&lt;/span&gt;: {&#xA;        &lt;span class=&#34;s2&#34;&gt;&#34;dsn&#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&#34;postgresql://powa_user@server_dns:5432/powa&#34;&lt;/span&gt;,&#xA;    },&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;debug&#34;&lt;/span&gt;: &lt;span class=&#34;n&#34;&gt;true&lt;/span&gt;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La liste des &lt;em&gt;serveur distants&lt;/em&gt;, leur configuration ainsi que tout le reste qui&#xA;est nÃ©cessaire pour le bon fonctionnement sera automatiquement rÃ©cupÃ©rÃ© depuis&#xA;le &lt;em&gt;serveur repository&lt;/em&gt; que vous ave dÃ©jÃ  configurÃ©.  Une fois dÃ©marrÃ©, il&#xA;dÃ©marrera un thread dÃ©diÃ© par &lt;em&gt;serveur distant&lt;/em&gt; dÃ©clarÃ©, et maintiendra une&#xA;&lt;strong&gt;connexion persistente&lt;/strong&gt; sur ce &lt;em&gt;serveur distant&lt;/em&gt;.  Chaque thread effectuera&#xA;un &lt;em&gt;snapshot distant&lt;/em&gt;, exportant les donnÃ©es sur le &lt;em&gt;serveur repository&lt;/em&gt; en&#xA;utilisant les nouvelles &lt;em&gt;fonctions sources&lt;/em&gt;.  Chaque thread ouvrira et fermera&#xA;une connexion sur le &lt;em&gt;serveur repository&lt;/em&gt; lors de lâ€™exÃ©cution du &lt;em&gt;snapshot&#xA;distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, ce daemon a besoin de pouvoir se connecter sur tous les&#xA;&lt;em&gt;serveurs distants&lt;/em&gt; dÃ©clarÃ©s ainsi que le &lt;em&gt;serveur repository&lt;/em&gt;.  La table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;, qui stocke la liste des &lt;em&gt;serveurs distants&lt;/em&gt;, a un champ pour&#xA;stocker les nom dâ€™utilisateur et mot de passe pour se connecter aux &lt;em&gt;serveur&#xA;distants&lt;/em&gt;.  Stocker un mot de passe en clair dans cette table est une hÃ©rÃ©sie,&#xA;si lâ€™on considÃ¨re lâ€™aspect sÃ©curitÃ©.  Ainsi, comme indiquÃ© dans la&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section sÃ©curitÃ© de&#xA;PoWA&lt;/a&gt;,&#xA;vous pouve stocker un mot de passe NULL et &lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;utiliser Ã  la place nâ€™importe&#xA;laquelle des autres mÃ©thodes dâ€™authentification supportÃ©es par la&#xA;libpq&lt;/a&gt; (fichier&#xA;.pgpass, certificatâ€¦).  Câ€™est trÃ¨s fortement recommandÃ© pour toute&#xA;installation sÃ©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La connexion persistente sur le &lt;em&gt;serveur repository&lt;/em&gt; est utilisÃ©e pour&#xA;superviser la daemon :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;pour vÃ©rifier  que le daemon est bien dÃ©marrÃ©&lt;/li&gt;&#xA;  &lt;li&gt;pour communiquer au travers de lâ€™UI en utilisant un &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/protocol.html&#34;&gt;protocole simple&lt;/a&gt;&#xA;afin dâ€™effectuer des actions diverses (recharger la configuration, vÃ©rifier&#xA;le status dâ€™un thread dÃ©diÃ© Ã  un &lt;em&gt;serveur distant&lt;/em&gt;â€¦)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Il est Ã  noter que vous pouvez Ã©galement demander au daemon de recharger sa&#xA;configuration en envoyant un SIGHUP au processus du daemon.  Un rechargement&#xA;est nÃ©cessaire pour toute modification effectuÃ©e sur la liste des serveurs&#xA;distants (ajout ou suppression dâ€™un &lt;em&gt;serveur distant&lt;/em&gt;, ou mise Ã  jour dâ€™un&#xA;existant).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez Ã©galement noter que, par choix,&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&lt;/a&gt;&#xA;nâ€™effectuera pas de &lt;em&gt;snapshot local&lt;/em&gt;.  Si vous voulez utiliser PoWA pour le&#xA;&lt;em&gt;serveur repository&lt;/em&gt;, il vous faudra activer le &lt;em&gt;background worker&lt;/em&gt; original.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouvelle-page-de-configuration&#34;&gt;Nouvelle page de configuration&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;La page de configuration est maintenant modifiÃ©e pour donner toutes les&#xA;informations nÃ©cessaires sur le status du background worker, le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&#xA;daemon&lt;/a&gt;&#xA;(incluant tous ses threads dÃ©diÃ©s) ainsi que la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;dÃ©clarÃ©s.  Voici un exemple de cette nouvelle page racine de configuration :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_configuration_page.png&#34;&gt;&lt;img src=&#34;/images/powa_4_configuration_page.png&#34; alt=&#34;Nouvelle page de&#xA;configuration&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;est utilisÃ©, le status de chaque serveur distant sera rÃ©cupÃ©rÃ© en utilisant le&#xA;protocole de communication.  Si le collecteur rencontre des erreurs (lors de la&#xA;connexion Ã  un &lt;em&gt;serveur distant&lt;/em&gt;, durant un &lt;em&gt;snapshot&lt;/em&gt; par exemple), celles-ci&#xA;seront Ã©galement affichÃ©es ici.  Ã€ noter Ã©galement que ces erreurs seront&#xA;Ã©galement affichÃ©es en haut de chaque page de toutes les pages de lâ€™UI, afin&#xA;dâ€™Ãªtre sÃ»r de ne pas les rater.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;De plus, la section configuration a maintenant une hiÃ©rarchie, et vous pourrez&#xA;voir la liste des extensions ainsi que la configuration actuelle de PostgreSQL&#xA;pour le serveur &lt;strong&gt;local&lt;/strong&gt; ou &lt;strong&gt;distant&lt;/strong&gt; en cliquant sur le serveur de votre&#xA;choix!&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y a Ã©galement un nouveau bouton &lt;strong&gt;Reload collector&lt;/strong&gt; sur le bandeau&#xA;dâ€™en-tÃªte qui, comme on pourrait sâ€™y attendre, demandera au collecteur de&#xA;recharger sa configuration.  Cela peut Ãªtre utile si vous avez dÃ©clarÃ©s de&#xA;nouveaux serveurs mais nâ€™ave pas dâ€™accÃ¨s au serveur sur lequel le collecteur&#xA;sâ€™exÃ©cute.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette article est le dernier de la sÃ©urie concernant la nouvelle version de&#xA;PoWA.  Il est toujours en beta, nâ€™hÃ©sitez donc pas Ã  le tester, &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;rapporter&#xA;tout bug rencontrÃ©&lt;/a&gt;&#xA;ou donner tout autre retour!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html&#34;&gt;PoWA 4: Nouveau daemon powa-collector&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on December 10, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: nouveautÃ©s dans powa-archivist !</title>
    <updated>2019-06-05T14:26:17Z</updated>
    <id>tag:rjuju.github.io,2019-06-05:/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie dâ€™une sÃ©rie dâ€™article sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et dÃ©crit les changements prÃ©sents dans&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/index.html&#34;&gt;powa-archivist&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus dâ€™information sur cette version 4, vous pouvez consulter &lt;a href=&#34;/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;lâ€™article&#xA;de prÃ©sentation gÃ©nÃ©ral&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;aperÃ§u-rapide&#34;&gt;AperÃ§u rapide&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Tout dâ€™abord, il faut savoir quâ€™il nâ€™y a pas dâ€™upgrade possible depuis la v3&#xA;vers la v4, il est donc nÃ©cessaire dâ€™effectuer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DROP EXTENSION powa&lt;/code&gt; si vous&#xA;utilisiez dÃ©jÃ  PoWA sur vos serveurs.  Cela est du au fait que la v4 apporte&#xA;&lt;strong&gt;de trÃ¨s nombreux&lt;/strong&gt; changements dans la partie SQL de lâ€™extension, ce qui en&#xA;fait le changement le plus significatif dans la suite PoWA pour cette nouvelle&#xA;version.  Au moment oÃ¹ jâ€™Ã©cris cet article, la quantitÃ© de changements apportÃ©s&#xA;dans cette extension est :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt; CHANGELOG.md       |   14 +&#xA; powa--4.0.0dev.sql | 2075 +++++++++++++++++++++-------&#xA; powa.c             |   44 +-&#xA; 3 files changed, 1629 insertions(+), 504 deletions(-)&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Lâ€™absence dâ€™upgrade ne devrait pas Ãªtre un problÃ¨me en pratique.  PoWA est un&#xA;outil pour analyser les performances, il est fait pour avoir des donnÃ©es avec&#xA;une grande prÃ©cision mais un historique trÃ¨s limitÃ©.  Si vous cherchez une&#xA;solution de supervision gÃ©nÃ©raliste pour conserver des mois de donnÃ©es, PoWA&#xA;nâ€™est dÃ©finitivement pas lâ€™outil quâ€™il vous faut.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;configurer-la-liste-des-serveurs-distants&#34;&gt;Configurer la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;En ce qui concerne les changements Ã  proprement parler, le premier petit&#xA;changement est que le &lt;a href=&#34;https://www.postgresql.org/docs/current/bgworker.html&#34;&gt;background&#xA;worker&lt;/a&gt; nâ€™est plus&#xA;nÃ©cessaire pour le fonctionnement de powa-archivist, car il nâ€™est pas utilisÃ©&#xA;pour le mode distant.  Cela signifie quâ€™un redÃ©marrage de PostgreSQL nâ€™est plus&#xA;nÃ©cessaire pour installer PoWA.  Bien Ã©videmment, un redÃ©marrage est toujours&#xA;nÃ©cessaire si vous souhaitez utiliser le mode local, en utilisant le background&#xA;worker, or si vous voulez installer des extensions additionelles qui&#xA;nÃ©cessitent elles-mÃªme un redÃ©marrage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, comme PoWA requiert un peu de configuration (frÃ©quence des snapshot,&#xA;rÃ©tention des donnÃ©es et ainsi de suite), certaines nouvelles tables sont&#xA;ajouter pour permettre de configurer tout Ã§a.  La nouvelle table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;&#xA;stocke la configuration de toutes les instances distantes dont les donnÃ©es&#xA;doivent Ãªtre stockÃ©es sur cette instance.  Cette &lt;em&gt;instance PoWA locale&lt;/em&gt; est&#xA;appelÃ©e un &lt;strong&gt;serveur repository&lt;/strong&gt; (qui devrait typiquement Ãªtre dÃ©diÃ©e Ã &#xA;stocker des donnÃ©es PoWA), en opposition aux &lt;strong&gt;instances distantes&lt;/strong&gt; qui sont&#xA;les instances que vous voulez monitorer.  Le contenu de cette table est tout ce&#xA;quâ€™il y a de plus simple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_servers&lt;/span&gt;&#xA;                              &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_servers&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                 &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------+----------+-----------+----------+------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;            &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nextval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;powa_servers_id_seq&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regclass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;hostname&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;alias&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;dbname&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;frequency&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;powa_coalesce&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;retention&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;1 day&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Si vous avez dÃ©jÃ  utilisÃ© PoWA, vous devriez reconnaÃ®tre la plupart des options&#xA;de configuration qui sont maintenant stockÃ©es ici.  Les nouvelles options sont&#xA;utilisÃ©es pour dÃ©crire comment se connecter aux &lt;em&gt;instances distances&lt;/em&gt;, et&#xA;peuvent fournir un alias Ã  afficher sur lâ€™UI.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous avez Ã©galement probablement remarquÃ© une colonne &lt;strong&gt;password&lt;/strong&gt;.  Stocker un&#xA;mot de passe en clair dans cette table est une hÃ©rÃ©sie pour nâ€™importe qui&#xA;dÃ©sirant un minimum de sÃ©curitÃ©.  Ainsi, comme mentionnÃ© dans la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section&#xA;sÃ©curitÃ© de la documentation de PoWA&#xA;&lt;/a&gt;,&#xA;vous pouvez stocker NULL pour le champ password et Ã  la place utiliser&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;nâ€™importe laquelle des autres mÃ©thodes dâ€™authentification supportÃ©e par la&#xA;libpq&lt;/a&gt;&#xA;(fichier .pgpass, certificatâ€¦).  Une authentification plus sÃ©curisÃ©e est&#xA;chaudement recommandÃ©e pour toute installation sÃ©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une autre table, la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_snapshot_metas&lt;/code&gt;, est Ã©galement ajoutÃ©e pour&#xA;stocker quelques mÃ©tadonnÃ©es concernant les informations de snapshot pour&#xA;chaque &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;                                   &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_snapshot_metas&#34;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;--------------+--------------------------+-----------+----------+---------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;                  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;coalesce_seq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;snapts&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;aggts&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;purgets&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;errors&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Il sâ€™agit tout simplement dâ€™un compteur pour compter le nombre de snapshots&#xA;effectuÃ©s, un timestamp pour chaque type dâ€™Ã©vÃ©nement survenu (snapshot,&#xA;aggrÃ©gation et purge) et un tableau de chaÃ®ne de caractÃ¨res pour stocker toute&#xA;erreur survenant durant le snapshot, afin que lâ€™UI pour lâ€™afficher.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;api-sql-pour-configurer-les-serveurs-distants&#34;&gt;API SQL pour configurer les &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien que ces tables soient trÃ¨s simples, une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html#configure-powa-and-stats-extensions-on-each-remote-server&#34;&gt;API SQL basique est disponible&#xA;pour dÃ©clarer de nouveaux serveurs et les&#xA;configurer&lt;/a&gt;.&#xA;6 fonctions de bases sont disponibles :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_register_server()&lt;/code&gt;, pour dÃ©clarer un nouveau &lt;em&gt;servuer distant&lt;/em&gt;, ainsi&#xA;que la liste des extensions qui y sont disponibles&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_configure_server()&lt;/code&gt; pour mettre Ã  jour un des paramÃ¨tres pour le&#xA;&lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ© (en utilisant un paramÃ¨tre JSON, oÃ¹ la clÃ© est&#xA;le nom du paramÃ¨tre Ã  changer et la valeur la nouvelle valeur Ã  utiliser)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_server()&lt;/code&gt; pour dÃ©sactiver les snapshots pour le &lt;em&gt;serveur&#xA;distant&lt;/em&gt; spÃ©cifiquÃ© (ce qui concrÃ¨tement positionnera le paramÃ¨tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;frequency&lt;/code&gt; Ã  &lt;strong&gt;-1&lt;/strong&gt;)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_delete_and_purge_server()&lt;/code&gt; pour supprimer le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;spÃ©cifiÃ© de la liste des serveurs et supprimer toutes les donnÃ©es associÃ©es&#xA;aux snapshots&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_activate_extension()&lt;/code&gt;, pour dÃ©clarer quâ€™une nouvelle extension est&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ©&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_extension()&lt;/code&gt;, pour spÃ©cifier quâ€™une extension nâ€™est plus&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Toute action plus compliquÃ©e que Ã§a devra Ãªtre effectuÃ©e en utilisant des&#xA;requÃªtes SQL.  Heureusement, il ne devrait pas y avoir beaucoup dâ€™autres&#xA;besoins, et les tables sont vraiment trÃ¨s simple donc cela ne devrait pas poser&#xA;de soucis.  &lt;a href=&#34;https://github.com/powa-team/powa-archivist/issues&#34;&gt;Nâ€™hÃ©sitez cependant pas Ã  demander de nouvelles&#xA;fonctions&lt;/a&gt; si vous aviez&#xA;dâ€™autres besoins.  Veuillez Ã©galement noter que lâ€™UI ne vous permet pas&#xA;dâ€™appeler ces fonctions, puisque celle-ci est pour le moment &lt;strong&gt;entiÃ¨rement en&#xA;lecture seule&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;effectuer-des-snapshots-distants&#34;&gt;Effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Puisque les mÃ©triques sont maintenant stockÃ©es sur une instance PostgreSQL&#xA;diffÃ©rente, nous avons Ã©normÃ©ment changÃ© la faÃ§on dont les &lt;em&gt;snapshots&lt;/em&gt;&#xA;(rÃ©cupÃ©rer les donnÃ©es fournies par une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extensions&#xA;statistique&lt;/a&gt;&#xA;et les stockÃ©es dans le catalogue PoWA &lt;a href=&#34;/postgresqlfr/2019/04/06/minimiser-le-surcout-de-stockage-par-ligne.html&#34;&gt;de maniÃ¨re Ã  optimiser le stockage&lt;/a&gt;) sont&#xA;effectuÃ©s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La liste de toutes les extensions statistiques, ou &lt;em&gt;sources de donnÃ©es&lt;/em&gt;, qui&#xA;sont disponibles sur un &lt;strong&gt;serveur&lt;/strong&gt; (soit &lt;em&gt;distant&lt;/em&gt; soit &lt;em&gt;local&lt;/em&gt;) et pour&#xA;lesquelles un &lt;em&gt;snapshot&lt;/em&gt; devrait Ãªtre effectuÃ© est stockÃ©e dans une table&#xA;appelÃ©e &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_functions&lt;/code&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;               &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_functions&#34;&lt;/span&gt;&#xA;     &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;----------------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;operation&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;query_source&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;added_manually&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;enabled&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;priority&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Un nouveau champ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;query_source&lt;/code&gt; a Ã©tÃ© rajoutÃ©.  Celui-ci fournit le nom de la&#xA;&lt;em&gt;fonction source&lt;/em&gt;, nÃ©cessaire pour la compatibilitÃ© dâ€™une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extension&#xA;statistique&lt;/a&gt;&#xA;avec les snapshots distants.  Cette fonction est utilisÃ©e pour exporter les&#xA;compteurs fournis par cette extension sur un serveur diffÃ©rent, dans une &lt;em&gt;table&#xA;transitoire&lt;/em&gt; dÃ©diÃ©e.  La fonction de &lt;em&gt;snapshot&lt;/em&gt; effectuera alors le &lt;em&gt;snapshot&lt;/em&gt;&#xA;en utilisant automatiquement ces donnÃ©es exportÃ©es plutÃ´t que celles fournies&#xA;par lâ€™extension statististique locale quand le mode distant est utilisÃ©.  Il&#xA;est Ã  noter que lâ€™export de ces compteurs ainsi que le snapshot distant est&#xA;effectuÃ© automatiquement par le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;que je prÃ©senterai dans un autre article.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple montant comment PoWA effectue un &lt;em&gt;snapshot distant&lt;/em&gt; dâ€™une&#xA;liste de base donnÃ©es.  Comme vous allez le voir, câ€™est trÃ¨s simple ce qui&#xA;signifie quâ€™il est Ã©galement trÃ¨s simple dâ€™ajouter cette mÃªme compatibilitÃ©&#xA;pour une nouvelle extension statistique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;table transitoire&lt;/em&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;   &lt;span class=&#34;n&#34;&gt;Unlogged&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_databases_src_tmp&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Pour de meilleurs performances, toutes les &lt;em&gt;tables transitoires&lt;/em&gt; sont &lt;strong&gt;non&#xA;journalisÃ©es (unlogged)&lt;/strong&gt;, puisque leur contenu nâ€™est nÃ©cessaire que durant un&#xA;&lt;em&gt;snapshot&lt;/em&gt; et sont supprimÃ©es juste aprÃ¨s.  Dans cet examlple, la &lt;em&gt;table&#xA;transitoire&lt;/em&gt; ne stocke que lâ€™identifiant du serveur distant correspondant Ã  ces&#xA;donnÃ©es, lâ€™oid ainsi que le nom de chacune des bases de donnÃ©es prÃ©sentes sur&#xA;le &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Et la &lt;em&gt;fonction source&lt;/em&gt; :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powa_databases_src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SETOF&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_database&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;ELSE&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_databases_src_tmp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Cette fonction retourne simplement le contenu de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; si les donnÃ©es&#xA;locales sont demandÃ©es (lâ€™identifiant de serveur &lt;strong&gt;0&lt;/strong&gt; est toujours le serveur&#xA;local), ou alors le contenu de la &lt;em&gt;table transitoire&lt;/em&gt; pour le serveur distant&#xA;spÃ©cifiÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;fonction de snapshot&lt;/em&gt; peut alors facilement effectuer nâ€™importe quel&#xA;traitement avec ces donnÃ©es pour le &lt;em&gt;serveur distant&lt;/em&gt; voulu.  Dans le cas de la&#xA;fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_databases_snapshot()&lt;/code&gt;, il sâ€™agit simplement de synchroniser la&#xA;liste des bases de donnÃ©es, et de stocker le timestamp de suppression si une&#xA;base de donnÃ©es qui existait prÃ©cÃ©demment nâ€™est plus listÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus de dÃ©tails, vous pouvez consulter la documentation concernant&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/development.html&#34;&gt;lâ€™ajout dâ€™une source de donnÃ©es dans&#xA;PoWA&lt;/a&gt;,&#xA;qui a Ã©tÃ© mise Ã  jour pour les spÃ©cificitÃ©s de la version 4.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html&#34;&gt;PoWA 4: nouveautÃ©s dans powa-archivist !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on June 05, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4 apporte un mode remote, disponible en beta !</title>
    <updated>2019-05-17T11:04:17Z</updated>
    <id>tag:rjuju.github.io,2019-05-17:/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html</id>
    <content type="html">&lt;p&gt;&lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;PoWA 4&lt;/a&gt; est disponible en beta.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-mode-remote-&#34;&gt;Nouveau mode remote !&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau mode remote&lt;/a&gt;&#xA;est la plus grosse fonctionnalitÃ© ajoutÃ©e dans PoWA 4, bien quâ€™il y ait eu&#xA;dâ€™autres amÃ©liorations.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Je vais dÃ©crire ici ce que ce nouveau mode implique ainsi que ce qui a changÃ©&#xA;sur lâ€™&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;UI&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si de plus amples dÃ©tails sur le reste des changements apportÃ©s dans PoWA 4&#xA;vous intÃ©resse, je publierai bientÃ´t dâ€™autres articles sur le sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour les plus pressÃ©s, nâ€™hÃ©sitez pas Ã  aller directement sur la &lt;a href=&#34;https://dev-powa.anayrat.info/&#34;&gt;dÃ©mo v4 de&#xA;PoWA&lt;/a&gt;, trÃ¨s gentiment hÃ©bergÃ©e par &lt;a href=&#34;http://blog.anayrat.info/&#34;&gt;Adrien&#xA;Nayrat&lt;/a&gt;.  Aucun authentification nâ€™est requise,&#xA;cliquez simplement sur â€œLoginâ€.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;pourquoi-un-mode-remote-est-il-important&#34;&gt;Pourquoi un mode remote est-il important&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette fonctionnalitÃ© a probablement Ã©tÃ© la plus frÃ©quemment demandÃ©e depuis que&#xA;PoWA a Ã©tÃ© publiÃ©, en 2014.  Et câ€™est pour de bonnes raisons, car un mode local&#xA;a quelques inconvÃ©nients.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Tout dâ€™abord, voyons comment se prÃ©sentait lâ€™architecture avec les versions 3&#xA;et antÃ©rieures.  Imaginons une instance contenant 2 bases de donnÃ©es (db1 et&#xA;db2), ainsi quâ€™&lt;strong&gt;une base de donnÃ©es dÃ©diÃ©e Ã  PoWA&lt;/strong&gt;.  Cette base de donnÃ©es&#xA;dÃ©diÃ©e contient Ã  la fois les &lt;em&gt;extensions statistiques&lt;/em&gt; nÃ©cessaires pour&#xA;rÃ©cupÃ©rer compteurs de performances actuels ainsi que pour &lt;strong&gt;les stocker&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_local.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_local.svg&#34; alt=&#34;Architecture en mode local&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est dÃ©marrÃ© par PoWA, qui est responsable dâ€™effectuer des &lt;em&gt;snapshots&lt;/em&gt; et de les&#xA;stocker dans la base powa dÃ©diÃ©e Ã  intervalle rÃ©guliers.  Ensuite, en utilisant&#xA;powa-web, vous pouvez consulter lâ€™activitÃ© de nâ€™importe laquelle des bases de&#xA;donnÃ©es &lt;strong&gt;locales&lt;/strong&gt; en effectuant des requÃªtes sur les donnÃ©es stockÃ©es dans la&#xA;base dÃ©diÃ©, et potentiellement en se connectant sur lâ€™une des autres bases de&#xA;donnÃ©es locales lorsque les donnÃ©es complÃ¨tes sont nÃ©cessaires, par exemple&#xA;lorsque lâ€™outil de suggestion dâ€™index est utilisÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec la version 4, lâ€™architecture avec une configuration distante change de&#xA;maniÃ¨re significative:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous pouvez voir quâ€™une base de donnÃ©e powa dÃ©diÃ©e est toujours nÃ©cessaire,&#xA;mais &lt;strong&gt;uniquement pour les extensions statistiques&lt;/strong&gt;.  Les donnÃ©es sont&#xA;maintenant stockÃ©es sur une instance diffÃ©rente.  Ensuite, le &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est remplacÃ© par un &lt;strong&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;nouveau daemon&#xA;collecteur&lt;/a&gt;&lt;/strong&gt;,&#xA;qui lit les mÃ©triques de performance depuis les &lt;em&gt;serveurs distants&lt;/em&gt;, et les&#xA;stocke sur le &lt;em&gt;serveur repository&lt;/em&gt; dÃ©diÃ©.  Powa-web pourra prÃ©senter les&#xA;donnÃ©es en se connectant sur le &lt;em&gt;serveur repository&lt;/em&gt;, ainsi que sur les&#xA;&lt;strong&gt;serveurs distants&lt;/strong&gt; lorsque des donnÃ©es complÃ¨tes sont nÃ©cessaires.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En rÃ©sumÃ©, avec le nouveau mode distant ajoutÃ© dans cette version 4&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;un redÃ©marrage de PostgreSQL nâ€™est plus nÃ©cessaire pour installer&#xA;powa-archivist&lt;/li&gt;&#xA;  &lt;li&gt;il nâ€™y a plus de surcoÃ»t du au fait de stocker et requÃªter les donnÃ©es sur&#xA;le mÃªme serveur PostgreSQL que vos serveurs de productions (il y a toujours&#xA;certaines partie de lâ€™UI qui nÃ©cessitent dâ€™effectuer des requÃªtes sur le&#xA;serveur dâ€™origine, par exemple pour montrer des plans avec EXPLAIN, mais le&#xA;surcoÃ»t est nÃ©gligeable)&lt;/li&gt;&#xA;  &lt;li&gt;il est maintenant possible dâ€™utiliser PoWA sur un &lt;strong&gt;serveur en&#xA;hot-standby&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Lâ€™UI vous accueillera donc maintenant avec une page initiale afin de choisir&#xA;lequel des serveurs stockÃ©s sur la base de donnÃ©es cible vous voulez&#xA;travailler :&#xA;&lt;a href=&#34;/images/powa_4_all_servers.png&#34;&gt;&lt;img src=&#34;/images/powa_4_all_servers.png&#34; alt=&#34;Choix des serveurs&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La principale raison pour laquelle il a fallu tellement de temps pour apporter&#xA;ce mode distant est parce que cela apporte beaucoup de complexitÃ©, nÃ©cessitant&#xA;une rÃ©Ã©criture majeure de PoWA.  Nous voulions Ã©galement ajouter dâ€™abord&#xA;dâ€™autres fonctionnalitÃ©s, comme la &lt;strong&gt;suggestion globale dâ€™index&lt;/strong&gt;, avec une&#xA;&lt;strong&gt;validation grÃ¢ce Ã  &lt;a href=&#34;http://hypopg.readthedocs.io/&#34;&gt;hypopg&lt;/a&gt;&lt;/strong&gt; introduit avec&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/releases/v3.0.0.html&#34;&gt;PoWA 3&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;changements-dans-powa-web&#34;&gt;Changements dans &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;powa-web&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Lâ€™&lt;em&gt;interface graphique&lt;/em&gt; est le composant qui a le plus de changements visibles&#xA;dans cette version 4.  Voici les plus changements les plus importants.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;compatibilitÃ©-avec-le-mode-distant&#34;&gt;CompatibilitÃ© avec le mode distant&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Le changement le plus important est bien Ã©videmment le support pour le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau&#xA;mode remote&lt;/a&gt;.  En&#xA;consÃ©quence, la premiÃ¨re page affichÃ©e est maintenant une page de &lt;strong&gt;sÃ©lection&#xA;de serveur&lt;/strong&gt;, affichant tous les &lt;em&gt;serveurs distants&lt;/em&gt; enregistrÃ©s.  AprÃ¨s avoir&#xA;choisi le &lt;em&gt;serveur distant&lt;/em&gt; voulu (ou le &lt;em&gt;serveur local&lt;/em&gt; si vous nâ€™utilisez pas&#xA;le mode distant), toutes les autres pages seront similaires Ã  celles&#xA;disponibles jusquâ€™Ã  la version 3, mais afficheront les donnÃ©es pour un &lt;em&gt;serveur&#xA;distant&lt;/em&gt; spÃ©cifique uniquement, et bien entendu en rÃ©cupÃ©rant les donnÃ©es&#xA;depuis la &lt;strong&gt;base de donnÃ©es repository&lt;/strong&gt;, avec en plus de nouvelles&#xA;informations dÃ©crites ci-dessous.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez notez que puisque les donnÃ©es sont maintenant stockÃ©es sur un &lt;em&gt;serveur&#xA;repository&lt;/em&gt; dÃ©diÃ© quand le mode remote est utilisÃ©, la majoritÃ© de lâ€™UI est&#xA;utilisable sans se connecter au &lt;em&gt;serveur distant&lt;/em&gt; sÃ©lectionnÃ©.  Toutefois,&#xA;powa-web nÃ©cessite toujours de pouvoir se connecter sur le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;quand les donnÃ©es originales sont nÃ©cessaires (par exemple, pour la suggestion&#xA;dâ€™index ou pour montrer des plans avec &lt;strong&gt;EXPLAIN&lt;/strong&gt;).  Les &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;mÃªmes considÃ©rations&#xA;et possibilitÃ©s concernant&#xA;lâ€™authentification&lt;/a&gt;&#xA;que pour le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&#xA;&lt;/a&gt;&#xA;(qui sera dÃ©crit dans un prochain article) sâ€™appliquent ici.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;pg_track_settings-support&#34;&gt;&lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt; support&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand cette extension est correctement configurÃ©e, un nouveau widget timeline&#xA;apparaÃ®tra, placÃ© entre chaque graph et son aperÃ§u, affichant diffÃ©rents types&#xA;de changements enregistrÃ©s si ceux-ci ont Ã©tÃ© dÃ©tectÃ©s sur lâ€™intervalle de&#xA;temps sÃ©lectionnÃ©.  Sur les pages par base de donnÃ©es et par requÃªte, la liste&#xA;sera Ã©galement filtrÃ©e en fonction de la base de donnÃ©es sÃ©lectionnÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La mÃªme timeline sera affichÃ©e sur chacun des graphs de chacune des pages, afin&#xA;de facilement vÃ©rifier si ces changements ont eu un impact visible en utilisant&#xA;les diffÃ©rents graphs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez noter que les dÃ©tails des changements sont affichÃ©s au survol de la&#xA;souris.  Vous pouvez Ã©galement cliquer sur nâ€™importe lequel des Ã©vÃ©nements de&#xA;la timeline pour figer lâ€™affichage, et tracer une ligne verticale sur le graph&#xA;associÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple dâ€™un tel changement de configuration en action :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_track_settings_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_track_settings_powa4.png&#34; alt=&#34;Changements de configuration dÃ©tectÃ©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez Ã©galement noter quâ€™il est nÃ©cessaire dâ€™avoir au minimum la version&#xA;2.0.0 de &lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt;, et&#xA;que lâ€™extension doit Ãªtre installÃ©e &lt;strong&gt;Ã  la fois sur les &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;ainsi que sur le &lt;em&gt;serveur repository&lt;/em&gt;.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouveaux-graphs-disponibles&#34;&gt;Nouveaux graphs disponibles&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_stat_kcache.html&#34;&gt;pg_stat_kcache&lt;/a&gt;&#xA;est configurÃ©, ses informations nâ€™Ã©taient auparavant affichÃ©es que sur la page&#xA;par requÃªte.  Les informations sont maintenant Ã©galement affichÃ©es sur les&#xA;pages par serveur et par base, dans deux nouveaux graphs :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;dans le graph &lt;strong&gt;Block Access&lt;/strong&gt;, oÃ¹ les mÃ©triques &lt;strong&gt;OS cache&lt;/strong&gt; et &lt;strong&gt;disk&#xA;read&lt;/strong&gt; remplaceront la mÃ©trique &lt;strong&gt;read&lt;/strong&gt;&lt;/li&gt;&#xA;  &lt;li&gt;dans un nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; (qui est Ã©galement ajoutÃ© dans&#xA;la page &lt;em&gt;par requÃªte&lt;/em&gt;), montrant les &lt;a href=&#34;/postgresql/2018/07/17/pg_stat_kcache-2-1-is-out.html&#34;&gt;metrics ajoutÃ©es dans pg_stat_kcache&#xA;2.1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un example de ce nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34; alt=&#34;Ressources systÃ¨me&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y avait Ã©galement un graph &lt;strong&gt;Wait Events&lt;/strong&gt; (disponible quand &lt;a href=&#34;https://powa.readthedocs.io/en/v4/components/stats_extensions/pg_wait_sampling.html&#34;&gt;lâ€™extension&#xA;pg_wait_sampling&lt;/a&gt;&#xA;est configuÃ©e) disponible uniquement sur la page par requÃªte.  Ce graph est&#xA;maintenant disponible sur les pages par serveur et par base Ã©galement.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;documentation-des-mÃ©triques-et-liens-vers-la-documentation&#34;&gt;Documentation des mÃ©triques et liens vers la documentation&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certaines mÃ©triques affichÃ©es sur lâ€™interface sont assez parlante, mais&#xA;certaines autres peuvent Ãªtre un peu obscures.  Jusquâ€™Ã  maintenant, il nâ€™y&#xA;avait malheureusement aucune documentation pour les mÃ©triques.  Le problÃ¨me est&#xA;maintenant rÃ©glÃ©, et tous les graphs ont une &lt;em&gt;icÃ´ne dâ€™information&lt;/em&gt;, qui&#xA;affichent une description des mÃ©triques utilisÃ©e dans le graph au survol de la&#xA;souris.  Certains graphs incluent Ã©galement un lien vers la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;documentation PoWA&#xA;de extension&#xA;statistiques&lt;/a&gt;&#xA;pour les utilisateurs qui dÃ©sirent en apprendre plus Ã  leur sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_metrics_doc.png&#34;&gt;&lt;img src=&#34;/images/powa_4_metrics_doc.png&#34; alt=&#34;Documentation des mÃ©triques&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;et-des-correctifs-de-bugs-divers&#34;&gt;Et des correctifs de bugs divers&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certains problÃ¨mes de longues dates ont Ã©galement Ã©tÃ© rapportÃ©s :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;la boÃ®te affichÃ©e au survol dâ€™un graph montant les valeurs des mÃ©triques&#xA;avait une position verticale incorrecte&lt;/li&gt;&#xA;  &lt;li&gt;la sÃ©lection temporelle en utilisant lâ€™aperÃ§u des graphs ne montrait pas un&#xA;aperÃ§u correct aprÃ¨s avoir appliquÃ© la sÃ©lection&lt;/li&gt;&#xA;  &lt;li&gt;les erreurs lors de la crÃ©ation dâ€™index hypothÃ©tiques ou dans certains cas&#xA;leur affichage nâ€™Ã©tait pas correctement gÃ©rÃ©s sur plusieurs pages&lt;/li&gt;&#xA;  &lt;li&gt;les filtres des tableaux nâ€™Ã©tait pas rÃ©appliquÃ©s quand lâ€™intervalle de&#xA;temps sÃ©lectionnÃ© Ã©tait changÃ©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Si un de ces problÃ¨mes vous a un jour posÃ© problÃ¨me, vous serez ravi&#xA;dâ€™apprendre quâ€™ils sont maintenant tous corrigÃ©s !&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette 4Ã¨me version de PoWA reprÃ©sente un temps de dÃ©veloppement trÃ¨s important,&#xA;de nombreuses amÃ©liorations sur la documentation et beaucoup de tests.  Nous&#xA;somme maintenant assez satisfaits, mais il est possible que nous ayons ratÃ©s&#xA;certains bugs.  Si vous vous intÃ©ressez Ã  ce projet, jâ€™espÃ¨re que vous&#xA;essaierez de tester cette beta, et si besoin nâ€™hÃ©sitez pas Ã  &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;nous remonter un&#xA;bug&lt;/a&gt;!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;PoWA 4 apporte un mode remote, disponible en beta !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on May 17, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>NouveautÃ© pg12: Statistiques sur les erreurs de checkums</title>
    <updated>2019-04-18T11:02:26Z</updated>
    <id>tag:rjuju.github.io,2019-04-18:/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html</id>
    <content type="html">&lt;h3 id=&#34;data-checksums&#34;&gt;Data checksums&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;AjoutÃ©s dans &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=96ef3b8ff1c&#34;&gt;PostgreSQL&#xA;9.3&lt;/a&gt;,&#xA;les &lt;a href=&#34;https://www.postgresql.org/docs/current/app-initdb.html#APP-INITDB-DATA-CHECKSUMS&#34;&gt;data&#xA;checksums&lt;/a&gt;&#xA;peuvent aider Ã  dÃ©tecter les corruptions de donnÃ©es survenant sur votre&#xA;stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les checksums sont activÃ©s si lâ€™instance a Ã©tÃ© initialisÃ©e en utilisant &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&#xA;--data-checksums&lt;/code&gt; (ce qui nâ€™est pas le comportement par dÃ©faut), ou sâ€™ils ont&#xA;Ã©tÃ© activÃ©s aprÃ¨s en utilisant la nouvelle utilitaire&#xA;activated afterwards with the new&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/devel/app-pgchecksums.html&#34;&gt;pg_checksums&lt;/a&gt;&#xA;Ã©galement &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=ed308d783790&#34;&gt;ajoutÃ© dans PostgreSQL&#xA;12&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Quand les checksums sont ativÃ©s, ceux-ci sont Ã©crits Ã  chaque fois quâ€™un bloc&#xA;de donnÃ©es est Ã©crit sur disque, et vÃ©rifiÃ©s Ã  chaque fois quâ€™un bloc est lu&#xA;depuis le disque (ou depuis le cache du systÃ¨me dâ€™exploitation).  Si la&#xA;vÃ©rification Ã©choue, une erreur est remontÃ©e dans les logs.  Si le bloc Ã©tait&#xA;lu par un processus client, la requÃªte associÃ©e Ã©chouera bien Ã©videmment, mais&#xA;si le bloc Ã©tait lu par une opÃ©ration&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;&#xA;(tel que pg_basebackup), la commande continuera Ã  sâ€™exÃ©cuter.  Bien que les&#xA;data checksums ne dÃ©tecteront quâ€™un sous ensemble des problÃ¨mes possibles, ils&#xA;ont tout de mÃªme une certaine utilisÃ©, surtout si vous ne faites pas confiance&#xA;Ã  votre stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Jusquâ€™Ã  PostgreSQL 11, les erreurs de validation de checksum ne pouvaient Ãªtre&#xA;trouvÃ©es quâ€™en cherchant dans les logs, ce qui nâ€™est clairement pas pratique si&#xA;vous voulez monitorer de telles erreurs.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveaux-compteurs-disponibles-dans-pg_stat_database&#34;&gt;Nouveaux compteurs disponibles dans pg_stat_database&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour rendre la supervision des erreurs de checksum plus simple, et pour aider&#xA;les utilisateurs Ã  rÃ©agir dÃ¨s quâ€™un tel problÃ¨me survient, PostgreSQL 12 ajoute&#xA;de nouveaux compteurs dans la vue &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 6b9e875f7286d8535bff7955e5aa3602e188e436&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Sat Mar 9 10:45:17 2019 -0800&#xA;&#xA;Track block level checksum failures in pg_stat_database&#xA;&#xA;This adds a column that counts how many checksum failures have occurred&#xA;on files belonging to a specific database. Both checksum failures&#xA;during normal backend processing and those created when a base backup&#xA;detects a checksum failure are counted.&#xA;&#xA;Author: Magnus Hagander&#xA;Reviewed by: Julien Rouhaud&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 77bd49adba4711b4497e7e39a5ec3a9812cbd52a&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Fri Apr 12 14:04:50 2019 +0200&#xA;&#xA;    Show shared object statistics in pg_stat_database&#xA;&#xA;    This adds a row to the pg_stat_database view with datoid 0 and datname&#xA;    NULL for those objects that are not in a database. This was added&#xA;    particularly for checksums, but we were already tracking more satistics&#xA;    for these objects, just not returning it.&#xA;&#xA;    Also add a checksum_last_failure column that holds the timestamptz of&#xA;    the last checksum failure that occurred in a database (or in a&#xA;    non-dataabase file), if any.&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 252b707bc41cc9bf6c55c18d8cb302a6176b7e48&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Wed Apr 17 13:51:48 2019 +0200&#xA;&#xA;    Return NULL for checksum failures if checksums are not enabled&#xA;&#xA;    Returning 0 could falsely indicate that there is no problem. NULL&#xA;    correctly indicates that there is no information about potential&#xA;    problems.&#xA;&#xA;    Also return 0 as numbackends instead of NULL for shared objects (as no&#xA;    connection can be made to a shared object only).&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;    Reviewed-by: Robert Treat &amp;lt;rob@xzilla.net&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces compteurs reflÃ¨teront les erreurs de validation de checksum Ã  la fois pour&#xA;les processus clients et pour lâ€™activitÃ©&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;,&#xA;par base de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;rjuju&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_database&lt;/span&gt;&#xA;                        &lt;span class=&#34;k&#34;&gt;View&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;pg_catalog.pg_stat_database&#34;&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------------+--------------------------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datid&lt;/span&gt;                 &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;                      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;                     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_failures&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_last_failure&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;stats_reset&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_failures&lt;/code&gt; montrera un nombre cumulÃ© dâ€™erreurs, et la&#xA;colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_last_failure&lt;/code&gt; montrera lâ€™horodatage de la derniÃ¨re erreur de&#xA;validation sur la base de donnÃ©es (NULL si aucune erreur nâ€™est jamais&#xA;survenue).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour Ã©viter toute confusion (merci Ã  Robert Treat pour lâ€™avoir signalÃ©), ces&#xA;deux colonnes retourneront toujours NULL si les data checkums ne sont pas&#xA;activÃ©s, afin quâ€™on ne puisse pas croire que les checksums sont toujours&#xA;vÃ©rifiÃ©s avec succÃ¨s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme effet de bord, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt;  montrera maintenant Ã©galement les&#xA;statistiques disponibles pour les objets partagÃ©s (tels que la table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; par exemple), dans une nouvelle ligne pour laquelle &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datid&lt;/code&gt; vaut&#xA;&lt;strong&gt;0&lt;/strong&gt;, et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datname&lt;/code&gt; vaut &lt;strong&gt;NULL&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;del&gt;Une sonde dÃ©diÃ©e est Ã©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/issues/226&#34;&gt;dÃ©jÃ &#xA;planifiÃ©e&lt;/a&gt; dans&#xA;&lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/del&gt;&#xA;Une sonde dÃ©diÃ©e est Ã©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/commit/0e8b516e95e4364470d4e205aebc9fe68bbcfd23&#34;&gt;dÃ©jÃ &#xA;disponible&lt;/a&gt;&#xA;dans &lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html&#34;&gt;NouveautÃ© pg12: Statistiques sur les erreurs de checkums&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on April 18, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>Mettre en place une streaming replication avec PostgreSQL 10</title>
    <updated>2018-03-13T06:28:00Z</updated>
    <id>tag:blog.raveland.tech,2018-03-13:/post/postgresql_sr_fr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_sr_fr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Dans ce post, je vais vous expliquer comment mettre en place une &lt;em&gt;streaming replication&lt;/em&gt; avec PostgreSQL 10. Par contre, je n&amp;rsquo;expliquerais pas comment installer PostgreSQL donc je suppose que cela est dÃ©jÃ  le cas.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>OpenBSD / PostgreSQL / Authentification</title>
    <updated>2017-11-29T11:31:53Z</updated>
    <id>tag:blog.raveland.tech,2017-11-29:/post/openbsd_pg/</id>
    <link href="https://blog.raveland.tech/post/openbsd_pg/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Si vous Ãªtes un utilisateur d&amp;rsquo;OpenBSD et de PostgreSQL, vous pouvez utiliser l&amp;rsquo;authentification BSD pour vous authentifier sur vos bases.&#xA;Nous allons voir comment faire cela.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>Postgresql et la rÃ©plication logique</title>
    <updated>2017-11-27T08:32:06Z</updated>
    <id>tag:blog.raveland.tech,2017-11-27:/post/postgresql_lr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_lr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cet article va tester la nouvelle fonctionnalitÃ© disponible depuis PostgreSQL 10.0 : la rÃ©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Pour en savoir plus, l&amp;rsquo;excellente &lt;a href=&#34;https://docs.postgresql.fr/10/logical-replication.html&#34;&gt;documentation de PostgreSQL&lt;/a&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
</feed>