<?xml version="1.0" encoding="UTF-8"?><feed xmlns="http://www.w3.org/2005/Atom">
  <title>PlanÃ¨te PostgreSQL</title>
  <id>https://planete.postgresql.fr/</id>
  <updated>2025-05-24T16:40:23Z</updated>
  <subtitle>L&#39;actualitÃ© de PostgreSQL de franÃ§ais</subtitle>
  <link href="https://planete.postgresql.fr/"></link>
  <author>
    <name>PostgreSQL.fr</name>
    <email>contact@postgresql.fr</email>
  </author>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #8 - Importer des bases de donnÃ©es</title>
    <updated>2025-05-19T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-05-19://2025/05/19/cnpg-8.html</id>
    <link href="https://blog.dalibo.com//2025/05/19/cnpg-8.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 19 mai 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;CloudNativePG&lt;/strong&gt; ou comment embarquer un Ã©lÃ©phant sur un porte-conteneurs !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si vous envisagez dâ€™utiliser CloudNativePG pour dÃ©ployer certaines de vos&#xA;instances PostgreSQL, vous aurez sÃ»rement besoin de rapatrier certaines bases de&#xA;donnÃ©es dans ces nouvelles instances. DiffÃ©rentes techniques existent. Regardons&#xA;deux mÃ©thodes dâ€™import que propose lâ€™opÃ©rateur ğŸ“¥.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;specbootstrapinitdbimport&#34;&gt;spec.bootstrap.initdb.import&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.bootstrap.initdb.import&lt;/code&gt; est &lt;strong&gt;LA&lt;/strong&gt; section YAML qui nous intÃ©resse dans la&#xA;dÃ©finition de notre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;. La section &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.bootstrap.initdb&lt;/code&gt; permet de&#xA;dÃ©finir comment notre instance va Ãªtre crÃ©Ã©e. La partie &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;import&lt;/code&gt;permet de dÃ©finir&#xA;quelle(s) base(s) de donnÃ©e(s) doi(ven)t Ãªtre importÃ©e(s). On parle bien ici&#xA;dâ€™imports logiques de bases qui existeraient dÃ©jÃ  dans une autre instance&#xA;PostgreSQL. Cette instance doit dâ€™ailleurs Ãªtre accessible par la nouvelle&#xA;instance qui sera crÃ©Ã©e par CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Deux mÃ©thodes dâ€™import existent :&lt;/p&gt;&#xA;&#xA;&lt;ol&gt;&#xA;  &lt;li&gt;la mÃ©thode &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;microservice&lt;/code&gt; ğŸ“¦;&lt;/li&gt;&#xA;  &lt;li&gt;et la mÃ©thode &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;monolith&lt;/code&gt; ğŸª¨.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&lt;p&gt;La premiÃ¨re mÃ©thode ne vous permet dâ€™importer les donnÃ©es que dâ€™une seule base.&#xA;Ses donnÃ©es seront importÃ©es dans la base par dÃ©faut de lâ€™instance (donc &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;app&lt;/code&gt;).&#xA;Si vous souhaitez conserver le mÃªme nom de base, nâ€™oubliez pas de modifier le&#xA;paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.bootstrap.initdb.database&lt;/code&gt; de la dÃ©finition du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;. Cette&#xA;mÃ©thode dâ€™import est intÃ©ressante si vous souhaitez diviser une instance&#xA;multi-bases en plusieurs instances mono-base.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La seconde mÃ©thode vous permet dâ€™importer autant de bases que vous le souhaitez&#xA;ainsi que des rÃ´les PostgreSQL qui seraient existant dans lâ€™instance source.&#xA;Câ€™est trÃ¨s pratique si vous souhaitez faire une migration complÃ¨te de votre&#xA;instance. Petite astuce, vous pouvez utiliser le caractÃ¨re &lt;em&gt;wildcard&lt;/em&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;*&lt;/code&gt; pour&#xA;signifier que vous voulez importer toutes les bases ou tous les rÃ´les.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Quelque soit la mÃ©thode utilisÃ©e, lâ€™utilitaire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_dump&lt;/code&gt; est utilisÃ© pour&#xA;rÃ©cupÃ©rer les donnÃ©es de la base et crÃ©er un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dump&lt;/code&gt; dans le volume associÃ© Ã  la&#xA;nouvelle instance. Attention donc Ã  lâ€™espace de stockage lors du dÃ©clenchement&#xA;de lâ€™import ğŸ–´.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme jâ€™aime Ã  le dire, des exemples valent souvent mieux que de longs discours.&#xA;Prenons donc le cas dâ€™un service &lt;em&gt;Recherche et DÃ©veloppement&lt;/em&gt; qui aurait Ã  sa&#xA;disposition trois bases de donnÃ©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rd_a&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rd_b&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rd_c&lt;/code&gt; dans une mÃªme&#xA;instance.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;import-en-mode-microservice&#34;&gt;Import en mode &lt;em&gt;microservice&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Dans cet exemple, seule la base de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rd_a&lt;/code&gt; va Ãªtre importÃ©e car&#xA;lâ€™Ã©quipe considÃ¨re que les autres ne seront pas utilisÃ©es. En mode&#xA;&lt;em&gt;microservices&lt;/em&gt;, une seule base peut Ãªtre importÃ©e dans lâ€™instance.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Construisons notre fichier YAML pas Ã  pas. Tout dâ€™abord, le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; se basera&#xA;sur une image en version 17.0 et il nâ€™y aura pas de rÃ©plication mise en place.&#xA;Restons simple et ne touchons pas Ã  la configuration de lâ€™instance.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql-rda&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Il nous faut ensuite ajouter la section &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.bootstrap.initdb.import&lt;/code&gt; Ã  cette&#xA;dÃ©finition de notre nouveau &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;. On en profite au passage pour dÃ©finir le&#xA;nom de la base oÃ¹ seront importÃ©es les donnÃ©es (pour cet exemple, il nâ€™est plus&#xA;question dâ€™utiliser de tiret bas prÃ©sent dans lâ€™ancien nom), le propriÃ©taire de&#xA;celle-ci et activer les sommes de contrÃ´le (une bonne pratique ğŸª„!) sur lâ€™instance.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;pi&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;]&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;initdb&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;rda&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;monrole&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dataChecksums&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;microservice&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;databases&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;rd_a&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;externalCluster&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;old-rd-pg&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La partie &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;import&lt;/code&gt; contient les informations de la base Ã  importer, notamment :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;son nom, dans la liste &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;databases&lt;/code&gt;;&lt;/li&gt;&#xA;  &lt;li&gt;et oÃ¹ la trouver avec le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;source&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;source&lt;/code&gt; contient le nom dâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;externalCluster&lt;/code&gt; qui fait rÃ©fÃ©rence&#xA;Ã  la dÃ©finition de lâ€™instance PostgreSQL externe dÃ©crite dans ce mÃªme YAML, dont&#xA;voici le contenu :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;pi&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;]&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;externalClusters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;old-rd-pg&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;connectionParameters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;51.159.74.201&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;dbname&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgres&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;5432&#34;&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;local-pg-secret&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;password&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On y retrouve trÃ¨s logiquement les informations de connexions (ip, port,&#xA;utilisateur, â€¦) et Ã©galement le mot de passe associÃ© au compte &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dalibo&lt;/code&gt; qui se&#xA;trouve Ãªtre le propriÃ©taire de la base &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rd_a&lt;/code&gt;. Le mot de passe doit Ãªtre&#xA;renseignÃ© dans un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Secret&lt;/code&gt;. Cela permet Ã  lâ€™opÃ©rateur de le rÃ©cupÃ©rer sans&#xA;devoir le renseigner en clair.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici la dÃ©finition du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Secret&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Secret&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ZGFsaWJvCg==&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;local-pg-secret&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;kubernetes.io/basic-auth&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le fichier YAML complet du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; est donc le suivant :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql-rda&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;initdb&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;rda&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;monrole&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;dataChecksums&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;microservice&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;databases&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;rd_a&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;externalCluster&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;old-rd-pg&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;externalClusters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;old-rd-pg&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;connectionParameters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;51.159.74.201&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;dbname&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgres&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;5432&#34;&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;local-pg-secret&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;password&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Il ne reste plus quâ€™Ã  appliquer ce fichier pour crÃ©er notre instance.&#xA;Automatiquement, CloudNativePG va crÃ©er le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;dump&lt;/code&gt;Â dans un dossier du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PGDATA&lt;/code&gt;&#xA;puis, lorsquâ€™il sera crÃ©Ã©, dÃ©butera la restauration avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_restore&lt;/code&gt;. VÃ©rifiez&#xA;quâ€™il ait suffisamment dâ€™espace de stockage.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;import-en-mode-monolith&#34;&gt;Import en mode &lt;em&gt;monolith&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;La deuxiÃ¨me solution possible est lâ€™import ditÂ &lt;em&gt;monolith&lt;/em&gt; qui permet dâ€™importer&#xA;une ou plusieurs base de donnÃ©es ainsi que un ou plusieurs rÃ´les dans une mÃªme&#xA;instance.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;âš ï¸ Faites attention au point suivant qui peut avoir son importance ! âš ï¸&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veillez Ã  utiliser un rÃ´le qui puisse accÃ©der Ã  tous ces objets. Par exemple,&#xA;lâ€™import des rÃ´les se fait en rÃ©cupÃ©rant les informations depuis la vue&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_catalog.pg_authid&lt;/code&gt;. Utilisez donc un rÃ´le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SUPERUSER&lt;/code&gt; qui a le droit dâ€™y&#xA;accÃ©derâ€¦ autrement :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;ERROR: permission denied for table pg_authid (SQLSTATE 42501)&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Jâ€™imagine dÃ©jÃ  des cas oÃ¹ cela pourrait poser problÃ¨me, notamment avec&#xA;les offres PostgreSQL managÃ©es qui ne donnent gÃ©nÃ©ralement pas accÃ¨s Ã  des rÃ´les&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SUPERUSER&lt;/code&gt; ğŸ˜. Des rÃ´les prÃ©dÃ©finis commeÂ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_read_all_data&lt;/code&gt; pourraient vous&#xA;aider dans ce cas lÃ .&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ceci Ã©tant dit, regardons un exemple de YAML.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;cluster-monolith&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;initdb&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;monolith&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;databases&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;rd_a&lt;/span&gt;&#xA;          &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;rd_c&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;          &lt;span class=&#34;na&#34;&gt;externalCluster&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;local-pg&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;externalClusters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;local-pg&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;connectionParameters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;51.159.74.201&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;dalibo&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;dbname&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgres&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;15834&#34;&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;local-pg-secret&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;password&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Peu dâ€™Ã©lÃ©ments changent par rapport Ã  lâ€™import de type &lt;em&gt;microservice&lt;/em&gt;.&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;import.type&lt;/code&gt; est passÃ© Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;monolith&lt;/code&gt; et une liste de bases est renseignÃ©e.&#xA;Ici, seules les bases &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rda&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rdc&lt;/code&gt; vont Ãªtre rÃ©cupÃ©rÃ©es, nos collÃ¨gues&#xA;estimant inutiles de rÃ©cupÃ©rer &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;rdb&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;versions-diffÃ©rentes&#34;&gt;Versions diffÃ©rentes&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Je ne vous ai pas tout dit !&#xA;La version de lâ€™instance source Ã©tait la version 16.8. Les instances crÃ©Ã©es avec&#xA;CloudNativePG se basent quant Ã  elles sur la version 17.0 de PostgreSQL. Il est&#xA;donc tout Ã  fait possible dâ€™importer une base dâ€™une ancienne version dans une&#xA;instance en version plus rÃ©cente aussi â€œfacilementâ€. Cela ne devrait pas&#xA;surprendre les DBA PostgreSQL ğŸ˜, qui savent bien que câ€™est une possibilitÃ©&#xA;quâ€™offrent &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_dump&lt;/code&gt;/&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_restore&lt;/code&gt;. Ce nâ€™est en rien une nouveautÃ© apportÃ©e par CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nous venons de voir deux mÃ©thodes de CloudNativePG qui permettent dâ€™importer des&#xA;bases de donnÃ©es existantes lors de la crÃ©ation dâ€™une nouvelle instance dans&#xA;Kubernetes. Toute la configuration se fait dans la section&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;bootstrap.initdb.import&lt;/code&gt; de lâ€™objet &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans les deux cas (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;monolith&lt;/code&gt; ou &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;microservice&lt;/code&gt;, la copie du &lt;em&gt;dump&lt;/em&gt; se fera dans&#xA;le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistant Volume&lt;/code&gt; associÃ© au nouveau &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;, nÃ©cessitant donc de la&#xA;place de stockage. Attention donc aux &lt;em&gt;dumps&lt;/em&gt; volumineux. Si vous avez dÃ©jÃ  des&#xA;&lt;em&gt;dumps&lt;/em&gt; prÃ©sents, cette solution semble peu pertinente.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cela Ã©tant dit, ces deux mÃ©thodes sont trÃ¨s simples dâ€™utilisation et permettent&#xA;de gÃ©rer un export / import de maniÃ¨re dÃ©claratif pour initier une instance avec&#xA;des donnÃ©es dÃ©jÃ  existantes. Simple et efficace ğŸ”¥ !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[Commentaire-Blog] CloudNativePG&#34;&gt;Ã‰crivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Du JSON invalide dans vos plans d&#39;exÃ©cution</title>
    <updated>2025-04-29T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-04-29://2025/04/29/plans-execution-json-invalide.html</id>
    <link href="https://blog.dalibo.com//2025/04/29/plans-execution-json-invalide.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;ChambÃ©ry, le 29 Avril 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous connaissez peut-Ãªtre &lt;a href=&#34;https://explain.dalibo.com&#34;&gt;explain.dalibo.com&lt;/a&gt;, lâ€™outil pour visualiser et&#xA;comprendre les plans dâ€™exÃ©cution gÃ©nÃ©rÃ©s par la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt;. Il accepte&#xA;des plans au format text et JSON.&#xA;Dans des versions prÃ©cÃ©dentes de PostgreSQL, un bug entraÃ®nait la gÃ©nÃ©ration de&#xA;plans au format JSON invalides. Ce bug a Ã©tÃ© corrigÃ© depuis longtemps, mais des&#xA;plans invalides sont toujours envoyÃ©s sur &lt;a href=&#34;https://explain.dalibo.com&#34;&gt;explain.dalibo.com&lt;/a&gt; (possiblement&#xA;gÃ©nÃ©rÃ©s avec une vieille version de PostgreSQL). Dans cet article, nous allons&#xA;dÃ©couvrir combien sont concernÃ©s, et comment nous avons obtenu cette&#xA;information.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;h2 id=&#34;le-bug&#34;&gt;Le bug&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Pour commencer, parlons du problÃ¨me initial.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y a environ 6 ans (en aoÃ»t 2019), alors que jâ€™Ã©tais en train de travailler&#xA;sur &lt;a href=&#34;https://github.com/dalibo/pev2&#34;&gt;PEV2&lt;/a&gt; (le visualiseur de plans au cÅ“ur de &lt;a href=&#34;https://explain.dalibo.com&#34;&gt;explain.dalibo.com&lt;/a&gt;), jâ€™ai trouvÃ©&#xA;et &lt;a href=&#34;https://www.postgresql.org/message-id/flat/41ee53a5-a36e-cc8f-1bee-63f6565bb1ee%40dalibo.com&#34;&gt;rapportÃ©&lt;/a&gt;&#xA;un bug dans PostgreSQL. Pour faire court, il y avait dans certains cas des clÃ©s&#xA;dupliquÃ©es dans la structure JSON, ce qui considÃ©rÃ© comme invalide.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple, dans le plan ci-dessous, la clÃ© &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Workers&lt;/code&gt; est dupliquÃ©eÂ :&lt;/p&gt;&#xA;&#xA;&lt;pre&gt;&lt;code class=&#34;language-JSON&#34;&gt;[&#xA;  {&#xA;    ...&#xA;      &#34;Plans&#34;: [&#xA;        {&#xA;          &#34;Node Type&#34;: &#34;Sort&#34;,&#xA;          ...&#xA;          &#34;Workers&#34;: [&#xA;            {&#xA;              &#34;Worker Number&#34;: 0,&#xA;              &#34;Sort Method&#34;: &#34;external merge&#34;,&#xA;              ...&#xA;            }&#xA;          ],&#xA;          &#34;Workers&#34;: [&#xA;            {&#xA;              &#34;Worker Number&#34;: 0,&#xA;              &#34;Actual Startup Time&#34;: 1487.846,&#xA;              ...&#xA;            }&#xA;          ],&#xA;    ...&#xA;  }&#xA;]&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;Analyser un plan comme celui-ci en utilisant &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;JSON.parse(â€¦)&lt;/code&gt; en Javascript ne&#xA;dÃ©clenche aucune erreur, mais ne garde quâ€™une seule des deux clÃ©s&#xA;dupliquÃ©es. Il en dÃ©coule une perte dâ€™information. Dans lâ€™exemple ci-dessus, la&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Sort Method&lt;/code&gt; serait oubliÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;contournement&#34;&gt;Contournement&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Comme &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;JSON.parse()&lt;/code&gt; ne peut pas Ãªtre utilisÃ© directement, pour &lt;a href=&#34;https://github.com/dalibo/pev2&#34;&gt;PEV2&lt;/a&gt;, jâ€™ai&#xA;dÃ©cidÃ© de me reposer sur une bibliothÃ¨que tierce (&lt;a href=&#34;https://www.npmjs.com/package/clarinet&#34;&gt;clarinet&lt;/a&gt;) pour analyser le plan par flux (câ€™est Ã  dire ligne par ligne) et prendre soin des clÃ©s dupliquÃ©es en fusionnant les valeurs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Mais cette bibliothÃ¨que nâ€™est plus maintenue et (parmi dâ€™autres) a une dÃ©pendance&#xA;sur &lt;a href=&#34;https://www.npmjs.com/package/stream&#34;&gt;stream&lt;/a&gt; pour gÃ©rer les flux Node.js&#xA;dans le navigateur. Avoir trop de dÃ©pendances est un risque et celle-ci peut&#xA;sembler superflue.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;bug-corrigÃ©&#34;&gt;Bug corrigÃ©&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Par chance, le problÃ¨me dans PostgreSQL a Ã©tÃ©&#xA;&lt;a href=&#34;https://github.com/postgres/postgres/commit/1001368497&#34;&gt;corrigÃ©&lt;/a&gt; en janvier&#xA;2020 (version 13).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour faciliter la maintenance de &lt;a href=&#34;https://github.com/dalibo/pev2&#34;&gt;PEV2&lt;/a&gt;, jâ€™ai donc envie de&#xA;&lt;a href=&#34;https://github.com/dalibo/pev2/issues/519&#34;&gt;supprimer la dÃ©pendance&lt;/a&gt;. Cependant, jâ€™ai aussi&#xA;besoin dâ€™Ãªtre certain que Ã§a ne sera pas au dÃ©triment des utilisateurs. La&#xA;bonne question Ã  laquelle il faut dâ€™abord rÃ©pondre est : Â« &lt;strong&gt;Combien&#xA;dâ€™utilisateurs utilisent encore une version de PostgreSQL affectÃ©e par le bug ?&lt;/strong&gt; Â». Câ€™est quasiment impossible Ã  savoir, mais je peux au moins rÃ©pondre Ã  la question : Â« &lt;strong&gt;Combien&#xA;de plans contiennent des clÃ©s dupliquÃ©esÂ ?&lt;/strong&gt; Â».&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;Ã -la-recherche-de-clÃ©s-dupliquÃ©es&#34;&gt;Ã€ la recherche de clÃ©s dupliquÃ©es&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;En avril 2025 (Ã  peu prÃ¨s 6 ans aprÃ¨s le lancement du site), un peu plus de 951 000&#xA;plans sont stockÃ©s dans la base de donnÃ©es utilisÃ©e pour &lt;a href=&#34;https://explain.dalibo.com&#34;&gt;explain.dalibo.com&lt;/a&gt;&#xA;(~ 10Â Gio). On peut considÃ©rer que câ€™est reprÃ©sentatif.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;nettoyage-des-sources&#34;&gt;Nettoyage des sources&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Les plans dâ€™exÃ©cution peuvent Ãªtre gÃ©nÃ©rÃ©s par un grand nombre dâ€™outils&#xA;diffÃ©rents avec diffÃ©rents paramÃ¨tres dâ€™affichage. Il y a donc une importante&#xA;variÃ©tÃ© de rendus.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici quelques exemples de variantes quelque peu exotiques dâ€™exports par&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;psql&lt;/code&gt;Â :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;+----------------------------------------------------+&#xA;|                     QUERY PLAN                     |&#xA;+----------------------------------------------------+&#xA;| [                                                 +|&#xA;|   {                                               +|&#xA;|     &#34;Plan&#34;: {                                     +|&#xA;|       &#34;Node Type&#34;: &#34;Nested Loop&#34;,                 +|&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—&#xA;â•‘                     QUERY PLAN                     â•‘&#xA;â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£&#xA;â•‘ [                                                 â†µâ•‘&#xA;â•‘   {                                               â†µâ•‘&#xA;â•‘     &#34;Plan&#34;: {                                     â†µâ•‘&#xA;â•‘       &#34;Node Type&#34;: &#34;Nested Loop&#34;,                 â†µâ•‘&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Pour savoir combien de plans sont au format JSON et ont des clÃ©s dupliquÃ©es, la&#xA;premiÃ¨re Ã©tape consiste Ã  supprimer les caractÃ¨res dâ€™encadrement, les titres et&#xA;autres informations extra. Câ€™est fait en crÃ©ant une fonction en &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PL/pgSQL&lt;/code&gt;&#xA;avec un lot dâ€™expressions rÃ©guliÃ¨res pour remplacer les caractÃ¨res inutiles.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cleanup_source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;TEXT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove frames around, handles |, â•‘,&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^(&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;||â•‘|â”‚)(.*)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove frames at the end of line, handles |, â•‘,&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;(.*)(&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;||â•‘|â”‚)$&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove separator lines from various types of borders&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;+-+&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^(-|â”€|â•)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;1+&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^(â”œ|â•Ÿ|â• |â•)(â”€|â•)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;2*(â”¤|â•¢|â•£|â•¡)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove more horizontal lines&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;+-+&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^â””(â”€)+â”˜&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^â•š(â•)+â•&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^â”Œ(â”€)+â”&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^â•”(â•)+â•—&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove quotes around lines, both &#39; and &#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^([&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#39;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;])(.*)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;2&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove &#34;+&#34; line continuations&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;s*&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove &#34;â†µ&#34; line continuations&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;â†µ&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove &#34;query plan&#34; header&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;s*QUERY PLAN&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;s*&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;m&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove rowcount&lt;/span&gt;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- example: (8 rows)&lt;/span&gt;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Note: can be translated&lt;/span&gt;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- example: (8 lignes)&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;d+&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;s+[a-z]*s?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;n|$)&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Replace two double quotes (added by pgAdmin)&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;&#34;&#34;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#34;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;c1&#34;&gt;-- Remove double quotes at begining and end of plan&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#34;(.*)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REGEXP_REPLACE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;^[^&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#34;]*&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;r?$&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;gm&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h2 id=&#34;dÃ©tection-des-clÃ©s-dupliquÃ©es&#34;&gt;DÃ©tection des clÃ©s dupliquÃ©es&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;La seconde Ã©tape consiste Ã©videmment Ã  dÃ©tecter les clÃ©s dupliquÃ©es. Pour cela, la&#xA;meilleure option que jâ€™ai trouvÃ©e a Ã©tÃ© de reposer sur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PL/v8&lt;/code&gt; pour faire&#xA;lâ€™analyse du texte brut.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c1&#34;&gt;-- Create the v8 extension&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXTENSION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plv8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;c1&#34;&gt;-- Create function to check if plan is JSON parsable&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is_json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;json_text&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;BOOLEAN&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;JSON&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;json_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plv8&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IMMUTABLE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;STRICT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;c1&#34;&gt;-- Create function to detect duplicate keys&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;detect_json_duplicate_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;json_text&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;TEXT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;duplicates&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stack&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[];&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keysStack&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[];&lt;/span&gt;&#xA;&#xA;  &lt;span class=&#34;n&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;&#34;(?:[^&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;&#34;(?=&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;*:)/g;&#xA;  let match;&#xA;  let currentKeys = [];&#xA;&#xA;  while ((match = tokenizer.exec(json_text)) !== null) {&#xA;    const token = match[0];&#xA;&#xA;    if (token === &#39;{&#39;) {&#xA;      // Start a new object scope&#xA;      currentKeys.push(new Set());&#xA;    } else if (token === &#39;}&#39;) {&#xA;      // End of an object scope&#xA;      currentKeys.pop();&#xA;    } else if (token === &#39;[&#39;) {&#xA;      // Just track arrays â€” doesn&#39;t affect key scope&#xA;      stack.push(&#39;[&#39;);&#xA;    } else if (token === &#39;]&#39;) {&#xA;      stack.pop();&#xA;    } else if (token.startsWith(&#39;&#34;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;)) {&#xA;      const key = token.slice(1, -1).replace(/&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#34;/g, &#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;&#34;&#39;);&#xA;&#xA;      if (currentKeys.length &amp;gt; 0) {&#xA;        const keySet = currentKeys[currentKeys.length - 1];&#xA;        if (keySet.has(key)) {&#xA;          duplicates.add(key);&#xA;        } else {&#xA;          keySet.add(key);&#xA;        }&#xA;      }&#xA;    }&#xA;  }&#xA;&#xA;  return Array.from(duplicates);&#xA;$$ LANGUAGE plv8 IMMUTABLE;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h2 id=&#34;mise-Ã -jour-des-donnÃ©es&#34;&gt;Mise Ã  jour des donnÃ©es&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Ensuite, ces fonctions sont utilisÃ©es dans une requÃªte sur tous les&#xA;enregistrements de la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;plans&lt;/code&gt; pour renseigner une nouvelle colonne&#xA;dÃ©diÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;updated_data&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&#xA;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;cleanup_source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cleaned&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plans&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&#xA;&lt;span class=&#34;n&#34;&gt;enriched_data&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&#xA;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;is_json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cleaned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is_json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;detect_json_duplicate_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cleaned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dup_keys&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;updated_data&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plans&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;duplicated_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dup_keys&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;enriched_data&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_json&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TRUE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h2 id=&#34;performance&#34;&gt;Performance&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Malheureusement, une telle requÃªte aurait Ã©tÃ© extrÃªmement longue.&#xA;Notamment, elle ne peut pas Ãªtre parallÃ©lisÃ©e&#xA;puisque PostgreSQL ne permet pas la parallÃ©lisation pour des requÃªtes&#xA;dâ€™Ã©criture.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par contre, grÃ¢ce au fait que la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;plans&lt;/code&gt; est divisÃ©e en partitions, il&#xA;est possible de faire une sorte de &lt;em&gt;Â« parallÃ©lisation cÃ´tÃ© client Â»&lt;/em&gt; en lanÃ§ant&#xA;la requÃªte sur chaque partition dans un script bash.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cela mâ€™a mÃªme permis au passage de calculer et afficher la durÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-bash highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;c&#34;&gt;#!/bin/bash&lt;/span&gt;&#xA;&lt;span class=&#34;nv&#34;&gt;START_TIME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt; +%s&lt;span class=&#34;si&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;for &lt;/span&gt;i &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;si&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;seq &lt;/span&gt;0 49&lt;span class=&#34;si&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&#xA;  &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;Start detection on partition &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&#xA;  psql &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; detect.sql &lt;span class=&#34;nt&#34;&gt;--set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;partition_table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;plans.part_&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; /dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&#xA;&lt;span class=&#34;k&#34;&gt;done&#xA;&#xA;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;wait&#xA;&#xA;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;END_TIME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt; +%s&lt;span class=&#34;si&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;âœ… Finished in &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$((&lt;/span&gt;END_TIME &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; START_TIME&lt;span class=&#34;k&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; seconds.&#34;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le script (qui dÃ©pend des processeurs et de leur nombre) a tournÃ© pendant un peu plus de 6 heures.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;rÃ©sultats&#34;&gt;RÃ©sultats&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;AprÃ¨s Ã§a, jâ€™ai simplement exÃ©cutÃ© la requÃªte SQL suivanteÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;month&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;filtered_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;unfiltered_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filtered_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OVER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;month&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total_filtered&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unfiltered_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OVER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;month&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total_unfiltered&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;json_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OVER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;month&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total_json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filtered_count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NULLIF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unfiltered_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ratio_filtered&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;date_trunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;month&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;created&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;month&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FILTER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;duplicated_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;{}&#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;duplicated_keys&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filtered_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;unfiltered_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FILTER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;duplicated_keys&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_count&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;plans&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;GROUP&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;date_trunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;month&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;created&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sub&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;month&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Un peu plus de &lt;strong&gt;380 000&lt;/strong&gt; plans envoyÃ©s sont au format JSON (sur un total&#xA;dâ€™environ 950 000). &lt;strong&gt;7 600&lt;/strong&gt; sont au format JSON et ont des clÃ©s dupliquÃ©es,&#xA;ce qui reprÃ©sente moins de &lt;strong&gt;0,8%&lt;/strong&gt; du total. Sur les derniers 6 mois, câ€™est&#xA;mÃªme &lt;strong&gt;0,3%&lt;/strong&gt; (670 Ã  comparer Ã  ~200 000). Et câ€™est en dÃ©croissance.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le graphique suivant montre lâ€™Ã©volution de la proportion des plans avec des&#xA;clÃ©s dupliquÃ©es en fonction du temps.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/ratio_invalid_plans_chart.png&#34; alt=&#34;Ratio of invalid JSON plans per month&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;politique-de-rÃ©tention-des-donnÃ©es&#34;&gt;Politique de rÃ©tention des donnÃ©es&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Nous conservons les plans que les utilisateurs envoient sur &lt;a href=&#34;https://explain.dalibo.com&#34;&gt;explain.dalibo.com&lt;/a&gt;,&#xA;sauf sâ€™ils les suppriment. Ceci &lt;strong&gt;uniquement&lt;/strong&gt; dans le seul but&#xA;dâ€™&lt;strong&gt;amÃ©liorer&lt;/strong&gt; &lt;a href=&#34;https://github.com/dalibo/pev2&#34;&gt;PEV2&lt;/a&gt; et notre connaissance de PostgreSQL, comme nous avons&#xA;pu le voir dans cet article.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si la confidentialitÃ© de vos requÃªtes est importante pour vous, vous pouvez toujours installer&#xA;lâ€™application &lt;a href=&#34;https://github.com/dalibo/explain.dalibo.com/&#34;&gt;Flask&#xA;application&lt;/a&gt; sur votre rÃ©seau ou&#xA;utiliser la version autonome&#xA;&lt;a href=&#34;https://www.github.com/dalibo/pev2/releases/latest/download/pev2.html&#34;&gt;pev2.html&lt;/a&gt; qui peut Ãªtre utilisÃ©e localement sur votre navigateur.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Un petit nombre de plans envoyÃ©s sur &lt;a href=&#34;https://explain.dalibo.com&#34;&gt;explain.dalibo.com&lt;/a&gt; semble&#xA;gÃ©nÃ©rÃ© sur des clusters qui utilisent encore une version Â« buguÃ©e Â» de&#xA;PostgreSQL, seulement moins de 3 pour 1000&#xA;ces derniers temps et il y en a de moins en moins.&#xA;Cela donne une idÃ©e de la proportion de clusters pre-PG14 dans lâ€™Ã©cosystÃ¨me&#xA;PostgreSQL, bien que beaucoup dâ€™autres puissent Ãªtre utilisÃ©s dans des cas oÃ¹&#xA;des optimisations ne sont plus tentÃ©es.&#xA;Partant de ce constat, du fait que seulement une petite partie des&#xA;informations sont perdues avec une analyse â€œstandardâ€ du JSON, et que PostgreSQL v13&#xA;sera en fin de support communautaire dâ€™ici fin 2025, je pense quâ€™il&#xA;est prudent de supprimer le support des clÃ©s dupliquÃ©es&#xA;dans &lt;a href=&#34;https://github.com/dalibo/pev2&#34;&gt;PEV2&lt;/a&gt;, et donc de supprimer la dÃ©pendance sur la bibliothÃ¨que tierce.&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #7 - SÃ©quence de dÃ©marrage !</title>
    <updated>2025-04-24T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-04-24://2025/04/24/cnpg-7.html</id>
    <link href="https://blog.dalibo.com//2025/04/24/cnpg-7.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 24 avril 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;CloudNativePG&lt;/strong&gt; ou comment embarquer un Ã©lÃ©phant sur un porte-conteneurs !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Dans le premier article, nous avons eu un aperÃ§u de ce que lâ€™opÃ©rateur&#xA;CloudNativePG permet de faire. Le dÃ©ploiement des instances se dÃ©roulait sans&#xA;encombre â€¦ mais que se passe-t-il vraiment lorsque la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl apply&#xA;-f ~/cluster.yaml&lt;/code&gt; est utilisÃ©e ? Câ€™est ce que nous allons voir avec ce nouvel&#xA;article consacrÃ© Ã  lâ€™opÃ©rateur CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;la-sÃ©quence-de-dÃ©marrage-&#34;&gt;La sÃ©quence de dÃ©marrage ğŸš€&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Lâ€™objectif aujourdâ€™hui est de comprendre les mÃ©canismes qui entrent en jeu lors&#xA;de la crÃ©ation dâ€™un cluster PostgreSQL avec CloudNativePG. Je pars du principe&#xA;quâ€™un cluster Kubernetes est en cours de fonctionnement et que lâ€™opÃ©rateur est&#xA;installÃ©. Reprenons la dÃ©finition du cluster du &lt;a href=&#34;https://blog.dalibo.com/2025/01/03/cnpg-1.html&#34;&gt;premier&#xA;article&lt;/a&gt; de notre sÃ©rie :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;DÃ©cortiquons ce qui se passe lorsque &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl apply -f ~/cluster.yaml&lt;/code&gt; est utilisÃ©.&#xA;La commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl get pod --watch&lt;/code&gt; est trÃ¨s utile pour comprendre cela.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;k get pod --watch       &#xA;NAME                        READY   STATUS            RESTARTS   AGE&#xA;postgresql-1-initdb-n4c5n   0/1     PodInitializing   0          1s&#xA;postgresql-1-initdb-n4c5n   0/1     Completed         0          2s&#xA;postgresql-1                0/1     Pending           0          0s&#xA;postgresql-1                0/1     Init:0/1          0          0s&#xA;postgresql-1                0/1     PodInitializing   0          1s&#xA;postgresql-1                0/1     Running           0          10s&#xA;postgresql-1                1/1     Running           0          10s&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h3 id=&#34;pod-initdb&#34;&gt;Pod initdb&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Un premier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; est crÃ©Ã©, ici &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1-initdb-n4c5n&lt;/code&gt;. Le mot &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&lt;/code&gt; doit&#xA;normalement vous dire quelque chose (pssst, si jamais vous avez oubliÃ©, il&#xA;sâ€™agit dâ€™un &lt;a href=&#34;https://docs.postgresql.fr/current/app-initdb.html&#34;&gt;utilitaire&lt;/a&gt; qui&#xA;permet de prÃ©parer lâ€™instance en crÃ©ant notamment les rÃ©pertoires de&#xA;lâ€™arborescence du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PGDATA&lt;/code&gt;, les tables du catalogue PostgreSQL et des bases de&#xA;donnÃ©es comme &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;template1&lt;/code&gt;). Lorsque celui-ci a terminÃ© de sâ€™exÃ©cuter, un autre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; est lancÃ©, qui lui correspondra Ã  notre instance PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Revenons sur le premier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt;. Il contient en rÃ©alitÃ© deux conteneurs, nommÃ©s&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;bootstrap-controller&lt;/code&gt; ğŸ“¦ et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&lt;/code&gt; ğŸ“¦. &#xA;Le conteneur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;bootstrap-controller&lt;/code&gt; est ce quâ€™on appelle un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;init-container&lt;/code&gt;.&#xA;Câ€™est un type de conteneur spÃ©cial qui est dÃ©marrÃ© avant le ou les conteneurs&#xA;applicatifs (ici &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;../../../img/cnpg/init.png&#34; alt=&#34;CrÃ©ation du premier `Pod`&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En regardant les dÃ©tails de ce conteneur avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl describe postgresql-1-initdb-n4c5n&lt;/code&gt;,&#xA;on peut relever plusieurs Ã©lÃ©ments intÃ©ressants :&lt;/p&gt;&#xA;&#xA;&lt;ol&gt;&#xA;  &lt;li&gt;Il se base sur la mÃªme image que lâ€™opÃ©rateur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ghcr.io/cloudnative-pg/cloudnative-pg:1.25.1&lt;/code&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;et il exÃ©cute la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/manager bootstrap /controller/manager --log-level=info&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;[...]&#xA;Init Containers:&#xA;  bootstrap-controller:&#xA;    Container ID:    docker://2f6f2d7fa4e64f739113805827235a629ffeea78d740265b44dcb0474e4a7784&#xA;    Image:           ghcr.io/cloudnative-pg/cloudnative-pg:1.25.1&#xA;[...]&#xA;    Command:&#xA;      /manager&#xA;      bootstrap&#xA;      /controller/manager&#xA;      --log-level=info&#xA;    State:          Terminated&#xA;      Reason:       Completed&#xA;      Exit Code:    0&#xA;      Started:      Tue, 22 Apr 2025 17:31:42 +0200&#xA;      Finished:     Tue, 22 Apr 2025 17:31:43 +0200&#xA;[...]&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;La commande a pour but de mettre Ã  disposition lâ€™opÃ©rateur dans le second&#xA;conteneur. Lorsquâ€™il a terminÃ© de sâ€™exÃ©cuter, le conteneur passe Ã  lâ€™Ã©tat&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Terminated&lt;/code&gt; et la sÃ©quence de dÃ©marrage continue par le lancement du conteneur&#xA;applicatif, ici &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Suivant le mÃªme principe, ce conteneur est crÃ©Ã© Ã  partir dâ€™une image, ici&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;Containers:&#xA;  initdb:&#xA;    Container ID:    docker://af0bf7b2d64e7cc88a1bd0034a5f46a3644a41523c0d18eaa8719cf963a5acad&#xA;    Image:           ghcr.io/cloudnative-pg/postgresql:17.0&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;LÃ  aussi, la commande Ã  exÃ©cuter est spÃ©cifiÃ©e. En lâ€™occurrence il sâ€™agit de&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/controller/manager instance init ...&lt;/code&gt; qui va dÃ©clencher lâ€™initialisation de&#xA;lâ€™instance PostgreSQL. Cette commande utilitaire &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;manager&lt;/code&gt; qui est ni plus ni&#xA;moins quâ€™une partie de lâ€™opÃ©rateur CloudNativePG. Cet utilitaire est Ã©crit en Go et on peut&#xA;retrouver son code sur le &lt;a href=&#34;https://github.com/cloudnative-pg/cloudnative-pg/tree/main/internal/cmd/manager&#34;&gt;projet Github&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les arguments passÃ©s Ã  cette commande sont ceux par dÃ©faut. Ils peuvent Ãªtre&#xA;surchargÃ©s dans le &lt;em&gt;manifest&lt;/em&gt; du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt;. Aussi, Ã  la lecture de ceux-ci, on&#xA;comprend quâ€™une base de donnÃ©es &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;app&lt;/code&gt; et un rÃ´le qui porte le mÃªme nom seront&#xA;automatiquement crÃ©Ã©s.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;    Command:&#xA;      /controller/manager&#xA;      instance&#xA;      init&#xA;      --initdb-flags&#xA;      --encoding=UTF8 --lc-collate=C --lc-ctype=C&#xA;      --app-db-name&#xA;      app&#xA;      --app-user&#xA;      app&#xA;      --log-level=info&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;On peut Ã©galement voir certaines variables dâ€™environnement positionnÃ©es dans la&#xA;dÃ©finition du conteneur et qui seront utilisÃ©es par cette commande.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;    Environment:&#xA;      PGDATA:        /var/lib/postgresql/data/pgdata&#xA;      POD_NAME:      postgresql-1-initdb&#xA;      NAMESPACE:     default&#xA;      CLUSTER_NAME:  postgresql&#xA;      PSQL_HISTORY:  /controller/tmp/.psql_history&#xA;      PGPORT:        5432&#xA;      PGHOST:        /controller/run&#xA;      TMPDIR:        /controller/tmp&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lorsque cette commande aura fini de sâ€™exÃ©cuter, leÂ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistant Volume&lt;/code&gt; sera prÃªt&#xA;Ã  Ãªtre utilisÃ© par le second &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;pod-postgresql&#34;&gt;Pod PostgreSQL&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Quand les premiers conteneurs au sein du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&lt;/code&gt; auront terminÃ© leurs&#xA;tÃ¢ches, le &lt;em&gt;controller&lt;/em&gt; CloudNativePG va dÃ©ployer un second et dernier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; qui&#xA;contiendra notre instance PostgreSQL.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;../../../img/cnpg/init2.png&#34; alt=&#34;CrÃ©ation du second `Pod`&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le mÃªme principe dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;init-container&lt;/code&gt; est utilisÃ© avec le conteneur&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;boostrap-controller&lt;/code&gt; qui permet dâ€™utiliser lâ€™opÃ©rateur CloudNativePG dans le&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; PostgreSQL. Ce &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; rÃ©utilise le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistant Volume&lt;/code&gt; crÃ©Ã© prÃ©cÃ©demment.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette fois-ci, le second conteneur est nommÃ© &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;. Il se base lui aussi&#xA;sur lâ€™image &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/code&gt; et exÃ©cute la commande&#xA;suivante :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;go&#34;&gt;Command:&#xA;      /controller/manager&#xA;      instance&#xA;      run&#xA;      --status-port-tls&#xA;      --log-level=info&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™instance PostgreSQL est dÃ©marrÃ©e par lâ€™intermÃ©diaire de lâ€™outil&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;/controller/manager&lt;/code&gt; prÃ©sent dans le conteneur. Notre Ã©lÃ©phant ğŸ˜ est embarquÃ©&#xA;sur notre porte-conteneurs â›´ï¸!&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;images-utilisÃ©es&#34;&gt;Images utilisÃ©es&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Les &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;init-containers&lt;/code&gt; ou les conteneurs applicatifs (ici &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;)&#xA;se basent sur des images spÃ©cifiques. Ces images doivent se trouver sur le nÅ“ud&#xA;Kubernetes qui va hÃ©berger lâ€™instance PostgreSQL. Si elles ne se trouvent pas&#xA;localement sur la machine, elles devront Ãªtre tÃ©lÃ©chargÃ©es. Par dÃ©faut, elles&#xA;le seront depuis la &lt;em&gt;registry&lt;/em&gt; Github associÃ©e au projet CloudNativePG. Câ€™est ce&#xA;que lâ€™on peut voir dans le nom des images avec la partie &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ghcr.io/cloudnative-pg&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il faut donc sâ€™assurer que votre cluster Kubernetes ait accÃ¨s Ã  internet&#xA;pour pouvoir les rÃ©cupÃ©rerâ€¦ si ce nâ€™est pas le cas, vous devrez mettre en&#xA;place une &lt;em&gt;registry&lt;/em&gt; interne comme &lt;a href=&#34;https://landscape.cncf.io/guide?item=provisioning--container-registry--harbor#provisioning--container-registry&#34;&gt;Harbor&lt;/a&gt;, &lt;a href=&#34;https://landscape.cncf.io/guide?item=provisioning--container-registry--zot#provisioning--container-registry&#34;&gt;Zot&lt;/a&gt;, ou &lt;a href=&#34;https://landscape.cncf.io/guide?item=provisioning--container-registry--distribution#provisioning--container-registry&#34;&gt;Distribution&lt;/a&gt;â€¦&#xA;mais cela ne nous regarde pas. On laissera ce choix Ãªtre fait par lâ€™Ã©quipe&#xA;DevOps ou SystÃ¨me ğŸ˜‡.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Nous venons de dÃ©couvrir ce quâ€™il se passe lorsquâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Cluster&lt;/code&gt; PostgreSQL est&#xA;crÃ©Ã©. Le concept Kubernetes dâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Init Container&lt;/code&gt; est utilisÃ© par lâ€™opÃ©rateur&#xA;CloudNativePG lors de la crÃ©ation des diffÃ©rents &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pods&lt;/code&gt;.&#xA;La sÃ©quence de dÃ©marrage se fait en deux Ã©tapes : dâ€™abord la prÃ©paration de&#xA;lâ€™instance et du volume par un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; qui utilise &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&lt;/code&gt; puis le dÃ©ploiement du&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; PostgreSQL sur ce mÃªme volume.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[Commentaire-Blog] CloudNativePG&#34;&gt;Ã‰crivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 18 - Modules optionnels pour EXPLAIN</title>
    <updated>2025-04-07T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-04-07://2025/04/07/postgresql-18-module_explain.html</id>
    <link href="https://blog.dalibo.com//2025/04/07/postgresql-18-module_explain.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Reviers, le 7 avril 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Au fil des versions de PostgreSQL, la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt; sâ€™est vu ajouter de&#xA;nombreuses optionsÂ : &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VERBOSE&lt;/code&gt;, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;BUFFERS&lt;/code&gt;, etc. Lors du dÃ©veloppement&#xA;de la version 18, Robert Haas a proposÃ© une nouvelle option trÃ¨s intÃ©ressante.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/portrait_guillaume.png&#34; alt=&#34;Guillaume Lelarge&#34; style=&#34;float: right; padding:10px; width:120px;&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Au moment oÃ¹ cet article est Ã©crit, on dÃ©nombre pas moins de 12 options pour la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;ANALYZE&lt;/code&gt;Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;VERBOSE&lt;/code&gt;Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;COSTS&lt;/code&gt; (apparue en version 9.0)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SETTINGS&lt;/code&gt; (apparue en version 12)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;GENERIC_PLAN&lt;/code&gt; (apparue en version 16)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;BUFFERS&lt;/code&gt; (apparue en version 9.0)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SERIALIZE&lt;/code&gt; (apparue en version 17)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;WAL&lt;/code&gt; (apparue en version 9.0)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;TIMING&lt;/code&gt; (apparue en version 9.2)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;SUMMARY&lt;/code&gt; (apparue en version 10)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;MEMORY&lt;/code&gt; (apparue en version 17)Â ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;FORMAT&lt;/code&gt; (apparue en version 9.0).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Nous pourrions penser que câ€™est suffisant, mais il existe un bon nombre dâ€™autres&#xA;informations quâ€™il serait intÃ©ressant dâ€™ajouter, parfois par des extensions.&#xA;Pensez par exemple Ã  lâ€™extension de Citus qui ajoute des nÅ“uds spÃ©cifiques Ã  un&#xA;plan dâ€™exÃ©cution. Il pourrait Ãªtre intÃ©ressant que cette extension gÃ¨re des&#xA;options spÃ©cifiques sur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt; pour activer ou non lâ€™affichage dâ€™informations&#xA;supplÃ©mentaires spÃ©cifiques Ã  ses nÅ“uds.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Robert Haas a donc intÃ©grÃ© dans PostgreSQL la possibilitÃ© que des modules&#xA;chargeables dynamiquement gÃ¨rent leurs propres options pour la commande&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt;. Cela fait partie de plusieurs commits, mais les deux principaux&#xA;sont :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://git.postgresql.org/pg/commitdiff/c65bc2e1d14a2d4daed7c1921ac518f2c5ac3d17&#34;&gt;Make it possible for loadable modules to add EXPLAIN&#xA;options&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://git.postgresql.org/pg/commitdiff/4fd02bf7cf94c3b6807dcf0b13e076de94f1e4ff&#34;&gt;Add some new hooks so extensions can add details to EXPLAIN&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Robert a intÃ©grÃ© son propre module, nommÃ© &lt;a href=&#34;https://www.postgresql.org/docs/devel/pgoverexplain.html&#34;&gt;pg_overexplain&lt;/a&gt;, dans les modules&#xA;contrib.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En lisant ceci, il mâ€™est venu lâ€™idÃ©e dâ€™Ã©crire mon propre module &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt; pour&#xA;tester cette nouvelle fonctionnalitÃ©. Le module en question, appelÃ©&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_explaintips&lt;/code&gt; et &lt;a href=&#34;https://github.com/gleu/pg_explaintips&#34;&gt;disponible sur&#xA;GitHub&lt;/a&gt;, donne quelques astuces sur&#xA;certains plans. Pour cela, il faut que lâ€™option &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;TIPS&lt;/code&gt; soit ajoutÃ©e Ã  la&#xA;commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt;. Le module se charge soit avec la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;LOAD&lt;/code&gt; soit en&#xA;le configurant dans le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;shared_preload_libraries&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple, lorsquâ€™un plan contient un nÅ“ud &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Seq Scan&lt;/code&gt; avec beaucoup de lignes&#xA;ignorÃ©es par le filtre, une information est automatiquement affichÃ©e pour&#xA;prÃ©coniser lâ€™ajout dâ€™un index. Voici rapidement une dÃ©monstration.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;CrÃ©ation de la table de testÂ :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Exemple dâ€™un filtre ramenant la majoritÃ© de la table (donc pas de conseil&#xA;affichÃ© malgrÃ© la prÃ©sence de lâ€™option)Â :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COSTS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OFF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TIPS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;Seq Scan on t1 (actual time=0.042..0.337 rows=998.00 loops=1)&#xA;  Filter: (id &amp;gt; 2)&#xA;  Rows Removed by Filter: 2&#xA;  Buffers: shared hit=5&#xA;Planning:&#xA;  Buffers: shared hit=4&#xA;Planning Time: 0.079 ms&#xA;Execution Time: 0.479 ms&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Exemple dâ€™un filtre ramenant peu de lignes de la table (donc conseil affichÃ© sur&#xA;lâ€™ajout dâ€™un index)Â :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-sql highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COSTS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OFF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TIPS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;Seq Scan on t1 (actual time=0.014..0.113 rows=1.00 loops=1)&#xA;  Filter: (id &amp;lt; 2)&#xA;  Rows Removed by Filter: 9999&#xA;  Buffers: shared hit=5&#xA;  Tips: You should probably add an index!&#xA;Planning Time: 0.035 ms&#xA;Execution Time: 0.127 ms&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le module que jâ€™ai dÃ©veloppÃ© nâ€™est quâ€™un exemple de ce quâ€™il est possible de&#xA;faire, pas quelque chose de rÃ©ellement utilisable en production (pour lâ€™instant&#xA;en tout cas). Il est capable de dÃ©tecter un cas oÃ¹ un index serait intÃ©ressant,&#xA;oÃ¹ la mise Ã  jour de la VM pourrait amÃ©liorer les performances dâ€™un nÅ“ud &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Index&#xA;Only Scan&lt;/code&gt;, ou dâ€™un manque de mÃ©moire pour les nÅ“uds &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Sort&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Hash&lt;/code&gt;. Il&#xA;dispose aussi de paramÃ¨tres de configuration permettant de calibrer les seuils&#xA;minimums avant lâ€™affichage dâ€™une astuce.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En tout cas, cette nouvelle fonctionnalitÃ© intÃ©grÃ©e par Robert Haas pourrait&#xA;permettre de voir lâ€™apparition de nouveaux types dâ€™extensions trÃ¨s intÃ©ressantes&#xA;pour les personnes qui jouent beaucoup avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;EXPLAIN&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;!--&#xA;   vim: spelllang=fr spell&#xA;--&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #6 - Plugin pour CloudNativePG</title>
    <updated>2025-04-03T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-04-03://2025/04/03/cnpg-6.html</id>
    <link href="https://blog.dalibo.com//2025/04/03/cnpg-6.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;VallÃ©e de Munster, 03 avril 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les dÃ©veloppeurs de CloudNativePG travaillent sur divers projets et&#xA;fonctionnalitÃ©s que nous suivons attentivement (merci le Logiciel Libre&#xA;et la gouvernance ouverte ğŸ˜Š).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™une des fonctionnalitÃ©s qui nous intÃ©resse, et est Ã  lâ€™origine de&#xA;nombreux chantiers, est la possibilitÃ© dâ€™Ã©tendre un cluster&#xA;CloudNativePG avec des &lt;strong&gt;plugins&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Nous vous proposons aujourdâ€™hui une prÃ©sentation de cette&#xA;fonctionnalitÃ©. Nous illustrerons notre article avec un &lt;strong&gt;plugin&lt;/strong&gt;&#xA;&lt;em&gt;expÃ©rimental&lt;/em&gt; que nous avons dÃ©veloppÃ©. Ce &lt;strong&gt;plugin&lt;/strong&gt; permet dâ€™archiver&#xA;les &lt;strong&gt;WALs&lt;/strong&gt; et sauvegarder une instance vers un &lt;strong&gt;bucket S3&lt;/strong&gt; avec&#xA;&lt;strong&gt;pgBackRest&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;pourquoi-des-plugins&#34;&gt;Pourquoi des Plugins&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Initialement les dÃ©veloppeurs de CloudNativePG ont choisi dâ€™intÃ©grer&#xA;certains composants directement dans lâ€™opÃ©rateur. Vous pouvez dÃ©cider&#xA;dâ€™utiliser ou de ne pas utiliser ces composants, par contre vous nâ€™avez&#xA;pas la possibilitÃ© de les changer.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Par exemple lâ€™opÃ©rateur permet de configurer et dâ€™utiliser &lt;a href=&#34;https://pgbarman.org/&#34;&gt;Barman&#xA;Cloud&lt;/a&gt; pour les sauvegardes au fil de lâ€™eau&#xA;(&lt;strong&gt;PITR&lt;/strong&gt;). Si cette solution ne rÃ©pond pas Ã  vos besoins, vous deviez&#xA;jusquâ€™Ã  prÃ©sent, soit :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Bricoler une solution alternative ;&lt;/li&gt;&#xA;  &lt;li&gt;Vivre avec Barman Cloud ;&lt;/li&gt;&#xA;  &lt;li&gt;Choisir une autre solution pour opÃ©rer PostgreSQL dans&#xA;&lt;strong&gt;Kubernetes&lt;/strong&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Cette vision a Ã©tÃ© la source de plusieurs demandes sur le gestionnaire&#xA;de demandes du projet (Exemple:&#xA;&lt;a href=&#34;https://github.com/cloudnative-pg/cloudnative-pg/issues/6272&#34;&gt;6272&lt;/a&gt;,&#xA;&lt;a href=&#34;https://github.com/cloudnative-pg/cloudnative-pg/issues/3077&#34;&gt;3077&lt;/a&gt; ou&#xA;encore&#xA;&lt;a href=&#34;https://github.com/cloudnative-pg/cloudnative-pg/issues/3432&#34;&gt;3432&lt;/a&gt;).&#xA;Les dÃ©veloppeurs de CloudNativePG ont pris en compte ces remarques.&#xA;Depuis la version&#xA;&lt;a href=&#34;https://github.com/cloudnative-pg/cloudnative-pg/releases/tag/v1.25.0&#34;&gt;1.25.0&lt;/a&gt;&#xA;sortie en dÃ©cembre 2024, il est maintenant possible dâ€™utiliser&#xA;lâ€™&lt;a href=&#34;https://github.com/cloudnative-pg/cnpg-i&#34;&gt;interface cnpg-i&lt;/a&gt;&#xA;(expÃ©rimental) pour Ã©tendre et enrichir les fonctionnalitÃ©s des&#xA;&lt;strong&gt;Clusters&lt;/strong&gt; CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;h2 id=&#34;expÃ©rimentations-avec-pgbackrest&#34;&gt;ExpÃ©rimentations avec pgBackRest&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Dans le cadre de notre R&amp;amp;D, nous avons testÃ© cette interface. Voici une&#xA;prÃ©sentation du fonctionnement de notre &lt;strong&gt;plugin&lt;/strong&gt; expÃ©rimental pour&#xA;utiliser pgBackRest avec CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Notre solution est composÃ©e dâ€™un :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;ContrÃ´leur (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-controller&lt;/code&gt;) dÃ©diÃ© Ã  notre &lt;strong&gt;plugin&lt;/strong&gt; qui va&#xA;communiquer avec lâ€™opÃ©rateur CloudNativePG et est responsable de&#xA;configurer pgBackRest au sein de nos clusters ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;strong&gt;Sidecar container&lt;/strong&gt; par Cluster CloudNativePG configurÃ© avec notre&#xA;&lt;strong&gt;plugin&lt;/strong&gt;. Ce conteneur (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-plugin&lt;/code&gt;) doit sâ€™occuper de&#xA;lâ€™archivage et la sauvegarde. Ce conteneur se charge de lancer la&#xA;commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest&lt;/code&gt; lorsque câ€™est nÃ©cessaire (lors de lâ€™archivage&#xA;ou une sauvegarde).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;h3 id=&#34;contrÃ´leur-pgbackrest-controller&#34;&gt;ContrÃ´leur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-controller&lt;/code&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Le contrÃ´leur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-controller&lt;/code&gt; est responsable de faire muter les&#xA;ressources demandÃ©es par unâ‹…e utilisateurice. Lorsque lâ€™opÃ©rateur est&#xA;sollicitÃ© pour initier ou modifier un &lt;strong&gt;Cluster&lt;/strong&gt;, notre contrÃ´leur va&#xA;le modifier pour injecter et configurer un &lt;strong&gt;sidecar container&lt;/strong&gt;. Ce&#xA;conteneur va ensuite Ãªtre responsable de lâ€™archivage (des &lt;strong&gt;WALs&lt;/strong&gt;) et&#xA;des sauvegardes. Cette mutation est rÃ©alisÃ©e avant que la requÃªte (pour&#xA;initier le Pod) ne soit envoyÃ©e Ã  lâ€™API de Kubernetes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour permettre cela, notre &lt;strong&gt;plugin&lt;/strong&gt; doit dÃ©clarer auprÃ¨s de&#xA;lâ€™opÃ©rateur CloudNativePG quâ€™il est capable de mettre Ã  jour (â€œpatcherâ€)&#xA;des objets. Pour cela, nous utilisons les &lt;strong&gt;capabilites&lt;/strong&gt; dÃ©finies par&#xA;lâ€™interface CNPG-I pour &lt;a href=&#34;https://github.com/cloudnative-pg/cnpg-i-hello-world/blob/main/doc/development.md#lifecycle&#34;&gt;gÃ©rer cycle de vie (&lt;strong&gt;lifecycle&lt;/strong&gt;) des&#xA;instances&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ce contrÃ´leur sâ€™exÃ©cute sous la forme dâ€™un &lt;strong&gt;Pod&lt;/strong&gt; au sein du&#xA;&lt;strong&gt;namespace&lt;/strong&gt; dÃ©diÃ© Ã  lâ€™opÃ©rateur (par exemple : &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;cnpg-system&lt;/code&gt;) et&#xA;communique avec le contrÃ´leur de lâ€™opÃ©rateur. Ce composant est unique&#xA;(un seul dÃ©ploiement) et est partagÃ© entre tous les &lt;strong&gt;Clusters&lt;/strong&gt;&#xA;CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le contrÃ´leur se charge aussi de configurer pgBackRest. Lorsquâ€™il ajoute&#xA;un &lt;strong&gt;sidecar container&lt;/strong&gt;, le contrÃ´leur injecte les variables&#xA;dâ€™environnement qui seront utilisÃ©es par pgBackRest (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PGBACKREST_...&lt;/code&gt;).&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get pod &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; cnpg-system&#xA;&lt;span class=&#34;go&#34;&gt;NAME                                       READY   STATUS    RESTARTS      AGE&#xA;cnpg-controller-manager-76cd6b9b68-wcf6t   1/1     Running   2 (55m ago)   46h&#xA;pgbackrest-controller-78dbb67f9-85r2v      1/1     Running   2 (55m ago)   45h&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ici, câ€™est &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-controller-78dbb67f9-85r2v&lt;/code&gt;, qui porte cette&#xA;responsabilitÃ©.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;sidecar-container-pgbackrest-plugin&#34;&gt;Sidecar container &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-plugin&lt;/code&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Comme Ã©voquÃ© plus haut, notre &lt;strong&gt;plugin&lt;/strong&gt;, via le contrÃ´leur&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-controller&lt;/code&gt;, ajoute Ã  nos &lt;strong&gt;clusters&lt;/strong&gt; un &lt;strong&gt;sidecar&#xA;container&lt;/strong&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-plugin&lt;/code&gt; dans le &lt;strong&gt;Pod&lt;/strong&gt; de lâ€™instance&#xA;PostgreSQL. Ce &lt;strong&gt;sidecar container&lt;/strong&gt; nouvellement ajoutÃ© va ensuite&#xA;archiver et sauvegarder notre instance via pgBackrest.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lorsque quâ€™un &lt;strong&gt;WAL&lt;/strong&gt; doit Ãªtre archivÃ©, lâ€™instance PostgreSQL, via&#xA;lâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;archive_command&lt;/code&gt; contacte notre &lt;strong&gt;plugin&lt;/strong&gt; (dans le &lt;strong&gt;sidecar&#xA;container&lt;/strong&gt; du cluster) pour lâ€™archivage. Lors de la rÃ©ception dâ€™une&#xA;telle requÃªte, la commande &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest archive-push&lt;/code&gt; va Ãªtre exÃ©cutÃ©e&#xA;(dans le &lt;strong&gt;sidecar container&lt;/strong&gt;) pour archiver le &lt;strong&gt;WAL&lt;/strong&gt; vers un&#xA;&lt;strong&gt;bucket s3&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™appel Ã  notre systÃ¨me dâ€™archivage est possible car CloudNativePG&#xA;utilise et configure la commande dâ€™archivage (&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;archive_command&lt;/code&gt;)&#xA;suivante :&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;controller/manager wal-archive --log-destination /controller/log/postgres.json %p&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le code derriÃ¨re cette commande utilise un systÃ¨me de &lt;strong&gt;hook&lt;/strong&gt; qui&#xA;permet dâ€™appeler les &lt;strong&gt;plugins&lt;/strong&gt; (dont le nÃ´tre) qui exposent les&#xA;&lt;a href=&#34;https://pkg.go.dev/github.com/cloudnative-pg/cnpg-i/pkg/wal#WALCapability_RPC_Type&#34;&gt;&lt;strong&gt;capabilities&lt;/strong&gt; dâ€™archivage et de sauvegarde (Exemple :&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;WALCapability_RPC_TYPE_ARCHIVE_WAL&lt;/code&gt; et&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;BackupCapability_RPC_TYPE_BACKUP&lt;/code&gt;)&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour permettre lâ€™archivage depuis notre &lt;strong&gt;sidecar container&lt;/strong&gt;, ce&#xA;dernier doit avoir accÃ¨s aux &lt;strong&gt;WALs&lt;/strong&gt;. Cela est possible car il est&#xA;configurÃ© (par le contrÃ´leur) pour monter le volume pour le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_data&lt;/code&gt;.&#xA;Le volume contenant les WALs est donc partagÃ© entre les conteneurs&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-plugin&lt;/code&gt; et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il en est de mÃªme lorsquâ€™unÂ·e utilisateurice demande la sauvegarde dâ€™un&#xA;Cluster. pgBackRest (avec la commande pgbackrest backup) est lancÃ©&#xA;depuis le &lt;strong&gt;sidecar container&lt;/strong&gt; dÃ©diÃ©.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;configuration-et-utilisation&#34;&gt;Configuration et utilisation&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;ConcrÃ¨tement, pour utiliser un &lt;strong&gt;plugin&lt;/strong&gt; avec CloudNativePG, il faut&#xA;ajouter une entrÃ©e sous lâ€™entrÃ©e &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;plugins&lt;/code&gt; (prÃ©vue par les &lt;strong&gt;CRD&lt;/strong&gt;) au&#xA;&lt;strong&gt;manifest&lt;/strong&gt; de notre &lt;strong&gt;Cluster&lt;/strong&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;cluster-demo&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;plugins&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;pi&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;pgbackrest.dalibo.com&lt;/span&gt;&#xA;      &lt;span class=&#34;na&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;s3-bucket&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;demo-pgbackrest&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;s3-endpoint&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;s3.fr-par.scw.cloud&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;s3-region&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;fr-par&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;s3-repo-path&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;/demo-pgbackrest/cluster-demo&lt;/span&gt;&#xA;        &lt;span class=&#34;na&#34;&gt;stanza&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;pgbackrest&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;1Gi&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Dans notre cas, nous avons optÃ© pour une approche simple. Les paramÃ¨tres&#xA;pour configurer &lt;strong&gt;pgBackRest&lt;/strong&gt; sont sous la clÃ© &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;parameters&lt;/code&gt; du&#xA;&lt;strong&gt;plugin&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si on applique ce &lt;strong&gt;manifest&lt;/strong&gt; (avec &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;kubectl apply&lt;/code&gt;), on observe que le&#xA;&lt;strong&gt;Pod&lt;/strong&gt; rÃ©sultant est composÃ© de 2 conteneurs:&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get pods &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; default cluster-demo-1&#xA;&lt;span class=&#34;go&#34;&gt;NAME             READY   STATUS    RESTARTS      AGE&#xA;cluster-demo-1   2/2     Running   2 (70m ago)   15h&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;En regardant plus attentivement, on dÃ©couvre le conteneur&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-plugin&lt;/code&gt; en plus de lâ€™habituel conteneur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgres&lt;/code&gt;.&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-plugin&lt;/code&gt; est dÃ©fini avec des variables dâ€™environnement&#xA;contenant la configuration de pgBackRest. Ce &lt;strong&gt;sidecar container&lt;/strong&gt; a Ã©tÃ©&#xA;injectÃ© et configurÃ© par le contrÃ´leur &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbackrest-controller&lt;/code&gt; lors de&#xA;lâ€™initialisation du &lt;strong&gt;cluster&lt;/strong&gt; CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl describe pods &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; default cluster-demo-1&#xA;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Containers:&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;  pgbackrest-plugin:&#xA;    Container ID:  containerd://3733b1d757a30ebb2161d2b14cee0b2fceed8f281706afb02f7b994f1d5863bd&#xA;    Image:         pgbackrest-sidecar&#xA;    Image ID:      docker.io/library/import-2025-03-06@sha256:3b29d3384b12b47e776187b968dcf6608397ec6e3fa1c5e937ba1e089d38e86b&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;    Port:          &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;    Host Port:     &amp;lt;none&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;    Command:&#xA;      /app/bin/cnpg-i-pgbackrest&#xA;    Args:&#xA;      instance&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;    Environment:&#xA;      NAMESPACE:                       default&#xA;      CLUSTER_NAME:                    cluster-demo&#xA;      PGBACKREST_delta:                y&#xA;      PGBACKREST_pg1-path:             /var/lib/postgresql/data/pgdata&#xA;      PGBACKREST_process-max:          2&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;      PGBACKREST_repo1-type:           s3&#xA;      PGBACKREST_stanza:               pgbackrest&#xA;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;      PGBACKREST_repo1-s3-key:         &amp;lt;set to the key &#39;key&#39; in secret &#39;pgbackrest-s3-secret&#39;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous pouvons aussi observer et constater lâ€™archivage des &lt;strong&gt;WALs&lt;/strong&gt; en&#xA;consultant les traces :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl logs &lt;span class=&#34;nt&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;-c&lt;/span&gt; pgbackrest-plugin cluster-demo-1 &lt;span class=&#34;nt&#34;&gt;--namespace&lt;/span&gt; default&#xA;&lt;span class=&#34;go&#34;&gt;{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2025-03-07T11:31:15.206973833Z&#34;,&#34;msg&#34;:&#34;Starting pgbackrest instance plugin&#34;}&#xA;{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2025-03-07T11:31:15.207750359Z&#34;,&#34;logger&#34;:&#34;controller-runtime.metrics&#34;,&#34;msg&#34;:&#34;Starting metrics server&#34;}&#xA;{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2025-03-07T11:31:15.207921755Z&#34;,&#34;msg&#34;:&#34;Starting plugin listener&#34;,&#34;protocol&#34;:&#34;unix&#34;,&#34;socketName&#34;:&#34;/plugins/pgbackrest.dalibo.com&#34;}&#xA;{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2025-03-07T11:31:15.208280361Z&#34;,&#34;msg&#34;:&#34;TCP server not active, skipping TLSCerts generation&#34;}&#xA;{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2025-03-07T11:31:15.208314216Z&#34;,&#34;logger&#34;:&#34;controller-runtime.metrics&#34;,&#34;msg&#34;:&#34;Serving metrics server&#34;,&#34;bindAddress&#34;:&#34;:8080&#34;,&#34;secure&#34;:false}&#xA;{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2025-03-07T11:31:15.208354576Z&#34;,&#34;msg&#34;:&#34;Starting plugin&#34;,&#34;name&#34;:&#34;pgbackrest.dalibo.com&#34;,&#34;displayName&#34;:&#34;pgBackRest demo / experimental plugin&#34;,&#34;version&#34;:&#34;0.0.1&#34;}&#xA;{&#34;level&#34;:&#34;info&#34;,&#34;ts&#34;:&#34;2025-03-07T11:36:17.956473106Z&#34;,&#34;msg&#34;:&#34;pgBackRest archive-push successful&#34;,&#34;WAL&#34;:&#34;/var/lib/postgresql/data/pgdata/pg_wal/000000010000000000000027&#34;}&#xA;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;...&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™archivage et les sauvegardes sont maintenant assurÃ©s par ce conteneur,&#xA;pgBackRest est sollicitÃ© lorsque :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;PostgreSQL exÃ©cute son &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;archive_command&lt;/code&gt;&lt;/li&gt;&#xA;  &lt;li&gt;UnÂ·e utilisateurice demande la sauvegarde dâ€™une instance&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Les &lt;strong&gt;CRD&lt;/strong&gt; (&lt;strong&gt;Custom Resource Definition&lt;/strong&gt;) de CloudNativePG pour les&#xA;sauvegardes permettent, de base, lâ€™utilisation de &lt;strong&gt;plugins&lt;/strong&gt;. Nous&#xA;pouvons dÃ©clarer une sauvegarde avec le &lt;strong&gt;manifest&lt;/strong&gt; suivant :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Backup&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;backup-example&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;plugin&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;pluginConfiguration&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;pgbackrest.dalibo.com&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;cluster-demo&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Il en est de mÃªme pour des sauvegardes planifiÃ©es :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ScheduledBackup&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;backup-example&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;plugin&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;pluginConfiguration&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;pgbackrest.dalibo.com&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;schedule&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&#34;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;*&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;cluster-demo&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&#xA;&lt;p&gt;Cette nouvelle fonctionnalitÃ© bien que complexe, nous semble&#xA;prometteuse. Elle va progressivement prendre de lâ€™ampleur. Lâ€™Ã©quipe qui&#xA;dÃ©veloppe CloudNativePG a annoncÃ© que lâ€™intÃ©gration de composants via&#xA;des &lt;strong&gt;plugins&lt;/strong&gt; deviendra la norme. Par exemple, Barman Cloud, dans les&#xA;prochaines versions de lâ€™opÃ©rateur sera intÃ©grÃ© sous forme de&#xA;&lt;strong&gt;plugin&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Notre preuve de concept nous a permis de :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Tester lâ€™interface CNPG-I ;&lt;/li&gt;&#xA;  &lt;li&gt;Approfondir nos connaissances des mÃ©canismes de sauvegarde avec&#xA;CloudNativePG ;&lt;/li&gt;&#xA;  &lt;li&gt;VÃ©rifier que pgBackRest est en mesure dâ€™archiver et de sauvegarder&#xA;une instance dans un environnement conteneurisÃ© ;&lt;/li&gt;&#xA;  &lt;li&gt;Mettre en lumiÃ¨re cette nouvelle fonctionnalitÃ© expÃ©rimentale.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;De notre cÃ´tÃ©, nous avons prÃ©vu de poursuivre nos expÃ©rimentations avec&#xA;cette interface ainsi que pgBackRest. Nous sommes convaincus que cette&#xA;diversitÃ© ouvre la voie vers une adoption plus large de PostgreSQL dans&#xA;Kubernetes.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si le sujet vous intÃ©resse, nous vous invitons donc Ã  suivre lâ€™activitÃ©&#xA;des projets (et pourquoi pas contribuer) :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://github.com/cloudnative-pg/cnpg-i&#34;&gt;CNPG-I&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://github.com/dalibo/cnpg-plugin-pgbackrest&#34;&gt;plugin&#xA;pgBackRest&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;a href=&#34;https://github.com/cloudnative-pg/barman-cloud/&#34;&gt;plugin Barman&#xA;Cloud&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;!--&#xA;    vim: spelllang=fr spell&#xA;  --&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>Plongez dans le monde de CloudNativePG #5 - CRITICAL - Plus de place !</title>
    <updated>2025-03-24T05:00:00Z</updated>
    <id>tag:blog.dalibo.com,2025-03-24://2025/03/24/cnpg-5.html</id>
    <link href="https://blog.dalibo.com//2025/03/24/cnpg-5.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&lt;em&gt;Lyon, le 24 mars 2025&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;CloudNativePG&lt;/strong&gt; ou comment embarquer un Ã©lÃ©phant sur un porte-conteneurs !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Beaucoup de choses vous ont Ã©tÃ© prÃ©sentÃ©es dans les derniers articles de cette&#xA;sÃ©rie. Bien quâ€™assez techniques et pratiques, ils ne prÃ©sentaient pas vraiment&#xA;de cas concrets, pouvant Ãªtre rencontrÃ©s dans la vraie vie comme on dit. Câ€™est&#xA;chose faite avec le prÃ©sent article qui sâ€™attarde sur un problÃ¨me bien connu des&#xA;administrateurs PostgreSQL : la saturation de lâ€™espace disque ğŸ’¥ !&lt;/p&gt;&#xA;&#xA;&lt;!--MORE--&gt;&#xA;&#xA;&lt;p&gt;&lt;img src=&#34;/img/cnpg-header.png&#34; alt=&#34;moteur&#34; /&gt;&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;cluster-kubernetes&#34;&gt;Cluster Kubernetes&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette fois-ci, nous passons dans la cour des grands en utilisant un vrai cluster&#xA;Kubernetes chez un fournisseur de cloud. Bon â€¦ presque la cour des grands, comme on se&#xA;contentera dâ€™utiliser un cluster managÃ©, mais câ€™est dÃ©jÃ  Ã§a. Une fois dÃ©ployÃ©,&#xA;nous installons lâ€™opÃ©rateur et crÃ©ons un cluster PostgreSQL avec un primaire et un&#xA;secondaire Ã  partir de ce fichier.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-yaml highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;na&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql.cnpg.io/v1&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;Cluster&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;postgresql&lt;/span&gt;&#xA;&lt;span class=&#34;na&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;imageName&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;ghcr.io/cloudnative-pg/postgresql:17.0&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;instances&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;20Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;walStorage&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;4Gi&lt;/span&gt;&#xA;  &lt;span class=&#34;na&#34;&gt;affinity&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt;&#xA;    &lt;span class=&#34;na&#34;&gt;enablePodAntiAffinity&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;true&lt;/span&gt; &#xA;    &lt;span class=&#34;na&#34;&gt;topologyKey&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;kubernetes.io/hostname&lt;/span&gt; &#xA;    &lt;span class=&#34;na&#34;&gt;podAntiAffinityType&lt;/span&gt;&lt;span class=&#34;pi&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;preferred&lt;/span&gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Une bonne pratique dans PostgreSQL souvent recommandÃ©e mais peu appliquÃ©e est&#xA;dâ€™avoir au moins deux espaces de stockage bien distincts :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;Un pour les donnÃ©es ;&lt;/li&gt;&#xA;  &lt;li&gt;Un pour les journaux de transactions (WAL).&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;CloudNativePG respecte cette bonne pratique avec la spÃ©cification&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.walStorage&lt;/code&gt;. Lorsque le cluster est crÃ©Ã©, deux &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistant Volumes&lt;/code&gt;&#xA;distincts seront crÃ©Ã©s automatiquement. Nous ne rentrerons pas dans les dÃ©tails,&#xA;mais sachez quâ€™il est possible de les configurer plus finement, avec&#xA;par exemple le choix dâ€™une &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Storage Class&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;Au passage, la version 17.0 de PostgreSQL date de quelques mois et il existe&#xA;mÃªme la version 17.4 depuis quelques semaines ğŸ’¡. Un article sur la montÃ©e de&#xA;version mineure arrive, câ€™est pour cela que la version 17.0 est toujours&#xA;utilisÃ©e.&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;CrÃ©ons ce cluster. Attendons quelques minutes et voilÃ  nos instances prÃªtes avec&#xA;pour chacune dâ€™elles deux &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistent Volumes&lt;/code&gt;. Les noms des &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CLAIMS&lt;/code&gt; permettent&#xA;de savoir Ã  quoi ils correspondent.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl get persistentvolume &lt;span class=&#34;nt&#34;&gt;-o&lt;/span&gt; custom-columns&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;NAME:.metadata.name,CAPACITY:.spec.capacity.storage,CLAIM:.spec.claimRef.name&#xA;&lt;span class=&#34;go&#34;&gt;NAME                                       CAPACITY   CLAIM&#xA;pvc-09fe198a-ba85-440c-94b4-8de3d32af7dc   10Gi       postgresql-1-wal&#xA;pvc-22e4f5c6-f9b0-4bf9-b375-49e7be2e528b   20Gi       postgresql-1&#xA;pvc-9e8d0c70-c6b7-4941-86d1-7cc53fd67fbd   20Gi       postgresql-2&#xA;pvc-d878ce9c-f85e-4e1b-85a6-f40296a4a318   10Gi       postgresql-2-wal&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;h3 id=&#34;saturation-de-lespace-de-stockage&#34;&gt;Saturation de lâ€™espace de stockage&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Utilisons lâ€™outil &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_bench&lt;/code&gt; pour crÃ©er suffisamment de donnÃ©es et saturer&#xA;lâ€™espace de stockage. Le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;--scale 2000&lt;/code&gt; permet de gÃ©nÃ©rer une&#xA;trentaine de Go de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl cnpg pgbench postgresql &lt;span class=&#34;nt&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--initialize&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;--scale&lt;/span&gt; 2000&#xA;&lt;span class=&#34;go&#34;&gt;job/postgresql-pgbench-876082 created&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;En regardant les traces du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt; (le primaire), nous voyons le&#xA;dÃ©clenchement de nombreux &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CHECKPOINT&lt;/code&gt;. Un peu trop dâ€™ailleurs, PostgreSQL nous&#xA;donne mÃªme une astuce :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;checkpoints are occurring too frequently (15 seconds apart)&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;hint&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Consider increasing the configuration parameter &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;max_wal_size&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;&lt;em&gt;Si vous souhaitez en savoir un peu plus, allez jeter un Å“il Ã  notre article de&#xA;blog sur les &lt;a href=&#34;https://blog.dalibo.com/2024/01/05/cambouis.html&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CHECKPOINTS&lt;/code&gt;&lt;/a&gt; ğŸ“°.&lt;/em&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Revenons Ã  nos traces PostgreSQL. Un peu plus loin, nous trouvons le message de&#xA;mauvais augure &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;No space left on device&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;error_severity&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;PANIC&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;could not write to file &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;pg_wal/xlogtemp.537&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;: No space left on device&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;context&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;writing block 2081579 of relation base/16385/16403&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;COPY pgbench_accounts, line 127099000&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Câ€™est Ã  ce moment lÃ  que votre outil de surveillance vous remonte lâ€™alerte&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CRITICAL - Plus de place !&lt;/code&gt; !&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;plongeons-dans-les-traces&#34;&gt;Plongeons dans les traces&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ne paniquons pas, regardons ce que nous disent les traces et essayons de&#xA;comprendre ce quâ€™il se passe.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La copie de donnÃ©es par &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pgbench&lt;/code&gt; ne peut plus se faire comme lâ€™espace disque&#xA;est saturÃ©. Le backend associÃ© est arrÃªtÃ© :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;server process (PID 537) was terminated by signal 6: Aborted&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;detail&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Failed process was running: copy pgbench_accounts from stdin with (freeze on)&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;backend_type&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postmaster&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ã€ la suite de quoi, lâ€™instance est arrÃªtÃ©e :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;nl&#34;&gt;&#34;message&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;shutting down because &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;restart_after_crash&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\&#34;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; is off&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;backend_type&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postmaster&#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;restart_after_crash&lt;/code&gt; Ã©tant Ã  &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;off&lt;/code&gt;, lâ€™instance PostgreSQL ne va pas&#xA;redÃ©marrer automatiquement. Cela laisse la possibilitÃ© Ã  lâ€™opÃ©rateur de gÃ©rer&#xA;convenablement lâ€™instance. Ce paramÃ¨tre est fixÃ© par lâ€™opÃ©rateur, il nâ€™est pas&#xA;possible de le changer. Il fait partie des &lt;a href=&#34;https://cloudnative-pg.io/documentation/current/postgresql_conf/#fixed-parameters&#34;&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Fixed Parameters&lt;/code&gt;&lt;/a&gt;&#xA;imposÃ©s par CloudNativePG.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Lâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;instance-manager&lt;/code&gt; donne Ã©galement quelques indications :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.138680326Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Checking for free disk space for WALs after PostgreSQL finished&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.157419701Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Detected low-disk space condition&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Lâ€™opÃ©rateur va tenter de redÃ©marrer lui-mÃªme lâ€™instance. Avant de faire cela, il&#xA;vÃ©rifie sâ€™il reste de lâ€™espace disque pour les journaux de transactions.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.202130923Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Checking for free disk space for WALs before starting PostgreSQL&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Comme ce nâ€™est pas le cas, lâ€™instance ne sera pas redÃ©marrÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-json highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;level&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;info&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;ts&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;2025-03-11T07:44:45.222583176Z&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;msg&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;Detected low-disk space condition, avoid starting the instance&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logger&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;instance-manager&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;  &lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;&#34;logging_pod&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&#34;postgresql-1&#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Nous nous retrouvons donc avec une instance primaire arrÃªtÃ©e car son espace&#xA;disque dÃ©diÃ© aux journaux de transactions est saturÃ© ğŸ˜¨. Lâ€™instance secondaire&#xA;attend quant Ã  elle toujours un journal de transactions &#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;&#34;message&#34;: &#34;waiting for WAL to become available at 2/5283F7F3&#34;&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Notez donc quâ€™en cas de saturation du volume de stockage, lâ€™opÃ©rateur ne&#xA;dÃ©clenche pas de bascule sur le secondaire. Avant toute chose, il faut&#xA;rÃ©soudre ce problÃ¨me dâ€™espace disque.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;agrandissement-du-volume&#34;&gt;Agrandissement du volume&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour revenir Ã  une situation normale, nous devons faire deux choses. La&#xA;premiÃ¨re est dâ€™agrandir lâ€™espace dÃ©fini dans le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PVC&lt;/code&gt; associÃ© au volume des&#xA;journaux de transactions de lâ€™instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt;. La seconde est de faire&#xA;correspondre le paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.walStorage.size&lt;/code&gt; de la dÃ©finition du cluster&#xA;PostgreSQL Ã  cette nouvelle taille.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Modifier la taille dâ€™un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PVC&lt;/code&gt; Ã  chaud nâ€™est pas forcÃ©ment possible ! Il est&#xA;nÃ©cessaire que la &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Storage Class&lt;/code&gt; utilisÃ©e le permette via la fonctionnalitÃ©&#xA;de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Volume Expansion&lt;/code&gt;. Par dÃ©faut, la &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Storage Class&lt;/code&gt; utilisÃ©e est&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;sbs-default&lt;/code&gt;. Câ€™est une classe de stockage fournie par le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CSI&lt;/code&gt; du fournisseur cloud. En&#xA;regardant ses informations, nous voyons quâ€™elle implÃ©mente bien cette capacitÃ© :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-console highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;kubectl describe sc sbs-default | &lt;span class=&#34;nb&#34;&gt;grep &lt;/span&gt;AllowVolumeExpansion&#xA;&lt;span class=&#34;go&#34;&gt;AllowVolumeExpansion:  True&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Comprenez donc quâ€™il sâ€™agit dâ€™un critÃ¨re essentiel Ã  prendre en compte lors du&#xA;choix du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CSI&lt;/code&gt; âš ï¸.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La modification du paramÃ¨tre &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.resources.requests.storage&lt;/code&gt; du &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;PVC&lt;/code&gt;&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1-wal&lt;/code&gt; est donc possible Ã  chaud. 1 Go de plus devrait suffire.&#xA;Il ne reste plus quâ€™Ã  modifier la valeur de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;spec.walStorage.size&lt;/code&gt; Ã  5 Go et de&#xA;rÃ©appliquer la dÃ©finition de notre cluster.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Pod&lt;/code&gt; &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt; va redÃ©marrer et, contrairement Ã  tout Ã  lâ€™heure, la&#xA;vÃ©rification de lâ€™espace disque ne bloquera plus. Lâ€™&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;instance-manager&lt;/code&gt; va Ãªtre&#xA;dÃ©marrÃ© suivi par tout le processus de redÃ©marrage de lâ€™instance PostgreSQL&#xA;jusquâ€™au fameux message de trace &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;&#34;database system is ready to accept connection&#34;&lt;/code&gt;.&#xA;Durant tout le procÃ©dÃ©, lâ€™instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-1&lt;/code&gt; a gardÃ© son rÃ´le de primaire,&#xA;et lâ€™instance &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;postgresql-2&lt;/code&gt; son rÃ´le de secondaire. Nous nous retrouvons alors&#xA;dans la situation initiale.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Si vous recevez une alerte &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CRITICAL&lt;/code&gt; sur un volume dÃ©diÃ© aux WALs, vous savez&#xA;maintenant de quoi il en retourne. Vous serez trÃ¨s probablement confrontÃ©s Ã  la&#xA;saturation de lâ€™un ou lâ€™autre de vos &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Persistant Volumes&lt;/code&gt;. PrÃ©parez-vous Ã  cela&#xA;et ayez en tÃªte les diffÃ©rentes Ã©tapes Ã  suivre pour rÃ©soudre ce problÃ¨me.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avant de dÃ©ployer des instances dans Kubernetes, prenez le temps de bien&#xA;choisir le &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;CSI&lt;/code&gt; que vous utiliserez notamment sur les fonctionnalitÃ©s quâ€™il&#xA;possÃ¨de. La fonctionnalitÃ© de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;Volume Expansion&lt;/code&gt; est un &lt;em&gt;must have&lt;/em&gt; !&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;strong&gt;Des questions, des commentaires ? &lt;a href=&#34;mailto:pierrick.chovelon@dalibo.com?subject=[Commentaire-Blog] CloudNativePG&#34;&gt;Ã‰crivez-nous !&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.dalibo.com</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Basics : lire un plan dâ€™exÃ©cution comme unÂ·e pro (ou presque)</title>
    <updated>2025-05-13T15:20:05Z</updated>
    <id>tag:blog.capdata.fr,2025-05-13:/index.php/postgresql-basics-lire-un-plan-dexecution/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;title=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h1&gt;Introduction :&lt;/h1&gt;&#xA;&lt;p&gt;Quand une requÃªte PostgreSQL est considÃ©rÃ©e comme lente ou que ses performances se dÃ©gradent soudainement, il y a un rÃ©flexe Ã  toujours avoir : utiliser les plans d&amp;#8217;exÃ©cution. Je nâ€™apprends certainement rien Ã  la majoritÃ© des personnes qui liront cet article, mais si cela permet de garder vigilants les dÃ©butants et de leur enseigner quelques ficelles, alors cet article vaut le coup.&lt;/p&gt;&#xA;&lt;p&gt;Si vous avez dÃ©jÃ  Ã©tÃ© dans le cas de figure oÃ¹ un plan d&amp;#8217;exÃ©cution est trop gros pour que vous sachiez par quel bout le prendre, ou si vous avez l&amp;#8217;impression qu&amp;#8217;on vous parle chinois quand on Ã©voque les index scan ou les &amp;#8220;cost&amp;#8221; d&amp;#8217;une requÃªte, alors vous Ãªtes au bon endroit.&lt;/p&gt;&#xA;&lt;p&gt;Dans cet article, premier d&amp;#8217;une sÃ©rie sur les bases de PostgreSQL, nous allons dÃ©mystifier l&amp;#8217;optimisation des requÃªtes en utilisant EXPLAIN comme point de dÃ©part, et les plans d&amp;#8217;exÃ©cution gÃ©nÃ©rÃ©s comme fil conducteur.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™objectif : vous aider Ã  identifier rapidement les informations clÃ©s, repÃ©rer les goulots dâ€™Ã©tranglement, et gagner en autonomie pour diagnostiquer les performances de vos requÃªtes.&lt;/p&gt;&#xA;&lt;p&gt;Câ€™est parti !&lt;/p&gt;&#xA;&lt;h2&gt;EXPLAIN ANALYZE : câ€™est quoi exactement et pourquoi lâ€™utiliser ?&lt;/h2&gt;&#xA;&lt;p&gt;Pour commencer, il faut savoir qu&amp;#8217;un moteur de base de donnÃ©es, que ce soit PostgreSQL ou un autre ne &amp;#8220;lit&amp;#8221; pas une requÃªte comme un humain pourrait la lire, de gauche Ã  droite. Il Ã©labore plutÃ´t un plan d&amp;#8217;exÃ©cution : il crÃ©Ã© un ensemble d&amp;#8217;Ã©tape qui se veulent le plus optimisÃ©es possible pour aller chercher les donnÃ©es que vous lui demander de la faÃ§on la plus efficace possible.&lt;/p&gt;&#xA;&lt;p&gt;Il y a un moyen simple de voir ce plan d&amp;#8217;exÃ©cution, c&amp;#8217;est d&amp;#8217;utiliser la commande EXPLAIN ANALYZE. Elle nous permet en plus de comprendre de quelle faÃ§on le moteur Ã  rÃ©ellement exÃ©cutÃ© notre ordre SQL (et pas seulement comment il pensait le faire). C&amp;#8217;est un peu comme lire un journal de bord de l&amp;#8217;exÃ©cution de la requÃªte.&lt;/p&gt;&#xA;&lt;h3&gt;Prenons un exemple simple :&lt;/h3&gt;&#xA;&lt;p&gt;Imaginons que nous avons une table users, constituÃ©e comme tel :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;CREATE TABLE users (&#xD;&#xA;id integer PRIMARY KEY,&#xD;&#xA;name vachar(30),&#xD;&#xA;age integer,&#xD;&#xA;email varchar(80) );&lt;/pre&gt;&#xA;&lt;p&gt;Et que nous souhaitons utiliser la requÃªte suivante dans notre application :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;SELECT * FROM users WHERE email = &#39;foo@example.com&#39;;&lt;/pre&gt;&#xA;&lt;p&gt;Sur cette table, nous n&amp;#8217;avons pas d&amp;#8217;index. Voici donc ce Ã  quoi pourrait ressembler notre plan d&amp;#8217;Ã©xecution si nous utilisons la commande :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;EXPLAIN ANALYZE SELECT * FROM users WHERE email = &#39;foo@example.com&#39;;&#xD;&#xA;&#xD;&#xA;Seq Scan on users (cost=0.00..35.50 rows=1 width=100)&#xD;&#xA;Filter: (email = &#39;foo@example.com&#39;)&#xD;&#xA;Rows Removed by Filter: 999&#xD;&#xA;Actual time=0.010..0.420 rows=1 loops=1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Les termes du plan d&amp;#8217;exÃ©cution :&lt;/h3&gt;&#xA;&lt;p&gt;A premiÃ¨re vue, il n&amp;#8217;est pas Ã©vident de comprendre tout les termes que l&amp;#8217;on voit dans le plan d&amp;#8217;exÃ©cution gÃ©nÃ©rÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Voici un rÃ©capitulatif des principaux :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Seq Scan / Index Scan :&lt;/strong&gt; Le type de parcours utilisÃ© (sÃ©quentiel ou via un index)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;cost=â€¦ :&lt;/strong&gt; Estimation du &amp;#8220;coÃ»t&amp;#8221; total de lâ€™opÃ©ration, selon PostgreSQL. Le coÃ»t n&amp;#8217;est pas exprimÃ© dans une unitÃ© particuliÃ¨re, c&amp;#8217;est juste un indicatif. Plus il est Ã©levÃ©, plus l&amp;#8217;opÃ©ration est &amp;#8220;coÃ»teuse&amp;#8221;, notre but Ã©tant d&amp;#8217;Ã©viter les coÃ»ts Ã©normes pour que tout soit plus simple.&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;rows=â€¦ :&lt;/strong&gt; Estimation du nombre de lignes que l&amp;#8217;Ã©tape va retourner&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;actual time=â€¦ :&lt;/strong&gt; Le temps rÃ©el que cette Ã©tape a pris (en millisecondes)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Rows Removed by Filter :&lt;/strong&gt; Nombre de lignes lues mais Ã©liminÃ©es par un filtre&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;loops=1 :&lt;/strong&gt; Nombre de fois que cette Ã©tape a Ã©tÃ© exÃ©cutÃ©e (ex. dans une boucle)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3&gt;Puis un exemple plus compliquÃ© :&lt;/h3&gt;&#xA;&lt;p&gt;Attention, tout les plans d&amp;#8217;exÃ©cution de requÃªte ne sont pas aussi simples que celui que je viens de vous prÃ©senter. Bien souvent ils se prÃ©sentent sous la forme de plusieurs nÅ“uds indentÃ©sÂ  qu&amp;#8217;il faut lire dans le bon ordre. Imaginons une nouvelle table orders qui rÃ©pertorie les commandes passÃ©es par un user :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;CREATE TABLE orders (&#xD;&#xA;id_orders integer PRIMARY KEY,&#xD;&#xA;created_at timestamp,&#xD;&#xA;total numeric,&#xD;&#xA;status text,&#xD;&#xA;user_id integer references users(id));&lt;/pre&gt;&#xA;&lt;p&gt;Nous pouvons alors imaginer la requÃªte suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;SELECT u.name, o.total, o.created_at&#xD;&#xA;FROM users u&#xD;&#xA;JOIN orders o ON u.id = o.user_id&#xD;&#xA;WHERE o.status = &#39;completed&#39;&#xD;&#xA;ORDER BY o.created_at DESC&#xD;&#xA;LIMIT 10;&lt;/pre&gt;&#xA;&lt;p&gt;Qui remonte les dix premiÃ¨res commandes,Â  avec le nom de l&amp;#8217;acheteur, le total de la commande et sa date, pour les 10 premiÃ¨res commandes dans l&amp;#8217;ordre des dates dont le statut est &amp;#8220;completed&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Si on execute un explain analyze sur cette requÃªte, on obtient un plan d&amp;#8217;execution de cet ordre :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; Limit (cost=123.45..123.48 rows=10 width=40) (actual time=1.234..1.239 rows=10 loops=1)&#xD;&#xA;   -&amp;amp;gt; Sort (cost=123.45..130.00 rows=2620 width=40) (actual time=1.234..1.236 rows=10 loops=1)&#xD;&#xA;      Sort Key: o.created_at DESC&#xD;&#xA;      Sort Method: top-N heapsort Memory: 25kB&#xD;&#xA;       -&amp;amp;gt; Nested Loop (cost=0.42..100.00 rows=2620 width=40) (actual time=0.045..0.980 rows=200 loops=1)&#xD;&#xA;            -&amp;amp;gt; Index Scan using idx_orders_created_at on orders o (cost=0.29..45.00 rows=2620 width=24) (actual time=0.030..0.340 rows=200 loops=1)&#xD;&#xA;                 Filter: (status = &#39;completed&#39;)&#xD;&#xA;                 Rows Removed by Filter: 50&#xD;&#xA;            -&amp;amp;gt; Index Scan using users_pkey on users u (cost=0.13..0.20 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=200)&#xD;&#xA;                 Index Cond: (id = o.user_id)&lt;/pre&gt;&#xA;&lt;p&gt;Si on devait visualiser ce plan d&amp;#8217;exÃ©cution de maniÃ¨re graphique pour qu&amp;#8217;il soit plus simple Ã  lire, Ã§a donnerait Ã§a :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX.png&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone wp-image-10701&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-300x170.png&#34; alt=&#34;&#34; width=&#34;508&#34; height=&#34;288&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-300x170.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX-768x434.png 768w, https://blog.capdata.fr/wp-content/uploads/2025/04/chrome_zyhdtutiuX.png 853w&#34; sizes=&#34;auto, (max-width: 508px) 100vw, 508px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3&gt;Comment lire un plan d&amp;#8217;exÃ©cution :&lt;/h3&gt;&#xA;&lt;p&gt;Pour lire un plan d&amp;#8217;exÃ©cution, on part toujours du nÅ“ud le plus indentÃ©, puis on remonte vers les nÅ“uds supÃ©rieur. Dans notre cas, on partirais des deux index scan pour remonter ensuite sur le Nested Loop, puis sur le Sort, et enfin sur le Limit.&lt;br /&gt;&#xA;La raison est simple : le plan dâ€™exÃ©cution reflÃ¨te lâ€™ordre rÃ©el dâ€™exÃ©cution de la requÃªte par PostgreSQL.&lt;br /&gt;&#xA;Chaque Ã©tape du plan consomme les rÃ©sultats produits par les Ã©tapes prÃ©cÃ©dentes. Autrement dit : PostgreSQL commence par les opÃ©rations de lecture (accÃ¨s aux tables, scans dâ€™index&amp;#8230;), puis applique les jointures, les filtres, les tris, etc. en remontant vers le haut du plan.&lt;br /&gt;&#xA;Le nÅ“ud le plus &amp;#8220;haut&amp;#8221; du plan (celui avec le moins dâ€™indentation) correspond Ã  lâ€™opÃ©ration finale, celle qui retourne les rÃ©sultats Ã  lâ€™utilisateur. Les blocs en dessous (plus indentÃ©s) sont les dÃ©pendances nÃ©cessaires pour y arriver.&lt;br /&gt;&#xA;Câ€™est donc une logique de pipeline de traitement :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;Lire les donnÃ©es&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les filtrer&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les combiner&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les trier / agrÃ©ger&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Les retourner&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Lire un plan dâ€™exÃ©cution &amp;#8220;du plus profond vers le haut&amp;#8221;, câ€™est suivre le chemin de vie dâ€™une ligne de rÃ©sultat depuis le disque jusquâ€™Ã  votre terminal.&lt;/p&gt;&#xA;&lt;h3&gt;Petite encyclopÃ©die des nÅ“uds les plus courants dans un plan dâ€™exÃ©cution&lt;/h3&gt;&#xA;&lt;p&gt;Voici une sÃ©lection des nÅ“uds que vous croiserez rÃ©guliÃ¨rement dans les plans dâ€™exÃ©cution PostgreSQL, avec une explication simple et directe pour chacun :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;251&#34; data-end=&#34;420&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;253&#34; data-end=&#34;420&#34;&gt;&lt;strong data-start=&#34;253&#34; data-end=&#34;265&#34;&gt;Seq Scan&lt;/strong&gt;&lt;br data-start=&#34;265&#34; data-end=&#34;268&#34; /&gt;Lecture sÃ©quentielle de toute la table.&lt;br data-start=&#34;309&#34; data-end=&#34;312&#34; /&gt;&lt;em data-start=&#34;317&#34; data-end=&#34;331&#34;&gt;Ã€ surveiller&lt;/em&gt; : Normal sur petites tables, mais sur les grosses, cela peut indiquer un index manquant.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;422&#34; data-end=&#34;607&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;424&#34; data-end=&#34;607&#34;&gt;&lt;strong data-start=&#34;424&#34; data-end=&#34;438&#34;&gt;Index Scan&lt;/strong&gt;&lt;br data-start=&#34;438&#34; data-end=&#34;441&#34; /&gt;Parcours dâ€™un index pour chercher les lignes correspondantes.&lt;br data-start=&#34;504&#34; data-end=&#34;507&#34; /&gt;&lt;em data-start=&#34;512&#34; data-end=&#34;526&#34;&gt;Ã€ surveiller&lt;/em&gt; : Rapide si lâ€™index est bien choisi. Peut devenir lent avec beaucoup de &lt;em data-start=&#34;599&#34; data-end=&#34;606&#34;&gt;loops&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;609&#34; data-end=&#34;804&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;611&#34; data-end=&#34;804&#34;&gt;&lt;strong data-start=&#34;611&#34; data-end=&#34;630&#34;&gt;Index Only Scan&lt;/strong&gt;&lt;br data-start=&#34;630&#34; data-end=&#34;633&#34; /&gt;Comme un Index Scan, mais sans lire la table si toutes les colonnes nÃ©cessaires sont dÃ©jÃ  dans lâ€™index.&lt;br data-start=&#34;740&#34; data-end=&#34;743&#34; /&gt;&lt;em data-start=&#34;748&#34; data-end=&#34;762&#34;&gt;Ã€ surveiller&lt;/em&gt; : Ultra-performant ! Ã€ viser si possible.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;806&#34; data-end=&#34;1031&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;808&#34; data-end=&#34;1031&#34;&gt;&lt;strong data-start=&#34;808&#34; data-end=&#34;829&#34;&gt;Bitmap Index Scan&lt;/strong&gt; + &lt;strong data-start=&#34;832&#34; data-end=&#34;852&#34;&gt;Bitmap Heap Scan&lt;/strong&gt;&lt;br data-start=&#34;852&#34; data-end=&#34;855&#34; /&gt;PostgreSQL construit une &amp;#8220;carte&amp;#8221; des lignes Ã  lire, puis les rÃ©cupÃ¨re en une seule passe.&lt;br data-start=&#34;946&#34; data-end=&#34;949&#34; /&gt;&lt;em data-start=&#34;954&#34; data-end=&#34;968&#34;&gt;Ã€ surveiller&lt;/em&gt; : TrÃ¨s performant pour des filtres avec beaucoup de rÃ©sultats.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1033&#34; data-end=&#34;1244&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1035&#34; data-end=&#34;1244&#34;&gt;&lt;strong data-start=&#34;1035&#34; data-end=&#34;1050&#34;&gt;Nested Loop&lt;/strong&gt;&lt;br data-start=&#34;1050&#34; data-end=&#34;1053&#34; /&gt;Pour chaque ligne de la premiÃ¨re table, PostgreSQL cherche dans la seconde.&lt;br data-start=&#34;1130&#34; data-end=&#34;1133&#34; /&gt;&lt;em data-start=&#34;1138&#34; data-end=&#34;1152&#34;&gt;Ã€ surveiller&lt;/em&gt; : Bien sur de petits volumes, mais peut exploser sur de grandes tables (effet quadratique).&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1246&#34; data-end=&#34;1445&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1248&#34; data-end=&#34;1445&#34;&gt;&lt;strong data-start=&#34;1248&#34; data-end=&#34;1261&#34;&gt;Hash Join&lt;/strong&gt;&lt;br data-start=&#34;1261&#34; data-end=&#34;1264&#34; /&gt;PostgreSQL construit une table de hachage en mÃ©moire pour faire la jointure.&lt;br data-start=&#34;1342&#34; data-end=&#34;1345&#34; /&gt;&lt;em data-start=&#34;1350&#34; data-end=&#34;1364&#34;&gt;Ã€ surveiller&lt;/em&gt; : Performant si la mÃ©moire le permet. Attention Ã  la taille des jeux de donnÃ©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1447&#34; data-end=&#34;1621&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1449&#34; data-end=&#34;1621&#34;&gt;&lt;strong data-start=&#34;1449&#34; data-end=&#34;1463&#34;&gt;Merge Join&lt;/strong&gt;&lt;br data-start=&#34;1463&#34; data-end=&#34;1466&#34; /&gt;Jointure optimisÃ©e entre deux sources dÃ©jÃ  triÃ©es.&lt;br data-start=&#34;1518&#34; data-end=&#34;1521&#34; /&gt;&lt;em data-start=&#34;1526&#34; data-end=&#34;1540&#34;&gt;Ã€ surveiller&lt;/em&gt; : Excellent en perfs si les colonnes jointes sont indexÃ©es ou triÃ©es Ã  lâ€™avance.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1623&#34; data-end=&#34;1794&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1625&#34; data-end=&#34;1794&#34;&gt;&lt;strong data-start=&#34;1625&#34; data-end=&#34;1638&#34;&gt;Aggregate&lt;/strong&gt;&lt;br data-start=&#34;1638&#34; data-end=&#34;1641&#34; /&gt;Calcule une agrÃ©gation (COUNT, SUM, AVG, &amp;#8230;).&lt;br data-start=&#34;1696&#34; data-end=&#34;1699&#34; data-is-only-node=&#34;&#34; /&gt;&lt;em data-start=&#34;1704&#34; data-end=&#34;1718&#34;&gt;Ã€ surveiller&lt;/em&gt; : Peut Ãªtre coÃ»teux si lâ€™agrÃ©gation se fait sur de gros volumes sans index.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1796&#34; data-end=&#34;1959&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1798&#34; data-end=&#34;1959&#34;&gt;&lt;strong data-start=&#34;1798&#34; data-end=&#34;1806&#34;&gt;Sort&lt;/strong&gt;&lt;br data-start=&#34;1806&#34; data-end=&#34;1809&#34; /&gt;Trie les donnÃ©es selon une ou plusieurs colonnes.&lt;br data-start=&#34;1860&#34; data-end=&#34;1863&#34; /&gt;&lt;em data-start=&#34;1868&#34; data-end=&#34;1882&#34;&gt;Ã€ surveiller&lt;/em&gt; : Peut consommer beaucoup de mÃ©moire ; un bon index peut Ã©viter cette Ã©tape.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1961&#34; data-end=&#34;2136&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1963&#34; data-end=&#34;2136&#34;&gt;&lt;strong data-start=&#34;1963&#34; data-end=&#34;1972&#34;&gt;Limit&lt;/strong&gt;&lt;br data-start=&#34;1972&#34; data-end=&#34;1975&#34; /&gt;Tronque le rÃ©sultat Ã  N lignes.&lt;br data-start=&#34;2010&#34; data-end=&#34;2013&#34; /&gt;&lt;em data-start=&#34;2018&#34; data-end=&#34;2032&#34;&gt;Ã€ surveiller&lt;/em&gt; : TrÃ¨s utile combinÃ© avec ORDER BY, car PostgreSQL peut sâ€™arrÃªter dÃ¨s quâ€™il a assez de lignes triÃ©es.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2138&#34; data-end=&#34;2327&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2140&#34; data-end=&#34;2327&#34;&gt;&lt;strong data-start=&#34;2140&#34; data-end=&#34;2152&#34;&gt;CTE Scan&lt;/strong&gt;&lt;br data-start=&#34;2152&#34; data-end=&#34;2155&#34; /&gt;UtilisÃ© quand vous avez une clause WITHÂ (CTE â€“ Common Table Expression).&lt;br data-start=&#34;2231&#34; data-end=&#34;2234&#34; /&gt;&lt;em data-start=&#34;2239&#34; data-end=&#34;2253&#34;&gt;Ã€ surveiller&lt;/em&gt; : Si le CTE nâ€™est pas matÃ©rialisÃ©, il peut Ãªtre recalculÃ© Ã  chaque appel.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Options utiles de EXPLAIN / EXPLAIN ANALYZE&lt;/h2&gt;&#xA;&lt;p&gt;La commande EXPLAIN (et sa variante EXPLAIN ANALYZE) peut Ãªtre enrichie avec plusieurs options facultatives pour mieux comprendre ce que PostgreSQL fait avec vos requÃªtes. Voici une prÃ©sentation des principales.&lt;/p&gt;&#xA;&lt;h4&gt;ANALYZE : exÃ©cuter la requÃªte pour de vrai&lt;/h4&gt;&#xA;&lt;p&gt;Cette option (souvent appelÃ©e â€œEXPLAIN ANALYZEâ€) &lt;strong&gt;exÃ©cute rÃ©ellement la requÃªte&lt;/strong&gt; et mesure les temps d&amp;#8217;exÃ©cution.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN ANALYZE SELECT * FROM users WHERE email = &#39;foo@example.com&#39;; &lt;/pre&gt;&#xA;&lt;p&gt;Sans cette option, PostgreSQL ne fait quâ€™estimer le plan, il ne lâ€™exÃ©cute pas rÃ©ellement.&lt;/p&gt;&#xA;&lt;h4&gt;VERBOSE: plus de dÃ©tails sur les colonnes et les expressions&lt;/h4&gt;&#xA;&lt;p&gt;Affiche le nom exact des colonnes internes et les expressions utilisÃ©es dans chaque Ã©tape du plan.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, VERBOSE) SELECT name FROM users WHERE age &amp;amp;gt; 30; &lt;/pre&gt;&#xA;&lt;p&gt;TrÃ¨s utile quand on travaille avec des fonctions, des agrÃ©gats ou des vues complexes.&lt;/p&gt;&#xA;&lt;h4&gt;BUFFERS : dÃ©tail des lectures mÃ©moire et disque&lt;/h4&gt;&#xA;&lt;p&gt;Montre combien de blocs de donnÃ©es ont Ã©tÃ© lus en mÃ©moire (cache partagÃ©) et depuis le disque.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM orders WHERE status = &#39;completed&#39;; &lt;/pre&gt;&#xA;&lt;p&gt;IdÃ©al pour identifier si une requÃªte est ralentie par des accÃ¨s disques trop nombreux.&lt;/p&gt;&#xA;&lt;h4&gt;WAL : suivi des Ã©critures dans le journal de transactions&lt;/h4&gt;&#xA;&lt;p&gt;Affiche lâ€™impact de la requÃªte sur le WAL (Write-Ahead Logging), câ€™est-Ã -dire les Ã©critures nÃ©cessaires Ã  la durabilitÃ©.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, WAL) INSERT INTO logs SELECT * FROM events; &lt;/pre&gt;&#xA;&lt;p&gt;Surtout utile pour comprendre le coÃ»t cachÃ© des requÃªtes dâ€™Ã©criture.&lt;/p&gt;&#xA;&lt;h4&gt;COSTS : afficher ou masquer les coÃ»ts estimÃ©s&lt;/h4&gt;&#xA;&lt;p&gt;Permet de dÃ©sactiver les lignes cost=&amp;#8230; si on veut se concentrer uniquement sur les temps rÃ©els (actual time).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, COSTS OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Pratique pour allÃ©ger la lecture dâ€™un plan quand on nâ€™a pas besoin des estimations.&lt;/p&gt;&#xA;&lt;h4&gt;SETTINGS : voir les paramÃ¨tres ayant influencÃ© le plan&lt;/h4&gt;&#xA;&lt;p&gt;Affiche les paramÃ¨tres de configuration de PostgreSQL qui ont eu un impact sur la gÃ©nÃ©ration du plan.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, SETTINGS) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;TrÃ¨s utile pour le debug avancÃ©, ou si certains paramÃ¨tres sont modifiÃ©s via SET.&lt;/p&gt;&#xA;&lt;h4&gt;SUMMARY : afficher ou non les temps globaux&lt;/h4&gt;&#xA;&lt;p&gt;ContrÃ´le lâ€™affichage du rÃ©sumÃ© final (Planning Time, Execution Time).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, SUMMARY OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Par dÃ©faut activÃ©, mais vous pouvez le dÃ©sactiver si vous ne souhaitez pas ces infos Ã  la fin du plan.&lt;/p&gt;&#xA;&lt;h4&gt;TIMING : activer ou dÃ©sactiver la mesure des temps internes&lt;/h4&gt;&#xA;&lt;p&gt;PostgreSQL mesure le actual time pour chaque nÅ“ud du plan. Cette option permet de dÃ©sactiver ces mesures (utile pour les trÃ¨s petites requÃªtes ou les benchmarks massifs).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, TIMING OFF) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;DÃ©sactive les mesures fines, ce qui peut lÃ©gÃ¨rement amÃ©liorer les performances du plan dâ€™analyse lui-mÃªme.&lt;/p&gt;&#xA;&lt;h4&gt;FORMAT : changer la sortie (TEXT, JSON, YAML)&lt;/h4&gt;&#xA;&lt;p&gt;Permet dâ€™obtenir un plan dans un format structurÃ© (parfait pour les outils externes comme explain.dalibo.com).&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; EXPLAIN (ANALYZE, FORMAT JSON) SELECT * FROM users; &lt;/pre&gt;&#xA;&lt;p&gt;Pratique pour gÃ©nÃ©rer un plan visuel, lâ€™analyser en script, ou lâ€™intÃ©grer dans des outils de perf.&lt;/p&gt;&#xA;&lt;h2&gt;OK super, mais une fois qu&amp;#8217;on sait Ã§a, on en fait quoi ?&lt;/h2&gt;&#xA;&lt;p data-start=&#34;260&#34; data-end=&#34;525&#34;&gt;On pourrait passer des heures Ã  dÃ©cortiquer les diffÃ©rentes lignes d&amp;#8217;un plan d&amp;#8217;exÃ©cution sans pour autant avancer plus que Ã§a. L&amp;#8217;important est maintenant de savoir quoi en faire. Parce que c&amp;#8217;est bien beau de l&amp;#8217;afficher, encore faut-il savoir quoi y chercher.&lt;/p&gt;&#xA;&lt;p data-start=&#34;260&#34; data-end=&#34;525&#34;&gt;Voici une petite liste non exhaustive des indices Ã  repÃ©rer dans un plan d&amp;#8217;exÃ©cution qui pourraient vous mener Ã  une raison pour la lenteur de votre requÃªte :&lt;/p&gt;&#xA;&lt;h3&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.1.0/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Une lecture sÃ©quentielle sur une grosse table :&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;659&#34; data-end=&#34;678&#34;&gt;&lt;strong data-start=&#34;659&#34; data-end=&#34;674&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Seq Scan on users  (rows=100000)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;725&#34; data-end=&#34;755&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;755&#34; data-end=&#34;758&#34; /&gt;PostgreSQL lit toute la table ligne par ligne. Câ€™est trÃ¨s lent et parfaitement inutile, surtout si vous ne voulez que quelques lignes de cette table.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;861&#34; data-end=&#34;887&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;890&#34; data-end=&#34;992&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;890&#34; data-end=&#34;914&#34;&gt;On note la prÃ©sence d&amp;#8217;un nÅ“ud SEQ SCAN dans notre plan d&amp;#8217;exÃ©cution&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;915&#34; data-end=&#34;992&#34;&gt;Nombre de lignes parcourues trÃ¨s Ã©levÃ© (puce rows ou prÃ©sence de row removed by filter)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong data-start=&#34;994&#34; data-end=&#34;1010&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1011&#34; data-end=&#34;1184&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1011&#34; data-end=&#34;1085&#34;&gt;Ajouter un index sur la colonne filtrÃ©e peut souvent aider dans ce genre de cas.&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1086&#34; data-end=&#34;1184&#34;&gt;RÃ©Ã©crire la requÃªte pour quâ€™elle utilise une clause mieux optimisÃ©e (exclusion, inclusion&amp;#8230;)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.1.0/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Trop de Loop&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1242&#34; data-end=&#34;1261&#34;&gt;&lt;strong data-start=&#34;1242&#34; data-end=&#34;1257&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Index Scan using users_pkey on users  (loops=10000)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1327&#34; data-end=&#34;1489&#34;&gt;&lt;strong data-start=&#34;1327&#34; data-end=&#34;1357&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;1357&#34; data-end=&#34;1360&#34; /&gt;Une opÃ©ration lente est rÃ©pÃ©tÃ©e pour chaque ligne de lâ€™opÃ©ration extÃ©rieure, souvent dans une jointure en boucle (Nested Loop).&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1491&#34; data-end=&#34;1519&#34;&gt;&lt;strong data-start=&#34;1491&#34; data-end=&#34;1517&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1520&#34; data-end=&#34;1575&#34;&gt;&#xA;&lt;li data-start=&#34;1520&#34; data-end=&#34;1535&#34;&gt;Nombre de loop trÃ¨s Ã©levÃ©s&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1520&#34; data-end=&#34;1535&#34;&gt;Souvent prÃ©cÃ©dÃ© d&amp;#8217;un Nested Loop plus haut dans le plan d&amp;#8217;exÃ©cution&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1577&#34; data-end=&#34;1593&#34;&gt;&lt;strong data-start=&#34;1577&#34; data-end=&#34;1593&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;1594&#34; data-end=&#34;1764&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1594&#34; data-end=&#34;1657&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1596&#34; data-end=&#34;1657&#34;&gt;Changer le type de jointure pour quelque chose de plus simple a traiter (hash join ou merge join)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1658&#34; data-end=&#34;1715&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1660&#34; data-end=&#34;1715&#34;&gt;RÃ©Ã©crire la requÃªte pour faire moins de &amp;#8220;aller-retours&amp;#8221;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;1716&#34; data-end=&#34;1764&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1718&#34; data-end=&#34;1764&#34;&gt;Ajouter des index pour faciliter les jointures&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;1718&#34; data-end=&#34;1764&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.1.0/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Des estimations loin de la rÃ©alitÃ©&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1826&#34; data-end=&#34;1845&#34;&gt;&lt;strong data-start=&#34;1826&#34; data-end=&#34;1841&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;rows=10   actual rows=10000&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1887&#34; data-end=&#34;2017&#34;&gt;&lt;strong data-start=&#34;1887&#34; data-end=&#34;1917&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;1917&#34; data-end=&#34;1920&#34; /&gt;PostgreSQL sâ€™est trompÃ© dans son estimation, ce qui lâ€™a peut-Ãªtre menÃ© Ã  choisir un mauvais plan.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2019&#34; data-end=&#34;2179&#34;&gt;&lt;strong data-start=&#34;2019&#34; data-end=&#34;2045&#34;&gt;Comment le voir&lt;/strong&gt;&lt;br data-start=&#34;2045&#34; data-end=&#34;2048&#34; /&gt;Comparez le nombre de rows (estimation) avec les actual rows. Si lâ€™Ã©cart est trÃ¨s important, les statistiques sont probablement obsolÃ¨tes.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2181&#34; data-end=&#34;2197&#34;&gt;&lt;strong data-start=&#34;2181&#34; data-end=&#34;2197&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2198&#34; data-end=&#34;2421&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2198&#34; data-end=&#34;2259&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2200&#34; data-end=&#34;2259&#34;&gt;Rafraichir les statistiques dans ce cas ne peut pas faire de mal : Analyze ou vaccuum analyze si nÃ©cessaire.&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2260&#34; data-end=&#34;2352&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2262&#34; data-end=&#34;2352&#34;&gt;Ajuster les statistiques&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2353&#34; data-end=&#34;2421&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2355&#34; data-end=&#34;2421&#34;&gt;Ã‰viter les expressions trop complexes qui biaisent les estimations&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;2355&#34; data-end=&#34;2421&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.1.0/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Un tri qui consomme trop&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2494&#34; data-end=&#34;2513&#34;&gt;&lt;strong data-start=&#34;2494&#34; data-end=&#34;2509&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Sort  (Sort Method: quicksort / external merge, Memory: 100MB)&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2590&#34; data-end=&#34;2723&#34;&gt;&lt;strong data-start=&#34;2590&#34; data-end=&#34;2620&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;2620&#34; data-end=&#34;2623&#34; /&gt;Le tri est trop gros, PostgreSQL nâ€™arrive plus Ã  le faire en RAM â†’ il passe sur disque â†’ câ€™est lent.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2725&#34; data-end=&#34;2753&#34;&gt;&lt;strong data-start=&#34;2725&#34; data-end=&#34;2751&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2754&#34; data-end=&#34;2879&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2754&#34; data-end=&#34;2813&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2756&#34; data-end=&#34;2813&#34;&gt;NÅ“ud SORT avec un SORT METHOD lent (EXTERNAL MERGE)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2814&#34; data-end=&#34;2843&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2816&#34; data-end=&#34;2843&#34;&gt;Consommation mÃ©moire Ã©levÃ©e&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2844&#34; data-end=&#34;2879&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2846&#34; data-end=&#34;2879&#34;&gt;Ã‰tape qui prend beaucoup de temps&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2881&#34; data-end=&#34;2897&#34;&gt;&lt;strong data-start=&#34;2881&#34; data-end=&#34;2897&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;2898&#34; data-end=&#34;3077&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2898&#34; data-end=&#34;2962&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2900&#34; data-end=&#34;2962&#34;&gt;Ajouter un index sur les colonnes utilisÃ©es dans le ORDER BY&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;2963&#34; data-end=&#34;3027&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;2965&#34; data-end=&#34;3027&#34;&gt;RÃ©duire la quantitÃ© de lignes Ã  trier avec un LIMITÂ en amont&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3028&#34; data-end=&#34;3077&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3030&#34; data-end=&#34;3077&#34;&gt;Ã‰viter les sous-requÃªtes non filtrÃ©es avant tri&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;3030&#34; data-end=&#34;3077&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.1.0/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Une clause Limit inefficace&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3164&#34; data-end=&#34;3183&#34;&gt;&lt;strong data-start=&#34;3164&#34; data-end=&#34;3179&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Sort â†’ Limit&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3210&#34; data-end=&#34;3355&#34;&gt;&lt;strong data-start=&#34;3210&#34; data-end=&#34;3240&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;3240&#34; data-end=&#34;3243&#34; /&gt;PostgreSQL trie &lt;em data-start=&#34;3259&#34; data-end=&#34;3266&#34;&gt;toute&lt;/em&gt; la table avant dâ€™en extraire 10 lignes. Sâ€™il y a 1 million de lignes, câ€™est pas optimal.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3357&#34; data-end=&#34;3385&#34;&gt;&lt;strong data-start=&#34;3357&#34; data-end=&#34;3383&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3386&#34; data-end=&#34;3479&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3386&#34; data-end=&#34;3422&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3388&#34; data-end=&#34;3422&#34;&gt;Le SORT est au-dessus du LIMIT&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3423&#34; data-end=&#34;3479&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3425&#34; data-end=&#34;3479&#34;&gt;Le tri prend beaucoup de temps mÃªme pour un LIMIT 10&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3481&#34; data-end=&#34;3497&#34;&gt;&lt;strong data-start=&#34;3481&#34; data-end=&#34;3497&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3498&#34; data-end=&#34;3678&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3498&#34; data-end=&#34;3588&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3500&#34; data-end=&#34;3588&#34;&gt;Utiliser un index qui permet de lire dÃ©jÃ  triÃ© (ORDER BY created_at DESCÂ â†’ index DESC)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3589&#34; data-end=&#34;3678&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3591&#34; data-end=&#34;3678&#34;&gt;Repenser la requÃªte pour Ã©viter le tri global (ex : prÃ©filtrage ou pagination efficace)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 data-start=&#34;3591&#34; data-end=&#34;3678&#34;&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.1.0/72x72/1f50e.png&#34; alt=&#34;ğŸ”&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt; Des filtres appliquÃ©s trop tard&lt;/h3&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3744&#34; data-end=&#34;3763&#34;&gt;&lt;strong data-start=&#34;3744&#34; data-end=&#34;3759&#34;&gt;SymptÃ´me&lt;/strong&gt; :&lt;/p&gt;&#xA;&lt;div class=&#34;contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary&#34;&gt;&#xA;&lt;div class=&#34;overflow-y-auto p-4&#34; dir=&#34;ltr&#34;&gt;&lt;code class=&#34;whitespace-pre! language-text&#34;&gt;Rows Removed by Filter: 999000&lt;br /&gt;&#xA;&lt;/code&gt;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3808&#34; data-end=&#34;3948&#34;&gt;&lt;strong data-start=&#34;3808&#34; data-end=&#34;3838&#34;&gt;Pourquoi câ€™est un souci&lt;/strong&gt;&lt;br data-start=&#34;3838&#34; data-end=&#34;3841&#34; /&gt;Le filtre est appliquÃ© aprÃ¨s avoir lu la majoritÃ© des lignes â†’ PostgreSQL fait beaucoup de travail inutile.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3950&#34; data-end=&#34;3978&#34;&gt;&lt;strong data-start=&#34;3950&#34; data-end=&#34;3976&#34;&gt;Comment le voir&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;3979&#34; data-end=&#34;4071&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;3979&#34; data-end=&#34;4023&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;3981&#34; data-end=&#34;4023&#34;&gt;PrÃ©sence de FILTER (&amp;#8230;) en bas de plan&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4024&#34; data-end=&#34;4071&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4026&#34; data-end=&#34;4071&#34;&gt;TrÃ¨s grand nombre de ROWS REMOVED BY FILTER&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4073&#34; data-end=&#34;4089&#34;&gt;&lt;strong data-start=&#34;4073&#34; data-end=&#34;4089&#34;&gt;Solutions&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul data-start=&#34;4090&#34; data-end=&#34;4311&#34;&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4090&#34; data-end=&#34;4120&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4092&#34; data-end=&#34;4120&#34;&gt;Indexer la colonne du filtre&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4121&#34; data-end=&#34;4203&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4123&#34; data-end=&#34;4203&#34;&gt;RÃ©Ã©crire la requÃªte pour que le filtre soit pris en compte plus tÃ´t dans le plan&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li class=&#34;&#34; data-start=&#34;4204&#34; data-end=&#34;4311&#34;&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;4206&#34; data-end=&#34;4311&#34;&gt;Ã‰viter les fonctions non indexables dans le WHERE (ex : LOWER(email)Â â†’ prÃ©fÃ©rer un index fonctionnel)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h1&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;313&#34; data-end=&#34;605&#34;&gt;Comme souvent avec PostgreSQL, il est difficile â€” voire impossible â€” de tout couvrir en un seul article. Chaque plan d&amp;#8217;exÃ©cution est unique, chaque requÃªte a ses subtilitÃ©s, et chaque base de donnÃ©es a ses petites surprises. Il nâ€™existe pas de recette miracle qui marcherait Ã  tous les coups.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;607&#34; data-end=&#34;813&#34;&gt;Mais avec les bons rÃ©flexes, quelques outils et un peu de mÃ©thode, on peut rapidement progresser : repÃ©rer les symptÃ´mes, lire les signes, poser les bonnes questionsâ€¦ et surtout, tester, encore et toujours.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;607&#34; data-end=&#34;813&#34;&gt;EXPLAIN ANALYZE nâ€™est pas rÃ©servÃ© aux DBA ou aux experts en perfs. Câ€™est un compagnon de route pour toute personne qui Ã©crit des requÃªtes, et qui veut comprendre ce qui se passe sous le capot.&lt;/p&gt;&#xA;&lt;p class=&#34;&#34; data-start=&#34;1011&#34; data-end=&#34;1213&#34;&gt;Et si vous vous sentez encore un peu perduÂ·e face Ã  un plan trop verbeux : pas de panique. Avec lâ€™habitude, Ã§a devient un langage quâ€™on apprend Ã  lire presque instinctivement. Et Ã§a commence maintenant.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 dÃ©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien Ã©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-pg_stat_statements-avec-postgresql-15/&#34; rel=&#34;bookmark&#34; title=&#34;16 mars 2023&#34;&gt;NouveautÃ©s pg_stat_statements avec PostgreSQL 15&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; rel=&#34;bookmark&#34; title=&#34;26 fÃ©vrier 2025&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/query-store-bloquer-les-regressions-de-plans-dexecution-et-capture-mode/&#34; rel=&#34;bookmark&#34; title=&#34;6 avril 2022&#34;&gt;Query Store : bloquer les rÃ©gressions de plans d&amp;#8217;exÃ©cution et Capture Mode&lt;/a&gt; (Capdata team) [SQL Server]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.289 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&amp;#038;title=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20Basics%20%3A%20lire%20un%20plan%20d%E2%80%99ex%C3%A9cution%20comme%20un%C2%B7e%20pro%20%28ou%20presque%29&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10697&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34;&gt;PostgreSQL Basics : lire un plan d&amp;#8217;exÃ©cution comme unÂ·e pro (ou presque)&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Introduction : Quand une requÃªte PostgreSQL est considÃ©rÃ©e comme lente ou que ses performances se dÃ©gradent soudainement, il y a un rÃ©flexe Ã  toujours avoir : utiliser les plans d&amp;#8217;exÃ©cution. Je nâ€™apprends certainement rien Ã  la majoritÃ© des personnes qui&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-basics-lire-un-plan-dexecution/&#34;&gt;PostgreSQL Basics : lire un plan d&amp;#8217;exÃ©cution comme unÂ·e pro (ou presque)&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !</title>
    <updated>2025-02-26T11:00:21Z</updated>
    <id>tag:blog.capdata.fr,2025-02-26:/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10677&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;200&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-300x200.png 300w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum-768x513.png 768w, https://blog.capdata.fr/wp-content/uploads/2025/02/vacuum.png 800w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Hello&lt;/p&gt;&#xA;&lt;p&gt;pour commencer cette annÃ©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous prÃ©sente comment optimiser les opÃ©rations de maintenance que sont les VACUUM et les ANALYZE.&lt;/p&gt;&#xA;&lt;p&gt;Ces 2 opÃ©rations sont essentielles pour conserver des performances optimales pour notre instance et garantir au planner de construire des plans d&amp;#8217;exÃ©cutions optimisÃ©s.&lt;/p&gt;&#xA;&lt;p&gt;les opÃ©rations VACUUM et/ou ANALYZE peuvent Ãªtre longues et sources de nombreuses Ã©critures dans les WALs sur des tables volumineuses.&lt;br /&gt;&#xA;C&amp;#8217;est pourquoi, et ce depuis la version &lt;strong&gt;PostgreSQL 16&lt;/strong&gt;, il est possible de modifier le comportement de ces opÃ©rations en affectant une taille de buffer. Il s&amp;#8217;agit du &amp;#8220;&lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-VACUUM-BUFFER-USAGE-LIMIT&#34;&gt;buffer_usage_limit&lt;/a&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Principe de fonctionnement.&lt;/h2&gt;&#xA;&lt;p&gt;Ce procÃ©dÃ© s&amp;#8217;appuie sur le principe de &amp;#8220;ring buffer&amp;#8221; configurÃ© pour PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Attention, Ã  ne pas confondre, Ã©videment, avec les &amp;#8220;rings buffer&amp;#8221; de SQL Server !!&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, PostgreSQL utilise cette stratÃ©gie de &amp;#8220;ring buffer&amp;#8221; afin de dÃ©dier un espace mÃ©moire pour les opÃ©rations lourdes , telles, la lecture sÃ©quentielle sur une table volumineuse, un CREATE TABLE AS SELECT, un COPY&amp;#8230;. mais aussi un VACUUM !&lt;/p&gt;&#xA;&lt;p&gt;En fait, cet espace est utilisÃ© pour Ã©viter de &amp;#8220;flusher&amp;#8221; sur disque de maniÃ¨re trop brutale les pages en mÃ©moire montÃ©es dans le &amp;#8220;&lt;strong&gt;shared buffer&lt;/strong&gt;&amp;#8220;. Cela pÃ©naliserait en grande partie toute opÃ©ration concurrente Ã  notre traitement actif puisqu&amp;#8217;elle n&amp;#8217;aurait plus d&amp;#8217;espace pour mettre ses propres pages en mÃ©moire.&lt;/p&gt;&#xA;&lt;p&gt;Jusqu&amp;#8217;Ã  la version PostgreSQL 16, cet espace mÃ©moire Ã©tait dÃ©fini Ã &lt;strong&gt;Â 256Ko&lt;/strong&gt;. Ainsi, au cours d&amp;#8217;une lecture sÃ©quentielle, chaque pageÂ  de &lt;strong&gt;8Ko&lt;/strong&gt; par dÃ©faut, est montÃ©e en mÃ©moire dans cet espace si le nombre de pages totales Ã  traiter pour la table, dÃ©passe 1/4 du paramÃ¨tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Il en est de mÃªme pour une opÃ©ration VACUUM ou ANALYZE qui utilise Ã©galement ce ring buffer et permet d&amp;#8217;optimiser cette opÃ©ration.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;NouveautÃ©s PostgreSQL 16 et PostgreSQL 17&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la version PostgreSQL 16, il est possible de configurer la taille du buffer de faÃ§on unitaire. Par exemple, lors d&amp;#8217;un VACUUM, il est tout Ã  fait possible de choisir une valeur pour &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Depuis le version PostgreSQL 17, la valeur par dÃ©faut affectÃ©e Ã  &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; est de &lt;strong&gt;2Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il vous est possible de paramÃ©trer la valeur de &lt;strong&gt;128Ko&lt;/strong&gt; jusqu&amp;#8217;Ã  &lt;strong&gt;16Go&lt;/strong&gt;. Attention, cependant, cette valeur ne peux excÃ©der &lt;strong&gt;1/8&lt;/strong&gt; du paramÃ¨tre &amp;#8220;&lt;strong&gt;shared_buffer&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Si vous faites le calcul, pour un serveur comportant &lt;strong&gt;32Go de RAM&lt;/strong&gt;, vous ne pourrez obtenir, au plus, &lt;strong&gt;1Go&lt;/strong&gt; pour votre ring buffer.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un VACUUM&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur une instance PostgreSQL 13, nous lanÃ§ons un VACUUM simple sur une table de 2,5Go. Nous utilisons une base exemple crÃ©Ã©e via &amp;#8220;pgbench&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Nous avons utilisÃ© les options &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221; pour analyser, dans un premier temps, tous les blocs de notre table et ne pas sur baser sur les informations de la visibility_map.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:797&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 20000000 nonremovable row versions in 327869 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196215&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 1.34 s, system: 0.67 s, elapsed: 18.90 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18920.292 ms (00:18.920)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le temps passÃ© pour cette opÃ©ration est d&amp;#8217;un peu plus de 18 secondes en temps CPU pour analyser les 327869 blocs de notre table. Soit une taille de 2.5Go.&lt;/p&gt;&#xA;&lt;p&gt;Nous effectuons la mÃªme opÃ©ration sur cette mÃªme table, mais sur un moteur &lt;strong&gt;PostgreSQL 17&lt;/strong&gt;. Nous positionnons le paramÃ¨tre &lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;Â  Ã  &lt;strong&gt;8Mo&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (verbose,DISABLE_PAGE_SKIPPING,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: aggressively vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:475&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 327869 scanned (100.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;new relfrozenxid: 208163, which is 5 XIDs ahead of previous value&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 134.208 MB/s, avg write rate: 0.034 MB/s&#xD;&#xA;buffer usage: 330350 hits, 325508 misses, 83 dirtied&#xD;&#xA;WAL usage: 84 records, 83 full page images, 684232 bytes&#xD;&#xA;system usage: CPU: user: 1.41 s, system: 0.64 s, elapsed: 18.94 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18955.006 ms (00:18.955)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;estÂ  Ã  peu de chose prÃ¨s, dans le mÃªme temps d&amp;#8217;exÃ©cution. soir 18 secondes.&lt;/p&gt;&#xA;&lt;p&gt;La suite consiste Ã  redÃ©marrer l&amp;#8217;instance PostgreSQL 17 et constater les temps d&amp;#8217;exÃ©cution pour chaque occurrence de lancement.&lt;br /&gt;&#xA;Nous exÃ©cutons donc, les mÃªmes ordres VACUUM, mais sans l&amp;#8217;option &amp;#8220;&lt;strong&gt;DISABLE_PAGE_SKIPPING&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 13, nous voyons qu&amp;#8217;Ã  la premiÃ¨re exÃ©cution, juste aprÃ¨s redÃ©marrage, nous sommes Ã  32 millisecondes. Et Ã  chaque exÃ©cution suivante, nous ne descendons pas en dessous de 15 millisecondes&amp;#8230;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 32.149 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.001 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 15.295 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;En version PostgreSQL 17, nous faisons Ã©galement un &amp;#8220;flush&amp;#8221; des pages dans le buffer cache Ã  chaque exÃ©cution, tout en modifiant la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 18.098 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 6.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (BUFFER_USAGE_LIMIT &#39;16MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 4.333 ms&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le constat est simple, plus nous augmentons le &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, et plus le temps d&amp;#8217;exÃ©cution du VACUUM diminue.&lt;/p&gt;&#xA;&lt;p&gt;Nous comprendrons donc que sur une table de plus de 100Go, le gain peut Ãªtre assez important.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h5&gt;Cas d&amp;#8217;utilisation pour un ANALYZE&lt;/h5&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour l&amp;#8217;instance PostgreSQL 13, nous exÃ©cutons le calcul de statistiques sur cette mÃªme table&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5433) [pgbenchmark] primaire $  vacuum (analyze,verbose) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:802&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: found 0 removable, 52 nonremovable row versions in 1 out of 327869 pages&#xD;&#xA;DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 196278&#xD;&#xA;There were 0 unused item identifiers.&#xD;&#xA;Skipped 0 pages due to buffer pins, 0 frozen pages.&#xD;&#xA;0 pages are entirely empty.&#xD;&#xA;CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s.&#xD;&#xA;LOCATION: lazy_scan_heap, vacuumlazy.c:1759&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:336&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1190&#xD;&#xA;VACUUM&#xD;&#xA;Time: 29526.404 ms (00:29.526)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous sommes autour de 29 secondes pour analyser 30000 pages sur les 32769 que composent cette table.&lt;br /&gt;&#xA;Le sample est choisi en fonction de la valeur de &amp;#8220;&lt;strong&gt;default_statistics_target&lt;/strong&gt;&amp;#8220;, par dÃ©faut Ã  100, avec 30000 lignes analysÃ©es par dÃ©faut.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Sur la version PostgreSQL 17, les rÃ©sultats sont les suivants&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,verbose,BUFFER_USAGE_LIMIT &#39;128kB&#39;) public.pgbench_accounts;&#xD;&#xA;INFO: 00000: vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:480&#xD;&#xA;INFO: 00000: finished vacuuming &amp;quot;pgbenchmark.public.pgbench_accounts&amp;quot;: index scans: 0&#xD;&#xA;pages: 0 removed, 327869 remain, 1 scanned (0.00% of total)&#xD;&#xA;tuples: 0 removed, 20000000 remain, 0 are dead but not yet removable&#xD;&#xA;removable cutoff: 208163, which was 0 XIDs old when operation ended&#xD;&#xA;frozen: 0 pages from table (0.00% of total) had 0 tuples frozen&#xD;&#xA;index scan not needed: 0 pages from table (0.00% of total) had 0 dead item identifiers removed&#xD;&#xA;avg read rate: 46.211 MB/s, avg write rate: 0.000 MB/s&#xD;&#xA;buffer usage: 37 hits, 100 misses, 0 dirtied&#xD;&#xA;WAL usage: 0 records, 0 full page images, 0 bytes&#xD;&#xA;system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.01 s&#xD;&#xA;LOCATION: heap_vacuum_rel, vacuumlazy.c:763&#xD;&#xA;INFO: 00000: analyzing &amp;quot;public.pgbench_accounts&amp;quot;&#xD;&#xA;LOCATION: do_analyze_rel, analyze.c:321&#xD;&#xA;INFO: 00000: &amp;quot;pgbench_accounts&amp;quot;: scanned 30000 of 327869 pages, containing 1830000 live rows and 0 dead rows; 30000 rows in sample, 20000009 estimated total rows&#xD;&#xA;LOCATION: acquire_sample_rows, analyze.c:1301&#xD;&#xA;VACUUM&#xD;&#xA;Time: 8151.201 ms (00:08.151)&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [pgbenchmark] primaire $  vacuum (analyze,BUFFER_USAGE_LIMIT &#39;8MB&#39;) public.pgbench_accounts;&#xD;&#xA;VACUUM&#xD;&#xA;Time: 7282.546 ms (00:07.283)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Les diffÃ©rences de gains sont moins impressionnantes que sur un simple VACUUM Ã  chaque changement de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8220;, mais on voit qu&amp;#8217;en version PostgreSQL 17, nous sommes tout de mÃªme 4 fois plus rapide qu&amp;#8217;en version PostgreSQL 13.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h4&gt;Remarques&lt;/h4&gt;&#xA;&lt;p&gt;Gardez Ã  l&amp;#8217;esprit que la valeur de &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&amp;#8221;&lt;/strong&gt; est plafonnÃ©e Ã  &lt;strong&gt;1/8 &lt;/strong&gt;de&lt;strong&gt; &amp;#8220;shared_buffer&amp;#8221;&lt;/strong&gt;. Inutile donc de mettre Ã  1024Mo, si vous ne possÃ©dez que 8Go de RAM.&lt;/p&gt;&#xA;&lt;p&gt;Attention si vous mettez une valeur trop grande, les transactions concurrentes effectuant des lectures sÃ©quentielles seront pÃ©nalisÃ©es par les opÃ©rations VACUUM. D&amp;#8217;ailleurs, il est possible de mettre &amp;#8220;&lt;strong&gt;BUFFER_USAGE_LIMIT&lt;/strong&gt;&amp;#8221; Ã  0, mais ceci n&amp;#8217;est pas conseillÃ© lors d&amp;#8217;une activitÃ© transactionnelle en cours.&lt;/p&gt;&#xA;&lt;p&gt;Pour aller plus loin dans l&amp;#8217;optimisation d&amp;#8217;une opÃ©ration de vacuum, vous pouvez Ã©galement passer le paramÃ¨tre &amp;#8220;&lt;strong&gt;INDEX_CLEANUP&lt;/strong&gt;&amp;#8221; Ã  &lt;strong&gt;off&lt;/strong&gt;. Ceci aura pour effet de ne pas s&amp;#8217;occuper de traiter les entrÃ©es des index qui pointent sur les lignes mortes de la table.&lt;br /&gt;&#xA;Un &amp;#8220;&lt;strong&gt;REINDEX&lt;/strong&gt;&amp;#8221; sera alors nÃ©cessaire Ã  la fin du VACUUM sur les index de la table.&lt;/p&gt;&#xA;&lt;p&gt;De plus, il est possible de positionner l&amp;#8217;option &amp;#8220;&lt;strong&gt;SKIP_DATABASE_STATS&lt;/strong&gt;&amp;#8221; afin d&amp;#8217;indiquer Ã  l&amp;#8217;ordre VACUUM de ne pas rechercher l&amp;#8217;ID de transaction le plus ancien pour l&amp;#8217;ensemble des tables de la base et de geler celui-ci (datfrozenid).&lt;/p&gt;&#xA;&lt;p&gt;Les opÃ©rations VACUUM sur les grosses tables seront bien entendu optimisÃ©es mais attention aux plages de maintenance choisies !!&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonne journÃ©e Ã  vous.&lt;/p&gt;&#xA;&lt;p&gt;Emmanuel Rami&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pruning-de-partitions-sous-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;7 dÃ©cembre 2020&#34;&gt;&amp;#8220;Pruning&amp;#8221; de partitions sous PostgreSQL ou comment bien Ã©laguer !&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/requetes-consommatrices-sous-postgresql-episode-1/&#34; rel=&#34;bookmark&#34; title=&#34;24 mai 2016&#34;&gt;RequÃªtes consommatrices sous PostgreSQL (Ã©pisode 1)&lt;/a&gt; (David Baffaleuf) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/nouveautes-mysql-8-0-les-histogrammes/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;NouveautÃ©s MySQL 8.0 : Les Histogrammes&lt;/a&gt; (Capdata team) [MySQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/replication-logique-avec-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;23 janvier 2020&#34;&gt;RÃ©plication logique avec PostgreSQL&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.471 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&amp;#038;title=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%20%3A%20optimiser%20vos%20op%C3%A9rations%20vacuum%20et%20analyze%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10670&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Hello pour commencer cette annÃ©e 2025 , voici un petit article PostgreSQL ou l&amp;#8217;on vous prÃ©sente comment optimiser les opÃ©rations de maintenance que sont les VACUUM et les ANALYZE. Ces 2 opÃ©rations sont essentielles pour conserver des performances optimales pour&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-optimiser-vos-operations-vacuum-et-analyze/&#34;&gt;PostgreSQL : optimiser vos opÃ©rations vacuum et analyze !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>La montÃ©e de version en zero-downtime : merci la rÃ©plication !</title>
    <updated>2024-12-19T10:28:41Z</updated>
    <id>tag:blog.capdata.fr,2024-12-19:/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h1&gt;Introduction :&lt;/h1&gt;&#xA;&lt;p&gt;Dans le monde des bases de donnÃ©es, garantir une disponibilitÃ© continue est une exigence incontournable, surtout pour les systÃ¨mes critiques oÃ¹ chaque minute d&amp;#8217;arrÃªt peut entraÃ®ner des pertes significatives. Lorsquâ€™il sâ€™agit de migrer une base de donnÃ©es vers une nouvelle version, ce dÃ©fi prend une toute autre dimension. Comment mettre Ã  jour votre systÃ¨me sans interrompre les services, tout en prÃ©servant lâ€™intÃ©gritÃ© des donnÃ©es ?&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL offre une solution Ã©lÃ©gante : la rÃ©plication logique. Cet outil permet de transfÃ©rer des donnÃ©es de maniÃ¨re fluide entre diffÃ©rentes versions de PostgreSQL, tout en maintenant la base de donnÃ©es source opÃ©rationnelle. Dans cet article, nous allons explorer Ã©tape par Ã©tape comment utiliser cette fonctionnalitÃ© pour rÃ©aliser une montÃ©e de version sans temps d&amp;#8217;arrÃªt, du dÃ©ploiement initial Ã  la bascule finale vers la nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Que vous soyez en train de planifier une migration ou simplement curieux de dÃ©couvrir les possibilitÃ©s offertes par PostgreSQL, suivez ce guide pratique qui vous permettra de transformer un dÃ©fi complexe en une opÃ©ration maÃ®trisÃ©e et efficace.&lt;/p&gt;&#xA;&lt;h1&gt;Le test :&lt;/h1&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h3&gt;PrÃ©paration&lt;/h3&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pour tester cette nouvelle mÃ©thode, nous aurons besoin de deux instances PostgreSQL. Pour cet article j&amp;#8217;ai choisit de dÃ©montrer la technique en migrant d&amp;#8217;une version 14 Ã  une version 17 de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Je commence donc par installer les versions sur deux machines diffÃ©rentes pouvant communiquer entre elles (c&amp;#8217;est important) :&lt;/p&gt;&#xA;&lt;p&gt;Sur les deux machines nous pouvons exÃ©cuter les commandes suivantes :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt update sudo apt upgrade -y&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y install gnupg2 wget vim&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo sh -c &#39;echo &amp;quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&amp;quot; &amp;amp;gt; /etc/apt/sources.list.d/pgdg.list&#39;&#xD;&#xA;root@ip-192-1-1-246:~# curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc|sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt -y update&#xD;&#xA;Get:1 file:/etc/apt/mirrors/debian.list Mirrorlist [38 B]&#xD;&#xA;Get:2 file:/etc/apt/mirrors/debian-security.list Mirrorlist [47 B]&#xD;&#xA;Hit:3 https://cdn-aws.deb.debian.org/debian bookworm InRelease&#xD;&#xA;Hit:4 https://cdn-aws.deb.debian.org/debian bookworm-updates InRelease&#xD;&#xA;Hit:5 https://cdn-aws.deb.debian.org/debian bookworm-backports InRelease&#xD;&#xA;Hit:6 https://cdn-aws.deb.debian.org/debian-security bookworm-security InRelease&#xD;&#xA;Get:7 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg InRelease [129 kB]&#xD;&#xA;Get:8 http://apt.postgresql.org/pub/repos/apt bookworm-pgdg/main amd64 Packages [359 kB]&#xD;&#xA;Fetched 489 kB in 1s (348 kB/s)&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;All packages are up to date.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur notre premiÃ¨re machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# sudo apt install postgresql-14&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-14 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl status postgresql@14-main.service&#xD;&#xA;â— postgresql@14-main.service - PostgreSQL Cluster 14-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime;&amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:43:55 UTC; 2min 55s ago&#xD;&#xA;Process: 15248 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect &amp;amp;gt;&#xD;&#xA;Main PID: 15253 (postgres)&#xD;&#xA;Tasks: 7 (limit: 4633)&#xD;&#xA;Memory: 17.3M&#xD;&#xA;CPU: 239ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@14-main.service&#xD;&#xA;â”œâ”€15253 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresq&amp;amp;gt;&#xD;&#xA;â”œâ”€15255 &amp;quot;postgres: 14/main: checkpointer &amp;quot;&#xD;&#xA;â”œâ”€15256 &amp;quot;postgres: 14/main: background writer &amp;quot;&#xD;&#xA;â”œâ”€15257 &amp;quot;postgres: 14/main: walwriter &amp;quot;&#xD;&#xA;â”œâ”€15258 &amp;quot;postgres: 14/main: autovacuum launcher &amp;quot;&#xD;&#xA;â”œâ”€15259 &amp;quot;postgres: 14/main: stats collector &amp;quot;&#xD;&#xA;â””â”€15260 &amp;quot;postgres: 14/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:43:53 ip-192-1-1-246 systemd[1]: Starting postgresql@14-main.service&amp;amp;gt;&#xD;&#xA;Dec 04 09:43:55 ip-192-1-1-246 systemd[1]: Started postgresql@14-main.service &amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Puis sur la deuxiÃ¨me machine :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;admin@ip-192-1-1-89:~$ sudo apt install postgresql-17&#xD;&#xA;Reading package lists... Done&#xD;&#xA;Building dependency tree... Done&#xD;&#xA;Reading state information... Done&#xD;&#xA;The following additional packages will be installed:&#xD;&#xA;libcommon-sense-perl libgdbm-compat4 libio-pty-perl libipc-run-perl&#xD;&#xA;libjson-perl libjson-xs-perl libllvm16 libperl5.36 libpq5 libsensors-config&#xD;&#xA;libsensors5 libtypes-serialiser-perl libxslt1.1 libz3-4 logrotate perl&#xD;&#xA;perl-modules-5.36 postgresql-client-17 postgresql-client-common&#xD;&#xA;postgresql-common ssl-cert sysstat&#xD;&#xA;&#xD;&#xA;admin@ip-192-1-1-89:~$ systemctl status postgresql@17-main.service&#xD;&#xA;â— postgresql@17-main.service - PostgreSQL Cluster 17-main&#xD;&#xA;Loaded: loaded (/lib/systemd/system/postgresql@.service; enabled-runtime; &amp;amp;gt;&#xD;&#xA;Active: active (running) since Wed 2024-12-04 09:52:33 UTC; 2min 13s ago&#xD;&#xA;Process: 15235 ExecStart=/usr/bin/pg_ctlcluster --skip-systemctl-redirect 1&amp;amp;gt;&#xD;&#xA;Main PID: 15240 (postgres)&#xD;&#xA;Tasks: 6 (limit: 4633)&#xD;&#xA;Memory: 20.5M&#xD;&#xA;CPU: 332ms&#xD;&#xA;CGroup: /system.slice/system-postgresql.slice/postgresql@17-main.service&#xD;&#xA;â”œâ”€15240 /usr/lib/postgresql/17/bin/postgres -D /var/lib/postgresql&amp;amp;gt;&#xD;&#xA;â”œâ”€15241 &amp;quot;postgres: 17/main: checkpointer &amp;quot;&#xD;&#xA;â”œâ”€15242 &amp;quot;postgres: 17/main: background writer &amp;quot;&#xD;&#xA;â”œâ”€15244 &amp;quot;postgres: 17/main: walwriter &amp;quot;&#xD;&#xA;â”œâ”€15245 &amp;quot;postgres: 17/main: autovacuum launcher &amp;quot;&#xD;&#xA;â””â”€15246 &amp;quot;postgres: 17/main: logical replication launcher &amp;quot;&#xD;&#xA;&#xD;&#xA;Dec 04 09:52:31 ip-192-1-1-89 systemd[1]: Starting postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;Dec 04 09:52:33 ip-192-1-1-89 systemd[1]: Started postgresql@17-main.service -&amp;amp;gt;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos deux instances sont maintenant installÃ©es. Sur notre premiÃ¨re base de donnÃ©es, nous allons crÃ©er une base, avec deux tables, et quelques lignes.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE TABLE customers (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;name TEXT NOT NULL,&#xD;&#xA;email TEXT UNIQUE,&#xD;&#xA;created_at TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# CREATE TABLE orders (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;customer_id INT REFERENCES customers(id),&#xD;&#xA;amount NUMERIC(10,2) NOT NULL,&#xD;&#xA;order_date TIMESTAMP DEFAULT NOW()&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES&#xD;&#xA;(&#39;Alice&#39;, &#39;alice@example.com&#39;),&#xD;&#xA;(&#39;Bob&#39;, &#39;bob@example.com&#39;),&#xD;&#xA;(&#39;Charlie&#39;, &#39;charlie@example.com&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;mydb=# INSERT INTO orders (customer_id, amount) VALUES&#xD;&#xA;(1, 50.75),&#xD;&#xA;(2, 20.00),&#xD;&#xA;(1, 75.00);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;2. Configurer la base de donnÃ©es source&lt;/h3&gt;&#xA;&lt;p&gt;Sur notre premiÃ¨re machine, nous allons modifier les paramÃ¨tres du fichier de configuration de PostgreSQL pour permettre de pouvoir crÃ©er la rÃ©plication :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-246:~$ cd /etc/postgresql/14/main&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il s&amp;#8217;agit de modifier les paramÃ¨tres suivants :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Nous modifierons ensuite le pg_hba pour rajouter l&amp;#8217;autorisation de connexion entre les deux machines :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il suffira de rajouter une ligne :&lt;/p&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;Il ne faut pas oublier de redÃ©marrer le serveur PostgreSQL une fois ces modifications effectuÃ©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;3. Configurer la base de donnÃ©e de destination&lt;/h3&gt;&#xA;&lt;p&gt;AprÃ¨s avoir configurÃ© notre base de donnÃ©e depuis laquelle nous allons faire notre migration, il nous faut a prÃ©sent configurer celle qui va recevoir la nouvelle base de donnÃ©e migrÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela, nous allons rÃ©pÃ©ter les Ã©tapes de configuration de la base de donnÃ©e source, en les adaptant sur notre base de donnÃ©e de destination : modifier le postgresql.conf, puis le pg_hba.conf, redÃ©marrer ensuite la base de donnÃ©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ cd /etc/postgresql/17/main/&#xD;&#xA;postgres@ip-192-1-1-89:/etc/postgresql/17/main$ vi postgresql.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;wal_level = logical&lt;br /&gt;&#xA;max_replication_slots = 4&lt;br /&gt;&#xA;max_wal_senders = 4&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:/etc/postgresql/14/main$ vi pg_hba.conf&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;blockquote&gt;&lt;p&gt;host replication &lt;span class=&#34;hljs-attribute&#34;&gt;all&lt;/span&gt; &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host replication all &amp;lt;source_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;destination_ip&amp;gt; scram-sha-256&lt;/p&gt;&#xA;&lt;p&gt;host all replication &amp;lt;source-ip&amp;gt; scram-sha-256&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-246:~# systemctl stop postgresql@14-main.service&#xD;&#xA;root@ip-192-1-1-246:~# systemctl start postgresql@14-main.service&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il ne faudra pas oublier de crÃ©er la base de donnÃ©e ainsi que toutes les structures de tables et autres objets dans notre base cible pour qu&amp;#8217;elle puisse recevoir les donnÃ©es. Pour avoir les scripts de crÃ©ation de la base de donnÃ©es, vous pouvez faire un pg_dump avec l&amp;#8217;option&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-89:~$ psql&#xD;&#xA;psql (17.2 (Debian 17.2-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# CREATE DATABASE mydb;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;N&amp;#8217;oubliez pas de donner tout les droits Ã  votre utilisateur de replication pour qu&amp;#8217;il puisse lire, Ã©crire&amp;#8230; Sur votre base de donnÃ©es repliquÃ©e, sur la source, comme sur la destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# GRANT ALL PRIVILEGES ON DATABASE &amp;quot;mydb&amp;quot; to replication;&#xD;&#xA;GRANT&#xD;&#xA;&#xD;&#xA;mydb=# GRANT ALL PRIVILEGES ON all tables in schema public to replication;&#xD;&#xA;GRANT&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;4. Mise en place de la rÃ©plication logique&lt;/h3&gt;&#xA;&lt;p&gt;Maintenant que nos deux environnement sont bien en place, nous sommes prÃªts Ã  mettre en route le processus de rÃ©plication logique pour commencer Ã  transfÃ©rer les donnÃ©es. Les Ã©tapes du dessous ont demandÃ© une premiÃ¨re intervention hors horaire de prod, notamment pour redÃ©marrer le service postgreSQL, mais le but d&amp;#8217;une migration avec rÃ©plication logique, c&amp;#8217;est de pouvoir ensuite n&amp;#8217;avoir rien Ã  toucher jusqu&amp;#8217;au moment de basculer les applicatifs d&amp;#8217;une ip a une autre.&lt;/p&gt;&#xA;&lt;p&gt;Sur notre machine source, on crÃ©Ã© la publication qui va nous servir Ã  transfÃ©rer nos tables :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# CREATE PUBLICATION my_pub FOR ALL TABLES;&#xD;&#xA;CREATE PUBLICATION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On va ensuite crÃ©Ã© la souscription sur la base de donnÃ©es cible de notre migration :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# create subscription my_sub connection &#39;host=192.1.1.246 port=5432 dbname=mydb user=replication password=replication&#39;publication my_pub;&#xD;&#xA;NOTICE: created replication slot &amp;quot;my_sub&amp;quot; on publisher&#xD;&#xA;CREATE SUBSCRIPTION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Maintenant que la subscription est en place, on peut vÃ©rifier qu&amp;#8217;elle fonctionne. Pendant ce temps, la vrai production, sur la version 14, peut continuer Ã  fonctionner, elle sera automatiquement repliquÃ©e sur la nouvelle version 17.&lt;/p&gt;&#xA;&lt;p&gt;On peut vÃ©rifier ou en est notre replication avec la commande &lt;span class=&#34;hljs-keyword&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;hljs-keyword&#34;&gt;FROM&lt;/span&gt; pg_stat_subscription;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# SELECT * FROM pg_stat_subscription;&#xD;&#xA;-[ RECORD 1 ]---------+------------------------------&#xD;&#xA;subid | 16422&#xD;&#xA;subname | my_sub&#xD;&#xA;worker_type | apply&#xD;&#xA;pid | 16076&#xD;&#xA;leader_pid |&#xD;&#xA;relid |&#xD;&#xA;received_lsn | 0/1733988&#xD;&#xA;last_msg_send_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;last_msg_receipt_time | 2024-12-04 14:23:59.872357+00&#xD;&#xA;latest_end_lsn | 0/1733988&#xD;&#xA;latest_end_time | 2024-12-04 14:23:59.873074+00&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;5. Test de replication, bascule, et nettoyage&lt;/h3&gt;&#xA;&lt;p&gt;Une fois que la synchronisation de votre replication logique est terminÃ©e, ce qui peut prendre un certain temps si vous avez beaucoup de donnÃ©es, vous pouvez constater de vous mÃªme sur les lignes que vous ajoutez, modifiez ou supprimez sur votre instance source sont repliquÃ©es sur l&amp;#8217;instance de destination.&lt;/p&gt;&#xA;&lt;p&gt;Par exemple, ajoutons un nouveau customer sur notre base source :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres@ip-192-1-1-246:~$ psql&#xD;&#xA;psql (14.15 (Debian 14.15-1.pgdg120+1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# \c mydb&#xD;&#xA;You are now connected to database &amp;quot;mydb&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;mydb=# INSERT INTO customers (name, email) VALUES (&#39;Diana&#39;, &#39;diana@example.com&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Si nous allons requÃªter sur notre instance de destination :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;mydb=# select * from customers where name=&#39;Diana&#39;;&#xD;&#xA;id | name | email | created_at&#xD;&#xA;----+-------+-------------------+----------------------------&#xD;&#xA;4 | Diana | diana@example.com | 2024-12-04 14:31:05.708031&#xD;&#xA;(1 row)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Quand vous vous Ãªtes bien assurÃ© que tout fonctionne, vous pouvez alors rediriger les drivers odbc de vos applications vers le nouveau serveur et non plus l&amp;#8217;ancien.&lt;/p&gt;&#xA;&lt;p&gt;Une fois que cela est fait, vous pouvez alors supprimer le lien de replication, puisque l&amp;#8217;ancienne instance ne sera plus alimentÃ©e, et mÃªme supprimer l&amp;#8217;ancienne version si vous n&amp;#8217;en avez plus l&amp;#8217;utilitÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Sur la destination, notre nouveau serveur de prod :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP SUBSCRIPTION my_sub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Sur la source, ancien serveur qui va Ãªtre supprimÃ© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;DROP PUBLICATION my_pub;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h1&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;La rÃ©plication logique se distingue comme lâ€™une des meilleures solutions pour minimiser le temps dâ€™arrÃªt lors dâ€™une migration de version PostgreSQL. En permettant une synchronisation continue des donnÃ©es entre deux instances, elle garantit une transition en douceur sans jamais interrompre les services en cours. Cela en fait un choix idÃ©al pour les environnements critiques oÃ¹ la disponibilitÃ© est primordiale.&lt;/p&gt;&#xA;&lt;h3&gt;Avantages :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;ZÃ©ro downtime :&lt;/strong&gt; la source reste opÃ©rationnelle pendant toute la migration.&lt;br /&gt;&#xA;&lt;strong&gt;FlexibilitÃ© :&lt;/strong&gt; possibilitÃ© de migrer vers une infrastructure diffÃ©rente (nouveau matÃ©riel, cloud, etc.).&lt;br /&gt;&#xA;&lt;strong&gt;GranularitÃ© :&lt;/strong&gt; la rÃ©plication logique peut se limiter Ã  certaines tables si nÃ©cessaire.&lt;/p&gt;&#xA;&lt;h3&gt;InconvÃ©nients :&lt;/h3&gt;&#xA;&lt;p&gt;&lt;strong&gt;ComplexitÃ© initiale :&lt;/strong&gt; la configuration et les tests nÃ©cessitent une bonne maÃ®trise des paramÃ¨tres de PostgreSQL.&lt;br /&gt;&#xA;&lt;strong&gt;Impact sur les performances :&lt;/strong&gt; la charge de rÃ©plication peut lÃ©gÃ¨rement affecter les performances de la base source, surtout avec un grand volume de donnÃ©es.&lt;br /&gt;&#xA;&lt;strong&gt;Non pris en charge pour certains types de donnÃ©es :&lt;/strong&gt; les types spÃ©cifiques ou les extensions non standards ne sont pas toujours compatibles avec la rÃ©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Si la rÃ©plication logique est souvent la mÃ©thode privilÃ©giÃ©e pour des mises Ã  jour critiques, elle nâ€™est pas la seule option. Des alternatives comme les outils de sauvegarde et restauration ou la rÃ©plication physique peuvent rÃ©pondre Ã  dâ€™autres besoins spÃ©cifiques, notamment pour des bases de donnÃ©es trÃ¨s volumineuses ou des scÃ©narios nÃ©cessitant une rÃ©plication complÃ¨te du systÃ¨me.&lt;/p&gt;&#xA;&lt;p&gt;Dans tous les cas, le choix de la mÃ©thode dÃ©pendra de votre contexte, de vos contraintes techniques et de vos objectifs mÃ©tier. Prenez le temps dâ€™Ã©valuer les diffÃ©rentes options pour garantir une migration rÃ©ussie et sans surprise.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/replication-logique-avec-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;23 janvier 2020&#34;&gt;RÃ©plication logique avec PostgreSQL&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migration-postgresql-via-slony-i-ou-comment-reduire-le-temps-de-coupure/&#34; rel=&#34;bookmark&#34; title=&#34;27 janvier 2020&#34;&gt;Migration PostgreSQL via SLONY-I ou comment rÃ©duire le temps de coupure&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/migrer-dun-cluster-galera-mariadb-10-3-vers-mariadb-10-5-avec-la-replication-logique/&#34; rel=&#34;bookmark&#34; title=&#34;25 fÃ©vrier 2022&#34;&gt;Migrer d&amp;#8217;un cluster Galera MariaDB 10.3 vers MariaDB 10.5 avec la rÃ©plication logique&lt;/a&gt; (David Baffaleuf) [ContainerMySQLNon classÃ©]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/comparatif-des-gestionnaires-de-vip-dans-un-cluster-patroni-episode-1-keepalived/&#34; rel=&#34;bookmark&#34; title=&#34;6 mars 2022&#34;&gt;Comparatif des gestionnaires de VIP dans un cluster Patroni : Ã©pisode 1 (KEEPALIVED)&lt;/a&gt; (David Baffaleuf) [ContainerPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des schÃ©mas de base de donnÃ©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 2.305 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&amp;#038;title=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=La%20mont%C3%A9e%20de%20version%20en%20zero-downtime%20%3A%20merci%20la%20r%C3%A9plication%20%21&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10633&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La montÃ©e de version en zero-downtime : merci la rÃ©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Introduction : Dans le monde des bases de donnÃ©es, garantir une disponibilitÃ© continue est une exigence incontournable, surtout pour les systÃ¨mes critiques oÃ¹ chaque minute d&amp;#8217;arrÃªt peut entraÃ®ner des pertes significatives. Lorsquâ€™il sâ€™agit de migrer une base de donnÃ©es vers&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/la-montee-de-version-en-zero-downtime-merci-la-replication/&#34;&gt;La montÃ©e de version en zero-downtime : merci la rÃ©plication !&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>pg_vector : lâ€™IA et PostgreSQL</title>
    <updated>2024-12-03T07:22:34Z</updated>
    <id>tag:blog.capdata.fr,2024-12-03:/index.php/pg_vector-lia-et-postgresql/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;h2&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le rÃ´le des bases de donnÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle (IA) connaÃ®t une popularitÃ© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies fonctionnent, elles ont besoin de donnÃ©es, souvent en grande quantitÃ©. Câ€™est lÃ  quâ€™interviennent les bases de donnÃ©es : elles stockent, gÃ¨rent et permettent d&amp;#8217;accÃ©der Ã  ces donnÃ©es de maniÃ¨re efficace.&lt;/p&gt;&#xA;&lt;p&gt;Les bases de donnÃ©es, comme PostgreSQL, ont donc un rÃ´le clÃ© dans lâ€™IA. Mais l&amp;#8217;IA ne traite pas toujours des informations simples comme des noms ou des chiffres ; souvent, elle doit manipuler des informations complexes, comme des reprÃ©sentations numÃ©riques d&amp;#8217;images, de sons, ou de textes. Pour gÃ©rer ces donnÃ©es spÃ©cifiques, il faut des outils adaptÃ©s, et c&amp;#8217;est lÃ  que l&amp;#8217;extension pg_vector de PostgreSQL entre en jeu.&lt;/p&gt;&#xA;&lt;h2&gt;2. Les vecteurs en informatique et dans pg_vector&lt;/h2&gt;&#xA;&lt;p&gt;Dans le cadre de lâ€™informatique, un vecteur est simplement une liste de nombres. Ces nombres peuvent reprÃ©senter nâ€™importe quoi : les caractÃ©ristiques dâ€™un produit, les mots dâ€™un texte ou mÃªme une image. Par exemple, pour un document texte, chaque mot peut Ãªtre transformÃ© en une sÃ©rie de nombres qui capture son sens dans un certain contexte.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™extension pg_vector permet Ã  PostgreSQL de stocker et de manipuler ces vecteurs. Elle offre un moyen simple de les utiliser directement dans une base de donnÃ©es. Imaginons que nous avons des centaines de documents et que nous souhaitions rechercher les plus similaires Ã  un texte donnÃ© : en stockant les reprÃ©sentations numÃ©riques (ou embeddings) de ces documents sous forme de vecteurs, nous pouvons facilement comparer leur similaritÃ© grÃ¢ce Ã  pg_vector.&lt;/p&gt;&#xA;&lt;h2&gt;3. Le lien entre l&amp;#8217;IA et les vecteurs&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;intelligence artificielle repose sur la capacitÃ© Ã  comprendre et traiter des informations complexes. Par exemple, quand une IA doit reconnaÃ®tre une image, elle ne &amp;#8220;voit&amp;#8221; pas comme nous. Au lieu de cela, l&amp;#8217;image est transformÃ©e en une sÃ©rie de nombres, un vecteur, qui reprÃ©sente ses caractÃ©ristiques (couleurs, formes, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Le mÃªme principe sâ€™applique au texte. Les modÃ¨les de traitement du langage, comme ceux utilisÃ©s par les moteurs de recherche ou les chatbots, transforment chaque mot ou phrase en vecteur. Ces vecteurs capturent le sens des mots et permettent Ã  l&amp;#8217;IA de manipuler des informations complexes sans &amp;#8220;comprendre&amp;#8221; le langage humain.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est ici que les embeddings entrent en jeu. Un embedding est un vecteur qui reprÃ©sente des donnÃ©es sous une forme que lâ€™IA peut utiliser. Par exemple, dans un systÃ¨me de recommandation, chaque produit est converti en un embedding, et les produits les plus proches de celui que nous venons de consulter (en termes de vecteur) nous seront recommandÃ©s. GrÃ¢ce Ã  pg_vector, ces embeddings peuvent Ãªtre stockÃ©s et comparÃ©s directement dans une base de donnÃ©es.&lt;/p&gt;&#xA;&lt;h2&gt;4. Pourquoi est-ce utile ?&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector est trÃ¨s utile pour des applications qui nÃ©cessitent la recherche par similaritÃ©. Par exemple, dans un moteur de recherche, si nous voulons trouver les documents les plus proches d&amp;#8217;un texte donnÃ©, pg_vector permet de comparer les vecteurs (ou embeddings) de chaque document pour voir lesquels sont les plus similaires.&lt;/p&gt;&#xA;&lt;p&gt;Autre exemple, dans une plateforme de streaming musical, chaque chanson peut Ãªtre convertie en vecteur qui reprÃ©sente ses caractÃ©ristiques (comme le tempo, la tonalitÃ©, etc.). GrÃ¢ce Ã  pg_vector, on peut facilement recommander des chansons similaires Ã  celles que nous Ã©coutons.&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™avantage de pg_vector, câ€™est quâ€™il permet de gÃ©rer ces vecteurs directement dans la base de donnÃ©es, ce qui Ã©vite de passer par des systÃ¨mes externes plus complexes. Cela simplifie le dÃ©veloppement et amÃ©liore la performance, car tout est gÃ©rÃ© au mÃªme endroit.&lt;/p&gt;&#xA;&lt;h2&gt;5. Le test&lt;/h2&gt;&#xA;&lt;p&gt;Pour dÃ©montrer le fonctionnement de l&amp;#8217;extension, rien de tel qu&amp;#8217;un petit test pour Ã©prouver les fonctionnalitÃ©s qu&amp;#8217;elle propose. Le test sera plutÃ´t simple et succinct pour Ãªtre accessible. Le prÃ©requi est d&amp;#8217;avoir une version PostgreSQL 14 ou plus rÃ©cente d&amp;#8217;installÃ©e.&lt;/p&gt;&#xA;&lt;h3&gt;Etape 1 :&lt;/h3&gt;&#xA;&lt;p&gt;On commence par installer l&amp;#8217;extension pg_vector. Pour cela, nous allons avoir besoin d&amp;#8217;un certain nombre d&amp;#8217;outils pour le faire fonctionner. Une partie de ces outils sont disponible dans la distribution dev de PostgreSQL&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# sudo apt install postgresql-server-dev-14&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nous aurons Ã©galement besoin de gcc et make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# apt install make&#xD;&#xA;root@ip-192-1-1-201:~# apt-get install gcc&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On effectue ensuite un git clone du projet :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# git clone https://github.com/pgvector/pgvector.git&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et une fois que c&amp;#8217;est fait, on l&amp;#8217;installe avec make :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# cd pgvector&#xD;&#xA;root@ip-192-1-1-201:~# make &amp;amp;amp;&amp;amp;amp; sudo make install&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 2 :&lt;/h3&gt;&#xA;&lt;p&gt;On se connecte Ã  PostgreSQL pour crÃ©er l&amp;#8217;extension. Au passage, on crÃ©Ã© aussi une base de donnÃ©es pour faire nos test.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;root@ip-192-1-1-201:~# su - postgres&#xD;&#xA;postgres@ip-192-1-1-201:~$ psql&#xD;&#xA;psql (14.13 (Ubuntu 14.13-0ubuntu0.22.04.1))&#xD;&#xA;Type &amp;quot;help&amp;quot; for help.&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;postgres=# create database test_vector;&#xD;&#xA;CREATE DATABASE&#xD;&#xA;postgres=# \c test_vector&#xD;&#xA;You are now connected to database &amp;quot;test_vector&amp;quot; as user &amp;quot;postgres&amp;quot;.&#xD;&#xA;test_vector=# CREATE EXTENSION vector;&#xD;&#xA;CREATE EXTENSION&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Et dans la foulÃ©e, on crÃ©e une table qui contient les vecteurs sur lesquels nous allons faire les test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# CREATE TABLE documents (&#xD;&#xA;id SERIAL PRIMARY KEY,&#xD;&#xA;title TEXT,&#xD;&#xA;embedding vector(3) -- vecteur de dimension 3 pour cet exemple&#xD;&#xA;);&#xD;&#xA;CREATE TABLE&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Insertion des donnÃ©es d&amp;#8217;exemple :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# INSERT INTO documents (title, embedding) VALUES&#xD;&#xA;(&#39;Document 1&#39;, &#39;[0.1, 0.2, 0.3]&#39;),&#xD;&#xA;(&#39;Document 2&#39;, &#39;[0.4, 0.5, 0.6]&#39;),&#xD;&#xA;(&#39;Document 3&#39;, &#39;[0.9, 0.8, 0.7]&#39;);&#xD;&#xA;INSERT 0 3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;Etape 3 :&lt;/h3&gt;&#xA;&lt;p&gt;Nous avons deux types de choses Ã  tester pour montrer l&amp;#8217;efficacitÃ© de notre extension. En effet, pour rechercher un vecteur, deux modes s&amp;#8217;offrent Ã  nous :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;h4&gt;La distance cosinus&lt;/h4&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;La distance cosinus mesure non pas combien deux vecteurs sont Ã©loignÃ©s, mais l&amp;#8217;angle entre eux. Câ€™est un peu comme comparer la direction dans laquelle pointent deux vecteurs plutÃ´t que la distance rÃ©elle entre eux.&lt;/p&gt;&#xA;&lt;p&gt;Imaginons que nous sommes en train de lancer deux flÃ¨ches. La distance cosinus nous dira si les deux flÃ¨ches pointent dans la mÃªme direction (sont similaires) ou si elles pointent dans des directions trÃ¨s diffÃ©rentes (sont moins similaires).&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre de lâ€™IA, cette mesure est souvent utilisÃ©e pour comparer des embeddings (reprÃ©sentations numÃ©riques complexes), car elle se concentre sur la relation entre les Ã©lÃ©ments, indÃ©pendamment de leur taille exacte.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Prenons les deux films :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Film A : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Film B : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance cosinus ne va pas se soucier de la diffÃ©rence de valeur entre chaque composant, mais va regarder si les deux films ont des proportions similaires. Autrement dit, est-ce que leur &amp;#8220;profil&amp;#8221; gÃ©nÃ©ral est proche ou Ã©loignÃ© ?&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette distance, dans notre pg vector, on utilise la mÃ©thode suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;=&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+---------------------&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.05582537807240784&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.07142855242198809&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 0.09815280896106982&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Le symbole &amp;lt;=&amp;gt; reprÃ©sente une distance cosinus.&lt;/p&gt;&#xA;&lt;h4&gt;2. La distance Euclidienne&lt;/h4&gt;&#xA;&lt;p&gt;Imaginons que nous sommes sur une carte avec deux points : le point A et le point B. La distance euclidienne, c&amp;#8217;est la faÃ§on la plus intuitive de mesurer la distance entre ces deux points, comme si nous tracions une ligne droite entre eux. Pour parler en terme simple, câ€™est la &amp;#8220;distance Ã  vol d&amp;#8217;oiseau&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des vecteurs, la distance euclidienne mesure la diffÃ©rence entre deux vecteurs, un peu comme si chaque vecteur Ã©tait un point sur une carte en plusieurs dimensions. Plus cette distance est petite, plus les deux vecteurs (et donc les objets quâ€™ils reprÃ©sentent) sont similaires.&lt;/p&gt;&#xA;&lt;p&gt;Exemple simple :&lt;/p&gt;&#xA;&lt;p&gt;Imaginons deux films reprÃ©sentÃ©s par les vecteurs suivants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film A&lt;/strong&gt; : &lt;code&gt;[1, 5, 50, 120]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Film B&lt;/strong&gt; : &lt;code&gt;[2, 4, 45, 110]&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La distance euclidienne va calculer la diffÃ©rence entre chaque nombre des deux vecteurs et dÃ©terminer Ã  quel point ces films sont proches en termes de caractÃ©ristiques (genre, nombre dâ€™acteurs, budget, etc.).&lt;/p&gt;&#xA;&lt;p&gt;Dans pg_vector on peut le tester ainsi :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;&#xD;&#xA;test_vector=# SELECT title, embedding, embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; AS distance&#xD;&#xA;FROM documents&#xD;&#xA;ORDER BY embedding &amp;amp;lt;-&amp;amp;gt; &#39;[0.2, 0.1, 0.3]&#39; ASC&#xD;&#xA;LIMIT 3;&#xD;&#xA;title | embedding | distance&#xD;&#xA;------------+---------------+--------------------&#xD;&#xA;Document 1 | [0.1,0.2,0.3] | 0.1414213612422477&#xD;&#xA;Document 2 | [0.4,0.5,0.6] | 0.5385165006363984&#xD;&#xA;Document 3 | [0.9,0.8,0.7] | 1.0677078185041473&#xD;&#xA;(3 rows)&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Elle est reprÃ©sentÃ©e par le cigle &amp;lt;-&amp;gt; dans pg_vector.&lt;/p&gt;&#xA;&lt;h4&gt;3. Quand choisir l&amp;#8217;une ou l&amp;#8217;autre des distances ?&lt;/h4&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La distance euclidienne est utile quand tu veux mesurer la diffÃ©rence globale entre deux objets. Elle est facile Ã  comprendre et Ã  utiliser pour des comparaisons directes.&lt;/li&gt;&#xA;&lt;li&gt;La distance cosinus est utile quand tu veux savoir si deux objets sont globalement similaires dans leur profil, indÃ©pendamment de leur taille ou de leur Ã©chelle. Elle est souvent utilisÃ©e pour comparer des documents textuels ou des donnÃ©es complexes en IA&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Conclusion&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;#8217;extension pg_vector apporte une fonctionnalitÃ© puissante Ã  PostgreSQL, permettant de manipuler des donnÃ©es complexes sous forme de vecteurs. Que ce soit pour des systÃ¨mes de recommandation, des moteurs de recherche ou toute autre application liÃ©e Ã  lâ€™intelligence artificielle, elle offre un moyen simple et efficace d&amp;#8217;intÃ©grer l&amp;#8217;IA dans les bases de donnÃ©es. Et tout cela, sans avoir besoin de comprendre des mathÃ©matiques avancÃ©es : il suffit de savoir que ces vecteurs permettent de traiter des informations complexes de maniÃ¨re trÃ¨s efficace.&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pg_recursively_delete-simplifier-les-suppressions-recursives/&#34; rel=&#34;bookmark&#34; title=&#34;3 avril 2024&#34;&gt;pg_recursively_delete : Simplifier les suppressions rÃ©cursives&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pyrseas-et-postgresql-comparer-facilement-des-schema-de-base-de-donnees/&#34; rel=&#34;bookmark&#34; title=&#34;3 janvier 2023&#34;&gt;Pyrseas et Postgresql : Comparer facilement des schÃ©mas de base de donnÃ©es&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-planifier-une-tache-avec-pg_cron/&#34; rel=&#34;bookmark&#34; title=&#34;24 septembre 2019&#34;&gt;PostgreSQL : planifier une tÃ¢che avec pg_cron&lt;/a&gt; (Emmanuel RAMI) [Non classÃ©PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/openrowset-episode-1/&#34; rel=&#34;bookmark&#34; title=&#34;13 juillet 2011&#34;&gt;OPENROWSET, Ã©pisode 1&lt;/a&gt; (David Baffaleuf) [SQL Server]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/transparent-data-encryption-pour-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;13 mai 2022&#34;&gt;Transparent Data Encryption pour PostgreSQL&lt;/a&gt; (Sarah FAVEERE) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 3.849 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&amp;#038;title=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=pg_vector%20%3A%20l%E2%80%99IA%20et%20PostgreSQL&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10620&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;1. Introduction : L&amp;#8217;intelligence artificielle et le rÃ´le des bases de donnÃ©es L&amp;#8217;intelligence artificielle (IA) connaÃ®t une popularitÃ© croissante, des assistants virtuels aux voitures autonomes, en passant par les recommandations de films et de produits. Mais pour que ces technologies&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pg_vector-lia-et-postgresql/&#34;&gt;pg_vector : l&amp;#8217;IA et PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup</title>
    <updated>2024-07-16T11:24:05Z</updated>
    <id>tag:blog.capdata.fr,2024-07-16:/index.php/postgresql-17-sauvegardes-incrementales/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-10592&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/07/SalesGrowth.jpg&#34; alt=&#34;&#34; width=&#34;279&#34; height=&#34;180&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Bonjour&lt;/p&gt;&#xA;&lt;p&gt;Les 11 et 12 juin derniers, nous Ã©tions aux journÃ©es PGDAY Ã  Lille pour dÃ©couvrir les nouveautÃ©s autour de PostgreSQL.&lt;br /&gt;&#xA;Cette confÃ©rence regroupe diffÃ©rents professionnels, de la communautÃ© francophone, qui agissent en contribuant sur des sujets techniques mais aussi sur les bonnes pratiques afin d&amp;#8217;utiliser PostgreSQL dans les meilleurs conditions.&lt;/p&gt;&#xA;&lt;p&gt;Un article m&amp;#8217;a particuliÃ¨rement intÃ©ressÃ© cette annÃ©e, c&amp;#8217;est celui de &lt;a href=&#34;https://www.linkedin.com/in/stefan-fercot/?originalSubdomain=be&#34;&gt;Stefan Fercot&lt;/a&gt; Senior DBA PostgreSQL qui vit en Belgique, et travaille pour une sociÃ©tÃ© allemande experte dans les solutions PostgreSQL. Sa prÃ©sentation portait sur le sujet &amp;#8220;dÃ©mystifier les sauvegardes incrÃ©mentales sous PostgreSQL&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;#8217;ai Ã©coutÃ© sa confÃ©rence tout en ayant hÃ¢te de tester sa mise en place dÃ¨s mon retour de Lille.&lt;/p&gt;&#xA;&lt;p&gt;Je tiens Ã  remercier Stefan pour son travail sur ce sujet sauvegardes PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Tout d&amp;#8217;abord, il faut savoir que les sujets sauvegardes incrÃ©mentales ont Ã©tÃ© dÃ©jÃ  abordÃ©s avec des outils comme &lt;strong&gt;Barman&lt;/strong&gt; ou &lt;strong&gt;Pg_BackRest&lt;/strong&gt;, et que certaines instances PostgreSQL de production sont sauvegardÃ©es via ces mÃ©canismes depuis quelques annÃ©es maintenant.&lt;/p&gt;&#xA;&lt;p&gt;Ici, nous parlons de la solution &amp;#8220;backup incremental&amp;#8221; inclu nativement dans le moteur PostgreSQL, et disponible avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8220;. C&amp;#8217;est d&amp;#8217;ailleurs ce point que Stefan a soulignÃ© durant la journÃ©e PGDAY du 11 juin dernier.&lt;/p&gt;&#xA;&lt;p&gt;Cette nouvelle fonctionnalitÃ© fait partie de la version &lt;strong&gt;PostgreSQL 17&lt;/strong&gt; qui est pour le moment, en version&lt;strong&gt; Beta 2&lt;/strong&gt;.&lt;br /&gt;&#xA;Celle ci devrait sortir, comme Ã  l&amp;#8217;accoutumÃ©, au cour de l&amp;#8217;automne prochain.&lt;/p&gt;&#xA;&lt;p&gt;Preuve que PostgreSQL est en perpÃ©tuel Ã©volution, et rejoint la liste des SGBD Ã©tant capable, comme peuvent le faire Oracle et SQL Server, de proposer nativement des sauvegardes incrÃ©mentales.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Installation de PostgreSQL 17&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Pour tester cette fonctionnalitÃ©, nous devons installer la toute derniÃ¨re version de PostgreSQL , la 17 beta 2. Attention, celle ci n&amp;#8217;Ã©tant pas disponible dans les dÃ©pÃ´ts PGDG, nous devons nous charger d&amp;#8217;installer cette version via le site postgresql.org&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&#34;&gt;https://download.postgresql.org/pub/repos/yum/testing/17/redhat/rhel-8-x86_64/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Nous disposons d&amp;#8217;un serveur Linux fork Red Hat 8 (Rocky Linux). Il nous faut donc tÃ©lÃ©charger les &amp;#8220;rpm&amp;#8221; liÃ©s Ã  cette version.&lt;/p&gt;&#xA;&lt;p&gt;Les packages dont nous avons besoin sont les suivants&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;# ls -lrt postgresql1* | awk &#39;{print$9}&#39;&#xD;&#xA;postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous les installons avec le compte &lt;strong&gt;root&lt;/strong&gt; de notre serveur.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[root@ tmp]# rpm -i postgresql17-libs-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-server-17-beta2_1PGDG.rhel8.x86_64.rpm&#xD;&#xA;[root@ tmp]# rpm -i postgresql17-contrib-17-beta2_1PGDG.rhel8.x86_64.rpm&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous sommes sur un environnement &amp;#8220;Red Hat like&amp;#8221;, la crÃ©ation d&amp;#8217;une premiÃ¨re instance via &amp;#8220;initdb&amp;#8221; est nÃ©cessaire.&lt;br /&gt;&#xA;Surtout, ne pas oublier d&amp;#8217;activer les &amp;#8220;data checksums&amp;#8221; (option -k), nous verrons pourquoi dans la suite de cet article. La suite est Ã  faire avec le compte &lt;strong&gt;postgres&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ initdb -D /data/postgres/17/pg_data -k&#xD;&#xA;The files belonging to this database system will be owned by user &amp;quot;postgres&amp;quot;.&#xD;&#xA;This user must also own the server process.&#xD;&#xA;&#xD;&#xA;The database cluster will be initialized with locale &amp;quot;en_US.UTF-8&amp;quot;.&#xD;&#xA;The default database encoding has accordingly been set to &amp;quot;UTF8&amp;quot;.&#xD;&#xA;The default text search configuration will be set to &amp;quot;english&amp;quot;.&#xD;&#xA;&#xD;&#xA;Data page checksums are enabled.&#xD;&#xA;&#xD;&#xA;creating directory /data/postgres/17/pg_data ... ok&#xD;&#xA;creating subdirectories ... ok&#xD;&#xA;selecting dynamic shared memory implementation ... posix&#xD;&#xA;selecting default &amp;quot;max_connections&amp;quot; ... 100&#xD;&#xA;selecting default &amp;quot;shared_buffers&amp;quot; ... 128MB&#xD;&#xA;selecting default time zone ... UTC&#xD;&#xA;creating configuration files ... ok&#xD;&#xA;running bootstrap script ... ok&#xD;&#xA;performing post-bootstrap initialization ... ok&#xD;&#xA;syncing data to disk ... ok&#xD;&#xA;&#xD;&#xA;initdb: warning: enabling &amp;quot;trust&amp;quot; authentication for local connections&#xD;&#xA;initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.&#xD;&#xA;&#xD;&#xA;Success. You can now start the database server using:&#xD;&#xA;&#xD;&#xA;pg_ctl -D /data/postgres/17/pg_data -l logfile start&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;DÃ©marrer cette instance pour s&amp;#8217;assurer que tout fonctionne&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data -l logfile start&#xD;&#xA;waiting for server to start.... done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Notre version enregistrÃ©e est bien une Beta 2. Version qui ne doit pas Ãªtre mise sur un environnement de production comme le rappelle le site de la communautÃ© PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ psql&#xD;&#xA;(postgres@[local]:5437) [postgres] &amp;gt; select * from version();&#xD;&#xA;version&#xD;&#xA;------------------------------------------------------------------------------------------------------------&#xD;&#xA;PostgreSQL 17beta2 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 8.5.0 20210514 (Red Hat 8.5.0-22), 64-bit&#xD;&#xA;(1 row)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Upgrade de version&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Comme nous disposions deja d&amp;#8217;une version PostgreSQL15 sur ce serveur, nous passons par un upgrade via l&amp;#8217;outil &amp;#8220;pg_upgrade&amp;#8221; toujours disponible dans cette nouvelle version.&lt;/p&gt;&#xA;&lt;p&gt;Lancer pg_upgrade en mode check&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -c -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&#xD;&#xA;.....&#xD;&#xA;.....&#xD;&#xA;&#xD;&#xA;*Clusters are compatible*&#xD;&#xA;&amp;quot;/usr/pgsql-17/bin/pg_ctl&amp;quot; -w -D &amp;quot;/data/postgres/17/pg_data&amp;quot; -o &amp;quot;&amp;quot; -m smart stop  &amp;quot;/data/postgres/17/pg_data/pg_upgrade_output.d/20240708T085906.955/log/pg_upgrade_server.log&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;la log est gÃ©nÃ©rÃ©e dans le $PGDATA de la version 17.&lt;/p&gt;&#xA;&lt;p&gt;Puis lancer l&amp;#8217;exÃ©cution de pg_upgrade&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_upgrade -b /usr/pgsql-15/bin/ -B /usr/pgsql-17/bin/ -d /data/postgres/15/pg_data/ -D /data/postgres/17/pg_data/ -p 5434 -P 5437&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Effectuer une sauvegarde&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;PrÃ©requis&lt;/h3&gt;&#xA;&lt;p&gt;Avant de pouvoir effectuer une premiÃ¨re sauvegarde avec l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221; natif, il est primordial de respecter certains prÃ©requis important.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;L&amp;#8217;instance PostgreSQL doit Ãªtre crÃ©Ã©e avec les &amp;#8216;data checksums&amp;#8217; activÃ©s. Si ce n&amp;#8217;est pas le cas, utiliser l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_checksums&lt;/strong&gt;&amp;#8221; avec l&amp;#8217;option &amp;#8220;&lt;strong&gt;-e&lt;/strong&gt;&amp;#8220;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Si vous lancez une sauvegarde full puis une incrÃ©mentale immÃ©diatement, vous avez toutes les chances de tomber sur cette erreur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: incremental backups cannot be taken unless WAL summarization is enabled&lt;/pre&gt;&#xA;&lt;p&gt;En effet, pour avoir toutes les informations concernant les blocks modifiÃ©s, PostgreSQL a besoin de tracer dans les WALs toutes les modifications sur les objets en base.&lt;br /&gt;&#xA;Pour les DBA Oracle, le &amp;#8220;block change tracking&amp;#8221; de la version Enterprise Edition vous parlera trÃ¨s certainement&amp;#8230;.&lt;br /&gt;&#xA;Il s&amp;#8217;agit ici de la mÃªme fonctionnalitÃ©, c&amp;#8217;est Ã  dire, tracer les modifications effectuÃ©es dans les blocks de donnÃ©es.&lt;br /&gt;&#xA;Cette option est le &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Pour activer l&amp;#8217;option, nous aurons 2 paramÃ¨tres Ã  modifier, soit via un ALTER SYSTEM directement sous psql, ou bien dans le fichier &amp;#8220;postgresql.conf&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres backup]$ vi $PGDATA/postgresql.conf&#xD;&#xA;...&#xD;&#xA;&#xD;&#xA;# - WAL Summarization -&#xD;&#xA;&#xD;&#xA;#summarize_wal = off # run WAL summarizer process?&#xD;&#xA;#wal_summary_keep_time = &#39;10d&#39; # when to remove old summary files, 0 = never&lt;/pre&gt;&#xA;&lt;p&gt;Le premier paramÃ¨tre permet d&amp;#8217;activer cette option.&lt;br /&gt;&#xA;Le second dÃ©finit un temps de conservation des informations concernant les blocks modifiÃ©s entre une sauvegarde FULL et un incrÃ©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous activons donc l&amp;#8217;option &amp;#8220;&lt;strong&gt;summarize_wal&lt;/strong&gt;&amp;#8221; et la passons Ã  &lt;strong&gt;ON&lt;/strong&gt; et laissons Ã  10 jours le &amp;#8220;&lt;strong&gt;wal_summary_keep_time&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Attention, activez ces deux paramÃ¨tres avant votre premiÃ¨re sauvegarde FULL. Si vous le faites aprÃ¨s, vous risquez de rencontrer l&amp;#8217;erreur suivante&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;pg_basebackup: error: could not initiate base backup: ERROR: WAL summaries are required on timeline 1 from 1/AA000028 to 1/AC000060, but the summaries for that timeline and LSN range are incomplete&#xD;&#xA;DETAIL: The first unsummarized LSN in this range is 1/AA000028.&lt;/pre&gt;&#xA;&lt;p&gt;Le LSN pris lors de la premiÃ¨re sauvegarde FULL n&amp;#8217;est pas reconnu, et donc la sauvegarde incrÃ©mentale ne peut s&amp;#8217;appuyer dessus.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;RedÃ©marrer l&amp;#8217;instance une fois les modifications effectuÃ©es&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres ~]$ pg_ctl -D /data/postgres/17/pg_data/ restart&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Lancer une sauvegarde FULL&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Voici la nouvelle option prÃ©sente pour l&amp;#8217;outil &amp;#8220;&lt;strong&gt;pg_basebackup&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup --help&#xD;&#xA;pg_basebackup takes a base backup of a running PostgreSQL server.&#xD;&#xA;&#xD;&#xA;Usage:&#xD;&#xA;pg_basebackup [OPTION]...&#xD;&#xA;&#xD;&#xA;Options controlling the output:&#xD;&#xA;-D, --pgdata=DIRECTORY receive base backup into directory&#xD;&#xA;-F, --format=p|t output format (plain (default), tar)&#xD;&#xA;-i, --incremental=OLDMANIFEST&#xD;&#xA;take incremental backup&#xD;&#xA;-r, --max-rate=RATE maximum transfer rate to transfer data directory&#xD;&#xA;(in kB/s, or use suffix &amp;quot;k&amp;quot; or &amp;quot;M&amp;quot;)&#xD;&#xA;&#xD;&#xA;.... &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Depuis la &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34;&gt;version 13&lt;/a&gt; de PostgreSQL, nous disposons pour chaque sauvegarde, d&amp;#8217;un fichier nommÃ© &amp;#8220;backup_manifest&amp;#8221;. Il s&amp;#8217;agit d&amp;#8217;un fichier json qui recense entiÃ¨rement les objets bases de donnÃ©es sauvegardÃ©s avec leur emplacement, leur taille, leur date de modification et leur &amp;#8220;checksum&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;Celui ci est essentiel pour vÃ©rifier l&amp;#8217;intÃ©gritÃ© de notre sauvegarde avec &amp;#8220;&lt;strong&gt;pg_verifybackup&lt;/strong&gt;&amp;#8220;.&lt;/p&gt;&#xA;&lt;p&gt;Nous pouvons Ã  prÃ©sent faire une premiÃ¨re sauvegarde FULL de notre instance PG17.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres -]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17 -F p -l &amp;quot;Full Backup PG17&amp;quot; -P -v&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AD000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8048&amp;quot;&#xD;&#xA;3097788/3097788 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AD000158&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on effectue quelques transactions : crÃ©ation d&amp;#8217;une table et insertions de donnÃ©es sur cette table de test&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt;(postgres@[local]:5437) [manu] $ &amp;gt; create table backup (nom varchar(20), type varchar(20), date_backup date);&#xD;&#xA;CREATE TABLE&#xD;&#xA;Time: 3.344 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;FULL&#39;,&#39;2024-07-08 12:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 3.612 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental&#39;,&#39;2024-07-08 13:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.461 ms&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;RepÃ©rer le fichier &amp;#8220;backup_manifest&amp;#8221; de la sauvegarde FULL rÃ©alisÃ©e dans le dossier &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres PG17]$ ls -lrt backup*&#xD;&#xA;-rw-------. 1 postgres postgres 218 Jul 8 09:19 backup_label&#xD;&#xA;-rw-------. 1 postgres postgres 433295 Jul 8 09:20 backup_manifest&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h3&gt;Effectuer une sauvegarde incrÃ©mentale&lt;/h3&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A partir de lÃ , lancer une sauvegarde incrÃ©mentale. Nous utilisons l&amp;#8217;option &amp;#8220;&lt;strong&gt;-i&lt;/strong&gt;&amp;#8221; pour indiquer Ã  &lt;strong&gt;pg_basebackup&lt;/strong&gt; ou est situÃ© le &amp;#8220;backup_manifest&amp;#8221; de la derniÃ¨re sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr -l &amp;quot;Incremental Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/AF000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8139&amp;quot;&#xD;&#xA;12485/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/AF000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;S&amp;#8217;il l&amp;#8217;on compare les deux rÃ©pertoires de sauvegardes &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17&lt;/strong&gt;&amp;#8221; et &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8220;, nous voyons que les tailles sont bien diffÃ©rentes&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;......&#xD;&#xA;3.0G /data/postgres/backup/pg_basebackup/PG17&#xD;&#xA;&#xD;&#xA;[postgres - ]$ du -h /data/postgres/backup/pg_basebackup/PG17_incr&#xD;&#xA;......&#xD;&#xA;35M /data/postgres/backup/pg_basebackup/PG17_incr&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Un volume de 3Go pour la sauvegarde FULL de l&amp;#8217;instance contre 35Mo pour l&amp;#8217;incrÃ©mentale.&lt;br /&gt;&#xA;La taille occupÃ©e par les objets dans chacune des bases est bien plus faible dans la sauvegarde incrÃ©mentale.&lt;/p&gt;&#xA;&lt;p&gt;Nous continuons Ã  insÃ©rer des donnÃ©es :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: sql; title: ; notranslate&#34;&gt; [postgres - ]$ psql -d manu&#xD;&#xA;&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+-------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;(2 rows)&#xD;&#xA;&#xD;&#xA;Time: 0.614 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; insert into backup values (&#39;sauvegarde&#39;,&#39;incremental 2&#39;,&#39;2024-07-08 14:00:00&#39;);&#xD;&#xA;INSERT 0 1&#xD;&#xA;Time: 1.436 ms&#xD;&#xA;(postgres@[local]:5437) [manu] $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;(3 rows)&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis on lance une seconde sauvegarde incrÃ©mentale :&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_basebackup -D /data/postgres/backup/pg_basebackup/PG17_incr_2 -l &amp;quot;Incremental 2 Backup PG17&amp;quot; -P -v -i /data/postgres/backup/pg_basebackup/PG17_incr/backup_manifest&#xD;&#xA;pg_basebackup: initiating base backup, waiting for checkpoint to complete&#xD;&#xA;pg_basebackup: checkpoint completed&#xD;&#xA;pg_basebackup: write-ahead log start point: 1/B1000028 on timeline 1&#xD;&#xA;pg_basebackup: starting background WAL receiver&#xD;&#xA;pg_basebackup: created temporary replication slot &amp;quot;pg_basebackup_8313&amp;quot;&#xD;&#xA;12260/3097787 kB (100%), 1/1 tablespace&#xD;&#xA;pg_basebackup: write-ahead log end point: 1/B1000120&#xD;&#xA;pg_basebackup: waiting for background process to finish streaming ...&#xD;&#xA;pg_basebackup: syncing data to disk ...&#xD;&#xA;pg_basebackup: renaming backup_manifest.tmp to backup_manifest&#xD;&#xA;pg_basebackup: base backup completed&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Nous remarquons l&amp;#8217;appel au &amp;#8220;backup manifest&amp;#8221; de la derniÃ¨re sauvegarde incrÃ©mentale prÃ©sente dans le rÃ©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_incr&lt;/strong&gt;&amp;#8221;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on regarde la taille de ce nouveau backup&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres pg_basebackup]$ du -h PG17_incr_2&#xD;&#xA;.......&#xD;&#xA;35M PG17_incr_2&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;A nouveau 35 Mo, mais vu le peu de modifications effectuÃ©es, la taille n&amp;#8217;est pas trÃ¨s reprÃ©sentative.&lt;/p&gt;&#xA;&lt;p&gt;Ce qu&amp;#8217;il faut retenir, c&amp;#8217;est qu&amp;#8217;en fonction du fichier &amp;#8220;backup manifest&amp;#8221; pris lors de l&amp;#8217;appel Ã  &lt;strong&gt;pg_basebackup&lt;/strong&gt;, vous pourrez faire soit&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde incrÃ©mentale qui prendra les derniÃ¨res modifications depuis la derniÃ¨re sauvegarde incrÃ©mentale effectuÃ©e.&lt;br /&gt;&#xA;&amp;#8211; une sauvegarde diffÃ©rentielle qui prendra les modifications faites depuis la derniÃ¨re sauvegarde FULL si vous vous appuyez toujours sur le &amp;#8220;backup manifest&amp;#8221; de votre sauvegarde FULL.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;#8217;est donc ce fichier json &amp;#8220;backup manifest&amp;#8221; qui a un rÃ´le essentiel dans l&amp;#8217;Ã©laboration de votre stratÃ©gie de sauvegarde au fur et Ã  mesure du temps.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;h2&gt;Et la restauration , comment ca se passe ?&lt;/h2&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Si l&amp;#8217;on souhaite restaurer tous ces jeux de sauvegardes, nous utilisons un nouvel outil qui est &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;.&lt;br /&gt;&#xA;Cet outil permet de &amp;#8220;merger&amp;#8221; les diffÃ©rentes sauvegardes dans un et un seul dossier que l&amp;#8217;on restaurera par la suite.&lt;/p&gt;&#xA;&lt;p&gt;Dans notre exemple, nous avons fait 1 sauvegarde FULL puis 2 incrÃ©mentales.&lt;br /&gt;&#xA;Nous allons donc restaurer ces 3 jeux de sauvegardes afin de retrouver les donnÃ©es. A noter qu&amp;#8217;il existe une option &amp;#8220;&amp;#8211;dry-run&amp;#8221; pour tester la commande&lt;/p&gt;&#xA;&lt;p&gt;ExÃ©cuter la commande en prenant en paramÃ¨tre les dossiers de sauvegardes dans l&amp;#8217;ordre chronologique.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -n -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;Si aucune erreur en sortie, on exÃ©cute sans l&amp;#8217;option &amp;#8220;dry run&amp;#8221;.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; [postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_ALL /data/postgres/backup/pg_basebackup/PG17 /data/postgres/backup/pg_basebackup/PG17_incr /data/postgres/backup/pg_basebackup/PG17_incr_2 &lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Le rÃ©pertoire &amp;#8220;&lt;strong&gt;/data/postgres/backup/pg_basebackup/PG17_ALL&lt;/strong&gt;&amp;#8221; ainsi gÃ©nÃ©rÃ©, doit avoir une taille trÃ¨s lÃ©gÃ¨rement supÃ©rieure au dossier de la sauvegarde FULL.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ du -h PG17_ALL&#xD;&#xA;....&#xD;&#xA;3.0G PG17_ALL&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;DerniÃ¨re Ã©tape, nous passons Ã  la restauration des donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Nous arrÃªtons l&amp;#8217;instance PG17&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ stop&#xD;&#xA;waiting for server to shut down.... done&#xD;&#xA;server stopped&lt;/pre&gt;&#xA;&lt;p&gt;Nous supprimons les donnÃ©es dans $PGDATA&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ rm -rf /data/postgres/17/pg_data/* &lt;/pre&gt;&#xA;&lt;p&gt;Puis nous restaurons ce jeu complet de donnÃ©es avec une simple copie.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ cp -r /data/postgres/backup/pg_basebackup/PG17_ALL/* /data/postgres/17/pg_data/ &lt;/pre&gt;&#xA;&lt;p&gt;Enfin redÃ©marrons l&amp;#8217;instance&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_ctl -D /data/postgres/17/pg_data/ start&#xD;&#xA;waiting for server to start....2024-07-08 10:51:45.671 UTC [8909] LOG: redirecting log output to logging collector process&#xD;&#xA;2024-07-08 10:51:45.671 UTC [8909] HINT: Future log output will appear in directory &amp;quot;log&amp;quot;.&#xD;&#xA;done&#xD;&#xA;server started&lt;/pre&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Puis contrÃ´ler que nous rÃ©cupÃ©rons bien toutes les lignes de notre table &amp;#8220;backup&amp;#8221;.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres@ip-172-44-2-96 pg_basebackup]$ psql -d manu&#xD;&#xA;(postgres@[local]:5437) [manu] primaire $ &amp;gt; select * from backup;&#xD;&#xA;nom | type | date_backup&#xD;&#xA;------------+---------------+-------------&#xD;&#xA;sauvegarde | FULL | 2024-07-08&#xD;&#xA;sauvegarde | incremental | 2024-07-08&#xD;&#xA;sauvegarde | incremental 2 | 2024-07-08&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;&lt;/h3&gt;&#xA;&lt;h3&gt;Remarques&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Attention, toujours vÃ©rifier les sauvegardes Ã  chaque Ã©tape avec l&amp;#8217;outil &lt;strong&gt;pg_verifybackup &lt;/strong&gt;car rien ne garantit qu&amp;#8217;au moment de l&amp;#8217;appel Ã  &lt;strong&gt;pg_combinebackup&lt;/strong&gt; les diffÃ©rents jeux de sauvegardes FULL et/ou incrÃ©mentales ne soient pas corrompus.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Assurez vous d&amp;#8217;Ãªtre en mode &amp;#8220;data_checksum&amp;#8221; activÃ© et ne pas changer de mode entre les jeux de backup. Le &amp;#8220;backup manifest&amp;#8221; s&amp;#8217;appuie sur ce paramÃ©trage pour valider les checksums de chaque fichier.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le mode TAR pour &lt;strong&gt;pg_basebackup&lt;/strong&gt; n&amp;#8217;est pas compatible pour les sauvegardes full et incrÃ©mentales mÃªme si celui ci est possible. Mais c&amp;#8217;est Ã  vous de dÃ©tarer les fichiers &amp;#8220;&lt;strong&gt;base.tar.gz&lt;/strong&gt;&amp;#8221; Et au moment de la restaurationÂ  avec &amp;#8220;&lt;strong&gt;pg_combinebackup&lt;/strong&gt;&amp;#8220;, une possible corruption est rencontrÃ©e.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;[postgres - ]$ pg_combinebackup -o /data/postgres/backup/pg_basebackup/PG17_all_tar /data/postgres/backup/pg_basebackup/PG17_TAR /data/postgres/backup/pg_basebackup/PG17_incr_TAR&#xD;&#xA;pg_combinebackup: error: could not write to file &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar/base/25284/25332&amp;quot;, offset 122470400: wrote 380928 of 409600&#xD;&#xA;pg_combinebackup: removing output directory &amp;quot;/data/postgres/backup/pg_basebackup/PG17_all_tar&amp;quot; &lt;/pre&gt;&#xA;&lt;p&gt;La compression a potentiellement ajoutÃ©e une corruption ne rendant pas possible l&amp;#8217;opÃ©ration de &amp;#8220;merge&amp;#8221; des donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;La restauration PITR est possible bien entendu. N&amp;#8217;oubliez pas de crÃ©er le &amp;#8220;&lt;strong&gt;recovery.signal&lt;/strong&gt;&amp;#8221; dans $PGDATA et de dÃ©finir dans le fichier &amp;#8220;postgresql.conf&amp;#8221; les quelques paramÃ¨tres suivants&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_nameÂ &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_time &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_xid &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #3366ff;&#34;&gt;recovery_target_lsn &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_inclusive = off ou on&lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_timeline = &amp;#8216;latest&amp;#8217; &lt;/span&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;span style=&#34;color: #808000;&#34;&gt;recovery_target_action = &amp;#8216;pause&amp;#8217;Â &lt;/span&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://s.w.org/images/core/emoji/15.1.0/72x72/1f642.png&#34; alt=&#34;ğŸ™‚&#34; class=&#34;wp-smiley&#34; style=&#34;height: 1em; max-height: 1em;&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-la-streaming-replication-en-12/&#34; rel=&#34;bookmark&#34; title=&#34;19 novembre 2019&#34;&gt;PostgreSQL : la streaming replication en 12.&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-13-les-nouveautes-interessantes/&#34; rel=&#34;bookmark&#34; title=&#34;30 octobre 2020&#34;&gt;PostgreSQL 13 : prÃ©sentation&lt;/a&gt; (Emmanuel RAMI) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/oracle-rds-effectuer-des-backup-rman-en-mode-paas/&#34; rel=&#34;bookmark&#34; title=&#34;25 juin 2019&#34;&gt;Oracle RDS : effectuer des backup RMAN en mode PaaS.&lt;/a&gt; (Emmanuel RAMI) [AWSNon classÃ©Oracle]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-comparatif-entre-barman-et-pgbackrest/&#34; rel=&#34;bookmark&#34; title=&#34;4 fÃ©vrier 2020&#34;&gt;PostgreSQL : Comparatif entre Barman et pgBackRest&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/haute-disponibilite-de-postgresql-avec-patroni/&#34; rel=&#34;bookmark&#34; title=&#34;2 fÃ©vrier 2022&#34;&gt;Haute disponibilitÃ© de PostgreSQL avec Patroni&lt;/a&gt; (Ludovic AUGEREAU) [PostgreSQL]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 13.504 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&amp;#038;title=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PostgreSQL%2017%20%3A%20des%20sauvegardes%20incr%C3%A9mentales%20avec%20pg_basebackup&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10584&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;&amp;#160; Bonjour Les 11 et 12 juin derniers, nous Ã©tions aux journÃ©es PGDAY Ã  Lille pour dÃ©couvrir les nouveautÃ©s autour de PostgreSQL. Cette confÃ©rence regroupe diffÃ©rents professionnels, de la communautÃ© francophone, qui agissent en contribuant sur des sujets techniques mais&amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/postgresql-17-sauvegardes-incrementales/&#34;&gt;PostgreSQL 17 : des sauvegardes incrÃ©mentales avec pg_basebackup&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PGO : la suite</title>
    <updated>2024-05-29T08:58:17Z</updated>
    <id>tag:blog.capdata.fr,2024-05-29:/index.php/pgo-la-suite/</id>
    <content type="html">&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;title=PGO%20%3A%20la%20suite&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PGO%20%3A%20la%20suite&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;La gestion efficace des clusters PostgreSQL dans un environnement Kubernetes est un dÃ©fi complexe auquel sont confrontÃ©es de nombreuses entreprises aujourd&amp;#8217;hui. PGO offre une solution dÃ©clarative qui automatise la gestion des clusters PostgreSQL, simplifiant ainsi le dÃ©ploiement, la mise Ã  l&amp;#8217;Ã©chelle et la gestion des bases de donnÃ©es PostgreSQL dans un environnement Kubernetes.&lt;/p&gt;&#xA;&lt;p&gt;Pour faire suite Ã  l&amp;#8217;article de David sur PGO et Ã  la demande d&amp;#8217;un de nos clients, j&amp;#8217;ai rÃ©alisÃ© une Ã©tude approfondie de plusieurs fonctionnalitÃ©s de PGO.&lt;br /&gt;&#xA;Cet article va faire un petit tour d&amp;#8217;horizon des outils principaux inclus dans l&amp;#8217;implÃ©mentation de PGO. Que ce soit pour la sauvegarde avec pgbackrest, pour la balance des connexion avec pgbouncer ou pour le monitoring avec prometheus, PGO ne manque pas d&amp;#8217;utilitaire dont l&amp;#8217;utilisation est facilitÃ©e par la solution tout embarquÃ©.&lt;/p&gt;&#xA;&lt;h3&gt;Pgbackrest :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;PgBackRest est une solution de sauvegarde et de restauration pour les bases de donnÃ©es PostgreSQL qui propose plusieurs fonctionnalitÃ©s, telles que la sauvegarde et la restauration parallÃ¨les, la compression, les sauvegardes complÃ¨tes, diffÃ©rentielles et incrÃ©mentielles, la rotation des sauvegardes et l&amp;#8217;expiration des archives, l&amp;#8217;intÃ©gritÃ© des sauvegardes, etc. Il prend en charge plusieurs rÃ©fÃ©rentiels, qui peuvent Ãªtre situÃ©s localement ou Ã  distance via TLS/SSH, ou Ãªtre des stockages fournis par le cloud comme S3/GCS/Azure.&lt;br /&gt;&#xA;L&amp;#8217;architecture de pgbackrest pour PGO est la suivante :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1.png&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10564&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1-300x168.png&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;168&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image1-300x168.png 300w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image1.png 605w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;On peut imaginer plusieurs moyens de mettre en place le pgbackrest. Dans un premier temps, nous avons la sauvegarde classique en systÃ¨me de fichier, comme dans notre exemple sur le blog :&lt;/p&gt;&#xA;&lt;h5&gt;1) La sauvegarde sur volume persistant Kubernetes :&lt;/h5&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;- name: repo1&#xD;&#xA;  volume:&#xD;&#xA;    volumeClaimSpec:&#xD;&#xA;      accessModes:&#xD;&#xA;      - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;      resources:&#xD;&#xA;        requests:&#xD;&#xA;          storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ce type de sauvegarde utilise un volume persistant de Kubernetes pour recueillir nos sauvegardes et les garder.&lt;br /&gt;&#xA;Une PersistentVolumeClaim (PVC) est une demande de stockage faite par un utilisateur. Elle est similaire Ã  un Pod. Les Pods consomment des ressources de nÅ“ud et les PVC consomment des ressources de PV (PersistentVolume). Les Pods peuvent demander des niveaux spÃ©cifiques de ressources (CPU et mÃ©moire). Les revendications peuvent demander une taille spÃ©cifique et des modes d&amp;#8217;accÃ¨s spÃ©cifiques (par exemple, elles peuvent Ãªtre montÃ©es en ReadWriteOnce, ReadOnlyMany, ReadWriteMany, ou ReadWriteOncePod, voir AccessModes).&lt;/p&gt;&#xA;&lt;h5&gt;2) Le stockage pour S3 :&lt;/h5&gt;&#xA;&lt;p&gt;Pour pouvoir faire du stockage dans S3, il faut rajouter un fichier de configuration dans notre dossier de dÃ©ploiement. Le fichier doit sâ€™appeler s3.conf. Ce fichier contient les crÃ©dential de connexion Ã  un AWS S3 :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;repo1-s3-key=$YOUR_AWS_S3_KEY&#xD;&#xA;repo1-s3-key-secret=$YOUR_AWS_S3_KEY_SECRET&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois que câ€™est configurÃ© dans votre fichier, il ne reste plus quâ€™Ã  modifier le postgresql.yaml, et configurer dans la partie backup :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-s3-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster1/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        s3:&#xD;&#xA;          bucket: &amp;quot;&amp;lt;YOUR_AWS_S3_BUCKET_NAME&amp;gt;&amp;quot;&#xD;&#xA;          endpoint: &amp;quot;&amp;lt;YOUR_AWS_S3_ENDPOINT&amp;gt;&amp;quot;&#xD;&#xA;          region: &amp;quot;&amp;lt;YOUR_AWS_S3_REGION&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois configurÃ©, et le job mis dans le cron, vous devriez voir apparaitre les sauvegardes sur le volume S3.&lt;/p&gt;&#xA;&lt;h5&gt;3) Le stockage GCS :&lt;/h5&gt;&#xA;&lt;p&gt;Comme pour Amazon S3 on peut sauvegarder nos backups dans Google Cloud Storage. Pour pouvoir le faire fonctionner il vous faut copier votre GCS key secret (qui est un fichier JSON) dans un gcs.conf que vous allez placer dans votre dossier Kustomize.&lt;br /&gt;&#xA;Il vous suffit ensuite de modifier votre fichier postgres.yaml pour ajouter dans la partie backup la configuration pour une sauvegarde gcs :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-gcs-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster1/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        gcs:&#xD;&#xA;          bucket: &amp;quot;&amp;lt;YOUR_GCS_BUCKET_NAME&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il ne vous reste plus quâ€™Ã  regÃ©nÃ©rer vos pods, et votre sauvegarde arrivera directement dans votre Google Cloud Service.&lt;/p&gt;&#xA;&lt;h5&gt;4) Le stockage Azur Blob Storage :&lt;/h5&gt;&#xA;&lt;p&gt;Comme pour les deux points prÃ©cÃ©dents, vous pouvez Ã©galement stocker vos sauvegardes sur le blob storage dâ€™Azure. Pour cela il vous faut crÃ©er un fichier dans votre kustomize, avec Ã  lâ€™intÃ©rieur la configuration pour votre point de sauvegarde Azure. Il vous faut lâ€™appeler azure.conf et il devra contenir les lignes suivantes :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;repo1-azure-account=$YOUR_AZURE_ACCOUNT&#xD;&#xA;repo1-azure-key=$YOUR_AZURE_KEY&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il faut ensuite intÃ©grer ces modifications dans votre fichier postgres.yaml :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      configuration:&#xD;&#xA;      - secret:&#xD;&#xA;          name: pgo-azure-creds&#xD;&#xA;      global:&#xD;&#xA;        repo1-path: /pgbackrest/postgres-operator/pgcluster/repo1&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        azure:&#xD;&#xA;          container: &amp;quot;&amp;lt;YOUR_AZURE_CONTAINER&amp;gt;&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Bien sur rien ne vous interdit, et câ€™est mÃªme conseillÃ©, de joindre plusieurs moyens de sauvegarde. Cela permet notamment de sâ€™assurer une plus grande fiabilitÃ© du systÃ¨me de sauvegarde, en sâ€™assurant quâ€™elles sont disponibles Ã  plusieurs endroits.&lt;br /&gt;&#xA;Une fois que vous avez dÃ©cidÃ© dâ€™oÃ¹ vous allez stocker vos sauvegardes, et que vous lâ€™avez configurÃ©, il faut maintenant dÃ©cider des diffÃ©rents paramÃ¨tres de ces sauvegardes : la programmation, la rÃ©tentionâ€¦&lt;/p&gt;&#xA;&lt;h5&gt;5) La programmation des sauvegardes :&lt;/h5&gt;&#xA;&lt;p&gt;Il faut savoir que par dÃ©faut, PGO sauvegarde automatiquement les WAL dans la mÃ©thode de sauvegarde que vous lui avez configurÃ©. Câ€™est donc une forme de sauvegarde en soit.&lt;br /&gt;&#xA;Mais dans le cadre dâ€™une rÃ©cupÃ©ration aprÃ¨s incident majeur, il peut aussi Ãªtre utilise dâ€™avoir des sauvegardes full programmÃ©es. Pgbackrest, qui est lâ€™outil utilisÃ© par PGO permet de mettre en place trois types de sauvegarde : les incrÃ©mentales, les diffÃ©rentielles et les fulls.&lt;br /&gt;&#xA;Chaque type de sauvegarde peut Ãªtre programmÃ©e en suivant une notation identique Ã  celle des crontab. Par exemple :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        schedules:&#xD;&#xA;          full: &amp;quot;0 1 * * 0&amp;quot;&#xD;&#xA;          differential: &amp;quot;0 1 * * 1-6&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Le fait dâ€™implÃ©menter ces planifications crÃ©era des CronJobs dans Kubernetes.&lt;/p&gt;&#xA;&lt;h5&gt;6) La rÃ©tention des backups :&lt;/h5&gt;&#xA;&lt;p&gt;Vous pouvez dÃ©finir une rÃ©tention maximum pour vos backups sur le support de backup de votre choix. Une fois que cette rÃ©tention sera atteinte, pgbackrest fera le mÃ©nage tout seul des sauvegardes et des WAL qui lui sont reliÃ©es.&lt;br /&gt;&#xA;Il y a deux types de rÃ©tentions que lâ€™on peut dÃ©finir : les rÃ©tentions Â« count Â» basÃ©es sur le nombre de backup que lâ€™on souhaite garder et les rÃ©tentions Â« time Â» basÃ©es sur le nombre de jours ou vous souhaitez garder votre sauvegarde.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      global:&#xD;&#xA;        repo1-retention-full: &amp;quot;14&amp;quot;&#xD;&#xA;        repo1-retention-full-type: time&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h5&gt;7) La sauvegarde unique :&lt;/h5&gt;&#xA;&lt;p&gt;Si dans le cadre dâ€™un besoin particuliers, une grosse modification ou une migration par exemple, vous avez besoin de prendre une sauvegarde immÃ©diate sans forcÃ©ment attendre que le cron nâ€™arrive, vous pouvez le faire.&lt;br /&gt;&#xA;Pour la configuration de cette sauvegarde, il faudra lâ€™annoter comme Â« manuelle Â» :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      manual:&#xD;&#xA;        repoName: repo1&#xD;&#xA;        options:&#xD;&#xA;         - --type=full&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il vous faudra ensuite dÃ©clencher cette sauvegarde avec une commande manuelle. Dans le cadre de notre cluster exemple pgcluster1 :&lt;br /&gt;&#xA;kubectl annotate -n postgres-operator postgrescluster pgcluster1 \ postgres-operator.crunchydata.com/pgbackrest-backup=&amp;#8221;$(date)&amp;#8221;&lt;/p&gt;&#xA;&lt;h5&gt;8) Faire un clone Ã  partir dâ€™un repo :&lt;/h5&gt;&#xA;&lt;p&gt;Quand on a configurÃ© un repo sur notre instance primaire, on peut facilement crÃ©er un clone de notre instance Ã  lâ€™aide de notre sauvegarde. Ainsi, on crÃ©er un tout nouveau Pods Ã  partir des informations stockÃ©es Ã  propos du pod que lâ€™on possÃ¨de dÃ©jÃ . Ici, nous allons crÃ©er un nouveau pod Ã  partir de notre pod pgcluster1 :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;apiVersion: postgres-operator.crunchydata.com/v1beta1&#xD;&#xA;kind: PostgresCluster&#xD;&#xA;metadata:&#xD;&#xA;  name: pgcluster2&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;  image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres:ubi8-16.2-0&#xD;&#xA;  postgresVersion: 16&#xD;&#xA;  instances:&#xD;&#xA;    - dataVolumeClaimSpec:&#xD;&#xA;        accessModes:&#xD;&#xA;        - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;        resources:&#xD;&#xA;          requests:&#xD;&#xA;            storage: 1Gi&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        volume:&#xD;&#xA;          volumeClaimSpec:&#xD;&#xA;            accessModes:&#xD;&#xA;            - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;            resources:&#xD;&#xA;              requests:&#xD;&#xA;                storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici on peut noter entre autres la partie spec de la configuration, qui est le morceau de yaml nous permettant de dire quâ€™on sâ€™appuie sur le cluster existant pour crÃ©er un clone indÃ©pendant :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;h5&gt;9) Point in Time Recovery :&lt;/h5&gt;&#xA;&lt;p&gt;De la mÃªme faÃ§on, si lâ€™on veut faire une restauration PITR, nous allons remplir la balise spec de notre yaml. Attention cependant, pour faire une restauration PITR, nous avons besoin de possÃ©der encore la sauvegarde. On ne peut pas faire une restauration PITR sur une sauvegarde lointaine quâ€™on ne possÃ¨derait plus. Imaginons que je souhaite repartir dâ€™une sauvegarde datant dâ€™hier soir Ã  20h30 de mon instance pgcluster1 sur mon instance pgcluster2, la configuration serait la suivante :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;apiVersion: postgres-operator.crunchydata.com/v1beta1&#xD;&#xA;kind: PostgresCluster&#xD;&#xA;metadata:&#xD;&#xA;  name: pgcluster2&#xD;&#xA;spec:&#xD;&#xA;  dataSource:&#xD;&#xA;    postgresCluster:&#xD;&#xA;      clusterName: pgcluster1&#xD;&#xA;      repoName: repo1&#xD;&#xA;      options:&#xD;&#xA;      - --type=time&#xD;&#xA;      - --target=&amp;quot;2024-04-09 20:30:00-00&amp;quot;&#xD;&#xA;  image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres:ubi8-16.2-0&#xD;&#xA;  postgresVersion: 16&#xD;&#xA;  instances:&#xD;&#xA;    - dataVolumeClaimSpec:&#xD;&#xA;        accessModes:&#xD;&#xA;        - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;        resources:&#xD;&#xA;          requests:&#xD;&#xA;            storage: 1Gi&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.49-0&#xD;&#xA;      repos:&#xD;&#xA;      - name: repo1&#xD;&#xA;        volume:&#xD;&#xA;          volumeClaimSpec:&#xD;&#xA;            accessModes:&#xD;&#xA;            - &amp;quot;ReadWriteOnce&amp;quot;&#xD;&#xA;            resources:&#xD;&#xA;              requests:&#xD;&#xA;                storage: 1Gi&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;La partie qui nous intÃ©resse ici est la partie spec, ou nous avons rajouter un type de restauration (ici time) et une heure target. Cela indique Ã  pgbackrest quâ€™il doit aller chercher tous les fichiers de sauvegarde et WAL sur notre point de sauvegarde repo1 venant de lâ€™instance pgcluster1 pour les rÃ©appliquer sur notre nouveau cluster pgcluster2.&lt;br /&gt;&#xA;Vous pouvez Ã©galement vouloir rÃ©aliser une restauration In Place, câ€™est-Ã -dire Ã©craser lâ€™instance prÃ©sente pour la remplacer par la restauration. Auquel cas, plutÃ´t que de prÃ©ciser comment sâ€™appellera notre nouveau cluster, il faut alors passer par la balise restore :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;  backups:&#xD;&#xA;    pgbackrest:&#xD;&#xA;      restore:&#xD;&#xA;        enabled: true&#xD;&#xA;        repoName: repo1&#xD;&#xA;        options:&#xD;&#xA;        - --type=time&#xD;&#xA;        - --target=&amp;quot;2024-04-09 20:30:00-00&amp;quot;&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici, comme prÃ©cÃ©demment, nous restaurons Ã  lâ€™heure de 20 :30 hier soir, et cela sur notre propre instance. Ne reste plus quâ€™Ã  lancer la restauration :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;kubectl annotate -n postgres-operator postgrescluster pgcluster1 --overwrite \ postgres-operator.crunchydata.com/pgbackrest-restore=&amp;quot;$(date)&amp;quot;&lt;/pre&gt;&#xA;&lt;p&gt;A noter quâ€™il ne faut pas oublier de dÃ©sactiver ensuite le restore en le passant Ã  false si vous ne souhaitez pas quâ€™il soit de nouveau Ã©crasÃ© au prochain changement de configuration.&lt;/p&gt;&#xA;&lt;h5&gt;10) Restaurer une base de donnÃ©es spÃ©cifique :&lt;/h5&gt;&#xA;&lt;p&gt;Si votre besoin est de restaurer une base de donnÃ©es spÃ©cifique plutÃ´t que lâ€™intÃ©gralitÃ© de lâ€™instance, vous pouvez le prÃ©ciser dans les paramÃ¨tres de votre restauration.&lt;br /&gt;&#xA;Attention cependant, ce nâ€™est pas une restauration comme le serais un pg_dump. Ici si vous restaurez simplement une seule base de donnÃ©es et pas le reste du cluster, les autres bases que vous nâ€™avez pas choisit de restaurer deviendront inaccessibles.&lt;br /&gt;&#xA;Si nous voulons restaurer une base de donnÃ©es, et uniquement elle, voici la procÃ©dure :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;spec:&#xD;&#xA;backups:&#xD;&#xA;  pgbackrest:&#xD;&#xA;    restore:&#xD;&#xA;      enabled: true&#xD;&#xA;      repoName: repo1&#xD;&#xA;      options:&#xD;&#xA;        - --db-include=capdata&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Ici, on ne restaurera que la base de donnÃ©es capdata, et aucunes autres bases Ã  partir de notre repo1.&lt;/p&gt;&#xA;&lt;h3&gt;PgBouncer :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;PgBouncer est un pooler de connexion pour PostgreSQL. Un pooler de connexion permet de maintenir ouvertes des sessions entre lui-mÃªme et le serveur, ce qui rend plus rapide l&amp;#8217;ouverture de sessions depuis les clients, une application Web par exemple.&lt;br /&gt;&#xA;PgBouncer permet aussi de mutualiser les sessions dans le serveur, Ã©conomisant ainsi des ressources. PgBouncer propose plusieurs modes de partage : par requÃªte (default), par transaction ou par session.&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour ajouter un bouncer Ã  notre configuration câ€™est une rÃ©alitÃ© trÃ¨s simple. Il suffit dâ€™ajouter dans notre fichier postgres.yaml la rubrique proxy :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;proxy:&#xD;&#xA;  pgBouncer:&#xD;&#xA;    image: registry.developers.crunchydata.com/crunchydata/crunchy-pgbouncer:ubi8-1.21-3&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois que vous avez rajoutÃ© cela dans la configuration, il nâ€™y a plus quâ€™Ã  appliquer celle-ci :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt; kubectl apply -k kustomize/keycloak &lt;/pre&gt;&#xA;&lt;p&gt;Quand PGO crÃ©Ã© un nouveau connexion pooler sur notre instance dÃ©ployÃ©e, il modifier le fichier secrets de lâ€™utilisateur.&lt;br /&gt;&#xA;On voit que plusieurs champs qui concerne pg_bouncer sont apparus. Ils constituent les informations qui vont vous permettre de vous connecter sur votre bouncer nouvellement crÃ©Ã© :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;{&#xD;&#xA;    &amp;quot;apiVersion&amp;quot;: &amp;quot;v1&amp;quot;,&#xD;&#xA;    &amp;quot;data&amp;quot;: {&#xD;&#xA;        &amp;quot;dbname&amp;quot;: &amp;quot;cGdjbHVzdGVyMQ==&amp;quot;,&#xD;&#xA;        &amp;quot;host&amp;quot;: &amp;quot;cGdjbHVzdGVyMS1wcmltYXJ5LnBvc3RncmVzLW9wZXJhdG9yLnN2Yw==&amp;quot;,&#xD;&#xA;        &amp;quot;jdbc-uri&amp;quot;: &amp;quot;amRiYzpwb3N0Z3Jlc3FsOi8vcGdjbHVzdGVyMS1wcmltYXJ5LnBvc3RncmVzLW9wZXJhdG9yLnN2Yzo1NDMyL3BnY2x1c3RlcjE/cGFzc3dvcmQ9NXNSaSUzRCU1QmZZbSUzQ2lSSGslMkElNUIlM0VuWGhqaiU3Q1EmdXNlcj1wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;password&amp;quot;: &amp;quot;NXNSaT1bZlltPGlSSGsqWz5uWGhqanxR&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-host&amp;quot;: &amp;quot;cGdjbHVzdGVyMS1wZ2JvdW5jZXIucG9zdGdyZXMtb3BlcmF0b3Iuc3Zj&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-jdbc-uri&amp;quot;: &amp;quot;amRiYzpwb3N0Z3Jlc3FsOi8vcGdjbHVzdGVyMS1wZ2JvdW5jZXIucG9zdGdyZXMtb3BlcmF0b3Iuc3ZjOjU0MzIvcGdjbHVzdGVyMT9wYXNzd29yZD01c1JpJTNEJTVCZlltJTNDaVJIayUyQSU1QiUzRW5YaGpqJTdDUSZwcmVwYXJlVGhyZXNob2xkPTAmdXNlcj1wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-port&amp;quot;: &amp;quot;NTQzMg==&amp;quot;,&#xD;&#xA;        &amp;quot;pgbouncer-uri&amp;quot;: &amp;quot;cG9zdGdyZXNxbDovL3BnY2x1c3RlcjE6NXNSaT0lNUJmWW0lM0NpUkhrJTJBJTVCJTNFblhoamolN0NRQHBnY2x1c3RlcjEtcGdib3VuY2VyLnBvc3RncmVzLW9wZXJhdG9yLnN2Yzo1NDMyL3BnY2x1c3RlcjE=&amp;quot;,&#xD;&#xA;        &amp;quot;port&amp;quot;: &amp;quot;NTQzMg==&amp;quot;,&#xD;&#xA;        &amp;quot;uri&amp;quot;: &amp;quot;cG9zdGdyZXNxbDovL3BnY2x1c3RlcjE6NXNSaT0lNUJmWW0lM0NpUkhrJTJBJTVCJTNFblhoamolN0NRQHBnY2x1c3RlcjEtcHJpbWFyeS5wb3N0Z3Jlcy1vcGVyYXRvci5zdmM6NTQzMi9wZ2NsdXN0ZXIx&amp;quot;,&#xD;&#xA;        &amp;quot;user&amp;quot;: &amp;quot;cGdjbHVzdGVyMQ==&amp;quot;,&#xD;&#xA;        &amp;quot;verifier&amp;quot;: &amp;quot;U0NSQU0tU0hBLTI1NiQ0MDk2OlgyQ3NQRU1FZjh3QkVlc05McDFJTkE9PSRKcDhKakl5Q0o1ZEpFRVhia1ptUERTNE5rR3d0V00rczdrMElsQmx0YkpvPTpEaHg3VzNCOE5vNDRYSHJ1Qm1RdENMQW9jNEtnSUZQa2dIeStUMkVWUUowPQ==&amp;quot;&#xD;&#xA;    },&#xD;&#xA;    &amp;quot;kind&amp;quot;: &amp;quot;Secret&amp;quot;,&#xD;&#xA;    &amp;quot;metadata&amp;quot;: {&#xD;&#xA;        &amp;quot;creationTimestamp&amp;quot;: &amp;quot;2024-04-09T16:37:36Z&amp;quot;,&#xD;&#xA;        &amp;quot;labels&amp;quot;: {&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/cluster&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/pguser&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;            &amp;quot;postgres-operator.crunchydata.com/role&amp;quot;: &amp;quot;pguser&amp;quot;&#xD;&#xA;        },&#xD;&#xA;        &amp;quot;name&amp;quot;: &amp;quot;pgcluster1-pguser-pgcluster1&amp;quot;,&#xD;&#xA;        &amp;quot;namespace&amp;quot;: &amp;quot;postgres-operator&amp;quot;,&#xD;&#xA;        &amp;quot;ownerReferences&amp;quot;: [&#xD;&#xA;            {&#xD;&#xA;                &amp;quot;apiVersion&amp;quot;: &amp;quot;postgres-operator.crunchydata.com/v1beta1&amp;quot;,&#xD;&#xA;                &amp;quot;blockOwnerDeletion&amp;quot;: true,&#xD;&#xA;                &amp;quot;controller&amp;quot;: true,&#xD;&#xA;                &amp;quot;kind&amp;quot;: &amp;quot;PostgresCluster&amp;quot;,&#xD;&#xA;                &amp;quot;name&amp;quot;: &amp;quot;pgcluster1&amp;quot;,&#xD;&#xA;                &amp;quot;uid&amp;quot;: &amp;quot;7260b882-116f-4b02-b51a-18d4fe3a8038&amp;quot;&#xD;&#xA;            }&#xD;&#xA;        ],&#xD;&#xA;        &amp;quot;resourceVersion&amp;quot;: &amp;quot;9495&amp;quot;,&#xD;&#xA;        &amp;quot;uid&amp;quot;: &amp;quot;1fbdf1d2-48ea-4a45-b7d6-01248317dbee&amp;quot;&#xD;&#xA;    },&#xD;&#xA;    &amp;quot;type&amp;quot;: &amp;quot;Opaque&amp;quot;&#xD;&#xA;}&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Pour se connecter Ã  notre pgbouncer, il suffit dâ€™utiliser les informations fournies par le fichier de secret Ã  la place de nos infos de connexion habituelles, et cela nous permet dâ€™accÃ©der directement au bouncer et non plus Ã  lâ€™instance elle-mÃªme.&lt;/p&gt;&#xA;&lt;p&gt;Cette connexion peut Ãªtre facilement modifiÃ©e en utilisant la documentation de pgbouncer afin de pouvoir configurer Ã  notre guise notre pgbouncer. Un exemple de configuration quâ€™on pourrais rencontrer serait :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;  proxy:&#xD;&#xA;    pgBouncer:&#xD;&#xA;      image: {{.Values.image.pgBouncer }}&#xD;&#xA;      config:&#xD;&#xA;        global:&#xD;&#xA;          default_pool_size: &amp;quot;100&amp;quot;&#xD;&#xA;          max_client_conn: &amp;quot;10000&amp;quot;&#xD;&#xA;          pool_mode: transaction&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Pour cet exemple on voit quâ€™on a dÃ©finit un nombre de client maximum, la taille du pool Ã  100 et un mode transaction pour notre pool.&lt;/p&gt;&#xA;&lt;h3&gt;PGO et Prometheus&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;Prometheus est une trousse Ã  outils de surveillance et d&amp;#8217;alerte des systÃ¨mes en open source.&lt;br /&gt;&#xA;Prometheus collecte et stocke ses mÃ©triques sous forme de donnÃ©es de sÃ©ries temporelles, c&amp;#8217;est-Ã -dire que les informations de mÃ©triques sont stockÃ©es avec le timestamp auquel elles ont Ã©tÃ© enregistrÃ©es, aux cÃ´tÃ©s de paires clÃ©-valeur optionnelles appelÃ©es labels.&lt;br /&gt;&#xA;&amp;#8211; Un modÃ¨le de donnÃ©es multidimensionnel avec des donnÃ©es de sÃ©ries temporelles identifiÃ©es par le nom de la mÃ©trique et des paires clÃ©-valeur&lt;br /&gt;&#xA;&amp;#8211; PromQL, un langage de requÃªte flexible pour exploiter cette dimensionnalitÃ©&lt;br /&gt;&#xA;&amp;#8211; Aucune dÃ©pendance sur le stockage distribuÃ© ; les nÅ“uds de serveur individuels sont autonomes&lt;br /&gt;&#xA;&amp;#8211; La collecte de sÃ©ries temporelles se fait via un modÃ¨le de tirage sur HTTP&lt;br /&gt;&#xA;&amp;#8211; La poussÃ©e de sÃ©ries temporelles est prise en charge via une passerelle intermÃ©diaire&lt;br /&gt;&#xA;&amp;#8211; Les cibles sont dÃ©couvertes via la dÃ©couverte de service ou la configuration statique&lt;br /&gt;&#xA;&amp;#8211; Prise en charge de plusieurs modes de graphiques et de tableaux de bord&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir mettre en place une surveillance pour notre cluster, il est plus simple de tÃ©lÃ©charger et complÃ©ter le modÃ¨le fournit dans les exemples de pgo.&lt;br /&gt;&#xA;Ainsi, on peut rÃ©cupÃ©rer les exemples Ã  lâ€™aide de git :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;YOUR_GITHUB_UN=&amp;quot;$YOUR_GITHUB_USERNAME&amp;quot;&#xD;&#xA;git clone --depth 1 &amp;quot;git@github.com:${YOUR_GITHUB_UN}/postgres-operator-examples.git&amp;quot;&#xD;&#xA;cd postgres-operator-examples&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Les diffÃ©rentes configurations se trouvent dans le dossier kustomize/monitoring.&lt;br /&gt;&#xA;Pour activer le monitoring de notre instance, il faut ajouter la balise monitoring Ã  notre fichier postgres.yaml :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: yaml; title: ; notranslate&#34;&gt;&#xD;&#xA;monitoring:&#xD;&#xA;  pgmonitor:&#xD;&#xA;    exporter:&#xD;&#xA;      image: registry.developers.crunchydata.com/crunchydata/crunchy-postgres-exporter:ubi8-5.5.1-0&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Une fois notre configuration modifiÃ©e, on lâ€™applique afin que PGO dÃ©tecte les changements et configure tout seul lâ€™exporter pour quâ€™il puisse se connecter Ã  nos bases de donnÃ©es et rÃ©cupÃ©rer les mÃ©triques.&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;kubectl apply -k kustomize/postgres&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Il faut ensuite appliquer la configuration de base de pgmonitor pour quâ€™il crÃ©Ã© lui-mÃªme les fichiers de configuration pour prometheus (il le fera en mÃªme temps pour Grafana et Alertmanager qui sont deux autres outils de surveillance). Pour cela on applique le kustomize prÃ©sent dans le dossier monitoring :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;$kubectl apply -k kustomize\postgres&#xD;&#xA;postgrescluster.postgres-operator.crunchydata.com/pgcluster1 configured&#xD;&#xA;$kubectl apply -k kustomize\monitoring&#xD;&#xA;serviceaccount/alertmanager created&#xD;&#xA;serviceaccount/grafana created&#xD;&#xA;serviceaccount/prometheus created&#xD;&#xA;clusterrole.rbac.authorization.k8s.io/prometheus created&#xD;&#xA;clusterrolebinding.rbac.authorization.k8s.io/prometheus created&#xD;&#xA;configmap/alert-rules-config created&#xD;&#xA;configmap/alertmanager-config created&#xD;&#xA;configmap/crunchy-prometheus created&#xD;&#xA;configmap/grafana-dashboards created&#xD;&#xA;configmap/grafana-datasources created&#xD;&#xA;secret/grafana-admin created&#xD;&#xA;service/crunchy-alertmanager created&#xD;&#xA;service/crunchy-grafana created&#xD;&#xA;service/crunchy-prometheus created&#xD;&#xA;persistentvolumeclaim/alertmanagerdata created&#xD;&#xA;persistentvolumeclaim/grafanadata created&#xD;&#xA;persistentvolumeclaim/prometheusdata created&#xD;&#xA;deployment.apps/crunchy-alertmanager created&#xD;&#xA;deployment.apps/crunchy-grafana created&#xD;&#xA;deployment.apps/crunchy-prometheus created&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Nos services ont Ã©tÃ© correctement dÃ©ployÃ©s, il ne nous reste plus quâ€™Ã  utiliser celui qui nous intÃ©resse, ici service/crunchy-prometheus et lui indiquer de commencer Ã  envoyer les informations sur notre prometheus :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;$kubectl -n postgres-operator port-forward service/crunchy-prometheus 9090:9090&#xD;&#xA;Forwarding from 127.0.0.1:9090 -&amp;gt; 9090&#xD;&#xA;Forwarding from [::1]:9090 -&amp;gt; 9090&#xD;&#xA;Handling connection for 9090&#xD;&#xA;Handling connection for 9090&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Afin dâ€™accÃ©der Ã  notre service prometheus, il ne nous reste plus quâ€™Ã  se connecter avec lâ€™adresse de notre machine, sur le port 9090 prÃ©alablement ouvert, pour voir apparaitre le dashboard de prometheus :&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2.jpg&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-medium wp-image-10567&#34; src=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-300x66.jpg&#34; alt=&#34;&#34; width=&#34;300&#34; height=&#34;66&#34; srcset=&#34;https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-300x66.jpg 300w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-1024x226.jpg 1024w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2-768x170.jpg 768w, https://blog.capdata.fr/wp-content/uploads/2024/05/Image2.jpg 1386w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3&gt;PGO Client :&lt;/h3&gt;&#xA;&lt;h4&gt;UtilitÃ© :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir gÃ©rer plus facilement le cluster crÃ©Ã© par PGO, CrunchyData Ã  dÃ©veloppÃ© une surcouche Ã  kubectl qui permet de faciliter les commandes que nous pouvons rÃ©aliser sur le cluster.&lt;br /&gt;&#xA;Cela permet de ne pas avoir Ã  taper les longues lignes de commandes qui permettent par exemple de dÃ©marrer les sauvegardes unitaires.&lt;/p&gt;&#xA;&lt;h4&gt;Mise en place :&lt;/h4&gt;&#xA;&lt;p&gt;Pour pouvoir installer cette surcouche, il faut tÃ©lÃ©charger la version qui correspond au systÃ¨me dâ€™exploitation Ã  partir du GIT de pgo client :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;# wget https://github.com/CrunchyData/postgres-operator-client/releases/download/v0.4.1/kubectl-pgo-linux-arm64&#xD;&#xA;--2024-04-11 12:07:45--  https://github.com/CrunchyData/postgres-operator-client/releases/download/v0.4.1/kubectl-pgo-linux-arm64&#xD;&#xA;Resolving github.com (github.com)... 140.82.121.4&#xD;&#xA;Connecting to github.com (github.com)|140.82.121.4|:443... connected.&#xD;&#xA;HTTP request sent, awaiting response... 302 Found&#xD;&#xA;Resolving objects.githubusercontent.com (objects.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.110.133, ...&#xD;&#xA;Connecting to objects.githubusercontent.com (objects.githubusercontent.com)|185.199.109.133|:443... connected.&#xD;&#xA;HTTP request sent, awaiting response... 200 OK&#xD;&#xA;Length: 47895849 (46M) [application/octet-stream]&#xD;&#xA;Saving to: â€˜kubectl-pgo-linux-arm64â€™&#xD;&#xA;&#xD;&#xA;kubectl-pgo-linux-arm64                                     100%[========================================================================================================================================&amp;gt;]  45.68M  --.-KB/s    in 0.1s&#xD;&#xA;&#xD;&#xA;2024-04-11 12:07:45 (373 MB/s) - â€˜kubectl-pgo-linux-arm64â€™ saved [47895849/47895849]&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;On renome le fichier tÃ©lÃ©chargÃ© en kubectl-pgo et on le dÃ©place dans nos bin pour pouvoir les utiliser :&lt;/p&gt;&#xA;&lt;pre class=&#34;brush: bash; title: ; notranslate&#34;&gt;&#xD;&#xA;# mv kubectl-pgo-linux-arm64 kubectl-pgo&#xD;&#xA;# sudo mv kubectl-pgo /usr/local/bin/kubectl-pgo&#xD;&#xA;# sudo chmod +x /usr/local/bin/kubectl-pgo&#xD;&#xA;Une fois que ces actions sont rÃ©alisÃ©es, on peut tester le fonctionnement :&#xD;&#xA;# kubectl pgo version&#xD;&#xA;Client Version: v0.4.1&#xD;&#xA;Operator Version: v5.5.1&#xD;&#xA;&lt;/pre&gt;&#xA;&lt;p&gt;Les commandes disponibles avec cette extension sont les suivantes :&lt;br /&gt;&#xA;&amp;#8211; backup : Backup cluster&lt;br /&gt;&#xA;&amp;#8211; create : Create a resource&lt;br /&gt;&#xA;&amp;#8211; delete : Delete a resource&lt;br /&gt;&#xA;&amp;#8211; help : Help about any command&lt;br /&gt;&#xA;&amp;#8211; restore : Restore cluster&lt;br /&gt;&#xA;&amp;#8211; show Show : PostgresCluster details&lt;br /&gt;&#xA;&amp;#8211; start : Start cluster&lt;br /&gt;&#xA;&amp;#8211; stop : Stop cluster&lt;br /&gt;&#xA;&amp;#8211; support : Crunchy Support commands for PGO&lt;br /&gt;&#xA;&amp;#8211; version : PGO client&lt;strong&gt;Continuez votre lecture sur le blog :&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul class=&#34;similar-posts&#34;&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/pgo-operateurs-kubernetes-pour-postgresql-la-suite/&#34; rel=&#34;bookmark&#34; title=&#34;6 juin 2023&#34;&gt;PGO : opÃ©rateurs kubernetes pour PostgreSQL, la suite !&lt;/a&gt; (David Baffaleuf) [ContainerDevopsPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/kubegres-loperateur-kubernetes-cle-en-main-pour-postgresql/&#34; rel=&#34;bookmark&#34; title=&#34;26 avril 2023&#34;&gt;Kubegres : l&amp;#8217;opÃ©rateur Kubernetes clÃ© en main pour PostgreSQL&lt;/a&gt; (David Baffaleuf) [ContainerDevopsPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-sur-la-solution-kubernetes-locale-minikube/&#34; rel=&#34;bookmark&#34; title=&#34;29 mars 2023&#34;&gt;PostgreSQL sur la solution Kubernetes locale Minikube&lt;/a&gt; (Emmanuel RAMI) [ContainerPostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/postgresql-comparatif-entre-barman-et-pgbackrest/&#34; rel=&#34;bookmark&#34; title=&#34;4 fÃ©vrier 2020&#34;&gt;PostgreSQL : Comparatif entre Barman et pgBackRest&lt;/a&gt; (Capdata team) [PostgreSQL]&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.capdata.fr/index.php/sauvegardes-sql-server-dans-un-azure-blob-storage/&#34; rel=&#34;bookmark&#34; title=&#34;21 aoÃ»t 2018&#34;&gt;Sauvegardes SQL Server dans un Azure Blob Storage&lt;/a&gt; (Capdata team) [AzureSQL Server]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;!-- Similar Posts took 4.386 ms --&gt;&lt;/p&gt;&#xA;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-twitter nolightbox&#34; data-provider=&#34;twitter&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Twitter&#34; href=&#34;https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;text=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;twitter&#34; title=&#34;Share on Twitter&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/twitter.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-linkedin nolightbox&#34; data-provider=&#34;linkedin&#34; target=&#34;_blank&#34; rel=&#34;nofollow&#34; title=&#34;Share on Linkedin&#34; href=&#34;https://www.linkedin.com/shareArticle?mini=true&amp;#038;url=https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&amp;#038;title=PGO%20%3A%20la%20suite&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px;margin-right:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;linkedin&#34; title=&#34;Share on Linkedin&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/linkedin.png&#34; /&gt;&lt;/a&gt;&lt;a class=&#34;synved-social-button synved-social-button-share synved-social-size-24 synved-social-resolution-single synved-social-provider-mail nolightbox&#34; data-provider=&#34;mail&#34; rel=&#34;nofollow&#34; title=&#34;Share by email&#34; href=&#34;mailto:?subject=PGO%20%3A%20la%20suite&amp;#038;body=Article%20sur%20le%20blog%20de%20la%20Capdata%20Tech%20Team%20%3A%20:%20https%3A%2F%2Fblog.capdata.fr%2F%3Fp%3D10562&#34; style=&#34;font-size: 0px;width:24px;height:24px;margin:0;margin-bottom:5px&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; alt=&#34;mail&#34; title=&#34;Share by email&#34; class=&#34;synved-share-image synved-social-image synved-social-image-share&#34; width=&#34;24&#34; height=&#34;24&#34; style=&#34;display: inline;width:24px;height:24px;margin: 0;padding: 0;border: none;box-shadow: none&#34; src=&#34;https://blog.capdata.fr/wp-content/plugins/social-media-feather/synved-social/image/social/regular/48x48/mail.png&#34; /&gt;&lt;/a&gt;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34;&gt;PGO : la suite&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.capdata.fr/index.php/pgo-la-suite/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;La gestion efficace des clusters PostgreSQL dans un environnement Kubernetes est un dÃ©fi complexe auquel sont confrontÃ©es de nombreuses entreprises aujourd&amp;#8217;hui. PGO offre une solution dÃ©clarative qui automatise la gestion des clusters PostgreSQL, simplifiant ainsi le dÃ©ploiement, la mise Ã &amp;#8230; &lt;a href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34; class=&#34;more-link&#34;&gt;Continuer la lecture &lt;span class=&#34;meta-nav&#34;&gt;&amp;#8594;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Lâ€™article &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr/index.php/pgo-la-suite/&#34;&gt;PGO : la suite&lt;/a&gt; est apparu en premier sur &lt;a rel=&#34;nofollow&#34; href=&#34;https://blog.capdata.fr&#34;&gt;Capdata TECH BLOG&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Sarah FAVEERE</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #121</title>
    <updated>2025-05-13T14:47:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-05-13:/blog/index.php/post/2025/04/13/PostgreSQL-Hebdo-121</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/04/13/PostgreSQL-Hebdo-121" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://kmoppel.github.io/2025-04-10-postgres-scaling-roadmap/&#34;&gt;A roadmap to scaling Postgres&lt;/a&gt;Â : Une liste complÃ¨te de concepts Ã  utiliser pour assurer une montÃ©e en charge de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://r.ena.to/blog/optimizing-postgres-table-layout-for-maximum-efficiency/&#34;&gt;Optimizing Postgres table layout for maximum efficiency&lt;/a&gt;Â : Une explication simple et claire Ã  propos de l&#39;alignement des types de donnÃ©esÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://tselai.com/all-databases-are-just-files&#34;&gt;(All) Databases Are Just Files. Postgres Too&lt;/a&gt;Â ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://cedardb.com/blog/postgres_compatibility/&#34;&gt;What It Takes to Be PostgreSQL Compatible&lt;/a&gt;Â : de nombreaux produits adoptent une compatibilitÃ© avec PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.danslimmon.com/2025/03/14/did-u-ever-read-so-hard-u-accidentally-wrote/&#34;&gt;did u ever read so hard u accidentally wrote?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-175-169-1513-1418-and-1321-released-3072/&#34;&gt;PostgreSQL 17.5, 16.9, 15.13, 14.18, and 13.21 Released!&lt;/a&gt;Â et en franÃ§ais &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-5/&#34;&gt;PostgreSQL 17.5 et autres correctifs&lt;/a&gt;Â Â : Ã  noter la fin de vie de PostgreSQL 13 en novembreÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&#xA;&lt;p&gt;Ã€Â venir dans PostgreSQL 18Â :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2025/05/05/waiting-for-postgresql-18-add-function-to-get-memory-context-stats-for-processes/&#34;&gt;Add function to get memory context stats for processes&lt;/a&gt;Â : interessant de pouvoir suivre l&#39;Ã©tat d&#39;un processus, cela dÃ©voile beaucoup d&#39;informations utileÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-18-beta-1-released-3070/&#34;&gt;PostgreSQL 18 Beta 1 Released!&lt;/a&gt; et en franÃ§ais &lt;a href=&#34;https://www.loxodata.com/post/postgresql-18-beta1/&#34;&gt;PostgreSQL 18 bÃªta 1&lt;/a&gt;Â : Ã  vos tests !&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #120</title>
    <updated>2025-02-21T15:20:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-02-21:/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/02/21/PostgreSQL-Hebdo-120" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.octo.com/7-things-a-developer-should-know-about-databases&#34;&gt;7 things a developer should know about databases&lt;/a&gt;Â : de prÃ©cieux conseils, Ã  lire attentivement et Ã  faire circuler auprÃ¨s de vos Ã©quipes !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://blog.dalibo.com//2025/02/10/patchs_parallelisations_2.html&#34;&gt;La suite des patchs sur la parallÃ©lisation &lt;/a&gt;Â : Au-delÃ  du fond, qui est intÃ©ressant, câ€™est le point de vue sur le dÃ©veloppement de PostgreSQLÂ est mis en Ã©vidence, et cela permet de mieux comprendre cet aspect de la communautÃ© PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.loxodata.com/post/pgwatch3/&#34;&gt;pgwatch3&lt;/a&gt; : quelques explications sur la nouvelle version de l&#39;outil de supervision pgwatchÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.twilio.com/en-us/blog/sqlite-postgresql-complicated&#34;&gt;SQLite or PostgreSQL? It&#39;s Complicated!&lt;/a&gt; : comparatif de performances sur de vraies donnÃ©es !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/&#34;&gt;PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!&lt;/a&gt; et &lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-173-167-1511-1416-and-1319-released-3015/&#34;&gt;PostgreSQL 17.3, 16.7, 15.11, 14.16, and 13.19 Released!&lt;/a&gt; : mettez Ã  jour !&#xA;&lt;ul&gt;&#xA;&lt;li&gt;en franÃ§ais : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-4/&#34;&gt;PostgreSQL 17.4 et autres correctifs&lt;/a&gt; et  &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-3/&#34;&gt;PostgreSQL 17.3 et autres correctifs&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/end-of-the-road-for-postgresql-streaming-replication/&#34;&gt;End of the road for PostgreSQL streaming replication?&lt;/a&gt; : pourquoi il est difficile de parallÃ©liser le rejeu de la rÃ©plication dans une instance StandbyÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/enhanced-postgres-release-notes&#34;&gt;Enhanced Postgres Release Notes&lt;/a&gt; : trÃ¨s bonne idÃ©e, et gros travail : on trouve maintenant un lien vers le commit pour chacune des entrÃ©es des notes de publicationÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #119</title>
    <updated>2025-01-31T16:16:00Z</updated>
    <id>tag:sebastien.lardiere.net,2025-01-31:/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2025/01/31/PostgreSQL-Hebdo-119" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semaines :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2024/12/01/sql-best-practices-dont-compare-count-with-0/&#34;&gt;SQL best practices â€“ donâ€™t compare count(*) with 0&lt;/a&gt; : il n&#39;est pas utile de compter quelque chose alors qu&#39;on juste savoir s&#39;il existe ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://raymondtukpe.com/sql-nulls-are-weird.html&#34;&gt;SQL NULLs are Weird!&lt;/a&gt;Â : maÃ®triser cet aspect du SQL n&#39;est pas si Ã©vident, et pourtant fondamentalÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://notso.boringsql.com/posts/deletes-are-difficult/&#34;&gt;DELETEs are difficult&lt;/a&gt;: tout savoir sur l&#39;opÃ©ration DELETE ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.pgedge.com/blog/understanding-and-reducing-postgresql-replication-lag&#34;&gt;Understanding and Reducing PostgreSQL Replication Lag&lt;/a&gt; : le retard de rÃ©plication peut avoir de nombreux impacts, le mesurer et le maitriser est important ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://thebuild.com/blog/2025/01/28/vacuum-index_cleanup-off-considered-harmful/&#34;&gt;VACUUM (INDEX_CLEANUP OFF) Considered Harmful&lt;/a&gt; : attention aux options de commandes qui pourraient paraÃ®tre intÃ©ressantes au premier abordÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.binwang.me/2024-12-02-PostgreSQL-High-Availability-Solutions-Part-1.html&#34;&gt;Jepsen Test on Patroni: A PostgreSQL High Availability Solution&lt;/a&gt;Â : test trÃ¨s complet de PatroniÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rodoq.medium.com/are-all-your-update-useful-6b8d548085bf&#34;&gt;Are all your UPDATE useful ?&lt;/a&gt;Â : Vos UPDATE sont-ils toujours utiles ?&lt;/li&gt;&#xA;&lt;li&gt;Le projet PostgreSQL Ecosystem est maintenant public : &lt;a href=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34; title=&#34;https://www.loxodata.com/post/pg-ecosystem/&#34;&gt;https://www.loxodata.com/post/pg-ec...&lt;/a&gt; et &lt;a href=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34; title=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34;&gt;https://pg-ecosystem.gitlab.io/pg-e...&lt;/a&gt;Â ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #118</title>
    <updated>2024-11-22T16:09:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-11-22:/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/11/22/PostgreSQL-Hebdo-118" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgversions.com/&#34; title=&#34;https://pgversions.com/&#34;&gt;https://pgversions.com/&lt;/a&gt;Â : outil permettant de connaitre les diffÃ©rences entre une version mineure et l&#39;Ã©tat actuel de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://pgpedia.info/blog/index.html&#34; title=&#34;https://pgpedia.info/blog/index.html&#34;&gt;https://pgpedia.info/blog/index.htm...&lt;/a&gt;Â : blog rÃ©sumant l&#39;activitÃ© de dÃ©veloppement de PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rhaas.blogspot.com/2024/11/why-pgdump-is-amazing.html&#34;&gt;Why pg_dump Is Amazing&lt;/a&gt;Â : oui, pg_dump est un bon outil, trÃ¨s utile, qu&#39;il faut maitriserÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://databaserookies.wordpress.com/2024/11/02/plpgsql-how-conditional-expressions-are-evaluated/&#34;&gt;PL/pgSQL Secrets: How Conditional Expressions Are Parsed and Evaluated Under the Hood.&lt;/a&gt;Â : ou on comprend qu&#39;un IF est en fait un SELECTÂ ;&lt;/li&gt;&#xA;&lt;li&gt;Publication de PostgreSQL 17.2Â : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34; title=&#34;https://www.loxodata.com/post/postgresql-17-2/&#34;&gt;https://www.loxodata.com/post/postg...&lt;/a&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.crunchydata.com/blog/a-change-to-relresultinfo-a-near-miss-with-postgres-17-1&#34;&gt;A change to ResultRelInfo - A Near Miss with Postgres 17.1&lt;/a&gt;Â : retour sur un petit couac&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://challahscript.com/what_i_wish_someone_told_me_about_postgres&#34;&gt;What I Wish Someone Told Me About Postgres&lt;/a&gt;Â : le plein de bonnes idÃ©es Ã  retenirÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://stormatics.tech/blogs/scenarios-that-trigger-autovacuum-in-postgresql&#34;&gt;Scenarios That Trigger Autovacuum in PostgreSQL&lt;/a&gt;Â : article assez complet sur le fonctionnement d&#39;autovacuum.&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #117</title>
    <updated>2024-10-31T16:00:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-10-31:/blog/index.php/post/2024/31/10/PostgreSQL-Hebdo-117</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/31/10/PostgreSQL-Hebdo-117" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://rhaas.blogspot.com/2024/10/is-pgdump-backup-tool.html&#34;&gt;Is pg_dump a Backup Tool?&lt;/a&gt;Â : la sauvegarde, et la restauration des donnÃ©es, et en rÃ©alitÃ© un processus, et non pas juste un problÃ¨me d&#39;outil. pg_dump est un outil qui peut faire partie du processus de sauvegarde/restauration, et Ã§a peut-Ãªtre utile pour BACK UP, c&#39;est-Ã -dire revenir dans un Ã©tat normalÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-17-released-2936/&#34;&gt;PostgreSQL 17 Released!&lt;/a&gt; : Publication de PostgreSQL 17.0 ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.cybertec-postgresql.com/en/whats-so-great-about-postgresql-v17/&#34;&gt;What&#39;s so great about PostgreSQL v17?&lt;/a&gt;Â : aperÃ§u de quelques fonctionnalitÃ©s de PostgreSQL 17Â ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://dev.to/lifen/as-rails-developers-why-we-are-excited-about-postgresql-17-27nj&#34;&gt;As Rails developers, why we are excited about PostgreSQL 17 &lt;/a&gt;Â : PostgreSQL 17 du point de vue d&#39;un dÃ©veloppeur RailsÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://notso.boringsql.com/posts/custom-postgresql-extensions-with-rust/&#34;&gt;Custom PostgreSQL extensions with Rust&lt;/a&gt;Â : comment faire une extension PostgreSQL en RustÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://danolivo.substack.com/p/7456653e-9716-4e91-ad09-83737784c665&#34;&gt;PostgreSQL &#39;VALUES -&amp;gt; ANY&#39; transformation&lt;/a&gt;Â : Ã  propos de l&#39;adaptation du Planner aux requÃªtes des utilisateursÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://amitkapila16.blogspot.com/2024/09/online-upgrading-logical-and-physical.html?m=1&#34;&gt;Online Upgrading Logical and Physical Replication Nodes&lt;/a&gt;Â : Ã  propos de la rÃ©plication logique lors d&#39;une mise Ã  jour majeureÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.depesz.com/2024/10/29/new-way-to-search-postgresql-documentation/&#34;&gt;New way to search PostgreSQL documentation&lt;/a&gt;Â : un prompt simple pour rechercher dans la documentation de PostgreSQL, Ã  mettre dans ses bookmarksÂ ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Hebdo #116</title>
    <updated>2024-09-09T14:06:00Z</updated>
    <id>tag:sebastien.lardiere.net,2024-09-09:/blog/index.php/post/2024/09/09/PostgreSQL-Hebdo-116</id>
    <link href="http://sebastien.lardiere.net/blog/index.php/post/2024/09/09/PostgreSQL-Hebdo-116" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lu ces derniÃ¨res semainesÂ :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://begriffs.com/posts/2018-03-20-user-defined-order.html&#34;&gt;User-defined Order in SQL&lt;/a&gt;Â : Ordonner les informations, c&#39;est souvent adopter un certain point de vue, et cette dÃ©marche fait partie de la modÃ©lisation des donnÃ©esÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://mccue.dev/pages/8-16-24-just-use-postgres&#34;&gt;Just use Postgres&lt;/a&gt;Â : passage en revue des alternatives Ã  PostgreSQLÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/pulse/do-you-still-need-pgbadger-youre-using-grafana-alicja-kucharczyk-cgfmf&#34;&gt;Do you still need pgBadger if youâ€™re using Grafana?&lt;/a&gt;Â : Grafana ne remplace pas complÃ¨tement un rapport pgBadger, dans lequel on trouve de nombreuses informations utiles Ã  la comprÃ©hension du fonctionnement d&#39;une instance PostgreSQL ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.linkedin.com/pulse/not-so-good-idea-pipe-syntax-sql-franck-pachot-dx6he/&#34;&gt;&lt;/a&gt;Â : De la faÃ§on dont le language SQL s&#39;Ã©crit, ou pourquoi on manipule des ensembles et non pas des fluxÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/cybertec-postgresql/pgwatch&#34; title=&#34;https://github.com/cybertec-postgresql/pgwatch&#34;&gt;https://github.com/cybertec-postgre...&lt;/a&gt; la prochaine version de PgWatch poursuit son dÃ©veloppement avec la version 3.0 beta4&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://dataegret.com/2024/08/handling_cancellation_request/&#34;&gt;Handling Cancellation Request&lt;/a&gt;Â : Comment annuler correctement une requÃªte, depuis l&#39;application client, vers un cluster PostgreSQL avec le gestionnaire de connexions PgBouncerÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.shayon.dev/post/2024/225/stop-relying-on-if-not-exists-for-concurrent-index-creation-in-postgresql/&#34;&gt;Stop Relying on IF NOT EXISTS for Concurrent Index Creation in PostgreSQL&lt;/a&gt;Â : Ã  propos d&#39;index invalide et de crÃ©ation conditionelleÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://anyblockers.com/posts/postgres-as-a-search-engine&#34;&gt;Postgres as a search engine&lt;/a&gt;Â : Peut-on utiliser PostgreSQL comme moteur de recherche ?&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://okbob.blogspot.com/2024/09/how-to-get-info-about-relations-between.html?m=1&#34;&gt;How to get info about relations between system tables?&lt;/a&gt;Â : Ã  propos des liens internes du catalogueÂ ;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/news/postgresql-17-rc1-released-2926/&#34;&gt;PostgreSQL 17 RC1 Released!&lt;/a&gt;Â  (et en franÃ§ais : &lt;a href=&#34;https://www.loxodata.com/post/postgresql-17-rc1/&#34; title=&#34;https://www.loxodata.com/post/postgresql-17-rc1/&#34;&gt;https://www.loxodata.com/post/postg...&lt;/a&gt;)Â : la date prÃ©vue pour PostgreSQL 17.0 est le 26 septembreÂ !&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/patroni/patroni/blob/master/docs/releases.rst#version-401&#34;&gt;Patroni 4.0&lt;/a&gt;Â : nouvelle version de l&#39;outil de gestion de la haute disponibilitÃ©, avec quelques ruptures de compatibilitÃ©Â ;&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>SÃ©bastien LardiÃ¨re</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 17.5 et autres correctifs</title>
    <updated>2025-05-13T10:01:00Z</updated>
    <id>tag:www.loxodata.com,2025-05-13:/post/postgresql-17-5/</id>
    <link href="http://www.loxodata.com/post/postgresql-17-5/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le PGDG (PostgreSQL Global Development Group) a publiÃ© une mise Ã  jour&#xA;de toutes les versions supportÃ©es de PostgreSQL, incluant 17.5, 16.9, 15.13, 14.18&#xA;et 13.21.&lt;/p&gt;&#xA;&lt;p&gt;Cette publication corrige Ã©galement une vulnÃ©rabilitÃ© de sÃ©curitÃ© et plus de 60 bogues&#xA;reportÃ©s dans les mois prÃ©cÃ©dents.&lt;/p&gt;&#xA;&lt;h2 id=&#34;fin-du-support-de-la-version-13-de-postgresql&#34;&gt;Fin du support de la version 13 de PostgreSQL&lt;/h2&gt;&#xA;&lt;p&gt;La version 13 de PostgreSQL ne recevra plus de correctifs Ã  partir du 13 novembre 2025. Il est donc recommandÃ© de mettre Ã  jour vers une version majeure vos instances en production.&#xA;Se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;note de versions&lt;/a&gt; pour plus d&amp;rsquo;informations.&lt;/p&gt;&#xA;&lt;h2 id=&#34;problÃ¨mes-de-sÃ©curitÃ©&#34;&gt;ProblÃ¨mes de sÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/CVE-2025-4207/&#34;&gt;CVE-2025-4207&lt;/a&gt; :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;CVSS v3.1 Base Score: 5.9&lt;/li&gt;&#xA;&lt;li&gt;Supported, Vulnerable Versions: 13 - 17.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Lors de lâ€™utilisation de lâ€™encodage GB18030 (encodage officiel chinois), il est possible Ã  un attaquant dâ€™effectuer une lecture au-delÃ  du tampon de validation de cet encodage. Cette lecture provoque un arrÃªt du processus et induit un dÃ©ni de service temporaire. Cette vulnÃ©rabilitÃ© concerne le serveur de bases de donnÃ©es PotgreSQL et la bibliothÃ¨que libpq.&#xA;Les versions antÃ©rieures Ã  PostgreSQL 17.5, 16.9, 15.13, 14.18, et 13.21 sont affectÃ©es.&lt;/p&gt;&#xA;&lt;h2 id=&#34;corrections-de-bogues-et-amÃ©liorations&#34;&gt;Corrections de bogues et amÃ©liorations&lt;/h2&gt;&#xA;&lt;p&gt;Cette mise Ã  jour corrige plus de 60 bogues ayant Ã©tÃ© signalÃ©s durant les mois prÃ©cÃ©dents. Les problÃ¨mes ci-dessous concernent PostgreSQL 17. Certains de ces problÃ¨mes peuvent aussi concerner d&amp;rsquo;autres versions de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Les correctifs sont :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;gestion correcte des clÃ©s Ã©trangÃ¨res autorÃ©fÃ©rentielles sur les tables partitionnÃ©es. La crÃ©ation ou l&amp;rsquo;attachement d&amp;rsquo;une partition ne crÃ©ait pas les entrÃ©es de catalogue requises pour une contrainte de clÃ© Ã©trangÃ¨re si la table rÃ©fÃ©rencÃ©e par la contrainte Ã©tait la mÃªme table partitionnÃ©e. Il en rÃ©sultait que la contrainte pouvait ne pas Ãªtre respectÃ©e. Pour corriger ce problÃ¨me, veuillez consulter les instructions de la section Â« Mise Ã  jour Â» ;&lt;/li&gt;&#xA;&lt;li&gt;correction d&amp;rsquo;un problÃ¨me de perte de donnÃ©es lors de l&amp;rsquo;utilisation d&amp;rsquo;index &lt;code&gt;BRIN bloom&lt;/code&gt; (en utilisant par exemple la classe d&amp;rsquo;opÃ©rateur &lt;code&gt;date_bloom_ops&lt;/code&gt;) ;&lt;/li&gt;&#xA;&lt;li&gt;correction de &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-merge.html&#34;&gt;&lt;code&gt;MERGE&lt;/code&gt;&lt;/a&gt; dans une table partitionnÃ©e avec des actions &lt;code&gt;DO NOTHING&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;prÃ©vention de l&amp;rsquo;Ã©chec des commandes &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-insert.html&#34;&gt;&lt;code&gt;INSERT&lt;/code&gt;&lt;/a&gt; lorsque la table possÃ¨de une colonne &lt;code&gt;GENERATED&lt;/code&gt; d&amp;rsquo;un &lt;a href=&#34;https://www.postgresql.org/docs/current/domains.html&#34;&gt;&lt;code&gt;type de domaine&lt;/code&gt;&lt;/a&gt; et que les contraintes du domaine interdisent les valeurs &lt;code&gt;NULL&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;correction de la commande &lt;a href=&#34;https://www.postgresql.org/docs/current/sql-altertable.html&#34;&gt;&lt;code&gt;ALTER TABLE ... ADD COLUMN&lt;/code&gt;&lt;/a&gt; pour gÃ©rer correctement le cas d&amp;rsquo;un type de domaine qui a sa propre valeur par dÃ©faut et que la valeur &lt;code&gt;DEFAULT&lt;/code&gt; pour la colonne n&amp;rsquo;est pas dÃ©finie.&lt;/li&gt;&#xA;&lt;li&gt;correction de problÃ¨mes lors de conversion de types dans les clÃ©s des expressions de constructeurs &lt;code&gt;JSON&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;correction de &lt;a href=&#34;https://www.postgresql.org/docs/current/datatype-xml.html&#34;&gt;&lt;code&gt;XMLSERIALIZE()&lt;/code&gt;&lt;/a&gt; pour que l&amp;rsquo;option &lt;code&gt;INDENT&lt;/code&gt; soit correctement supprimÃ©e lorsqu&amp;rsquo;elle est prÃ©sente dans les vues ou les rÃ¨gles. Ceci Ã©tait perceptible lors de restaurations ;&lt;/li&gt;&#xA;&lt;li&gt;corrections pour le planificateur de requÃªtes, Ã©vitant l&amp;rsquo;Ã©valuation prÃ©maturÃ©e des arguments dans une fonction d&amp;rsquo;agrÃ©gation ayant Ã  la fois des clauses &lt;code&gt;FILTER&lt;/code&gt; et &lt;code&gt;ORDER BY&lt;/code&gt; ou &lt;code&gt;DISTINCT&lt;/code&gt; qui pourraient conduire Ã  des Ã©checs ;&lt;/li&gt;&#xA;&lt;li&gt;correction sur le retour de rÃ©sultats incorrects lors d&amp;rsquo;un &lt;code&gt;bitmap scan&lt;/code&gt; sans colonnes de sortie qui est exÃ©cutÃ© alors que &lt;code&gt;vacuum&lt;/code&gt; est Ã©galement en cours d&amp;rsquo;exÃ©cution sur la mÃªme table ;&lt;/li&gt;&#xA;&lt;li&gt;correction des problÃ¨mes de performance dans le dÃ©marrage de la recherche d&amp;rsquo;index &lt;code&gt;GIN&lt;/code&gt; lorsqu&amp;rsquo;il y a beaucoup de clÃ©s de recherche, par exemple, &lt;code&gt;jsonbcol ?| array[...]&lt;/code&gt; avec des dizaines de milliers d&amp;rsquo;Ã©lÃ©ments dans la liste ;&lt;/li&gt;&#xA;&lt;li&gt;s&amp;rsquo;assurer que les statistiques d&amp;rsquo;E/S des &lt;code&gt;WAL senders&lt;/code&gt; actifs soient rapportÃ©es dans un dÃ©lai maximum d&amp;rsquo;une seconde ;&lt;/li&gt;&#xA;&lt;li&gt;correction d&amp;rsquo;une condition de concurrence dans la gestion de &lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT&#34;&gt;&lt;code&gt;synchronous_standby_names&lt;/code&gt;&lt;/a&gt; immÃ©diatement aprÃ¨s le dÃ©marrage, oÃ¹ un backend pourrait ne pas attendre un commit synchrone ;&lt;/li&gt;&#xA;&lt;li&gt;Ã©viter une boucle infinie si &lt;a href=&#34;https://www.postgresql.org/docs/current/runtime-config-connection.html#GUC-SCRAM-ITERATIONS&#34;&gt;&lt;code&gt;scram_iterations&lt;/code&gt;&lt;/a&gt; est fixÃ© Ã  &lt;code&gt;INT_MAX&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;corrections pour la rÃ©plication logique, y compris la gestion de vacuum autour des lignes supprimÃ©es qui sont toujours nÃ©cessaires pour le dÃ©codage logique ;&lt;/li&gt;&#xA;&lt;li&gt;prÃ©vention des pertes de donnÃ©es potentielles lorsque des opÃ©rations de modification de schÃ©ma (DDL) qui ne prennent pas de verrous forts affectent des tables qui sont rÃ©pliquÃ©es logiquement ;&lt;/li&gt;&#xA;&lt;li&gt;prÃ©venir les problÃ¨mes dans la rÃ©plication logique qui pourraient permettre l&amp;rsquo;enregistrement de donnÃ©es dupliquÃ©es en raison de la gestion des erreurs du &lt;code&gt;apply worker&lt;/code&gt; ;&lt;/li&gt;&#xA;&lt;li&gt;amÃ©lioration de la maniÃ¨re dont &lt;a href=&#34;https://www.postgresql.org/docs/current/app-reindexdb.html&#34;&gt;&lt;code&gt;reindexdb&lt;/code&gt;&lt;/a&gt; gÃ¨re la planification des opÃ©rations de rÃ©indexation parallÃ¨le afin d&amp;rsquo;obtenir le niveau de parallÃ©lisme attendu ;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cette version met Ã©galement Ã  jour les fichiers de donnÃ©es de fuseaux horaires avec la version 2025b de &lt;code&gt;tzdata&lt;/code&gt; pour les changements de loi de l&amp;rsquo;heure d&amp;rsquo;Ã©tÃ© au Chili, ainsi que des corrections historiques pour l&amp;rsquo;Iran. En outre, un nouveau fuseau horaire &lt;code&gt;America/Coyhaique&lt;/code&gt; a Ã©tÃ© crÃ©Ã© pour la rÃ©gion d&amp;rsquo;AysÃ©n au Chili, afin de tenir compte du fait qu&amp;rsquo;elle passe Ã  UTC-03 tout au long de l&amp;rsquo;annÃ©e, ce qui diverge d&#39;&lt;code&gt;America/Santiago&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;mise-Ã -jour&#34;&gt;Mise Ã  jour&lt;/h2&gt;&#xA;&lt;p&gt;Toutes les publications de mises Ã  jour de PostgreSQL sont&#xA;cumulatives. Comme pour les autres mises Ã  jour mineures, il n&amp;rsquo;est pas&#xA;nÃ©cessaire d&amp;rsquo;extraire et de recharger les bases de donnÃ©es ni&#xA;d&amp;rsquo;utiliser &lt;code&gt;pg_upgrade&lt;/code&gt; pour appliquer cette mise Ã  jourÂ ;&#xA;il suffit simplement d&amp;rsquo;arrÃªter PostgreSQL et de mettre Ã  jour les binaires.&lt;/p&gt;&#xA;&lt;p&gt;Les utilisateurs ayant sautÃ© une ou plusieurs mises Ã  jour peuvent&#xA;avoir besoin d&amp;rsquo;Ã©tapes additionnelles aprÃ¨s la mise Ã  jour.&#xA;Les notes de publication des versions prÃ©cÃ©dentes fournissent les dÃ©tails.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus de dÃ©tails, se rÃ©fÃ©rer Ã  la &lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;note de publication de versions&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;liens&#34;&gt;Liens&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargements&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/release/&#34;&gt;Notes de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/security/&#34;&gt;Page sur la sÃ©curitÃ©&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/support/versioning/&#34;&gt;Politique de version&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Si vous avez des corrections ou suggestions sur cette annonce de publication, merci de les envoyer Ã  la mailing liste publique &lt;a href=&#34;https://www.postgresql.org/list/&#34;&gt;&lt;em&gt;pgsql-www@lists.postgresql.org&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL 18 bÃªta 1</title>
    <updated>2025-05-13T10:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-05-13:/post/postgresql-18-beta1/</id>
    <link href="http://www.loxodata.com/post/postgresql-18-beta1/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cette version 18 de PostgreSQL promet de nombreuses amÃ©liorations de performances avec notamment le sous-systÃ¨me d&amp;rsquo;entrÃ©es/sorties asynchrones pour les lectures, la conservation des statistiques lors d&amp;rsquo;une mise Ã  jour de version&#xA;majeure, l&amp;rsquo;ajout du support de l&amp;rsquo;authentification &lt;code&gt;OAuth 2.0&lt;/code&gt; et la dÃ©prÃ©ciation de &lt;code&gt;md5&lt;/code&gt;, l&amp;rsquo;ajout de nombreuses statistiques par dÃ©faut lors d&amp;rsquo;un &lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt; et d&amp;rsquo;autres fonctionnalitÃ©s encore autour de la rÃ©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Vous pouvez retrouver la &lt;a href=&#34;https://www.postgresql.org/docs/18/index.html&#34;&gt;documentation&lt;/a&gt; pour la version 18 et les &lt;a href=&#34;https://www.postgresql.org/docs/18/release.html&#34;&gt;notes de publications&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgresql-18-bÃªta-1-publiÃ©e&#34;&gt;PostgreSQL 18 BÃªta 1 publiÃ©e&lt;/h1&gt;&#xA;&lt;p&gt;Le PostgreSQL Global Development Group annonce la disponibilitÃ© de la&#xA;premiÃ¨re bÃªta de PostgreSQL 18 en &lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;tÃ©lÃ©chargement&lt;/a&gt;.&#xA;Cette publication contient un aperÃ§u des fonctionnalitÃ©s qui seront disponibles&#xA;dans la version finale de PostgreSQL 18. Des modifications peuvent toutefois&#xA;intervenir d&amp;rsquo;ici lÃ .&lt;/p&gt;&#xA;&lt;p&gt;Vous pouvez trouver des informations sur toutes les fonctionnalitÃ©s et les&#xA;changements de PostgreSQL 18 dans les &lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;notes de version&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Dans l&amp;rsquo;esprit de la communautÃ© open source PostgreSQL, nous vous&#xA;encourageons fortement Ã  tester les nouvelles fonctionnalitÃ©s de&#xA;PostgreSQL dans vos systÃ¨mes de base de donnÃ©es. Ceci afin de nous&#xA;aider Ã  Ã©liminer les bogues et autres problÃ¨mes qui pourraient&#xA;exister. Bien que nous ne vous conseillons pas de faire fonctionner&#xA;PostgreSQL 18 BÃªta 1 dans vos environnements de production, nous vous&#xA;encourageons Ã  trouver des moyens de faire fonctionner votre charge&#xA;applicative typique avec cette publication bÃªta.&lt;/p&gt;&#xA;&lt;p&gt;Vos tests et vos commentaires aideront la communautÃ© Ã  s&amp;rsquo;assurer que&#xA;PostgreSQL 18 respecte nos standards de stabilitÃ© et fiablitÃ©. Vous pouvez Ã©galement vous renseigner sur notre &lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;processus de beta testing&lt;/a&gt; et comment y contribuer.&lt;/p&gt;&#xA;&lt;h2 id=&#34;principales-fonctionnalitÃ©s-de-postgresql-18&#34;&gt;Principales fonctionnalitÃ©s de PostgreSQL 18&lt;/h2&gt;&#xA;&lt;p&gt;Vous trouverez ci-dessous les principales fonctionnalitÃ©s planifiÃ©es pour PostgreSQL 18.&#xA;Cette liste n&amp;rsquo;est pas exhaustive : pour la liste complÃ¨te des fonctionnalitÃ©s, se rÃ©fÃ©rer Ã  la note de publication.&lt;/p&gt;&#xA;&lt;h3 id=&#34;optimisation-des-performances&#34;&gt;Optimisation des performances&lt;/h3&gt;&#xA;&lt;p&gt;PostgreSQL 18 introduit un sous-systÃ¨me d&amp;rsquo;entrÃ©es/sorties asynchrones (AIO). Ce nouveau sous-systÃ¨me permet d&amp;rsquo;augmenter le dÃ©bit des E/S et de masquer leur latence. Sous Linux, &lt;code&gt;io_uring&lt;/code&gt; peut Ãªtre utilisÃ© pour les AIO, une implantation basÃ©e sur un worker est disponible pour toutes les plateformes. Cette version initiale prend en charge les lectures du systÃ¨me de fichiers telles que les lectures sÃ©quentielles, les bitmap heap scan et les vacuum, avec des tests montrant une amÃ©lioration des performances de 2 Ã  3 fois plus rapides.&lt;/p&gt;&#xA;&lt;p&gt;Ces gains de performance s&amp;rsquo;Ã©tendent aux optimisations des requÃªtes et aux nouvelles fonctionnalitÃ©s d&amp;rsquo;indexation. PostgreSQL 18 ajoute le support de l&amp;rsquo;utilisation des recherches &lt;code&gt;skip scan&lt;/code&gt; sur les index multicolonnes B-tree, ce qui peut rÃ©sulter en des temps d&amp;rsquo;exÃ©cution plus rapides pour les requÃªtes qui omettent une condition &lt;code&gt;=&lt;/code&gt; sur un ou plusieurs prÃ©fixe de colonnes de l&amp;rsquo;index. Cette version inclut Ã©galement des optimisations pour les clauses &lt;code&gt;WHERE&lt;/code&gt; qui contiennent des instructions &lt;code&gt;OR&lt;/code&gt; et &lt;code&gt;IN&lt;/code&gt; afin de mieux utiliser les rÃ©centes amÃ©liorations d&amp;rsquo;indexation, ce qui peut Ã©galement amÃ©liorer les performances des requÃªtes. Il y a aussi de nombreuses amÃ©liorations de performance dans la faÃ§on dont PostgreSQL planifie et exÃ©cute les jointures de tables, depuis l&amp;rsquo;amÃ©lioration de la performance globale des jointures de type hash jusqu&amp;rsquo;Ã  la possibilitÃ© pour les jointures de type merge d&amp;rsquo;utiliser des tris incrÃ©mentaux.&lt;/p&gt;&#xA;&lt;p&gt;Il existe une variÃ©tÃ© d&amp;rsquo;autres fonctionnalitÃ©s de PostgreSQL 18 qui amÃ©liorent les performances pour d&amp;rsquo;autres opÃ©rations de requÃªte et de maintenance. PostgreSQL 18 supporte maintenant les crÃ©ations parallÃ¨les pour les index GIN, qui sont couramment utilisÃ©s pour la recherche sur les donnÃ©es JSON et plein texte. Cette version permet Ã©galement de dÃ©finir des clÃ©s de partition et des vues matÃ©rialisÃ©es avec des index uniques qui ne sont pas de type  B-tree. PostgreSQL 18 amÃ©liore Ã©galement les performances globales de verrouillage pour les requÃªtes qui accÃ¨dent Ã  de nombreuses relations, et ajoute plusieurs amÃ©liorations aux requÃªtes sur les tables partitionnÃ©es, y compris un meilleur support du pruning et des jointures. PostgreSQL 18 a Ã©galement amÃ©liorÃ© les performances du traitement de texte, y compris l&amp;rsquo;accÃ©lÃ©ration des fonctions &lt;code&gt;upper&lt;/code&gt;/&lt;code&gt;lower&lt;/code&gt; et une nouvelle collation intÃ©grÃ©e &lt;code&gt;PG_UNICODE_FAST&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;expÃ©rience-des-mises-Ã -jours-de-versions-majeures&#34;&gt;ExpÃ©rience des mises Ã  jours de versions majeures&lt;/h3&gt;&#xA;&lt;p&gt;Avant PostgreSQL 18, une Ã©tape importante aprÃ¨s avoir effectuÃ© une mise Ã  jour majeure Ã©tait d&amp;rsquo;exÃ©cuter la commande &lt;code&gt;ANALYZE&lt;/code&gt; pour gÃ©nÃ©rer des statistiques, ce qui est un composant critique pour aider PostgreSQL Ã  sÃ©lectionner le plan de requÃªte le plus efficace. En fonction de la taille et de l&amp;rsquo;activitÃ© globale d&amp;rsquo;un cluster PostgreSQL, ce processus pouvait prendre beaucoup de temps et avoir un impact potentiel sur les performances des requÃªtes jusqu&amp;rsquo;Ã  ce que le processus soit terminÃ©. PostgreSQL 18 introduit la possibilitÃ© de conserver les statistiques du planificateur lors d&amp;rsquo;une mise Ã  jour majeure, ce qui permet Ã  un cluster mis Ã  jour d&amp;rsquo;atteindre ses performances attendues plus rapidement une fois qu&amp;rsquo;il est disponible.&lt;/p&gt;&#xA;&lt;p&gt;De plus, &lt;code&gt;pg_upgrade&lt;/code&gt;, l&amp;rsquo;utilitaire utilisÃ© pour faciliter la mise Ã  jour d&amp;rsquo;une version majeure, a ajoutÃ© plusieurs amÃ©liorations de performance pour aider Ã  accÃ©lÃ©rer les mises Ã  jour avec de nombreux objets, tels que les tables et les sÃ©quences. Cette version permet Ã©galement Ã  &lt;code&gt;pg_upgrade&lt;/code&gt; de faire ses vÃ©rifications en parallÃ¨le en fonction des paramÃ¨tres de l&amp;rsquo;option &lt;code&gt;--jobs&lt;/code&gt;, et ajoute Ã©galement l&amp;rsquo;option &lt;code&gt;--swap&lt;/code&gt;, qui Ã©change les rÃ©pertoires de mise Ã  niveau au lieu de copier, cloner ou lier des fichiers.&lt;/p&gt;&#xA;&lt;h3 id=&#34;expÃ©rience-dÃ©veloppeur&#34;&gt;ExpÃ©rience dÃ©veloppeur&lt;/h3&gt;&#xA;&lt;p&gt;PostgreSQL 18 introduit les colonnes virtuelles gÃ©nÃ©rÃ©es qui calculent les valeurs des colonnes pendant l&amp;rsquo;exÃ©cution de la requÃªte, au lieu de les stocker. C&amp;rsquo;est maintenant l&amp;rsquo;option par dÃ©faut pour les colonnes gÃ©nÃ©rÃ©es. De plus, les colonnes gÃ©nÃ©rÃ©es stockÃ©es peuvent maintenant Ãªtre rÃ©pliquÃ©es logiquement.&lt;/p&gt;&#xA;&lt;p&gt;Cette version ajoute la possibilitÃ© d&amp;rsquo;accÃ©der Ã  la fois aux valeurs prÃ©cÃ©dentes (&lt;code&gt;OLD&lt;/code&gt;) et actuelles (&lt;code&gt;NEW&lt;/code&gt;) dans la clause &lt;code&gt;RETURNING&lt;/code&gt; pour les commandes &lt;code&gt;INSERT&lt;/code&gt;, &lt;code&gt;UPDATE&lt;/code&gt;, &lt;code&gt;DELETE&lt;/code&gt; et &lt;code&gt;MERGE&lt;/code&gt;. De plus, PostgreSQL 18 ajoute le support de la gÃ©nÃ©ration d&#39;&lt;code&gt;UUIDv7&lt;/code&gt; Ã  travers la fonction &lt;code&gt;uuidv7()&lt;/code&gt;, permettant la gÃ©nÃ©ration des UUIDs alÃ©atoires qui sont ordonnÃ©s en fonction de l&amp;rsquo;horodatage pour supporter de meilleures stratÃ©gies de cache (cette version ajoute Ã©galement &lt;code&gt;uuidv4()&lt;/code&gt; comme alias pour &lt;code&gt;gen_rand_uuuid&lt;/code&gt;).&lt;/p&gt;&#xA;&lt;p&gt;Maintenant, avec PostgreSQL 18, vous pouvez faire des comparaisons &lt;code&gt;LIKE&lt;/code&gt; sur du texte qui utilise une collation non dÃ©terministe, ce qui rend plus simple la recherche de motifs complexes. De plus, cette version introduit &lt;code&gt;CASEFOLD&lt;/code&gt; pour faciliter les correspondances insensibles Ã  la casse.&lt;/p&gt;&#xA;&lt;p&gt;Cette version ajoute Ã©galement des contraintes temporelles, ou des contraintes sur des plages, pour les contraintes &lt;code&gt;PRIMARY KEY&lt;/code&gt; et &lt;code&gt;UNIQUE&lt;/code&gt; Ã  l&amp;rsquo;aide de la clause &lt;code&gt;WITHOUT OVERLAPS&lt;/code&gt;, et pour les contraintes &lt;code&gt;FOREIGN KEY&lt;/code&gt; Ã  l&amp;rsquo;aide de la clause &lt;code&gt;PERIOD&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;sÃ©curitÃ©&#34;&gt;SÃ©curitÃ©&lt;/h3&gt;&#xA;&lt;p&gt;PostgreSQL 18 introduit l&amp;rsquo;authentification &lt;code&gt;oauth&lt;/code&gt;, qui permet aux utilisateurs de s&amp;rsquo;authentifier en utilisant les mÃ©canismes &lt;code&gt;OAuth 2.0&lt;/code&gt; supportÃ©s par l&amp;rsquo;utilisation d&amp;rsquo;extensions PostgreSQL. De plus, PostgreSQL 18 ajoute plusieurs fonctionnalitÃ©s pour valider et renforcer le comportement du mode &lt;code&gt;FIPS&lt;/code&gt;, et ajoute Ã©galement &lt;code&gt;ssl_tls13_ciphers&lt;/code&gt; pour permettre aux utilisateurs de configurer les suites de chiffrement &lt;code&gt;TLS v1.3&lt;/code&gt; que le serveur peut utiliser.&lt;/p&gt;&#xA;&lt;p&gt;Cette version dÃ©prÃ©cie l&amp;rsquo;authentification par mot de passe &lt;code&gt;md5&lt;/code&gt; en faveur de l&amp;rsquo;utilisation de l&amp;rsquo;authentification &lt;code&gt;SCRAM&lt;/code&gt; qui a Ã©tÃ© ajoutÃ©e pour la premiÃ¨re fois dans PostgreSQL 10. L&amp;rsquo;authentification &lt;code&gt;md5&lt;/code&gt; sera complÃ¨tement supprimÃ©e dans une prochaine version majeure. De plus, PostgreSQL 18 ajoute le support de l&amp;rsquo;authentification &lt;code&gt;SCRAM passthrough&lt;/code&gt; avec &lt;code&gt;postgres_fdw&lt;/code&gt; et &lt;code&gt;dblink&lt;/code&gt; lors de l&amp;rsquo;authentification d&amp;rsquo;instances PostgreSQL distantes.&lt;/p&gt;&#xA;&lt;h3 id=&#34;supervision&#34;&gt;Supervision&lt;/h3&gt;&#xA;&lt;p&gt;PostgreSQL 18 ajoute plus de dÃ©tails Ã  l&amp;rsquo;utilitaire &lt;code&gt;EXPLAIN&lt;/code&gt;, qui fournit des informations sur l&amp;rsquo;exÃ©cution du plan de requÃªte, et depuis cette version montre automatiquement combien de buffers (l&amp;rsquo;unitÃ© fondamentale de stockage des donnÃ©es, par dÃ©faut 8KB) sont accÃ©dÃ©s lors de l&amp;rsquo;exÃ©cution d&#39;&lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt;. En outre, &lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt; indique dÃ©sormais le nombre de lectures d&amp;rsquo;index au cours d&amp;rsquo;un scan d&amp;rsquo;index, et &lt;code&gt;EXPLAIN ANALYZE VERBOSE&lt;/code&gt; inclut des statistiques sur l&amp;rsquo;utilisation CPU, les WAL et la lecture moyenne. Cette version inclut Ã©galement des informations sur le temps total passÃ© en vacuum et analyse de table dans &lt;code&gt;pg_stat_all_tables&lt;/code&gt;, et montre maintenant des statistiques par connexion sur l&amp;rsquo;utilisation des E/S et des WAL.&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL 18 fournit Ã©galement plus d&amp;rsquo;informations sur les conflits d&amp;rsquo;Ã©criture qui se produisent durant la rÃ©plication logique, et affiche ces informations Ã  la fois dans les journaux et dans la vue &lt;code&gt;pg_stat_subscription_stats&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;autres-fonctionnalitÃ©s&#34;&gt;Autres fonctionnalitÃ©s&lt;/h3&gt;&#xA;&lt;p&gt;Depuis PostgreSQL 18, les sommes de contrÃ´le des donnÃ©es, qui sont utilisÃ©es pour valider l&amp;rsquo;intÃ©gritÃ© des donnÃ©es stockÃ©es, sont maintenant activÃ©es par dÃ©faut sur les nouveaux clusters PostgreSQL. Vous pouvez choisir de dÃ©sactiver ce comportement en utilisant la commande &lt;code&gt;initdb --no-data-checksums&lt;/code&gt;. Notez que cela peut nÃ©cessiter des changements dans vos scripts de mise Ã  jour.&lt;/p&gt;&#xA;&lt;p&gt;De plus, de nouveaux comportements sont disponibles dans plusieurs fonctionnalitÃ©s de contraintes. Tout d&amp;rsquo;abord, les contraintes de clÃ© Ã©trangÃ¨re et de vÃ©rification peuvent Ãªtre dÃ©finies comme &lt;code&gt;NOT ENFORCED&lt;/code&gt; et, inversement, rendues exÃ©cutoires. De plus, les contraintes &lt;code&gt;NOT NULL&lt;/code&gt; prÃ©servent maintenant leurs noms comme l&amp;rsquo;exige le standard SQL, supportent les clauses &lt;code&gt;NOT VALID&lt;/code&gt; et &lt;code&gt;NO INHERIT&lt;/code&gt;, et se comportent maintenant de maniÃ¨re plus cohÃ©rente avec l&amp;rsquo;hÃ©ritage.&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;pg_createsubscriber&lt;/code&gt; supporte maintenant le drapeau &lt;code&gt;--all&lt;/code&gt; pour que vous puissiez crÃ©er des rÃ©plicas logiques pour toutes les bases de donnÃ©es d&amp;rsquo;une instance avec une seule commande. De plus, PostgreSQL 18 vous permet de crÃ©er la dÃ©finition du schÃ©ma d&amp;rsquo;une table Ã©trangÃ¨re en utilisant la dÃ©finition d&amp;rsquo;une table locale en utilisant la commande &lt;code&gt;CREATE FOREIGN TABLE ... LIKE&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL 18 introduit Ã©galement une nouvelle version (3.2) du protocole de communication, qui est la premiÃ¨re nouvelle version du protocole depuis PostgreSQL 7.4 (2003). &lt;code&gt;libpq&lt;/code&gt; utilise toujours la version 3.0 par dÃ©faut en attendant que les clients (par exemple, les pilotes, les poolers, les proxies) ajoutent le support de la nouvelle version du protocole.&lt;/p&gt;&#xA;&lt;h2 id=&#34;fonctionnalitÃ©s-supplÃ©mentaires&#34;&gt;FonctionnalitÃ©s supplÃ©mentaires&lt;/h2&gt;&#xA;&lt;p&gt;De nombreuses autres fonctionnalitÃ©s et amÃ©liorations ont Ã©tÃ© ajoutÃ©es Ã  PostgreSQL. En fonction des cas d&amp;rsquo;usages, leur importance peut paraÃ®tre plus ou moins grande que celles mentionnÃ©es ci-dessus.&lt;/p&gt;&#xA;&lt;p&gt;Vous pouvez consulter les &lt;a href=&#34;https://www.postgresql.org/docs/devel/release-18.html&#34;&gt;notes de publications&lt;/a&gt; pour une liste complÃ¨te des nouveautÃ©s et changements : &lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;https://www.postgresql.org/docs/18/release-18.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;tests-pour-le-dÃ©bogage-et-la-compatibilitÃ©&#34;&gt;Tests pour le dÃ©bogage et la compatibilitÃ©&lt;/h2&gt;&#xA;&lt;p&gt;La stabilitÃ© de chaque publication de PostgreSQL dÃ©pend de vous, la&#xA;communautÃ©. En testant la version Ã  venir avec votre charge et vos outils de&#xA;tests, vous pourrez nous aider Ã  trouver les bogues et rÃ©gressions avant la&#xA;publication de PostgreSQL 18.&lt;/p&gt;&#xA;&lt;p&gt;Ã‰tant donnÃ© qu&amp;rsquo;il s&amp;rsquo;agit d&amp;rsquo;une version bÃªta, des changements mineurs dans le&#xA;comportement de la base de donnÃ©es, des dÃ©tails et des APIs sont toujours&#xA;possibles. Vos retours et tests aideront Ã  dÃ©terminer les ajustements finaux&#xA;des nouvelles fonctionnalitÃ©s.&lt;/p&gt;&#xA;&lt;p&gt;La qualitÃ© des tests aide Ã  dÃ©terminer le moment de la publication&#xA;finale.&lt;/p&gt;&#xA;&lt;p&gt;Une liste des &lt;a href=&#34;https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items&#34;&gt;problÃ¨mes ouverts&lt;/a&gt;&#xA;est publiquement disponible dans le wiki de PostgreSQL. Vous pouvez&#xA;&lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;rapporter des bogues&lt;/a&gt;&#xA;en utilisant le formulaire prÃ©sent sur le site web de PostgreSQLÂ :&#xA;&lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;https://www.postgresql.org/account/submitbug/&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;planning-bÃªta&#34;&gt;Planning BÃªta&lt;/h2&gt;&#xA;&lt;p&gt;Il s&amp;rsquo;agit de la premiÃ¨re publication bÃªta de la version 18. Le projet&#xA;PostgreSQL publiera autant de bÃªtas que cela est nÃ©cessaire pour tester. Celles-ci&#xA;seront suivies par une ou plusieurs publications de versions candidates,&#xA;jusqu&amp;rsquo;Ã  la publication de la version finale vers septembre/octobre 2025.&lt;/p&gt;&#xA;&lt;p&gt;Pour plus d&amp;rsquo;information,&#xA;veuillez consulter la page &lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;Beta Testing&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;liens&#34;&gt;Liens&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/download/&#34;&gt;TÃ©lÃ©chargement&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/developer/beta/&#34;&gt;Information sur le BÃªta Testing&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/18/release-18.html&#34;&gt;Note de publication de PostgreSQL 18 BÃªta&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items&#34;&gt;ProblÃ¨mes connus de PostgreSQL 18&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/account/submitbug/&#34;&gt;Soumettre un bogue&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/about/donate/&#34;&gt;Faire un don&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;CrÃ©dits photo : Carlos Gonzalez&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>POSETTE 2025</title>
    <updated>2025-04-24T14:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-04-24:/post/posette-2025/</id>
    <link href="http://www.loxodata.com/post/posette-2025/" rel="alternate"></link>
    <summary type="html">&lt;h2 id=&#34;le-programme-2025&#34;&gt;Le programme 2025&lt;/h2&gt;&#xA;&lt;p&gt;Pour sa quatriÃ¨me annÃ©e, l&amp;rsquo;Ã©vÃ¨nement virtuel &lt;a href=&#34;https://posetteconf.com/2025/&#34;&gt;POSETTE&lt;/a&gt; revient du 10 au 12 juin 2025.&lt;/p&gt;&#xA;&lt;p&gt;Cette confÃ©rence virtuelle et gratuite proposera durant ces trois jours 42 prÃ©sentations de 45 orateurs diffÃ©rents,&#xA;rÃ©parties en quatres diffusions en direct. Il sera possible de rejoindre un &lt;a href=&#34;https://aka.ms/open-source-discord&#34;&gt;serveur Discord&lt;/a&gt;&#xA;afin de poser des questions aux orateurs et de discuter avec les autres participants.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://posetteconf.com/2025/schedule/&#34;&gt;programme&lt;/a&gt; complet est disponible sur le site de la confÃ©rence et le planning des diffusions :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://posetteconf.com/2025/schedule/#livestream1&#34;&gt;Livestream 1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://posetteconf.com/2025/schedule/#livestream2&#34;&gt;Livestream 2&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://posetteconf.com/2025/schedule/#livestream3&#34;&gt;Livestream 3&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://posetteconf.com/2025/schedule/#livestream4&#34;&gt;Livestream 4&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cette annÃ©e, la confÃ©rence proposera une keynote de Bruce Momjian autour de l&amp;rsquo;IA et des bases de donnÃ©es et de Charles Feddersen&#xA;sur les contributions de Microsoft pour PostgreSQL sur l&amp;rsquo;annÃ©e 2025.&lt;/p&gt;&#xA;&lt;p&gt;CrÃ©dits photo : Microsoft&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Retour sur le pgDay Paris 2025</title>
    <updated>2025-04-01T15:00:00Z</updated>
    <id>tag:www.loxodata.com,2025-04-01:/post/pgday-paris-2025/</id>
    <link href="http://www.loxodata.com/post/pgday-paris-2025/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le 20 mars 2025 sâ€™est tenue la 9e Ã©dition du pgDay Paris 2025. Cette Ã©dition sâ€™est dÃ©roulÃ©e au sein de lâ€™espace Saint Martin, dans le 3e arrondissement de Paris, qui dispose dâ€™un bel auditorium.&lt;/p&gt;&#xA;&lt;p&gt;LOXODATA Ã©tait, cette annÃ©e encore, sponsor Â«Â partner Â» de lâ€™Ã©vÃ¨nement. Nous avions un stand, ce qui nous a permis des Ã©changes intÃ©ressants avec les auditeurs de cette Ã©dition.&lt;/p&gt;&#xA;&lt;p&gt;Cette annÃ©e encore, 2 salles de confÃ©rences Ã©taient dÃ©diÃ©es Ã  l&amp;rsquo;Ã©vÃ©nement.&#xA;La seconde Ã©tait majoritairement attribuÃ©e Ã  des confÃ©rences courtes faites par des sponsors.&lt;/p&gt;&#xA;&lt;p&gt;Le programme complet est sur le site du &lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2025/schedule&#34;&gt;pgDay Paris 2025&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;les-confÃ©rences&#34;&gt;Les confÃ©rences&lt;/h2&gt;&#xA;&lt;p&gt;Le programme de la journÃ©e de confÃ©rences comportait onze sessions en anglais, et une en franÃ§ais,&#xA;rÃ©parties entre lâ€™auditorium et une autre salle plus petite. S&amp;rsquo;ajoutait Ã©galement une session de confÃ©rences Ã©clair.&#xA;Parmi toutes ces confÃ©rences, on pouvait  retrouver plusieurs prÃ©sentations non techniques.&lt;/p&gt;&#xA;&lt;h3 id=&#34;tuning-community-parameters-hosting-postgresql-events-that-perform&#34;&gt;Tuning community parameters: Hosting PostgreSQL events that perform&lt;/h3&gt;&#xA;&lt;p&gt;AprÃ¨s lâ€™introduction faite par Vik Fearing, la keynote dâ€™ouverture sâ€™est dÃ©roulÃ©e dans lâ€™auditorium.&lt;/p&gt;&#xA;&lt;p&gt;Ellyne Phneah nous prÃ©senta les clÃ©s de l&amp;rsquo;organisation d&amp;rsquo;Ã©vÃ¨nements communautaires PostgreSQL, en s&amp;rsquo;appuyant sur l&amp;rsquo;expÃ©rience&#xA;du &lt;a href=&#34;https://www.meetup.com/malmo-postgresql-user-group-m-pug/&#34;&gt;M-PUG (MalmÃ¶ PostgreSQL User Group)&lt;/a&gt; et des confÃ©rences PostgreSQL.&#xA;Une premiÃ¨re partie insiste sur l&amp;rsquo;importance des communautÃ©s et des Ã©vÃ¨nements PostgreSQL, et comment les faire reconnaÃ®tre&#xA;officiellement par la communautÃ©. Puis, elle nous exposa l&amp;rsquo;importance dans la sÃ©lection des sujets, les formats engageants, la&#xA;logistique et l&amp;rsquo;implication d&amp;rsquo;orateurs.&lt;br&gt;&#xA;Elle nous donna Ã©galement des astuces sur la maniÃ¨re de maximiser l&amp;rsquo;engagement, mesurer&#xA;le succÃ¨s et maintenir l&amp;rsquo;Ã©lan aprÃ¨s l&amp;rsquo;Ã©vÃ©nement, mais aussi quelques astuces pour gÃ©rer des problÃ¨mes de derniÃ¨re minute. Que&#xA;vous lanciez un groupe ou revitalisiez un meetup, cette confÃ©rence vous donne des stratÃ©gies concrÃ¨tes pour faire vivre le groupe.&lt;/p&gt;&#xA;&lt;h3 id=&#34;professional-postgresql-monitoring-made-easy&#34;&gt;Professional PostgreSQL monitoring made easy&lt;/h3&gt;&#xA;&lt;p&gt;AprÃ¨s cette confÃ©rence, deux choix se prÃ©sentaient.&lt;br&gt;&#xA;Dans l&amp;rsquo;auditorum oÃ¹ Pavlo Golub prÃ©senta d&amp;rsquo;abord tous les niveaux pertinents&#xA;de surveillance des bases de donnÃ©es, puis se concentra sur PostgreSQL et les moyens qu&amp;rsquo;il fournit.&lt;br&gt;&#xA;Il prÃ©senta pgwatch de Cybertec&#xA;comme une solution Open Source pour une surveillance simplifiÃ©e et complÃ¨te et il aborda Ã©galement des sujets avancÃ©s, comme la&#xA;dÃ©tection d&amp;rsquo;anomalies et les alertes.&lt;/p&gt;&#xA;&lt;h3 id=&#34;maintenir-un-inventaire-de-lÃ©cosystÃ¨me-communautaire-autour-de-postgresql&#34;&gt;Maintenir un inventaire de l&amp;rsquo;Ã©cosystÃ¨me communautaire autour de PostgreSQL&lt;/h3&gt;&#xA;&lt;p&gt;Dans le mÃªme temps, dans la salle &lt;em&gt;Karnak&lt;/em&gt;, JÃ©rÃ´me Desroziers (Orange France) et StÃ©phane Schildknecht (LOXODATA) prÃ©sentÃ¨rent en&#xA;franÃ§ais comment Â«Â maintenir un inventaire de l&amp;rsquo;Ã©cosystÃ¨me communautaire autour de PostgreSQLÂ Â». Cette prÃ©sentation avait pour but&#xA;dâ€™introduire un nouveau projet libre de catalogue des outils et extensions open source autour de PostgreSQL.&lt;br&gt;&#xA;Le projet est dâ€™ores et dÃ©jÃ  utilisable sur &lt;a href=&#34;https://pg-ecosystem.gitlab.io/pg-ecosystem/&#34;&gt;https://pg-ecosystem.gitlab.io/pg-ecosystem/&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h3 id=&#34;full-text-search-explained-from-a-to-z-with-french-food&#34;&gt;Full-Text-Search Explained from A to Z with French Food&lt;/h3&gt;&#xA;&lt;p&gt;Avant la pause dÃ©jeuner, Matt Cornillon nous ouvrit l&amp;rsquo;appÃ©tit avec une confÃ©rence sur le full text search sur le thÃ¨me de la&#xA;nourriture franÃ§aise.&lt;br&gt;&#xA;Cette prÃ©sentation Ã©tait dÃ©composÃ©e comme un repas traditionnel, avec comme apÃ©ritif une introduction aux&#xA;bases de la recherche plein texte â€“ qu&amp;rsquo;est-ce que c&amp;rsquo;est et pourquoi l&amp;rsquo;utiliser.&lt;br&gt;&#xA;Une entrÃ©e sur l&amp;rsquo;exploration des concepts clÃ©s&#xA;comme tsvector, tsquery et le classement des rÃ©sultats.&lt;br&gt;&#xA;En plat de rÃ©sistance, une analyse des mÃ©canismes de stemming, de lexÃ¨mes&#xA;et du parsing des documents.&lt;br&gt;&#xA;En dessert, techniques avancÃ©es â€“ ajustement des poids, dictionnaires de synonymes et configurations personnalisÃ©es.&lt;br&gt;&#xA;Et pour terminer, une fusion de la recherche plein texte traditionnelle avec la recherche sÃ©mantique pour une&#xA;approche hybride combinant recherche plein texte et comprÃ©hension contextuelle.&lt;br&gt;&#xA;Pendant ce temps deux confÃ©rences se sont succÃ©dÃ©es&#xA;dans l&amp;rsquo;autre salle.&lt;/p&gt;&#xA;&lt;h3 id=&#34;dear-azure-database-for-postgresql-can-you-automate-my-index&#34;&gt;Dear Azure Database for PostgreSQL, can you automate my index?&lt;/h3&gt;&#xA;&lt;p&gt;Tout d&amp;rsquo;abord Emmanuel Deletang nous Ã  prÃ©sentÃ© une fonctionnalitÃ© d&#39;Â«Â Azure Database for PostgreSQL - Flexible ServerÂ Â» qui facilite&#xA;lâ€™optimisation des index. Cet assistant intÃ©grÃ© surveille, analyse et ajuste en continu les index pour amÃ©liorer les performances.&lt;/p&gt;&#xA;&lt;h3 id=&#34;distributed-vector-database-with-aidb-and-pgd&#34;&gt;Distributed vector database with aidb and PGD&lt;/h3&gt;&#xA;&lt;p&gt;Nous n&amp;rsquo;avons malheureusement pas assistÃ© Ã  cette confÃ©rence. C&amp;rsquo;est pourtant toujours un plaisir de voir Boriss MejÃ­as, qui est un&#xA;excellent orateur.&lt;/p&gt;&#xA;&lt;h3 id=&#34;lightning-talks&#34;&gt;Lightning Talks!&lt;/h3&gt;&#xA;&lt;p&gt;AprÃ¨s la pause mÃ©ridienne, ce fut le moment des confÃ©rences Ã©clair, dans l&amp;rsquo;auditorium. 7 personnes se sont succÃ©dÃ©es pour nous&#xA;prÃ©senter 6 sujets, chacun en moins de 5 minutes chrono. L&amp;rsquo;animation Ã©tait rÃ©alisÃ©e par Magnus Hagander.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Devrim GÃ¼ndÃ¼z a dÃ©butÃ© la session en nous parlant de faÃ§on humoristique du stress causÃ© par la crÃ©ation et la livraison des&#xA;paquets RedHat/Centos de PostgreSQL, ainsi que de sa maniÃ¨re de gÃ©rer cela. #ğŸº&lt;/li&gt;&#xA;&lt;li&gt;Reda Agaoua nous a parlÃ© de Transparent Data Encryption, une fonctionnalitÃ© qui est souvent rÃ©clamÃ©e pour garantir Ã  elle seule&#xA;un niveau de sÃ©curitÃ©, mais qui n&amp;rsquo;est pas magique.&lt;/li&gt;&#xA;&lt;li&gt;MartÃ­n MarquÃ©s a enchaÃ®nÃ© sur 3 erreurs basiques Ã  absolument Ã©viter dans la mise en place de politiques de sauvegarde.&lt;/li&gt;&#xA;&lt;li&gt;Floor Drees et Boriss MejÃ­as nous ont parlÃ© de KaraokÃ© et de possibilitÃ© de choisir des chansons par similitude avec la chanson&#xA;courante, avec une invitation Ã  venir constater cela le soir mÃªme.&lt;/li&gt;&#xA;&lt;li&gt;Xavier Fischer nous a ensuite prÃ©sentÃ© une maniÃ¨re d&amp;rsquo;utiliser wireshark pour capturer les Ã©changes du protocole postgres et le&#xA;reprÃ©senter sous un format graphique avec latex.&lt;/li&gt;&#xA;&lt;li&gt;Enfin, Pavlo Golub nous a fait jouer Ã  une version de wordle spÃ©cialisÃ©e sur certains mots clÃ©s de PostgreSQL, en nous proposant&#xA;des mots Ã  trouver et en attendant des propositions de la salle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 id=&#34;why-postgresql-people-should-really-care-about-kafka-and-debezium&#34;&gt;Why PostgreSQL people should really care about Kafka and Debezium?&lt;/h3&gt;&#xA;&lt;p&gt;AprÃ¨s ce moment un peu plus lÃ©ger, une autre confÃ©rence par Dirk Krautschick nous a intÃ©ressÃ©s Ã  Kafka et Debezium. Le constat de&#xA;dÃ©part est que le mÃ©tier de DBA change, et dÃ©sormais, beaucoup de choses se basent sur des flux.&lt;br&gt;&#xA;Le Change Data Capture transforme les donnÃ©es en flux, qui passent par Kafka avec un plugin Debezium. Les diffÃ©rents outils ont Ã©tÃ© prÃ©sentÃ©s et des dÃ©monstrations&#xA;ont Ã©tÃ© faites du fonctionnement de chacun.&lt;/p&gt;&#xA;&lt;h3 id=&#34;waiting-for-postgresql-18&#34;&gt;Waiting for PostgreSQL 18&lt;/h3&gt;&#xA;&lt;p&gt;En parallÃ¨le dans le deuxiÃ¨me salle, Frederic Delacourt donnait des dÃ©tails pour vous aider Ã  prÃ©voir les migrations et anticiper&#xA;ce qui se passera Ã  l&amp;rsquo;avenir.&lt;br&gt;&#xA;La session se termina par une brÃ¨ve discussion sur les fonctionnalitÃ©s qui enthousiasment le plus&#xA;Data Bene, ainsi qu&amp;rsquo;un aperÃ§u des extensions en cours de dÃ©veloppement qui sont planifiÃ©es pour une sortie en mÃªme temps que&#xA;PostgreSQL 18, en tenant compte des changements Ã  venir.&lt;/p&gt;&#xA;&lt;h3 id=&#34;postgresql-and-nodejs-as-a-core-feature-of-backend-for-frontend&#34;&gt;PostgreSQL and NodeJs as a Core Feature of Backend for Frontend&lt;/h3&gt;&#xA;&lt;p&gt;Viktoriia Hrechukha nous a prÃ©sentÃ© 2 dÃ©rivÃ©s de nodejs, et la maniÃ¨re de se connecter Ã  PostgreSQL depuis nextjs. Dans l&amp;rsquo;optique&#xA;d&amp;rsquo;un front end, les diffÃ©rentes maniÃ¨res de rendre une page ont Ã©tÃ© Ã©voquÃ©es (SSR, CSR, SSG, ISR, mixte).&lt;/p&gt;&#xA;&lt;h3 id=&#34;my-journey-in-postgresql-bug-fixing&#34;&gt;My Journey in PostgreSQL bug fixing&lt;/h3&gt;&#xA;&lt;p&gt;Bertrand Drouvot nous Ã  partagÃ© son expÃ©rience sur quelques corrections de bogues et a approfondi la faÃ§on de les reproduire, la&#xA;tentative initiale de correction et le correctif final.&lt;/p&gt;&#xA;&lt;h3 id=&#34;explore-the-role-of-postgresql-in-gitlab-ecosystem&#34;&gt;Explore the role of PostgreSQL in GitLab ecosystem&lt;/h3&gt;&#xA;&lt;p&gt;Hana LitavskÃ¡, chercheuse doctorante Ã  l&amp;rsquo;universitÃ© de Pragues, s&amp;rsquo;est intÃ©ressÃ©e Ã  la maniÃ¨re dont PostgreSQL est utilisÃ© avec&#xA;GitLab. En utilisant une mÃ©thode de reverse engineering, elle a cherchÃ© les stratÃ©gies et techniques utilisÃ©es par GitLab pour&#xA;optimiser ses interactions avec la base de donnÃ©es. GitLab n&amp;rsquo;est pas un sujet trÃ¨s simple puisqu&amp;rsquo;il existe plusieurs types&#xA;d&amp;rsquo;environnements possibles selon les clients.&lt;/p&gt;&#xA;&lt;p&gt;Puis, Vik Fearing conclua la journÃ©e avec le mot de la fin.&lt;/p&gt;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&lt;p&gt;Ce pgday Paris a fait la place Ã  des confÃ©rences plus accessibles et moins centrÃ©es sur PostgreSQL, explorant des mÃ©thodes de&#xA;travail et des outils liÃ©s Ã  PostgreSQL. Le public Ã©tait un peu moins nombreux que les annÃ©es prÃ©cÃ©dentes, et le passage Ã  deux&#xA;salles de confÃ©rences de l&amp;rsquo;annÃ©e derniÃ¨re diffÃ©rait lÃ©gÃ¨rement cette annÃ©e, puisque la deuxiÃ¨me salle Ã©tait majoritairement occupÃ©e&#xA;par les sponsors.&lt;/p&gt;&#xA;&lt;p&gt;EspÃ©rons que l&amp;rsquo;annÃ©e prochaine, le dixiÃ¨me pgday Paris aura bien lieu et rassemblera de nouveau un public nombreux. Nous espÃ©rons&#xA;vous y retrouver!&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL Extension Day 2025</title>
    <updated>2025-03-17T08:30:00Z</updated>
    <id>tag:www.loxodata.com,2025-03-17:/post/pgext-day-2025/</id>
    <link href="http://www.loxodata.com/post/pgext-day-2025/" rel="alternate"></link>
    <summary type="html">&lt;h2 id=&#34;postgresql-extension-day-2025&#34;&gt;PostgreSQL Extension Day 2025&lt;/h2&gt;&#xA;&lt;p&gt;Le 12 mai 2025 se tiendra l&amp;rsquo;Ã©vÃ©nement gratuit &lt;a href=&#34;https://pgext.day/&#34;&gt;PostgreSQL Extension Day&lt;/a&gt; Ã  MontrÃ©al, soit la veille de la confÃ©rence PostgreSQL &lt;a href=&#34;https://2025.pgconf.dev/&#34;&gt;PGConf.dev&lt;/a&gt; qui se tiendra pour sa part du 13 au 15 mai. Cette confÃ©rence n&amp;rsquo;est toutefois pas affiliÃ©e Ã  la &lt;a href=&#34;https://2025.pgconf.dev/&#34;&gt;PGConf.dev&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Ce rassemblement a pour but de rÃ©unir tous les acteurs qui contribuent et utilisent les extensions de PostgreSQL constituant un Ã©cosystÃ¨me de plusieurs centaines de projets : prÃ¨s de 400 actuellement. Le &lt;a href=&#34;https://pgext.day/&#34;&gt;PostgreSQL Extension Day&lt;/a&gt; est organisÃ© par le groupe &lt;a href=&#34;https://github.com/pgedc&#34;&gt;Postgres Extension Developers Coalition&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://sessionize.com/pgextday2025mtl&#34;&gt;CFP&lt;/a&gt; est ouvert jusqu&amp;rsquo;au 1er avril 2025, et les inscriptions sont ouvertes par &lt;a href=&#34;https://pgextday2025mtl.eventbrite.ca/&#34;&gt;ici&lt;/a&gt;.&lt;/p&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>L&#39;extension pg_trgm</title>
    <updated>2025-03-07T08:20:00Z</updated>
    <id>tag:www.loxodata.com,2025-03-07:/post/pg_trgm/</id>
    <link href="http://www.loxodata.com/post/pg_trgm/" rel="alternate"></link>
    <summary type="html">&lt;h1 id=&#34;lextension-pg_trgm&#34;&gt;L&amp;rsquo;extension pg_trgm&lt;/h1&gt;&#xA;&lt;h2 id=&#34;prÃ©sentation&#34;&gt;PrÃ©sentation&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;extension &lt;code&gt;pg_trgm&lt;/code&gt; (trigrammes) est fournie dans la distribution standard de PostgreSQL. Elle est prÃ©sente dans &lt;code&gt;/contrib&lt;/code&gt; et s&amp;rsquo;installe simplement dans une base de donnÃ©es :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# CREATE EXTENSION IF NOT EXISTS pg_trgm;&#xA;CREATE EXTENSION&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cette extension permet de dÃ©composer une chaÃ®ne de caractÃ¨res en succession de sous-chaÃ®nes de 3 caractÃ¨res (trigrammes), afin de permettre des recherches sur une sous-chaÃ®ne, ou bien des recherches de similaritÃ© entre chaÃ®nes de caractÃ¨res.&lt;/p&gt;&#xA;&lt;h2 id=&#34;fonctionnement&#34;&gt;Fonctionnement&lt;/h2&gt;&#xA;&lt;h3 id=&#34;jeu-dessai&#34;&gt;Jeu d&amp;rsquo;essai&lt;/h3&gt;&#xA;&lt;p&gt;Dans le cadre de cette prÃ©sentation, je me suis constituÃ© une table d&amp;rsquo;un million de lignes, laquelle contient un champ &lt;code&gt;family&lt;/code&gt; contenant un nom de famille parmi les 1000 plus frÃ©quent en France, et dont la frÃ©quence dans la table est semblable Ã  celle de la population franÃ§aise :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# \dS my_datas&#xA;                              Table &amp;quot;public.my_datas&amp;quot;&#xA;   Column    |  Type  | Collation | Nullable |               Default&#xA;-------------+--------+-----------+----------+--------------------------------------&#xA; id          | bigint |           | not null | nextval(&#39;my_datas_id_seq&#39;::regclass)&#xA; random_text | text   |           |          |&#xA; family      | text   |           |          |&#xA;Indexes:&#xA;    &amp;quot;idx_test_id&amp;quot; btree (id)&#xA;&#xA;loxodata_text=# SELECT count(1) FROM my_datas;&#xA;  count&#xA;---------&#xA; 1000204&#xA;(1 row)&#xA;&#xA;loxodata_text=# SELECT * FROM my_datas LIMIT 5;&#xA;   id   |             random_text              | family&#xA;--------+--------------------------------------+---------&#xA; 211685 | 94376bb6-3655-4a65-b61a-8dbec927c5e5 | GRANGER&#xA; 211686 | 7f9f8a34-13f2-4459-bd2c-e4b90a7eca9b | LE ROUX&#xA; 211687 | 526549b3-13fe-4aae-87c1-4a5480cf6898 | FUCHS&#xA; 211688 | 1acbdde8-b4cd-4bf8-957c-84adf1c6cf1c | BRUNET&#xA; 211689 | 77cd8645-bfe8-471c-a118-3dbe507d8e8f | LAMBERT&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;dÃ©composition&#34;&gt;DÃ©composition&lt;/h3&gt;&#xA;&lt;p&gt;On peut visualiser la dÃ©composition en trigrammes avec la fonction &lt;code&gt;show_trgm()&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# SELECT show_trgm(&#39;GRANGER&#39;);&#xA;                show_trgm&#xA;-----------------------------------------&#xA; {&amp;quot;  g&amp;quot;,&amp;quot; gr&amp;quot;,ang,&amp;quot;er &amp;quot;,ger,gra,nge,ran}&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;similaritÃ©&#34;&gt;SimilaritÃ©&lt;/h3&gt;&#xA;&lt;p&gt;La fonction &lt;code&gt;similarity()&lt;/code&gt; permet de tester la similaritÃ© entre deux chaÃ®nes de caractÃ¨res. Le rÃ©sultat est un score entre 0 et 1. ZÃ©ro indique qu&amp;rsquo;il n&amp;rsquo;y a aucun trigramme en commun entre les deux chaÃ®nes, tandis que 1 indique que les deux chaÃ®nes sont identiques. On peut ainsi tester la similaritÃ© entre deux noms de famille :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# select similarity(&#39;GRANGER&#39;,&#39;BRUNET&#39;);&#xA; similarity&#xA;------------&#xA;          0&#xA;(1 row)&#xA;&#xA;loxodata_text=# select similarity(&#39;GRANGER&#39;,&#39;GRANGE&#39;);&#xA; similarity&#xA;------------&#xA;  0.6666667&#xA;(1 row)&#xA;&#xA;loxodata_text=# select similarity(&#39;GRANGER&#39;,&#39;GRANIER&#39;);&#xA; similarity&#xA;------------&#xA; 0.45454547&#xA;(1 row)&#xA;&#xA;loxodata_text=# select similarity(&#39;GRANGER&#39;,&#39;LEGRAND&#39;);&#xA; similarity&#xA;------------&#xA; 0.14285715&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;opÃ©rateur boolÃ©en de similaritÃ© entre deux chaÃ®nes est &lt;code&gt;%&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# select &#39;GRANGER&#39; % &#39;GRANIER&#39;;&#xA; ?column?&#xA;----------&#xA; t&#xA;(1 row)&#xA;&#xA;loxodata_text=# select &#39;GRANGER&#39; % &#39;LEGRAND&#39;;&#xA; ?column?&#xA;----------&#xA; f&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;opÃ©rateur boolÃ©en retourne &lt;code&gt;True&lt;/code&gt; si le score de similaritÃ© excÃ¨de une limite fixÃ©e par dÃ©faut Ã  &lt;code&gt;0.3&lt;/code&gt;. La limite courante peut Ãªtre consultÃ©e avec la fonction &lt;code&gt;show_limit()&lt;/code&gt; :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# select show_limit();&#xA; show_limit&#xA;------------&#xA;        0.3&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Et cette limite peut Ãªtre modifiÃ©e au niveau de la session avec la fonction &lt;code&gt;set_limit()&lt;/code&gt;. Ainsi, si on passe le seuil Ã  &lt;code&gt;0.1&lt;/code&gt;, &amp;lsquo;GRANGER&amp;rsquo; et &amp;lsquo;LEGRAND&amp;rsquo; sont dÃ©sormais considÃ©rÃ©s comme similaires :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# select set_limit(0.1);&#xA; set_limit&#xA;-----------&#xA;       0.1&#xA;(1 row)&#xA;&#xA;loxodata_text=# select &#39;GRANGER&#39; % &#39;LEGRAND&#39;;&#xA; ?column?&#xA;----------&#xA; t&#xA;(1 row)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cette limite peut Ãªtre configurÃ©e au niveau du cluster avec le paramÃ¨tre &lt;code&gt;pg_trgm.similarity_threshold&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;indexation-et-performances&#34;&gt;Indexation et performances&lt;/h2&gt;&#xA;&lt;h3 id=&#34;lindexation-btree-classique&#34;&gt;L&amp;rsquo;indexation BTREE classique&lt;/h3&gt;&#xA;&lt;p&gt;Les champs TEXT peuvent Ãªtre indexÃ©s classiquement avec un index BTREE :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# CREATE INDEX idx_test ON my_datas(family text_pattern_ops);&#xA;CREATE INDEX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cela permet de trouver rapidement des chaÃ®nes de caractÃ¨res ou des dÃ©buts de chaÃ®nes de caractÃ¨res :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family = &#39;GRANGER&#39;;&#xA;                                                     QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=10.09..2289.04 rows=731 width=8) (actual time=0.101..0.584 rows=658 loops=1)&#xA;   Recheck Cond: (family = &#39;GRANGER&#39;::text)&#xA;   Heap Blocks: exact=637&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test  (cost=0.00..9.91 rows=731 width=0) (actual time=0.047..0.047 rows=658 loops=1)&#xA;         Index Cond: (family = &#39;GRANGER&#39;::text)&#xA; Planning Time: 0.120 ms&#xA; Execution Time: 0.612 ms&#xA;(7 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family like  &#39;GRAN%&#39;;&#xA;                                                      QUERY PLAN&#xA;-----------------------------------------------------------------------------------------------------------------------&#xA; Index Scan using idx_test on my_datas  (cost=0.42..8.45 rows=66 width=8) (actual time=0.024..2.121 rows=3692 loops=1)&#xA;   Index Cond: ((family ~&amp;gt;=~ &#39;GRAN&#39;::text) AND (family ~&amp;lt;~ &#39;GRAO&#39;::text))&#xA;   Filter: (family ~~ &#39;GRAN%&#39;::text)&#xA; Planning Time: 0.137 ms&#xA; Execution Time: 2.234 ms&#xA;(5 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cependant un tel index se rÃ©vÃ¨le inutile lorsqu&amp;rsquo;on ne connaÃ®t pas le dÃ©but de la chaÃ®ne recherchÃ©e. Dans ce cas on bascule sur un Seq Scan malgrÃ© la prÃ©sence de l&amp;rsquo;index :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family like  &#39;%ANGER&#39;;&#xA;                                                        QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------------&#xA; Gather  (cost=1000.00..17185.70 rows=6643 width=8) (actual time=0.196..36.796 rows=2585 loops=1)&#xA;   Workers Planned: 2&#xA;   Workers Launched: 2&#xA;   -&amp;gt;  Parallel Seq Scan on my_datas  (cost=0.00..15521.40 rows=2768 width=8) (actual time=0.027..33.117 rows=862 loops=3)&#xA;         Filter: (family ~~ &#39;%ANGER&#39;::text)&#xA;         Rows Removed by Filter: 332540&#xA; Planning Time: 0.071 ms&#xA; Execution Time: 36.894 ms&#xA;(8 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;indexation-des-trigrammes&#34;&gt;Indexation des trigrammes&lt;/h3&gt;&#xA;&lt;p&gt;Il est possible d&amp;rsquo;indexer les vecteurs de trigrammes avec un index GIN :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# CREATE INDEX idx_test_trgm ON my_datas USING GIN(family gin_trgm_ops);&#xA;CREATE INDEX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;La recherche sur la fin de chaÃ®ne de caractÃ¨res se fait maintenant en utilisant l&amp;rsquo;index nouvellement crÃ©Ã© :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT id FROM my_datas WHERE family like  &#39;%ANGER&#39;;&#xA;                                                         QUERY PLAN&#xA;-----------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=94.35..9754.04 rows=6643 width=8) (actual time=1.422..3.197 rows=2585 loops=1)&#xA;   Recheck Cond: (family ~~ &#39;%ANGER&#39;::text)&#xA;   Heap Blocks: exact=2292&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..92.69 rows=6643 width=0) (actual time=1.193..1.194 rows=2585 loops=1)&#xA;         Index Cond: (family ~~ &#39;%ANGER&#39;::text)&#xA; Planning Time: 0.085 ms&#xA; Execution Time: 3.282 ms&#xA;(7 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Nous pouvons maintenant effectuer une recherche de similaritÃ© :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT DISTINCT family FROM my_datas WHERE family %  &#39;GRANGER&#39;;&#xA;                                                               QUERY PLAN&#xA;----------------------------------------------------------------------------------------------------------------------------------------&#xA; Unique  (cost=370.28..370.61 rows=64 width=7) (actual time=19.476..19.867 rows=6 loops=1)&#xA;   -&amp;gt;  Sort  (cost=370.28..370.45 rows=66 width=7) (actual time=19.474..19.632 rows=4284 loops=1)&#xA;         Sort Key: family&#xA;         Sort Method: quicksort  Memory: 264kB&#xA;         -&amp;gt;  Bitmap Heap Scan on my_datas  (cost=119.31..368.29 rows=66 width=7) (actual time=7.737..18.771 rows=4284 loops=1)&#xA;               Recheck Cond: (family % &#39;GRANGER&#39;::text)&#xA;               Rows Removed by Index Recheck: 3468&#xA;               Heap Blocks: exact=5458&#xA;               -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..119.29 rows=66 width=0) (actual time=7.173..7.173 rows=7752 loops=1)&#xA;                     Index Cond: (family % &#39;GRANGER&#39;::text)&#xA; Planning Time: 0.297 ms&#xA; Execution Time: 19.887 ms&#xA;(12 rows)&#xA;&#xA;loxodata_text=# SELECT DISTINCT family FROM my_datas WHERE family %  &#39;GRANGER&#39;;&#xA;  family&#xA;----------&#xA; GRAND&#xA; GRANGE&#xA; GRANGER&#xA; GRANIER&#xA; GRAS&#xA; LAGRANGE&#xA;(6 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Cette recherche par similaritÃ© peut Ãªtre utile, votre serviteur en sait quelque chose avec son patronyme qui comporte un &amp;lsquo;B&amp;rsquo; muet et qui entraÃ®ne souvent moultes confusions lorsque je dois Ã©peler mon nom, et qui est donc Ã©crit souvent approximativement :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# SELECT DISTINCT family FROM my_datas WHERE family % &#39;LEFEBVRE&#39;;&#xA;  family&#xA;----------&#xA; LEFEBVRE&#xA; LEFEVRE&#xA; LEFEUVRE&#xA;(3 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;performances&#34;&gt;Performances&lt;/h3&gt;&#xA;&lt;p&gt;On peut voir que sur une recherche d&amp;rsquo;Ã©galitÃ©, ou bien sur une recherche de dÃ©but de chaÃ®ne, c&amp;rsquo;est l&amp;rsquo;index B-Tree qui est prÃ©fÃ©rÃ© par le planner :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family =  &#39;LEFEBVRE&#39;;&#xA;                                                           QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------------------&#xA; Index Only Scan using idx_test on my_datas  (cost=0.42..1370.94 rows=3801 width=7) (actual time=0.018..0.488 rows=4312 loops=1)&#xA;   Index Cond: (family = &#39;LEFEBVRE&#39;::text)&#xA;   Heap Fetches: 399&#xA; Planning Time: 0.340 ms&#xA; Execution Time: 0.615 ms&#xA;(5 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &#39;LEFEBVRE%&#39;;&#xA;                                                           QUERY PLAN&#xA;---------------------------------------------------------------------------------------------------------------------------------&#xA; Index Only Scan using idx_test on my_datas  (cost=0.42..1389.95 rows=3867 width=7) (actual time=0.010..0.729 rows=4312 loops=1)&#xA;   Index Cond: ((family ~&amp;gt;=~ &#39;LEFEBVRE&#39;::text) AND (family ~&amp;lt;~ &#39;LEFEBVRF&#39;::text))&#xA;   Filter: (family ~~ &#39;LEFEBVRE%&#39;::text)&#xA;   Heap Fetches: 399&#xA; Planning Time: 0.165 ms&#xA; Execution Time: 0.877 ms&#xA;(6 rows)&#xA;&#xA;loxodata_text=# drop index idx_test;&#xA;DROP INDEX&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Il est cependant important de noter que si l&amp;rsquo;index B-Tree est prÃ©fÃ©rÃ© sur la recherche en dÃ©but de chaÃ®ne ( &lt;code&gt;LIKE &#39;xxxx%&#39;&lt;/code&gt; ) c&amp;rsquo;est parce que la classe d&amp;rsquo;opÃ©rateurs &lt;code&gt;text_pattern_ops&lt;/code&gt; a Ã©tÃ© utilisÃ©e lors de la crÃ©ation de l&amp;rsquo;index. Si nous crÃ©ons un index B-Tree sans cette classe d&amp;rsquo;opÃ©rateurs, il sera prÃ©fÃ©rÃ© pour une recherche d&amp;rsquo;Ã©galitÃ©, mais pas pour une recherche de dÃ©but de chaÃ®ne du fait des problÃ¨mes complexes liÃ©s aux &lt;code&gt;LOCALES&lt;/code&gt; des diffÃ©rentes langues :&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# CREATE INDEX idx_test ON my_datas(family);&#xA;CREATE INDEX&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &#39;LEFEBVRE%&#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=139.26..7724.28 rows=3867 width=7) (actual time=2.370..5.048 rows=4312 loops=1)&#xA;   Recheck Cond: (family ~~ &#39;LEFEBVRE%&#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..138.29 rows=3867 width=0) (actual time=2.000..2.000 rows=4312 loops=1)&#xA;         Index Cond: (family ~~ &#39;LEFEBVRE%&#39;::text)&#xA; Planning Time: 0.162 ms&#xA; Execution Time: 5.179 ms&#xA;(7 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Si nous supprimons dÃ©finitivement l&amp;rsquo;index B-Tree, on voit que l&amp;rsquo;index sur les trigrammes est utilisÃ© efficacement pour une recherche d&amp;rsquo;Ã©galitÃ© (seulement aprÃ¨s PG v13) mais pas aussi efficacement qu&amp;rsquo;avec l&amp;rsquo;index B-Tree (coÃ»t estimÃ© 7666 vs 1370). Cependant ce coÃ»t est remarquablement constant que la recherche se fasse sur une Ã©galitÃ©, un dÃ©but de chaÃ®ne (&lt;code&gt;LIKE &#39;xxx%&#39;&lt;/code&gt;) ou une recherche sur une sous-chaÃ®ne (&lt;code&gt;LIKE &#39;%xxx%&#39;&lt;/code&gt;).&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family =  &#39;LEFEBVRE&#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=151.72..7666.35 rows=3801 width=7) (actual time=3.331..6.085 rows=4312 loops=1)&#xA;   Recheck Cond: (family = &#39;LEFEBVRE&#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..150.77 rows=3801 width=0) (actual time=2.961..2.962 rows=4312 loops=1)&#xA;         Index Cond: (family = &#39;LEFEBVRE&#39;::text)&#xA; Planning Time: 0.095 ms&#xA; Execution Time: 6.298 ms&#xA;(7 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &#39;LEFEBVRE%&#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=139.26..7724.28 rows=3867 width=7) (actual time=2.632..5.366 rows=4312 loops=1)&#xA;   Recheck Cond: (family ~~ &#39;LEFEBVRE%&#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..138.29 rows=3867 width=0) (actual time=2.263..2.263 rows=4312 loops=1)&#xA;         Index Cond: (family ~~ &#39;LEFEBVRE%&#39;::text)&#xA; Planning Time: 0.075 ms&#xA; Execution Time: 5.584 ms&#xA;(7 rows)&#xA;&#xA;loxodata_text=# EXPLAIN ANALYZE SELECT family FROM my_datas WHERE family like  &#39;%LEFEBVRE%&#39;;&#xA;                                                          QUERY PLAN&#xA;------------------------------------------------------------------------------------------------------------------------------&#xA; Bitmap Heap Scan on my_datas  (cost=109.52..7694.54 rows=3867 width=7) (actual time=1.628..4.402 rows=4312 loops=1)&#xA;   Recheck Cond: (family ~~ &#39;%LEFEBVRE%&#39;::text)&#xA;   Heap Blocks: exact=3544&#xA;   -&amp;gt;  Bitmap Index Scan on idx_test_trgm  (cost=0.00..108.55 rows=3867 width=0) (actual time=1.260..1.260 rows=4312 loops=1)&#xA;         Index Cond: (family ~~ &#39;%LEFEBVRE%&#39;::text)&#xA; Planning Time: 0.078 ms&#xA; Execution Time: 4.603 ms&#xA;(7 rows)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Si un champ texte fait l&amp;rsquo;objet d&amp;rsquo;une recherche d&amp;rsquo;Ã©galitÃ© dans une clause &lt;code&gt;WHERE&lt;/code&gt;, un index B-Tree est parfaitement adÃ©quat.&lt;/li&gt;&#xA;&lt;li&gt;Si un champ texte fait l&amp;rsquo;objet d&amp;rsquo;une recherche sur un dÃ©but de chaÃ®ne de type &lt;code&gt;WHERE champ LIKE &#39;ABC%&#39;&lt;/code&gt; , un index B-Tree est lÃ  encore adÃ©quat, Ã  condition de lui spÃ©cifier la classe d&amp;rsquo;opÃ©rateurs &lt;code&gt;text_pattern_ops&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Si un champ texte fait l&amp;rsquo;objet d&amp;rsquo;une recherche sur une sous-chaÃ®ne de type &lt;code&gt;WHERE champ LIKE &#39;%ABC%&#39;&lt;/code&gt; , seul un index GIN ou GiST sur les trigrammes sera utile.&lt;/li&gt;&#xA;&lt;li&gt;Lorsqu&amp;rsquo;un index sur les trigrammes a Ã©tÃ© crÃ©Ã©, dans la plupart des cas l&amp;rsquo;index B-Tree peut Ãªtre supprimÃ©. Cependant, du fait de la meilleure efficacitÃ© du B-Tree, il peut Ãªtre pertinent dans de rares occasions de conserver Ã©galement l&amp;rsquo;index B-Tree.&lt;/li&gt;&#xA;&lt;/ul&gt;</summary>
    <author>
      <name>Loxodata</name>
    </author>
  </entry>
  <entry>
    <title>Index &#34;Skip Scan&#34; avec PostgreSQL 18</title>
    <updated>2025-04-06T10:30:00Z</updated>
    <id>tag:pgphil.ovh,2025-04-06:/index_composite_18_01.php</id>
    <link href="https://pgphil.ovh/index_composite_18_01.php" rel="alternate"></link>
    <summary type="html">Mise Ã  jour de la page sur les index composites et les requÃªtes dont la clause de filtrage comprend des colonnes de l&#39;index mais pas la premiÃ¨re colonne. PostgreSQL 18 est Ã  prÃ©sent capable d&#39;effectuer des &#34;skip scan&#34;, de sauter la premiÃ¨re colonne et de tirer parti bien plus efficacement de l&#39;index composite b-tree dans certains cas.</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Mesurer facilement la latence I/O avec PostgreSQL 16</title>
    <updated>2023-09-02T16:30:00Z</updated>
    <id>tag:pgphil.ovh,2023-09-02:/traqueur_16_01.php</id>
    <link href="http://pgphil.ovh/traqueur_16_01.php" rel="alternate"></link>
    <summary type="html">DÃ©monstration avec le traqueur d&#39;une nouvelle fonctionnalitÃ© PostgreSQL 16 facilitant le suivi des performances et le diagnostic des ralentissements</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Mettre Ã  jour PostgreSQL pour amÃ©liorer les performances</title>
    <updated>2023-05-21T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-05-21:/migration_performance_14_15_01.php</id>
    <link href="http://pgphil.ovh/migration_performance_14_15_01.php" rel="alternate"></link>
    <summary type="html">Pagination, ex aequo...obtenez vos rÃ©sultats triÃ©s bien plus rapidement avec PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL inspire les autres SGBD ?</title>
    <updated>2023-04-12T09:00:00Z</updated>
    <id>tag:pgphil.ovh,2023-04-12:/oracle23c_ou_oracle23p_comme_postgresql.php</id>
    <link href="http://pgphil.ovh/oracle23c_ou_oracle23p_comme_postgresql.php" rel="alternate"></link>
    <summary type="html">Oracle 23c ou 23p comme PostgreSQL ?</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>CYCLE</title>
    <updated>2022-12-03T15:00:00Z</updated>
    <id>tag:pgphil.ovh,2022-12-03:/nocycle_15_01.php</id>
    <link href="http://pgphil.ovh/nocycle_15_01.php" rel="alternate"></link>
    <summary type="html">NouveautÃ©s autour des requÃªtes hiÃ©rarchiques avec PostgreSQL 14 et versions supÃ©rieures</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>MERGE</title>
    <updated>2022-03-29T17:30:00Z</updated>
    <id>tag:pgphil.ovh,2022-03-29:/upsert_15_devel_01.php</id>
    <link href="http://pgphil.ovh/upsert_15_devel_01.php" rel="alternate"></link>
    <summary type="html">Introduction de la commande MERGE par PostgreSQL 15</summary>
    <author>
      <name>pgphil.ovh</name>
    </author>
  </entry>
  <entry>
    <title>Substituer une variable dans un script SQL</title>
    <updated>2024-11-25T08:00:00Z</updated>
    <id>tag:fljd.in,2024-11-25:/2024/11/25/substituer-une-variable-dans-un-script-sql/</id>
    <link href="https://fljd.in/2024/11/25/substituer-une-variable-dans-un-script-sql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Il est frÃ©quent de vouloir automatiser une tÃ¢che rÃ©pÃ©titive en la scriptant&#xA;rapidement, puis Ã  force d&amp;rsquo;itÃ©rations, de l&amp;rsquo;enrichir, voire de l&amp;rsquo;intÃ©grer dans&#xA;la base de code d&amp;rsquo;un projet. Ã€ ce jeu, les outils comme SQL*Plus et psql peuvent&#xA;Ãªtre de puissants alliÃ©s et des interprÃ©teurs aussi pertinents que Bash ou&#xA;Python.&lt;/p&gt;&#xA;&lt;p&gt;Dans le cadre des projets de migration que je mÃ¨ne rÃ©guliÃ¨rement, il m&amp;rsquo;arrive de&#xA;tomber sur ces scripts, en grand nombre. Certains ont la particularitÃ© de&#xA;proposer des paramÃ¨tres d&amp;rsquo;entrÃ©e, traitÃ©s par SQL*Plus avec le mÃ©canisme trÃ¨s&#xA;confortable de substitution de variables. Dans cet article, je partage quelques&#xA;astuces pour convertir certains aspects de ces scripts grÃ¢ce aux fonctionnalitÃ©s&#xA;Ã©quivalentes que l&amp;rsquo;on retrouve sur l&amp;rsquo;outil psql de PostgreSQL.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Poissons et coquillages</title>
    <updated>2024-10-14T08:30:00Z</updated>
    <id>tag:fljd.in,2024-10-14:/2024/10/14/poissons-et-coquillages/</id>
    <link href="https://fljd.in/2024/10/14/poissons-et-coquillages/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;En tant que pur produit acadÃ©mique des annÃ©es 2010, mon langage de script de prÃ©dilection a&#xA;toujours Ã©tÃ© le Bash (&lt;em&gt;Bourne Again Shell&lt;/em&gt;). Non sans ignorer qu&amp;rsquo;il ait pu en exister d&amp;rsquo;autres, je&#xA;ne me suis jamais vraiment tournÃ© vers d&amp;rsquo;autres shells pour automatiser les tÃ¢ches du quotidien&#xA;dans mon mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;Et pour cause, j&amp;rsquo;ai administrÃ© des centaines de serveurs de distributions trÃ¨s variÃ©es et il&#xA;n&amp;rsquo;Ã©tait pas bien vu d&amp;rsquo;installer des dÃ©pendances systÃ¨mes lourdes pour enrichir des scripts Python&#xA;ou Perl. Nous apprenions donc Ã  Ã©crire des scripts portables et universels, compatibles partout&#xA;oÃ¹ nous dÃ©posions nos valises.&lt;/p&gt;&#xA;&lt;p&gt;Me suis-je enfermÃ© dans un dogme conservateur, en m&amp;rsquo;interdisant &lt;em&gt;de facto&lt;/em&gt; Ã  me tourner vers des&#xA;shells modernes et bien plus aisÃ©s Ã  apprÃ©henderÂ ?&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Les types hiÃ©rarchiques</title>
    <updated>2024-09-19T11:20:00Z</updated>
    <id>tag:fljd.in,2024-09-19:/2024/09/19/les-types-hierarchiques/</id>
    <link href="https://fljd.in/2024/09/19/les-types-hierarchiques/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Bien que la norme SQL dÃ©finisse un ensemble de rÃ¨gles pour que les systÃ¨mes de bases&#xA;de donnÃ©es puissent Ãªtre interchangeables, il existe de petites singularitÃ©s dans la&#xA;nature. Ã€ ce titre, le type de donnÃ©es &lt;code&gt;hierarchyid&lt;/code&gt; fourni par SQL Server est un&#xA;exemple flagrant. Si vous Ãªtes amenÃ© Ã  basculer vers PostgreSQL, deux solutions s&amp;rsquo;offrent&#xA;Ã  vous.&lt;/p&gt;&#xA;&lt;p&gt;Une premiÃ¨re et plus simple consiste Ã  lier chaque nÅ“ud Ã  son parent Ã  l&amp;rsquo;aide d&amp;rsquo;une nouvelle&#xA;colonne &lt;code&gt;parentid&lt;/code&gt; et d&amp;rsquo;y appliquer une contrainte de clÃ© Ã©trangÃ¨re. Une autre approche,&#xA;plus complÃ¨te, consiste Ã  utiliser l&amp;rsquo;extension &lt;code&gt;ltree&lt;/code&gt;. Cet article traite de ce dernier&#xA;cas.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Faire vivre une communautÃ©</title>
    <updated>2024-07-30T09:30:00Z</updated>
    <id>tag:fljd.in,2024-07-30:/2024/07/30/faire-vivre-une-communaute/</id>
    <link href="https://fljd.in/2024/07/30/faire-vivre-une-communaute/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Le &lt;a href=&#34;https://pgday.fr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PG Day France&lt;/a&gt; s&amp;rsquo;est tenu les 11 et 12 juin derniers Ã  Lille, ma ville natale.&#xA;Il s&amp;rsquo;agit de l&amp;rsquo;Ã©vÃ©nement de la communautÃ© franÃ§aise de PostgreSQL qui pose ses valises dans une&#xA;ville diffÃ©rente chaque annÃ©e. L&amp;rsquo;occasion Ã©tait trop belle pour moi et j&amp;rsquo;y ai rencontrÃ© de nombreuses&#xA;personnes venant de toute la France et de ses alentours, pour discuter de PostgreSQL au cours&#xA;de deux jours d&amp;rsquo;ateliers et de confÃ©rences.&lt;/p&gt;&#xA;&lt;p&gt;Pour cette Ã©dition, j&amp;rsquo;ai eu le plaisir de prendre la parole et de faire un retour d&amp;rsquo;expÃ©rience&#xA;sur l&amp;rsquo;animation du groupe Meetup local dont j&amp;rsquo;ai repris les rennes il y a maintenant quatre ans.&#xA;Dans cet article, je souhaite retranscrire les principaux points abordÃ©s lors de cette prÃ©sentation,&#xA;en attendant que la vidÃ©o de la confÃ©rence soit mise en ligne.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>Un assistant pour copier les donnÃ©es distantes</title>
    <updated>2024-05-28T00:00:00Z</updated>
    <id>tag:fljd.in,2024-05-28:/2024/05/28/un-assistant-pour-copier-les-donnees-distantes/</id>
    <link href="https://fljd.in/2024/05/28/un-assistant-pour-copier-les-donnees-distantes/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Lors de la derniÃ¨re &lt;a href=&#34;https://blog.dalibo.com/2023/12/08/pgsession16_programme.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGSession 16&lt;/a&gt;, j&amp;rsquo;ai rÃ©digÃ© et animÃ© un &lt;a href=&#34;https://dali.bo/wsfdw_html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;atelier&lt;/a&gt; de&#xA;trois heures au sujet de la migration vers PostgreSQL Ã  l&amp;rsquo;aide des Foreign Data&#xA;Wrappers, ou FDW. Ce fut notamment l&amp;rsquo;occasion de prÃ©senter au grand public,&#xA;l&amp;rsquo;extension &lt;a href=&#34;https://github.com/cybertec-postgresql/db_migrator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;db_migrator&lt;/code&gt;&lt;/a&gt; pour laquelle j&amp;rsquo;ai dÃ©diÃ© un &lt;a href=&#34;https://fljd.in/2023/07/28/en-route-vers-la-liberte-avec-db_migrator/&#34;&gt;article&lt;/a&gt; sur ce&#xA;blog.&lt;/p&gt;&#xA;&lt;p&gt;Au cours de cet atelier, nous pouvons constater que la copie des donnÃ©es avec&#xA;l&amp;rsquo;extension &lt;code&gt;db_migrator&lt;/code&gt; n&amp;rsquo;est pas parfaitement prise en charge. En effet, bien&#xA;qu&amp;rsquo;il existe une fonction de bas niveau pour rÃ©partir sur plusieurs processus le&#xA;transfert table Ã  table, de nombreuses situations devront exiger de rÃ©diger un&#xA;grand nombre de requÃªtes SQL pour se tirer d&amp;rsquo;affaire. Au cours des mois qui&#xA;suivirent, je me suis attelÃ© Ã  la conception d&amp;rsquo;un &lt;a href=&#34;https://github.com/fljdin/fdw-assistant&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;assistant&lt;/a&gt; Ã©crit en&#xA;PL/pgSQL dont le but est de simplifier la gÃ©nÃ©ration de ces requÃªtes.&lt;/p&gt;</summary>
    <author>
      <name>Florent Jardin</name>
    </author>
  </entry>
  <entry>
    <title>On analyse la nouvelle collation de PostgreSQL 17</title>
    <updated>2024-06-07T11:40:12Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-06-07:/2024/06/07/pg17-utf8-collation.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/06/07/pg17-utf8-collation.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL 17 est sorti en version bÃªta le 23 mai dernier, et dans ce billet on&#xA;va dÃ©tailler une de ses nouveautÃ©s: une collation interne gÃ©rant lâ€™UTF-8 avec des&#xA;comparaisons de texte en binaire.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les rapports de bugs de Postgres en 2023</title>
    <updated>2024-01-24T10:23:10Z</updated>
    <id>tag:blog-postgresql.verite.pro,2024-01-24:/2024/01/24/pgsql-bugs-annee-2023.html</id>
    <link href="https://blog-postgresql.verite.pro/2024/01/24/pgsql-bugs-annee-2023.html" rel="alternate"></link>
    <summary type="html">Une revue quantitative des rapports de bugs de Postgres en 2023</summary>
  </entry>
  <entry>
    <title>Classification des caractÃ¨res avec ICU</title>
    <updated>2023-06-11T14:32:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2023-06-11:/2023/06/11/caracteres-icu.html</id>
    <link href="https://blog-postgresql.verite.pro/2023/06/11/caracteres-icu.html" rel="alternate"></link>
    <summary type="html">Avec PostgreSQL 16 oÃ¹ ICU devient le fournisseur de collations par dÃ©faut, il y a quelques diffÃ©rences sÃ©mantiques Ã  anticiper dans la classification des caractÃ¨res. Cet article en dÃ©taille quelques-unes.</summary>
  </entry>
  <entry>
    <title>Isolation Repeatable Read avec PostgreSQL versus MySQL</title>
    <updated>2020-02-10T17:50:00Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-02-10:/2020/02/10/isolation-postgresql-vs-mysql.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/02/10/isolation-postgresql-vs-mysql.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Les moteurs SQL permettent aux transactions concurrentes dâ€™Ãªtre&#xA;isolÃ©es les unes des autres pour Ã©viter les interfÃ©rences.&#xA;Cette propriÃ©tÃ© dâ€™isolation correspond Ã  la lettre I de lâ€™acronyme&#xA;bien connu &lt;a href=&#34;https://fr.wikipedia.org/wiki/Propri%C3%A9t%C3%A9s_ACID&#34;&gt;â€œACIDâ€&lt;/a&gt;,&#xA;les autres propriÃ©tÃ©s Ã©tant AtomicitÃ©, CohÃ©rence&#xA;(&lt;em&gt;Consistency&lt;/em&gt; en anglais) et DurabilitÃ©.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Recherche et remplacement multiple avec plperl</title>
    <updated>2020-01-22T09:05:14Z</updated>
    <id>tag:blog-postgresql.verite.pro,2020-01-22:/2020/01/22/multi-replace.html</id>
    <link href="https://blog-postgresql.verite.pro/2020/01/22/multi-replace.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Remplacer une chaÃ®ne par une autre dans une chaÃ®ne plus large est simple&#xA;en SQL, avec la fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;replace&lt;/code&gt;:&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>Les collations non dÃ©terministes</title>
    <updated>2019-10-16T16:32:15Z</updated>
    <id>tag:blog-postgresql.verite.pro,2019-10-16:/2019/10/16/collations-non-deterministes.html</id>
    <link href="https://blog-postgresql.verite.pro/2019/10/16/collations-non-deterministes.html" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Depuis la version 12, les collations de PostgreSQL peuvent Ãªtre crÃ©Ã©es&#xA;avec un paramÃ¨tre nommÃ© &lt;strong&gt;deterministic&lt;/strong&gt;, qui peut Ãªtre vrai&#xA;ou faux, si bien que les collations  sont maintenant&#xA;soit &lt;strong&gt;dÃ©terministes&lt;/strong&gt; (ce quâ€™elles sont par dÃ©faut), soit&#xA;&lt;strong&gt;non dÃ©terministes&lt;/strong&gt;.&lt;/p&gt;</summary>
  </entry>
  <entry>
    <title>De retour du pgDay Paris 2024.</title>
    <updated>2024-03-18T09:39:28Z</updated>
    <id>tag:blog.anayrat.info,2024-03-18:/2024/03/18/de-retour-du-pgday-paris-2024./</id>
    <link href="https://blog.anayrat.info/2024/03/18/de-retour-du-pgday-paris-2024./" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Me voilÃ  rentrÃ© du pgDay Paris. Jâ€™ai beaucoup aimÃ© cette Ã©dition. Jâ€™Ã©tais dÃ©jÃ  venu Ã  celle de &lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2019/schedule/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2019&lt;/a&gt; et je dois dire que je nâ€™ai pas Ã©tÃ© dÃ©Ã§u. Pour rappel, le pgDay Paris est une confÃ©rence internationale. Les prÃ©sentations sont en anglais et permettent dâ€™attirer des orateurs et un public plus anglophone.&lt;/p&gt;&#xA;&lt;p&gt;Je vois souvent cette confÃ©rence comme un petit &lt;a href=&#34;https://www.postgresql.eu/events/series/pgconfeu-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGConf Europe&lt;/a&gt; : on retrouve un contenu assez riche avec la dimension internationale.&lt;/p&gt;&#xA;&lt;p&gt;On croise des tÃªtes dÃ©jÃ  connues : public, orateurs, bÃ©nÃ©voles, contributeurs : Tout ce petit monde qui fait vivre la communautÃ© Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Puis, câ€™est lâ€™occasion de mettre des visages sur des noms que lâ€™on croise en lisant des articles ou les mailing-list Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Voici un petit retour sur les confÃ©rences auxquelles jâ€™ai assistÃ© :&lt;/p&gt;&#xA;&lt;h1 id=&#34;elephant-in-a-nutshell---navigating-the-postgres-community-101&#34;&gt;Elephant in a nutshell - Navigating the Postgres community 101&lt;/h1&gt;&#xA;&lt;p&gt;Avec &lt;a href=&#34;https://2024.pgday.paris/organization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Carole et StÃ©phanie&lt;/a&gt;, on a pensÃ© que ce serait bien dâ€™avoir cette confÃ©rence en introduction.&lt;/p&gt;&#xA;&lt;p&gt;Je lâ€™ai trouvÃ© trÃ¨s complÃ¨te. Elle parle de Postgres, mais aussi et surtout de sa communautÃ©. Câ€™est ce qui fait sa force.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5293/slides/481/pgDay%20Paris_Valeria%27s%20talk%20-%20Elephant%20in%20a%20nutshell.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles.&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;sustainable-database-performance-profiling-in-postgresql&#34;&gt;Sustainable Database Performance profiling in PostgreSQL&lt;/h1&gt;&#xA;&lt;p&gt;Postgres dispose de nombreuses vues statistiques apportant des informations sur son fonctionnement.&lt;/p&gt;&#xA;&lt;p&gt;Elles peuvent Ãªtre natives (&lt;em&gt;pg_stat_statements&lt;/em&gt; â€¦) ou via des extensions &lt;em&gt;pg_stat_kcache&lt;/em&gt;, &lt;em&gt;pg_wait_sampling&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, et câ€™est ce que souligne cette confÃ©rence, elles apportent une vue Ã  un instant T.&lt;/p&gt;&#xA;&lt;p&gt;Pour les exploiter, il faut les historiser. Lâ€™orateur prÃ©sente un outil basÃ© sur ce qui se fait sur Oracle : &lt;a href=&#34;https://github.com/zubkov-andrei/pg_profile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pg_profile&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;En revanche, il le prÃ©sente comme lâ€™unique outil permettant dâ€™exploiter ces informations. Une personne dans le public lui a fait remarquer quâ€™il existait un autre projet : &lt;a href=&#34;https://powa.readthedocs.io/en/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PoWA&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Les deux outils ne fournissent pas les mÃªmes fonctions, &lt;em&gt;pg_profile&lt;/em&gt; gÃ©nÃ¨re un rapport HTML. Il est plutÃ´t facile Ã  installer, il ne nÃ©cessite pas de librairies externe car il est Ã©crit en pl/pgsql.&lt;/p&gt;&#xA;&lt;p&gt;PoWA apporte des graphes, de la suggestion dâ€™indexâ€¦ mais est plus lourd Ã  installer.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5067/slides/482/20240314_dkrautschick_PGdayParis_SustainableDatabasePerformanceProfilingInPostgreSQL.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgresql-without-permanent-local-data-storage&#34;&gt;PostgreSQL without permanent local data storage&lt;/h1&gt;&#xA;&lt;p&gt;LÃ , on rentre dans une confÃ©rence trÃ¨s technique. Matthias travaille sur le projet &lt;a href=&#34;https://neon.tech/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Neon&lt;/a&gt; et il participe rÃ©guliÃ¨rement sur les &lt;a href=&#34;https://www.postgresql.org/list/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mailing-list Postgres&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Neon est un fork opensource de Postgres visant Ã  sÃ©parer le &lt;em&gt;compute&lt;/em&gt; et le &lt;em&gt;storage&lt;/em&gt;. Câ€™est ce quâ€™a fait AWS avec le projet Aurora.&lt;/p&gt;&#xA;&lt;p&gt;Heikki Linnakangas, un des co-fondateurs de Neon et committer de Postgres a fait plusieurs prÃ©sentations :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=rES0yzeERns&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Neon: Serverless PostgreSQL! (Heikki Linnakangas)&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://neon.tech/blog/architecture-decisions-in-neon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Architecture decisions in Neon&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Matthias a prÃ©sentÃ© les diffÃ©rents problÃ¨mes que cela posait de vouloir sÃ©parer le stockage du reste du moteur. Câ€™est clairement un projet trÃ¨s ambitieux. Pour le moment, il est difficile de savoir si ce fork perdurera ou non.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, on peut souligner que les personnes travaillant dessus ont une trÃ¨s grande connaissance du moteur. On peut espÃ©rer que Ã§a ait des implications positives dans le projet Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Affaire Ã  suivreâ€¦&lt;/p&gt;&#xA;&lt;h1 id=&#34;lightning-talks&#34;&gt;Lightning Talks!&lt;/h1&gt;&#xA;&lt;p&gt;Les Lightning Talks sont une bonne occasion de balayer certains sujets un peu plus lÃ©gers. Ca passe plutÃ´t bien aprÃ¨s le repas. Câ€™est assez divertissant. Jâ€™ai bien aimÃ© la prÃ©sentation de LÃ©o Unbekandt sur lâ€™architecture des instances Postgres Ã  Scalingo. Pas de K8S, une architecture simple et Ã©prouvÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;Jâ€™ai aussi aimÃ© la prÃ©sentation de Chris Ellis oÃ¹ il fabrique un objet dÃ©coratif lumineux avec de lâ€™ESP32 dedans.&lt;/p&gt;&#xA;&lt;h1 id=&#34;multi-tenant-database-the-good-the-bad-the-ugly&#34;&gt;Multi-tenant database: the good, the bad, the ugly.&lt;/h1&gt;&#xA;&lt;p&gt;AprÃ¨s, les Lightning Talks, on retourne dans le vif du sujet avec cette prÃ©sentation de Pierre Ducroquet.&lt;/p&gt;&#xA;&lt;p&gt;Je connais bien Pierre, la premiÃ¨re fois que je lâ€™ai croisÃ©, câ€™Ã©tait au pgDay France 2016. Il avait fait une trÃ¨s bonne prÃ©sentation sur &lt;a href=&#34;https://2016.pgday.fr/programme.html#comprendre-requete-lente&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Comprendre pourquoi une requÃªte est lente, et comment rÃ©gler le soucis&lt;/a&gt;. Ensuite, Ã§a a Ã©tÃ© mon collÃ¨gue de travail pendant quelques annÃ©es oÃ¹ on a rencontrÃ© les problÃ¨mes que pouvaient poser les bases de donnÃ©es &lt;em&gt;multi-tenant&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Il prÃ©sente diffÃ©rentes faÃ§ons de faire du &lt;em&gt;multi-tenant&lt;/em&gt; avec les contraintes que cela implique. Il donne des chiffres assez impressionnants comme plus de 200 000 tables!&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.pinaraf.info/2024/03/look-ma-i-wrote-a-new-jit-compiler-for-postgresql/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelque chose me dit quâ€™on ne va pas tarder Ã  le revoir&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;beyond-b-trees-looking-at-columnar-storage-and-lsm-trees&#34;&gt;Beyond B-trees looking at Columnar Storage and LSM trees&lt;/h1&gt;&#xA;&lt;p&gt;Une autre confÃ©rence assez bas niveau sur le stockage colonne et les LSM Tree.&lt;/p&gt;&#xA;&lt;p&gt;Ce type de stockage peut effectivement faire partie du futur de Postgres. Le moteur commence Ã  Ãªtre utilisÃ© pour de plus en plus de projets analytiques oÃ¹ on manipule de gros volumes de donnÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Il faut donc des mÃ©thodes de stockage capable dâ€™encaisse des Ã©critures rapides.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgres-16-highlight-logical-decoding-on-standby&#34;&gt;Postgres 16 highlight: Logical decoding on standby&lt;/h1&gt;&#xA;&lt;p&gt;Une nouveautÃ© assez attendue sur Postgres 16 : La possibilitÃ© de faire du dÃ©codage logique sur un secondaire.&lt;/p&gt;&#xA;&lt;p&gt;Qui mieux quâ€™un des auteurs de cette fonctionnalitÃ© pour en parler ?&lt;/p&gt;&#xA;&lt;p&gt;Bertrand prÃ©sente les difficultÃ©s pour faire un dÃ©codage logique sur un secondaire, et comment elles ont Ã©tÃ© rÃ©solues.&lt;/p&gt;&#xA;&lt;p&gt;Il a aussi fait une dÃ©monstration. Câ€™est vraiment impressionnant, car câ€™est un sujet assez compliquÃ©.&lt;/p&gt;&#xA;&lt;p&gt;Point bonus, il explique aussi une nouveautÃ© de Postres 17 : la synchronisation des slots de rÃ©plication.&lt;/p&gt;&#xA;&lt;p&gt;Actuellement, on peut difficilement â€œraccrocherâ€ une rÃ©plication logique en cas de bascule. Il y a un risque de perte de transaction.&lt;/p&gt;&#xA;&lt;p&gt;Postgres 17 devrait permettre de synchroniser un slot de rÃ©plication. En cas de bascule, on peut reprendre la rÃ©plication.&#xA;On est chanceux, il vient tout juste dâ€™Ã©crire un article sur le sujet : &lt;a href=&#34;https://bdrouvot.github.io/2024/03/16/postgres-17-highlight-logical-replication-slots-synchronization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Postgres 17 highlight: Logical replication slots synchronization&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2024/sessions/session/5122/slides/483/pgdayParis2024.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Les slides sont disponibles&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;closing&#34;&gt;Closing&lt;/h1&gt;&#xA;&lt;p&gt;Câ€™Ã©tait la derniÃ¨re confÃ©rence de la journÃ©e. On a pu se retrouver pour le social event.&lt;/p&gt;&#xA;&lt;p&gt;Câ€™est un moment que jâ€™affectionne particuliÃ¨rement. Car au-delÃ  des confÃ©rences, câ€™est surtout une occasion dâ€™Ã©changer entre passionnÃ©s. De retrouver des connaissances et amis de longue date.&lt;/p&gt;&#xA;&lt;p&gt;Jâ€™ai rÃ©alisÃ© que jâ€™avais un peu dÃ©laissÃ© les confÃ©rences, entre le covid, mon passage en freelance etcâ€¦ A lâ€™avenir, jâ€™essaierai dâ€™Ãªtre plus prÃ©sent sur ce genre dâ€™Ã©vÃ¨nement (si je peux prendre le train).&lt;/p&gt;&#xA;&lt;h1 id=&#34;merci&#34;&gt;Merci&lt;/h1&gt;&#xA;&lt;p&gt;Jâ€™en profite aussi pour remercier les &lt;a href=&#34;https://2024.pgday.paris/organization/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;organisateurs et bÃ©nÃ©voles&lt;/a&gt;. On a du mal Ã  rÃ©aliser lâ€™investissement que Ã§a demande. Un grand merci Ã  eux pour cet Ã©vÃ¨nement !&lt;/p&gt;&#xA;&lt;p&gt;On se verra sÃ»rement au pgDay 2025 !&lt;/p&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Recommandations de lectures pour amÃ©liorer ses connaissances en base de donnÃ©es et PostgreSQL</title>
    <updated>2024-02-12T08:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-02-12:/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/</id>
    <link href="https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#fondamentaux-des-bases-de-donnÃ©es&#34;&gt;Fondamentaux des bases de donnÃ©es&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#the-manga-guide-to-databases&#34;&gt;The Manga Guide to Databases&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#database-design-for-mere-mortals&#34;&gt;Database Design for Mere Mortals&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-antipatterns&#34;&gt;SQL Antipatterns&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-for-smarties&#34;&gt;SQL for Smarties&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#the-art-of-sql&#34;&gt;The Art Of SQL&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#performance&#34;&gt;Performance&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#sql-performance-explained&#34;&gt;SQL Performance Explained&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#indexing-beyond-the-basics&#34;&gt;Indexing Beyond the Basics&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#postgresql&#34;&gt;PostgreSQL&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#practical-sql&#34;&gt;Practical SQL&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#postgresql---architecture-et-notions-avancÃ©es&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#learn-postgresql&#34;&gt;Learn PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#postgresql-14-internals&#34;&gt;PostgreSQL 14 Internals&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;p&gt;Je ne vais lister que quelques livres, mais je pourrais en citer pleins d&amp;rsquo;autres &amp;#x1f603; . J&amp;rsquo;espÃ¨re que Ã§a permettra Ã  plus de dÃ©veloppeurs, DBA, DEVOPS, CTO &amp;hellip; de mieux comprendre les bases de donnÃ©es et leurs enjeux.&lt;/p&gt;&#xA;&lt;h1 id=&#34;fondamentaux-des-bases-de-donnÃ©es&#34;&gt;Fondamentaux des bases de donnÃ©es&lt;/h1&gt;&#xA;&lt;h2 id=&#34;the-manga-guide-to-databases&#34;&gt;The Manga Guide to Databases&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-the-manga-guide-to-databases&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;manga&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_79a33cb973abaedb22e66948cdc60d80.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_c3accdb2c9ecf2675e6df1dee150cd9e.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/manga_hu5aa70ea30ae3275c65d27c3d87d1e70c_108868_79a33cb973abaedb22e66948cdc60d80.webp&#34;&#xA;               width=&#34;474&#34;&#xA;               height=&#34;626&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      The Manga Guide to Databases&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://nostarch.com/mg_databases.htm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Manga Guide to Databases&lt;/a&gt; est celui que je recommande dans la plupart de mes rapports d&amp;rsquo;audit.&lt;/p&gt;&#xA;&lt;p&gt;Il est vraiment gÃ©nial, facile Ã  lire et pour autant, il ne sacrifie pas le fond Ã  la forme.&lt;/p&gt;&#xA;&lt;p&gt;Il couvre un peu tous les aspects importants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ModÃ©lisation&lt;/li&gt;&#xA;&lt;li&gt;Ã‰criture de requÃªtes simples&lt;/li&gt;&#xA;&lt;li&gt;Grands principes des bases de donnÃ©es : transaction, isolation&amp;hellip;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;database-design-for-mere-mortals&#34;&gt;Database Design for Mere Mortals&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-database-design-for-mere-mortals&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;design&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_721347960fb63df78ab2314199294f15.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_2a81b8ec12f19038971875854feca26c.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/design_hue35134dfe8ede24af1874bb4631ce208_182026_721347960fb63df78ab2314199294f15.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Database Design for Mere Mortals&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.informit.com/store/database-design-for-mere-mortals-25th-anniversary-edition-9780136788041&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Database Design for Mere Mortals&lt;/a&gt; de &lt;em&gt;Michael J. Hernandez&lt;/em&gt; est, comme son nom l&amp;rsquo;indique, orientÃ© sur la modÃ©lisation.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est un gros pavÃ© de plus de 600 pages, mais il ne faut pas se laisser impressionner. Il se lit trÃ¨s bien, c&amp;rsquo;est bien vulgarisÃ© et l&amp;rsquo;auteur a fait attention  Ã  Ã©viter de s&amp;rsquo;embarquer dans la thÃ©orie qui peut parfois Ãªtre indigeste.&lt;/p&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai beaucoup aimÃ© le processus d&amp;rsquo;interviews pour construire le modÃ¨le de donnÃ©es, l&amp;rsquo;accent mis sur la documentation du modÃ¨le. Il  parle peu des formes normales, c&amp;rsquo;est un parti pris. Cependant, si on suit son processus, le modÃ¨le respecte bien les formes normales.&lt;/p&gt;&#xA;&lt;h2 id=&#34;sql-antipatterns&#34;&gt;SQL Antipatterns&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-antipatterns&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;antipatterns&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_c320047c4b1f0cff61ce38e7e7f6d3dc.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_0d0faf00cb44ab3739d2b4e20f0b205e.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/antipatterns_hu78d2e974f3c547630262f79e552a0ea6_2096124_c320047c4b1f0cff61ce38e7e7f6d3dc.webp&#34;&#xA;               width=&#34;633&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL Antipatterns&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://pragprog.com/titles/bksap1/sql-antipatterns-volume-1/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Antipatterns&lt;/a&gt; est un bon livre pour identifier les &lt;em&gt;anti-patterns&lt;/em&gt; et apporte des solutions.&#xA;Je m&amp;rsquo;en sers rÃ©guliÃ¨rement quand j&amp;rsquo;ai besoin d&amp;rsquo;expliquer ce qui ne va pas dans un modÃ¨le ou une requÃªte.&lt;/p&gt;&#xA;&lt;h2 id=&#34;sql-for-smarties&#34;&gt;SQL for Smarties&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-for-smarties&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;smarties&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_c6c3d9973032c4ac34459909ff559894.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_ca4d66cca791addd71955b48a3f29c2c.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/smarties_hua93406d09d9e5354756184b8dd00daf0_137495_c6c3d9973032c4ac34459909ff559894.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL for Smarties&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : AvancÃ©&lt;/p&gt;&#xA;&lt;p&gt;Comment ne pas mentionner les livres de &lt;a href=&#34;https://en.wikipedia.org/wiki/Joe_Celko&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Joe Celko&lt;/a&gt;.&#xA;Il a participÃ© au standard SQL et Ã©crit de &lt;a href=&#34;https://www.oreilly.com/pub/au/1919&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nombreux livres&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.sciencedirect.com/book/9780128007617/joe-celkos-sql-for-smarties&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL for Smarties&lt;/a&gt; fait partie&#xA;des rÃ©fÃ©rences en matiÃ¨re de SQL. La premiÃ¨re Ã©dition date de 1995&amp;hellip; oui&amp;hellip; presque 30 ans quand j&amp;rsquo;Ã©cris ces lignes !&#xA;La cinquiÃ¨me Ã©dition date de 2015, malgrÃ© ces 10 ans, le contenu est toujours d&amp;rsquo;actualitÃ©. On trouve mÃªme des ordres assez rÃ©cents comme &lt;code&gt;LATERAL&lt;/code&gt;, les &lt;em&gt;window functions&lt;/em&gt;, &lt;code&gt;CTE&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;On est aussi sur un gros pavÃ© de plus de 800 pages, le livre est trÃ¨s complet, assez exhaustif. Je dirai rÃ©servÃ© Ã  ceux qui veulent vraiment approfondir leurs connaissances en SQL.&lt;/p&gt;&#xA;&lt;p&gt;Ã€ noter qu&amp;rsquo;il existe une version en franÃ§ais basÃ© sur la seconde Ã©dition qui date de 2000, elle accuse un peu l&amp;rsquo;age : &lt;a href=&#34;https://www.decitre.fr/livres/sql-avance-9782711786367.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL AvancÃ©&lt;/a&gt;. On peut le trouver &lt;a href=&#34;https://www.momox-shop.fr/joe-celko-sql-avance-taschenbuch-M02841801411.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;d&amp;rsquo;occasion&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;the-art-of-sql&#34;&gt;The Art Of SQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-the-art-of-sql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;art&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_2bb5db8f1a45e313260bc7467bf92c17.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_ad989b301e7ba70987c52db0c9c535e3.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/art_hu3e5eba633759e8230aa87338f68d1a3b_220155_2bb5db8f1a45e313260bc7467bf92c17.webp&#34;&#xA;               width=&#34;579&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      The Art Of SQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : AvancÃ©&lt;/p&gt;&#xA;&lt;p&gt;Avec &lt;a href=&#34;https://www.oreilly.com/library/view/the-art-of/0596008945/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Art of SQL&lt;/a&gt; de &lt;a href=&#34;https://www.oreilly.com/pub/au/2005&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stephane Faroult&lt;/a&gt;, on change de catÃ©gorie. LÃ , on est sur du SQL plus avancÃ©.&#xA;Le livre va Ãªtre orientÃ© performances, bonnes pratiques. MalgrÃ© ses 18 ans, son contenu est toujours d&amp;rsquo;actualitÃ©. C&amp;rsquo;est un livre trÃ¨s puissant, il vous faudra du temps pour le lire et assimiler chaque page.&lt;/p&gt;&#xA;&lt;h1 id=&#34;performance&#34;&gt;Performance&lt;/h1&gt;&#xA;&lt;h2 id=&#34;sql-performance-explained&#34;&gt;SQL Performance Explained&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-sql-performance-explained&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;luke&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_d25868af42f9fe155d70736822260a43.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_c361959935046d9adedd33681287b70f.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/luke_hu753ac19229e8013f92d2513650643829_89166_d25868af42f9fe155d70736822260a43.webp&#34;&#xA;               width=&#34;480&#34;&#xA;               height=&#34;737&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      SQL Performance Explained&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;Impossible de ne pas mentionner l&amp;rsquo;excellent livre de &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Markus Winand&lt;/a&gt;, &lt;a href=&#34;https://sql-performance-explained.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Performance Explained&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Comme son titre l&amp;rsquo;indique, on va parler performance, indexation, Ã©criture de requÃªtes. Ã€ noter qu&amp;rsquo;il a Ã©galement Ã©tÃ© traduit en plusieurs langues : Allemand, Espagnol, Japonais et FranÃ§ais grÃ¢ce Ã  Guillaume Lelarge &lt;a href=&#34;https://sql-au-coeur-des-performances.fr/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL : Au cÅ“ur des performances&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Le contenu du livre est Ã©galement disponible sur son site &lt;a href=&#34;https://use-the-index-luke.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Use the Index, Luke !&lt;/a&gt;. Markus est aussi l&amp;rsquo;auteur d&amp;rsquo;un excellent site sur les fonctionnalitÃ©s avancÃ©s du SQL : &lt;a href=&#34;https://modern-sql.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL&lt;/a&gt;. Lors de l&amp;rsquo;Ã©mission &lt;a href=&#34;https://youtu.be/mGqqQg-dG-w?si=he4R6eTC_2VckAVA&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL sur Postgres.FM&lt;/a&gt;, il a annoncÃ© la volontÃ© d&amp;rsquo;en faire un livre. J&amp;rsquo;ai hÃ¢te ! Il a aussi fait de nombreuses &lt;a href=&#34;https://winand.at/sql-slides-for-developers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prÃ©sentations&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;indexing-beyond-the-basics&#34;&gt;Indexing Beyond the Basics&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-indexing-beyond-the-basics&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;indexing&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_cd04fe528416e6d69ed46ae57835a97e.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_7b7f71022bce674d799dc5af2cfdb5cb.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/indexing_hu4ec3b1968fb5d81fd5627bea5287bed7_530622_cd04fe528416e6d69ed46ae57835a97e.webp&#34;&#xA;               width=&#34;668&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Indexing Beyond the Basics&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant - IntermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://sqlfordevs.com/ebooks/indexing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Indexing Beyond the Basics&lt;/a&gt; est un e-book orientÃ© sur les index. Un point intÃ©ressant est qu&amp;rsquo;il mentionne aussi pourquoi le moteur n&amp;rsquo;utilise pas un index.&lt;/p&gt;&#xA;&lt;h1 id=&#34;postgresql&#34;&gt;PostgreSQL&lt;/h1&gt;&#xA;&lt;h2 id=&#34;practical-sql&#34;&gt;Practical SQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-practical-sql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;practical&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_c3df0446f9f62391d13c57dd10ec2e89.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_f2aecb321cb118f7fb40dddd50422be5.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_1200x1200_fit_q75_h2_lanczos_2.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/practical_hu01f19f83ea7b9b959997133246dda201_161098_c3df0446f9f62391d13c57dd10ec2e89.webp&#34;&#xA;               width=&#34;477&#34;&#xA;               height=&#34;630&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Practical SQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : DÃ©butant - intermÃ©diaire&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://nostarch.com/practical-sql-2nd-edition/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Practical SQL&lt;/a&gt; est un super livre pour quelqu&amp;rsquo;un qui dÃ©bute sur Postgres. Il parle d&amp;rsquo;un peu de tout, du SQL jusqu&amp;rsquo;aux types avancÃ©s. Comment utiliser le SQL pour analyser des donnÃ©es, faire du &lt;em&gt;full text search&lt;/em&gt;, opÃ©ration d&amp;rsquo;administration&amp;hellip;&lt;/p&gt;&#xA;&lt;h2 id=&#34;postgresql---architecture-et-notions-avancÃ©es&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-postgresql---architecture-et-notions-avancÃ©es&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;architecture&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_8da2fb9ff08beb89b92a47f2af0154cc.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_504568017e4d0ef28b5f0f36871185ec.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/architecture_hu4e070f54fbcfe012d689b7262a78d531_408340_8da2fb9ff08beb89b92a47f2af0154cc.webp&#34;&#xA;               width=&#34;559&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      PostgreSQL - Architecture et notions avancÃ©es&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Niveau : IntermÃ©diaire - avancÃ©&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.d-booker.fr/bases-de-donnees/805-1338-postgresql-architecture-et-notions-avancees-5ed.html#/21-option-consultation_en_ligne&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL - Architecture et notions avancÃ©es&lt;/a&gt; par Guillaume Lelarge et Julien Rouhaud est &lt;strong&gt;le&lt;/strong&gt; livre que je recommande pour qui veut comprendre comment fonctionne Postgres. Mon seul regret est qu&amp;rsquo;il ne soit pas traduit en anglais pour en faire profiter plus de lecteurs.&lt;/p&gt;&#xA;&lt;p&gt;Ã€ noter aussi qu&amp;rsquo;il est mis Ã  jour tous les ans.&lt;/p&gt;&#xA;&lt;h2 id=&#34;learn-postgresql&#34;&gt;Learn PostgreSQL&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-learn-postgresql&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;learn&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_2e08c564415b06ee6ac817f7ac0914b0.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_c22b1c79c1fe1d43eb51d2ce83b5ee11.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/learn_hu00fe0c0efabc0ae6d85710a22f715230_111765_2e08c564415b06ee6ac817f7ac0914b0.webp&#34;&#xA;               width=&#34;616&#34;&#xA;               height=&#34;760&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      Learn PostgreSQL&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.packtpub.com/product/learn-postgresql-second-edition/9781837635641&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Learn PostgreSQL&lt;/a&gt; par Lucas Ferrari et Enrico Pirozzi est un livre trÃ¨s complet sur l&amp;rsquo;administration de Postgres. Un &lt;em&gt;must have&lt;/em&gt; pour un DBA.&lt;/p&gt;&#xA;&lt;p&gt;Pour les francophones, vous pouvez vous orienter vers &lt;a href=&#34;https://www.editions-eni.fr/livre/postgresql-administration-et-exploitation-de-vos-bases-de-donnees-4e-edition-9782409011467&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL Administration et exploitation de vos bases de donnÃ©es&lt;/a&gt; de SÃ©bastien LardiÃ¨re.&lt;/p&gt;&#xA;&lt;h2 id=&#34;postgresql-14-internals&#34;&gt;PostgreSQL 14 Internals&lt;/h2&gt;&#xA;&lt;p&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;figure  id=&#34;figure-postgresql-14-internals&#34;&gt;&#xA;  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;&#xA;    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;internals&#34; srcset=&#34;&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_8639f0d8b0e15fe8fb464f6e5412e100.webp 400w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_3d76ec668fd76ab0113449dbb278d740.webp 760w,&#xA;               /2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_1200x1200_fit_q75_h2_lanczos.webp 1200w&#34;&#xA;               src=&#34;https://blog.anayrat.info/2024/02/12/recommandations-de-lectures-pour-ameliorer-ses-connaissances-en-base-de-donnees-et-postgresql/internals_hu8a8cf4e0b43f0fa4f74d2b36d2f27852_60433_8639f0d8b0e15fe8fb464f6e5412e100.webp&#34;&#xA;               width=&#34;384&#34;&#xA;               height=&#34;552&#34;&#xA;               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;&#xA;  &lt;/div&gt;&lt;figcaption&gt;&#xA;      PostgreSQL 14 Internals&#xA;    &lt;/figcaption&gt;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://postgrespro.com/community/books/internals&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL 14 Internals&lt;/a&gt; par Egor Rogov est un livre sur les entrailles de Postgres. Il est vraiment trÃ¨s complet. Un grand merci Ã  lui de le mettre Ã  disposition en accÃ¨s libre.&lt;/p&gt;&#xA;&lt;p&gt;Dans le mÃªme style, il existe un site &lt;a href=&#34;https://www.interdb.jp/pg/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Internals of PostgreSQL&lt;/a&gt; par Hironobu SUZUKI.&lt;/p&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Postgres Ã  nouveau Ã©lu SGBD de l&#39;annÃ©e en 2023, mais je suis inquiet</title>
    <updated>2024-02-05T08:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-02-05:/2024/02/05/postgres-a-nouveau-elu-sgbd-de-lannee-en-2023-mais-je-suis-inquiet/</id>
    <link href="https://blog.anayrat.info/2024/02/05/postgres-a-nouveau-elu-sgbd-de-lannee-en-2023-mais-je-suis-inquiet/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cette annÃ©e encore, Postgres a Ã©tÃ© Ã©lu SGBD de l&amp;rsquo;annÃ©e par &lt;a href=&#34;https://db-engines.com/en/blog_post/106&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DB-Engines&lt;/a&gt;. MÃªme si ce n&amp;rsquo;est qu&amp;rsquo;un classement, cela donne une tendance. Cela fait aussi plusieurs annÃ©es qu&amp;rsquo;il est reconnu selon&#xA;les sondages de Stackoverflow : &lt;a href=&#34;https://survey.stackoverflow.co/2023/#section-most-popular-technologies-databases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Most popular Databases&lt;/a&gt;.&#xA;C&amp;rsquo;est un SGBD trÃ¨s apprÃ©ciÃ©, tant par les dÃ©veloppeurs, que par les DBA chevronnÃ©s&amp;hellip; Mais aussi par les directeurs qui y trouvent une stabilitÃ©&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Postgres a tout pour sÃ©duire :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AnnÃ©e aprÃ¨s annÃ©e, de nouvelles fonctionnalitÃ©s sont rajoutÃ©es. Je pense notamment Ã  : la parallÃ©lisation, le partitionnement, la rÃ©plication logique&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;Il a su, depuis toujours, garder sa fiabilitÃ©.&lt;/li&gt;&#xA;&lt;li&gt;Sa communautÃ© n&amp;rsquo;a fait que grandir. Les confÃ©rences dÃ©diÃ©es Ã  Postgres battent des records d&amp;rsquo;affluence tous les ans.&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est devenu un standard, mÃªme pour les autres logiciels : les Ã©diteurs rajoutent mÃªme le support du protocole Postgres pour faciliter leur intÃ©gration : Aurora, AlloyDB, QuestDB&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est un des rares projets de cette envergure Ã  Ãªtre communautaire. On a pu voir qu&amp;rsquo;il ne suffit pas que le projet soit opensource, il faut aussi compter sur la communautÃ© et son Ã©cosystÃ¨me.&lt;/li&gt;&#xA;&lt;li&gt;Il est supportÃ© par les gros acteurs : les GAFAM emploient de nombreux committers et contributeurs. Ils sponsorisent Ã©galement les confÃ©rences. Par exemple, le prochain &lt;a href=&#34;https://2024.pgday.paris/sponsors/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pgDay Paris est sponsorisÃ© par Microsoft&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cependant, je suis un peu inquiet pour le futur. Non pas pour PostgreSQL. Bruce Momjian a fait plusieurs prÃ©sentations sur ce sujet :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/challenges.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Future Postgres Challenges&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/forever.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Will Postgres Live Forever?&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://momjian.us/main/writings/pgsql/past_present_future.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL: Past, Present, and Future&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;C&amp;rsquo;est mÃªme le sujet de la Keynote d&amp;rsquo;ouverture du dernier PGConf Europe : &lt;a href=&#34;https://www.youtube.com/watch?v=8W-J36IxYv4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Simon Riggs: The Next 20 Years (PGConf.EU 2023)&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Non, je suis plutÃ´t inquiet sur la perte de connaissance du mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;A quoi servira Postgres si on ne sait pas l&amp;rsquo;utiliser correctement ?&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#un-peu-dhistoire&#34;&gt;Un peu d&amp;rsquo;histoire&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#quest-ce-quon-oublie-&#34;&gt;Qu&amp;rsquo;est-ce qu&amp;rsquo;on oublie ?&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#oui-mais-le-cloud&#34;&gt;Oui, mais le cloud!&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#on-oublie-le-mÃ©tier-de-dba&#34;&gt;On oublie le mÃ©tier de DBA&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#on-oublie-le-passÃ©&#34;&gt;On oublie le passÃ©&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#le-code-change-la-donnÃ©e-reste&#34;&gt;Le code change, la donnÃ©e reste&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#il-faut-quelques-minutes-pour-prendre-une-mauvaise-dÃ©cision-sur-une-base-de-donnÃ©e&#34;&gt;Il faut quelques minutes pour prendre une mauvaise dÃ©cision sur une base de donnÃ©e&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#lusage-du-cloud&#34;&gt;L&amp;rsquo;usage du cloud&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#ce-quil-faudrait-changer&#34;&gt;Ce qu&amp;rsquo;il faudrait changer&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#pour-conclure&#34;&gt;Pour conclure&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;un-peu-dhistoire&#34;&gt;Un peu d&amp;rsquo;histoire&lt;/h1&gt;&#xA;&lt;p&gt;Par le passÃ©, il y avait une spÃ©cialisation forte des compÃ©tences : dÃ©veloppeurs, testeurs, DBA Ã©tude, DBA prod, ingÃ©nieur systÃ¨me, ingÃ©nieur stockage, ingÃ©nieur sauvegarde&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Chaque spÃ©cialitÃ© Ã©voluait un peu dans sa bulle, ce qui compliquait la collaboration avec des cycles de dÃ©veloppement longs.&lt;/p&gt;&#xA;&lt;p&gt;Cette organisation a laissÃ© place Ã  une nouvelle faÃ§on de travailler : dÃ©veloppeurs &lt;em&gt;fullstack&lt;/em&gt;, &lt;em&gt;DEVOPS/SRE&lt;/em&gt;, des data &amp;ldquo;quelque chose&amp;rdquo; (engineer, analyst, steward&amp;hellip;).&lt;/p&gt;&#xA;&lt;p&gt;Les compÃ©tences se sont diluÃ©es sur les diffÃ©rents mÃ©tiers. Je croise de plus en plus rarement des DBA.&lt;/p&gt;&#xA;&lt;p&gt;A la place, la base de donnÃ©e est &lt;em&gt;gÃ©rÃ©e&lt;/em&gt; par les dÃ©veloppeurs. Ou, si on a un peu de chance, par des &amp;ldquo;data engineer&amp;rdquo; ou &amp;ldquo;data analyst&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;AprÃ¨s plusieurs annÃ©es, alors que je baigne dedans, j&amp;rsquo;ai encore du mal Ã  dÃ©finir ces mÃ©tiers.&lt;/p&gt;&#xA;&lt;p&gt;Le constat : bonne connaissance du python, monte des pipelines, on assemble en quelque sorte des Legos avec pleins d&amp;rsquo;outils : airflow, dbt&amp;hellip; Puis, on envoie ces donnÃ©es dans du Redshift, Biquery, Snowflake&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Cependant, j&amp;rsquo;ai l&amp;rsquo;impression que la connaissance du SQL s&amp;rsquo;appauvrit Ã  cause des couches d&amp;rsquo;abstraction.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Du moment oÃ¹ on manipule de la donnÃ©e, la premiÃ¨re des compÃ©tences Ã  avoir, devrait Ãªtre la maitrise du SQL.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;quest-ce-quon-oublie-&#34;&gt;Qu&amp;rsquo;est-ce qu&amp;rsquo;on oublie ?&lt;/h1&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai le sentiment, qu&amp;rsquo;annÃ©e aprÃ¨s annÃ©e, on oublie le mÃ©tier de DBA.&lt;/p&gt;&#xA;&lt;p&gt;Pour rappel, ce dernier va Ãªtre Ã  la croisÃ©e de plusieurs chemins :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Il a des compÃ©tences pures sur la base de donnÃ©es :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ModÃ©lisation.&lt;/li&gt;&#xA;&lt;li&gt;Maitrise du SQL.&lt;/li&gt;&#xA;&lt;li&gt;Maitrise du SGBD : connait le fonctionnement du moteur (&lt;em&gt;vacuum&lt;/em&gt;, &lt;em&gt;checkpoint&lt;/em&gt; &amp;hellip;). Comprend les mÃ©canismes de verrouillages (&lt;em&gt;MVCC&lt;/em&gt;, &lt;em&gt;locks&lt;/em&gt;&amp;hellip;).&lt;/li&gt;&#xA;&lt;li&gt;Conserve une veille technique : le Postgres que j&amp;rsquo;ai connu Ã  mes dÃ©buts est trÃ¨s loin du Postgres actuel.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Mais Ã©galement des compÃ©tences plus transverses :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Avoir une bonne connaissance systÃ¨me pour investiguer sur les problÃ¨mes de performance, dimensionner les ressources.&lt;/li&gt;&#xA;&lt;li&gt;Un vernis en dÃ©veloppement pour comprendre les besoins des dÃ©veloppeurs et pouvoir les accompagner.&lt;/li&gt;&#xA;&lt;li&gt;De la culture &amp;ldquo;computer science&amp;rdquo;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;oui-mais-le-cloud&#34;&gt;Oui, mais le cloud!&lt;/h1&gt;&#xA;&lt;p&gt;On pourrait penser que le cloud a rebattu les cartes et qu&amp;rsquo;on n&amp;rsquo;a plus besoin de DBA. Dans la liste que j&amp;rsquo;ai donnÃ©e ci-dessus, quelles compÃ©tences sont couvertes par le cloud ?&lt;/p&gt;&#xA;&lt;p&gt;Le cloud rÃ©sout une partie des besoins : hÃ©bergement, maintenance, rÃ©seau, monitoring (qu&amp;rsquo;il faut souvent complÃ©ter avec un APM ou un Datadog like).&#xA;Et il rajoute d&amp;rsquo;autres problÃ¨mes :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Il faut rajouter un mÃ©tier de &lt;a href=&#34;https://lota.cloud/finops-cloud-2/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FinOps&lt;/a&gt; pour maitriser et optimiser les dÃ©penses.&lt;/li&gt;&#xA;&lt;li&gt;C&amp;rsquo;est parfois une boite noire et il peut Ãªtre difficile d&amp;rsquo;investiguer sur des problÃ¨mes de performance&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Cet excellent article de Markus Winand prÃ©sente aussi d&amp;rsquo;autres inconvÃ©nients : &lt;a href=&#34;https://winand.at/newsletter/2024-01/clouds-bring-rain&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sometimes Clouds Bring Rain&lt;/a&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Changer de cloud provider est difficile. Je dirais mÃªme que c&amp;rsquo;est volontaire de leur part.&lt;/li&gt;&#xA;&lt;li&gt;Les coÃ»ts peuvent changer &lt;em&gt;Just because it is cheap today doesnâ€™t mean it will be cheap forever&lt;/em&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Il faut prÃ©voir un plan de sortie : Ã©viter les services propriÃ©taires, conserver un faible nombre de services.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Car une fois dans le cloud, qui s&amp;rsquo;occupe de : la modÃ©lisation, l&amp;rsquo;optimisation des requÃªtes, l&amp;rsquo;indexation, la veille technique sur le SGBD&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;, l&amp;rsquo;investigation sur les performances, comprendre les problÃ¨mes de verrouillages, l&amp;rsquo;accompagnement des dÃ©veloppeurs ?&lt;/p&gt;&#xA;&lt;p&gt;Ceci est confirmÃ© dans mes audits, je vois rÃ©guliÃ¨rement des problÃ¨mes trÃ¨s basiques :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Absence de clÃ© primaire.&lt;/li&gt;&#xA;&lt;li&gt;Pas d&amp;rsquo;index sur des cas trÃ¨s simples.&lt;/li&gt;&#xA;&lt;li&gt;Aucun respect des formes normales, mÃªme les plus basiques. Le JSON n&amp;rsquo;a pas arrangÃ© les choses.&lt;/li&gt;&#xA;&lt;li&gt;RequÃªtes spaghetti.&lt;/li&gt;&#xA;&lt;li&gt;Des jointures faÃ§on SQL-89 alors que Ã§a fait plus de 30 ans que le mot clÃ© &lt;code&gt;JOIN&lt;/code&gt; existe.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;S&amp;rsquo;il faut retenir une chose : &lt;strong&gt;Le cloud ne permet pas de s&amp;rsquo;affranchir du DBA. Ce n&amp;rsquo;est pas parce qu&amp;rsquo;on peut obtenir les clÃ©s d&amp;rsquo;un avion, qu&amp;rsquo;on sait le piloter.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Un article intÃ©ressant sur le nombre de DBA dont vous avez besoin : &lt;a href=&#34;https://www.bytebase.com/blog/how-many-dbas-should-a-company-hire/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How many DBAs should a company hire?&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;on-oublie-le-mÃ©tier-de-dba&#34;&gt;On oublie le mÃ©tier de DBA&lt;/h1&gt;&#xA;&lt;p&gt;On pourrait naÃ¯vement penser qu&amp;rsquo;on confie ces tÃ¢ches Ã  des DBA experts, mais j&amp;rsquo;ai de plus en plus de doutes. J&amp;rsquo;ai l&amp;rsquo;impression &amp;ldquo;qu&amp;rsquo;on&amp;rdquo; est en train de perdre la connaissance d&amp;rsquo;un mÃ©tier.&#xA;J&amp;rsquo;ai dÃ©jÃ  croisÃ© des dÃ©veloppeurs expÃ©rimentÃ©s qui ne savaient mÃªme pas que le mÃ©tier de DBA existait.&#xA;Des recruteurs qui me demandaient si en tant que DBA, je savais optimiser des requÃªtes et si je connaissais le SQL. C&amp;rsquo;est mon mÃ©tier ! C&amp;rsquo;est un peu comme demander Ã  un plombier s&amp;rsquo;il sait changer un robinet !&lt;/p&gt;&#xA;&lt;p&gt;Ce qui est d&amp;rsquo;autant plus alarmant, c&amp;rsquo;est que je crains qu&amp;rsquo;il y ait aussi des CTO qui ont aussi cette mÃ©connaissance de la donnÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;La consÃ©quence est qu&amp;rsquo;en cas de problÃ¨me de performance, on ne fait qu&amp;rsquo;augmenter les ressources des instances.&#xA;Avec le cloud, la facture croÃ®t linÃ©airement avec la taille de l&amp;rsquo;instance.&#xA;Si la croissance de la charge est exponentielle, il faudra scaler la base et la facture qui va avec. On se retrouve avec une facture exponentielle.&lt;/p&gt;&#xA;&lt;p&gt;Quand on n&amp;rsquo;arrive plus Ã  s&amp;rsquo;en sortir, on va accuser l&amp;rsquo;outil ou le modÃ¨le, donc on va changer de SGBD ou aller vers du NoSQL. Spoiler : Ã§a ne rÃ©soudra pas vos problÃ¨mes.&lt;/p&gt;&#xA;&lt;h1 id=&#34;on-oublie-le-passÃ©&#34;&gt;On oublie le passÃ©&lt;/h1&gt;&#xA;&lt;p&gt;Pendant un temps, j&amp;rsquo;ai voulu Ã©crire un livre pour parler optimisation de requÃªte, des erreurs courantes que je rencontre, etc.&lt;/p&gt;&#xA;&lt;p&gt;En regardant ma bibliothÃ¨que, elle est pleine de livres de ce genre. Ils ont pour la plupart entre 10 et 30 ans et le contenu est toujours d&amp;rsquo;actualitÃ©. A quoi servirait un Ã©niÃ¨me livre s&amp;rsquo;il n&amp;rsquo;est pas connu ?&lt;/p&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai un autre exemple en tÃªte : les data warehouse (DWH). Ce terme devient de plus en plus galvaudÃ©.&#xA;La construction d&amp;rsquo;un DWH est complexe, il faut passer par une phase de modÃ©lisation afin de stocker correctement les donnÃ©es. Cela permet de bonnes performances et facilite l&amp;rsquo;Ã©criture&#xA;des requÃªtes analytiques.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant, je croise rÃ©guliÃ¨rement des &amp;ldquo;data warehouse&amp;rdquo; qui se rÃ©sument Ã  envoyer toutes les donnÃ©es dans un SGBD spÃ©cialisÃ© (redshift, biquery &amp;hellip;). Sans travail de modÃ©lisation et avec des requÃªtes trÃ¨s mal Ã©crites, parfois gÃ©nÃ©rÃ©es, car les utilisateurs ne savent pas faire du SQL.&lt;/p&gt;&#xA;&lt;p&gt;Ces services coÃ»tent trÃ¨s cher et ne font pas de miracle s&amp;rsquo;il n&amp;rsquo;y a pas eu un travail approfondi de modÃ©lisation et d&amp;rsquo;optimisation.&lt;/p&gt;&#xA;&lt;p&gt;Pourtant, les livres sur les DWH et le SQL ont entre 10 et 30 ans. A cette Ã©poque, le cloud n&amp;rsquo;existait pas, les SSD non plus, les CPU avec plusieurs coeurs non plus.&#xA;Pourtant, on savait construire des DWH, faire des sites performants&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Il ne faudrait pas que le cloud nous fasse oublier tout cet hÃ©ritage. Sinon, on risque de payer la dette technique et la perte de connaissance trÃ¨s cher, avec les intÃ©rÃªts en plus.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Il faut avoir en tÃªte que mÃªme si le SQL a Ã©voluÃ©, les SGBD gagnÃ©s en fonctionnalitÃ©s, &lt;strong&gt;les principes fondateurs sont toujours justes&lt;/strong&gt;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;le-code-change-la-donnÃ©e-reste&#34;&gt;Le code change, la donnÃ©e reste&lt;/h1&gt;&#xA;&lt;p&gt;J&amp;rsquo;ai eu un super manager, ancien DBA, qui expliquait aux dÃ©veloppeurs : tu n&amp;rsquo;es pas ici pour &amp;ldquo;produire du code&amp;rdquo; =&amp;gt; yeux Ã©carquillÃ©s du dÃ©veloppeur.&#xA;&amp;ldquo;tu es lÃ  pour produire et manipuler de la donnÃ©e.&amp;rdquo;&lt;/p&gt;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;il y avait une dÃ©cision compliquÃ©e. Par exemple, prendre plus de temps pour revoir le code applicatif, faire une migration plus compliquÃ©e, plutÃ´t qu&amp;rsquo;une solution&#xA;&amp;ldquo;quick win&amp;rdquo;. Ce mÃªme manager expliquait :&amp;quot;&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;D&amp;rsquo;ici 5-10 ans, ton code aura Ã©tÃ© rÃ©Ã©crit plusieurs fois, peut-Ãªtre mÃªme dans un autre langage.&#xA;Nous, la donnÃ©e, dans 50 ans, elle sera toujours lÃ . C&amp;rsquo;est notre devoir de nous assurer qu&amp;rsquo;elle sera toujours exploitable.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h1 id=&#34;il-faut-quelques-minutes-pour-prendre-une-mauvaise-dÃ©cision-sur-une-base-de-donnÃ©e&#34;&gt;Il faut quelques minutes pour prendre une mauvaise dÃ©cision sur une base de donnÃ©e&lt;/h1&gt;&#xA;&lt;p&gt;&lt;em&gt;Et parfois plusieurs mois / annÃ©es pour la corriger.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Il m&amp;rsquo;est arrivÃ© de faire des audits oÃ¹ le modÃ¨le Ã©tait catastrophique. Il avait Ã©voluÃ© de solutions Ã  court terme en d&amp;rsquo;autres solutions Ã  court terme.&#xA;&amp;ldquo;On corrigera plus tard, il faut faire passer cette fonctionnalitÃ© dans le sprint&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;Un DBA peut corriger le modÃ¨le de donnÃ©es Ã  coup de grosses migrations (encore faut-il avoir un DBA, difficile si on ignore que ce mÃ©tier existe&amp;hellip;).&#xA;Au-delÃ  de Ã§a, le problÃ¨me va se poser autour : il faut rÃ©Ã©crire une grosse partie du code applicatif (qui est souvent dans le mÃªme Ã©tat que la base).&lt;/p&gt;&#xA;&lt;p&gt;Parfois, la complexitÃ© est quadratique ou exponentielle. Il vaut mieux tout jeter pour tout recommencer.&lt;/p&gt;&#xA;&lt;p&gt;On se retrouve face Ã  plusieurs dilemmes :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Augmenter la taille des instances.&lt;/li&gt;&#xA;&lt;li&gt;Parfois, cette solution n&amp;rsquo;est pas suffisante. J&amp;rsquo;explique : &amp;ldquo;lÃ , vous pouvez faire encore fois dix sur la taille de l&amp;rsquo;instance, mais vous ne pourrez jouer cette carte qu&amp;rsquo;une fois&amp;rdquo;. Notez que cette solution est inutile si le traitement ne peut pas Ãªtre parallÃ©lisÃ©.&lt;/li&gt;&#xA;&lt;li&gt;Tout jeter pour tout recommencer. LÃ  aussi, le coÃ»t ou la perte peut Ãªtre dÃ©mentielle.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Alors qu&amp;rsquo;il aurait suffi des conseils d&amp;rsquo;un DBA Ã  quelques moments de la vie du projet pour Ã©viter de partir dans une mauvaise direction.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;On ne bÃ¢tit pas un chÃ¢teau sur du sable&lt;/strong&gt;. J&amp;rsquo;ai une anecdote en tÃªte, une personne de mon entourage m&amp;rsquo;a racontÃ© une histoire d&amp;rsquo;un bÃ¢timent qui avait Ã©tÃ© contrÃ´lÃ© au moment de la livraison :&lt;/p&gt;&#xA;&lt;p&gt;Un prÃ©lÃ¨vement avait Ã©tÃ© fait dans les murs et il n&amp;rsquo;y avait pas assez de ciment, le bÃ¢timent, &lt;strong&gt;neuf&lt;/strong&gt;, pouvait s&amp;rsquo;Ã©crouler. Il venait d&amp;rsquo;Ãªtre totalement terminÃ©, Ã©lectricitÃ©, plomberie, menuiseries&amp;hellip; Tout Ã©tait terminÃ©.&#xA;Il a dÃ» Ãªtre rasÃ© complÃ¨tement. Autant il existe des assurances dans le bÃ¢timent, mais pas pour le dÃ©veloppement&amp;hellip;&#xA;Je pense que certaines sociÃ©tÃ©s ne survivent pas si la dette technique est trop importante.&lt;/p&gt;&#xA;&lt;h1 id=&#34;lusage-du-cloud&#34;&gt;L&amp;rsquo;usage du cloud&lt;/h1&gt;&#xA;&lt;p&gt;Le cloud a de nombreux avantages :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;On peut rapidement obtenir des bases de donnÃ©es avec une installation relativement propre.&lt;/li&gt;&#xA;&lt;li&gt;Le cloud provider vous obligera Ã  rester sur des versions supportÃ©es.&lt;/li&gt;&#xA;&lt;li&gt;&amp;ldquo;Ã‰cologiquement&amp;rdquo;, cela permet de mutualiser des ressources physiques. Mais c&amp;rsquo;est aussi une faiblesse. L&amp;rsquo;accÃ¨s facile Ã  ces ressources peut aussi entrainer un gaspillage. On peut facilement dÃ©ployer&#xA;une centaine d&amp;rsquo;instances. LÃ , oÃ¹ avec une infrastructure &lt;em&gt;on-premise&lt;/em&gt;, il faut concilier avec les ressources physiques Ã  disposition : puissance des serveurs, puissance Ã©lectrique, espace dans les baies&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;On paye ce qu&amp;rsquo;on consomme. On peut facilement identifier combien coute un service. Qu&amp;rsquo;une requÃªte est responsable de 80% de la facture. Ce qui peut inciter Ã  l&amp;rsquo;optimiser, le gain financier est immÃ©diat. Encore faut-il qu&amp;rsquo;il y ait des personnes qui s&amp;rsquo;y intÃ©ressent.&#xA;Je n&amp;rsquo;ai pas l&amp;rsquo;impression qu&amp;rsquo;il y ait beaucoup de FinOps. S&amp;rsquo;il y en a, est-ce que ces derniers pensent Ã  optimiser la base ?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Mais il y a aussi de vrais inconvÃ©nients :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Perte de souverainetÃ© numÃ©rique. A cela s&amp;rsquo;ajoute des risques juridiques. Comment garantir que vos donnÃ©es ne sont pas stockÃ©es ailleurs ? Si vous avez choisi un service managÃ©, comment en sortir si la lÃ©gislation vous impose d&amp;rsquo;Ãªtre sur le sol FranÃ§ais ou d&amp;rsquo;un autre pays ?&lt;/li&gt;&#xA;&lt;li&gt;Perte de compÃ©tences.&lt;/li&gt;&#xA;&lt;li&gt;DÃ©pendance Ã  un cloud provider : encore que sur ce point, on voit Ã©merger de nouvelles offres &amp;ldquo;cloud agnostique&amp;rdquo; : Des sociÃ©tÃ©s crÃ©ent un cloud par-dessus un autre cloud.&#xA;Je pense notamment Ã  &lt;a href=&#34;https://aiven.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aiven&lt;/a&gt;, &lt;a href=&#34;https://www.enterprisedb.com/docs/biganimal/latest/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EDB BigAnimal&lt;/a&gt;, &lt;a href=&#34;https://www.crunchydata.com/products/crunchy-bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Crunchy Bridge&lt;/a&gt; et j&amp;rsquo;en oublie certainement&amp;hellip;&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;li&gt;Les couts dÃ©collent quand l&amp;rsquo;infrastructure est importante. Certains commencent Ã  quitter le cloud. Je pense notamment Ã  Basecamp :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/why-we-re-leaving-the-cloud-654b47e0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Why we&amp;rsquo;re leaving the cloud&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/we-stand-to-save-7m-over-five-years-from-our-cloud-exit-53996caa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;We stand to save $7m over five years from our cloud exit&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://world.hey.com/dhh/the-big-cloud-exit-faq-20274010&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Big Cloud Exit FAQ&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;ce-quil-faudrait-changer&#34;&gt;Ce qu&amp;rsquo;il faudrait changer&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Redonner de la valeur Ã  la donnÃ©e : des sociÃ©tÃ©s rechignent Ã  faire appel Ã  des DBA ou prendre des contrats de supports sur leur base. Quel est le cout d&amp;rsquo;une indisponibilitÃ© de service, d&amp;rsquo;une corruption de donnÃ©e, d&amp;rsquo;une perte de la base ?&lt;/li&gt;&#xA;&lt;li&gt;RÃ©investir le champ des compÃ©tences en base de donnÃ©e : SQL, modÃ©lisation&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;. A ce sujet, j&amp;rsquo;aime beaucoup le titre de Markus Winand : &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SQL Renaissance Ambassador&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;S&amp;rsquo;attarder un peu plus sur l&amp;rsquo;usage des ressources : la consommation du numÃ©rique est importante, si les serveurs et l&amp;rsquo;Ã©lectricitÃ© Ã©taient plus chers, on serait contraint d&amp;rsquo;optimiser.&lt;/li&gt;&#xA;&lt;li&gt;Surveiller les dÃ©penses sur les bases. Que Ã§a soit dans le cloud, mais Ã©galement on-premise. Pour cela, il faut avoir des indicateurs de couts.&lt;/li&gt;&#xA;&lt;li&gt;Penser pas Ã  faire appel Ã  des DBA pour anticiper les problÃ¨mes et investiguer sur les problÃ¨mes de performance : J&amp;rsquo;ai auditÃ© des bases dans un Ã©tat catastrophique, Ã§a aurait pu Ãªtre Ã©vitÃ© si un DBA Ã©tait intervenu dans la phase de modÃ©lisation. Sur les problÃ¨mes de performance, il m&amp;rsquo;est dÃ©jÃ  arrivÃ© de diviser des factures de cloud par 10 ou de baisser la charge moyenne de 80% Ã  5% avec un suivi rÃ©gulier.&lt;/li&gt;&#xA;&lt;li&gt;Il ne faut pas se rÃ©signer Ã  payer de grosses factures cloud plutÃ´t que d&amp;rsquo;investir dans de la compÃ©tence de DBA.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;pour-conclure&#34;&gt;Pour conclure&lt;/h1&gt;&#xA;&lt;p&gt;C&amp;rsquo;est un article moins technique par rapport Ã  ce que vous avez l&amp;rsquo;habitude de lire sur mon blog.&#xA;Cependant, c&amp;rsquo;est un des plus importants que j&amp;rsquo;ai Ã©tÃ© amenÃ© Ã  Ã©crire.&#xA;Ca fait plus de dix ans que je fais du Postgres et je rÃ©alise que la tendance ne va pas dans la bonne direction.&#xA;J&amp;rsquo;espÃ¨re qu&amp;rsquo;il y aura une prise de conscience pour un avenir plus durable des bases de donnÃ©es.&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Ainsi que dans le public, il est dans le &lt;a href=&#34;https://code.gouv.fr/data/sill.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Socle interministÃ©riel de logiciels libres&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:2&#34;&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://twitter.com/pgconfeu/status/1734860251390750980&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;720 personnes Ã  la PGEurope 2023&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:3&#34;&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.datadoghq.com/blog/aws-ebs-latency-and-iops-the-surprising-truth/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AWS EBS latency and IOPS: The surprising truth&lt;/a&gt;&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Ultimately, due to AWSâ€™ opacity, there is simply no way to know how much throughput (from the physical disks and from the network that sits in-between) to expect for a given EBS volume. Provisioned IOPS only offer a partial solution to this issue, at a higher hourly cost.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:4&#34;&gt;&#xA;&lt;p&gt;Le Postgres actuel est trÃ¨s loin du Postgres avec lequel j&amp;rsquo;ai dÃ©butÃ© :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Nouvelles fonctionnalitÃ©s liÃ©es au standard SQL : JSONPath par exemple. &lt;a href=&#34;https://winand.at/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Markus Winand&lt;/a&gt; est l&amp;rsquo;auteur d&amp;rsquo;un super site Ã  ce sujet: &lt;a href=&#34;https://modern-sql.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Modern SQL&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;Nouvelles fonctionnalitÃ©s sur le moteur : parallÃ©lisme, partitionnement, nouveaux noeuds d&amp;rsquo;exÃ©cution, rÃ©plication logique&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;La consÃ©quence est un nombre de paramÃ¨tres qui augmente au fur et Ã  mesure.&lt;/li&gt;&#xA;&lt;li&gt;De nouvelles extensions.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:5&#34;&gt;&#xA;&lt;p&gt;Je n&amp;rsquo;ai pas travaillÃ© avec ces offres, je n&amp;rsquo;ai pas de recul dessus. On peut nÃ©anmoins souligner que ces sociÃ©tÃ©s emploient des dÃ©veloppeurs qui contribuent Ã  Postgres.&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:6&#34;&gt;&#xA;&lt;p&gt;Il y a quelques annÃ©es, un article Ã©tait tirÃ© d&amp;rsquo;une confÃ©rence.&lt;/p&gt;&#xA;&lt;p&gt;Le titre est particuliÃ¨rement juste : &lt;a href=&#34;https://www.citusdata.com/blog/2018/03/19/postgres-database-constraints&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Database constraints in Postgres: The last line of defense&lt;/a&gt;.&#xA;Voici la vidÃ©o de la confÃ©rence : &lt;a href=&#34;https://www.youtube.com/watch?v=hWh8QoV8z8k&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Constraints: a Developer&amp;rsquo;s Secret Weapon - Will Leinweber&lt;/a&gt;&#xA;et ses &lt;a href=&#34;https://www.postgresql.eu/events/pgdayparis2018/sessions/session/1835/slides/70/2018-03-15%20constraints%20a%20developers%20secret%20weapon%20pgday%20paris.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;slides&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Optimisation du GROUP BY</title>
    <updated>2024-01-26T09:00:00Z</updated>
    <id>tag:blog.anayrat.info,2024-01-26:/2024/01/26/optimisation-du-group-by/</id>
    <link href="https://blog.anayrat.info/2024/01/26/optimisation-du-group-by/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Un commit a attirÃ© mon attention lors de ma veille technique :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;commit 0452b461bc405e6d35d8a14c02813c15e28ae516&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Author:     Alexander Korotkov &amp;lt;akorotkov@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AuthorDate: Sun Jan 21 22:21:36 2024 +0200&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Commit:     Alexander Korotkov &amp;lt;akorotkov@postgresql.org&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CommitDate: Sun Jan 21 22:21:36 2024 +0200&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Explore alternative orderings of group-by pathkeys during optimization.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    When evaluating a query with a multi-column GROUP BY clause, we can minimize&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sort operations or avoid them if we synchronize the order of GROUP BY clauses&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    with the ORDER BY sort clause or sort order, which comes from the underlying&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    query tree. Grouping does not imply any ordering, so we can compare&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    the keys in arbitrary order, and a Hash Agg leverages this. But for Group Agg,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    we simply compared keys in the order specified in the query. This commit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    explores alternative ordering of the keys, trying to find a cheaper one.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    The ordering of group keys may interact with other parts of the query, some of&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    which may not be known while planning the grouping. For example, there may be&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    an explicit ORDER BY clause or some other ordering-dependent operation higher up&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    in the query, and using the same ordering may allow using either incremental&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    sort or even eliminating the sort entirely.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    The patch always keeps the ordering specified in the query, assuming the user&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    might have additional insights.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    This introduces a new GUC enable_group_by_reordering so that the optimization&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    may be disabled if needed.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Discussion: https://postgr.es/m/7c79e6a5-8597-74e8-0671-1c39d124c9d6%40sigaev.ru&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Author: Andrei Lepikhov, Teodor Sigaev&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Tomas Vondra, Claudio Freire, Gavin Flower, Dmitry Dolgov&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Robert Haas, Pavel Borisov, David Rowley, Zhihong Yu&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Reviewed-by: Tom Lane, Alexander Korotkov, Richard Guo, Alena Rybakina&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On remarque le message du commit assez explicite en mentionnant les personnes impliquÃ©es (12 relecteurs!) ainsi que le lien vers la discussion :&#xA;&lt;a href=&#34;https://www.postgresql.org/message-id/flat/7c79e6a5-8597-74e8-0671-1c39d124c9d6%40sigaev.ru&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;POC: GROUP BY optimization&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Les travaux ont commencÃ© en 2018! Il aura fallu 5 ans et demi pour aboutir Ã  ce commit. C&amp;rsquo;est le fruit de nombreux Ã©changes afin de parvenir Ã  un consensus en prenant en compte les multiples idÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Pour tester ce patch, j&amp;rsquo;ai compilÃ© Postgres depuis les sources. Prenons un exemple tout simple :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_000_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;vacuum&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On obtient une table de 422Mo et un index de 66Mo.&#xA;Vous noterez au passage que j&amp;rsquo;ai utilisÃ© une nouveautÃ© de Postgres 16 en utilisant des &amp;ldquo;underscore&amp;rdquo; dans le &lt;em&gt;generate_series&lt;/em&gt;&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Si on fait un &lt;code&gt;GROUP BY&lt;/code&gt; sur &lt;em&gt;c1,c2&lt;/em&gt;, on obtient un parcours d&amp;rsquo;index :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c1,c2 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                    QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------------------------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; GroupAggregate  (cost=0.43..235342.27 rows=100000 width=16) (actual time=3.605..3501.887 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Group Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Index Only Scan using t1_c1_c2_idx on t1  (cost=0.43..159340.96 rows=10000175 width=8) (actual time=0.070..1900.730 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Heap Fetches: 0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: enable_group_by_reordering = &amp;#39;off&amp;#39;, random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.191 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 3502.036 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Vous remarquerez que j&amp;rsquo;ai volontairement dÃ©sactivÃ© la fonctionnalitÃ© dans un premier temps (enable_group_by_reordering=off). J&amp;rsquo;ai Ã©galement dÃ©sactivÃ© la parallÃ©lisation pour plus de clartÃ©.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;On a le plan attendu, le moteur va lire 10447 blocs avec un parcours &lt;em&gt;Index Only Scan&lt;/em&gt;. Le moteur va chercher le plan qui manipule le moins de blocs possible.&lt;/p&gt;&#xA;&lt;p&gt;En revanche, si on change l&amp;rsquo;ordre du group by :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c2,c1 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                          QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Sort  (cost=602422.32..602672.32 rows=100000 width=16) (actual time=5393.446..5393.503 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Sort Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Sort Method: quicksort  Memory: 79kB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  HashAggregate  (cost=514992.50..594117.50 rows=100000 width=16) (actual time=5392.351..5392.894 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Group Key: c2, c1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Batches: 1  Memory Usage: 3217kB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         -&amp;gt;  Seq Scan on t1  (cost=0.00..154055.00 rows=10000000 width=8) (actual time=0.033..1186.171 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               Buffers: shared hit=96 read=53959&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: enable_group_by_reordering = &amp;#39;off&amp;#39;, random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.189 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 5394.566 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans ce cas, le moteur va lire toute la table (&lt;em&gt;seqscan&lt;/em&gt;) et faire un tri, alors que le rÃ©sultat est identique.&lt;/p&gt;&#xA;&lt;p&gt;Le moteur lit 422Mo de donnÃ©es contre 80Mo, soit 5 fois plus. Le rÃ©sultat peut Ãªtre dÃ©sastreux suivant les performances du stockage.&#xA;LÃ , on a de la &amp;ldquo;chance&amp;rdquo;, mon instance est dans un ramdisk donc la requÃªte n&amp;rsquo;est pas beaucoup plus lente.&#xA;Avec du stockage mÃ©canique ou des disques cloud, le temps de rÃ©ponse peut augmenter drastiquement.&lt;/p&gt;&#xA;&lt;p&gt;L&amp;rsquo;ordre des colonnes dans un group by est important, c&amp;rsquo;est une optimisation assez simple pour peu qu&amp;rsquo;on connaisse le schÃ©ma de la base et qu&amp;rsquo;on maitrise les requÃªtes exÃ©cutÃ©es sur le serveur.&lt;/p&gt;&#xA;&lt;p&gt;Malheureusement, avec les ORM, on peut perdre cette maitrise ou rater des corrections.&#xA;C&amp;rsquo;est lÃ  oÃ¹ cette fonctionnalitÃ© est intÃ©ressante. Voyons son effet :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres=# set enable_group_by_reordering to on;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SET&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;postgres=# explain (settings, analyze,buffers) select count(*),c1,c2 from t1 group by c2,c1 order by c1,c2;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                    QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------------------------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; GroupAggregate  (cost=0.43..235338.33 rows=100000 width=16) (actual time=4.502..3658.168 rows=1000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Group Key: c1, c2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Index Only Scan using t1_c1_c2_idx on t1  (cost=0.43..159338.33 rows=10000000 width=8) (actual time=0.081..1923.553 rows=10000000 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Heap Fetches: 0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=10447&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Settings: random_page_cost = &amp;#39;1.1&amp;#39;, max_parallel_workers_per_gather = &amp;#39;0&amp;#39;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.230 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 3658.337 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;On retrouve le premier plan bien plus performant.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est une fonctionnalitÃ© assez simple qui devrait amÃ©liorer les temps d&amp;rsquo;exÃ©cutions de certaines requÃªtes dont la clause group by n&amp;rsquo;a pas Ã©tÃ© optimisÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;C&amp;rsquo;est une demande assez rÃ©currente d&amp;rsquo;amÃ©liorer le planificateur afin de gÃ©rer des cas en apparence simple. Il faut avoir en tÃªte que le risque est de d&amp;rsquo;augmenter&#xA;les opÃ©rations de calculs dans le planificateur. Or, on veut que cette Ã©tape soit la plus rapide possible La rÃ©ponse est souvent rÃ©sumÃ©e Ã  : &amp;ldquo;on ne veut pas alourdir le planificateur alors qu&amp;rsquo;on peut corriger la requÃªte&amp;rdquo;.&lt;/p&gt;&#xA;&lt;p&gt;Cependant, ce type d&amp;rsquo;optimisation peut Ãªtre acceptÃ©e si on sait que Ã§a ne sera pas couteux pour le planificateur.&lt;/p&gt;&#xA;&lt;p&gt;Il n&amp;rsquo;y a plus qu&amp;rsquo;Ã  espÃ©rer que cette fonctionnalitÃ© ne soit pas retirÃ©e d&amp;rsquo;ici la sortie de Postgres 17 :)&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Petite anecdote, pour ajouter cette fonctionnalitÃ©, l&amp;rsquo;auteur a fait Ã©voluer le standard SQL : &lt;a href=&#34;http://peter.eisentraut.org/blog/2023/09/20/grouping-digits-in-sql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grouping digits in SQL&lt;/a&gt; .&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>PostgreSQL compression du TOAST et toast_tuple_target</title>
    <updated>2022-02-14T07:00:00Z</updated>
    <id>tag:blog.anayrat.info,2022-02-14:/2022/02/14/postgresql-compression-du-toast-et-toast_tuple_target/</id>
    <link href="https://blog.anayrat.info/2022/02/14/postgresql-compression-du-toast-et-toast_tuple_target/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Quelques rappels sur le TOAST et prÃ©sentation d&amp;rsquo;un changement apparu avec PostgreSQL 11.&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#quest-ce-que-le-toast-&#34;&gt;Qu&amp;rsquo;est-ce que le TOAST ?&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#exemple-avec-le-jsonb&#34;&gt;Exemple avec le JSONB&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#paramÃ©trage-avancÃ©&#34;&gt;ParamÃ©trage avancÃ©&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#conclusion&#34;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#bonus&#34;&gt;Bonus&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;quest-ce-que-le-toast-&#34;&gt;Qu&amp;rsquo;est-ce que le TOAST ?&lt;/h1&gt;&#xA;&lt;p&gt;Vous Ãªtes-vous dÃ©jÃ  posÃ© la question sur comment Postgres fait pour stocker des lignes dÃ©passant la taille d&amp;rsquo;un bloc? Pour rappel, la taille par dÃ©faut d&amp;rsquo;un bloc est de 8Ko.&lt;/p&gt;&#xA;&lt;p&gt;Postgres utilise un mÃ©canisme appelÃ© TOAST pour &lt;a href=&#34;https://www.postgresql.org/docs/current/storage-toast.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Oversized-Attribute Storage Technique&lt;/a&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Lorsqu&amp;rsquo;un enregistrement devient trop gros pour Ãªtre stockÃ© dans un bloc, le moteur va le stocker &amp;ldquo;Ã  part&amp;rdquo;, dans une table de toast.&#xA;L&amp;rsquo;enregistrement sera dÃ©coupÃ© en &lt;em&gt;chunks&lt;/em&gt;, ainsi la table principale (appelÃ©e &lt;em&gt;heap&lt;/em&gt;) contiendra un pointeur (&lt;em&gt;chunk_id&lt;/em&gt;) pointant vers le bon &lt;em&gt;chunk&lt;/em&gt; dans la table de toast.&lt;/p&gt;&#xA;&lt;p&gt;Ce &lt;em&gt;chunk&lt;/em&gt; sera stockÃ© sur plusieurs lignes, pour un &lt;em&gt;chunk_id&lt;/em&gt; on peut avoir plusieurs lignes dans cette table de toast.&#xA;Ainsi, cette table de toast est composÃ©e de 3 colonnes:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_id&lt;/em&gt; : NumÃ©ro du chunk rÃ©fÃ©rencÃ© dans la heap&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_seq&lt;/em&gt; : NumÃ©ro de chaque segment d&amp;rsquo;un chunk&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;chunk_data&lt;/em&gt; : Partie donnÃ©es de chaque segment&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La rÃ©alitÃ© est un peu plus complexe, en vrai le moteur va tenter d&amp;rsquo;Ã©viter de stocker la donnÃ©e dans la table toast.&#xA;Si la ligne dÃ©passe &lt;code&gt;TOAST_TUPLE_THRESHOLD&lt;/code&gt; (2Ko), il va tenter de compresser les colonnes pour essayer de faire rentrer la ligne dans le bloc.&#xA;Plus prÃ©cisÃ©ment, il faut que la taille soit infÃ©rieure Ã  &lt;code&gt;TOAST_TUPLE_TARGET&lt;/code&gt; (2Ko par dÃ©faut, on va en reparler).&lt;/p&gt;&#xA;&lt;p&gt;Si on a de la chance, la ligne compressÃ©e rentre dans la heap. Sinon, il va tenter de compresser les colonnes,&#xA;de la plus grande Ã  la plus petite et les stocker dans la partie toast jusqu&amp;rsquo;Ã  ce que les colonnes restantes rentrent dans une ligne de la heap. &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;A noter Ã©galement que si le gain en compression est trop faible, il considÃ¨re qu&amp;rsquo;il est inutile de dÃ©penser&#xA;de la ressource de calcul Ã  tenter de compresser. Il stocke donc la donnÃ©e sans compression. &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;Avez-vous dÃ©jÃ  prÃªtÃ© attention Ã  la colonne &amp;ldquo;Storage&amp;rdquo; lorsque vous affichez les caractÃ©ristiques d&amp;rsquo;une table Ã  l&amp;rsquo;aide de la mÃ©ta commande &lt;code&gt;\d+ table&lt;/code&gt; ?&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;stackoverflow=# \d+ posts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   Table &amp;#34;public.posts&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Column     |  Type   | Collation | Nullable | Default | Storage  |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---------------+---------+-----------+----------+---------+----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; id            | integer |           | not null |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; posttypeid    | integer |           | not null |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; score         | integer |           |          |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; viewcount     | integer |           |          |         | plain    |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; body          | text    |           |          |         | extended |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dans cet exemple, la colonne prend comme valeur &lt;em&gt;plain&lt;/em&gt; ou &lt;em&gt;extended&lt;/em&gt;. En rÃ©alitÃ©, il existe 4 valeurs possibles selon le type de donnÃ©e :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;em&gt;plain&lt;/em&gt; : la colonne est stockÃ©e dans la heap uniquement et sans compression.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;extended&lt;/em&gt; : la colonne peut Ãªtre compressÃ©e et stockÃ©e dans le toast si nÃ©cessaire.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;external&lt;/em&gt; : la colonne peut Ãªtre stockÃ©e dans le toast mais uniquement sans compression. Parfois on peut utiliser ce mode pour avoir un gain en performance (Ã©vite la compression/dÃ©compression)&#xA;au prix d&amp;rsquo;une consommation plus importante de l&amp;rsquo;espace disque.&lt;/li&gt;&#xA;&lt;li&gt;&lt;em&gt;main&lt;/em&gt; : La colonne est stockÃ©e dans la heap uniquement mais contrairement au mode &lt;em&gt;plain&lt;/em&gt;, on autorise la compression.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Au premier abord, on peut penser que l&amp;rsquo;intÃ©rÃªt est surtout sur la possibilitÃ© de stocker&#xA;des lignes dÃ©passant la taille d&amp;rsquo;un bloc et de compresser la donnÃ©e pour gagner de l&amp;rsquo;espace disque.&lt;/p&gt;&#xA;&lt;p&gt;Il y a un autre intÃ©rÃªt : lors d&amp;rsquo;une mise Ã  jour d&amp;rsquo;une ligne, si les colonnes &amp;ldquo;toastÃ©es&amp;rdquo; ne sont pas modifiÃ©es, le moteur n&amp;rsquo;a pas besoin de modifier la table toast.&#xA;On va ainsi Ã©viter de devoir dÃ©compresser et recompresser le toast et Ã©crire tout Ã§a dans des journaux de transaction.&lt;/p&gt;&#xA;&lt;p&gt;Nous allons voir qu&amp;rsquo;un autre avantage est que le moteur peut Ã©viter de lire le toast si ce n&amp;rsquo;est pas nÃ©cessaire.&lt;/p&gt;&#xA;&lt;h1 id=&#34;exemple-avec-le-jsonb&#34;&gt;Exemple avec le JSONB&lt;/h1&gt;&#xA;&lt;p&gt;Pour Ã©tudier Ã§a, on va utiliser le type JSONB. De maniÃ¨re gÃ©nÃ©rale, je dÃ©conseille l&amp;rsquo;usage de ce type :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;On perd les avantages d&amp;rsquo;avoir un schÃ©ma :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;vÃ©rification des types&lt;/li&gt;&#xA;&lt;li&gt;contraintes d&amp;rsquo;intÃ©gritÃ©&lt;/li&gt;&#xA;&lt;li&gt;pas de clÃ©s Ã©trangÃ¨res&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;L&amp;rsquo;Ã©criture des requÃªtes devient plus complexe&lt;/li&gt;&#xA;&lt;li&gt;Absence des statistiques sur les clÃ©s d&amp;rsquo;un champ json&lt;/li&gt;&#xA;&lt;li&gt;Perte d&amp;rsquo;efficacitÃ© du stockage vu qu&amp;rsquo;on stocke les clÃ©s pour chaque ligne&lt;/li&gt;&#xA;&lt;li&gt;Pas de mise Ã  jour partielle du JSONB. Si on modifie une clÃ© on est obligÃ© de &lt;em&gt;detoaster&lt;/em&gt; et &lt;em&gt;toaster&lt;/em&gt; tout le JSONB&lt;/li&gt;&#xA;&lt;li&gt;Pas de &lt;em&gt;detoast&lt;/em&gt; partiel : si on souhaite lire une seule clÃ© du JSONB, on est contraint de &lt;em&gt;detoaster&lt;/em&gt; tout le JSONB &lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Cependant, il y a quelques exceptions oÃ¹ le JSON peut Ãªtre utile :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Lorsqu&amp;rsquo;on n&amp;rsquo;a pas besoin de chercher dans de multiples champs et qu&amp;rsquo;on rÃ©cupÃ¨re le json via une autre colonne. (Statistiques sur les clÃ©s du json inutiles).&lt;/li&gt;&#xA;&lt;li&gt;Et, lorsqu&amp;rsquo;il serait trÃ¨s difficile de faire rentrer le json dans un schÃ©ma relationnel. Certains cas impliqueraient d&amp;rsquo;avoir Ã©normÃ©ment de colonnes et la plupart Ã  &lt;code&gt;NULL&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Par exemple, pour stocker des caractÃ©ristiques de produit oÃ¹ une version normalisÃ©e entrainerait l&amp;rsquo;usage de beaucoup de colonnes dont la plupart seraient Ã  &lt;code&gt;NULL&lt;/code&gt;.&#xA;Imaginons que vous stockez des produits, une tÃ©lÃ©vision aurait des caractÃ©ristiques spÃ©cifiques (type d&amp;rsquo;Ã©cran, taille etc). Une machine Ã  laver aurait aussi d&amp;rsquo;autre caractÃ©ristiques spÃ©cifiques (vitesse essorage, poids acceptÃ©&amp;hellip;).&lt;/p&gt;&#xA;&lt;p&gt;On pourrait ainsi envisager d&amp;rsquo;avoir des colonnes &amp;ldquo;normales&amp;rdquo; comprenant le modÃ¨le, son prix, sa rÃ©fÃ©rence etc, et une colonne contenant toutes les caractÃ©ristiques.&#xA;On accÃ¨derait Ã  la ligne via la rÃ©fÃ©rence et ainsi on rÃ©cupÃ¨rerait toutes les caractÃ©ristiques du produit stockÃ©es dans le json.&lt;/p&gt;&#xA;&lt;p&gt;Je vais rÃ©utiliser la table des posts de Stackoverflow en dÃ©plaÃ§ant quelques colonnes dans une colonne de type jsonb (colonne &lt;em&gt;jsonfield&lt;/em&gt; dans cet exemple):&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;\d posts&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            Unlogged table &amp;#34;public.posts&amp;#34;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Column         |            Type             | Collation | Nullable | Default&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-----------------------+-----------------------------+-----------+----------+---------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; id                    | integer                     |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; posttypeid            | integer                     |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; acceptedanswerid      | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; parentid              | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; creationdate          | timestamp without time zone |           | not null |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; score                 | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; viewcount             | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; body                  | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; owneruserid           | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditoruserid      | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditordisplayname | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lasteditdate          | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; lastactivitydate      | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; title                 | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; tags                  | text                        |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; answercount           | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; commentcount          | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; favoritecount         | integer                     |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; closeddate            | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; communityowneddate    | timestamp without time zone |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; jsonfield             | jsonb                       |           |          |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Voici une requÃªte toute simple d&amp;rsquo;agrÃ©gation :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;viewcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;answercount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commentcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;favoritecount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                          QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-------------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Aggregate  (cost=10265135.77..10265135.78 rows=1 width=128) (actual time=170221.557..170221.558 rows=1 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=1 read=9186137&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   I/O Timings: read=138022.290&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Seq Scan on posts  (cost=0.00..9725636.88 rows=53949888 width=16) (actual time=0.014..153665.913 rows=53949886 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared hit=1 read=9186137&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         I/O Timings: read=138022.290&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.240 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 170221.627 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(8 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La requÃªte lit 70 Go de donnÃ©es et met environ 2min 50s Ã  s&amp;rsquo;exÃ©cuter.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant la mÃªme requÃªte, mais cette fois en utilisant les clÃ©s prÃ©sentes dans le json.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ViewCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;AnswerCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CommentCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jsonfield&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;FavoriteCount&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                           QUERY PLAN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Aggregate  (cost=11883632.41..11883632.42 rows=1 width=128)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            (actual time=520917.028..520917.030 rows=1 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Buffers: shared hit=241116554 read=13625756&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -&amp;gt;  Seq Scan on posts  (cost=0.00..9725636.88 rows=53949888 width=570)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                          (actual time=0.972..70569.365 rows=53949886 loops=1)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Buffers: shared read=9186138&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Planning Time: 0.118 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Execution Time: 520945.395 ms&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(10 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;La requÃªte met environ 8min 40s Ã  s&amp;rsquo;exÃ©cuter. En revanche le nombre de blocs lus semble un peu dÃ©lirant :&lt;/p&gt;&#xA;&lt;p&gt;Le Seq Scan indique comme tout Ã  l&amp;rsquo;heure 70Go. En revanche, le nÅ“ud parent indique plus de 1.9 To lus!&lt;/p&gt;&#xA;&lt;p&gt;Voici la taille de la table avec le paramÃ©trage par dÃ©faut. Il faut savoir que pour certains enregistrements,&#xA;le moteur va, soit compresser la ligne dans la heap, soit la compresser et la placer dans le toast.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SELECT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(oid)) table_size,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(reltoastrelid)) toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FROM pg_class&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WHERE relname = &amp;#39;posts&amp;#39;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; table_size | toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------+-----------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 70 GB      | 33 GB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(1 row)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Comment expliquer les 1.9 To lus ?&lt;/p&gt;&#xA;&lt;p&gt;Par curiositÃ©, j&amp;rsquo;ai fait la mÃªme requÃªte, mais avec une seule agrÃ©gation et j&amp;rsquo;obtiens environ 538 Go.&lt;/p&gt;&#xA;&lt;p&gt;On peut se poser plusieurs questions :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Comment savoir si le moteur va lire le toast ?&lt;/li&gt;&#xA;&lt;li&gt;Pourquoi un tel Ã©cart de temps d&amp;rsquo;exÃ©cution entre la version &amp;ldquo;colonne standard&amp;rdquo; et champ jsonb?&lt;/li&gt;&#xA;&lt;li&gt;A quoi correspondent les compteurs dans le nÅ“ud &lt;code&gt;Aggregate&lt;/code&gt; ?&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Pour rÃ©pondre Ã  la premiÃ¨re question, il suffit de lire la vue &lt;code&gt;pg_statio_user_tables&lt;/code&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Avant exÃ©cution de la requÃªte :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;select relid,schemaname,relname,heap_blks_read,heap_blks_hit,toast_blks_read,toast_blks_hit from pg_statio_all_tables where relname in (&amp;#39;posts&amp;#39;,&amp;#39;pg_toast_26180851&amp;#39;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  relid   | schemaname |      relname      | heap_blks_read | heap_blks_hit | toast_blks_read | toast_blks_hit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----------+------------+-------------------+----------------+---------------+-----------------+----------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180851 | public     | posts             |      422018238 |      87673549 |       129785076 |      628153337&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180854 | pg_toast   | pg_toast_26180851 |      129785076 |     628153337 |                 |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;AprÃ¨s :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  relid   | schemaname |      relname      | heap_blks_read | heap_blks_hit | toast_blks_read | toast_blks_hit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----------+------------+-------------------+----------------+---------------+-----------------+----------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180851 | public     | posts             |      431204376 |      87673549 |       134156898 |      686299551&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 26180854 | pg_toast   | pg_toast_26180851 |      134156898 |     686299551 |                 |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(2 rows)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ce qui nous fait :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;431204376&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;87673549&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;422018238&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;87673549&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;heap_buffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pg_size_pretty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;134156898&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;686299551&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;129785076&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;628153337&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_buffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;heap_buffers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_buffers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------+---------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;477&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Le moteur va bien lire le toast. En revanche les compteurs laissent penser que le moteur va lire plusieurs fois le toast.&lt;/p&gt;&#xA;&lt;p&gt;Si je fais le mÃªme calcul, mais cette fois en effectuant l&amp;rsquo;agrÃ©gation que sur un seul champ, j&amp;rsquo;obtiens 119 Go (~ 477 Go / 4)&#xA;J&amp;rsquo;imagine que le moteur lit le toast pour chaque fonction.&lt;/p&gt;&#xA;&lt;p&gt;Ensuite, l&amp;rsquo;Ã©cart du temps d&amp;rsquo;exÃ©cution s&amp;rsquo;explique par plusieurs facteurs :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Le moteur va devoir lire et &lt;em&gt;detoaster&lt;/em&gt; (dÃ©compresser) le toast&lt;/li&gt;&#xA;&lt;li&gt;Faire des opÃ©rations supplÃ©mentaires sur le jsonb pour accÃ©der Ã  la valeur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Avec la premiÃ¨re requÃªte, le moteur n&amp;rsquo;avait pas Ã  lire le toast. D&amp;rsquo;une part, il a moins de donnÃ©es Ã  lire,&#xA;d&amp;rsquo;autre part, il n&amp;rsquo;a pas Ã  manipuler le json pour identifier la clÃ© et extraire la valeur Ã  calculer.&lt;/p&gt;&#xA;&lt;p&gt;Enfin, les compteurs du nÅ“ud aggregate doivent correspondre aux donnÃ©es dÃ©compressÃ©es pour chaque fonction qui va lire dans le json.&#xA;En effet, si on prend le total moins le &lt;em&gt;seqscan&lt;/em&gt; de la table, donc que la partie &lt;em&gt;toast&lt;/em&gt;, on a :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;468 Go pour un seul champ&lt;/li&gt;&#xA;&lt;li&gt;936 Go, le double pour deux champs&lt;/li&gt;&#xA;&lt;li&gt;1873 Go pour les 4 champs (donc environ 4 x 468 Go)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;C&amp;rsquo;est ce qui explique pourquoi on obtient une valeur aussi Ã©levÃ©e.&lt;/p&gt;&#xA;&lt;h1 id=&#34;paramÃ©trage-avancÃ©&#34;&gt;ParamÃ©trage avancÃ©&lt;/h1&gt;&#xA;&lt;p&gt;Maintenant, on va encourager Postgres Ã  placer le maximum de donnÃ©es dans le toast grÃ¢ce Ã  l&amp;rsquo;option &lt;em&gt;toast_tuple_target&lt;/em&gt; apparue avec la version 11 de Postgres.&lt;/p&gt;&#xA;&lt;p&gt;Cette option permet de manipuler le seuil Ã  partir duquel les donnÃ©es sont stockÃ©e dans le &lt;em&gt;toast&lt;/em&gt;.&lt;/p&gt;&#xA;&lt;p&gt;Par ailleurs, Ã©tant sous Postgres 14, j&amp;rsquo;en ai profitÃ© pour utiliser l&amp;rsquo;algorithme de compression lz4 (paramÃ¨tre &lt;em&gt;default_toast_compression&lt;/em&gt;).&#xA;Cet algorithme offre un ratio de compression similaire Ã  pglz, cependant, il est beaucoup plus rapide (Voir &lt;a href=&#34;https://www.postgresql.fastware.com/blog/what-is-the-new-lz4-toast-compression-in-postgresql-14&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is the new LZ4 TOAST compression in PostgreSQL 14, and how fast is it?&lt;/a&gt;).&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts_toast&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;toast_tuple_target&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Voici la taille de la table obtenue.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SELECT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(oid)) table_size,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pg_size_pretty(pg_relation_size(reltoastrelid)) toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FROM pg_class&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WHERE relname = &amp;#39;posts_toast&amp;#39;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; table_size | toast_size&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------+------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 59 GB      | 52 GB&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Au total, la table avec le toast fait grosso-modo la mÃªme taille. Dans l&amp;rsquo;exemple avec la premiÃ¨re table,&#xA;il faut savoir que le moteur compresse aussi les donnÃ©es dans la heap.&lt;/p&gt;&#xA;&lt;p&gt;Rejouons notre requÃªte d&amp;rsquo;agrÃ©gation :&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;viewcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;answercount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commentcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;avg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;favoritecount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;posts_toast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Cette fois la requÃªte lit 59 Go de donnÃ©es et met 2min 17 secondes.&#xA;On a gagnÃ© environ 20% de temps d&amp;rsquo;exÃ©cution sur cet exemple.&lt;/p&gt;&#xA;&lt;p&gt;On pourrait gagner beaucoup plus si la partie stockÃ©e en toast Ã©tait plus importante. Le volume de donnÃ©e Ã  lire dans la heap serait beaucoup plus rÃ©duit.&lt;/p&gt;&#xA;&lt;p&gt;Par curiositÃ©, j&amp;rsquo;ai aussi exÃ©cutÃ© la requÃªte qui fait l&amp;rsquo;agrÃ©gation depuis les donnÃ©es du champ json. J&amp;rsquo;obtiens un temps d&amp;rsquo;exÃ©cution de 7min 17s.&lt;/p&gt;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;RÃ©sumÃ© en quelques chiffres :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;AgrÃ©gation type standard, stockage standard : 2min 50s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type jsonb, stockage standard : 8min 40s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type standard, stockage avec &lt;em&gt;toast_tuple_target&lt;/em&gt; = 128 : 2min 17s&lt;/li&gt;&#xA;&lt;li&gt;AgrÃ©gation type jsonb, stockage avec &lt;em&gt;toast_tuple_target&lt;/em&gt; = 128 : 7min 17s&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;On constate que l&amp;rsquo;usage du JSON est bien plus couteux que d&amp;rsquo;utiliser les types standards. Le moteur doit faire plus d&amp;rsquo;opÃ©rations pour accÃ©der Ã  la valeur d&amp;rsquo;une clÃ© json.&lt;/p&gt;&#xA;&lt;p&gt;Par ailleurs, il est obligÃ© de dÃ©compresser les donnÃ©es dans le toast pour y accÃ©der. NÃ©anmoins, on peut aussi jouer avec le paramÃ¨tre &lt;code&gt;toast_tuple_target&lt;/code&gt; pour pousser plus&#xA;d&amp;rsquo;informations dans le toast. Ainsi, dans certains cas, cela peut permettre de rÃ©duire la quantitÃ© de donnÃ©es lues en Ã©vitant de lire le toast.&lt;/p&gt;&#xA;&lt;h1 id=&#34;bonus&#34;&gt;Bonus&lt;/h1&gt;&#xA;&lt;p&gt;Comment souvent dans Postgres, tout Ã©volue au fil des versions. Le TOAST n&amp;rsquo;Ã©chappe pas Ã  cette rÃ¨gle.&#xA;Ainsi, quelques nouveautÃ©s pourraient apparaitre dans les prochaines versions :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Un premier patch a Ã©tÃ© proposÃ© pour avoir plus de statistiques sur le toast : &lt;a href=&#34;https://commitfest.postgresql.org/37/3457/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pg_stat_toast&lt;/a&gt;.&#xA;L&amp;rsquo;idÃ©e, est d&amp;rsquo;avoir des statistiques sur la compression : gain compression, stockage inline ou sÃ©parÃ© dans le toast&amp;hellip;&lt;/li&gt;&#xA;&lt;li&gt;Un second patch appelÃ© &lt;a href=&#34;https://commitfest.postgresql.org/37/3490/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pluggable toaster&lt;/a&gt;. Celui-ci est beaucoup plus important. Il propose d&amp;rsquo;Ã©tendre le &lt;em&gt;&amp;ldquo;toaster&amp;rdquo;&lt;/em&gt;.&#xA;L&amp;rsquo;idÃ©e serait de pouvoir proposer diffÃ©rents &lt;em&gt;&amp;ldquo;toaster&amp;rdquo;&lt;/em&gt; selon le type de donnÃ©e (notamment le JSONB).&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;Voir &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/access/heap/heaptoast.c;h=55bbe1d584760a849960871296dfbdd7447b2b67;hb=refs/heads/REL_14_STABLE#l160&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;heap_toast_insert_or_update&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:2&#34;&gt;&#xA;&lt;p&gt;Il existe deux algorithmes de compression supportÃ©s : &lt;em&gt;pglz&lt;/em&gt; (historique et intÃ©grÃ© dans Postgres) et &lt;em&gt;lz4&lt;/em&gt; (depuis Postgres 14).&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Pour &lt;em&gt;pglz&lt;/em&gt;, voir &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/include/common/pg_lzcompress.h;h=3e53fbe97bd0a10e3fbf7ed4396924084f657868;hb=refs/heads/REL_14_STABLE#l25&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PGLZ_Strategy&lt;/a&gt;&#xA;et &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/common/pg_lzcompress.c;h=a30a2c2eb83a71725754d8dd680621a02e7557e9;hb=refs/heads/REL_14_STABLE#l223&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;strategy_default_data&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;Pour &lt;em&gt;lz4&lt;/em&gt;, il s&amp;rsquo;agit d&amp;rsquo;une librarie externe. Voir &lt;a href=&#34;https://github.com/lz4/lz4/blob/dev/lib/lz4.h#L145&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;LZ4_compress_default&lt;/a&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li id=&#34;fn:3&#34;&gt;&#xA;&lt;p&gt;Voir les slides de la confÃ©rence d&amp;rsquo;Oleg Bartunov et Nikita Glukhov : &lt;a href=&#34;http://www.sai.msu.su/~megera/postgres/talks/jsonb-nizhny-2021.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;json or not json that is the question&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>Cas d&#39;usages du partitionnement natif dans PostgreSQL</title>
    <updated>2021-09-01T07:00:00Z</updated>
    <id>tag:blog.anayrat.info,2021-09-01:/2021/09/01/cas-dusages-du-partitionnement-natif-dans-postgresql/</id>
    <link href="https://blog.anayrat.info/2021/09/01/cas-dusages-du-partitionnement-natif-dans-postgresql/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;AprÃ¨s une pÃ©riode d&amp;rsquo;inactivitÃ©, je reprends l&amp;rsquo;Ã©criture d&amp;rsquo;articles techniques sur Postgres. C&amp;rsquo;est aussi pour moi l&amp;rsquo;occasion de vous annoncer mon changement d&amp;rsquo;activitÃ©. Depuis courant 2021 je suis passÃ© freelance pour permettre aux entreprises de bÃ©nÃ©ficier de mon expÃ©rience sur Postgres.&lt;/p&gt;&#xA;&lt;details class=&#34;toc-inpage d-print-none  &#34; open&gt;&#xA;  &lt;summary class=&#34;font-weight-bold&#34;&gt;Table des matiÃ¨res&lt;/summary&gt;&#xA;  &lt;nav id=&#34;TableOfContents&#34;&gt;&#xA;  &lt;ul&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#histoire-du-partitionnement-dans-postgresql&#34;&gt;Histoire du partitionnement dans PostgreSQL&lt;/a&gt;&lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#erreurs-courantes&#34;&gt;Erreurs courantes&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#il-faut-partitionner-dÃ¨s-que-la-volumÃ©trie-est-importante&#34;&gt;&amp;ldquo;Il faut partitionner dÃ¨s que la volumÃ©trie est importante&amp;rdquo;&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#il-faut-partitionner-pour-rÃ©partir-les-donnÃ©es-sur-plusieurs-disques&#34;&gt;&amp;ldquo;Il faut partitionner pour rÃ©partir les donnÃ©es sur plusieurs disques&amp;rdquo;&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#cas-dusages-du-partitionnement&#34;&gt;Cas d&amp;rsquo;usages du partitionnement&lt;/a&gt;&#xA;      &lt;ul&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-gÃ©rer-la-rÃ©tention&#34;&gt;Partitionner pour gÃ©rer la rÃ©tention&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-contrÃ´ler-la-fragmentation-des-index&#34;&gt;Partitionner pour contrÃ´ler la fragmentation des index&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-faciliter-lexÃ©cution-de-requÃªte-lorsque-la-cardinalitÃ©-est-faible&#34;&gt;Partitionner pour faciliter l&amp;rsquo;exÃ©cution de requÃªte lorsque la cardinalitÃ© est faible&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionner-pour-obtenir-de-meilleures-statistiques&#34;&gt;Partitionner pour obtenir de meilleures statistiques&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#partitionwise-join--partitionwise-aggregate&#34;&gt;partitionwise join &amp;amp; partitionwise aggregate&lt;/a&gt;&lt;/li&gt;&#xA;        &lt;li&gt;&lt;a href=&#34;#stockage-avec-tiering&#34;&gt;Stockage avec tiering&lt;/a&gt;&lt;/li&gt;&#xA;      &lt;/ul&gt;&#xA;    &lt;/li&gt;&#xA;    &lt;li&gt;&lt;a href=&#34;#conclusion&#34;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;&#xA;  &lt;/ul&gt;&#xA;&lt;/nav&gt;&#xA;&lt;/details&gt;&#xA;&lt;h1 id=&#34;histoire-du-partitionnement-dans-postgresql&#34;&gt;Histoire du partitionnement dans PostgreSQL&lt;/h1&gt;&#xA;&lt;p&gt;PostgreSQL permet depuis trÃ¨s longtemps de partitionner des tables en exploitant l&amp;rsquo;hÃ©ritage de table. Toutefois, cette mÃ©thode Ã©tait assez lourde Ã  mettre en oeuvre : elle impliquait de mettre en place soi-mÃªme des triggers pour rediriger les Ã©critures (moins performant que le partitionnement natif), le temps de planification pouvait augmenter fortement au-delÃ  d&amp;rsquo;une centaine de partitions&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Le partitionnement natif est arrivÃ© avec la version 10. C&amp;rsquo;est depuis cette version que le moteur est capable (entre autres) de diriger lui-mÃªme les Ã©critures vers les bonnes tables, lire seulement les tables concernÃ©es, d&amp;rsquo;utiliser des algorithmes exploitant le partitionnement etc.&#xA;Il offre ainsi de meilleures performances et une facilitÃ© d&amp;rsquo;exploitation. On peut entre autres :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Partitionner :&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Par liste&lt;/li&gt;&#xA;&lt;li&gt;Par hashage&lt;/li&gt;&#xA;&lt;li&gt;Par intervalles&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Faire des partitionnements Ã  plusieurs niveaux&lt;/li&gt;&#xA;&lt;li&gt;Partitionner sur plusieurs colonnes&lt;/li&gt;&#xA;&lt;li&gt;Utiliser des clÃ©s primaires et clÃ©s Ã©trangÃ¨res&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Toutes ces fonctionnalitÃ©s sont intÃ©ressantes, mais on en vient Ã  se poser une question toute bÃªte : quand mettre en oeuvre le partitionnement?&lt;/p&gt;&#xA;&lt;p&gt;Je vais vous prÃ©senter plusieurs cas d&amp;rsquo;usages que j&amp;rsquo;ai pu rencontrer. Mais avant, voici quelques erreurs courantes sur le partitionnement.&lt;/p&gt;&#xA;&lt;h1 id=&#34;erreurs-courantes&#34;&gt;Erreurs courantes&lt;/h1&gt;&#xA;&lt;h2 id=&#34;il-faut-partitionner-dÃ¨s-que-la-volumÃ©trie-est-importante&#34;&gt;&amp;ldquo;Il faut partitionner dÃ¨s que la volumÃ©trie est importante&amp;rdquo;&lt;/h2&gt;&#xA;&lt;p&gt;DÃ©jÃ , qu&amp;rsquo;est-ce qu&amp;rsquo;une volumÃ©trie &amp;ldquo;importante&amp;rdquo;?&lt;/p&gt;&#xA;&lt;p&gt;Certains diront que c&amp;rsquo;est au-delÃ  de plusieurs centaines de Go, d&amp;rsquo;autres au-delÃ  du tÃ©raoctet, d&amp;rsquo;autres encore au-delÃ  du pÃ©taoctet&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Il n&amp;rsquo;existe pas vraiment de rÃ©ponse Ã  cette question et globalement Ã§a va dÃ©pendre du type d&amp;rsquo;activitÃ© : ratio INSERT/UPDATE/DELETE, type de SELECT (OLTP, OLAP&amp;hellip;).&#xA;Ca dÃ©pendra Ã©galement du matÃ©riel. Il y a 10 ans, quand les serveurs n&amp;rsquo;avaient que quelques Go de RAM avec des disques mÃ©caniques, il Ã©tait probable qu&amp;rsquo;une base de quelques centaines de Go soit perÃ§ue comme une grosse base.&#xA;Maintenant il n&amp;rsquo;est pas rare de voir des serveurs avec plus d&amp;rsquo;un tÃ©raoctet de RAM, des disques NVMe.&lt;/p&gt;&#xA;&lt;p&gt;Ainsi, une base de quelques centaines de Go n&amp;rsquo;est plus considÃ©rÃ©e comme une grosse base. Mais plutÃ´t comme une base de taille modeste.&lt;/p&gt;&#xA;&lt;p&gt;Petite anecdote, pour se rassurer, un client m&amp;rsquo;a questionnÃ© si Postgres Ã©tait dÃ©jÃ  utilisÃ© pour des volumÃ©tries &amp;ldquo;importantes&amp;rdquo;. On parlait alors d&amp;rsquo;une base d&amp;rsquo;une quarantaine de Go sur un serveur qui disposait de 64Go de RAM. Toutes les lectures se faisaient depuis le cache&amp;hellip; :). J&amp;rsquo;ai pu le rassurer sur la taille de sa base qui Ã©tait relativement modeste.&lt;/p&gt;&#xA;&lt;p&gt;Il peut tout Ã  fait Ãªtre superflu de partitionner une base de quelques To comme il peut Ãªtre nÃ©cessaire de partitionner une base de quelques centaines de Go. Par exemple, si l&amp;rsquo;activitÃ© consiste juste Ã  ajouter des lignes Ã  des tables et que les requÃªtes se rÃ©sument Ã  de simple &lt;code&gt;WHERE colonne = 4&lt;/code&gt; qui retournent quelques lignes. Un simple Btree fera l&amp;rsquo;affaire. Et si la requÃªte retourne un nombre assez important de lignes, il est possible d&amp;rsquo;utiliser les index BRIN ou les bloom filter.&lt;/p&gt;&#xA;&lt;p&gt;Les index BRIN prÃ©sentent des bÃ©nÃ©fices proches du partitionnement ou sharding en Ã©vitant la complexitÃ© de mise en oeuvre&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;&#xA;&lt;h2 id=&#34;il-faut-partitionner-pour-rÃ©partir-les-donnÃ©es-sur-plusieurs-disques&#34;&gt;&amp;ldquo;Il faut partitionner pour rÃ©partir les donnÃ©es sur plusieurs disques&amp;rdquo;&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;idÃ©e serait de crÃ©er des partitions et des tablespaces sur diffÃ©rents disques afin de rÃ©partir les opÃ©rations d&amp;rsquo;entrÃ©es/sorties.&lt;/p&gt;&#xA;&lt;p&gt;Pour PostgreSQL, un tablespace n&amp;rsquo;est ni plus, ni moins qu&amp;rsquo;un chemin vers un rÃ©pertoire. Il est tout Ã  fait possible&#xA;de gÃ©rer le stockage au niveau du systÃ¨me d&amp;rsquo;exploitation et d&amp;rsquo;agrÃ©ger plusieurs disques (en RAID10) par exemple.&#xA;Ensuite, il suffit de stocker la table sur le volume crÃ©Ã©. Ainsi, on peut rÃ©partir les I/O sur un ensemble de disques.&lt;/p&gt;&#xA;&lt;p&gt;Dans ce cas, il n&amp;rsquo;est donc pas nÃ©cessaire de mettre en oeuvre le partitionnement. Toutefois, nous verrons un cas oÃ¹ il pourrait avoir du sens.&lt;/p&gt;&#xA;&lt;p&gt;Maintenant nous allons nous intÃ©resser Ã  des cas d&amp;rsquo;usage &amp;ldquo;lÃ©gitimes&amp;rdquo; du partitionnement.&lt;/p&gt;&#xA;&lt;h1 id=&#34;cas-dusages-du-partitionnement&#34;&gt;Cas d&amp;rsquo;usages du partitionnement&lt;/h1&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-gÃ©rer-la-rÃ©tention&#34;&gt;Partitionner pour gÃ©rer la rÃ©tention&lt;/h2&gt;&#xA;&lt;p&gt;A cause du modÃ¨le MVCC, la suppression massive de donnÃ©es entraine de la fragmentation dans les tables.&lt;/p&gt;&#xA;&lt;p&gt;Un cas d&amp;rsquo;usage possible est de partitionner par date. Supprimer les anciennes donnÃ©es revient Ã  supprimer une partition complÃ¨te. L&amp;rsquo;opÃ©ration sera rapide et les tables ne seront pas fragmentÃ©es&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-contrÃ´ler-la-fragmentation-des-index&#34;&gt;Partitionner pour contrÃ´ler la fragmentation des index&lt;/h2&gt;&#xA;&lt;p&gt;L&amp;rsquo;ajout et modification de donnÃ©es dans une table fragmente les index au fil du temps. Pour faire simple, on ne peut pas rÃ©cupÃ©rer l&amp;rsquo;espace libre dans un bloc tant qu&amp;rsquo;il n&amp;rsquo;est pas vide. Avec le temps les splits d&amp;rsquo;index crÃ©ent du &amp;ldquo;vide&amp;rdquo; dans ce dernier et le seul moyen de rÃ©cupÃ©rer cet espace est de reconstruire l&amp;rsquo;index.&lt;/p&gt;&#xA;&lt;p&gt;On appelle cela le &amp;ldquo;bloat&amp;rdquo;. Il y a eu de nombreuses amÃ©liorations sur les derniÃ¨res versions de Postgres:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 12, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/12/release-12.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Improve performance and space utilization of btree indexes with many duplicates (Peter Geoghegan, Heikki Linnakangas)&lt;/p&gt;&#xA;&lt;p&gt;Previously, duplicate index entries were stored unordered within their duplicate groups. This caused overhead during index inserts, wasted space due to excessive page splits, and it reduced VACUUM&amp;rsquo;s ability to recycle entire pages. Duplicate index entries are now sorted in heap-storage order.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 13, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;More efficiently store duplicates in B-tree indexes (Anastasia Lubennikova, Peter Geoghegan)&lt;/p&gt;&#xA;&lt;p&gt;This allows efficient B-tree indexing of low-cardinality columns by storing duplicate keys only once. Users upgrading with pg_upgrade will need to use REINDEX to make an existing index use this feature.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Version 14, on peut lire dans les &lt;a href=&#34;https://www.postgresql.org/docs/14/release-14.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Releases Notes&lt;/a&gt;:&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;Allow btree index additions to remove expired index entries to prevent page splits (Peter Geoghegan)&lt;/p&gt;&#xA;&lt;p&gt;This is particularly helpful for reducing index bloat on tables whose indexed columns are frequently updated.&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;Pour contrÃ´ler le bloat, on pourrait reconstruire l&amp;rsquo;index Ã  intervalles rÃ©guliers (merci &lt;code&gt;REINDEX CONCURRENTLY&lt;/code&gt; arrivÃ© en version 12). Cette solution serait contraignante, car il faudrait rÃ©guliÃ¨rement reconstruire l&amp;rsquo;intÃ©gralitÃ© de l&amp;rsquo;index.&lt;/p&gt;&#xA;&lt;p&gt;Si la majoritÃ© des modifications sont faites sur les donnÃ©es rÃ©centes, par exemple: table de logs, commandes clients, rendez-vous&amp;hellip; On pourrait imaginer un partitionnement par mois. Ainsi, Ã  chaque dÃ©but de mois on part sur une table &amp;ldquo;neuve&amp;rdquo; et on peut rÃ©-indexer la prÃ©cÃ©dente table pour supprimer le bloat.&lt;/p&gt;&#xA;&lt;p&gt;On peut aussi en profiter pour faire un &lt;code&gt;CLUSTER&lt;/code&gt; sur la table pour avoir une bonne corrÃ©lation des donnÃ©es avec le stockage.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-faciliter-lexÃ©cution-de-requÃªte-lorsque-la-cardinalitÃ©-est-faible&#34;&gt;Partitionner pour faciliter l&amp;rsquo;exÃ©cution de requÃªte lorsque la cardinalitÃ© est faible&lt;/h2&gt;&#xA;&lt;p&gt;Petit Ã  petit on va voir des cas d&amp;rsquo;usages un peu plus compliquÃ©s :)&lt;/p&gt;&#xA;&lt;p&gt;Prenons un exemple : une table de commande comprenant un statut de livraison, au bout de quelques annÃ©es 99% des commandes sont livrÃ©es (on l&amp;rsquo;espÃ¨re!) et trÃ¨s peu en cours de paiement ou livraison.&lt;/p&gt;&#xA;&lt;p&gt;Imaginons qu&amp;rsquo;on souhaite rÃ©cupÃ©rer 100 commandes en cours de livraison. On va crÃ©er un index sur le statut et l&amp;rsquo;utiliser pour rÃ©cupÃ©rer les enregistrements.&#xA;En Ã©tant un peu astucieux, on peut crÃ©er un index partiel sur ce statut particulier. ProblÃ¨me, cet index va se fragmenter assez vite au fur et Ã  mesure que les commandes seront livrÃ©es.&lt;/p&gt;&#xA;&lt;p&gt;Dans ce cas on pourrait faire un partitionnement sur le statut. Ainsi, rÃ©cupÃ©rer 100 commandes en cours de livraison revient Ã  lire 100 enregistrements de la partition.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionner-pour-obtenir-de-meilleures-statistiques&#34;&gt;Partitionner pour obtenir de meilleures statistiques&lt;/h2&gt;&#xA;&lt;p&gt;Pour dÃ©terminer le meilleur plan d&amp;rsquo;exÃ©cution, Postgres prend des dÃ©cisions Ã  partir des statistiques d&amp;rsquo;une table. Ces statistiques sont obtenues Ã  partir d&amp;rsquo;un Ã©chantillon de la table (le &lt;code&gt;default_statistic_target&lt;/code&gt; qui vaut 100 par dÃ©faut).&lt;/p&gt;&#xA;&lt;p&gt;Par dÃ©faut le moteur va collecter 300 x &lt;code&gt;default_statistic_target&lt;/code&gt; lignes, soit 30 000 lignes. Avec une table de plusieurs centaines de millions de lignes, cet Ã©chantillon est parfois trop petit.&lt;/p&gt;&#xA;&lt;p&gt;On peut augmenter de maniÃ¨re drastique la taille de l&amp;rsquo;Ã©chantillon, mais cette approche prÃ©sente quelques inconvÃ©nients:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ca alourdis le temps de planification&lt;/li&gt;&#xA;&lt;li&gt;Ca alourdis le &lt;code&gt;ANALYZE&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Parfois ce n&amp;rsquo;est pas suffisant si les donnÃ©es sont mal rÃ©parties. Par exemple si on prend quelques centaines de milliers de lignes sur une table qui comprend plusieurs centaines de millions, on peut rater les lignes dont le statut est en livraison.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Avec le partitionnement on pourrait avoir un mÃªme Ã©chantillon, mais par partition, ce qui permet de gagner en prÃ©cision.&lt;/p&gt;&#xA;&lt;p&gt;Ce serait Ã©galement utile quand on a des donnÃ©es corrÃ©lÃ©es entre colonnes. Je vais reprendre l&amp;rsquo;exemple des commandes. On a une annÃ©e entiÃ¨re de commandes: toutes les commandes qui ont plus d&amp;rsquo;un mois sont livrÃ©es, celles du dernier mois sont livrÃ©es Ã  90% (10% sont en cours de livraison).&lt;/p&gt;&#xA;&lt;p&gt;Intuitivement, si je cherche une commande en cours de livraison il y a plus de 6 mois je ne devrais pas avoir de rÃ©sultat. Inversement, si je cherche des commandes en cours de livraison sur le dernier mois, je devrais obtenir 10% de la table. Or, le moteur ne le sait pas, pour lui les commandes en cours de livraison sont rÃ©parties sur toute la table.&lt;/p&gt;&#xA;&lt;p&gt;Avec un partitionnement par date, il peut estimer qu&amp;rsquo;il n&amp;rsquo;y a pas de commande en cours de livraisons de plus d&amp;rsquo;un mois. Ce type d&amp;rsquo;approche permet surtout de rÃ©duire une erreur d&amp;rsquo;estimation dans un plan d&amp;rsquo;exÃ©cution.&lt;/p&gt;&#xA;&lt;p&gt;Voici un exemple avec cette table de commandes, &lt;code&gt;orders_p&lt;/code&gt; est la version partitionnÃ©e par mois de la table &lt;code&gt;orders&lt;/code&gt;. Les donnÃ©es Ã©tant identiques dans les deux tables.&lt;/p&gt;&#xA;&lt;p&gt;On peut remarquer que l&amp;rsquo;estimation est bien meilleure dans le cas oÃ¹ la table est partitionnÃ©e, le moteur ayant des statistiques par partition.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_13_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_13&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;42&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;120&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;059&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;---------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;44&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3978&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-01-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Removed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100161&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;188&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;141&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;571&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Maintenant prenons la mÃªme requÃªte sur le dernier mois:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-------------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;43&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2417&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;19215&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20931&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;297&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;618&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXPLAIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ANALYZE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BETWEEN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_state_idx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;44&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15008&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20931&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pending&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2021-07-31&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Removed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;79230&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;146&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;326&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Ici aussi on peut remarquer que l&amp;rsquo;estimation est meilleure.&lt;/p&gt;&#xA;&lt;h2 id=&#34;partitionwise-join--partitionwise-aggregate&#34;&gt;partitionwise join &amp;amp; partitionwise aggregate&lt;/h2&gt;&#xA;&lt;p&gt;Un autre intÃ©rÃªt du partitionnement est de bÃ©nÃ©ficier de meilleurs algorithmes pour les jointures et agrÃ©gation.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;code&gt;partitionwise aggregate&lt;/code&gt; permet de faire une agregation ou un regroupement partition par partition. Un exemple vaut mieux qu&amp;rsquo;un long discours:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;hl&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;508361&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;508365&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Append&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;408317&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20008890&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20000000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45308&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;131708&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;576&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5273&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;217&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enable_partitionwise_aggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;analyze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_p&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                                                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PLAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;--------------------------------------------------------------------------------------------------------------&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Append&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;408343&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;83&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1765&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_02&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;70&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1270&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60013&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60013&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;37&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45308&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2941004&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashAggregate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;174455&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;174455&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Seq&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scan&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;orders_20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cost&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;131708&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8549421&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loops&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Planning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;461&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Execution&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4669&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;315&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ms&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;63&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;Dans le premier cas l&amp;rsquo;agrÃ©gation se fait une fois pour toutes les tables, alors que dans le second exemple, on fait l&amp;rsquo;agrÃ©gation par partition.&#xA;On peut Ã©galement remarquer que le coÃ»t total est infÃ©rieur dans le plan avec agrÃ©gation par partition.&lt;/p&gt;&#xA;&lt;p&gt;Le &lt;code&gt;partitionwise join&lt;/code&gt; fonctionne sur le mÃªme principe, on fait une jointure partition par partition. C&amp;rsquo;est utile pour joindre deux tables partitionnÃ©es.&lt;/p&gt;&#xA;&lt;h2 id=&#34;stockage-avec-tiering&#34;&gt;Stockage avec tiering&lt;/h2&gt;&#xA;&lt;p&gt;Enfin, un autre cas d&amp;rsquo;usage serait de vouloir stocker une partie de la table sur un stockage diffÃ©rent:&lt;/p&gt;&#xA;&lt;p&gt;On peut stocker une table partitionnÃ©e dans des tablespaces diffÃ©rents. Par exemple les donnÃ©es rÃ©centes sur un tablespace rapide sur SSD NVMe.&#xA;Puis les donnÃ©es plus rarement accÃ©dÃ©es sur un autre tablespace, avec des disques mÃ©caniques moins couteux.&lt;/p&gt;&#xA;&lt;p&gt;Cette approche peut aussi avoir du sens Ã  l&amp;rsquo;heure du cloud oÃ¹ le stockage est trÃ¨s onÃ©reux.&lt;/p&gt;&#xA;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;&#xA;&lt;p&gt;VoilÃ , je pense avoir fait le tour des principaux cas d&amp;rsquo;usages qui me venaient en tÃªte.&lt;/p&gt;&#xA;&lt;p&gt;Evidemment, la mise en oeuvre du partitionnement implique une plus grande complexitÃ© (gestion des partitions&amp;hellip;)&#xA;et des limitations qu&amp;rsquo;il faudra Ã©tudier en amont.&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;&amp;ldquo;BRIN indexes provide similar benefits to horizontal partitioning or sharding but without needing to explicitly declare partitions.&amp;rdquo; - &lt;a href=&#34;https://en.wikipedia.org/wiki/Block_Range_Index&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://en.wikipedia.org/wiki/Block_Range_Index&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</summary>
    <author>
      <name>blog.anayrat.info</name>
    </author>
  </entry>
  <entry>
    <title>[Infographie] PostgreSQL</title>
    <updated>2021-02-11T11:23:13Z</updated>
    <id>tag:blog.atolcd.com,2021-02-11:/infographie-postgresql/</id>
    <content type="html">&#xA;&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuliÃ¨rement chez Atol CD ! Retrouvez dans cette infographie quelques caractÃ©ristiques techniques, des chiffres-clÃ©, son histoire mais aussi pourquoi nous l&amp;rsquo;aimons et notre Top5 des fonctionnalitÃ©s cÃ´tÃ© dÃ©veloppement.&lt;/p&gt;&#xA;&#xA;&#xA;&#xA;&lt;figure class=&#34;wp-block-gallery columns-1 is-cropped wp-block-gallery-1 is-layout-flex wp-block-gallery-is-layout-flex&#34;&gt;&lt;ul class=&#34;blocks-gallery-grid&#34;&gt;&lt;li class=&#34;blocks-gallery-item&#34;&gt;&lt;figure&gt;&lt;img fetchpriority=&#34;high&#34; decoding=&#34;async&#34; width=&#34;866&#34; height=&#34;2560&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; alt=&#34;&#34; data-id=&#34;4477&#34; data-full-url=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg&#34; data-link=&#34;https://blog.atolcd.com/infographie-postgresql/infographie_postgresql/&#34; class=&#34;wp-image-4477&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-scaled.jpg 866w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-101x300.jpg 101w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-346x1024.jpg 346w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-768x2271.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-520x1536.jpg 520w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-693x2048.jpg 693w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-600x1774.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2021/02/infographie_PostgreSQL-945x2794.jpg 945w&#34; sizes=&#34;(max-width: 866px) 100vw, 866px&#34; /&gt;&lt;/figure&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/figure&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/infographie-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=infographie-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;PostgreSQL est un SGBD que nous affectionnons particuliÃ¨rement chez Atol CD ! Retrouvez dans cette infographie quelques caractÃ©ristiques techniques, des chiffres-clÃ©, son histoire mais aussi pourquoi nous l&amp;#8217;aimons et notre Top5 des fonctionnalitÃ©s cÃ´tÃ© dÃ©veloppement.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/infographie-postgresql/&#34;&gt;[Infographie] PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 13</title>
    <updated>2020-09-24T05:54:57Z</updated>
    <id>tag:blog.atolcd.com,2020-09-24:/sortie-de-postgresql-13/</id>
    <content type="html">&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;&lt;img decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-4130&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg&#34; alt=&#34;&#34; width=&#34;960&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2020/09/pg13.jpg 960w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-300x169.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-768x432.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-600x338.jpg 600w, https://blog.atolcd.com/wp-content/uploads/2020/09/pg13-945x532.jpg 945w&#34; sizes=&#34;(max-width: 960px) 100vw, 960px&#34; /&gt;MalgrÃ© des actualitÃ©s plutÃ´t moroses au Botswana concernant nos chers Ã©lÃ©phants, il y en a un qui se porte bien et est encore plus fort Ã  savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.Â &lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;AprÃ¨s seulement 3 versions BÃªta et une RC le voilÃ  dans les starting blocks pour dÃ©barquer sur vos serveurs ! Et comme Ã  chaque nouvelle version son&lt;/span&gt; &lt;span style=&#34;font-weight: 400;&#34;&gt;lot de nouveautÃ©s&lt;/span&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;span style=&#34;font-weight: 400;&#34;&gt;Un petit rappel qui peut parfois Ã©viter bien des catastrophes, si vous avez prÃ©vu de migrer vers PostgreSQL 13, vous devriez jeter un oeil sur &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html#id-1.11.6.5.4&#34;&gt;les potentielles incompatibilitÃ©s avec les prÃ©cÃ©dentes versions&lt;/a&gt;Â  (et aussi sur les versions intermÃ©diaires si vous faite un gap de plusieurs versions d&amp;rsquo;un coup), il est toujours prÃ©fÃ©rable d&amp;rsquo;identifier ces lÃ©gers changements en amont plutÃ´t qu&amp;rsquo;une fois en production. Mais rassurez-vous, dans cette version pas de quoi freiner significativement une migration.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Partitionnement&lt;/h1&gt;&#xA;&lt;p&gt;Des amÃ©liorations sont ajoutÃ©es sur le partitionnement de tables, tant au niveau performance avec l&amp;rsquo;ajout de cas oÃ¹ une jointure directe entre partition peut Ãªtre utilisÃ©e dans une requÃªte, mais aussi de fonctionnalitÃ©s telles queÂ  la gestion des triggers avec le support de la clause BEFORE ou bien encore la rÃ©plication logique sans avoir besoin de publier chaque partition.&lt;/p&gt;&#xA;&lt;h1&gt;Index&lt;/h1&gt;&#xA;&lt;p&gt;LÃ  aussi des amÃ©liorations de performances mais aussi des gains d&amp;rsquo;espace disque sur les index B-tree surtout pour ceux contenant des doublons, mais si vous passez par un pg_upgrade il voudra passer par un reindex pour bÃ©nÃ©ficier de ces changements.&lt;/p&gt;&#xA;&lt;h1&gt;Planificateur&lt;/h1&gt;&#xA;&lt;p&gt;Le planificateur de requÃªte PostgreSQL a lui aussi eu le droit Ã  quelques amÃ©liorations notamment au niveau des statistiques ce qui peut amÃ©liorer les plans d&amp;rsquo;exÃ©cution et donc les performances.&lt;/p&gt;&#xA;&lt;h1&gt;Performance gÃ©nÃ©rale&lt;/h1&gt;&#xA;&lt;p&gt;Les performances ne sont pas en reste dans cette nouvelle version, avec l&amp;rsquo;ajout du &lt;span style=&#34;font-weight: 400;&#34;&gt;tri incrÃ©mentiel ce qui accÃ©lÃ¨re le tri des donnÃ©es dans certains cas, Â sur les agrÃ©gations de hachage qui peuvent dÃ©sormais utiliser le stockage sur disque dans le cadre de grands ensembles d&amp;rsquo;agrÃ©gation, sur la conversion de type entier vers texte.&lt;/span&gt;&lt;/p&gt;&#xA;&lt;h1&gt;Vues systÃ¨me&lt;/h1&gt;&#xA;&lt;p&gt;De nouvelles vues systÃ¨me font leur apparition :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#BASEBACKUP-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_basebackup &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/progress-reporting.html#ANALYZE-PROGRESS-REPORTING&#34;&gt;pg_stat_progress_analyze &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/view-pg-shmem-allocations.html&#34;&gt;pg_shmem_allocations &lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#MONITORING-PG-STAT-SLRU-VIEW&#34;&gt;pg_stat_slru&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;la vue &lt;a href=&#34;https://www.postgresql.org/docs/13/monitoring-stats.html#PG-STAT-ACTIVITY-VIEW&#34;&gt;pg_stat_activity&lt;/a&gt; se voit elle ajoutÃ©e une colonne leader_pid ce qui permet de retrouver rapidementÂ tous les processus impliquÃ©s dans une requÃªte parallÃ¨le.&lt;/p&gt;&#xA;&lt;h1&gt;FonctionnalitÃ©s&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ajout de la fonctionnalitÃ© &lt;a href=&#34;https://www.postgresql.org/docs/13/sql-select.html#SQL-LIMIT&#34;&gt;FETCH FIRST WITH TIES&lt;/a&gt; (vous trouverez &lt;a href=&#34;http://pgphil.ovh/topn_13_beta_01.php&#34;&gt;ici&lt;/a&gt; un exemple)&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la fonction gen_random_uuid() utilisable sans activer dâ€™extensions&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilitÃ© de renommer une colonne d&amp;rsquo;une vue :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;ALTER VIEW [ IF EXISTS ] name RENAME [ COLUMN ] column_name TO new_column_name&lt;/pre&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la fonction .datetime() dans les jsonpath pour convertir automatique une chaÃ®ne en date ou horodatage&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Client psql&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de nouvelles commandes pour afficher la description de classe d&amp;rsquo;opÃ©rateur et famille d&amp;rsquo;opÃ©rateur&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a class=&#34;link&#34; title=&#34;Meta-Commands&#34; href=&#34;https://www.postgresql.org/docs/13/app-psql.html#APP-PSQL-META-COMMANDS&#34;&gt;&lt;code class=&#34;literal&#34;&gt;\dAc&lt;/code&gt;&lt;/a&gt;,Â &lt;code class=&#34;literal&#34;&gt;\dAf&lt;/code&gt;,Â &lt;code class=&#34;literal&#34;&gt;\dAo&lt;/code&gt;, et &lt;code class=&#34;literal&#34;&gt;\dAp&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Ajout du statut de la transaction dans le promptÂ &lt;br /&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;* dans une transaction&lt;/li&gt;&#xA;&lt;li&gt;! dans un Ã©chec de transaction&lt;/li&gt;&#xA;&lt;li&gt;? pour un Ã©tat indÃ©terminÃ© de la transaction&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Administration&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Ajout de la capacitÃ© de la commande VACUUM Ã  traiter des index en parallÃ¨le&lt;/li&gt;&#xA;&lt;li&gt;la commande reindexdb peut aussi parallÃ©liser les tÃ¢ches&lt;/li&gt;&#xA;&lt;li&gt;introduction de la notion de Â« trusted extension Â» qui permet Ã  un super utilisateur de dÃ©finir les extensions quâ€™un utilisateur a le droit d&amp;rsquo;installer dans sa base de donnÃ©es en ayant le droit CREATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout pour pg_dump de l&amp;rsquo;option &amp;#8211;include-foreign-data pour inclure dans la sauvegarde les donnÃ©es de serveurs distants&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;La liste des nouveautÃ©s dans cette version est grande, toutes les nouveautÃ©s n&amp;rsquo;ont pas Ã©tÃ© abordÃ©es mais vous pouvez bien sur les retrouver dans la &lt;a href=&#34;https://www.postgresql.org/docs/13/release-13.html&#34;&gt;note de version&lt;/a&gt;. Le focus a surtout Ã©tÃ© fait sur le cÃ´tÃ© utilisateur plutÃ´t qu&amp;rsquo;administrateur de PostgreSQL.&lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-13/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-13" rel="alternate"></link>
    <summary type="html">&lt;p&gt;MalgrÃ© des actualitÃ©s plutÃ´t moroses au Botswana concernant nos chers Ã©lÃ©phants, il y en a un qui se porte bien et est encore plus fort Ã  savoir PostgreSQL qui sort en version 13 stable ce jeudi 24 septembre 2020.Â  AprÃ¨s... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-13/&#34;&gt;Sortie de PostgreSQL 13&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 11</title>
    <updated>2018-10-19T13:12:39Z</updated>
    <id>tag:blog.atolcd.com,2018-10-19:/sortie-de-postgresql-11/</id>
    <content type="html">&lt;p&gt;AprÃ¨s seulement une release candidate (mais auparavant 4 version bÃªta), PostgreSQL 11 vient de sortir!!!! Et comme Ã  chaque nouvelle version son lot de nouveautÃ©s que nous allons essayer de passer rapidement en revue.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-3169&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg&#34; alt=&#34;&#34; width=&#34;826&#34; height=&#34;540&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11.jpg 826w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-300x196.jpg 300w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-768x502.jpg 768w, https://blog.atolcd.com/wp-content/uploads/2018/10/PostGresql11-600x392.jpg 600w&#34; sizes=&#34;(max-width: 826px) 100vw, 826px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;AmÃ©lioration de la parallÃ©lisation&lt;/h2&gt;&#xA;&lt;p&gt;Quoi de mieux que de commencer le tour des nouveautÃ©s par un sujet que l&amp;rsquo;on a abordÃ© lors du &lt;a href=&#34;https://blog.atolcd.com/conference-la-parallelisation-au-service-de-loptimisation/&#34;&gt;PG Day France 2018&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;PostgreSQL 11 va encore plus loin dans la parallÃ©lisation avec :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;CrÃ©ation d&amp;rsquo;index B-tree en parallÃ¨le&lt;/li&gt;&#xA;&lt;li&gt;ParallÃ©lisation des UNION ALL&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration du Parallel hash join (parallÃ©liser le remplissage dâ€™une seule table de hachage, partagÃ©e) et parallelized sequential scans&lt;/li&gt;&#xA;&lt;li&gt;ParallÃ©lisation sur la crÃ©ation de vue matÃ©rialisÃ©e et table Ã  partir des rÃ©sultats d&amp;rsquo;une requÃªte&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE .. AS, SELECT INTO et CREATE MATERIALIZED VIEW.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un paramÃ¨tre de configuration du serveur Â«Â parallel_leader_participationÂ Â» qui permet de contrÃ´ler si le processus leader participe Ã  l&amp;rsquo;exÃ©cution des sous plans d&amp;rsquo;exÃ©cution&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;AmÃ©lioration du partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilitÃ© de partitionner une table par hashage de clÃ© (en plus des autres)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE hash1 (col1 NUMERIC, col2 VARCHAR(10)) PARTITION BY HASH(col1);&#xD;&#xA;CREATE TABLE hash1a PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 0) ;&#xD;&#xA;CREATE TABLE hash1b PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 1) ;&#xD;&#xA;CREATE TABLE hash1c PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 2) ;&#xD;&#xA;CREATE TABLE hash1d PARTITION OF hash1 FOR VALUES WITH (MODULUS 4, REMAINDER 3) ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout possible d&amp;rsquo;une partition par dÃ©faut pour les donnÃ©es ne correspondant Ã  aucune partition&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table1d PARTITION OF table1 DEFAULT;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;La possibilitÃ© de crÃ©er des clÃ©s primaires, clÃ©s Ã©trangÃ¨res, index et triggers qui seront automatiquement applicables sur l&amp;rsquo;ensemble des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support du changement automatique de partition en cas de mise Ã  jour de la clÃ© de partitionnement&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances lors des SELECT sur la lecture des partitions&lt;/li&gt;&#xA;&lt;li&gt;Support des upsert sur les tables partitionnÃ©es&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;INSERT  INTO  tablep1 (col1, col2) &#xD;&#xA;VALUES  (100,  &#39;update&#39;) &#xD;&#xA;ON  CONFLICT ON CONSTRAINT tablep1_pkey &#xD;&#xA;DO UPDATE SET col2=&#39;update&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Gestion des transactions dans les procÃ©dures stockÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit la possibilitÃ© de crÃ©er des procÃ©dures (en PL/pgSQL, PL/Perl, PL/Python, et PL/Tcl). Depuis de nombreuses annÃ©es, il est possible dans PostgreSQL de crÃ©er des fonctions et bien ici Ã§a y ressemble fortement, sauf que l&amp;rsquo;on ne retourne pas de rÃ©sultats et que l&amp;rsquo;on peut gÃ©rer les transactions !&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PROCEDURE transaction_test1()&#xD;&#xA;LANGUAGE plpgsql&#xD;&#xA;AS $$&#xD;&#xA;BEGIN&#xD;&#xA;  FOR i IN 0..9 LOOP&#xD;&#xA;    INSERT INTO table1 (col1) VALUES (i) ;&#xD;&#xA;    IF i % 2 = 0 THEN&#xD;&#xA;      COMMIT;&#xD;&#xA;    ELSE&#xD;&#xA;      ROLLBACK;&#xD;&#xA;    END IF;&#xD;&#xA;  END LOOP;&#xD;&#xA;END;&#xD;&#xA;$$;&lt;/pre&gt;&lt;p&gt;L&amp;rsquo;exÃ©cution de ces procÃ©dures se fait en utilisant la commande CALL&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CALL transaction_test1();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Compilation JIT&lt;/h2&gt;&#xA;&lt;p&gt;PostgreSQL 11 introduit le support de la compilation Just-in-Time (JIT) pour optimiser lâ€™exÃ©cution de code et dâ€™autres opÃ©rations. Utilisant des composants du projet LLVM, lâ€™introduction de JIT dans PostgreSQL accÃ©lÃ¨re les requÃªtes utilisant des expressions, listes, agrÃ©gats, projections, ainsi que certaines opÃ©rations internes.&lt;/p&gt;&#xA;&lt;p&gt;Pour pouvoir utiliser la compilation JIT, vous devrez installer la dÃ©pendance LLVM puis activer la compilation JIT soit dans le fichier de configuration (jit = on), soit durant votre session en exÃ©cutant SET jit = on.&lt;/p&gt;&#xA;&lt;p&gt;La compilation JIT bÃ©nÃ©ficie surtout aux requÃªtes de longue durÃ©e et limitÃ©es par le processeur. Ce seront souvent des requÃªtes analytiques (OLAP). Pour les requÃªtes courtes, le surcoÃ»t apportÃ© par la compilation JIT sera souvent supÃ©rieur au temps qu&amp;rsquo;elle permet de gagner.&lt;/p&gt;&#xA;&lt;h2&gt;AmÃ©liorations gÃ©nÃ©rales SQL&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de toutes les clauses (SQL:2011) dans les fonctions de fenÃªtrage ce qui permet maintenant lâ€™utilisation de RANGE dans des clauses PRECEDING/FOLLOWING, GROUPS ou dâ€™exclusion&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;WINDOW window_name AS ( &#xD;&#xA;  [ PARTITION BY expression [, ...] ]&#xD;&#xA;  [ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]&#xD;&#xA;  [ frame_clause ]&#xD;&#xA;)&#xD;&#xA;&#xD;&#xA;frame_clause :&#xD;&#xA;{ RANGE | ROWS | GROUPS } frame_start [ frame_exclusion ]&#xD;&#xA;{ RANGE | ROWS | GROUPS } BETWEEN frame_start AND frame_end [ frame_exclusion ]&#xD;&#xA;&#xD;&#xA;frame_start / frame_end :&#xD;&#xA;&#xD;&#xA;UNBOUNDED PRECEDING&#xD;&#xA;offset PRECEDING&#xD;&#xA;CURRENT ROW&#xD;&#xA;offset FOLLOWING&#xD;&#xA;UNBOUNDED FOLLOWING&#xD;&#xA;&#xD;&#xA;frame_exclusion :&#xD;&#xA;&#xD;&#xA;EXCLUDE CURRENT ROW&#xD;&#xA;EXCLUDE GROUP&#xD;&#xA;EXCLUDE TIES&#xD;&#xA;EXCLUDE NO OTHERS&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de fonctions de hash sha-2 : sha224(), sha256(), sha384() et sha512()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions de recherche plein texte : json(b)_to_tsvector() et websearch_to_tsquery()&lt;/li&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;opÃ©rateur ^@ identique Ã  LIKE &amp;lsquo;mot%&amp;rsquo; mais plus efficace sur un index b-tree&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;text ^@ text&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration des index avec l&amp;rsquo;ajout du mot clef INCLUDE, qui permet d&amp;rsquo;indiquer une liste de colonnes qui seront incluses dans l&amp;rsquo;index comme des colonnes non clÃ©s. L&amp;rsquo;ajout de colonnes dans la crÃ©ation d&amp;rsquo;index permet alors l&amp;rsquo;utilisation de parcours d&amp;rsquo;index couvrants.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE [ UNIQUE ] INDEX [ CONCURRENTLY ] [ [ IF NOT EXISTS ] nom ] ON [ ONLY ] nom_table [ USING mÃ©thode ]&#xD;&#xA;    ( { nom_colonne | ( expression ) } [ COLLATE collation ] [ classeop ] [ ASC | DESC ] [ NULLS { FIRST | LAST } ] [, ...] )&#xD;&#xA;    [ INCLUDE ( nom_colonne [, ...] ) ]&#xD;&#xA;    [ WITH ( parametre_stockage = valeur [, ... ] ) ]&#xD;&#xA;    [ TABLESPACE nom_espacelogique ]&#xD;&#xA;    [ WHERE prÃ©dicat ]&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration de lâ€™ordre ALTER TABLE .. ADD COLUMN .. DEFAULT .. avec une valeur par dÃ©faut non NULL nâ€™a plus besoin de rÃ©Ã©crire entiÃ¨rement la table lors de son exÃ©cution, ce qui entraÃ®ne une grosse amÃ©lioration des performances.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Authentification&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de l&amp;rsquo;authentification LDAP, mais celle ci n&amp;rsquo;est utilisÃ©e que pour valider les paires nom d&amp;rsquo;utilisateur/mot de passe. De ce fait, pour pouvoir utiliser LDAP comme mÃ©thode d&amp;rsquo;authentification, l&amp;rsquo;utilisateur doit prÃ©alablement exister dans la base.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;psql&lt;/h2&gt;&#xA;&lt;p&gt;Le client psql Ã©volue lui aussi :&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des commandes Â«Â quitÂ Â» et Â«Â exitÂ Â» dans le client psql&amp;#8230; (fini les personnes prisent de panique pour sortir de leur terminal ??? )&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;img decoding=&#34;async&#34; src=&#34;https://media.giphy.com/media/xTk9ZBWrma4PIC9y4E/giphy.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la commande \gdesc pour afficher les noms et types de colonnes du rÃ©sultat de la requÃªte&lt;/li&gt;&#xA;&lt;li&gt;Ajout de variables pour les erreurs et activitÃ©s des requÃªtes ERROR, SQLSTATE, ROW_COUNT, LAST_ERROR_MESSAGE, and LAST_ERROR_SQLSTATE.&lt;/li&gt;&#xA;&lt;li&gt;Ajout de la possibilitÃ© de tester l&amp;rsquo;existence d&amp;rsquo;une variable par exemple dans un if&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;\if :{?variable_name}&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;AmÃ©lioration de la complÃ©tion dans l&amp;rsquo;Ã©criture de requÃªtes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;En dehors de ces nouveautÃ©s en terme d&amp;rsquo;utilisation, cette nouvelle version apporte aussi des amÃ©liorations de performance et d&amp;rsquo;utilisation de mÃ©moire.&lt;/p&gt;&#xA;&lt;p&gt;Et voilÃ , nous avons fini notre petit tour rapide des nouveautÃ©s de postgreSQL 11, mais ne vous inquiÃ©tez pas une version 12 est dÃ©jÃ  en prÃ©paration pour le troisiÃ¨me trimestre 2019.&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-11/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-11" rel="alternate"></link>
    <summary type="html">&lt;p&gt;AprÃ¨s seulement une release candidate (mais auparavant 4 version bÃªta), PostgreSQL 11 vient de sortir!!!! Et comme Ã  chaque nouvelle version son lot de nouveautÃ©s que nous allons essayer de passer rapidement en revue. AmÃ©lioration de la parallÃ©lisation Quoi de... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-11/&#34;&gt;Sortie de PostgreSQL 11&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Pimp My PostgreSQL</title>
    <updated>2018-01-26T11:07:23Z</updated>
    <id>tag:blog.atolcd.com,2018-01-26:/pimp-my-postgresql/</id>
    <content type="html">&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignright wp-image-2934&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pimp-my-postgresql.png&#34; alt=&#34;&#34; width=&#34;491&#34; height=&#34;290&#34; /&gt;Une question qui se pose souvent aprÃ¨s l&amp;rsquo;installation d&amp;rsquo;une instance postgreSQL, c&amp;rsquo;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par dÃ©faut, ce qui ne va pas poser vraiment de problÃ¨me pour une utilisation lÃ©gÃ¨re. Mais si on a une instance postgreSQL avec postGIS et des millions d&amp;rsquo;enregistrements, cela va rapidement se trouver problÃ©matique si on laisse les valeurs par dÃ©faut&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;Pour les initiÃ©s qui installent rÃ©guliÃ¨rement de nouvelles instances postgreSQL, se plonger dans les plus de 600 lignes du fichier de configuration par dÃ©faut ne les effraie pas. Mais on n&amp;rsquo;installe pas forcÃ©ment tous les jours un nouveau serveur avec des caractÃ©ristiques diffÃ©rentes. Il faut donc soit se replonger pour une centiÃ¨me fois dans la documentation de postgres pour se rappeler Ã  notre bonne mÃ©moire les diffÃ©rents paramÃ¨tres et les valeurs Ã  adapter en fonction de la ram, disque, cpu&amp;#8230;&lt;/p&gt;&#xA;&lt;p&gt;En plus de devoir se rappeler les &lt;strong&gt;paramÃ¨tres Ã  modifier,&lt;/strong&gt; il faut aussi connaÃ®tre les &lt;strong&gt;rÃ¨gles de calcul &lt;/strong&gt;pour les valeurs comme par exemple le Â«Â effective_cache_sizeÂ Â» qui est prÃ©conisÃ© Ã  75% de la ram total du serveur si celui-ci est dÃ©diÃ© Ã  postgres.&lt;/p&gt;&#xA;&lt;p&gt;Le but de cet article n&amp;rsquo;est pas de voir ni de dÃ©tailler tous les paramÃ¨tres de configuration possibles et inimaginables, mais de voir cela comme un mÃ©mo pour les initiÃ©s ou de sâ€™interroger sur les &lt;strong&gt;paramÃ¨tres qui seraient potentiellement Ã  modifier en fonction du serveur&lt;/strong&gt; (et des applications qui l&amp;rsquo;utilisent) si l&amp;rsquo;on ne connait pas l&amp;rsquo;utilisation des paramÃ¨tres de ce fichier postgresql.conf.&lt;/p&gt;&#xA;&lt;p&gt;Pour cela un petit outil a Ã©tÃ© conÃ§u par Cybertec, qui permet de renseigner quelques caractÃ©ristiques et de voir Ã©voluer en consÃ©quence le fichier postgresql.conf notamment en fonction de la ram du serveur, du nombre de cpu, de la taille de la base&amp;#8230; etc.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;alignnone size-full wp-image-2925&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png&#34; alt=&#34;&#34; width=&#34;1005&#34; height=&#34;993&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator.png 1005w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-300x296.png 300w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-768x759.png 768w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-945x934.png 945w, https://blog.atolcd.com/wp-content/uploads/2018/01/pgconfigurator-600x593.png 600w&#34; sizes=&#34;auto, (max-width: 1005px) 100vw, 1005px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cela ne remplace pas une connaissance aguerrie de postgreSQL et de sa configuration mais Ã§a permet de se faire une idÃ©e des paramÃ¨tres Ã  adapter en fonction de son serveur et de ses besoins.&lt;/p&gt;&#xA;&lt;p&gt;Cet outil est disponible en ligne Ã  cette adresse : &lt;a href=&#34;http://pgconfigurator.cybertec.at/&#34;&gt;http://pgconfigurator.cybertec.at/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/pimp-my-postgresql/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=pimp-my-postgresql" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Une question qui se pose souvent aprÃ¨s l&amp;#8217;installation d&amp;#8217;une instance postgreSQL, c&amp;#8217;est comment configurer ce fichier postgresql.conf. Dans le doute souvent, beaucoup de personnes conservent la configuration par dÃ©faut, ce qui ne va pas poser vraiment de problÃ¨me pour une... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/pimp-my-postgresql/&#34;&gt;Pimp My PostgreSQL&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Sortie de PostgreSQL 10</title>
    <updated>2017-10-05T13:28:32Z</updated>
    <id>tag:blog.atolcd.com,2017-10-05:/sortie-de-postgresql-10/</id>
    <content type="html">&lt;p&gt;Aujourd&amp;rsquo;hui, c&amp;rsquo;est la sortie de &lt;strong&gt;PostgreSQL 10&lt;/strong&gt;!!!! PremiÃ¨re rÃ©volution, la numÃ©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures Ã  10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des donnÃ©es. Une opÃ©ration beaucoup plus lourde que la seule mise Ã  jour des exÃ©cutables !&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2788&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg&#34; alt=&#34;&#34; width=&#34;558&#34; height=&#34;337&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10.jpg 558w, https://blog.atolcd.com/wp-content/uploads/2017/10/postgresql-10-300x181.jpg 300w&#34; sizes=&#34;auto, (max-width: 558px) 100vw, 558px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Voici quelques dÃ©tails sur cette&lt;strong&gt; nouvelle version 10&lt;/strong&gt; et ce qu&amp;rsquo;elle apporte :&lt;/p&gt;&#xA;&lt;h2&gt;Performance et partitionnement&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Le partitionnement de table est maintenant un attribut de la table :&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE table_name ( ... )&#xD;&#xA;[ PARTITION BY { RANGE | LIST } ( { column_name | ( expression ) }&#xD;&#xA;&#xD;&#xA;CREATE TABLE table_name&#xD;&#xA;PARTITION OF parent_table [ (&#xD;&#xA;) ] FOR VALUES partition_bound_spec&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;PostgreSQL 10 va plus loin dans la parallÃ©lisation avec le parallÃ©lisme des Index-Only Scan, Index Scan, Bitmap Heap Scan, Merge Join / Gather Merge, Subplan-Related Improvements&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances pour les agrÃ©gats et jointures avec &lt;code&gt;postgres_fdw&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances de l&amp;rsquo;analyseur de requÃªte&lt;/li&gt;&#xA;&lt;li&gt;Apparition des statistiques multi-colonnes&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration du plan dâ€™exÃ©cution des requÃªtes&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;RÃ©plication et scalabilitÃ©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;RÃ©plication logique : lÃ©gÃ¨re et basÃ©e sur les WAL, rÃ©pliquant les objets individuellement via les commandes PUBLICATION (primaire) et SUBSCRIPTION (secondaire)&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE PUBLICATION financials FOR TABLE ONLY loans, ONLY fines;&lt;/pre&gt;&lt;br /&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE SUBSCRIPTION financials&#xD;&#xA;CONNECTION &#39;dbname=libdata user=postgres host=172.17.0.2&#39;&#xD;&#xA;PUBLICATION financials;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;QUORUM replication : avec ANY et FIRST pour synchronous_standby_names;&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;synchronous_standby_names = ANY 2(node1,node2,node3);&#xD;&#xA;synchronous_standby_names = FIRST 2(node1,node2);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Suppression automatique Ã  la fin de la session des slots de rÃ©plication temporaires&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration de libpq permettant des connexions a de multiples systÃ¨mes&lt;/li&gt;&#xA;&lt;li&gt;AmÃ©lioration des performances de la rÃ©plication physique&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Administration&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Support de la compression pour pg_receivewal&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;informations sur les Background processes et Wait Events dans pg_stat_activity&lt;/li&gt;&#xA;&lt;li&gt;Ajout de fonctions qui remontent Ã  l&amp;rsquo;utilisateur des informations sur le status de transaction. L&amp;rsquo;usage principal de ces fonctions est de dÃ©terminer les transactions commitÃ©es entre deux snapshots.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;txid_status(bigint)&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;FonctionnalitÃ©s SQL et dÃ©veloppeurs&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Gestion de colonne Identity qui vise Ã  remplacer l&amp;rsquo;utilisation du type serial et qui est conforme au standard SQL&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TABLE test_new (&#xD;&#xA;    id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,&#xD;&#xA;    payload text&#xD;&#xA;);&lt;/pre&gt;&lt;p&gt;plus d&amp;rsquo;informations sur ce sujet &lt;a href=&#34;https://blog.2ndquadrant.com/postgresql-10-identity-columns/&#34;&gt;ici par exemple&lt;/a&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;PossibilitÃ© de renommer la valeur d&amp;rsquo;une Ã©numÃ©ration&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TYPE langage AS ENUM (&#39;SQL&#39;, &#39;JAVA&#39;, &#39;HTML&#39;) ;&#xD;&#xA;ALTER TYPE langage RENAME VALUE &#39;HTML&#39; TO &#39;HTML5&#39; ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout des triggers AFTER STATEMENT qui peuvent avoir accÃ¨s Ã  lâ€™ensemble des lignes modifiÃ©es, avant et aprÃ¨s changement, Ã  travers une pseudo-variable de type table&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE TRIGGER nom_trigger AFTER DELETE ON nom_table&#xD;&#xA;REFERENCING OLD TABLE AS OLD&#xD;&#xA;FOR EACH STATEMENT&#xD;&#xA;EXECUTE PROCEDURE nom_procedure();&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de la fonction xmltable qui produit une table basÃ©e sur la valeur XML donnÃ©e.&lt;/li&gt;&#xA;&lt;li&gt;Supprimer des Ã©lÃ©ments d&amp;rsquo;un JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;SELECT &#39;{&#34;a&#34;:1 , &#34;b&#34;:2, &#34;c&#34;:3}&#39;::jsonb - &#39;{a,c}&#39;::text[] ;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Il est possible de crÃ©er des indexes full text sur une colonne JSON ou JSONB&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE INDEX bookdata_fts ON bookdata&#xD;&#xA;USING gin (( to_tsvector(&#39;english&#39;,bookdata) ));&#xD;&#xA;&#xD;&#xA;SELECT bookdata -&amp;gt; &#39;title&#39;&#xD;&#xA;FROM bookdata&#xD;&#xA;WHERE to_tsvector(&#39;english&#39;,bookdata) @@ to_tsquery(&#39;duke&#39;);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;SÃ©curitÃ©&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Authentification SCRAM plus sÃ©curisÃ©e que md5&lt;/li&gt;&#xA;&lt;li&gt;CrÃ©ation de nouveau rÃ´le pour le monitoring Ã©vitant ainsi d&amp;rsquo;Ãªtre super utilisateur&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;pg_read_all_settings : Lit toutes les variables de configuration, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_read_all_stats : Lit toutes les vues pg_stat_* et utilise plusieurs extensions relatives aux statistiques, y compris celles normalement visibles des seuls super-utilisateurs.&#xD;&#xA;pg_stat_scan_tables : ExÃ©cute des fonctions de monitoring pouvant prendre des verrous verrous ACCESS SHARE sur les tables, potentiellement pour une longue durÃ©e.&#xD;&#xA;pg_monitor : Lit et exÃ©cute plusieurs vues et fonctions de monitoring. Ce rÃ´le est membre de pg_read_all_settings, pg_read_all_stats et pg_stat_scan_tables.&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;Ajout de politiques restrictive dans les politiques de sÃ©curitÃ© pour l&amp;rsquo;accÃ¨s aux lignes et plus seulement de politiques permissives&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;/p&gt;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE POLICY admin_local_only ON passwd AS RESTRICTIVE TO admin&#xD;&#xA;    USING (pg_catalog.inet_client_addr() IS NULL);&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Autres fonctionnalitÃ©s&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;file_fdw peut maintenant utiliser les programmes&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE FOREIGN TABLE&#xD;&#xA;   test(a int, b text)&#xD;&#xA;   SERVER csv&#xD;&#xA;   OPTIONS (program &#39;gunzip -c /tmp/data.czv.gz&#39;);&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;support des collations ICU&lt;/li&gt;&#xA;&lt;li&gt;Ajout d&amp;rsquo;un module amcheck permettant de vÃ©rifier cohÃ©rence / corruption d&amp;rsquo;un index B-Tree&lt;/li&gt;&#xA;&lt;li style=&#34;list-style-type: none;&#34;&gt;&#xA;&lt;pre class=&#34;crayon-plain-tag&#34;&gt;CREATE EXTENSION amcheck ;&#xD;&#xA;   SELECT bt_index_check(&#39;idx1_check1&#39;) ;&lt;/pre&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2&gt;Modifications entrainant une incompatibilitÃ© ascendante&lt;/h2&gt;&#xA;&lt;ul style=&#34;list-style-type: disc;&#34;&gt;&#xA;&lt;li&gt;â€œxlogâ€ et â€œclogâ€ qui deviennent respectivement â€œwalâ€ et â€œxactâ€.&lt;/li&gt;&#xA;&lt;li&gt;fin du support du protocole client/serveur 1.0 (clients datant dâ€™avant la version 6.3)&lt;/li&gt;&#xA;&lt;li&gt;changement de valeurs par dÃ©faut pour pg_basebackup&lt;/li&gt;&#xA;&lt;li&gt;fin du support des TIMESTAMP avec floating point.&lt;/li&gt;&#xA;&lt;li&gt;Le module contrib/tsearch2 a Ã©tÃ© supprimÃ© qui permettait une comptabilitÃ© avec les fonction de recherche full text avant la version 8.3&lt;/li&gt;&#xA;&lt;li&gt;fin du support de la commande pg_dump pour les bases de donnÃ©es plus anciennes que la version 8.0&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&#xA;&lt;p&gt;Et voilÃ , nous avons fini notre petit tour rapide des nouveautÃ©s de postgreSQL 10 mais une version 11 est dÃ©jÃ  prÃ©vue pour dans 12 mois !&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/sortie-de-postgresql-10/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=sortie-de-postgresql-10" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Aujourd&amp;#8217;hui, c&amp;#8217;est la sortie de PostgreSQL 10!!!! PremiÃ¨re rÃ©volution, la numÃ©rotation des versions : on passe de 9.4&amp;#8230;9.6 pour les versions majeures Ã  10, 11, 12&amp;#8230; Ce point est important car un changement de version majeure implique une migration des... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/sortie-de-postgresql-10/&#34;&gt;Sortie de PostgreSQL 10&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Nouveau module dâ€™export de donnÃ©es pour REMOcRA</title>
    <updated>2017-05-12T13:52:26Z</updated>
    <id>tag:blog.atolcd.com,2017-05-12:/nouveau-module-dexport-de-donnees-remocra/</id>
    <content type="html">&lt;h1&gt;Objectif du module&lt;/h1&gt;&#xA;&lt;p&gt;Le SDIS du Var ne disposait pas jusqu&amp;rsquo;Ã  ce jour, Ã  travers la plate-forme collaborative &lt;a href=&#34;http://sdis.atolcd.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;REMOcRA&lt;/a&gt;, d&amp;rsquo;une mÃ©thode simple pour exporter le contenu de la base de donnÃ©es auprÃ¨s de ses partenaires. Les demandes Ã©tant de plus en plus rÃ©currentes, le SDIS du Var a dÃ©cidÃ© &lt;strong&gt;de faire Ã©voluer l&amp;rsquo;application pour l&amp;rsquo;enrichir d&amp;rsquo;un module dÃ©diÃ© aux exports&lt;/strong&gt; et a confiÃ© Ã  Atol Conseils et DÃ©veloppements sa rÃ©alisation en veillant Ã  respecter les besoins suivants :&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;En tant qu&amp;rsquo;administrateur de l&amp;rsquo;extranet, Ãªtre en mesure de rÃ©aliser facilement des exports de donnÃ©es en se basant sur des modÃ¨les administrables. Ce module devait Ãªtre en mesure de produire des fichiers tabulaires ou des fichiers gÃ©ographiques.&lt;/li&gt;&#xA;&lt;li&gt;En tant que partenaire, Ãªtre en mesure d&amp;rsquo;exporter soit mÃªme les donnÃ©es mises Ã  disposition par le SDIS sur un territoire autorisÃ©.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1&gt;Comment Ã§a marche ?&lt;/h1&gt;&#xA;&lt;h2&gt;Un fonctionnement basÃ© sur des modÃ¨les d&amp;rsquo;exports&lt;/h2&gt;&#xA;&lt;p&gt;Le mÃ©canisme d&amp;rsquo;export repose sur des modÃ¨les. Ces derniers peuvent Ãªtre rÃ©fÃ©rencÃ©s directement par les administrateurs de la plate-forme REMOcRA grÃ¢ce Ã  des fichiers de dÃ©finition de modÃ¨le (format XML) dÃ©posÃ©s fia FTP dans un sous-dossier de REMOcRA.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-large wp-image-2626&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-1024x220.png&#34; alt=&#34;&#34; width=&#34;676&#34; height=&#34;145&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-1024x220.png 1024w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-300x64.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-768x165.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-945x203.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1-600x129.png 600w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-1.png 1067w&#34; sizes=&#34;auto, (max-width: 676px) 100vw, 676px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Le fichier XML prÃ©cise principalement la requÃªte SQL Ã  utiliser pour filtrer et formater les donnÃ©es Ã  la bonne structure. L&amp;rsquo;attribut spatial du nÅ“ud racine permet de prÃ©ciser si l&amp;rsquo;export est de type tabulaire (CSV) ou gÃ©ographique (Esri Shapefile). Dans le cas d&amp;rsquo;un export gÃ©ographique, la colonne Â« wkt Â» contenant la gÃ©omÃ©trie encodÃ©e en WKT est exploitÃ©e.&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2627&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2.png&#34; alt=&#34;&#34; width=&#34;822&#34; height=&#34;341&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2.png 822w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2-300x124.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2-768x319.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-2-600x249.png 600w&#34; sizes=&#34;auto, (max-width: 822px) 100vw, 822px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;Le rÃ©fÃ©rencement des modÃ¨les est rÃ©alisÃ© directement depuis l&amp;rsquo;interface en exÃ©cutant depuis REMOcRAÂ le traitement Â« RÃ©fÃ©rencer les modÃ¨les d&amp;rsquo;export de donnÃ©es Â» disponible dans la catÃ©gorie d&amp;rsquo;applications Â« Divers Â»&lt;/p&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2628&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3.png&#34; alt=&#34;&#34; width=&#34;968&#34; height=&#34;288&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3.png 968w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-300x89.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-768x228.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-945x281.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-3-600x179.png 600w&#34; sizes=&#34;auto, (max-width: 968px) 100vw, 968px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Un traitement spÃ©cifique intÃ©grant le filtrage spatial des donnÃ©es&lt;/h2&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-large wp-image-2629&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-1024x525.png&#34; alt=&#34;&#34; width=&#34;676&#34; height=&#34;347&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-1024x525.png 1024w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-300x154.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-768x394.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-945x484.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4-600x307.png 600w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-4.png 1167w&#34; sizes=&#34;auto, (max-width: 676px) 100vw, 676px&#34; /&gt;&lt;/p&gt;&#xA;&lt;p&gt;La rÃ©alisation d&amp;rsquo;un export de donnÃ©es depuis le systÃ¨me REMOcRAÂ se base sur le mÃ©canisme suivant :&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;L&amp;rsquo;utilisateur de profil Â« administrateur Â» dispose d&amp;rsquo;un nouveau traitement intitulÃ© Â« Exporter les donnÃ©es Ã  partir d&amp;rsquo;un modÃ¨le Â». Ce dernier permet de rÃ©aliser des exports de donnÃ©es en s&amp;rsquo;appuyant sur la liste de modÃ¨les.&lt;/li&gt;&#xA;&lt;li&gt;AprÃ¨s avoir choisi son modÃ¨le, la demande d&amp;rsquo;export formulÃ©e par l&amp;rsquo;utilisateur est stockÃ©e en file d&amp;rsquo;attente. Une tÃ¢che planifiÃ©e vÃ©rifie rÃ©guliÃ¨rement la prÃ©sence de demandes en attente&lt;/li&gt;&#xA;&lt;li&gt;Lors de lâ€™exÃ©cution de la tÃ¢che planifiÃ©e, le moteur ETL exÃ©cute les demandes d&amp;rsquo;export en attente en s&amp;rsquo;appuyant sur les informations contenues dans le modÃ¨le pour gÃ©nÃ©rer un fichier CSV (dans le cas de donnÃ©es non gÃ©ographiques) ou des fichiers de formes (fichiers ESRI Shapefile).&lt;/li&gt;&#xA;&lt;li&gt;A l&amp;rsquo;issu du traitement, les fichiers produits sont compressÃ©s au format ZIP et un lien de tÃ©lÃ©chargement est fourni dans un mÃ©l envoyÃ© au demandeur du traitement.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; class=&#34;aligncenter size-full wp-image-2630&#34; src=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5.png&#34; alt=&#34;&#34; width=&#34;962&#34; height=&#34;367&#34; srcset=&#34;https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5.png 962w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-300x114.png 300w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-768x293.png 768w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-945x361.png 945w, https://blog.atolcd.com/wp-content/uploads/2017/05/billet-remocra-5-600x229.png 600w&#34; sizes=&#34;auto, (max-width: 962px) 100vw, 962px&#34; /&gt;&lt;/p&gt;&#xA;&lt;h2&gt;Une mutualisation des connaissances !&lt;/h2&gt;&#xA;&lt;p&gt;Le SDIS du Var (83), Ã  l&amp;rsquo;initiative de la plate-forme collaborative mÃ©tier REMOcRA, a dÃ©cidÃ© de faire bÃ©nÃ©ficier ses confrÃ¨res de sa dÃ©marche en redistribuant gratuitement l&amp;rsquo;outil et ce module sous licence Creative Commons.&lt;br /&gt;&#xA;Dans cette dÃ©marche open source, la solution et le nouveau module sont disponibles sur Github pour installation et test Ã  tous les SDIS sur &lt;a href=&#34;https://github.com/atolcd/sdis-remocra&#34; target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;https://github.com/atolcd/sdis-remocra&lt;/a&gt;. Pour plus d&amp;rsquo;information sur la solution REMOcRA, consulter &lt;a href=&#34;http://sdis.atolcd.com&#34; target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;http://sdis.atolcd.com&lt;/a&gt;&lt;br /&gt;&#xA;&lt;em&gt;REMOcRA est cofinancÃ© par lâ€™Union europÃ©enne. Lâ€™Europe sâ€™engage avec le Fonds europÃ©en de dÃ©veloppement rÃ©gional.&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/&#34;&gt;Nouveau module d&amp;rsquo;export de donnÃ©es pour REMOcRA&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</content>
    <link href="https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=nouveau-module-dexport-de-donnees-remocra" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Objectif du module Le SDIS du Var ne disposait pas jusqu&amp;#8217;Ã  ce jour, Ã  travers la plate-forme collaborative REMOcRA, d&amp;#8217;une mÃ©thode simple pour exporter le contenu de la base de donnÃ©es auprÃ¨s de ses partenaires. Les demandes Ã©tant de plus... &lt;a class=&#34;more-link&#34; href=&#34;https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/&#34;&gt;Continue Reading &amp;#8594;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cet article &lt;a href=&#34;https://blog.atolcd.com/nouveau-module-dexport-de-donnees-remocra/&#34;&gt;Nouveau module d&amp;rsquo;export de donnÃ©es pour REMOcRA&lt;/a&gt; est apparu en premier sur &lt;a href=&#34;https://blog.atolcd.com&#34;&gt;Atol Open Blog&lt;/a&gt;.&lt;/p&gt;&#xA;</summary>
    <author>
      <name>Caroline Chanlon</name>
    </author>
  </entry>
  <entry>
    <title>Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity</title>
    <updated>2020-03-08T05:33:26Z</updated>
    <id>tag:rjuju.github.io,2020-03-08:/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html</id>
    <content type="html">&lt;h3 id=&#34;nouvelle-colonne-leader_pid-dans-la-vue-pg_stat_activity&#34;&gt;Nouvelle colonne leader_pid dans la vue pg_stat_activity&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ã‰tonnamment, depuis que les requÃªtes parallÃ¨les ont Ã©tÃ© ajoutÃ©es dans&#xA;PostgreSQL 9.6, il Ã©tait impossible de savoir Ã  quel processus client Ã©tait liÃ©&#xA;un worker parallÃ¨le.  Ainsi, comme &lt;a href=&#34;https://twitter.com/g_lelarge/status/1209486212190343168&#34;&gt;Guillaume lâ€™a fait&#xA;remarquer&lt;/a&gt;, it makes&#xA;il est assez difficile de construire des outils simples permettant&#xA;dâ€™Ã©chantillonner les Ã©vÃ©nements dâ€™attente liÃ©s Ã  tous les processus impliquÃ©s&#xA;dans une requÃªte.  Une solution simple Ã  ce problÃ¨me est dâ€™exporter&#xA;lâ€™information de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;lock group leader&lt;/code&gt; disponible dans le processus client au&#xA;niveau SQL :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit b025f32e0b5d7668daec9bfa957edf3599f4baa8&#xA;Author: Michael Paquier &amp;lt;michael@paquier.xyz&amp;gt;&#xA;Date:   Thu Feb 6 09:18:06 2020 +0900&#xA;&#xA;Add leader_pid to pg_stat_activity&#xA;&#xA;This new field tracks the PID of the group leader used with parallel&#xA;query.  For parallel workers and the leader, the value is set to the&#xA;PID of the group leader.  So, for the group leader, the value is the&#xA;same as its own PID.  Note that this reflects what PGPROC stores in&#xA;shared memory, so as leader_pid is NULL if a backend has never been&#xA;involved in parallel query.  If the backend is using parallel query or&#xA;has used it at least once, the value is set until the backend exits.&#xA;&#xA;Author: Julien Rouhaud&#xA;Reviewed-by: Sergei Kornilov, Guillaume Lelarge, Michael Paquier, Tomas&#xA;Vondra&#xA;Discussion: https://postgr.es/m/CAOBaU_Yy5bt0vTPZ2_LUM6cUcGeqmYNoJ8-Rgto+c2+w3defYA@mail.gmail.com&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Avec cette modification, il est maintenant trÃ¨s simple de trouver tous les&#xA;processus impliquÃ©s dans une requÃªte parallÃ¨le.  Par exemple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;  &lt;span class=&#34;n&#34;&gt;array_agg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_activity&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;GROUP&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;       &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leader_pid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-------------------+------------+---------------&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;      &lt;span class=&#34;mi&#34;&gt;31630&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32269&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32268&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Attention toutefois, comme indiquÃ© dans le message de commit, si la colonne&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;leader_pid&lt;/code&gt; Ã  la mÃªme valeur que la colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pid&lt;/code&gt;, cela ne veut pas forcÃ©ment&#xA;dire que le processus client est actuellement en train dâ€™effectuer une requÃªte&#xA;parallÃ¨le, car une fois que le champ est positionnÃ© il nâ€™est jamais&#xA;rÃ©initialisÃ©.  De plus, pour Ã©viter tout surcoÃ»t, aucun verrou supplÃ©mentaire&#xA;nâ€™est maintenu lors de lâ€™affichage de ces donnÃ©es.  Cela veut dire que chaque&#xA;ligne est traitÃ©e indÃ©pendamment.  Ainsi, bien que cela soit fort peu probable,&#xA;vous pouvez obtenir des donnÃ©es incohÃ©rentes dans certaines circonstances,&#xA;comme par exemple un worker paralÃ¨lle pointant vers un pid qui est dÃ©jÃ &#xA;dÃ©connectÃ©.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html&#34;&gt;Nouveau dans pg13: Colonne leader_pid dans pg_stat_activity&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on March 08, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/03/08/nouveau-dans-pg13-leader_pid.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>pgÂ qualstats 2: Suggestion d&#39;index globale</title>
    <updated>2020-01-06T12:23:29Z</updated>
    <id>tag:rjuju.github.io,2020-01-06:/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html</id>
    <content type="html">&lt;p&gt;Parvenir Ã  une suggestion dâ€™index de qualitÃ© peut Ãªtre une tÃ¢che complexe.&#xA;Cela nÃ©cessite Ã  la fois une connaissance des requÃªtes applicatives et des&#xA;spÃ©cificitÃ©s de la base de donnÃ©es.  Avec le temps de nombreux projets ont&#xA;essayÃ© de rÃ©soudre ce problÃ¨me, lâ€™un dâ€™entre eux Ã©tant &lt;a href=&#34;https://powa.readthedocs.io/&#34;&gt;PoWA version&#xA;3&lt;/a&gt;, avec lâ€™aide de &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_qualstats.html&#34;&gt;pg_qualstats&#xA;extension&lt;/a&gt;.&#xA;Cet outil donne de plutÃ´t bonnes suggestions dâ€™index, mais il est nÃ©cessaire&#xA;dâ€™installer et configurer PoWA, alors que certains utilisateurs aimeraient&#xA;nâ€™avoir que la suggestion dâ€™index globale.  Pour rÃ©pondre Ã  ce besoin de&#xA;simplicitÃ©, lâ€™algorithme utilisÃ© dans PoWA est maintenant disponible dans&#xA;pg_qualstats version 2, sans avoir besoin dâ€™utiliser des composants&#xA;additionnels.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;EDIT: La fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_qualstats_index\_advisor()&lt;/code&gt; a Ã©tÃ© changÃ©e pour retourner&#xA;du &lt;strong&gt;json&lt;/strong&gt; plutÃ´t que du &lt;strong&gt;jsonb&lt;/strong&gt;, afin de conserver la compatibilitÃ© avec PostgreSQL&#xA;9.3.  Les requÃªtes dâ€™exemples sont donc Ã©galement modifiÃ©es pour utiliser&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;json_array_elements()&lt;/code&gt; plutÃ´t que &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;jsonb_array_elements()&lt;/code&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;quest-ce-que-pg_qualstats&#34;&gt;Quâ€™est-ce que pg_qualstats&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une maniÃ¨re simple dâ€™expliquer ce quâ€™est pg_qualstats serait de dire quâ€™il&#xA;sâ€™agit dâ€™une extension similaire Ã &#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/pgstatstatements.html&#34;&gt;pg_stat_statements&lt;/a&gt;&#xA;mais travaillant au niveaux des prÃ©dicats.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cette extension sauvegarde des statistiques utiles pour les clauses &lt;strong&gt;WHERE&lt;/strong&gt;&#xA;et &lt;strong&gt;JOIN&lt;/strong&gt; : Ã  quelle table et quelle colonne un prÃ©dicat fait rÃ©fÃ©rÃ©nce, le&#xA;nombre de fois quâ€™un prÃ©dicat a Ã©tÃ© utilisÃ©, le nombre dâ€™exÃ©cutions de&#xA;lâ€™opÃ©rateur sous-jacent, si le prÃ©dicat provient dâ€™un parcours dâ€™index ou non,&#xA;la sÃ©lectivitÃ©, la valeur des constantes et bien plus encore.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il est possible de dÃ©duire beaucoup de choses depuis ces informations.  Par&#xA;exemple, si vous examinez les prÃ©dicats qui contiennent des rÃ©fÃ©rences Ã  des&#xA;tables diffÃ©rentes, vous pouvez trouver quelles tables sont jointes ensembles,&#xA;et Ã  quel point les conditions de jointures sont sÃ©lectives.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;suggestion-globale-&#34;&gt;Suggestion Globale ?&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Comment je lâ€™ai mentionnÃ©, la suggestion dâ€™index globale ajoutÃ©e dans&#xA;pg_qualstats 2 utilise la mÃªme approche que celle de PoWA, ainsi cet article&#xA;peut servir Ã  dÃ©crire le fonctionnement des deux outils.  La seule diffÃ©rence&#xA;est que vous obtiendrez probablement une suggestion de meilleure qualitÃ© avec&#xA;PoWA, puisque plus de prÃ©dicats seront disponibles, et que vous pourrez&#xA;Ã©galement choisir sur quel intervalle de temps vous souhaitez effectuer une&#xA;suggestion dâ€™index manquants.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La chose importante Ã  retenir ici est quâ€™il sâ€™agit dâ€™une suggestion effectuÃ©e&#xA;de maniÃ¨re &lt;strong&gt;globale&lt;/strong&gt;, câ€™est-Ã -dire en prenant en compte tous les prÃ©dicats&#xA;intÃ©ressant en mÃªme temps.  Cette approche est diffÃ©rente de toutes les autres&#xA;dont jâ€™ai connaissance, qui ne prennent en compte quâ€™une seule requÃªte Ã  la&#xA;fois.  Selon moi, une approche globale est meilleure, car il est possible de&#xA;rÃ©duire le nombre total dâ€™index, en maximisant lâ€™efficacitÃ© des index&#xA;multi-colonnes.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;comment-marche-la-suggestion-globale&#34;&gt;Comment marche la suggestion globale&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;La premiÃ¨re Ã©tape consiste Ã  rÃ©cupÃ©rer tous les prÃ©dicats qui pourraient&#xA;bÃ©nÃ©ficier de nouveaux index.  Câ€™est particuliÃ¨rement facile Ã  obtenir avec&#xA;pg_qualstats.  En filtrant les prÃ©dicats venant dâ€™un parcours sÃ©quentiel,&#xA;exÃ©cutÃ©s de nombreuses fois et qui filtrent de nombreuses lignes (Ã  la fois en&#xA;nombre et en pourcentage), vous obtenez une liste parfaite de prÃ©dicats qui&#xA;auraient trÃ¨s probablement besoin dâ€™un index (ou alors dans certains cas une&#xA;liste des requÃªtes mal Ã©crites).  Voyons regardons par exemple le cas dâ€™une&#xA;applications qui utiliserait ces 4 prÃ©dicats:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_1_quals.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_1_quals.png&#34; alt=&#34;Liste de tous les prÃ©dicats&#xA;trouvÃ©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, il faut construire lâ€™ensemble entier des chemins de toutes les&#xA;prÃ©dicats joints par un AND logique, qui contiennent dâ€™autres prÃ©dicats, qui&#xA;peuvent Ãªtre eux-meme Ã©galement joints par des AND logiques.  En utilisants les&#xA;mÃªme 4 prÃ©dicats vus prÃ©cÃ©demments, nous obtenons ces chemins :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_2_graphs.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_2_graphs.png&#34; alt=&#34;Construction de tous les chemins de prÃ©dicats&#xA;possibles&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois tous les chemins construits, il suffit dâ€™obtenir le meilleur chemin&#xA;pour trouver le meilleur index Ã  suggÃ©rer.  Le classement de ces chemins est&#xA;pour le moment fait en donnant un poids Ã  chaque nÅ“ud de chaque chemin qui&#xA;correspond au nombre de prÃ©dicats simple quâ€™il contient, et en additionnant le&#xA;poids pour chaque chemin.  Câ€™est une approche trÃ¨s simple, et qui permet de&#xA;favoriser un nombre minimal dâ€™index qui optimisent le plus de requÃªtes&#xA;possible.  Avec nos exemple, nous obtenons :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/global_advisor_3_weighted.png&#34;&gt;&lt;img src=&#34;/images/global_advisor_3_weighted.png&#34; alt=&#34;Ajout d&#39;un poids Ã  tous les chemins et choix du score le plus&#xA;haut&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, dâ€™autres approches de classement pourraient Ãªtre utilisÃ©e pour&#xA;prendre en compte dâ€™autres paramÃ¨tres, et potentiellement obtenir une meilleur&#xA;suggestion.  Par exemple, en prenant en compte Ã©galement le nombre dâ€™exÃ©cution&#xA;ou la sÃ©lectivitÃ© des prÃ©dicats.  Si le ratio de lecture/Ã©criture pour chaque&#xA;table est connu (ce qui est disponible avec lâ€™extension&#xA;&lt;a href=&#34;https://github.com/powa-team/powa-archivist&#34;&gt;powa-archivist&lt;/a&gt;), il serait&#xA;Ã©galement possible dâ€™adapter le classement pour limiter la suggestion dâ€™index&#xA;pour les tables qui ne sont accÃ©dÃ©es presque exclusivement en Ã©criture.  Avec&#xA;cet algorithme, ces ajustements seraient relativement simples Ã  faire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une fois que le meilleur chemin est trouvÃ©, on peut gÃ©nÃ©rer lâ€™ordre de crÃ©ation&#xA;de lâ€™index !  Comme lâ€™ordre des colonnes peut Ãªtre important, lâ€™ordre est&#xA;gÃ©nÃ©rÃ© en rÃ©cupÃ©rant les colonnes de chaque nÅ“ud par poids croissant.  Avec&#xA;notre exemple, lâ€™index suivant est gÃ©nÃ©rÃ© :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INDEX&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Une fois que lâ€™index est trouvÃ©, on supprime simplement les prÃ©dicats contenus&#xA;de la liste globale de prÃ©dicats et on reprendre de zÃ©ro jusquâ€™Ã  ce quâ€™il nâ€™y&#xA;ait plus de prÃ©dicats.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;un-peu-plus-de-dÃ©tails-et-mise-en-garde&#34;&gt;Un peu plus de dÃ©tails et mise en garde&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, il sâ€™agit ici dâ€™une version simplifiÃ©e de lâ€™algorithme de&#xA;suggestion, car dâ€™autres informations sont nÃ©cessaires.  Par exemple, la liste&#xA;des prÃ©dicats est en rÃ©alitÃ© ajustÃ©e avec les &lt;a href=&#34;https://www.postgresql.org/docs/current/indexes-opclass.html&#34;&gt;classes dâ€™opÃ©rateurs et mÃ©thode&#xA;dâ€™acces&lt;/a&gt; en&#xA;fonction du type de la colonne et de sont opÃ©rateur, afin de sâ€™assurer&#xA;dâ€™obtenir des index valides.  Si plusieurs mÃ©thodes dâ€™accÃ¨s aux index sont&#xA;trouvÃ©es pour un mÃªme meilleur chemin, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;btree&lt;/code&gt; sera choisi en prioritÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Cela nous amÃ¨ne Ã  un autre dÃ©tail : cette approche est principalement pensÃ©e&#xA;pour les index &lt;strong&gt;btree&lt;/strong&gt;, pour lesqules lâ€™ordre des colonnes est critiques.&#xA;Dâ€™autres mÃ©thodes dâ€™accÃ¨s ne requiÃ¨rent pas un ordre spÃ©cifique pour les&#xA;colonnes, et pour ces mÃ©thodes dâ€™accÃ¨s il est possible quâ€™une suggestion plus&#xA;optimale soit possible si lâ€™ordre des colonnes nâ€™Ã©tait pas pris en compte.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un autre point important est que les classes dâ€™opÃ©rateurs et mÃ©thodes dâ€™accÃ¨s&#xA;ne sont pas gÃ©rÃ©s en dur mais rÃ©cupÃ©rÃ©s Ã  lâ€™exÃ©cution en utilisant les&#xA;catalogues locaux.  Par consÃ©quent, vous pouvez obtenir des rÃ©sultats&#xA;diffÃ©rents (et potentiellement meilleurs) si vous faites en sorte dâ€™avoir&#xA;toutes les classes dâ€™opÃ©rateur additionelles disponibles quand vous utilisez la&#xA;suggestion dâ€™index globale.  Cela pourrait Ãªtre les extensions &lt;strong&gt;btree_gist&lt;/strong&gt;&#xA;et &lt;strong&gt;btree_gist&lt;/strong&gt;, mais Ã©galement dâ€™autres mÃ©thodes dâ€™accÃ¨s aux index.  Il est&#xA;Ã©galement possible que certain types / opÃ©rateurs nâ€™aient pas de mÃ©thode&#xA;dâ€™accÃ¨s associÃ©e dans les catalogues.  Dans ce cas, ces prÃ©dicats sont&#xA;retournÃ©es sÃ©parÃ©ment dans une liste de prÃ©dicats non optimisables&#xA;automatiquement, et pour lequel une analyse manuelle est nÃ©cessaire.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Enfin, comme pg_qualstats ne traite pas les prÃ©dicats composÃ©s dâ€™expressions,&#xA;lâ€™outil ne peut pas suggÃ©rer dâ€™index sur des expressions, par exemple en cas&#xA;dâ€™utilisateur de recherche plein texte.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;exemple-dutilisation&#34;&gt;Exemple dâ€™utilisation&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Une simple fonction est fournie, avec des paramÃ¨tres facultatifs, qui retourne&#xA;une valeur de type json :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;min_selectivity&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;forbidden_am&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;{}&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Les noms de paramÃ¨tres sont parlants :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_filter&lt;/code&gt;: combien de lignes le prÃ©dicat doit-il filtrer en moyenne pour&#xA;Ãªtre pris en compte par la suggestion globale, par dÃ©faut &lt;strong&gt;1000&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;min_selectivity&lt;/code&gt;: quelle doit Ãªtre la sÃ©lectivitÃ© moyenne dâ€™un prÃ©dicat&#xA;pour quâ€™il soit pris en compte par la suggestion globale, par dÃ©faut&#xA;&lt;strong&gt;30%&lt;/strong&gt; ;&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;forbidden_am&lt;/code&gt;: liste des mÃ©thodes dâ€™accÃ¨s aux index Ã  ignorer.  Aucune par&#xA;dÃ©faut, bien que pour les version 9.6 et infÃ©rieures &lt;strong&gt;les index hash sont&#xA;ignorÃ© en interne&lt;/strong&gt;, puisque ceux-ci ne sont sur que depuis la version 10.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple simple, tirÃ©s des tests de non rÃ©gression de pg_qualstats :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;a&#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;INSERT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;INTO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;line &#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_series&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_qualstats_reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;meh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;adv&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ILIKE&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;moh&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgqs&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Et voici ce que la fonction retourne :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;indexes&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;                               &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------------------------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (id1)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.adv USING btree (val, id1, id2, id3)&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;CREATE INDEX ON public.pgqs USING btree (id)&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&#xA;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json_array_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;pg_qualstats_index_advisor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;unoptimised&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;COLLATE&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;C&#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;        &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------&lt;/span&gt;&#xA; &lt;span class=&#34;nv&#34;&gt;&#34;adv.val ~~* ?&#34;&lt;/span&gt;&#xA;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/&#34;&gt;version 2 de pg_qualstats&lt;/a&gt;&#xA;nâ€™est pas encore disponible en version stable, mais nâ€™hÃ©sitez pas Ã  la tester&#xA;et &lt;a href=&#34;https://github.com/powa-team/pg_qualstats/issues&#34;&gt;rapporter tout problÃ¨me que vous pourriez&#xA;rencontrer&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html&#34;&gt;pgÂ qualstats 2: Suggestion d&#39;index globale&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on January 06, 2020.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2020/01/06/pg_qualstats-2-suggestion-index-globale.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: Nouveau daemon powa-collector</title>
    <updated>2019-12-10T18:54:17Z</updated>
    <id>tag:rjuju.github.io,2019-12-10:/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie dâ€™une sÃ©rie dâ€™article sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et dÃ©crit le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-daemon-powa-collector&#34;&gt;Nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Ce daemon remplace le prÃ©cÃ©dent &lt;em&gt;background worker&lt;/em&gt; lorsque le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;mode&#xA;remote&lt;/a&gt; est utilisÃ©.&#xA;Il sâ€™agit dâ€™un simple daemon Ã©crit en python, qui sâ€™occupera de toutes les&#xA;Ã©tapes nÃ©cessaires pour effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;.  Il est &lt;a href=&#34;https://pypi.org/project/powa-collector/&#34;&gt;disponible&#xA;sur pypi&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme je lâ€™ai expliquÃ© dans mon &lt;a href=&#34;/postgresql/2019/05/17/powa-4-with-remote-mode-beta-is-available.html&#34;&gt;prÃ©cÃ©dent article introduistant PoWA 4&lt;/a&gt;, ce&#xA;daemon est nÃ©cessaire  pour la configuration dâ€™un mode remote, en gardant cette&#xA;architecture Ã  lâ€™esprit :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture de PoWA 4 en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Sa configuration est trÃ¨s simple.  Il vous suffit tout simplement de renommer&#xA;le fichier &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa-collector.conf.sample&lt;/code&gt; fourni, et dâ€™adapter &lt;a href=&#34;https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING&#34;&gt;lâ€™URI de&#xA;connexion&lt;/a&gt;&#xA;pour dÃ©crire comment se connecter sur votre &lt;em&gt;serveur repository&lt;/em&gt; dÃ©diÃ©, et&#xA;câ€™est fini.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une configuration typique devrait ressembler Ã  :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;{&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;repository&#34;&lt;/span&gt;: {&#xA;        &lt;span class=&#34;s2&#34;&gt;&#34;dsn&#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&#34;postgresql://powa_user@server_dns:5432/powa&#34;&lt;/span&gt;,&#xA;    },&#xA;    &lt;span class=&#34;s2&#34;&gt;&#34;debug&#34;&lt;/span&gt;: &lt;span class=&#34;n&#34;&gt;true&lt;/span&gt;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La liste des &lt;em&gt;serveur distants&lt;/em&gt;, leur configuration ainsi que tout le reste qui&#xA;est nÃ©cessaire pour le bon fonctionnement sera automatiquement rÃ©cupÃ©rÃ© depuis&#xA;le &lt;em&gt;serveur repository&lt;/em&gt; que vous ave dÃ©jÃ  configurÃ©.  Une fois dÃ©marrÃ©, il&#xA;dÃ©marrera un thread dÃ©diÃ© par &lt;em&gt;serveur distant&lt;/em&gt; dÃ©clarÃ©, et maintiendra une&#xA;&lt;strong&gt;connexion persistente&lt;/strong&gt; sur ce &lt;em&gt;serveur distant&lt;/em&gt;.  Chaque thread effectuera&#xA;un &lt;em&gt;snapshot distant&lt;/em&gt;, exportant les donnÃ©es sur le &lt;em&gt;serveur repository&lt;/em&gt; en&#xA;utilisant les nouvelles &lt;em&gt;fonctions sources&lt;/em&gt;.  Chaque thread ouvrira et fermera&#xA;une connexion sur le &lt;em&gt;serveur repository&lt;/em&gt; lors de lâ€™exÃ©cution du &lt;em&gt;snapshot&#xA;distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Bien Ã©videmment, ce daemon a besoin de pouvoir se connecter sur tous les&#xA;&lt;em&gt;serveurs distants&lt;/em&gt; dÃ©clarÃ©s ainsi que le &lt;em&gt;serveur repository&lt;/em&gt;.  La table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;, qui stocke la liste des &lt;em&gt;serveurs distants&lt;/em&gt;, a un champ pour&#xA;stocker les nom dâ€™utilisateur et mot de passe pour se connecter aux &lt;em&gt;serveur&#xA;distants&lt;/em&gt;.  Stocker un mot de passe en clair dans cette table est une hÃ©rÃ©sie,&#xA;si lâ€™on considÃ¨re lâ€™aspect sÃ©curitÃ©.  Ainsi, comme indiquÃ© dans la&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section sÃ©curitÃ© de&#xA;PoWA&lt;/a&gt;,&#xA;vous pouve stocker un mot de passe NULL et &lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;utiliser Ã  la place nâ€™importe&#xA;laquelle des autres mÃ©thodes dâ€™authentification supportÃ©es par la&#xA;libpq&lt;/a&gt; (fichier&#xA;.pgpass, certificatâ€¦).  Câ€™est trÃ¨s fortement recommandÃ© pour toute&#xA;installation sÃ©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La connexion persistente sur le &lt;em&gt;serveur repository&lt;/em&gt; est utilisÃ©e pour&#xA;superviser la daemon :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;pour vÃ©rifier  que le daemon est bien dÃ©marrÃ©&lt;/li&gt;&#xA;  &lt;li&gt;pour communiquer au travers de lâ€™UI en utilisant un &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/protocol.html&#34;&gt;protocole simple&lt;/a&gt;&#xA;afin dâ€™effectuer des actions diverses (recharger la configuration, vÃ©rifier&#xA;le status dâ€™un thread dÃ©diÃ© Ã  un &lt;em&gt;serveur distant&lt;/em&gt;â€¦)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Il est Ã  noter que vous pouvez Ã©galement demander au daemon de recharger sa&#xA;configuration en envoyant un SIGHUP au processus du daemon.  Un rechargement&#xA;est nÃ©cessaire pour toute modification effectuÃ©e sur la liste des serveurs&#xA;distants (ajout ou suppression dâ€™un &lt;em&gt;serveur distant&lt;/em&gt;, ou mise Ã  jour dâ€™un&#xA;existant).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez Ã©galement noter que, par choix,&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&lt;/a&gt;&#xA;nâ€™effectuera pas de &lt;em&gt;snapshot local&lt;/em&gt;.  Si vous voulez utiliser PoWA pour le&#xA;&lt;em&gt;serveur repository&lt;/em&gt;, il vous faudra activer le &lt;em&gt;background worker&lt;/em&gt; original.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouvelle-page-de-configuration&#34;&gt;Nouvelle page de configuration&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;La page de configuration est maintenant modifiÃ©e pour donner toutes les&#xA;informations nÃ©cessaires sur le status du background worker, le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;powa-collector&#xA;daemon&lt;/a&gt;&#xA;(incluant tous ses threads dÃ©diÃ©s) ainsi que la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;dÃ©clarÃ©s.  Voici un exemple de cette nouvelle page racine de configuration :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_configuration_page.png&#34;&gt;&lt;img src=&#34;/images/powa_4_configuration_page.png&#34; alt=&#34;Nouvelle page de&#xA;configuration&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;est utilisÃ©, le status de chaque serveur distant sera rÃ©cupÃ©rÃ© en utilisant le&#xA;protocole de communication.  Si le collecteur rencontre des erreurs (lors de la&#xA;connexion Ã  un &lt;em&gt;serveur distant&lt;/em&gt;, durant un &lt;em&gt;snapshot&lt;/em&gt; par exemple), celles-ci&#xA;seront Ã©galement affichÃ©es ici.  Ã€ noter Ã©galement que ces erreurs seront&#xA;Ã©galement affichÃ©es en haut de chaque page de toutes les pages de lâ€™UI, afin&#xA;dâ€™Ãªtre sÃ»r de ne pas les rater.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;De plus, la section configuration a maintenant une hiÃ©rarchie, et vous pourrez&#xA;voir la liste des extensions ainsi que la configuration actuelle de PostgreSQL&#xA;pour le serveur &lt;strong&gt;local&lt;/strong&gt; ou &lt;strong&gt;distant&lt;/strong&gt; en cliquant sur le serveur de votre&#xA;choix!&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y a Ã©galement un nouveau bouton &lt;strong&gt;Reload collector&lt;/strong&gt; sur le bandeau&#xA;dâ€™en-tÃªte qui, comme on pourrait sâ€™y attendre, demandera au collecteur de&#xA;recharger sa configuration.  Cela peut Ãªtre utile si vous avez dÃ©clarÃ©s de&#xA;nouveaux serveurs mais nâ€™ave pas dâ€™accÃ¨s au serveur sur lequel le collecteur&#xA;sâ€™exÃ©cute.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette article est le dernier de la sÃ©urie concernant la nouvelle version de&#xA;PoWA.  Il est toujours en beta, nâ€™hÃ©sitez donc pas Ã  le tester, &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;rapporter&#xA;tout bug rencontrÃ©&lt;/a&gt;&#xA;ou donner tout autre retour!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html&#34;&gt;PoWA 4: Nouveau daemon powa-collector&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on December 10, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/12/10/powa-4-nouveau-powa-collector.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4: nouveautÃ©s dans powa-archivist !</title>
    <updated>2019-06-05T14:26:17Z</updated>
    <id>tag:rjuju.github.io,2019-06-05:/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html</id>
    <content type="html">&lt;p&gt;Cet article fait partie dâ€™une sÃ©rie dâ€™article sur &lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;la beta de PoWA&#xA;4&lt;/a&gt;, et dÃ©crit les changements prÃ©sents dans&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/index.html&#34;&gt;powa-archivist&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus dâ€™information sur cette version 4, vous pouvez consulter &lt;a href=&#34;/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;lâ€™article&#xA;de prÃ©sentation gÃ©nÃ©ral&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;aperÃ§u-rapide&#34;&gt;AperÃ§u rapide&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Tout dâ€™abord, il faut savoir quâ€™il nâ€™y a pas dâ€™upgrade possible depuis la v3&#xA;vers la v4, il est donc nÃ©cessaire dâ€™effectuer un &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;DROP EXTENSION powa&lt;/code&gt; si vous&#xA;utilisiez dÃ©jÃ  PoWA sur vos serveurs.  Cela est du au fait que la v4 apporte&#xA;&lt;strong&gt;de trÃ¨s nombreux&lt;/strong&gt; changements dans la partie SQL de lâ€™extension, ce qui en&#xA;fait le changement le plus significatif dans la suite PoWA pour cette nouvelle&#xA;version.  Au moment oÃ¹ jâ€™Ã©cris cet article, la quantitÃ© de changements apportÃ©s&#xA;dans cette extension est :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt; CHANGELOG.md       |   14 +&#xA; powa--4.0.0dev.sql | 2075 +++++++++++++++++++++-------&#xA; powa.c             |   44 +-&#xA; 3 files changed, 1629 insertions(+), 504 deletions(-)&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Lâ€™absence dâ€™upgrade ne devrait pas Ãªtre un problÃ¨me en pratique.  PoWA est un&#xA;outil pour analyser les performances, il est fait pour avoir des donnÃ©es avec&#xA;une grande prÃ©cision mais un historique trÃ¨s limitÃ©.  Si vous cherchez une&#xA;solution de supervision gÃ©nÃ©raliste pour conserver des mois de donnÃ©es, PoWA&#xA;nâ€™est dÃ©finitivement pas lâ€™outil quâ€™il vous faut.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;configurer-la-liste-des-serveurs-distants&#34;&gt;Configurer la liste des &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;En ce qui concerne les changements Ã  proprement parler, le premier petit&#xA;changement est que le &lt;a href=&#34;https://www.postgresql.org/docs/current/bgworker.html&#34;&gt;background&#xA;worker&lt;/a&gt; nâ€™est plus&#xA;nÃ©cessaire pour le fonctionnement de powa-archivist, car il nâ€™est pas utilisÃ©&#xA;pour le mode distant.  Cela signifie quâ€™un redÃ©marrage de PostgreSQL nâ€™est plus&#xA;nÃ©cessaire pour installer PoWA.  Bien Ã©videmment, un redÃ©marrage est toujours&#xA;nÃ©cessaire si vous souhaitez utiliser le mode local, en utilisant le background&#xA;worker, or si vous voulez installer des extensions additionelles qui&#xA;nÃ©cessitent elles-mÃªme un redÃ©marrage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Ensuite, comme PoWA requiert un peu de configuration (frÃ©quence des snapshot,&#xA;rÃ©tention des donnÃ©es et ainsi de suite), certaines nouvelles tables sont&#xA;ajouter pour permettre de configurer tout Ã§a.  La nouvelle table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_servers&lt;/code&gt;&#xA;stocke la configuration de toutes les instances distantes dont les donnÃ©es&#xA;doivent Ãªtre stockÃ©es sur cette instance.  Cette &lt;em&gt;instance PoWA locale&lt;/em&gt; est&#xA;appelÃ©e un &lt;strong&gt;serveur repository&lt;/strong&gt; (qui devrait typiquement Ãªtre dÃ©diÃ©e Ã &#xA;stocker des donnÃ©es PoWA), en opposition aux &lt;strong&gt;instances distantes&lt;/strong&gt; qui sont&#xA;les instances que vous voulez monitorer.  Le contenu de cette table est tout ce&#xA;quâ€™il y a de plus simple :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_servers&lt;/span&gt;&#xA;                              &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_servers&#34;&lt;/span&gt;&#xA;  &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                 &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------+----------+-----------+----------+------------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;            &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nextval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&#39;powa_servers_id_seq&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regclass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;hostname&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;alias&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;dbname&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;frequency&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;powa_coalesce&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;retention&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;1 day&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;interval&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Si vous avez dÃ©jÃ  utilisÃ© PoWA, vous devriez reconnaÃ®tre la plupart des options&#xA;de configuration qui sont maintenant stockÃ©es ici.  Les nouvelles options sont&#xA;utilisÃ©es pour dÃ©crire comment se connecter aux &lt;em&gt;instances distances&lt;/em&gt;, et&#xA;peuvent fournir un alias Ã  afficher sur lâ€™UI.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous avez Ã©galement probablement remarquÃ© une colonne &lt;strong&gt;password&lt;/strong&gt;.  Stocker un&#xA;mot de passe en clair dans cette table est une hÃ©rÃ©sie pour nâ€™importe qui&#xA;dÃ©sirant un minimum de sÃ©curitÃ©.  Ainsi, comme mentionnÃ© dans la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;section&#xA;sÃ©curitÃ© de la documentation de PoWA&#xA;&lt;/a&gt;,&#xA;vous pouvez stocker NULL pour le champ password et Ã  la place utiliser&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/auth-methods.html&#34;&gt;nâ€™importe laquelle des autres mÃ©thodes dâ€™authentification supportÃ©e par la&#xA;libpq&lt;/a&gt;&#xA;(fichier .pgpass, certificatâ€¦).  Une authentification plus sÃ©curisÃ©e est&#xA;chaudement recommandÃ©e pour toute installation sÃ©rieuse.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Une autre table, la table &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_snapshot_metas&lt;/code&gt;, est Ã©galement ajoutÃ©e pour&#xA;stocker quelques mÃ©tadonnÃ©es concernant les informations de snapshot pour&#xA;chaque &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;                                   &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_snapshot_metas&#34;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;                &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;--------------+--------------------------+-----------+----------+---------------------------------------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;                  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;coalesce_seq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;snapts&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;aggts&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;purgets&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&#39;-infinity&#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;errors&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Il sâ€™agit tout simplement dâ€™un compteur pour compter le nombre de snapshots&#xA;effectuÃ©s, un timestamp pour chaque type dâ€™Ã©vÃ©nement survenu (snapshot,&#xA;aggrÃ©gation et purge) et un tableau de chaÃ®ne de caractÃ¨res pour stocker toute&#xA;erreur survenant durant le snapshot, afin que lâ€™UI pour lâ€™afficher.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;api-sql-pour-configurer-les-serveurs-distants&#34;&gt;API SQL pour configurer les &lt;em&gt;serveurs distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Bien que ces tables soient trÃ¨s simples, une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html#configure-powa-and-stats-extensions-on-each-remote-server&#34;&gt;API SQL basique est disponible&#xA;pour dÃ©clarer de nouveaux serveurs et les&#xA;configurer&lt;/a&gt;.&#xA;6 fonctions de bases sont disponibles :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_register_server()&lt;/code&gt;, pour dÃ©clarer un nouveau &lt;em&gt;servuer distant&lt;/em&gt;, ainsi&#xA;que la liste des extensions qui y sont disponibles&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_configure_server()&lt;/code&gt; pour mettre Ã  jour un des paramÃ¨tres pour le&#xA;&lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ© (en utilisant un paramÃ¨tre JSON, oÃ¹ la clÃ© est&#xA;le nom du paramÃ¨tre Ã  changer et la valeur la nouvelle valeur Ã  utiliser)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_server()&lt;/code&gt; pour dÃ©sactiver les snapshots pour le &lt;em&gt;serveur&#xA;distant&lt;/em&gt; spÃ©cifiquÃ© (ce qui concrÃ¨tement positionnera le paramÃ¨tre&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;frequency&lt;/code&gt; Ã  &lt;strong&gt;-1&lt;/strong&gt;)&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_delete_and_purge_server()&lt;/code&gt; pour supprimer le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;spÃ©cifiÃ© de la liste des serveurs et supprimer toutes les donnÃ©es associÃ©es&#xA;aux snapshots&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_activate_extension()&lt;/code&gt;, pour dÃ©clarer quâ€™une nouvelle extension est&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ©&lt;/li&gt;&#xA;  &lt;li&gt;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_deactivate_extension()&lt;/code&gt;, pour spÃ©cifier quâ€™une extension nâ€™est plus&#xA;disponible sur le &lt;em&gt;serveur distant&lt;/em&gt; spÃ©cifiÃ©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Toute action plus compliquÃ©e que Ã§a devra Ãªtre effectuÃ©e en utilisant des&#xA;requÃªtes SQL.  Heureusement, il ne devrait pas y avoir beaucoup dâ€™autres&#xA;besoins, et les tables sont vraiment trÃ¨s simple donc cela ne devrait pas poser&#xA;de soucis.  &lt;a href=&#34;https://github.com/powa-team/powa-archivist/issues&#34;&gt;Nâ€™hÃ©sitez cependant pas Ã  demander de nouvelles&#xA;fonctions&lt;/a&gt; si vous aviez&#xA;dâ€™autres besoins.  Veuillez Ã©galement noter que lâ€™UI ne vous permet pas&#xA;dâ€™appeler ces fonctions, puisque celle-ci est pour le moment &lt;strong&gt;entiÃ¨rement en&#xA;lecture seule&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;effectuer-des-snapshots-distants&#34;&gt;Effectuer des &lt;em&gt;snapshots distants&lt;/em&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Puisque les mÃ©triques sont maintenant stockÃ©es sur une instance PostgreSQL&#xA;diffÃ©rente, nous avons Ã©normÃ©ment changÃ© la faÃ§on dont les &lt;em&gt;snapshots&lt;/em&gt;&#xA;(rÃ©cupÃ©rer les donnÃ©es fournies par une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extensions&#xA;statistique&lt;/a&gt;&#xA;et les stockÃ©es dans le catalogue PoWA &lt;a href=&#34;/postgresqlfr/2019/04/06/minimiser-le-surcout-de-stockage-par-ligne.html&#34;&gt;de maniÃ¨re Ã  optimiser le stockage&lt;/a&gt;) sont&#xA;effectuÃ©s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La liste de toutes les extensions statistiques, ou &lt;em&gt;sources de donnÃ©es&lt;/em&gt;, qui&#xA;sont disponibles sur un &lt;strong&gt;serveur&lt;/strong&gt; (soit &lt;em&gt;distant&lt;/em&gt; soit &lt;em&gt;local&lt;/em&gt;) et pour&#xA;lesquelles un &lt;em&gt;snapshot&lt;/em&gt; devrait Ãªtre effectuÃ© est stockÃ©e dans une table&#xA;appelÃ©e &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_functions&lt;/code&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;               &lt;span class=&#34;k&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_functions&#34;&lt;/span&gt;&#xA;     &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;----------------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;operation&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;function_name&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;query_source&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;text&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;added_manually&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;enabled&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;priority&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;numeric&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Un nouveau champ &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;query_source&lt;/code&gt; a Ã©tÃ© rajoutÃ©.  Celui-ci fournit le nom de la&#xA;&lt;em&gt;fonction source&lt;/em&gt;, nÃ©cessaire pour la compatibilitÃ© dâ€™une &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;extension&#xA;statistique&lt;/a&gt;&#xA;avec les snapshots distants.  Cette fonction est utilisÃ©e pour exporter les&#xA;compteurs fournis par cette extension sur un serveur diffÃ©rent, dans une &lt;em&gt;table&#xA;transitoire&lt;/em&gt; dÃ©diÃ©e.  La fonction de &lt;em&gt;snapshot&lt;/em&gt; effectuera alors le &lt;em&gt;snapshot&lt;/em&gt;&#xA;en utilisant automatiquement ces donnÃ©es exportÃ©es plutÃ´t que celles fournies&#xA;par lâ€™extension statististique locale quand le mode distant est utilisÃ©.  Il&#xA;est Ã  noter que lâ€™export de ces compteurs ainsi que le snapshot distant est&#xA;effectuÃ© automatiquement par le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon&#xA;powa-collector&lt;/a&gt;&#xA;que je prÃ©senterai dans un autre article.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple montant comment PoWA effectue un &lt;em&gt;snapshot distant&lt;/em&gt; dâ€™une&#xA;liste de base donnÃ©es.  Comme vous allez le voir, câ€™est trÃ¨s simple ce qui&#xA;signifie quâ€™il est Ã©galement trÃ¨s simple dâ€™ajouter cette mÃªme compatibilitÃ©&#xA;pour une nouvelle extension statistique.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;table transitoire&lt;/em&gt;:&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;   &lt;span class=&#34;n&#34;&gt;Unlogged&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;public.powa_databases_src_tmp&#34;&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;---------+---------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Pour de meilleurs performances, toutes les &lt;em&gt;tables transitoires&lt;/em&gt; sont &lt;strong&gt;non&#xA;journalisÃ©es (unlogged)&lt;/strong&gt;, puisque leur contenu nâ€™est nÃ©cessaire que durant un&#xA;&lt;em&gt;snapshot&lt;/em&gt; et sont supprimÃ©es juste aprÃ¨s.  Dans cet examlple, la &lt;em&gt;table&#xA;transitoire&lt;/em&gt; ne stocke que lâ€™identifiant du serveur distant correspondant Ã  ces&#xA;donnÃ©es, lâ€™oid ainsi que le nom de chacune des bases de donnÃ©es prÃ©sentes sur&#xA;le &lt;em&gt;serveur distant&lt;/em&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Et la &lt;em&gt;fonction source&lt;/em&gt; :&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OR&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;REPLACE&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powa_databases_src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;OUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SETOF&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&#xA; &lt;span class=&#34;k&#34;&gt;LANGUAGE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;plpgsql&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&#xA;    &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;THEN&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_database&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;ELSE&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powa_databases_src_tmp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;srvid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_srvid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;    &lt;span class=&#34;k&#34;&gt;END&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;Cette fonction retourne simplement le contenu de &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; si les donnÃ©es&#xA;locales sont demandÃ©es (lâ€™identifiant de serveur &lt;strong&gt;0&lt;/strong&gt; est toujours le serveur&#xA;local), ou alors le contenu de la &lt;em&gt;table transitoire&lt;/em&gt; pour le serveur distant&#xA;spÃ©cifiÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La &lt;em&gt;fonction de snapshot&lt;/em&gt; peut alors facilement effectuer nâ€™importe quel&#xA;traitement avec ces donnÃ©es pour le &lt;em&gt;serveur distant&lt;/em&gt; voulu.  Dans le cas de la&#xA;fonction &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;powa_databases_snapshot()&lt;/code&gt;, il sâ€™agit simplement de synchroniser la&#xA;liste des bases de donnÃ©es, et de stocker le timestamp de suppression si une&#xA;base de donnÃ©es qui existait prÃ©cÃ©demment nâ€™est plus listÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour plus de dÃ©tails, vous pouvez consulter la documentation concernant&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/development.html&#34;&gt;lâ€™ajout dâ€™une source de donnÃ©es dans&#xA;PoWA&lt;/a&gt;,&#xA;qui a Ã©tÃ© mise Ã  jour pour les spÃ©cificitÃ©s de la version 4.&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html&#34;&gt;PoWA 4: nouveautÃ©s dans powa-archivist !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on June 05, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/06/05/powa-4-nouveaute-dans-powa-archivist.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>PoWA 4 apporte un mode remote, disponible en beta !</title>
    <updated>2019-05-17T11:04:17Z</updated>
    <id>tag:rjuju.github.io,2019-05-17:/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html</id>
    <content type="html">&lt;p&gt;&lt;a href=&#34;http://powa.readthedocs.io/&#34;&gt;PoWA 4&lt;/a&gt; est disponible en beta.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveau-mode-remote-&#34;&gt;Nouveau mode remote !&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau mode remote&lt;/a&gt;&#xA;est la plus grosse fonctionnalitÃ© ajoutÃ©e dans PoWA 4, bien quâ€™il y ait eu&#xA;dâ€™autres amÃ©liorations.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Je vais dÃ©crire ici ce que ce nouveau mode implique ainsi que ce qui a changÃ©&#xA;sur lâ€™&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;UI&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Si de plus amples dÃ©tails sur le reste des changements apportÃ©s dans PoWA 4&#xA;vous intÃ©resse, je publierai bientÃ´t dâ€™autres articles sur le sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour les plus pressÃ©s, nâ€™hÃ©sitez pas Ã  aller directement sur la &lt;a href=&#34;https://dev-powa.anayrat.info/&#34;&gt;dÃ©mo v4 de&#xA;PoWA&lt;/a&gt;, trÃ¨s gentiment hÃ©bergÃ©e par &lt;a href=&#34;http://blog.anayrat.info/&#34;&gt;Adrien&#xA;Nayrat&lt;/a&gt;.  Aucun authentification nâ€™est requise,&#xA;cliquez simplement sur â€œLoginâ€.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;pourquoi-un-mode-remote-est-il-important&#34;&gt;Pourquoi un mode remote est-il important&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette fonctionnalitÃ© a probablement Ã©tÃ© la plus frÃ©quemment demandÃ©e depuis que&#xA;PoWA a Ã©tÃ© publiÃ©, en 2014.  Et câ€™est pour de bonnes raisons, car un mode local&#xA;a quelques inconvÃ©nients.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Tout dâ€™abord, voyons comment se prÃ©sentait lâ€™architecture avec les versions 3&#xA;et antÃ©rieures.  Imaginons une instance contenant 2 bases de donnÃ©es (db1 et&#xA;db2), ainsi quâ€™&lt;strong&gt;une base de donnÃ©es dÃ©diÃ©e Ã  PoWA&lt;/strong&gt;.  Cette base de donnÃ©es&#xA;dÃ©diÃ©e contient Ã  la fois les &lt;em&gt;extensions statistiques&lt;/em&gt; nÃ©cessaires pour&#xA;rÃ©cupÃ©rer compteurs de performances actuels ainsi que pour &lt;strong&gt;les stocker&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_local.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_local.svg&#34; alt=&#34;Architecture en mode local&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Un &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est dÃ©marrÃ© par PoWA, qui est responsable dâ€™effectuer des &lt;em&gt;snapshots&lt;/em&gt; et de les&#xA;stocker dans la base powa dÃ©diÃ©e Ã  intervalle rÃ©guliers.  Ensuite, en utilisant&#xA;powa-web, vous pouvez consulter lâ€™activitÃ© de nâ€™importe laquelle des bases de&#xA;donnÃ©es &lt;strong&gt;locales&lt;/strong&gt; en effectuant des requÃªtes sur les donnÃ©es stockÃ©es dans la&#xA;base dÃ©diÃ©, et potentiellement en se connectant sur lâ€™une des autres bases de&#xA;donnÃ©es locales lorsque les donnÃ©es complÃ¨tes sont nÃ©cessaires, par exemple&#xA;lorsque lâ€™outil de suggestion dâ€™index est utilisÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Avec la version 4, lâ€™architecture avec une configuration distante change de&#xA;maniÃ¨re significative:&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_remote.svg&#34;&gt;&lt;img src=&#34;/images/powa_4_remote.svg&#34; alt=&#34;Architecture en mode distant&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Vous pouvez voir quâ€™une base de donnÃ©e powa dÃ©diÃ©e est toujours nÃ©cessaire,&#xA;mais &lt;strong&gt;uniquement pour les extensions statistiques&lt;/strong&gt;.  Les donnÃ©es sont&#xA;maintenant stockÃ©es sur une instance diffÃ©rente.  Ensuite, le &lt;em&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-archivist/configuration.html#background-worker-configuration&#34;&gt;background&#xA;worker&lt;/a&gt;&lt;/em&gt;&#xA;est remplacÃ© par un &lt;strong&gt;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;nouveau daemon&#xA;collecteur&lt;/a&gt;&lt;/strong&gt;,&#xA;qui lit les mÃ©triques de performance depuis les &lt;em&gt;serveurs distants&lt;/em&gt;, et les&#xA;stocke sur le &lt;em&gt;serveur repository&lt;/em&gt; dÃ©diÃ©.  Powa-web pourra prÃ©senter les&#xA;donnÃ©es en se connectant sur le &lt;em&gt;serveur repository&lt;/em&gt;, ainsi que sur les&#xA;&lt;strong&gt;serveurs distants&lt;/strong&gt; lorsque des donnÃ©es complÃ¨tes sont nÃ©cessaires.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;En rÃ©sumÃ©, avec le nouveau mode distant ajoutÃ© dans cette version 4&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;un redÃ©marrage de PostgreSQL nâ€™est plus nÃ©cessaire pour installer&#xA;powa-archivist&lt;/li&gt;&#xA;  &lt;li&gt;il nâ€™y a plus de surcoÃ»t du au fait de stocker et requÃªter les donnÃ©es sur&#xA;le mÃªme serveur PostgreSQL que vos serveurs de productions (il y a toujours&#xA;certaines partie de lâ€™UI qui nÃ©cessitent dâ€™effectuer des requÃªtes sur le&#xA;serveur dâ€™origine, par exemple pour montrer des plans avec EXPLAIN, mais le&#xA;surcoÃ»t est nÃ©gligeable)&lt;/li&gt;&#xA;  &lt;li&gt;il est maintenant possible dâ€™utiliser PoWA sur un &lt;strong&gt;serveur en&#xA;hot-standby&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Lâ€™UI vous accueillera donc maintenant avec une page initiale afin de choisir&#xA;lequel des serveurs stockÃ©s sur la base de donnÃ©es cible vous voulez&#xA;travailler :&#xA;&lt;a href=&#34;/images/powa_4_all_servers.png&#34;&gt;&lt;img src=&#34;/images/powa_4_all_servers.png&#34; alt=&#34;Choix des serveurs&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La principale raison pour laquelle il a fallu tellement de temps pour apporter&#xA;ce mode distant est parce que cela apporte beaucoup de complexitÃ©, nÃ©cessitant&#xA;une rÃ©Ã©criture majeure de PoWA.  Nous voulions Ã©galement ajouter dâ€™abord&#xA;dâ€™autres fonctionnalitÃ©s, comme la &lt;strong&gt;suggestion globale dâ€™index&lt;/strong&gt;, avec une&#xA;&lt;strong&gt;validation grÃ¢ce Ã  &lt;a href=&#34;http://hypopg.readthedocs.io/&#34;&gt;hypopg&lt;/a&gt;&lt;/strong&gt; introduit avec&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/releases/v3.0.0.html&#34;&gt;PoWA 3&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;changements-dans-powa-web&#34;&gt;Changements dans &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-web/index.html&#34;&gt;powa-web&lt;/a&gt;&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Lâ€™&lt;em&gt;interface graphique&lt;/em&gt; est le composant qui a le plus de changements visibles&#xA;dans cette version 4.  Voici les plus changements les plus importants.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;compatibilitÃ©-avec-le-mode-distant&#34;&gt;CompatibilitÃ© avec le mode distant&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Le changement le plus important est bien Ã©videmment le support pour le &lt;a href=&#34;https://powa.readthedocs.io/en/latest/remote_setup.html&#34;&gt;nouveau&#xA;mode remote&lt;/a&gt;.  En&#xA;consÃ©quence, la premiÃ¨re page affichÃ©e est maintenant une page de &lt;strong&gt;sÃ©lection&#xA;de serveur&lt;/strong&gt;, affichant tous les &lt;em&gt;serveurs distants&lt;/em&gt; enregistrÃ©s.  AprÃ¨s avoir&#xA;choisi le &lt;em&gt;serveur distant&lt;/em&gt; voulu (ou le &lt;em&gt;serveur local&lt;/em&gt; si vous nâ€™utilisez pas&#xA;le mode distant), toutes les autres pages seront similaires Ã  celles&#xA;disponibles jusquâ€™Ã  la version 3, mais afficheront les donnÃ©es pour un &lt;em&gt;serveur&#xA;distant&lt;/em&gt; spÃ©cifique uniquement, et bien entendu en rÃ©cupÃ©rant les donnÃ©es&#xA;depuis la &lt;strong&gt;base de donnÃ©es repository&lt;/strong&gt;, avec en plus de nouvelles&#xA;informations dÃ©crites ci-dessous.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez notez que puisque les donnÃ©es sont maintenant stockÃ©es sur un &lt;em&gt;serveur&#xA;repository&lt;/em&gt; dÃ©diÃ© quand le mode remote est utilisÃ©, la majoritÃ© de lâ€™UI est&#xA;utilisable sans se connecter au &lt;em&gt;serveur distant&lt;/em&gt; sÃ©lectionnÃ©.  Toutefois,&#xA;powa-web nÃ©cessite toujours de pouvoir se connecter sur le &lt;em&gt;serveur distant&lt;/em&gt;&#xA;quand les donnÃ©es originales sont nÃ©cessaires (par exemple, pour la suggestion&#xA;dâ€™index ou pour montrer des plans avec &lt;strong&gt;EXPLAIN&lt;/strong&gt;).  Les &lt;a href=&#34;https://powa.readthedocs.io/en/latest/security.html#connection-on-remote-servers&#34;&gt;mÃªmes considÃ©rations&#xA;et possibilitÃ©s concernant&#xA;lâ€™authentification&lt;/a&gt;&#xA;que pour le nouveau &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/powa-collector/index.html&#34;&gt;daemon powa-collector&#xA;&lt;/a&gt;&#xA;(qui sera dÃ©crit dans un prochain article) sâ€™appliquent ici.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;pg_track_settings-support&#34;&gt;&lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt; support&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand cette extension est correctement configurÃ©e, un nouveau widget timeline&#xA;apparaÃ®tra, placÃ© entre chaque graph et son aperÃ§u, affichant diffÃ©rents types&#xA;de changements enregistrÃ©s si ceux-ci ont Ã©tÃ© dÃ©tectÃ©s sur lâ€™intervalle de&#xA;temps sÃ©lectionnÃ©.  Sur les pages par base de donnÃ©es et par requÃªte, la liste&#xA;sera Ã©galement filtrÃ©e en fonction de la base de donnÃ©es sÃ©lectionnÃ©e.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;La mÃªme timeline sera affichÃ©e sur chacun des graphs de chacune des pages, afin&#xA;de facilement vÃ©rifier si ces changements ont eu un impact visible en utilisant&#xA;les diffÃ©rents graphs.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez noter que les dÃ©tails des changements sont affichÃ©s au survol de la&#xA;souris.  Vous pouvez Ã©galement cliquer sur nâ€™importe lequel des Ã©vÃ©nements de&#xA;la timeline pour figer lâ€™affichage, et tracer une ligne verticale sur le graph&#xA;associÃ©.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple dâ€™un tel changement de configuration en action :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_track_settings_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_track_settings_powa4.png&#34; alt=&#34;Changements de configuration dÃ©tectÃ©s&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Veuillez Ã©galement noter quâ€™il est nÃ©cessaire dâ€™avoir au minimum la version&#xA;2.0.0 de &lt;a href=&#34;https://github.com/rjuju/pg_track_settings/&#34;&gt;pg_track_settings&lt;/a&gt;, et&#xA;que lâ€™extension doit Ãªtre installÃ©e &lt;strong&gt;Ã  la fois sur les &lt;em&gt;serveurs distants&lt;/em&gt;&#xA;ainsi que sur le &lt;em&gt;serveur repository&lt;/em&gt;.&lt;/strong&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;nouveaux-graphs-disponibles&#34;&gt;Nouveaux graphs disponibles&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Quand&#xA;&lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/pg_stat_kcache.html&#34;&gt;pg_stat_kcache&lt;/a&gt;&#xA;est configurÃ©, ses informations nâ€™Ã©taient auparavant affichÃ©es que sur la page&#xA;par requÃªte.  Les informations sont maintenant Ã©galement affichÃ©es sur les&#xA;pages par serveur et par base, dans deux nouveaux graphs :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;dans le graph &lt;strong&gt;Block Access&lt;/strong&gt;, oÃ¹ les mÃ©triques &lt;strong&gt;OS cache&lt;/strong&gt; et &lt;strong&gt;disk&#xA;read&lt;/strong&gt; remplaceront la mÃ©trique &lt;strong&gt;read&lt;/strong&gt;&lt;/li&gt;&#xA;  &lt;li&gt;dans un nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; (qui est Ã©galement ajoutÃ© dans&#xA;la page &lt;em&gt;par requÃªte&lt;/em&gt;), montrant les &lt;a href=&#34;/postgresql/2018/07/17/pg_stat_kcache-2-1-is-out.html&#34;&gt;metrics ajoutÃ©es dans pg_stat_kcache&#xA;2.1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Voici un example de ce nouveau graph &lt;strong&gt;System Resources&lt;/strong&gt; :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34;&gt;&lt;img src=&#34;/images/pg_stat_kcache_system_resources_powa4.png&#34; alt=&#34;Ressources systÃ¨me&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Il y avait Ã©galement un graph &lt;strong&gt;Wait Events&lt;/strong&gt; (disponible quand &lt;a href=&#34;https://powa.readthedocs.io/en/v4/components/stats_extensions/pg_wait_sampling.html&#34;&gt;lâ€™extension&#xA;pg_wait_sampling&lt;/a&gt;&#xA;est configuÃ©e) disponible uniquement sur la page par requÃªte.  Ce graph est&#xA;maintenant disponible sur les pages par serveur et par base Ã©galement.&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;documentation-des-mÃ©triques-et-liens-vers-la-documentation&#34;&gt;Documentation des mÃ©triques et liens vers la documentation&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certaines mÃ©triques affichÃ©es sur lâ€™interface sont assez parlante, mais&#xA;certaines autres peuvent Ãªtre un peu obscures.  Jusquâ€™Ã  maintenant, il nâ€™y&#xA;avait malheureusement aucune documentation pour les mÃ©triques.  Le problÃ¨me est&#xA;maintenant rÃ©glÃ©, et tous les graphs ont une &lt;em&gt;icÃ´ne dâ€™information&lt;/em&gt;, qui&#xA;affichent une description des mÃ©triques utilisÃ©e dans le graph au survol de la&#xA;souris.  Certains graphs incluent Ã©galement un lien vers la &lt;a href=&#34;https://powa.readthedocs.io/en/latest/components/stats_extensions/index.html&#34;&gt;documentation PoWA&#xA;de extension&#xA;statistiques&lt;/a&gt;&#xA;pour les utilisateurs qui dÃ©sirent en apprendre plus Ã  leur sujet.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Voici un exemple :&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;a href=&#34;/images/powa_4_metrics_doc.png&#34;&gt;&lt;img src=&#34;/images/powa_4_metrics_doc.png&#34; alt=&#34;Documentation des mÃ©triques&#34; /&gt;&lt;/a&gt;&lt;/p&gt;&#xA;&#xA;&lt;h5 id=&#34;et-des-correctifs-de-bugs-divers&#34;&gt;Et des correctifs de bugs divers&lt;/h5&gt;&#xA;&#xA;&lt;p&gt;Certains problÃ¨mes de longues dates ont Ã©galement Ã©tÃ© rapportÃ©s :&lt;/p&gt;&#xA;&#xA;&lt;ul&gt;&#xA;  &lt;li&gt;la boÃ®te affichÃ©e au survol dâ€™un graph montant les valeurs des mÃ©triques&#xA;avait une position verticale incorrecte&lt;/li&gt;&#xA;  &lt;li&gt;la sÃ©lection temporelle en utilisant lâ€™aperÃ§u des graphs ne montrait pas un&#xA;aperÃ§u correct aprÃ¨s avoir appliquÃ© la sÃ©lection&lt;/li&gt;&#xA;  &lt;li&gt;les erreurs lors de la crÃ©ation dâ€™index hypothÃ©tiques ou dans certains cas&#xA;leur affichage nâ€™Ã©tait pas correctement gÃ©rÃ©s sur plusieurs pages&lt;/li&gt;&#xA;  &lt;li&gt;les filtres des tableaux nâ€™Ã©tait pas rÃ©appliquÃ©s quand lâ€™intervalle de&#xA;temps sÃ©lectionnÃ© Ã©tait changÃ©&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&#xA;&lt;p&gt;Si un de ces problÃ¨mes vous a un jour posÃ© problÃ¨me, vous serez ravi&#xA;dâ€™apprendre quâ€™ils sont maintenant tous corrigÃ©s !&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Cette 4Ã¨me version de PoWA reprÃ©sente un temps de dÃ©veloppement trÃ¨s important,&#xA;de nombreuses amÃ©liorations sur la documentation et beaucoup de tests.  Nous&#xA;somme maintenant assez satisfaits, mais il est possible que nous ayons ratÃ©s&#xA;certains bugs.  Si vous vous intÃ©ressez Ã  ce projet, jâ€™espÃ¨re que vous&#xA;essaierez de tester cette beta, et si besoin nâ€™hÃ©sitez pas Ã  &lt;a href=&#34;https://powa.readthedocs.io/en/latest/support.html#support&#34;&gt;nous remonter un&#xA;bug&lt;/a&gt;!&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html&#34;&gt;PoWA 4 apporte un mode remote, disponible en beta !&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on May 17, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/05/17/powa-4-avec-mode-remote-disponible-en-beta.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>NouveautÃ© pg12: Statistiques sur les erreurs de checkums</title>
    <updated>2019-04-18T11:02:26Z</updated>
    <id>tag:rjuju.github.io,2019-04-18:/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html</id>
    <content type="html">&lt;h3 id=&#34;data-checksums&#34;&gt;Data checksums&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;AjoutÃ©s dans &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=96ef3b8ff1c&#34;&gt;PostgreSQL&#xA;9.3&lt;/a&gt;,&#xA;les &lt;a href=&#34;https://www.postgresql.org/docs/current/app-initdb.html#APP-INITDB-DATA-CHECKSUMS&#34;&gt;data&#xA;checksums&lt;/a&gt;&#xA;peuvent aider Ã  dÃ©tecter les corruptions de donnÃ©es survenant sur votre&#xA;stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Les checksums sont activÃ©s si lâ€™instance a Ã©tÃ© initialisÃ©e en utilisant &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;initdb&#xA;--data-checksums&lt;/code&gt; (ce qui nâ€™est pas le comportement par dÃ©faut), ou sâ€™ils ont&#xA;Ã©tÃ© activÃ©s aprÃ¨s en utilisant la nouvelle utilitaire&#xA;activated afterwards with the new&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/devel/app-pgchecksums.html&#34;&gt;pg_checksums&lt;/a&gt;&#xA;Ã©galement &lt;a href=&#34;https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=ed308d783790&#34;&gt;ajoutÃ© dans PostgreSQL&#xA;12&lt;/a&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Quand les checksums sont ativÃ©s, ceux-ci sont Ã©crits Ã  chaque fois quâ€™un bloc&#xA;de donnÃ©es est Ã©crit sur disque, et vÃ©rifiÃ©s Ã  chaque fois quâ€™un bloc est lu&#xA;depuis le disque (ou depuis le cache du systÃ¨me dâ€™exploitation).  Si la&#xA;vÃ©rification Ã©choue, une erreur est remontÃ©e dans les logs.  Si le bloc Ã©tait&#xA;lu par un processus client, la requÃªte associÃ©e Ã©chouera bien Ã©videmment, mais&#xA;si le bloc Ã©tait lu par une opÃ©ration&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;&#xA;(tel que pg_basebackup), la commande continuera Ã  sâ€™exÃ©cuter.  Bien que les&#xA;data checksums ne dÃ©tecteront quâ€™un sous ensemble des problÃ¨mes possibles, ils&#xA;ont tout de mÃªme une certaine utilisÃ©, surtout si vous ne faites pas confiance&#xA;Ã  votre stockage.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Jusquâ€™Ã  PostgreSQL 11, les erreurs de validation de checksum ne pouvaient Ãªtre&#xA;trouvÃ©es quâ€™en cherchant dans les logs, ce qui nâ€™est clairement pas pratique si&#xA;vous voulez monitorer de telles erreurs.&lt;/p&gt;&#xA;&#xA;&lt;h3 id=&#34;nouveaux-compteurs-disponibles-dans-pg_stat_database&#34;&gt;Nouveaux compteurs disponibles dans pg_stat_database&lt;/h3&gt;&#xA;&#xA;&lt;p&gt;Pour rendre la supervision des erreurs de checksum plus simple, et pour aider&#xA;les utilisateurs Ã  rÃ©agir dÃ¨s quâ€™un tel problÃ¨me survient, PostgreSQL 12 ajoute&#xA;de nouveaux compteurs dans la vue &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt; :&lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 6b9e875f7286d8535bff7955e5aa3602e188e436&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Sat Mar 9 10:45:17 2019 -0800&#xA;&#xA;Track block level checksum failures in pg_stat_database&#xA;&#xA;This adds a column that counts how many checksum failures have occurred&#xA;on files belonging to a specific database. Both checksum failures&#xA;during normal backend processing and those created when a base backup&#xA;detects a checksum failure are counted.&#xA;&#xA;Author: Magnus Hagander&#xA;Reviewed by: Julien Rouhaud&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 77bd49adba4711b4497e7e39a5ec3a9812cbd52a&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Fri Apr 12 14:04:50 2019 +0200&#xA;&#xA;    Show shared object statistics in pg_stat_database&#xA;&#xA;    This adds a row to the pg_stat_database view with datoid 0 and datname&#xA;    NULL for those objects that are not in a database. This was added&#xA;    particularly for checksums, but we were already tracking more satistics&#xA;    for these objects, just not returning it.&#xA;&#xA;    Also add a checksum_last_failure column that holds the timestamptz of&#xA;    the last checksum failure that occurred in a database (or in a&#xA;    non-dataabase file), if any.&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Â &lt;/p&gt;&#xA;&#xA;&lt;div class=&#34;language-plaintext highlighter-rouge&#34;&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;commit 252b707bc41cc9bf6c55c18d8cb302a6176b7e48&#xA;Author: Magnus Hagander &amp;lt;magnus@hagander.net&amp;gt;&#xA;Date:   Wed Apr 17 13:51:48 2019 +0200&#xA;&#xA;    Return NULL for checksum failures if checksums are not enabled&#xA;&#xA;    Returning 0 could falsely indicate that there is no problem. NULL&#xA;    correctly indicates that there is no information about potential&#xA;    problems.&#xA;&#xA;    Also return 0 as numbackends instead of NULL for shared objects (as no&#xA;    connection can be made to a shared object only).&#xA;&#xA;    Author: Julien Rouhaud &amp;lt;rjuju123@gmail.com&amp;gt;&#xA;    Reviewed-by: Robert Treat &amp;lt;rob@xzilla.net&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&#xA;&#xA;&lt;p&gt;Ces compteurs reflÃ¨teront les erreurs de validation de checksum Ã  la fois pour&#xA;les processus clients et pour lâ€™activitÃ©&#xA;&lt;a href=&#34;https://www.postgresql.org/docs/current/protocol-replication.html#id-1.10.5.9.7.1.8.1.12&#34;&gt;BASE_BACKUP&lt;/a&gt;,&#xA;par base de donnÃ©es.&lt;/p&gt;&#xA;&#xA;&lt;figure class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;rjuju&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=#&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pg_stat_database&lt;/span&gt;&#xA;                        &lt;span class=&#34;k&#34;&gt;View&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;&#34;pg_catalog.pg_stat_database&#34;&lt;/span&gt;&#xA;        &lt;span class=&#34;k&#34;&gt;Column&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;k&#34;&gt;Type&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Collation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Nullable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt;&#xA;&lt;span class=&#34;c1&#34;&gt;-----------------------+--------------------------+-----------+----------+---------&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datid&lt;/span&gt;                 &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oid&lt;/span&gt;                      &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;datname&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;                     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_failures&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bigint&lt;/span&gt;                   &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;checksum_last_failure&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&#xA; &lt;span class=&#34;p&#34;&gt;[...]&lt;/span&gt;&#xA; &lt;span class=&#34;n&#34;&gt;stats_reset&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;timestamp&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;zone&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;La colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_failures&lt;/code&gt; montrera un nombre cumulÃ© dâ€™erreurs, et la&#xA;colonne &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;checksum_last_failure&lt;/code&gt; montrera lâ€™horodatage de la derniÃ¨re erreur de&#xA;validation sur la base de donnÃ©es (NULL si aucune erreur nâ€™est jamais&#xA;survenue).&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Pour Ã©viter toute confusion (merci Ã  Robert Treat pour lâ€™avoir signalÃ©), ces&#xA;deux colonnes retourneront toujours NULL si les data checkums ne sont pas&#xA;activÃ©s, afin quâ€™on ne puisse pas croire que les checksums sont toujours&#xA;vÃ©rifiÃ©s avec succÃ¨s.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;Comme effet de bord, &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_stat_database&lt;/code&gt;  montrera maintenant Ã©galement les&#xA;statistiques disponibles pour les objets partagÃ©s (tels que la table&#xA;&lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;pg_database&lt;/code&gt; par exemple), dans une nouvelle ligne pour laquelle &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datid&lt;/code&gt; vaut&#xA;&lt;strong&gt;0&lt;/strong&gt;, et &lt;code class=&#34;language-plaintext highlighter-rouge&#34;&gt;datname&lt;/code&gt; vaut &lt;strong&gt;NULL&lt;/strong&gt;.&lt;/p&gt;&#xA;&#xA;&lt;p&gt;&lt;del&gt;Une sonde dÃ©diÃ©e est Ã©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/issues/226&#34;&gt;dÃ©jÃ &#xA;planifiÃ©e&lt;/a&gt; dans&#xA;&lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/del&gt;&#xA;Une sonde dÃ©diÃ©e est Ã©galement &lt;a href=&#34;https://github.com/OPMDG/check_pgactivity/commit/0e8b516e95e4364470d4e205aebc9fe68bbcfd23&#34;&gt;dÃ©jÃ &#xA;disponible&lt;/a&gt;&#xA;dans &lt;a href=&#34;https://opm.readthedocs.io/probes/check_pgactivity.html&#34;&gt;check_pgactivity&lt;/a&gt; !&lt;/p&gt;&#xA;&#xA;    &lt;p&gt;&lt;a href=&#34;https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html&#34;&gt;NouveautÃ© pg12: Statistiques sur les erreurs de checkums&lt;/a&gt; was originally published by Julien Rouhaud at &lt;a href=&#34;https://rjuju.github.io&#34;&gt;rjuju&#39;s home&lt;/a&gt; on April 18, 2019.&lt;/p&gt;</content>
    <link href="https://rjuju.github.io/postgresqlfr/2019/04/18/nouveau-dans-pg12-statistiques-erreurs-checksums.html" rel="alternate"></link>
    <summary type="html"></summary>
    <author>
      <name>Julien Rouhaud</name>
    </author>
  </entry>
  <entry>
    <title>Mettre en place une streaming replication avec PostgreSQL 10</title>
    <updated>2018-03-13T06:28:00Z</updated>
    <id>tag:blog.raveland.tech,2018-03-13:/post/postgresql_sr_fr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_sr_fr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Dans ce post, je vais vous expliquer comment mettre en place une &lt;em&gt;streaming replication&lt;/em&gt; avec PostgreSQL 10. Par contre, je n&amp;rsquo;expliquerais pas comment installer PostgreSQL donc je suppose que cela est dÃ©jÃ  le cas.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>OpenBSD / PostgreSQL / Authentification</title>
    <updated>2017-11-29T11:31:53Z</updated>
    <id>tag:blog.raveland.tech,2017-11-29:/post/openbsd_pg/</id>
    <link href="https://blog.raveland.tech/post/openbsd_pg/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Si vous Ãªtes un utilisateur d&amp;rsquo;OpenBSD et de PostgreSQL, vous pouvez utiliser l&amp;rsquo;authentification BSD pour vous authentifier sur vos bases.&#xA;Nous allons voir comment faire cela.&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
  <entry>
    <title>Postgresql et la rÃ©plication logique</title>
    <updated>2017-11-27T08:32:06Z</updated>
    <id>tag:blog.raveland.tech,2017-11-27:/post/postgresql_lr/</id>
    <link href="https://blog.raveland.tech/post/postgresql_lr/" rel="alternate"></link>
    <summary type="html">&lt;p&gt;Cet article va tester la nouvelle fonctionnalitÃ© disponible depuis PostgreSQL 10.0 : la rÃ©plication logique.&lt;/p&gt;&#xA;&lt;p&gt;Pour en savoir plus, l&amp;rsquo;excellente &lt;a href=&#34;https://docs.postgresql.fr/10/logical-replication.html&#34;&gt;documentation de PostgreSQL&lt;/a&gt;&lt;/p&gt;</summary>
    <author>
      <name>blog.raveland.tech</name>
    </author>
  </entry>
</feed>